function createAffiliateCodeController($scope,$element,$attrs,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage){$scope.getCodeError=!1,$scope.generateAffiliateCode=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/getCode"}).then(function(response){if("true"===response.Success)$scope.getCodeError=!1,$scope.newAffiliateCode=response.promotion;else{$scope.getCodeError=!0;for(var key in response.error)$scope.getCodeErrorMsg=response.error[key]}})},$scope.productsError=!1,$scope.getAvailableProducts=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/getProducts"}).then(function(response){if("true"===response.Success)$scope.productsError=!1,$scope.productList=response.product;else{$scope.productsError=!0;for(var key in response.error)$scope.productsErrorMsg=response.error[key]}})},$scope.affliliateCode={},$scope.createAffiliateCode={},$scope.createAffiliateCode.validationError=!1,$scope.createCodeError=!1,$scope.setupAffiliateCode=function(fData){if(function(d){if("object"==typeof d){var _dm=void 0!==d?d.getMonth()+1:0,_dd=void 0!==d?d.getDate():0,_dy=void 0!==d?d.getFullYear():0,_dDate=(_dm<10?"0"+_dm:_dm)+"/"+(_dd<10?"0"+_dd:_dd)+"/"+_dy;fData.endDate=_dDate}else fData.endDate=d}(fData.endDate),fData.code=$scope.newAffiliateCode,!1===$scope.productsError&&!1===$scope.getCodeError){$scope.createAffiliateCode.validationError=!1;var vCount=0;for(var k in fData)"default"!==fData[k]&&"default1"!==fData[k]||vCount++;"COUNT_BASED"!==fData.promotionType?$scope.createAffiliateCode.$valid&&0===vCount&&fData.unitPrice>0?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/create",data:$.param(fData).replace(/%2F/g,"/")}).then(function(response){if("true"===response.Success)$scope.createCodeError=!1,$localStorage.set("gNotify","AddCode"),setTimeout(function(){window.location="/sp/sysAdmin/promotions/affiliateCodesListing"},100);else{$scope.createCodeError=!0;for(var key in response.error)$scope.createCodeErrorMsg=response.error[key]}}):$scope.createAffiliateCode.validationError=!0:"COUNT_BASED"===fData.promotionType&&(fData.count>0?($scope.createAffiliateCode.validationError=!1,$scope.createAffiliateCode.$valid&&0===vCount&&fData.unitPrice>0?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/create",data:$.param(fData).replace(/%2F/g,"/")}).then(function(response){if("true"===response.Success)$scope.createCodeError=!1,$localStorage.set("gNotify","AddCode"),setTimeout(function(){window.location="/sp/sysAdmin/promotions/affiliateCodesListing"},100);else{$scope.createCodeError=!0;for(var key in response.error)$scope.createCodeErrorMsg=response.error[key]}}):$scope.createAffiliateCode.validationError=!0):$scope.createAffiliateCode.validationError=!0)}},$scope.getDetailsError=!1,$scope.existingTags=null,$scope.getPromoDetails=function(pid){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/getDetails",data:$.param({promotionId:pid})}).then(function(response){if("true"===response.Success)$scope.getDetailsError=!1,$scope.existingPromoDetails=response.promotion,$scope.affliliateCode.productList=$scope.existingPromoDetails.productList[0].id,$scope.affliliateCode.promotionType=$scope.existingPromoDetails.promotionType,$scope.affliliateCode.unitPrice=$scope.existingPromoDetails.unitPrice,$scope.affliliateCode.endDate=($scope.existingPromoDetails.endDate.monthValue<10?"0"+$scope.existingPromoDetails.endDate.monthValue:$scope.existingPromoDetails.endDate.monthValue)+"/"+($scope.existingPromoDetails.endDate.dayOfMonth<10?"0"+$scope.existingPromoDetails.endDate.dayOfMonth:$scope.existingPromoDetails.endDate.dayOfMonth)+"/"+$scope.existingPromoDetails.endDate.year,$scope.existingPromoDetails.count>0&&($scope.affliliateCode.count=$scope.existingPromoDetails.count),$scope.existingPromoDetails.tags.length>0?$scope.existingTags=$scope.existingPromoDetails.tags.length>1?$scope.existingPromoDetails.tags.join(","):$scope.existingPromoDetails.tags[0]:$scope.existingTags=null,$scope.affliliateCode.message=$scope.existingPromoDetails.message,$scope.affliliateCode.status=$scope.existingPromoDetails.status;else{$scope.getDetailsError=!0;for(var key in response.error)$scope.getDetailsErrorMsg=response.error[key]}})},$scope.cancelRedirect=function(){window.location="/sp/sysAdmin/promotions/affiliateCodesListing"},function(){$scope.generateAffiliateCode(),$scope.getAvailableProducts(),$scope.affliliateCode.status="Active";var url=window.location.href,splitUrl=url.split("?")[1];void 0!==splitUrl&&$scope.getPromoDetails(splitUrl.split("=")[1])}()}angular.module("spApp").controller("createAffiliateCodeController",createAffiliateCodeController),createAffiliateCodeController.$inject=["$scope","$element","$attrs","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage"];