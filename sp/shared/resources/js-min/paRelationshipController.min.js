function paRelationshipController($scope,$element,$attrs,$http,$timeout,ajaxService,$rootScope,$localStorage,ngDialog,sharedProperties,memberService){var _this=this;_this.selectedCandidate={},_this.memberMasterList={},_this.masterCandidatesList={},_this.validMemberList=[],_this.candidateMasterList={},_this.validCandidateList=[],_this.selectedMemberDetails={},_this.candidateProfileDetails={},_this.memberProfileDetails={},_this.candidateAdvise={},_this.memberAdvise={},_this.candidateAvoidFormatted=[],_this.resultTabs={},_this.personalityFlags=[],_this.cachedAdvisorData=[],_this.showMemberListingWidget={},_this.selectedMember={},_this.selectedMember.left={},_this.selectedMember.right={},_this.showMemberListingWidget.right=!1,_this.showMemberListingWidget.left=!1,_this.memberSelected={},_this.memberSelected.right=!1,_this.memberSelected.left=!1,_this.showContent=!1,_this.resultTabs.leftSelected=0,_this.resultTabs.rightSelected=0,_this.serverException=!1,_this.mobileControls={},_this.mobileControls.display=!1,_this.memberCountException=!1,_this.sResizeFlag=0,_this.lResizeFlag=0,"print"===sharedProperties.getParam("mode")&&null!==sharedProperties.getParam("printParams")&&"false"!==sharedProperties.getParam("printParams").split(",")[4]?_this.viewMode={list:!0,chart:!1}:"print"===sharedProperties.getParam("mode")&&null!==sharedProperties.getParam("printParams")&&"false"===sharedProperties.getParam("printParams").split(",")[4]?_this.viewMode={list:!1,chart:!0}:_this.viewMode={list:!0,chart:!1},_this.cachedUSerEmails=null,_this.matchPercent={},_this.matchPercent.primary=!0,_this.switchToUser1=!0,_this.prismLabelContent=!1,_this.prismLabelContent1=!1,_this.label="",_this.changeList0="member",_this.changeList1="member",$rootScope.renderedPrintGraphsInfo={},$rootScope.renderedPrintGraphsInfo.count=0,$rootScope.renderedPrintGraphsInfo.list=[];var lang=sharedProperties.getUserLocale();_this.winWidth=jQuery(window).width(),jQuery(window).resize(function(){_this.winWidth=jQuery(window).width()}),_this.setHeadings=function(name,heading){return"en-US"===lang?name+heading:name+" "+heading},_this.setContentReference=function(obj,type){var tempObj={data:obj,type:type};sharedProperties.setContentReference(tempObj),tempObj=null},_this.labelsReset=function(){jQuery(".outer-labels").find("p").removeClass("active"),_this.prismLabelContent=!1,_this.prismLabelContent1=!1,_this.label=""},_this.getAllMemberDetails=function(){$localStorage.remove("activeView","portraitId"),memberService.getAllEmployees().then(function(response){_this.serverException=!1,_this.memberMasterList=response,_this.memberMasterList.length>1?(_this.memberCountException=!1,jQuery.each(_this.memberMasterList,function(i,j){if("VALID"===_this.memberMasterList[i].userStatus){var newList=jQuery.extend({},_this.memberMasterList[i],{selectedMember:!1,selectedSide:{left:!1,right:!1}});_this.validMemberList.push(newList)}}),$rootScope.$broadcast("memberListAvailable")):_this.memberCountException=!0;var left=sharedProperties.getParam("userId");null!==left&&_this.updateCompareMember(left,"left","member")}),(_this.serverException||_this.memberCountException)&&(_this.memberCountException=!0)},_this.getAllCandidateDetails=function(){memberService.getAllCandidates().then(function(response){_this.serverException=!1,_this.masterCandidatesList=response,_this.masterCandidatesList.length>1?(_this.memberCountException=!1,jQuery.each(_this.masterCandidatesList,function(i,j){if("VALID"===_this.masterCandidatesList[i].userStatus){var newList=jQuery.extend({},_this.masterCandidatesList[i],{selectedMember:!1,selectedSide:{left:!1,right:!1}});_this.validCandidateList.push(newList)}}),$rootScope.$broadcast("candidateListAvailable")):_this.memberCountException=!0}),(_this.serverException||_this.memberCountException)&&(_this.memberCountException=!0)},_this.showDropdownWidget=function(side){"right"===side?(_this.showMemberListingWidget.right=!_this.showMemberListingWidget.right,_this.showMemberListingWidget.left=!1,$timeout(function(){jQuery(window).width()<768&&jQuery("html, body").animate({scrollTop:325})},300)):(_this.showMemberListingWidget.left=!_this.showMemberListingWidget.left,_this.showMemberListingWidget.right=!1,$timeout(function(){jQuery(window).width()<768&&jQuery("html, body").animate({scrollTop:325})},300))},_this.compareToolReset=function(){_this.viewMode={list:!0,chart:!1},_this.switchToUser1=!0,_this.cachedUSerEmails=null,_this.matchPercent.primary=!0,_this.resultTabs={},_this.personalityFlags=[],_this.cachedAdvisorData=[],_this.resultTabs.leftSelected=0,_this.resultTabs.rightSelected=0,_this.showContent=!1,_this.showMemberListingWidget.right=!1,_this.memberSelected.right=!1,_this.showMemberListingWidget.left=!1,_this.memberSelected.left=!1,_this.selectedMember.left.email=null,_this.selectedMember.right.email=null,_this.mobileControls.display=!1,jQuery.each(_this.validMemberList,function(j){_this.validMemberList[j].selectedMember=!1,_this.validMemberList[j].selectedSide.right=!1,_this.validMemberList[j].selectedSide.left=!1}),jQuery.each(_this.validCandidateList,function(j){_this.validCandidateList[j].selectedMember=!1,_this.validCandidateList[j].selectedSide.right=!1,_this.validCandidateList[j].selectedSide.left=!1}),_this.sResizeFlag=0,_this.lResizeFlag=0,_this.winWidth<768?$rootScope.setBoxSizes("#dd-wrap",".dd","full"):jQuery("body").find("#dd-wrap").find(".dd").removeAttr("style"),sharedProperties.fireAnalyticsEvent("PA Prism RA | Reset","N/A")},_this.updateCompareMember=function(i,side,userType){_this.labelsReset(),_this.cachedUSerEmails=null,_this.showMemberListingWidget[side]=!1,_this.personalityFlags=[],_this.cachedAdvisorData=[],_this.resultTabs.leftSelected=0,_this.resultTabs.rightSelected=0,jQuery.each(_this.validMemberList,function(j){!0===_this.validMemberList[j].selectedSide[side]&&(_this.validMemberList[j].selectedMember=!1,_this.validMemberList[j].selectedSide[side]=!1)}),jQuery.each(_this.validCandidateList,function(j){!0===_this.validCandidateList[j].selectedSide[side]&&(_this.validCandidateList[j].selectedMember=!1,_this.validCandidateList[j].selectedSide[side]=!1)}),"member"===userType?jQuery.each(_this.validMemberList,function(j){if(_this.validMemberList[j].email===i||_this.validMemberList[j].id===i)return _this.validMemberList[j].selectedMember=!0,_this.validMemberList[j].selectedSide[side]=!0,_this.memberSelected[side]=!0,_this.selectedMemberDetails[side]=_this.validMemberList[parseInt(j)],_this.selectedMember[side].email=_this.validMemberList[parseInt(j)].id,void(!0===_this.viewMode.list?_this.compareMembers(_this.selectedMember.left.email,_this.selectedMember.right.email,{user1PersonalityType:"Primary",user2PersonalityType:"Primary"}):_this.getCompareCharts(_this.selectedMember.left.email,_this.selectedMember.right.email))}):jQuery.each(_this.validCandidateList,function(j){if(_this.validCandidateList[j].id===i)return _this.validCandidateList[j].selectedMember=!0,_this.validCandidateList[j].selectedSide[side]=!0,_this.memberSelected[side]=!0,_this.selectedMemberDetails[side]=_this.validCandidateList[parseInt(j)],_this.selectedMember[side].email=_this.validCandidateList[parseInt(j)].id,void(!0===_this.viewMode.list?_this.compareMembers(_this.selectedMember.left.email,_this.selectedMember.right.email,{user1PersonalityType:"Primary",user2PersonalityType:"Primary"}):_this.getCompareCharts(_this.selectedMember.left.email,_this.selectedMember.right.email))}),_this.winWidth<768&&$timeout(function(){$rootScope.setBoxSizes("#dd-wrap",".dd","full")},300),sharedProperties.fireAnalyticsEvent("PA Prism RA | Member Selected on "+side,"N/A")},_this.compareMembers=function(c,m,pTypes){if(_this.memberSelected.left&&_this.memberSelected.right){var data=$.extend({},{user1Id:c,user2Id:m},pTypes),_o={url:"/sp/hiring/compareRelation",data:$.param(data).replace(/%40/g,"@")};ajaxService.getAjaxResponse(_o).then(function(response){if("true"===response.Success)_this.serverException=!1,_this.cacheResults(data,response),_this.winWidth>767?(_this.showContent=!0,_this.mobileControls.display=!1):(_this.showContent=!1,_this.mobileControls.display=!0,_this.switchToUser1=!0,setTimeout(function(){$rootScope.setBoxSizes(".mobile-tabs",".mtabs")},200)),setTimeout(function(){$rootScope.setBoxSizes(".results-wrapper",".results-content")},500);else{_this.compareToolReset(),_this.serverException=!0;for(var key in response.error)_this.errorMessage=response.error[key]}})}},_this.chartsException=!1,_this.getCompareCharts=function(u1,u2){_this.memberSelected.left&&_this.memberSelected.right&&(_this.matchPercent.primary=!0,null===_this.cachedUSerEmails&&(_this.cachedUSerEmails=u1+u2,ajaxService.getAjaxResponse({url:"/sp/hiring/compareProfile",data:$.param({user1Id:u1,user2Id:u2})}).then(function(response){if("true"===response.Success)_this.chartsException=!1,_this.compareProfileData=response,_this.cacheCompareResponse=response,_this.candidateProfileDetails=response.user1Analysis,_this.memberProfileDetails=response.user2Analysis,_this.matchPercentageData=response.matchPercent,_this.winWidth>767?(_this.showContent=!0,_this.mobileControls.display=!1):(_this.showContent=!1,_this.mobileControls.display=!0,_this.switchToUser1=!0,setTimeout(function(){$rootScope.setBoxSizes(".mobile-tabs",".mtabs")},200)),_this.personalityFormatted={candidate:{primary:$rootScope.pullInterNationalization("profileKeys."+_this.candidateProfileDetails.personality.Primary.personalityType.trim()),pressure:$rootScope.pullInterNationalization("profileKeys."+_this.candidateProfileDetails.personality.UnderPressure.personalityType.trim())},member:{primary:$rootScope.pullInterNationalization("profileKeys."+_this.memberProfileDetails.personality.Primary.personalityType.trim()),pressure:$rootScope.pullInterNationalization("profileKeys."+_this.memberProfileDetails.personality.UnderPressure.personalityType.trim())}},$timeout(function(){_this.dataAvailablity=!0},300);else{_this.chartsException=!0,_this.compareToolReset();for(var key in response.error)_this.chartsExceptionMsg=response.error[key]}})))},_this.cacheResults=function(p,r){var pType=p.user1PersonalityType.charAt(0)+p.user2PersonalityType.charAt(0);-1===$.inArray(pType,_this.personalityFlags)&&(_this.personalityFlags.push(pType),_this.cachedAdvisorData[pType]=r,_this.candidateAdvise=_this.cachedAdvisorData[pType].primary,_this.memberAdvise=_this.cachedAdvisorData[pType].secondary),$localStorage.set("candAdvise",_this.candidateAdvise),$localStorage.set("memberAdvise",_this.memberAdvise),$localStorage.set("selectedMemDetails",_this.selectedMemberDetails),$localStorage.set("resultTabs",_this.resultTabs),$rootScope.$broadcast("reportAvailable")},_this.formatList=function(list){if(void 0!==list){var rawList=list.split("</p>"),listHTML="",counter=0;if(jQuery.each(rawList,function(i){void 0!==rawList[i].split("<p>")[1]&&(listHTML+="<li>"+rawList[i].split("<p>")[1]+"</li>"),counter++}),counter===rawList.length)return listHTML}},_this.changeContentTabs=function(s,i){"left"===s?(_this.resultTabs.leftSelected=parseInt(i),sharedProperties.fireAnalyticsEvent("PA Prism RA | Switch Profile type View on left",0===_this.resultTabs.leftSelected?"Primary":"UnderPressure")):(_this.resultTabs.rightSelected=parseInt(i),sharedProperties.fireAnalyticsEvent("PA Prism RA | Switch Profile type View on right",0===_this.resultTabs.rightSelected?"Primary":"UnderPressure"));var u1PType=0===_this.resultTabs.leftSelected?"Primary":"UnderPressure",u2PType=0===_this.resultTabs.rightSelected?"Primary":"UnderPressure",pFlag=u1PType.charAt(0)+u2PType.charAt(0);-1===$.inArray(pFlag,_this.personalityFlags)?$timeout(function(){_this.compareMembers(_this.selectedMember.left.email,_this.selectedMember.right.email,{user1PersonalityType:u1PType,user2PersonalityType:u2PType})},100):(_this.candidateAdvise=_this.cachedAdvisorData[pFlag].primary,_this.memberAdvise=_this.cachedAdvisorData[pFlag].secondary),$localStorage.set("resultTabs",_this.resultTabs)},_this.changeViewMode=function(v){_this.labelsReset(),_this.showMemberListingWidget.right=!1,_this.showMemberListingWidget.left=!1,"list"===v?(_this.viewMode.list=!0,_this.viewMode.chart=!1,_this.compareMembers(_this.selectedMember.left.email,_this.selectedMember.right.email,{user1PersonalityType:"Primary",user2PersonalityType:"Primary"}),sharedProperties.fireAnalyticsEvent("PA Prism RA | Click Standard View","N/A")):(_this.viewMode.list=!1,_this.viewMode.chart=!0,_this.getCompareCharts(_this.selectedMember.left.email,_this.selectedMember.right.email),sharedProperties.fireAnalyticsEvent("PA Prism RA | Click Charts View","N/A"))},_this.initCandiateCompare=function(){_this.getAllMemberDetails(),_this.getAllCandidateDetails()},_this.getMobileReport=function(v){_this.winScreenHeight=jQuery(window).height()+"px",!0===v?ngDialog.open({template:"/sp/resources/html/tools/relationship-manager/mobile-report.html",scope:$scope,className:"ngdialog-theme-default no-padding-top"}):ngDialog.open({template:"/sp/resources/html/tools/relationship-manager/mobile-charts.html",scope:$scope,className:"ngdialog-theme-default no-padding-top"})},jQuery(window).resize(function(){if(_this.winWidth<768){ngDialog.getOpenDialogs().length&&$scope.$apply(function(){$timeout(function(){_this.winScreenHeight=jQuery(window).height()+"px"},100)}),_this.memberSelected.left&&_this.memberSelected.right&&0===_this.sResizeFlag&&!1===_this.mobileControls.display&&(_this.showContent=!1,$timeout(function(){_this.mobileControls.display=!0},500),_this.sResizeFlag=1,_this.lResizeFlag=0),$rootScope.setBoxSizes("#dd-wrap",".dd","full")}else _this.memberSelected.left&&_this.memberSelected.right&&0===_this.lResizeFlag&&($timeout(function(){_this.viewMode.list=!0,_this.viewMode.chart=!1,_this.cachedUSerEmails=null,_this.mobileControls.display=!1,_this.showContent=!0},500),_this.sResizeFlag=0,_this.lResizeFlag=1),ngDialog.close("ngdialog1"),jQuery("body").find("#dd-wrap").find(".dd").removeAttr("style")}),_this.openPdfView=function(url,_this,profileName){window.open(url,"_blank"),window.focus()},_this.initPrint=function(){$rootScope.renderedPrintGraphsInfo={},$rootScope.renderedPrintGraphsInfo.count=0,$rootScope.renderedPrintGraphsInfo.list=[],_this.initCandiateCompare()};var candidateListAvailable="print"===sharedProperties.getParam("mode")&&$scope.$on("candidateListAvailable",function(e){candidateListAvailable();var printParams=sharedProperties.getParam("printParams").split(","),email1=printParams[0],email2=printParams[1],tab1=printParams[2],tab2=printParams[3];_this.updateCompareMember(email1,"left",printParams[5]),_this.updateCompareMember(email2,"right",printParams[6]),"false"!==printParams[4]&&(_this.changeContentTabs("left",tab1),_this.changeContentTabs("right",tab2))}),memberListAvailable="print"===sharedProperties.getParam("mode")&&$scope.$on("memberListAvailable",function(e){memberListAvailable();var printParams=sharedProperties.getParam("printParams").split(","),email1=printParams[0],email2=printParams[1],tab1=printParams[2],tab2=printParams[3];_this.updateCompareMember(email1,"left",printParams[5]),_this.updateCompareMember(email2,"right",printParams[6]),"false"!==printParams[4]&&(_this.changeContentTabs("left",tab1),_this.changeContentTabs("right",tab2))}),reportAvailable="print"===sharedProperties.getParam("mode")&&$scope.$on("reportAvailable",function(e){reportAvailable();var isPrintMode="print"===sharedProperties.getParam("mode")&&"false"!==sharedProperties.getParam("printParams").split(",")[4];$timeout(function(){isPrintMode&&angular.element(document).ready(function(){window.print(),window.close()})},0)}),updateGraphCount="print"===sharedProperties.getParam("mode")&&$scope.$on("updateGraphCounter",function(e,data){if(null===data)return!0;$scope.$apply(function(){-1===$rootScope.renderedPrintGraphsInfo.list.indexOf(data.graphName)&&($rootScope.renderedPrintGraphsInfo.list.push(data.graphName),$rootScope.renderedPrintGraphsInfo.count=$rootScope.renderedPrintGraphsInfo.count+1),25===$rootScope.renderedPrintGraphsInfo.count&&(updateGraphCount(),$rootScope.$broadcast("graphsLoaded"))})}),printGraphs="print"===sharedProperties.getParam("mode")&&$scope.$on("graphsLoaded",function(e){printGraphs();var isPrintMode="print"===sharedProperties.getParam("mode")&&"false"===sharedProperties.getParam("printParams").split(",")[4];$timeout(function(){isPrintMode&&angular.element(document).ready(function(){window.print(),window.close()})},0)});null===sharedProperties.getParam("mode")&&_this.initCandiateCompare()}angular.module("spApp").controller("paRelationshipController",paRelationshipController),paRelationshipController.$inject=["$scope","$element","$attrs","$http","$timeout","ajaxService","$rootScope","$localStorage","ngDialog","sharedProperties","memberService"];