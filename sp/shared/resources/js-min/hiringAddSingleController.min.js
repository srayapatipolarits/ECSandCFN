function hiringAddSingleController($scope,$element,$attrs,$http,userDataService,ngDialog,$timeout,ajaxService,$localStorage){$scope.addCandidate={},$scope.candidate={},$scope.dialogStatus={},$scope.serverExceptionContent="",$scope.zeroAvailabilityError=!1,$scope.existingSPMember=!1,$scope.showDate=!1,$scope.candidate.sendInvite=!1,$scope.submitDisabled=!1,$scope.addCandidate.submitted=!1,$scope.existingHiring=!1,$scope.existingHiringArchive=!1,$scope.currentCompanyEmp=!1,$scope.memberPublicProfile=!1,$scope.serverException=!1,$scope.emailCheckFlag=!1,$scope.isEmailValidated=!1;var storedProfile=$localStorage.get("loggegdInProfile"),userRoles=storedProfile.member.roles.sort();$scope.isAccountAdmin=0===jQuery.inArray("AccountAdministrator",userRoles);var d=new Date;$scope.endDate=d.setDate(d.getDate()),$scope.getCandidateAvailability=function(){ajaxService.getAjaxResponse({url:"/sp/hiring/getAvailableSubscriptions"}).then(function(response){if("true"===response.Success)$scope.availableSubscriptions=response.availableHiringSubscripitons,0===$scope.availableSubscriptions?($scope.zeroAvailabilityError=!0,$scope.submitDisabled=!0):($scope.zeroAvailabilityError=!1,$scope.submitDisabled=!1);else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.existingUserCheck=function(email){if($scope.zeroAvailabilityError===!1){$scope.existingSPMember=!1,$scope.existingHiring=!1,$scope.serverException=!1,$scope.existingHiringArchive=!1,$scope.submitDisabled=!1,$scope.candidate.sendInvite=!1,$scope.currentCompanyEmp=!1;var emailPattern=/^[a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,4}$/i;emailPattern.test(email)?ajaxService.getAjaxResponse({url:"/sp/hiring/checkCandidate",data:$.param({candidateEmail:email}).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){var archivedCandidate=response["hiring-archived"].length,hiringCandidate=response.hiring.length,companyCandidate=response.company.length,memberCandidate=response.memberList.length;"true"===response.Success?($scope.serverException=!1,$scope.submitDisabled=!1,$scope.serverExceptionContent="",0===archivedCandidate&&0===hiringCandidate&&0===companyCandidate&&0===memberCandidate?($scope.candidate.sendInvite=!0,$scope.existingSPMember=!1,$scope.existingHiring=!1,$scope.existingHiringArchive=!1,$scope.currentCompanyEmp=!1):($scope.existingSPMember=!1,$scope.existingHiring=!1,$scope.existingHiringArchive=!1,$scope.currentCompanyEmp=!1,archivedCandidate>0?($scope.existingHiringArchive=!0,$scope.submitDisabled=!0):hiringCandidate>0?($scope.existingHiring=!0,$scope.submitDisabled=!0):companyCandidate>0?($scope.currentCompanyEmp=!0,$scope.submitDisabled=!0):memberCandidate>0&&($scope.existingSPMember=!0,$scope.submitDisabled=!1,"VALID"===response.memberList[0].userStatus&&response.memberList[0].profileSettings.hiringAccessAllowed===!0?$scope.memberPublicProfile=!0:$scope.memberPublicProfile=!1),$scope.candidate.sendInvite=!1)):($scope.existingSPMember=!1,$scope.existingHiring=!1,$scope.existingHiringArchive=!1,$scope.currentCompanyEmp=!1,$scope.serverException=!0,$scope.submitDisabled=!0,void 0!==typeof response.error.InvalidRequestException&&($scope.serverExceptionContent=response.error.InvalidRequestException),jQuery("html, body").animate({scrollTop:0})),$scope.isEmailValidated=!0}):($scope.isEmailValidated=!0,$scope.addCandidate.submitted=!1)}},$scope.addHiringCandidate=function(fData){if($scope.isEmailValidated===!1&&($scope.existingUserCheck(fData.email),$timeout(function(){$scope.addHiringCandidate(fData)},300)),$scope.addCandidate.submitted=!1,$scope.serverException=!1,$scope.zeroAvailabilityError===!1&&$scope.submitDisabled===!1&&$scope.isEmailValidated===!0)if($scope.addCandidate.$valid){var _params={firstName:fData.firstName,lastName:fData.lastName,email:fData.email,phoneNumber:fData.phoneNumber,webURL:fData.webURL,day:"undefined"!=typeof fData.dueDate?fData.dueDate.getDate():0,month:"undefined"!=typeof fData.dueDate?fData.dueDate.getMonth()+1:0,year:"undefined"!=typeof fData.dueDate?fData.dueDate.getFullYear():0,roles:fData.roles,tags:fData.tags,sendInvite:$scope.candidate.sendInvite};_params.month<10&&(_params.month="0"+_params.month),_params.day<10&&(_params.day="0"+_params.day),ajaxService.getAjaxResponse({url:"/sp/hiring/addCandidate",data:$.param(_params).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){"true"===response.Success?($localStorage.set("gNotify","AddSingle"),setTimeout(function(){window.location="/sp/tools/hiring/"},100)):($scope.serverException=!0,$scope.submitDisabled=!0,void 0!==typeof response.error.InvalidRequestException&&($scope.serverExceptionContent=response.error.InvalidRequestException),jQuery("html, body").animate({scrollTop:0}))})}else $scope.addCandidate.submitted=!0,jQuery("html, body").animate({scrollTop:0})},$scope.cancelRedirect=function(){window.location="/sp/tools/hiring/"},$scope.initHiringAddSingle=function(){$scope.getCandidateAvailability(),null!==$localStorage.get("addAccounts")&&"undefined"!=typeof $localStorage.get("addAccounts")&&$timeout(function(){ngDialog.open({template:"/sp/resources/html/admin/account/request-success.html",scope:$scope}),$localStorage.remove("addAccounts")},300)},$scope.initHiringAddSingle(),$scope.currentPageUrl=window.location.href,$scope.addAccountsModal=function(addType){$localStorage.remove("addAccounts"),$scope.addAccountsForm={},$scope.addAccountsForm.submitted=!1,$scope.addAccounts={};var processAddAccounts=function(data,e){"members"===addType?$scope.noZeros=parseInt($scope.addAccounts.memberAccounts+$scope.addAccounts.memberAdminAccounts):$scope.noZeros=parseInt($scope.addAccounts.candidateBundles+$scope.addAccounts.hiringAdminAccounts),$scope.addAccountsForm.submitted=!1,this.addAccountsForm.$valid&&0!==$scope.noZeros?($localStorage.set("addAccounts",!0),$scope.addAccountsForm.submitted=!1):($scope.addAccountsForm.submitted=!0,e.preventDefault())};$scope.processAddAccounts=processAddAccounts,$scope.addType=addType,ngDialog.open({template:"/sp/resources/html/admin/account/addAccountsModal.html",scope:$scope})}}angular.module("spApp").controller("hiringAddSingleController",hiringAddSingleController),hiringAddSingleController.$inject=["$scope","$element","$attrs","$http","userDataService","ngDialog","$timeout","ajaxService","$localStorage"];