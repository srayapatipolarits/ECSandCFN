function assessmentService(ajaxService,sharedProperties,$localStorage,$q){this.next=function(type,serviceUrl,data){var _options={url:serviceUrl,delay:600,maximum:1200};return"undefined"!==data&&null!==data&&angular.isObject(data)&&(_options.data=$.param(data)),ajaxService.getAjaxResponse(_options).then(function(response){return"true"===response.Success?response:null!==response.error?("finish"!==type&&sharedProperties.ajaxError(response.error),response):void 0})},this.previous=function(type,serviceUrl){var _options={url:serviceUrl,delay:600,maximum:1200};return ajaxService.getAjaxResponse(_options).then(function(response){return"true"===response.Success?response:null!==response.error?(sharedProperties.ajaxError(response.error),response):void 0})}}assessmentService.$inject=["ajaxService","sharedProperties","$localStorage","$q"],angular.module("spApp").service("assessmentService",assessmentService);
angular.module("spApp").directive("assessment",["sharedProperties","$rootScope","ngDialog","$filter","$localStorage","$timeout","$state","assessmentService","assessmentConfig","$templateRequest","$compile",function(sharedProperties,$rootScope,ngDialog,$filter,$localStorage,$timeout,$state,assessmentService,assessmentConfig,$templateRequest,$compile){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:function(element,attrs){return"/sp/resources/html/assessment/"+attrs.urlSrc},link:function(scope,element,attrs){function leftIconAnimations(){$(".iCrumb-choose, .instruction-container-animate, .instruction-icon-animate, .iCrumb-list, .assessment-icon-crumbs").removeAttr("style");var $elem=$(".iCrumb-shuffle");$({deg:0}).animate({deg:359},{queue:!1,duration:300,step:function(now){$elem.css({transform:"rotate("+now+"deg)"})}}),$(".iCrumb-list").animate({opacity:0,width:0},{queue:!1,duration:300}),$(".iCrumb-choose").animate({left:0,opacity:0},{queue:!1,duration:300}),$(".instruction-container-animate").animate({height:0,opacity:0},{queue:!1,duration:100}),$(".instruction-icon-animate").animate({opacity:0},{queue:!1,duration:300}),$timeout(function(){$(".assessment-icon-crumbs").animate({marginTop:-65},{queue:!1,duration:200})},300),$timeout(function(){$({deg:0}).animate({deg:359},{queue:!1,duration:300,step:function(now){$elem.css({transform:"rotate("+now+"deg)"})}}),$(".instruction-container-animate").removeAttr("style").css({opacity:0}),$(".instruction-container-animate").animate({opacity:1},{queue:!1,duration:300}),$(".instruction-icon-animate").removeAttr("style").css({opacity:0}),$(".instruction-icon-animate").animate({opacity:1},{queue:!1,duration:300}),$(".assessment-icon-crumbs").animate({marginTop:54},{queue:!1,duration:300}),$(".iCrumb-list").animate({opacity:1,width:125},{queue:!1,duration:300}),$(".iCrumb-choose:last-child").animate({left:80,opacity:1},{queue:!1,duration:300}),$(".iCrumb-choose:nth-child(2)").animate({left:40,opacity:1},{queue:!1,duration:300}),$(".iCrumb-choose:first-child").animate({left:0,opacity:1},{queue:!1,duration:300}),_this.leftAnimation=!1},900)}function templateActions(containerId,isDraggableTemplate,timer){$timeout(function(){$(".assessment-animation-container").animate({right:0,opacity:1},{queue:!1,duration:300,complete:function(){isDraggableTemplate&&initDrag(containerId)}})},_this.isPrevious?0:timer)}function chooseFinish(containerId,answerId,updateChooseFlag){$("#"+containerId).find("li").removeClass("on").find(".answer-desc, .selection-icon").css({color:"#000"}),$("#"+containerId).find(".bg-fill").css({width:0}),_this.chooseAnswerId=answerId,$("#"+answerId).addClass("on").find(".bg-fill").animate({width:$("#"+answerId).width()},{queue:!1,duration:300,complete:function(){$("#"+answerId).find(".answer-desc, .selection-icon").css({color:"#fff"})}}),updateChooseFlag&&(_this.finishFlagForChoose=!0)}function callToActions(actionType,elementId,isMostLeast,answerId){if(_this.nextEnable){_this.nextEnable=!1;var answer=[],list=$("#"+elementId).find("li.assessment-answer"),listLen=list.length,chooseAnswer=void 0!==answerId&&null!==answerId&&""!==answerId;isMostLeast?(answer.push($(list[0]).attr("id")),answer.push($(list[listLen-1]).attr("id"))):$.each(list,function(){answer.push($(this).attr("id"))}),chooseAnswer&&($("#"+elementId).find("li").removeClass("on").find(".answer-desc, .selection-icon").css({color:"#000"}),$("#"+elementId).find(".bg-fill").css({width:0}),$("#"+answerId).addClass("on").find(".bg-fill").animate({width:$("#"+answerId).width()},{queue:!1,duration:300,complete:function(){$("#"+answerId).find(".answer-desc, .selection-icon").css({color:"#fff"})}})),$timeout(function(){_this.nextEnable=!1,$(".assessment-animation-container").animate({right:50,opacity:0},{queue:!1,duration:300})},850),$timeout(function(){$(".assessment-animation-container").stop().removeAttr("style"),_this.currentQuestion.description=null,_this.randomAnswersList=null,nextQuestion(chooseAnswer?answerId:answer.toString())},1e3)}}function nextQuestion(answerList){console.log("Q: ",_this.currentQuestion.number,"  > ANS: ",answerList),_this.nextEnable=!1,assessmentService.next(_this.isFinish?"finish":"next",assessmentConfig.services[_this.assessmentModule].next+("prismLens"===_this.assessmentModule?_this.assessmentToken:""),{questionNum:_this.currentQuestion.number,ans:answerList}).then(function(response){void 0===response.question&&(window.location=assessmentConfig.services[_this.assessmentModule].redirect),_this.randomAnswersList=null,_this.currentQuestion=response.question,$(window).width()<1e3&&null!==_this.templateType&&_this.templateType!==_this.currentQuestion.type+_this.currentQuestion.optionsList.length&&showInstructionsOverlay(),$(window).width()>1e3&&null!==_this.templateType&&_this.templateType!==_this.currentQuestion.type+_this.currentQuestion.optionsList.length&&_this.categoriesCount>2?(_this.leftAnimation=!0,leftIconAnimations()):_this.leftAnimation=!1,setupTemplate(response.question.type+response.question.optionsList.length,_this.currentQuestion.categoryNumber),_this.randomAnswersList=randomizeAnswers(_this.currentQuestion.optionsList,_this.currentQuestion.type+_this.currentQuestion.optionsList.length),_this.completedAnswers+=1,trackProgress(),$rootScope.$broadcast("previousFlag",_this.completedAnswers),_this.isPrevious&&(_this.isPrevious=!1),$timeout(function(){_this.nextEnable=!0},500)})}function previousQuestion(){_this.isPrevious=!0,_this.nextEnable=!1,_this.leftAnimation=!1,assessmentService.previous("previous",assessmentConfig.services[_this.assessmentModule].previous+("prismLens"===_this.assessmentModule?_this.assessmentToken:"")).then(function(response){switch(_this.randomAnswersList=null,_this.currentQuestion=response.question,_this.lastAnswer=response.lastAnswer,setupTemplate(response.question.type+response.question.optionsList.length,_this.currentQuestion.categoryNumber),_this.randomAnswersList=[],response.question.type+response.question.optionsList.length){case"Rating4":case"Rating3":for(var i=0;i<_this.lastAnswer.length;i++)for(var j=0;j<response.question.optionsList.length;j++){var answer=response.question.optionsList[j];answer.id===_this.lastAnswer[i]&&_this.randomAnswersList.push(answer)}break;case"MultipleChoice2":case"MultipleChoice4":_this.randomAnswersList=angular.copy(response.question.optionsList),_this.chooseAnswerId=_this.lastAnswer[0],$timeout(function(){$("#"+_this.lastAnswer[0]).addClass("on")},200);break;case"PersonalityRating4":for(var k=0;k<response.question.optionsList.length;k++){var mlAnswer=response.question.optionsList[k];-1===_this.lastAnswer.indexOf(mlAnswer.id)&&_this.randomAnswersList.push(mlAnswer)}for(var l=0;l<response.question.optionsList.length;l++){var mlAnswer1=response.question.optionsList[l];_this.lastAnswer[0]===mlAnswer1.id&&_this.randomAnswersList.unshift(mlAnswer1),_this.lastAnswer[1]===mlAnswer1.id&&_this.randomAnswersList.push(mlAnswer1)}}_this.completedAnswers-=1,trackProgress(),$timeout(function(){_this.nextEnable=!0},500)})}function getCategoryInstruction(questionCategoryNo){var list=_this.categoryInfo,instruction=null;if(void 0!==questionCategoryNo&&null!==questionCategoryNo&&""!==questionCategoryNo||"prismLens"===_this.assessmentModule){if(void 0!==questionCategoryNo&&null!==questionCategoryNo&&""!==questionCategoryNo||"prismLens"!==_this.assessmentModule){for(var i=0;i<list.length;i++)if(list[i].number===questionCategoryNo){instruction=list[i].instruction;break}}else instruction=list[0].instruction;_this.categoryInstruction=instruction}}function getDefinition(key){if(void 0!==key&&null!==key&&""!==key){var formatKey=key.replace(/ /g,"").replace(/-/g,"");return"prismLens"===_this.assessmentModule?$rootScope.pullInterNationalization("assessmentDefinitionsLens."+formatKey):$rootScope.pullInterNationalization("assessmentDefinitions."+formatKey)}}function initDrag(elementId){var el=document.getElementById(elementId);void 0!==el&&null!==el&&""!==el&&Sortable.create(el,{ghostClass:"sortable-ghost",scroll:!1,animation:300})}function layoutSetup(){$timeout(function(){$(".assessment-col-layout").css({height:$(window).height()-95+"px"})},100)}function trackProgress(){var list=_this.categoryInfo,totalQuestionsCount=0;list.map(function(e){totalQuestionsCount+=e.totalQuestions}),_this.completionProgress=Math.floor(_this.completedAnswers/totalQuestionsCount*100),_this.isFinish=totalQuestionsCount-_this.completedAnswers==1,$(".assessment-progress-tracker").animate({width:"+"+_this.completionProgress+"%"})}function randomizeAnswers(list,type){if("MultipleChoice4"===type)return list;var randomMaxCounter=list.length,updateAnswerList=angular.copy(list),tempList=[],randomIndex=0;return angular.forEach(list,function(val,index){randomIndex=Math.floor(Math.random()*randomMaxCounter),randomMaxCounter--,tempList=updateAnswerList[randomMaxCounter],updateAnswerList[randomMaxCounter]=updateAnswerList[randomIndex],updateAnswerList[randomIndex]=tempList}),updateAnswerList}function setupTemplate(type,questionCategoryNo){var iName,iDesc,templateUrl=null;switch(type){case"Rating4":case"Rating3":templateUrl=assessmentConfig.templates.rank,iName="icon-assessment_rank_new",iDesc=$rootScope.pullInterNationalization("assessment.rank");break;case"MultipleChoice2":templateUrl=assessmentConfig.templates.choose,iName="icon-assessment_page_choose",iDesc=$rootScope.pullInterNationalization("assessment.choose");break;case"MultipleChoice4":templateUrl=assessmentConfig.templates.whoRu,iName="icon-assessment_most-least",iDesc=$rootScope.pullInterNationalization("assessment.who");break;case"PersonalityRating4":templateUrl=assessmentConfig.templates.mostLeast,iName="icon-assessment_mostleast_new",iDesc=$rootScope.pullInterNationalization("assessment.mostLeast")}$timeout(function(){_this.getCategoryInstruction(questionCategoryNo),_this.templateType=type,_this.iconName=iName,_this.iconDesc=iDesc},_this.leftAnimation?700:0),changeTemplates(templateUrl)}function changeTemplates(templateName){$("#assessment-template-container").html(""),$templateRequest(templateName).then(function(html){var _html=$compile(angular.element(html))(scope);$("#assessment-template-container").html(_html)})}function start(){void 0!==sharedProperties.getParam("type")&&null!==sharedProperties.getParam("type")&&""!==sharedProperties.getParam("type")?_this.assessmentType=sharedProperties.getParam("type"):void 0!==$(element[0]).parent().attr("data-type")&&null!==$(element[0]).parent().attr("data-type")&&""!==$(element[0]).parent().attr("data-type")?_this.assessmentType=$(element[0]).parent().attr("data-type"):_this.assessmentType="All";var paramObj="",totalQuestionsCount=0;"prismLens"!==_this.assessmentModule&&"Default"!==_this.assessmentType&&(paramObj={type:_this.assessmentType}),_this.randomAnswersList=null,_this.nextEnable=!1,assessmentService.next("start",assessmentConfig.services[_this.assessmentModule].start+("prismLens"===_this.assessmentModule?_this.assessmentToken:""),paramObj).then(function(response){_this.currentQuestion=response.question,_this.categoryInfo=response.categories,_this.completedAnswers=response.answeredCount,_this.categoryInfo.map(function(e){totalQuestionsCount+=e.totalQuestions}),null===_this.currentQuestion||""===_this.currentQuestion||void 0===_this.currentQuestion?window.location.href="/sp/":(_this.categoriesCount=_this.categoryInfo.map(function(e){return e.type}).unique().length,$(window).width()<1e3&&showInstructionsOverlay(),setupTemplate(response.question.type+response.question.optionsList.length,_this.currentQuestion.categoryNumber),_this.randomAnswersList=randomizeAnswers(_this.currentQuestion.optionsList,_this.currentQuestion.type+_this.currentQuestion.optionsList.length),trackProgress(),$rootScope.$broadcast("previousFlag",_this.completedAnswers),$timeout(function(){_this.nextEnable=!0},600))})}function showInstructionsOverlay(){$(".new-assessment-layout").hide().addClass("show-instruction"),_this.showContinueText=!1,$("#assessmentResponsiveInfo").trigger("click"),$("#instructionPopClose").hide()}function responsiveEvents(){var scrollVal=0;$("#assessmentResponsiveInfo").off("click").on("click",function(e){scrollVal=$("body").scrollTop().valueOf(),$(".new-assessment-layout").hide(),$("body").scrollTop(0),$("#instruction-popup").css({width:$(window).width()+"px",height:$(window).height()-53+"px"}),$("#instructionPopClose").show(),$("#instruction-popup").fadeIn(),$("#assessmentResponsivePrevious").length&&!$("#assessmentResponsivePrevious").hasClass("disabled")&&$("#assessmentResponsivePrevious").addClass("disabled overlayDisabled")}),$(".instructionClose").off("click").on("click",function(e){$(".new-assessment-layout").css({opacity:0}).show(),scrollVal>0&&$("body").scrollTop(scrollVal),$(".new-assessment-layout").css({opacity:1}),$("#instruction-popup").fadeOut({complete:function(){_this.showContinueText||$timeout(function(){scope.$apply(function(){_this.showContinueText=!0})},50)}}),$("#assessmentResponsivePrevious").length&&$("#assessmentResponsivePrevious").hasClass("disabled")&&$("#assessmentResponsivePrevious").hasClass("overlayDisabled")&&(_this.completedAnswers>0?$("#assessmentResponsivePrevious").removeClass("disabled overlayDisabled"):$("#assessmentResponsivePrevious").removeClass("overlayDisabled")),$(".new-assessment-layout").hasClass("show-instruction")&&$(".new-assessment-layout").show().removeClass("show-instruction")})}function init(){$(window).width()<1e3&&responsiveEvents(),layoutSetup(),start()}var _this=scope,url=window.location.href.split("/");_this.assessmentModule=void 0!==$(element[0]).parent().attr("data-module")&&null!==$(element[0]).parent().attr("data-module")&&""!==$(element[0]).parent().attr("data-module")?$(element[0]).parent().attr("data-module"):"default",_this.assessmentType="",_this.assessmentToken=url[url.length-1],_this.currentQuestion={},_this.randomAnswersList=[],_this.responseReceived=!1,_this.iconName=null,_this.iconDesc=null,_this.templateType=null,_this.isPrevious=!1,_this.nextEnable=!1,_this.isFinish=!1,_this.completionProgress=0,_this.completedAnswers=0,_this.showContinueText=!0,_this.leftAnimation=!1,_this.categoryInstruction=null,_this.categoriesCount=0,_this.finishFlagForChoose=!1,_this.getCategoryInstruction=getCategoryInstruction,_this.getDefinition=getDefinition,_this.initDrag=initDrag,_this.nextQuestion=nextQuestion,_this.previousQuestion=previousQuestion,_this.callToActions=callToActions,_this.chooseFinish=chooseFinish,_this.templateActions=templateActions,_this.leftIconAnimations=leftIconAnimations;scope.$on("assessmentPreviousRequest",function(){_this.previousQuestion()});init()}}}]),angular.module("spApp").directive("assessmentStartPage",["sharedProperties","$rootScope","ngDialog","$localStorage","$timeout",function(sharedProperties,$rootScope,ngDialog,$localStorage,$timeout){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/assessment/"+attrs.urlSrc},link:function(scope,element,attrs){function openVideo(url){sharedProperties.fireAnalyticsEvent("Assessment | Watch Intro Video","N/A"),sharedProperties.videoPopUp(url)}function init(){if($(".assessment-start-cols").css({height:$(window).height()-130+"px"}),null!==_this.setParam&&""!==_this.setParam&&void 0!==_this.setParam){var url=window.location.href+"?lang="+_this.setParam;$timeout(function(){sessionStorage.clear(),$localStorage.flush(),window.location=url},100)}}var _this=scope;_this.openVideo=openVideo,_this.setParam=sessionStorage.getItem("langParam"),angular.element(document).ready(function(){init(),$(".left-sec-animation").animate({marginTop:0,opacity:1},{queue:!1,duration:150,complete:function(){$(".right-sec-animation").animate({paddingTop:40,opacity:1},{queue:!1,duration:100,complete:function(){$(".play-btn-animate").animate({marginTop:15},{queue:!1,duration:150}),$(".vid-txt-animate").animate({paddingTop:0},{queue:!1,duration:150})}})}}),$(".txt-animation").animate({opacity:1},{queue:!1,duration:100})})}}}]),angular.module("spApp").directive("assessmentResponsiveHeader",["sharedProperties","$rootScope","ngDialog","$localStorage","$timeout","assessmentService","assessmentConfig",function(sharedProperties,$rootScope,ngDialog,$localStorage,$timeout,assessmentService,assessmentConfig){return{restrict:"EA",replace:!0,link:function(scope,element,attrs){var scrollVal=0;scope.headerDisablePrevious=!1;scope.$on("previousFlag",function(e,data){scope.headerDisablePrevious=data<1});angular.element(document).ready(function(){$("#assessmentResponsivePrevious").off("click").on("click",function(e){e.preventDefault(),$(this).hasClass("disabled")||($rootScope.$broadcast("assessmentPreviousRequest"),scope.headerDisablePrevious=!0)}),$("#assessment-menu").css({right:"-"+$(window).width()+"px",width:$(window).width()+"px",height:$(window).height()-50+"px"}),$("#assessmentResponsiveMenu").off("click").on("click",function(e){$(this).hasClass("open")?($(this).removeClass("open").addClass("icon-assessment_hamburger").removeClass("icon-assessment_close"),$("#assessment-menu").animate({right:-$(window).width()},{queue:!1,duration:200,complete:function(){$(this).css({display:"none"}),$(".new-assessment-layout").css({opacity:0}).show(),scrollVal>0&&$("body").scrollTop(scrollVal),$(".new-assessment-layout").css({opacity:1})}}),$("#assessmentResponsivePrevious").length&&$("#assessmentResponsivePrevious").hasClass("disabled")&&$("#assessmentResponsivePrevious").hasClass("overlayDisabled")&&$("#assessmentResponsivePrevious").removeClass("disabled overlayDisabled")):($(this).removeClass("icon-assessment_hamburger").addClass("icon-assessment_close"),scrollVal=$("body").scrollTop().valueOf(),$(".new-assessment-layout").hide(),$("body").scrollTop(0),$("#assessmentResponsivePrevious").length&&!$("#assessmentResponsivePrevious").hasClass("disabled")&&$("#assessmentResponsivePrevious").addClass("disabled overlayDisabled"),$(this).addClass("open"),$("#assessment-menu").css({display:"block"}).animate({right:0},{queue:!1,duration:200}))})})}}}]);