function tutorialAdmin($compile,$templateRequest,sharedProperties,$rootScope,ajaxService,$localStorage,ngDialog,$timeout,$state){var controller=function($scope){function previewTutorial(){ngDialog.open({template:"/sp/resources/html/sysAdmin/tutorial/preview.html",scope:$scope})}function deleteTaskModal(stepId){self.deleteStepId=stepId,ngDialog.open({template:"/sp/resources/html/sysAdmin/tutorial/delete-step-modal.html",scope:$scope})}function deleteActionPlanOrStep(){sharedProperties.spilceIndexWithBreak(self.actionPlan.steps,"id",self.deleteStepId),ngDialog.close(),sharedProperties.growlMessage("Step Deleted. Save the Tutorial.."),self.currentActionPlan=0,self.changeActionPlan(0)}function stepTypeChange(){self.actionPlan.steps.filter(function(e){return"All"===self.actionPlan.stepType?e.status="ACTIVE":(e.status="ACTIVE",e.durationDays=0)})}function clearOption(options){options.url="",options.linkText="",options.imageLink="",options.altText=""}function leftSectionHeight(){var practiceArea=$(".introduction-area").width(),left=$(".introduction-area").find(".image_intro img").outerWidth(),total=left/practiceArea*100;self.adjustedWidth=96-total+"%",self.imageSize=total+"%"}function practiceAreaSort(length){if(!self.actionBool&&length>1){new Sortable121(document.getElementById("sort-practice-area"),{group:"name",animation:150,ghostClass:"ghost",handle:".practiceHandle",yAxisOnly:!0,onEnd:function(evt){self.actionPlan.steps.move(evt.oldIndex,evt.newIndex),self.currentActionPlan=evt.newIndex}});self.actionBool=!0}}function initialize(){if(!self.initializeBool){new Sortable121(document.getElementById("sort-me"),{animation:150,ghostClass:"ghost",handle:".dHandle",yAxisOnly:!0,onEnd:function(evt){self.actionPlan.steps[self.currentActionPlan].devStrategyActionCategoryList[0].actionList.move(evt.oldIndex,evt.newIndex)}});self.initializeBool=!0}}function getDetail(){ajaxService.getAjaxResponse({url:self.serviceApis.getAll}).then(function(response){"true"===response.Success?(response.tutorialListing.length?(self.mode="update",getDetailedInfo(response.tutorialListing[0].id)):(self.actionPlan=spTutorialJson(),self.mode="create"),$state.go("adminTutorial"),self.currentPracticeAreaId=void 0,self.currentPracticeListIndex=0,scrollPosition()):null!==response.error&&sharedProperties.ajaxError(response.error)}),$(document).on("imageSaved",function(e,data){$scope.$apply(function(){self.actionPlan.imageUrl=data.imageData})})}function openCloseSiblingContent(event,mode){var $this=$(event.target);if($this.hasClass("filterCheckBox-label"))return!0;var toggleClass=void 0===mode?"show":"noshow",$html=$this.closest(".category"),$upTarget=$html.find(".header-style-content:eq(0)"),$upTargetHeight=$upTarget.outerHeight();$html.find(".border-faq-content:eq(0)").outerHeight();$upTargetHeight>1?$upTarget.css("height",0):$upTarget.css("height","auto"),$html.toggleClass(toggleClass)}function addInputBox(param){for(var i=0;i<param;i++)self.singleBox.push(self.singleBox.length)}function removeInputBox(index){self.singleBox.splice(index,1),self.actionPlan.steps[self.currentActionPlan].keyOutcomes.outcomesList.splice(index,1)}function addLink(actionData,parent){var bool=void 0!==parent&&!parent.permissions.Completion;actionData.push({type:null,linkText:null,url:null,imageLink:null,altText:null,permissions:{Completion:bool}})}function singleAction(actionList){actionList.push({title:"New Task",description:null,timeInMins:0,type:"Single",active:!0,actionData:[],permissions:{Completion:!0}}),self.pageSetting.actions=!0,self.trueCheck()}function deleteActionList(list,index){self.deleteActionListInfo={list:list,index:index},ngDialog.open({template:"/sp/resources/html/sysAdmin/organization/delete-action-list.html",scope:$scope})}function deleteActionListConfirm(){self.deleteActionListInfo.list.splice(self.deleteActionListInfo.index,1),ngDialog.close()}function scrollPosition(){$(".parent-cat").each(function(){$(this).removeClass("show").find(".header-style-content:eq(0)").css("height",0)}),$("html,body").animate({scrollTop:$(".lnd-right-sec").offset().top-80},300)}function changeActionPlan(index){!0===self.viewMode.setting?self.actionPlanSetting.$valid?(self.errorSetting.setting=!1,index>=0?changeSteps(index):self.viewMode={preview:!1,editCreate:!1,setting:!1,step:!0}):(self.submitted=!0,self.errorSetting.setting=!0):self.actionPlanForm.$valid&&trueCheck()?(self.errorSetting.step=!1,-1===index?self.viewMode={preview:!1,editCreate:!1,setting:!0,step:!1}:-2===index?self.viewMode={preview:!1,editCreate:!1,setting:!1,step:!0}:changeSteps(index)):(self.submitted=!0,errorHighlighter(),self.errorSetting.step=!0)}function changeSteps(index){clearError(),self.currentActionPlan=index,self.currentPracticeAreaId=self.actionPlan.steps[index].id,self.currentPracticeListIndex=index,self.singleBox=[0],self.copYactionPlan=self.actionPlan.steps[self.currentActionPlan].devStrategyActionCategoryList,self.viewMode={preview:!1,editCreate:!0,setting:!1,step:!1},scrollPosition(),self.errorSetting.step=!1}function createNewSection(index){self.submitted=!1,self.currentPracticeAreaId=void 0,!0===self.viewMode.setting?self.actionPlanSetting.$valid?newStep(self.actionPlan.steps.length):self.submitted=!0:self.actionPlanForm.$valid&&trueCheck()?newStep(self.actionPlan.steps.length):(self.submitted=!0,errorHighlighter())}function newStep(index){self.actionPlan.steps.push({name:"Step Name",status:"ACTIVE",devStrategyActionCategoryList:[{title:null,helpText:null,status:"ACTIVE",actionList:[{title:"New Task",description:null,timeInMins:0,type:"Single",active:!0,actionData:[],permissions:{Completion:!0}}]}]}),self.currentActionPlan=index,self.currentPracticeListIndex=index,self.singleBox=[0],self.viewMode={preview:!1,editCreate:!0,setting:!1,step:!1},self.copYactionPlan=self.actionPlan.steps[self.currentActionPlan].devStrategyActionCategoryList,scrollPosition()}function errorHighlighter(){trueCheck(),!!self.emptyCheck&&(self.errorCat=!0),self.result.length||(self.errorCat=!0),!self.errorCat||self.result.length&&!self.emptyCheck||(self.submitted=!0)}function errorClass(area){if(!self.submitted)return!1;var $category=$(".category"),count=0;$category.each(function(){$(this).find(".ng-invalid-required,.ng-invalid-pattern").length?($(this).addClass("error-category"),count++):$(this).removeClass("error-category")}),!0===self.viewMode.setting?self.actionPlanSetting.$valid&&(self.errorSetting.setting=!1):self.actionPlanForm.$valid&&trueCheck()&&(self.errorSetting.step=!1),count?self.submitted=!0:self.actionPlanSetting.$valid&&self.actionPlanForm.$valid&&(self.submitted=!1)}function clearError(){self.submitted=!1,self.errorCat=!1,$(".category").each(function(){$(this).removeClass("error-category")})}function redirectToListing(){window.location.reload()}function trueCheck(){return!(self.currentActionPlan>=0)||(self.result=[],self.emptyCheck=0,self.actionPlan.steps[self.currentActionPlan].devStrategyActionCategoryList.filter(function(e,i){"ACTIVE"===e.status&&(self.result.push(e),e.actionList.length||self.emptyCheck++)}),self.result.length&&!self.emptyCheck)}function activeCheck(){return self.atleastOneCheck=["Pass"],"All"!==self.actionPlan.stepType||(self.atleastOneCheck=self.actionPlan.steps.filter(function(e){return"ACTIVE"===e.status}),self.atleastOneCheck.length)}function verifyJson(){return self.errorSetting={setting:!1,step:!1,stepSetting:!1},self.actionPlanForm.$valid&&trueCheck()?self.errorSetting.step=!1:self.errorSetting.step=!0,self.actionPlanSetting.$valid?self.errorSetting.setting=!1:self.errorSetting.setting=!0,allFalsy(self.errorSetting)}function allFalsy(obj){var send=!0;for(var i in obj)!0===obj[i]&&(send=!1);return send}function submitObject(){if(self.disabled)return!0;if(self.submitted=!1,self.errorCat=!1,self.disabled=!0,verifyJson()){var createServiceAPI=self.serviceApis.create,updateServiceAPI=self.serviceApis.update;ajaxService.getAjaxResponse({url:"update"===self.mode?updateServiceAPI:createServiceAPI,data:self.actionPlan,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success){var message="update"===self.mode?"Tutorial Updated":"Tutorial Created";$localStorage.set("planStatus",message),sharedProperties.growlMessage(message),self.disabled=!1,clearError()}else null!==response.error&&(clearError(),self.disabled=!1,sharedProperties.ajaxError(response.error))})}else self.disabled=!1,self.submitted=!0,errorHighlighter()}function requiredCompletion(list,actionList){if("Group"===actionList.type){if("ACTIVE"===list.status&&actionList.active){return!actionList.actionData.filter(function(e){return e.permissions.Completion}).length}return!1}return!1}function countList(list,total){var result=0;return list.filter(function(e){void 0!==e.permissions&&null!==e.permissions&&void 0!==e.permissions.Completion&&!0===e.permissions.Completion&&result++,void 0!==total&&void 0!==e.actionData&&e.actionData.filter(function(e1){void 0!==e1.permissions&&null!==e1.permissions&&void 0!==e1.permissions.Completion&&!0===e1.permissions.Completion&&result++})}),result}function changeCompletion(list,actionList){"Group"===actionList.type&&"ACTIVE"===list.status&&actionList.active&&actionList.actionData.filter(function(e){e.permissions.Completion=!1})}function previewVideo(mode,url){if("Video"===mode)sharedProperties.videoPopUp(url);else if("WebInternal"===mode)window.location.href=url;else if("ActionPlan"===mode)$rootScope.displayActionPanel();else{var win=window.open(url,"_blank");win.focus()}}function previewIntroVideo(url){sharedProperties.videoPopUp(url)}var self=this;self.serviceApis={videoPopUpDialog:"/sp/admin/videoPop",getAll:"/sp/sysAdmin/tutorial/getAll",get:"/sp/sysAdmin/tutorial/get",create:"/sp/sysAdmin/tutorial/create",update:"/sp/sysAdmin/tutorial/update",delete:"/sp/sysAdmin/tutorial/delete"},self.pageSetting={groupText:"",groupNameHolder:[]},self.currentActionPlan=0,self.companiesAjax=!1,self.singleBox=[0],self.linkType=[{name:"VIDEO IN DIALOG",value:"Video"},{name:"VIDEO IN NEW TAB",value:"VideoTab"},{name:"PPT",value:"PPT"},{name:"PDF",value:"PDF"},{name:"WEB",value:"Web"},{name:"SP Internal Link",value:"WebInternal"},{name:"Open Action Plan",value:"ActionPlan"},{name:"Open Private Notes",value:"Private"},{name:"Open Group Discussion",value:"GD"}],self.linkType2=[{name:"VIDEO IN DIALOG",value:"Video"},{name:"VIDEO IN NEW TAB",value:"VideoTab"},{name:"PPT",value:"PPT"},{name:"PDF",value:"PDF"},{name:"WEB",value:"Web"}],self.linkTypeSmall=[{name:"PPT",value:"PPT"},{name:"PDF",value:"PDF"},{name:"WEB",value:"Web"}],self.groupList=[],self.result=[],self.emptyCheck=0,self.clonecompanies=[],self.pageSetting={disabledInfinite:!1,lastPredicate:"name",lastReverse:!1,companyText:"",addedCategory:!1,actions:!1,searchMode:"AP"},self.submitted=!1,self.originalPageSetting=angular.copy(self.pageSetting),self.initializeBool=!1,self.actionBool=!1,self.disabled=!1,self.pool=[],self.viewMode={preview:!1,editCreate:!1,setting:!0,step:!1},self.errorSetting={setting:!1,step:!1,stepSetting:!1},self.orgPlanDeleteOptions={},self.currentPracticeAreaId=void 0,self.currentPracticeListIndex=0,self.cloneEnable=!1,self.atleastOneCheck=["Pass"],self.list={name:null,id:null},self.tinymceOptions={plugins:["link"],toolbar:"bold italic underline | link",height:100},self.deleteStepId=null,self.openCloseSiblingContent=openCloseSiblingContent,self.addInputBox=addInputBox,self.removeInputBox=removeInputBox,self.addLink=addLink,self.singleAction=singleAction,self.deleteActionList=deleteActionList,self.changeActionPlan=changeActionPlan,self.createNewSection=createNewSection,self.redirectToListing=redirectToListing,self.submitObject=submitObject,self.trueCheck=trueCheck,self.requiredCompletion=requiredCompletion,self.changeCompletion=changeCompletion,self.initialize=initialize,self.practiceAreaSort=practiceAreaSort,self.previewVideo=previewVideo,self.previewIntroVideo=previewIntroVideo,self.leftSectionHeight=leftSectionHeight,self.initSize=$(".introduction-area").find(".image_intro img").outerWidth()/$(".introduction-area").width()*100,self.adjustedWidth=96-self.initSize+"%",self.imageSize=self.initSize+"%",self.countList=countList,self.clearOption=clearOption,self.stepTypeChange=stepTypeChange,self.activeCheck=activeCheck,self.deleteTaskModal=deleteTaskModal,self.deleteActionPlanOrStep=deleteActionPlanOrStep,self.deleteActionListConfirm=deleteActionListConfirm,self.errorClass=errorClass,self.getDetail=getDetail,self.previewTutorial=previewTutorial;var spTutorialJson=function(){return{name:"Get Started",description:"Enter Tutorial Description",imgUrl:"/resources/css/css-min/images/ra-back.png",steps:[{name:"Step Name",status:"ACTIVE",devStrategyActionCategoryList:[{title:null,helpText:null,status:"ACTIVE",actionList:[{title:"New Task",description:null,timeInMins:0,type:"Single",active:!0,actionData:[],permissions:{Completion:!0}}]}]}]}},getDetailedInfo=function(id){ajaxService.getAjaxResponse({url:self.serviceApis.get,data:$.param({id:id})}).then(function(response){"true"===response.Success?(self.actionPlan=response.tutorial,self.copYactionPlan=self.actionPlan.steps[self.currentActionPlan].devStrategyActionCategoryList):null!==response.error&&sharedProperties.ajaxError(response.error)})};self.selectThumbImage=function(videoObj,type){$rootScope.showMediaManager=!0;var destroyRoot=$scope.$on("mediaData",function(e,data){if(destroyRoot(),null===data)return!0;switch(type){case"introImage":videoObj.imgUrl=data.url,videoObj.imageAltText=videoObj.imageAltText||data.altText;break;case"imageLink":videoObj.linkurl=data.url,videoObj.linkText=videoObj.linkText||data.name;break;case"imageUrl":videoObj.thumbnailURL=data.url,videoObj.title=videoObj.title||data.name;break;case"groupLink":videoObj.mediaUrl=data.url;break;case"groupImage":videoObj.mediaImageLink=data.url,videoObj.mediaAltText=videoObj.mediaAltText||data.altText;break;case"thumbnailURL":videoObj.imageLink=data.url,videoObj.altText=videoObj.altText||data.altText,"Video"!==videoObj.type&&"VideoTab"!==videoObj.type||(videoObj.linkText=videoObj.linkText||data.name);break;case"linkAction":"Video"===videoObj.type||"VideoTab"===videoObj.type?(videoObj.imageLink=data.url,videoObj.altText=videoObj.altText||data.altText,videoObj.linkText=videoObj.linkText||data.name):(videoObj.url=data.url,videoObj.linkText=videoObj.linkText||data.name);break;case"taskImage":videoObj.mediaImageLink=data.url,videoObj.mediaAltText=data.altText;break;default:videoObj.thumbnailURL=data.url}})}};return controller.$inject=["$scope"],{restrict:"EA",link:function($scope,$element,$attrs){$templateRequest("/sp/resources/html/"+$attrs.urlSrc).then(function(html){var template=angular.element(html);$element.append(template),$compile(template)($scope)})},controller:controller,controllerAs:"ctrl",bindToController:!0}}angular.module("spApp").directive("tutorialAdmin",tutorialAdmin),tutorialAdmin.$inject=["$compile","$templateRequest","sharedProperties","$rootScope","ajaxService","$localStorage","ngDialog","$timeout","$state"];