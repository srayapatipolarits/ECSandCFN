function memberAccountsController($scope,$element,$attrs,$http,ngDialog,$timeout,ajaxService,sharedProperties,$localStorage,$rootScope){function updateRemainingDays(days){var totalMonths=Math.floor(days/30),totalDays=days%30;return totalMonths>=1?totalMonths+" Months "+totalDays+" Days":"0 Months "+totalDays+" Days"}function processCredit(){_this.creditErrors=null,_this.creditFormSubmit=!1,_this.creditSubmitErrors=!1,_this.addCreditForm.$valid?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addCredit",data:$.param({accountId:_this.accountId,chargeAmount:_this.creditInfo.amount,paymentType:_this.creditInfo.cpt,comment:_this.creditInfo.ccomment,spPlanType:_this.currentPlanInfo.planType})}).then(function(response){if("true"===response.Success)_this.getAccountInfo(!0),_this.currentPlanInfo={},ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("billing.amoutcred"));else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response[key];_this.creditSubmitErrors=!0,_this.creditErrors=errorMessage}}):_this.creditFormSubmit=!0}function showAddCredit(planType){_this.creditFormSubmit=!1,_this.creditInfo={},_this.currentPlanInfo={planType:planType,term:_this.planDetails[planType].agreementTerm,paymentType:_this.planDetails[planType].paymentType,expiry:_this.planDetails[planType].planInfo.expiresTime,balance:_this.planDetails[planType].creditBalance},ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/addCreditsBilling.html",scope:$scope})}function toggleOverrideField(type){"Member"===type?(!1===_this.memberOverrideCheckbox?(_this.memberOverrideCheckbox=!0,_this.signup.memberPrice=_this.editSignup.memberPrice):(_this.memberOverrideCheckbox=!1,_this.signup.overrideMemberAmount=""),_this.updateMemberAccountSummary("Member")):(!1===_this.adminOverrideCheckbox?(_this.adminOverrideCheckbox=!0,_this.signup.adminPrice=_this.editSignup.adminPrice):(_this.adminOverrideCheckbox=!1,_this.signup.overrideAdminAmount=""),_this.updateMemberAccountSummary("Admin"))}function updateMemberAccountSummary(type){"Member"===type?_this.memberOverrideCheckbox?(_this.signup.memberTotalAmount=_this.signup.overrideMemberAmount,_this.updateTotalPerMonth()):(_this.signup.memberTotalAmount=parseInt(_this.signup.memberCount)*parseFloat(_this.signup.memberPrice),_this.updateTotalPerMonth()):_this.adminOverrideCheckbox?(_this.signup.adminTotalAmount=_this.signup.overrideAdminAmount,_this.updateTotalPerMonth()):(_this.signup.adminTotalAmount=parseInt(_this.signup.adminCount)*parseFloat(_this.signup.adminPrice),_this.updateTotalPerMonth())}function updateTotalPerMonth(){_this.totalChargesPerMonth=0,_this.totalChargesPerMonth+=null!==_this.signup.adminTotalAmount&&void 0!==_this.signup.adminTotalAmount&&_this.signup.adminTotalAmount>0?_this.signup.adminTotalAmount:0,_this.totalChargesPerMonth+=null!==_this.signup.memberTotalAmount&&void 0!==_this.signup.memberTotalAmount&&_this.signup.memberTotalAmount>0?_this.signup.memberTotalAmount:0,_this.proRatedPriceUpdater()}function getAccountInfo(isAddCredit){var option="user"===_this.accType?{url:"/sp/admin/account/businessAccountDetails"}:{url:"/sp/sysAdmin/alternateBilling/account/businessAccountDetails",data:$.param({accountId:sharedProperties.getParam("accountId")})};ajaxService.getAjaxResponse(option).then(function(response){if("true"===response.Success)isAddCredit?(_this.account.account.spPlans.Primary.creditBalance=response.account.spPlans.Primary.creditBalance,$scope.account.account.spPlans.Primary.creditBalance=response.account.spPlans.Primary.creditBalance):($scope.account=response,_this.account=response,_this.accountDetails=response.account,_this.companyDetails=response.company,_this.planDetails=response.account.spPlans,_this.memberOverrideCheckbox=!0,_this.adminOverrideCheckbox=!0,_this.signup={},_this.signup={memberPrice:_this.account.account.spPlans.Primary.unitMemberPrice,adminPrice:_this.account.account.spPlans.Primary.unitAdminPrice},_this.cycleMultiplier="Custom"!==_this.account.account.spPlans.Primary.planInfo.planBillingCycleType?parseInt(billingMonths[_this.account.account.spPlans.Primary.planInfo.planBillingCycleType.toLowerCase().replace("-","")]):parseInt(_this.account.account.spPlans.Primary.planInfo.planBillingCycle),_this.editSignup=angular.copy(_this.signup));else{_this.serverError=!0;for(var key in response.error)_this.errorMessage=response.error[key]}})}function cancelRedirect(){window.location="user"===_this.accType?"/sp/admin/account/business":"/sp/sysAdmin/alternateBilling/viewDetailAccount?accountId="+_this.account.account.id}function validateSendResponse(signup){_this.formSubmitted=!1;var _data=$("#accountsBillingStep2 :not(.serialize-ignore)").serialize();if(signup.$valid)_this.formSubmitted=!1,ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addMemberAccounts",data:_data}).then(function(response){"true"===response.Success?(_this.sfailure=!1,$localStorage.set("addMembers","Member(s) added successfully !"),window.location="/sp/sysAdmin/alternateBilling/viewDetailAccount?accountId="+sharedProperties.getParam("accountId")):null!=response.error&&(_this.failure=response.error,_this.sfailure=!0)});else{_this.formSubmitted=!0;var elem=angular.element($element);$(elem).find("form .ng-invalid:first").length&&$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300)}}function initAddMemberAccoutns(mode,type){_this.mode=mode,_this.accType=type,_this.getAccountInfo()}function proRatedPriceUpdater(){_this.proRatedFinalPrice=0;var remainigDays=_this.account.account.spPlans.Primary.remainingChargableDays;_this.proRatedFinalPrice=parseFloat(_this.totalChargesPerMonth/30*remainigDays).toFixed(2),_this.proRatedFinalPrice=Math.round(_this.proRatedFinalPrice)}var _this=this,billingMonths={monthly:1,quaterly:3,semiannually:6,anually:12};_this.signup={},_this.account={},_this.editSignup={},$scope.creditInfo={},_this.signup.adminTotalAmount=0,_this.signup.memberTotalAmount=0,_this.totalChargesPerMonth=0,_this.proRatedFinalPrice=0,_this.memberOverrideCheckbox=!1,_this.adminOverrideCheckbox=!1,_this.serverError=!1,_this.formSubmitted=!1,_this.sfailure=!1,_this.addCreditForm={},_this.creditInfo={},_this.creditFormSubmit=!1,_this.currentPlanInfo={},_this.creditErrors=null,_this.step2Errors=null,_this.serverErrors=!1,_this.creditSubmitErrors=!1,_this.accountId=sharedProperties.getParam("accountId"),_this.toggleOverrideField=toggleOverrideField,_this.updateMemberAccountSummary=updateMemberAccountSummary,_this.updateTotalPerMonth=updateTotalPerMonth,_this.getAccountInfo=getAccountInfo,_this.cancelRedirect=cancelRedirect,_this.initAddMemberAccoutns=initAddMemberAccoutns,_this.validateSendResponse=validateSendResponse,_this.proRatedPriceUpdater=proRatedPriceUpdater,_this.showAddCredit=showAddCredit,_this.processCredit=processCredit,_this.updateRemainingDays=updateRemainingDays}function addCreditControler($scope,$element,$attrs,$http,ngDialog,$timeout,ajaxService,sharedProperties,$localStorage){$scope.finalAmount=0,$scope.account={},$scope.currentMemberCount=0,$scope.zeroError=!1,$scope.submitDisabled=!1,$scope.submitted=!1,$scope.signup={},$scope.fnDone=!1,$scope.getAccountInfo=function(){ajaxService.getAjaxResponse({url:"BUSINESS"===$scope.mode?"/sp/sysAdmin/alternateBilling/account/businessAccountDetails":"/sp/sysAdmin/alternateBilling/account/individualAccountDetails",data:$.param({accountId:sharedProperties.getParam("accountId")})}).then(function(response){if("true"===response.Success)$scope.account=response,$scope.cBalance=response.account.creditBalance,$timeout(function(){$scope.fnDone=!0},100);else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getProductInfo=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/getCurrentProductInfo",data:$.param({accountId:$scope.account.account.id,productType:$scope.mode})}).then(function(response){"true"===response.Success&&($scope.product=response,$scope.promotionDiscount=void 0!==$scope.product.promotion?$scope.product.promotion.unitPrice*$scope.account.account.productInfo.availalbeMemberSubscriptions:0)})},$scope.cancelRedirect=function(mode){window.location="/sp/sysAdmin/alternateBilling/viewDetailAccount"+mode+"?accountId="+$scope.account.account.id},$scope.initAddMemberAccoutns=function(mode){$scope.mode=mode,$scope.fnDone=!1,$scope.getAccountInfo()},$scope.addCredit=function(form,page){$scope.submitted=!1,this.spSubscribe.$valid&&"0"!==this.amount?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addCredit",data:$.param({accountId:$scope.account.account.id,chargeAmount:$scope.amount,paymentType:$scope.signup.cpt,comment:$scope.signup.ccomment})}).then(function(response){if("true"===response.Success)$scope.fnDone=!1,$scope.getAccountInfo(),$scope.fnDone&&("member"===page?$scope.ctrl.account.account.creditBalance=$scope.cBalance:"step2"===page?$scope.$apply(function(){$scope.$parent.account.account.creditBalance=$scope.cBalance}):"view"===page&&$scope.$apply(function(){$scope.$parent.accountDetails.creditBalance=$scope.cBalance})),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Amount</strong>",message:" Credited"});else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}}):$scope.submitted=!0}}angular.module("spApp").controller("memberAccountsController",memberAccountsController),angular.module("spApp").controller("addCreditControler",addCreditControler),memberAccountsController.$inject=["$scope","$element","$attrs","$http","ngDialog","$timeout","ajaxService","sharedProperties","$localStorage"],addCreditControler.$inject=["$scope","$element","$attrs","$http","ngDialog","$timeout","ajaxService","sharedProperties","$localStorage"];