function spectrumPAController($scope,ajaxService,$localStorage,$timeout,$rootScope,ngDialog,$state,sharedProperties,spConfig){function animate(){$("html,body").animate({scrollTop:$(".spectrum-filter-toggle").offset().top-80},300)}function calculateHeight(event){var obj=$("#"+event);obj.height()>vm.pageSetting.heightParam&&obj.addClass("scroller")}function init(){$localStorage.remove("activeView","portraitId"),vm.routeToState(sharedProperties.getParam("type")||"profile"),$state.go("visual")}function filterOpen(state){vm.userType="All",vm.routeToState(state),$("html,body").animate({scrollTop:$(".spectrum-filter-toggle").offset().top-80},300)}function routeToState(state){if(vm.viewBox[state])return!0;switch(vm.noData=!1,vm.pageSetting=angular.copy(vm.originalPageSetting),vm.routeStateMode=state,vm.chartDataReady=!1,state){case"profile":Object.keys(vm.personalityBalance).length?vm.profileBalanceFilterLogic():vm.getProfileBalance(),vm.moduleNameForAnalytics="PERSONALITY BALANCE",vm.filterNameForAnalytics="Groups";break;case"analytics":Object.keys(vm.analytics).length?vm.ertAnalyticFilterLogic():vm.getErtAnalytics(),vm.moduleNameForAnalytics="ERT-i ANALYTICS",vm.filterNameForAnalytics="Personality";break;case"insights":Object.keys(vm.insights).length?vm.ertInsightsFilterLogic():vm.getErtInsights(),vm.moduleNameForAnalytics="ERT-i INSIGHTS",vm.filterNameForAnalytics="Traits & Attributes"}sharedProperties.fireAnalyticsEvent("PA Spectrum | View Module",vm.moduleNameForAnalytics)}function available(a,b){var result=0;breakAvailable:for(var i=0;i<b.length;i++)for(var j=0;j<a.length;j++)if(b[i]===a[j]){result=1;break breakAvailable}return result}function inBetween(age,number){for(var result=0,i=0;i<number.length;i++){var splitNumber=number[i].split("-");age>=splitNumber[0]&&age<=splitNumber[1]&&result++}return result}function stateMode(){switch(vm.routeStateMode){case"profile":vm.profileBalanceFilterLogic();break;case"insights":vm.ertInsightsFilterLogic();break;case"analytics":vm.ertAnalyticFilterLogic()}}function returnClampName(name,length){return name=name.length>length?name.substring(0,length)+"...":name}function getProfileBalance(){ajaxService.getAjaxResponse({url:vm.config.getProfileBalance}).then(function(response){"true"===response.Success?(vm.personalityBalance=response.profileBalance,buildMasterDataSet()):null!=response.error&&(vm.profileChartNoData=!0,vm.noData=!0,vm.viewBox={profile:!0,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!1,engagement:!1},sharedProperties.ajaxError(response.error))})}function getErtInsights(){ajaxService.getAjaxResponse({url:vm.config.getErtInsights}).then(function(response){"true"===response.Success?(vm.insights=response.eritInsights,vm.ertInsightsFilterLogic()):null!=response.error&&(vm.profileChartNoData=!0,vm.noData=!0,vm.viewBox={profile:!1,blueprint:!1,insights:!0,org:!1,analytics:!1,competency:!1,engagement:!1},sharedProperties.ajaxError(response.error))})}function getErtAnalytics(){ajaxService.getAjaxResponse({url:vm.config.getErtAnalytics}).then(function(response){"true"===response.Success?(vm.analytics=response.ertiAnalytics,vm.ertAnalyticFilterLogic()):null!=response.error&&(vm.profileChartNoData=!0,vm.noData=!0,vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!0,competency:!1,engagement:!1},sharedProperties.ajaxError(response.error))})}function ertOrderBy(sort){vm.analyticsGraphData.sort(function(a,b){var an=a.percent,bn=b.percent,ap=a.power,bp=b.power,af=a.firstName,bf=b.firstName;switch(sort){case"plus":return an===bn?ap===bp?af===bf?0:+(af>bf)||-1:+(bp>ap)||-1:+(bn>an)||-1;case"minus":return an===bn?ap===bp?af===bf?0:+(af>bf)||-1:+(ap>bp)||-1:+(an>bn)||-1}})}function mapToTriat(){var checkvalue=2===arguments.length?0:50;vm.pageSetting.allTrait.hasOwnProperty(arguments[0])?(vm.pageSetting.allTrait[arguments[0]][arguments[1]]={currentValue:checkvalue,checked:!1},void 0!==arguments[2]&&(vm.pageSetting.allTrait[arguments[0]][arguments[2]]={currentValue:checkvalue,checked:!1})):(vm.pageSetting.allTrait[arguments[0]]={},vm.pageSetting.allTrait[arguments[0]][arguments[1]]={currentValue:checkvalue,checked:!1},void 0!==arguments[2]&&(vm.pageSetting.allTrait[arguments[0]][arguments[2]]={currentValue:checkvalue,checked:!1}))}function calucalteTiltGraph(){var bigData=(parseInt(vm.pageSetting.allTrait.Personality.Powerfull.currentValue,10)+parseInt(vm.pageSetting.allTrait.Personality.Versatile.currentValue,10))/2,detail=(parseInt(vm.pageSetting.allTrait.Personality.Precise.currentValue,10)+parseInt(vm.pageSetting.allTrait.Personality.Adaptable.currentValue,10))/2,mission=(parseInt(vm.pageSetting.allTrait.Personality.Powerfull.currentValue,10)+parseInt(vm.pageSetting.allTrait.Personality.Precise.currentValue,10))/2,relational=(parseInt(vm.pageSetting.allTrait.Personality.Versatile.currentValue,10)+parseInt(vm.pageSetting.allTrait.Personality.Adaptable.currentValue,10))/2;0===bigData&&0===detail&&0===mission&&0===relational?(vm.tilt.big=100,vm.tilt.detail=0,vm.tilt.mission=100,vm.tilt.relational=0):(bigData===detail?(vm.tilt.big=50,vm.tilt.detail=50):(vm.tilt.big=100-Math.round(bigData/(bigData+detail)*100),vm.tilt.detail=Math.round(detail/(bigData+detail)*100)),mission===relational?(vm.tilt.mission=50,vm.tilt.relational=50):(vm.tilt.mission=100-Math.round(mission/(mission+relational)*100),vm.tilt.relational=Math.round(relational/(mission+relational)*100)))}function conflictManagerChecked(category,name,name1,area){var primary=vm.pageSetting.allTrait[category][name].currentValue,secondary=vm.pageSetting.allTrait[category][name1].currentValue,checked=vm.pageSetting.allTrait[category][name].checked,existence=vm.pageSetting.traitSelectedOrder.indexOf(category),regExp=new RegExp(category,"g"),existenceCheck=vm.pageSetting.traitSelectedOrder.toString().match(regExp),existenceCount=null!==existenceCheck&&existenceCheck.length>1,lastIndex=existenceCount?vm.pageSetting.traitSelectedOrder.lastIndexOf(category):-1;checked?(0===primary||null===primary?(lastIndex>-1&&(area.splice(lastIndex,1),vm.pageSetting.traitSelectedOrder.splice(lastIndex,1)),existence>-1&&(area.splice(existence,1),vm.pageSetting.traitSelectedOrder.splice(existence,1))):null!==secondary&&primary===secondary&&(secondary=null,vm.pageSetting.allTrait[category][name1].currentValue=null),0!==primary&&null!==primary&&(primary.length&&existence>-1?area[existence]=primary:primary.length&&-1===existence&&(area.push(primary),vm.pageSetting.traitSelectedOrder.push(category))),null!==primary&&null!==secondary&&primary.length&&secondary.length?lastIndex>-1?area[lastIndex]=secondary:-1===lastIndex&&(area.push(secondary),vm.pageSetting.traitSelectedOrder.push(category)):null===primary||!primary.length||null!==secondary&&secondary.length||lastIndex>-1&&(area.splice(lastIndex,1),vm.pageSetting.traitSelectedOrder.splice(lastIndex,1))):existence>-1&&(lastIndex>-1&&(area.splice(lastIndex,1),vm.pageSetting.traitSelectedOrder.splice(lastIndex,1)),area.splice(existence,1),vm.pageSetting.traitSelectedOrder.splice(existence,1)),sharedProperties.fireAnalyticsEvent("PA Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+(null!==primary&&0!==primary?primary:"N/A")+(null!==secondary&&0!==secondary?", "+secondary:"")),stateMode()}function fundamentalNeedChecked(category,name,area){var i=vm.pageSetting.allTrait[category][name].currentValue,ii=vm.pageSetting.traitSelectedOrder.indexOf(category);("none"===i||null===i)&&ii>-1?(area.splice(ii,1),vm.pageSetting.traitSelectedOrder.splice(ii,1)):ii>-1?area[ii]=i:(area.push(i),vm.pageSetting.traitSelectedOrder.push(category)),sharedProperties.fireAnalyticsEvent("PA Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+i),stateMode()}function traitCheck(category,name,area){var i=$.inArray(name,area);i>-1?(area.splice(i,1),vm.pageSetting.traitSelectedOrder.splice(i,1),vm.pageSetting.allTrait[category][name].currentValue=0):(area.push(name),vm.pageSetting.traitSelectedOrder.push(category),vm.pageSetting.allTrait[category][name].currentValue=vm.pageSetting.personalityTypeDeviation),vm.calucalteTiltGraph(),sharedProperties.fireAnalyticsEvent("PA Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+name),stateMode()}function traitCheckTwo(category,name1,name2,area){var i=$.inArray(name1,area),j=$.inArray(name2,area);i>-1?(area.splice(j,1),area.splice(i,1),vm.pageSetting.traitSelectedOrder.splice(j,1),vm.pageSetting.traitSelectedOrder.splice(i,1)):(area.push(name1),area.push(name2),vm.pageSetting.traitSelectedOrder.push(category),vm.pageSetting.traitSelectedOrder.push(category)),sharedProperties.fireAnalyticsEvent("PA Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+name1+","+name2),stateMode()}function fundamentalNeedClear(category,name,area){var index=vm.pageSetting.traitSelectedOrder.indexOf(category);index>-1&&(area.splice(index,1),vm.pageSetting.traitSelectedOrder.splice(index,1)),vm.pageSetting.allTrait[category][name].currentValue="none",stateMode()}function conflictManagementclear(category,name,name1,area){var existence=vm.pageSetting.traitSelectedOrder.indexOf(category),regExp=new RegExp(category,"g"),existenceCheck=vm.pageSetting.traitSelectedOrder.toString().match(regExp),existenceCount=null!==existenceCheck&&existenceCheck.length>1,lastIndex=existenceCount?vm.pageSetting.traitSelectedOrder.lastIndexOf(category):-1;lastIndex>-1&&(area.splice(lastIndex,1),vm.pageSetting.traitSelectedOrder.splice(lastIndex,1)),existence>-1&&(area.splice(existence,1),vm.pageSetting.traitSelectedOrder.splice(existence,1)),vm.pageSetting.allTrait[category].Primary.checked=!1,stateMode()}function traitClear(checked,property,category){for(var j=vm.pageSetting[property].length-1;j>=0;j--){"Personality"===vm.pageSetting.traitSelectedOrder[j]&&(vm.pageSetting.allTrait[vm.pageSetting.traitSelectedOrder[j]][vm.pageSetting[property][j]].currentValue=0);for(var keys=Object.keys(vm.pageSetting.allTrait[category]),k=0;k<keys.length;k++)if(vm.pageSetting[property][j]===keys[k]){vm.pageSetting[property].splice(j,1);break}}"Personality"===category&&(vm.pageSetting.personalityMode="navigator",vm.calucalteTiltGraph());for(var i=vm.pageSetting.traitSelectedOrder.length-1;i>=0;i--)vm.pageSetting.traitSelectedOrder[i]===category&&vm.pageSetting.traitSelectedOrder.splice(i,1);if(void 0!==checked)for(var key in checked)checked[key].checked=!1;stateMode()}function traitFilter(e,parentE){for(var data=0,value=0,match=0,type=0,length=vm.pageSetting.personalityTraitSelected.length,difference=0,power=0,i=0,number=0;i<vm.pageSetting.personalityTraitSelected.length;i++)if(type=vm.pageSetting.traitSelectedOrder[i],match=e[vm.pageSetting.personalityTraitSelected[i]],"Processing"===type||"Motivation"===type||"LearningStyle"===type||"DecisionMaking"===type)value=parseInt(vm.pageSetting.allTrait[vm.pageSetting.traitSelectedOrder[i]][vm.pageSetting.personalityTraitSelected[i]].currentValue,10),match>=value-vm.pageSetting.deviation&&match<=value+vm.pageSetting.deviation&&(number=100-(match-value),power+=number,number>100&&(number=100),number<0&&(number=0),difference+=number,data++);else if("Personality"===type)match>=vm.pageSetting.personalityTypeDeviation&&(number=match,power+=number,difference+=number,data++);else if("FundamentalNeeds"===type){var fundamental=fundamentalFilter(e,vm.pageSetting.allTrait.FundamentalNeeds.fundamental.currentValue);fundamental&&(power+=100,difference+=100,data++)}else if("ConflictManagement"===type){var conflict=conflictFilter(e,vm.pageSetting.allTrait[vm.pageSetting.traitSelectedOrder[i]]);conflict&&(power+=100,difference+=100,data++)}return data===length&&(parentE.percent=Math.round(difference/vm.pageSetting.personalityTraitSelected.length),parentE.power=power),data===length}function conflictFilter(e,conflict){if(0===conflict.Primary.currentValue||null===conflict.Primary.currentValue)return!1;var primaryNumber=0,primary=conflict.Primary.currentValue,restTrait=angular.copy(vm.pageSetting.conflictTraitAvailable);restTrait.splice(vm.pageSetting.conflictTraitAvailable.indexOf(primary),1);for(var i=0;i<restTrait.length;i++)e[primary]>=e[restTrait[i]]&&primaryNumber++;if(0!==conflict.Secondary.currentValue&&null!==conflict.Secondary.currentValue&&primaryNumber===restTrait.length){var secondaryNumber=0,secondary=conflict.Secondary.currentValue,restCopy=angular.copy(restTrait);restCopy.splice(restTrait.indexOf(secondary),1);for(var j=0;j<restCopy.length;j++)e[secondary]>=e[restCopy[j]]&&secondaryNumber++;return secondaryNumber===restCopy.length}return primaryNumber===restTrait.length}function fundamentalFilter(e,fundamental){var club=["Control","Significance","Security"],result=0,order=[];switch(fundamental){case"Control":case"Significance":case"Security":order=angular.copy(club),order.splice(club.indexOf(fundamental),1);for(var i=0;i<order.length;i++)e[fundamental]>=parseInt(e[order[i]],10)&&result++;break;case"Balanced":order=angular.copy(club);for(var j=0;j<order.length;j++)33>=parseInt(e[order[j]],10)-vm.pageSetting.fundamentalNeedDeviation&&33<=parseInt(e[order[j]],10)+vm.pageSetting.fundamentalNeedDeviation&&result++}return order.length===result}function ertAnalyticFilterLogic(){vm.userScreen=!1,vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail),vm.pageSetting.personalityTypes=angular.copy(vm.pageSetting.personalityTraitSelected);var len=vm.pageSetting.traitSelectedOrder.toString().match(/Personality/g);vm.pageSetting.visiblePercentage=(null===len?0:len.length)===vm.pageSetting.traitSelectedOrder.length,vm.pageSetting.searchPersonality="navigator"===vm.pageSetting.personalityMode?"ertiData":"ertiUnderPressureData",vm.pageSetting.personalityTypesLang=vm.pageSetting.personalityTypes.map(function(e){return $rootScope.pullInterNationalization("spectrum.trait.type."+e)}),vm.analyticsGraphData=vm.analytics.userAnalytics.filter(function(e){return(vm.pageSetting.groupSelected.length&&available(null===e.groups?[]:e.groups,vm.pageSetting.groupSelected)||!vm.pageSetting.groupSelected.length&&e)&&(vm.pageSetting.ageSelected.length&&inBetween(null===e.age?[]:e.age,vm.pageSetting.ageSelected)||!vm.pageSetting.ageSelected.length&&e)&&(vm.pageSetting.genderSelected.length&&-1!==vm.pageSetting.genderSelected.indexOf(e.gender)||!vm.pageSetting.genderSelected.length&&e)&&(vm.pageSetting.tagSelected.length&&available(null===e.tags?[]:e.tags,vm.pageSetting.tagSelected)||!vm.pageSetting.tagSelected.length&&e)&&("All"===vm.userType&&e||"Employees"===vm.userType&&"Member"===e.userType||"Candidates"===vm.userType&&"HiringCandidate"===e.userType)&&(vm.pageSetting.personalityTraitSelected.length&&traitFilter(e[vm.pageSetting.searchPersonality],e)||!vm.pageSetting.personalityTraitSelected.length&&e)}).map(function(e){return vm.profileBalanceDetail.total++,vm.profileBalanceDetail.total>1&&vm.profileBalanceDetail.divisionTotal++,"M"===e.gender?vm.profileBalanceDetail.gender.male++:vm.profileBalanceDetail.gender.female++,ageSwitch(e.age),e}),vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!0,competency:!1,engagement:!1},vm.chartDataReady=!0,vm.ertOrderBy(vm.pageSetting.sort)}function calculateInsights(e){for(var count=!1,iterateObj=vm.pageSetting.traitSelected.length?vm.pageSetting.traitSelected:vm.insights.spectrumFilter.filters.trait,i=0;i<iterateObj.length;i++)!e[vm.pageSetting.searchPersonality][iterateObj[i]]||vm.pageSetting.traitSelected.length&&-1===vm.pageSetting.traitSelected.indexOf(iterateObj[i])||(-1!==vm.insightsMasterDataSet.indexOf(iterateObj[i])?vm.cloneInsightsGraphData[vm.insightsMasterDataSet.indexOf(iterateObj[i])].userDto.push({name:e.name,profile:e.smallProfileImage,initial:e.userInitials,userType:e.userType,percent:e[vm.pageSetting.searchPersonality][iterateObj[i]],title:e.title}):(vm.insightsMasterDataSet.push(iterateObj[i]),vm.cloneInsightsGraphData.push({traitName:iterateObj[i],traitDescription:null,userDto:[{name:e.name,profile:e.smallProfileImage,initial:e.userInitials,userType:e.userType,percent:e[vm.pageSetting.searchPersonality][iterateObj[i]],title:e.title}]})),count=!0);return count&&(vm.profileBalanceDetail.total++,vm.profileBalanceDetail.total>1&&vm.profileBalanceDetail.divisionTotal++,"M"===e.gender?vm.profileBalanceDetail.gender.male++:vm.profileBalanceDetail.gender.female++,ageSwitch(e.age)),!0}function ertInsightsFilterLogic(){vm.userScreen=!1,vm.cloneInsightsGraphData=[],vm.insightsMasterDataSet=[],vm.pageSetting.traitSelectedDisplay=[],vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail);vm.insights.userAnalytics.filter(function(e){return(vm.pageSetting.groupSelected.length&&available(null===e.groups?[]:e.groups,vm.pageSetting.groupSelected)||!vm.pageSetting.groupSelected.length&&e)&&(vm.pageSetting.ageSelected.length&&inBetween(null===e.age?[]:e.age,vm.pageSetting.ageSelected)||!vm.pageSetting.ageSelected.length&&e)&&(vm.pageSetting.genderSelected.length&&-1!==vm.pageSetting.genderSelected.indexOf(e.gender)||!vm.pageSetting.genderSelected.length&&e)&&(vm.pageSetting.tagSelected.length&&available(null===e.tags?[]:e.tags,vm.pageSetting.tagSelected)||!vm.pageSetting.tagSelected.length&&e)&&("All"===vm.userType&&e||"Employees"===vm.userType&&"Member"===e.userType||"Candidates"===vm.userType&&"HiringCandidate"===e.userType)&&sharedProperties.singleElementSearch(vm.pageSetting.memberSearch,e,2)&&calculateInsights(e)});vm.insightsGraphData=angular.copy(vm.cloneInsightsGraphData),vm.orderBy(vm.pageSetting.sort),vm.pageSetting.traitSelectedDisplay=vm.pageSetting.traitSelected.map(function(e){return $rootScope.pullInterNationalization("spectrum.trait.type."+e)}),vm.profileChartNoData=!vm.insightsGraphData.length,vm.chartDataReady=!0,vm.viewBox={profile:!1,blueprint:!1,insights:!0,org:!1,analytics:!1,competency:!1,engagement:!1}}function orderBy(sort){for(var i=0;i<vm.insightsGraphData.length;i++)vm.insightsGraphData[i].userDto.sort(function(a,b){var an=a.percent,bn=b.percent,af=a.firstName,bf=b.firstName;switch(sort){case"plus":return an===bn?af===bf?0:+(af>bf)||-1:+(bn>an)||-1;case"minus":return an===bn?af===bf?0:+(af>bf)||-1:+(an>bn)||-1}})}function percentCalc(total,number,floating){return void 0===floating?Math.round(number/total*100)||0:parseFloat(number/total*100).toFixed(floating)}function buildMasterDataSet(){for(var key in vm.personalityBalance.personalityData)vm.masterDataSet.push({dimensionType:vm.personalityBalance.personalityData[key].dimesionType,number:0,percent:0,personalityDescription:vm.personalityBalance.personalityData[key].description,personalityType:key,usersId:[],videoUrl:vm.personalityBalance.personalityData[key].videoUrl}),vm.keyList.push(key);vm.profileBalanceFilterLogic()}function ageSwitch(age){for(var i=0;i<ageCategory.length;i++){var splitNumber=ageCategory[i].split("-");if(age>=splitNumber[0]&&age<=splitNumber[1]){vm.profileBalanceDetail.age[category[i]]++;break}}}function calculateFilterValue(e){var index=void 0===e[vm.pageSetting.barPersonalityMode]||null===e[vm.pageSetting.barPersonalityMode]?-1:vm.keyList.indexOf(e[vm.pageSetting.barPersonalityMode]);return index>-1&&(vm.personalityBalanceGraphData[index].number++,vm.personalityBalanceGraphData[index].usersId.push(e),vm.profileBalanceDetail.total++,vm.profileBalanceDetail.total>1&&vm.profileBalanceDetail.divisionTotal++,"M"===e.gender?vm.profileBalanceDetail.gender.male++:vm.profileBalanceDetail.gender.female++,ageSwitch(e.age),!0)}function profileBalanceFilterLogic(){vm.userScreen=!1,vm.personalityBalanceGraphData=angular.copy(vm.masterDataSet),vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail);var data=vm.personalityBalance.spectrumUserDTOs.filter(function(e){return(vm.pageSetting.groupSelected.length&&available(null===e.groups?[]:e.groups,vm.pageSetting.groupSelected)||!vm.pageSetting.groupSelected.length&&e)&&(vm.pageSetting.ageSelected.length&&inBetween(null===e.age?[]:e.age,vm.pageSetting.ageSelected)||!vm.pageSetting.ageSelected.length&&e)&&(vm.pageSetting.genderSelected.length&&-1!==vm.pageSetting.genderSelected.indexOf(e.gender)||!vm.pageSetting.genderSelected.length&&e)&&(vm.pageSetting.tagSelected.length&&available(null===e.tags?[]:e.tags,vm.pageSetting.tagSelected)||!vm.pageSetting.tagSelected.length&&e)&&("All"===vm.userType&&e||"Employees"===vm.userType&&"Member"===e.userType||"Candidates"===vm.userType&&"HiringCandidate"===e.userType)&&calculateFilterValue(e)});vm.personalityBalanceGraphData.sort(function(a,b){var aP=$rootScope.pullInterNationalization("spectrum."+a.personalityType),bP=$rootScope.pullInterNationalization("spectrum."+b.personalityType);return a.number===b.number?aP===bP?0:+(aP>bP)||-1:+(b.number>a.number)||-1}),vm.profileChartNoData=!data.length,vm.viewBox={profile:!0,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!1,engagement:!1},vm.chartDataReady=!0}function balanceSelect(){vm.clear(".ageCheckbox","ageSelected"),closeAll()}function includeCheck(status,area){var i=$.inArray(status,area);i>-1?area.splice(i,1):area.push(status),sharedProperties.fireAnalyticsEvent("PA Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+status),stateMode()}function secondaryDrop(val){return!!Object.keys(vm.pageSetting.allTrait).length&&val!==vm.pageSetting.allTrait.ConflictManagement.Primary.currentValue}function clear(classS,property,search,checked){if(vm.pageSetting[property]=[],void 0!==search&&(vm.pageSetting[search]=""),void 0!==checked)for(var key in checked)checked[key].checked=!1;$(classS).each(function(v,i){$(this).prop("checked",!1)}),stateMode()}function closeRest(index,noScroll){var val=void 0===noScroll?0:1;$(".accordian-checkbox").each(function(i){i!==$(index.currentTarget.parentNode).index()-val&&$(this).prop("checked",!0)}),void 0===noScroll&&$("html,body").animate({scrollTop:$(".spectrum-filter-toggle").offset().top-80},300);for(var i=0;i<index.currentTarget.parentNode.children.length;i++)"H3"===index.currentTarget.parentNode.children[i].tagName&&(vm.filterNameForAnalytics=index.currentTarget.parentNode.children[i].textContent)}function closeAll(){$(".accordian-checkbox").each(function(i){$(this).prop("checked",!0)})}function profileUpdateFn(callback){$scope.$apply(function(){vm.userScreen=!0,vm.userDetail=callback.userDetail,vm.profileName=callback.name,vm.profileBalanceSelect=callback.className,vm.profileNumber=callback.number,vm.dimensionType=callback.dimensionType,vm.personalityDescription=callback.personalityDescription,vm.videoUrl=callback.videoUrl})}function videoPopUp(url){sharedProperties.videoPopUp(url)}var vm=this;vm.config={getProfileBalance:"/sp/hiring/spectrum/personalityBalance",getErtInsights:"/sp/hiring/spectrum/ertiInsights",getErtAnalytics:"/sp/hiring/spectrum/ertiAnalytics",videoPopUpDialog:"/sp/support/videoPopUp"},vm.chartDataReady=!1,vm.userScreen=!1,vm.profileChartNoData=!0,vm.noData=!1,vm.pa=!0;var ageCategory=["0-21","22-34","35-44","45-54","55-64","65-200"],category=["YOUNG","MILIENIAL","GEN_X","BOOMERS","OLD","SILENT"];vm.masterProfileBalanceDetail={gender:{male:0,female:0},age:{YOUNG:0,MILIENIAL:0,GEN_X:0,BOOMERS:0,OLD:0,SILENT:0},total:0,divisionTotal:1,matched:0},vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail),vm.personalityBalance=[],vm.personalityBalanceGraphData={},vm.insights=[],vm.insightsGraphData=[],vm.cloneInsightsGraphData=[],vm.insightsMasterDataSet=[],vm.analytics=[],vm.analyticsGraphData=[],vm.tilt={big:100,detail:0,mission:100,relational:0},vm.screenInfo=[],vm.ipadView=$(window).width()>767&&$(window).width()<1025,vm.windowWidth=$(window).width(),vm.rowDataArray=[],vm.pageSetting={groupSearch:"",groupSelected:[],individualSearch:"",individualSelected:[],ageSelected:[],genderSelected:[],tagSelected:[],tagSearch:"",memberSearch:"",sort:"plus",traitSearch:"",traitSelected:[],orgSelected:[],orgSearch:"",viewType:"i",allSteps:"",checked:!1,personalityTraitSelected:[],allTrait:{},conflictTraitPrimary:"",conflictTraitSecondary:"",traitSelectedOrder:[],deviation:10,personalityTypeDeviation:66,conflictTraitSelected:!1,fundamentalNeed:"none",fundamentalNeedDeviation:4,personalityMode:"navigator",searchPersonality:"ertiData",primarypersonalityTraitSelected:[],heightParam:800,barPersonalityMode:"primaryPersonality"},vm.originalPageSetting=angular.copy(vm.pageSetting),vm.masterDataSet=[],vm.keyList=[],vm.viewBox={profile:!1,insights:!1,analytics:!1},vm.permissionLevel={prism:!1,insights:!1,analytics:!1},vm.routeStateMode=0,vm.init=init,vm.routeToState=routeToState,vm.filterOpen=filterOpen,vm.getProfileBalance=getProfileBalance,vm.profileBalanceFilterLogic=profileBalanceFilterLogic,vm.includeCheck=includeCheck,vm.profileUpdateFn=profileUpdateFn,vm.clear=clear,vm.closeRest=closeRest,vm.balanceSelect=balanceSelect,vm.getErtInsights=getErtInsights,vm.ertInsightsFilterLogic=ertInsightsFilterLogic,vm.returnClampName=returnClampName,vm.orderBy=orderBy,vm.getErtAnalytics=getErtAnalytics,vm.ertAnalyticFilterLogic=ertAnalyticFilterLogic,vm.ertOrderBy=ertOrderBy,vm.traitCheck=traitCheck,vm.traitCheckTwo=traitCheckTwo,vm.mapToTriat=mapToTriat,vm.traitClear=traitClear,vm.calucalteTiltGraph=calucalteTiltGraph,vm.conflictManagerChecked=conflictManagerChecked,vm.fundamentalNeedChecked=fundamentalNeedChecked,vm.conflictManagementclear=conflictManagementclear,vm.fundamentalNeedClear=fundamentalNeedClear,vm.secondaryDrop=secondaryDrop,vm.calculateHeight=calculateHeight,vm.animate=animate,vm.videoPopUp=videoPopUp,vm.moduleNameForAnalytics="",vm.filterNameForAnalytics="",vm.ipad=$(window).width()<1100&&$(window).width()>992;var width=$(window).width();vm.mobile=width<1100,vm.globalNav=$localStorage.get("userSelectedNav"),vm.userType="All",vm.percentCalc=percentCalc,vm.sharedProp=sharedProperties,vm.candidateImage=spConfig.image.candidateDefault}spectrumPAController.$inject=["$scope","ajaxService","$localStorage","$timeout","$rootScope","ngDialog","$state","sharedProperties","spConfig"],angular.module("spApp").controller("spectrumPAController",spectrumPAController),angular.module("spApp").directive("rangeDrag",["$rootScope",function($rootScope){return{restrict:"E",replace:!1,templateUrl:"/sp/resources/html/spectrum/twoRangeDrag.html",scope:{data_1:"=rangeData1",data_2:"=rangeData2",dragRange:"=dragRange",editable:"=editable",updateFn:"&updateFn",checkboxFn:"&checkboxFn"},link:function(scope,element,attr){var inputCreator=function(){var ele=$(element).find(".dragdealer")[0],leftRange=$(element).find(".labels .minRange"),rightRange=$(element).find(".labels .maxRange");new Dragdealer(ele,{animationCallback:function(x,y){leftRange.text(Math.round(100-100*x)),rightRange.text(Math.round(100*x))},dragStartCallback:function(x,y){scope.editable||scope.$apply(function(){(scope.editable=!0)&&scope.checkboxFn()})},callback:function(x,y){sliderValue(x),scope.editable||scope.$apply(function(){(scope.editable=!0)&&scope.checkboxFn()})},x:scope.dragRange})},sliderValue=function(x){var xAxis=Math.round(100-100*x),yAxis=Math.round(100*x);scope.$apply(function(){xAxis!==scope.data_1.currentValue&&yAxis!==scope.data_2.currentValue&&(scope.data_1.currentValue=xAxis,scope.data_2.currentValue=yAxis,scope.updateFn())})};void 0!==scope.editable&&inputCreator()}}}]),angular.module("spApp").directive("twoRange",["$rootScope",function($rootScope){return{restrict:"E",replace:!1,templateUrl:"/sp/resources/html/spectrum/twoRange.html",scope:{data_1:"=rangeData1",data_2:"=rangeData2",editable:"=editable",updateFn:"&updateFn",checkboxFn:"&checkboxFn"},link:function(scope,element,attr){element.bind("change",function(){sliderValue()});var inputCreator=function(){scope.minValue=0,scope.maxValue=100,scope.which=-1,scope.editable=void 0!==scope.editable&&scope.editable,scope.currentValue1=null===scope.data_1.currentValue?0:100-parseInt(scope.data_1.currentValue),scope.currentValue2=null===scope.data_2.currentValue?0:scope.data_2.currentValue},sliderValue=function(){scope.$apply(function(){0===scope.which?(scope.data_1.currentValue=100-parseInt(scope.currentValue1,10),scope.data_2.currentValue=scope.currentValue1,scope.currentValue2=parseInt(scope.currentValue1,10)):1===scope.which&&(scope.data_1.currentValue=100-parseInt(scope.currentValue2,10),scope.data_2.currentValue=scope.currentValue2,scope.currentValue1=parseInt(scope.currentValue2,10)),scope.updateFn(),scope.editable||(scope.editable=!0,scope.checkboxFn())})};scope.$watch("editable",function(newValue,oldValue){void 0!==scope.data_1&&inputCreator()},!0)}}}]),angular.module("spApp").directive("singleRange",["$rootScope",function($rootScope){return{restrict:"E",replace:!1,templateUrl:"/sp/resources/html/spectrum/singleRange.html",scope:{data:"=rangeData",editable:"=editable",updateFn:"&updateFn",checkboxFn:"&checkboxFn"},link:function(scope,element,attr){element.bind("change",function(){getSliderValue()});var getSliderValue=function(){scope.$apply(function(){scope.data.currentValue=scope.currentValue,scope.editable||(scope.editable=!0,scope.checkboxFn()),scope.updateFn()})},inputCreator=function(){scope.minValue=0,scope.maxValue=100,scope.editable=void 0!==scope.editable&&scope.editable,scope.currentValue=void 0===scope.data.currentValue?0:scope.data.currentValue};scope.$watch("editable",function(newValue,oldValue){void 0!==scope.data&&inputCreator()},!0)}}}]),angular.module("spApp").directive("ellipsis",["$rootScope",function($rootScope){return{restrict:"E",replace:!1,templateUrl:"/sp/resources/html/spectrum/structure.html",scope:{data:"=elData",length:"=elLength",fontsize:"=elFontsize",total:"=elTotal",message:"=elMessage",lang:"=elLang"},link:function(scope,element,attrs){var resize=function(){ellipsisCreator(scope.data),scope.$apply()},ellipsisCreator=function(array){var arraySize=[],size=0,stopCounter=0,length=$(scope.length).width()/1.7;if(scope.toolTiptext=null,scope.visibleText=null,scope.remaining=0,scope.more=$rootScope.pullInterNationalization("spectrum.more"),scope.total!==scope.data.length){for(var i=0;i<array.length;i++){var e=document.createElement("span");if(document.body.appendChild(e),e.style.fontSize=scope.fontsize+"px",e.setAttribute("class","posAbs"),e.innerHTML=array[i],arraySize.push(e.offsetWidth+5),$(".posAbs").remove(),size+arraySize[i]>=length){stopCounter=i-1;break}size+=arraySize[i],stopCounter=i}scope.visibleText=array.slice(0,stopCounter+1).join(", "),stopCounter<array.length-1&&(scope.toolTiptext=array.slice(stopCounter+1,array.length).join(", "),scope.remaining=array.length-1-stopCounter)}else scope.visibleText=scope.message};scope.$watch("data",function(newValue,oldValue){void 0!==scope.data&&ellipsisCreator(scope.data)},!0),$(window).on("resize",resize)}}}]),angular.module("spApp").directive("barChart",["$rootScope","$window",function($rootScope,$window){function tickLength(dataMax){for(var max=0,i=0;i<dataMax.length;i++)max<dataMax[i].name.length&&(max=dataMax[i].name.length);return max*=10,max=max<160?max:max-23}function change(d){d3.select(".bar-"+d.className).classed("hovered",!0),d3.select(".x-"+d.className).classed("hovered",!0)}function restore(d){d3.select(".bar-"+d.className).classed("hovered",!1),d3.select(".x-"+d.className).classed("hovered",!1)}function classes(root){function recurse(name,node){null===name?node.forEach(function(child){recurse(child.personalityType,child)}):classesList.push({name:$rootScope.pullInterNationalization("spectrum."+name),className:name.toLowerCase(),number:node.number,userDetail:node.usersId,percent:node.percent,index:node.percent+name+node.number,dimensionType:node.dimensionType,personalityDescription:node.personalityDescription,videoUrl:node.videoUrl})}var classesList=[];return recurse(null,root),{
children:classesList}}return{restrict:"E",replace:!1,scope:{data:"=chartData",clickOperation:"=clickEvent",updateFn:"&"},link:function(scope,element,attrs){var duration=800,delay=200,classToBind=$("."+attrs.classBind),legendSpace=170,barHeight=35,boxArea=5,margin={top:20,right:50,bottom:30,left:170},rangeBandHeight=barHeight*scope.data.length+margin.top,width=classToBind.width()-margin.left-margin.right,height=classToBind.height()-margin.top-margin.bottom,widthMar=(d3.format(",d"),width+margin.left+margin.right),heightMar=height+margin.top+margin.bottom,ease="cubic-in-out",svg=d3.select(element[0]).append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+widthMar+" "+heightMar).attr("preserveAspectRatio","xMinYMin").attr("class","barChart").append("g").attr("transform","translate("+margin.left+","+margin.top+")"),chart=$(".barChart"),barChartCreation=(chart.width(),chart.height(),chart.parent(),function(svgElem,data,scopePass){var x=d3.scale.linear().domain([0,d3.max(data,function(d){return 10*Math.ceil(d.number/10)})]).range([0,width-legendSpace]),y=d3.scale.ordinal().domain(d3.range(data.length)).rangeBands([0,rangeBandHeight]),maxLength=tickLength(data);svgElem.selectAll("g.axis").remove(),svgElem.selectAll(".bar").remove(),svgElem.append("line").attr("x1",-maxLength).attr("y1",0).attr("x2",-maxLength).attr("y2",rangeBandHeight).style("stroke-width",1).style("stroke","#ddd").style("fill","none");var yAxis=d3.svg.axis().scale(y).orient("right").tickSize(0).tickPadding(-(maxLength-boxArea)).tickFormat(function(d){return data[d].name});svgElem.append("g").attr("class","y axis").call(yAxis).append("text"),svgElem.select(".y").selectAll(".tick").data(data).attr("class",function(d,i){return"tick xAxisClick x-"+d.className}).on("mouseout",restore).on("mouseover",change).on("click",function(d,i){if(!scopePass.clickOperation)return!0;scopePass.updateFn({callback:d})}),svgElem.select(".y").selectAll(".tick").insert("rect","text").attr("width",maxLength).attr("height",barHeight).attr("y","-18.9").attr("x",-maxLength),svgElem.select(".y").selectAll(".tick line").attr("x2",-maxLength).attr("y1","16.8").attr("y2","16.8"),svgElem.select(".xAxisClick").insert("line","rect").attr("x2",-maxLength).attr("y1","-17.5").attr("y2","-17.5");var bars=svgElem.selectAll(".bar").data(data);bars.enter().append("g").attr("class",function(d){return"bar bar-"+d.className+" number_"+d.number}).on("mouseout",restore).on("mouseover",change).on("click",function(d){if(!scopePass.clickOperation)return!0;scopePass.updateFn({callback:d})}).attr("transform",function(d,i){return"translate(0,"+y(i)+")"}),bars.append("rect").transition().duration(duration).ease(ease).attr("height",barHeight).attr("width",0).transition().delay(delay).duration(duration).attr("width",function(d){var num=x(d.number);return Math.abs(num)}),bars.append("text").transition().duration(duration).ease(ease).attr("x",10).attr("y",18).attr("dy",".35em").attr("text-anchor","end").transition().delay(delay).duration(duration).attr("x",function(d){return 10+Math.abs(x(d.number))+7*d.number.toString().length}).text(function(d){return d.number}),bars.exit().transition().style({opacity:0}).remove()});scope.$watch("data",function(newValue,oldValue){if(void 0!==scope.data&&scope.data.length){var dataToPass=classes(scope.data);barChartCreation(svg,dataToPass.children,scope)}},!0)}}}]),angular.module("spApp").directive("elemReady",["$parse",function($parse){return{restrict:"A",link:function($scope,elem,attrs){elem.ready(function(){$scope.$apply(function(){$parse(attrs.elemReady)($scope)})})}}}]);