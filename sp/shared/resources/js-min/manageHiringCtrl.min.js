function manageHiring($scope,ajaxService,$localStorage,$state,$q,sharedProperties,$filter,$rootScope,ngDialog,$timeout){function resetAll(){if(!_this.showLandingPage){$localStorage.remove("archivesView","candidateDetailsNav");var showMessage1=($localStorage.get("accountRequest"),$localStorage.get("accountRequest1"));showMessage1&&(_this.activeView="candidates",_this.switchViews("candidates"),sharedProperties.growlMessage($rootScope.pullInterNationalization(showMessage1)),$timeout(function(){$localStorage.remove("accountRequest1")},300)),$localStorage.remove("previousView"),_this.isPreviousView="",void 0!==$state.current.name&&null!==$state.current.name&&""!==$state.current.name&&0!==$state.current.name.length||(_this.activeView="candidates",_this.switchViews("candidates"))}}function switchViews(viewName,clearPrev,email,id,archiveProfile){if($localStorage.remove("mName"),clearPrev?($localStorage.remove("previousView"),_this.isPreviousView=""):_this.isPreviousView=$localStorage.get("previousView")?$localStorage.get("previousView"):"",_this.activeView=viewName,void 0!==email&&null!==email&&""!==email){var opts={};opts=archiveProfile?{cemail:email+"+"+id+"+"+archiveProfile}:{cemail:email+"+"+id},$state.transitionTo(_this.activeView,opts,{reload:!0})}else $state.go(_this.activeView);"archives"===_this.activeView?$localStorage.set("archivesView",!0):$localStorage.remove("archivesView")}function setContentReference(obj,type){var tempObj={data:obj,type:type};sharedProperties.setContentReference(tempObj),tempObj=null}var _this=this;_this.activeView="",_this.isPreviousView="",_this.showLandingPage=!1,_this.services={getCandidates:"/sp/hiring/getAllCandidates",archives:"/sp/hiring/getAllArchivedCandidates"},_this.switchViews=switchViews,_this.resetAll=resetAll,_this.setContentReference=setContentReference}function manageImportListCtrl($scope,ajaxService,$localStorage,$state,$q,sharedProperties,$filter,$rootScope,ngDialog,$timeout){function checkSubscriptions(){ajaxService.getAjaxResponse({url:_this.services.subscriptions}).then(function(response){"true"===response.Success?_this.availableSubscriptionsCount=response.availableHiringSubscripitons>0?response.availableHiringSubscripitons:0:null!==response.error&&sharedProperties.ajaxError(response)})}function closeImport(){sharedProperties.setCandidates([]),sharedProperties.setArchivedCandidates([]),$scope.$parent.ctrl.clearMinHeight(),$scope.$parent.ctrl.addCandidatesView=!1,$scope.$parent.ctrl.isImportForm=!1,$scope.$parent.ctrl.isImportList=!1}function checkValid(val){return void 0!==val&&""!==val&&null!==val}function listCheck(list){if(void 0!==list&&""!==list&&null!==list&&list.length){for(var emailList=list.map(function(e){return e.email}),tempList=angular.copy(_this.masterMemberList),count=0,i=0;i<tempList.length;i++)-1!==emailList.indexOf(tempList[i].email)&&-1!==["ALREADY_EXISTS","ALREADY_EXISTS_ARCHIVED"].indexOf(tempList[i].userStatus)&&count++;return count>0}return!1}function processImport(dt,list){var _list=list.map(function(e){return e.email});if(!(_list.length<=_this.availableSubscriptionsCount))return void(_this.subscriptionsExceedError=!0);ajaxService.getAjaxResponse({url:_this.services.import,data:$.param({membersToInvite:_this.masterMemberList.filter(function(e){return-1!==_list.indexOf(e.email)&&null===e.spUserId}).map(function(obj){return obj.email}).toString(),membersToAdd:_this.masterMemberList.filter(function(e){return-1!==_list.indexOf(e.email)&&null!==e.spUserId}).map(function(obj){return obj.email}).toString(),day:void 0!==dt?moment(dt,"MM/DD/YYYY").format("D"):0,month:void 0!==dt?moment(dt,"MM/DD/YYYY").format("M"):0,year:void 0!==dt?moment(dt,"MM/DD/YYYY").format("Y"):0})}).then(function(response){"true"===response.Success?(sharedProperties.setCandidates([]),$scope.$parent.ctrl.clearMinHeight(),$scope.$parent.ctrl.addCandidatesView=!1,$scope.$parent.ctrl.isImportForm=!1,$scope.$parent.ctrl.isImportList=!1,$scope.$parent.ctrl.getCandidates(),$("html,body").animate({scrollTop:0},200),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateImported"))):null!==response.error&&sharedProperties.ajaxError(response)})}function importList(dt,mode){_this.dueDateError=!1,_this.listModeError=!1,_this.listLenError=!1,_this.listConflictError=!1,_this.noSubscriptionsError=!1,_this.subscriptionsExceedError=!1;var isConflict=listCheck(_this.pageSetting.user);if(!checkValid(dt))return void(_this.dueDateError=!0);if(!checkValid(mode))return void(_this.listModeError=!0);if(0===_this.availableSubscriptionsCount)return void(_this.noSubscriptionsError=!0);if(checkValid(mode))if("fullList"===mode)checkSubscriptions(),processImport(dt,_this.masterMemberList);else if("selectedList"===mode){if(isConflict)return void(_this.listConflictError=!0);if(!_this.pageSetting.user.length)return void(_this.listLenError=!0);checkSubscriptions(),processImport(dt,_this.pageSetting.user)}}function deleteAll(){for(var emailList=_this.pageSetting.user.map(function(obj){return obj.email}),i=_this.masterMemberList.length-1;i>=0;i--)-1!==emailList.indexOf(_this.masterMemberList[i].email)&&_this.masterMemberList.splice(i,1);_this.pageSetting.userStatusSelected&&_this.userStatusFilter(!1,!1),_this.pageSetting.user=[],_this.masterCopy=!0,_this.negative=!1,_this.dueDateError=!1,_this.listModeError=!1,_this.listMode="",_this.returnMemberList(),ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateDeleted"))}function deleteAllPop(){ngDialog.open({template:"/sp/resources/html/hiring/candidates-importDelete.html",scope:$scope})}function deleteCandidate(email){for(var i=_this.masterMemberList.length-1;i>=0;i--)if(_this.masterMemberList[i].email===email){_this.masterMemberList.splice(i,1);break}_this.pageSetting.userStatusSelected&&_this.userStatusFilter(!1,!1),_this.masterCopy=!0,_this.negative=!1,_this.dueDateError=!1,_this.listModeError=!1,_this.listMode="",_this.returnMemberList(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateDeleted"))}function userStatusFilter(flag,cache){_this.pageSetting.userStatusSelected=flag,_this.masterCopy=!cache,_this.returnMemberList()}function getFilterValue(){var userStatus=[],arr=[];_this.allMembersEmailId=[];for(var i=0;i<_this.masterMemberList.length;i++)_this.allMembersEmailId.push({email:_this.masterMemberList[i].email}),null!==_this.masterMemberList[i].userStatus&&userStatus.push({userStatus:_this.masterMemberList[i].userStatus,userFormatted:_this.masterMemberList[i].userStatusFormatted});_this.userStatus=userStatus.filter(function(e){if(-1===arr.indexOf(e.userStatus))return arr.push(e.userStatus),e})}function getImportedCandidates(){ajaxService.getAjaxResponse({url:_this.services.getList,data:$.param({filesToProcess:_this.fileName.toString()})}).then(function(response){"true"===response.Success?(checkSubscriptions(),_this.masterMemberList=response.hiring,_this.returnMemberList(),$timeout(function(){$("body").find(".candyListWrapper").css({"min-height":$("#iList").height()+500})},100),getFilterValue(),$localStorage.remove("importFileName")):null!==response.error&&(_this.listResponse=!1,$localStorage.remove("importFileName"),sharedProperties.ajaxError(response))}),$('input[name="dueDate2"]').length?$timeout(function(){prepareDueDate()},200):$timeout(function(){prepareDueDate()},500)}function returnMemberList(pageSize){var result=_this.masterCopy?_this.masterMemberList:_this.memberList;_this.memberList=result.filter(function(e){return(_this.pageSetting.userStatusSelected&&-1!==["ALREADY_EXISTS","ALREADY_EXISTS_ARCHIVED"].indexOf(e.userStatus)||!_this.pageSetting.userStatusSelected&&e)&&sharedProperties.singleElementSearch(_this.pageSetting.textSearching,e,2)}),order(_this.pageSetting.lastPredicate,_this.pageSetting.lastReverse),_this.pageSetting.user.length!==_this.memberList.length&&(_this.negative=!1),_this.masterCopy=!0,_this.totalConflicts=_this.masterMemberList.filter(function(obj){return"ALREADY_EXISTS"===obj.userStatus||"ALREADY_EXISTS_ARCHIVED"===obj.userStatus}),_this.allMembersEmailId=_this.masterMemberList.map(function(obj){return obj.email}),_this.listResponse=!!_this.memberList.length}function checkAll(){_this.negative?_this.pageSetting.user=[]:_this.pageSetting.user=_this.memberList.map(function(item){return{userId:item.id,email:item.email,name:item.name,title:item.title}})}function checkCount(checked){var userLength=_this.pageSetting.user.length;checked?userLength+1===_this.memberList.length?_this.negative=!0:_this.negative=!1:userLength-1===_this.memberList.length?_this.negative=!0:_this.negative=!1}function active(event,setting){_this.pageSetting.lastPredicate=setting.predicate,_this.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,_this.pageSetting.lastPredicate),order(_this.pageSetting.lastPredicate,_this.pageSetting.lastReverse)}function order(predicate,reverse){_this.pageSetting.lastPredicate=predicate,_this.pageSetting.lastReverse=reverse;var orderedList=$filter("orderBy")(_this.memberList,_this.pageSetting.lastPredicate,_this.pageSetting.lastReverse);_this.memberList=function(array,key){if("name"===key){for(var list=[],empty=[],i=0;i<array.length;i++)null!==array[i][key]&&""!==array[i][key]&&void 0!==array[i][key]?list.push(array[i]):empty.push(array[i]);return $.merge(list,empty)}return orderedList}(orderedList,_this.pageSetting.lastPredicate)}var _this=this;_this.services={getList:"/sp/hiring/multiInviteValidate",import:"/sp/hiring/multiInvite",subscriptions:"/sp/hiring/getAvailableSubscriptions"},_this.pageSetting={pageSize:10,lastPredicate:"name",lastReverse:!1,disabledInfinite:!1,user:[],textSearching:"",userStatusSelected:!1},_this.originalpageSetting=angular.copy(_this.pageSetting),_this.masterCopy=!0,_this.fileName=$localStorage.get("importFileName"),_this.listResponse=!1,_this.negative=!1,_this.allUsersMenu=!1,_this.masterMemberList=[],_this.memberList=[],_this.totalConflicts=[],_this.userStatus=[],_this.allMembersEmailId=[],_this.dueDateError=!1,_this.listModeError=!1,_this.listLenError=!1,_this.listConflictError=!1,_this.noSubscriptionsError=!1,_this.subscriptionsExceedError=!1,_this.listMode="",_this.getImportedCandidates=getImportedCandidates,_this.returnMemberList=returnMemberList,_this.checkCount=checkCount,_this.active=active,_this.checkAll=checkAll,_this.order=order,_this.getFilterValue=getFilterValue,_this.userStatusFilter=userStatusFilter,_this.deleteCandidate=deleteCandidate,_this.deleteAll=deleteAll,_this.deleteAllPop=deleteAllPop,_this.importList=importList,_this.closeImport=closeImport,_this.checkSubscriptions=checkSubscriptions,_this.availableSubscriptionsCount=0;var prepareDueDate=function(){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),$('input[name="dueDate2"]').daterangepicker({showDropdowns:!1,minDate:moment(),startDate:moment(),locale:{format:"MMM DD, YYYY"},alwaysShowCalendars:!0,autoApply:!0,singleDatePicker:!0,autoUpdateInput:!1,opens:"right"},function(start,end,label){$scope.$apply(function(){_this.dueDate=start.format("MM/DD/YYYY")})})}}function candidatesListing($scope,ajaxService,$localStorage,$state,$q,sharedProperties,$filter,$rootScope,ngDialog,$timeout){function closeRest(index,noScroll){var val=void 0===noScroll?0:1;$(".accordian-checkbox").each(function(i){i!==$(index.currentTarget.parentNode).index()-val&&$(this).prop("checked",!0)})}function requestForAccounts(requestType){var storedUser=$localStorage.get("loggegdInProfile");_this.requestAccounts=0,_this.requestType=requestType,_this.companyEmail=storedUser.member.email,ngDialog.open({template:_this.modals.addNew,scope:$scope})}function processAccountRequest(e){_this.addAccountsForm.submitted=!1,_this.addAccountsForm.$valid&&_this.requestAccounts>0?(_this.addAccountsForm.submitted=!1,$localStorage.remove("candidateDetailsNav","archiveCandidateProfile"),$localStorage.set("accountRequest1","manageAccountContent.requestSubmit"),sharedProperties.fireAnalyticsEvent("Intilligent Hiring | Request additional accounts","N/A")):(e.preventDefault(),_this.addAccountsForm.submitted=!0)}function clearFile(){document.getElementById("importCandidatesList")&&document.getElementById("importCandidatesList").reset(),_this.listSubmitted=!1,_this.invalidFileError=!1,_this.fileDataObj={},_this.importedFileData={},fileResetService()}function importCandidates(){if(_this.listSubmitted=!1,_this.invalidFileError=!1,$.isEmptyObject(_this.fileDataObj))_this.listSubmitted=!0,_this.invalidFileError=!1;else{_this.listSubmitted=!1,_this.invalidFileError=!1;var formData=new FormData;formData.append("hiringCandidateFile",$("#importedFileData")[0].files[0]),$.ajax({url:_this.services.upload,method:"POST",processData:!1,cache:!1,contentType:!1,data:formData,beforeSend:function(){$rootScope.$broadcast("httpLoaderStart")}}).done(function(response){if(null!==response.success){var fname=_this.fileDataObj.name;_this.fileDataObj={},_this.importedFileData={},$rootScope.$broadcast("httpLoaderEnd"),$timeout(function(){$localStorage.set("importFileName",fname),_this.isImportList=!0},100)}else if(null!==response.error){$rootScope.$broadcast("httpLoaderEnd");var errorMessage="",r=response.error;for(var key in r)errorMessage=r[key];sharedProperties.growlMessage(errorMessage,$rootScope.pullInterNationalization("service.growl.alert"),"glyphicon glyphicon-ban-circle"),clearFile()}}).fail(function(jqXHR,textStatus){$rootScope.$broadcast("httpLoaderEnd"),sharedProperties.growlMessage(textStatus,$rootScope.pullInterNationalization("service.growl.alert"),"glyphicon glyphicon-ban-circle")})}}function triggerInput(){$("#importedFileData").click()}function clearMinHeight(){$("body").find(".candyListWrapper").removeAttr("style")}function fileResetService(){ajaxService.getAjaxResponse({url:_this.services.reset})}function initImportList(){_this.fileDataObj={},_this.importCandidatesList={},_this.importedFileData={},_this.listSubmitted=!1,_this.invalidFileError=!1,_this.isImportForm=!0,fileResetService(),checkCandidateSubscriptions(),$("#importedFileData").length>1?updateChangeEvent():$timeout(function(){updateChangeEvent()},200)}function updateChangeEvent(){var regex=new RegExp("(.*?).(csv)$");$("#importedFileData").off("change").change(function(e){regex.test($(this).val())?$timeout(function(){$scope.$apply(function(){_this.listSubmitted=!1,_this.invalidFileError=!1,_this.fileDataObj=$("#importedFileData")[0].files[0]})},100):(document.getElementById("importCandidatesList")&&document.getElementById("importCandidatesList").reset(),$scope.$apply(function(){_this.listSubmitted=!1,_this.invalidFileError=!0}))})}function hireCandidate(email){_this.hireSubmitted=!1;var memberDetails,tags;!_this.hireCandidateForm.$valid||_this.existingCandidate||_this.existingSPemail?_this.hireSubmitted=!0:(_this.hireSubmitted=!1,tags=void 0!==_this.candidateDetails.tags&&_this.candidateDetails.tags.length?_this.candidateDetails.tags.map(function(obj){return obj.text}):"",memberDetails={firstName:_this.candidateDetails.firstName,lastName:_this.candidateDetails.lastName,title:_this.candidateDetails.title,email:_this.candidateDetails.email,groupAssociationList:"",tagList:void 0!==tags&&tags.length?tags.join(","):tags},ajaxService.getAjaxResponse({url:_this.services.archive,data:$.param({candidateEmail:email,isHired:!0})}).then(function(response){"true"===response.Success?ajaxService.getAjaxResponse({url:_this.services.addMember,data:$.param(memberDetails)}).then(function(response){if("true"===response.Success)_this.msgKey="",_this.existingCandidate=!1,sharedProperties.setCandidates([]),sharedProperties.setArchivedCandidates([]),_this.getCandidates(),ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.memberAdded"));else if(null!==response.error){var errorMessage="";for(var key in response)if("object"==typeof(errorMessage=response[key])){for(var k in errorMessage)if(errorMessage.hasOwnProperty(k)&&errorMessage[k]){sharedProperties.growlMessage(errorMessage[k],$rootScope.pullInterNationalization("service.growl.alert"),"glyphicon glyphicon-ban-circle");break}}else errorMessage&&sharedProperties.growlMessage(errorMessage,$rootScope.pullInterNationalization("service.growl.alert"),"glyphicon glyphicon-ban-circle");ngDialog.close()}}):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response))}))}function includeDateCheck(fromDt,toDt,flag){_this.dateErrorFrom=!1,_this.dateErrorTo=!1,!flag||_this.dateErrorFrom||_this.dateErrorTo?(_this.pageSetting.dateRangeSelected=!1,_this.manageFilterDisplayList("dateRangeSelected")):(_this.pageSetting.dateRangeSelected=!0,_this.manageFilterDisplayList("dateRangeSelected")),_this.returnMemberList(_this.pageSetting.pageSize)}function viewCandidateDetails(email,flag,id,archives,prismView){$localStorage.remove("candidateDetailsNav","archiveCandidateProfile"),$localStorage.set("previousView",$scope.$parent.ctrl.activeView),$scope.$parent.ctrl.switchViews("candidateDetails",flag,email,id,archives),prismView&&$localStorage.set("candidateDetailsNav","prismPortrait")}function viewCompare(email,id){$scope.$parent.ctrl.switchViews("advisor",!1,email,id,!1)}function sendEmailReminders(status,email){var type="";type="INVITATION_SENT"===status||"ADD_REFERENCES"===status||"ASSESSMENT_PENDING"===status||"ASSESSMENT_PROGRESS"===status||"INVITATION_NOT_SENT"===status||"PROFILE_INCOMPLETE"===status?"HiringCandidateReminder":"HiringCandidateProfileAccess",ajaxService.getAjaxResponse({url:_this.services.notification,data:$.param({brandHeader:"",ctaLabel:"",ctaUrl:"",logType:"Hiring",type:type,memberList:email})}).then(function(response){"true"===response.Success?(sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.notificationSent")),sharedProperties.fireAnalyticsEvent("Intilligent Hiring | Send Reminder",status)):null!==response.error&&sharedProperties.ajaxError(response)})}function moveCandidate(email){ajaxService.getAjaxResponse({url:_this.services.move,data:$.param({candidateEmail:email})}).then(function(response){if("true"===response.Success){var copiedList=angular.copy(_this.masterMemberList);if(void 0!==email)for(var i=copiedList.length-1;i>=0;i--)if(copiedList[i].email===email){copiedList.splice(i,1);break}_this.masterMemberList=angular.copy(copiedList),_this.negative=!1,_this.pageSetting.user=[],sharedProperties.setCandidates([]),sharedProperties.setArchivedCandidates(_this.masterMemberList),_this.returnMemberList(_this.pageSetting.pageSize),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidate"))}else null!==response.error&&sharedProperties.ajaxError(response)})}function getFilterValue(){var userStatus=[],tagListArray=[],titleFilters=[],arr=[];_this.allMembersEmailId=[];for(var i=0;i<_this.masterMemberList.length;i++)_this.allMembersEmailId.push({email:_this.masterMemberList[i].email}),null!==_this.masterMemberList[i].tagList&&(tagListArray=_this.masterMemberList[i].tagList.concat(tagListArray)),null!==_this.masterMemberList[i].hiringRoles&&(titleFilters=_this.masterMemberList[i].hiringRoles.concat(titleFilters)),null!==_this.masterMemberList[i].userStatus&&userStatus.push({userStatus:_this.masterMemberList[i].userStatus,userFormatted:_this.masterMemberList[i].userStatusFormatted});_this.userStatus=userStatus.filter(function(e){if(-1===arr.indexOf(e.userStatus))return arr.push(e.userStatus),e}),_this.tagListArray=tagListArray.unique(),_this.titleFilters=titleFilters.unique()}function spEmailCheck(email){var emailPattern=/^[a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,4}$/i;_this.existingSPemail=!1,emailPattern.test(email)&&(email,ajaxService.getAjaxResponse({url:_this.services.spEmailCheck,data:$.param({email:email}).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){"true"===response.Success?_this.existingSPemail=!1:null!==response.error&&(_this.existingSPemail=!0)}))}function emailCheckHire(email){var _email,emailPattern=/^[a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,4}$/i;_this.existingCandidateHire=!1,_this.msgKeyHire="",emailPattern.test(email)&&(_email=email,ajaxService.getAjaxResponse({url:_this.services.checkCandidate,data:$.param({candidateEmail:email}).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){if("true"===response.Success){for(var key in response)if(response.hasOwnProperty(key)){if("hiring"!==key&&"hiring-archived"!==key&&-1!==response[key].indexOf(_email)){_this.existingCandidateHire=!0,_this.msgKeyHire=key;break}if(void 0!==response[key][0]&&response[key][0].email===_email){_this.existingCandidateHire=!1,_this.msgKeyHire=key,_this.prismAccess=response[key][0].profileSettings.hiringAccessAllowed;break}_this.existingCandidateHire=!1,_this.msgKeyHire=""}}else null!==response.error&&(_this.existingCandidateHire=!1,_this.msgKeyHire="",sharedProperties.ajaxError(response))}))}function emailCheck(email){var _email,emailPattern=/^[a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,4}$/i;_this.existingCandidate=!1,_this.msgKey="",emailPattern.test(email)&&(_email=email,ajaxService.getAjaxResponse({url:_this.services.checkCandidate,data:$.param({candidateEmail:email}).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){if("true"===response.Success){for(var key in response)if(response.hasOwnProperty(key)){if(-1!==response[key].indexOf(_email)){_this.existingCandidate=!0,_this.msgKey=key;break}if(void 0!==response[key][0]&&response[key][0].email===_email){_this.existingCandidate=!1,_this.msgKey=key,_this.prismAccess=response[key][0].profileSettings.hiringAccessAllowed;break}_this.existingCandidate=!1,_this.msgKey=""}}else null!==response.error&&(_this.existingCandidate=!1,_this.msgKey="",sharedProperties.ajaxError(response))}))}function addNewCandidate(){if(_this.addCandidate.submitted=!1,_this.addCandidate.$valid&&!_this.existingCandidate){var roles=_this.newCandidate.roles.map(function(obj){return obj.text}),tags=_this.newCandidate.tags.map(function(obj){return obj.text}),_data={firstName:_this.newCandidate.firstName,lastName:_this.newCandidate.lastName,email:_this.newCandidate.email,phoneNumber:_this.newCandidate.phoneNumber,webURL:_this.newCandidate.webURL,day:void 0!==_this.newCandidate.dueDate?moment(_this.newCandidate.dueDate,"MM/DD/YYYY").format("D"):0,month:void 0!==_this.newCandidate.dueDate?moment(_this.newCandidate.dueDate,"MM/DD/YYYY").format("M"):0,year:void 0!==_this.newCandidate.dueDate?moment(_this.newCandidate.dueDate,"MM/DD/YYYY").format("Y"):0,roles:void 0!==roles&&roles.length?roles.join(","):"",tags:void 0!==tags&&tags.length?tags.join(","):"",sendInvite:void 0!==_this.newCandidate.dueDate};_this.addCandidate.submitted=!1,ajaxService.getAjaxResponse({url:_this.services.addCandidate,data:$.param(_data).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){"true"===response.Success?(sharedProperties.setCandidates([]),_this.addCandidatesView=!1,_this.getCandidates(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateAdded"))):null!==response.error&&sharedProperties.ajaxError(response)})}else _this.addCandidate.submitted=!0}function checkCandidateSubscriptions(){ajaxService.getAjaxResponse({url:_this.services.subscriptions}).then(function(response){"true"===response.Success?_this.subscriptionCount=response.availableHiringSubscripitons>0?response.availableHiringSubscripitons:0:null!==response.error&&sharedProperties.ajaxError(response)})}function initAddCandidates(){var userRoles=null!==$localStorage.get("loggegdInProfile")?$localStorage.get("loggegdInProfile").member.roles:[];_this.isAccountAdmin=-1!==userRoles.indexOf("AccountAdministrator"),_this.isHiringAdmin=-1!==userRoles.indexOf("Hiring"),_this.addCandidate={},_this.addCandidate.submitted=!1,_this.newCandidate={},_this.isImportForm=!1,_this.existingCandidate=!1,_this.msgKey="",checkCandidateSubscriptions(),checkMemberSubscriptions(),_this.overlayDim={width:$(".new-cols.content-col").width(),height:$(".new-cols.content-col").height()}}function checkMemberSubscriptions(){_this.candidateDetails={},_this.hireSubmitted=!1,ajaxService.getAjaxResponse({url:_this.services.memberSubscriptions,data:$.param({spPlanType:"Primary"})}).then(function(response){"true"===response.Success?_this.memberSubscriptionCount=response.availalbeMemberSubscriptions>0?response.availalbeMemberSubscriptions:0:null!==response.error&&sharedProperties.ajaxError(response)})}function showCandidatesView(){_this.addCandidatesView=!0,_this.isImportForm=!1,_this.isImportList=!1,$('input[name="dueDate1"]').length?$timeout(function(){prepareDueDate()},200):$timeout(function(){prepareDueDate()},500)}function hiringDialogs(type,userObj){_this.deleteMemberInfo=void 0!==userObj?userObj:{},"hire"===type?(resetHireForm(userObj),ngDialog.open({template:_this.modals[_this.memberSubscriptionCount>0?type:"noMember"],scope:$scope})):ngDialog.open({template:_this.modals[type],scope:$scope})}function resetHireForm(obj){_this.existingSPemail=!1,_this.hireSubmitted=!1,_this.candidateDetails={},_this.existingCandidate=!1,_this.msgKey="",void 0!==obj&&(_this.candidateDetails.firstName=obj.firstName,_this.candidateDetails.lastName=obj.lastName,_this.candidateDetails.email=obj.email,_this.candidateDetails.title=obj.title)}function archiveCandidate(email,flag){ajaxService.getAjaxResponse({url:_this.services.archive,data:$.param({candidateEmail:email,isHired:flag})}).then(function(response){if("true"===response.Success){for(var copiedList=angular.copy(_this.masterMemberList),i=copiedList.length-1;i>=0;i--)if(copiedList[i].email===email){copiedList.splice(i,1);break}_this.masterMemberList=angular.copy(copiedList),_this.negative=!1,_this.pageSetting.user=[],sharedProperties.setCandidates(_this.masterMemberList),_this.returnMemberList(_this.pageSetting.pageSize),ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateArchived"))}else null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response))})}function deleteCandidate(email){var selectedUsersEmails=[];if(void 0===email)for(var i=0;i<_this.pageSetting.user.length;i++)selectedUsersEmails.push(_this.pageSetting.user[i].email);ajaxService.getAjaxResponse({url:_this.isArchiveListing?_this.services.deleteArchive:_this.services.delete,data:$.param({candidateEmail:void 0===email?selectedUsersEmails.join():email})}).then(function(response){if("true"===response.Success){var copiedList=angular.copy(_this.masterMemberList);if(void 0!==email){for(var i=copiedList.length-1;i>=0;i--)if(copiedList[i].email===email){copiedList.splice(i,1);break}}else for(var j=copiedList.length-1;j>=0;j--)-1!==selectedUsersEmails.indexOf(copiedList[j].email)&&copiedList.splice(j,1);_this.masterMemberList=angular.copy(copiedList),_this.negative=!1,_this.pageSetting.user=[],_this.isArchiveListing?sharedProperties.setArchivedCandidates(_this.masterMemberList):sharedProperties.setCandidates(_this.masterMemberList),_this.returnMemberList(_this.pageSetting.pageSize),ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateDeleted"))}else null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response))})}function getFormattedDate(dt,flag){if(void 0!==dt&&""!==dt&&null!==dt){var ary=flag?dt.split(" "):dt.split("-"),month=parseInt(ary[1],10),day=ary[2],year=ary[0],monthName=["January","February","March","April","May","June","July","August","September","October","November","December"];return flag?ary[0].substr(0,3)+" "+ary[1]+" "+ary[2]:monthName[month-1].substr(0,3)+" "+day+", "+year}}function getCandidates(){sharedProperties.getCandidates().length?(sharedProperties.setArchivedCandidates([]),processCandidateList(sharedProperties.getCandidates()),$scope.$parent.ctrl.activeView="candidates"):ajaxService.getAjaxResponse({url:_this.services.getCandidates}).then(function(response){"true"===response.Success?(sharedProperties.setArchivedCandidates([]),sharedProperties.setCandidates(response.hiring),processCandidateList(response.hiring),$scope.$parent.ctrl.activeView="candidates"):null!==response.error&&sharedProperties.ajaxError(response)})}function getArchivedCandidates(){sharedProperties.getArchivedCandidates().length?(sharedProperties.setCandidates([]),processCandidateList(sharedProperties.getArchivedCandidates()),$scope.$parent.ctrl.activeView="archives"):ajaxService.getAjaxResponse({url:_this.services.archives}).then(function(response){"true"===response.Success?(sharedProperties.setCandidates([]),sharedProperties.setArchivedCandidates(response["hiring-archived"]),processCandidateList(response["hiring-archived"]),$scope.$parent.ctrl.activeView="archives"):null!==response.error&&sharedProperties.ajaxError(response)})}function processCandidateList(response){_this.masterMemberList=response,_this.returnMemberList(_this.pageSetting.pageSize),_this.candidateListResponse=!0,getFilterValue(),$timeout(function(){prepareDatePicker()},200)}function infinteScroll(pageSize){_this.pageSetting.disabledInfinite||(_this.pageSetting.pageSize=pageSize,pageSize>=_this.masterMemberList.length&&(_this.pageSetting.disabledInfinite=!0,_this.pageSetting.pageSize=_this.masterMemberList.length))}function active(event,setting){_this.pageSetting.lastPredicate=setting.predicate,_this.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,_this.pageSetting.lastPredicate),order(_this.pageSetting.lastPredicate,_this.pageSetting.lastReverse)}function order(predicate,reverse){_this.pageSetting.lastPredicate=predicate,_this.pageSetting.lastReverse=reverse;var orderedList=$filter("orderBy")(_this.memberList,_this.pageSetting.lastPredicate,_this.pageSetting.lastReverse);_this.memberList=function(array,key){if("name"===key){for(var list=[],empty=[],i=0;i<array.length;i++)null!==array[i][key]&&""!==array[i][key]&&void 0!==array[i][key]?list.push(array[i]):empty.push(array[i]);return $.merge(list,empty)}return orderedList}(orderedList,_this.pageSetting.lastPredicate)}function filterWithDateRange(createdDate){if(null===createdDate)return!1;var createDt=moment(createdDate,"MMMM D, YYYY").toDate();return moment(createDt,"MM/DD/YYYY").isBetween(moment(_this.filterFromDate,"MM/DD/YYYY"),moment(_this.filterToDate,"MM/DD/YYYY"),"days","[]")}function returnMemberList(pageSize){_this.pageSetting.pageSize=_this.originalpageSetting.pageSize,_this.pageSetting.disabledInfinite=!1;var result=_this.masterCopy?_this.masterMemberList:_this.memberList;_this.memberList=result.filter(function(e){return(!1!==_this.pageSetting.dateRangeSelected&&filterWithDateRange(e.createdOn)||!1===_this.pageSetting.dateRangeSelected&&e)&&(_this.pageSetting.selectedTitles.length&&filterInArray(_this.pageSetting.selectedTitles,null===e.hiringRoles?[]:e.hiringRoles)||!_this.pageSetting.selectedTitles.length&&e)&&(_this.pageSetting.searchTag.length&&filterInArray(_this.pageSetting.searchTag,null===e.tagList?[]:e.tagList)||!_this.pageSetting.searchTag.length&&e)&&(_this.pageSetting.userStatusSelected.length&&-1!==_this.pageSetting.userStatusSelected.indexOf(e.userStatus)||!_this.pageSetting.userStatusSelected.length&&e)&&sharedProperties.singleElementSearch(_this.pageSetting.textSearching,e,2)}),order(_this.pageSetting.lastPredicate,_this.pageSetting.lastReverse),_this.pageSetting.user.length!==_this.memberList.length&&(_this.negative=!1),_this.masterCopy=!0}function checkAll(){_this.negative?_this.pageSetting.user=[]:_this.pageSetting.user=_this.memberList.map(function(item){return{userId:item.id,email:item.email,name:item.name,title:item.title}})}function filterInArray(tags,array){return array.some(function(v){return-1!==tags.indexOf(v)})}function checkCount(checked){var userLength=_this.pageSetting.user.length;checked?userLength+1===_this.memberList.length?_this.negative=!0:_this.negative=!1:userLength-1===_this.memberList.length?_this.negative=!0:_this.negative=!1}function manageFilterDisplayList(filterSetting){
var existing=$.inArray(filterSetting,_this.selectedFilterList),isArray=$.isArray(_this.pageSetting[filterSetting]),settingLength=_this.pageSetting[filterSetting]?_this.pageSetting[filterSetting].length:0,settingFlag=_this.pageSetting[filterSetting];isArray&&settingLength>0?-1===existing&&_this.selectedFilterList.push(filterSetting):isArray&&0===settingLength?-1!==existing&&_this.selectedFilterList.splice(existing,1):isArray||!1===settingFlag||/false/.test(settingFlag)?isArray||!1!==settingFlag&&!/false/.test(settingFlag)||-1!==existing&&_this.selectedFilterList.splice(existing,1):-1===existing&&_this.selectedFilterList.push(filterSetting)}function clear(classS,property,search){_this.pageSetting[property]=[],_this.manageFilterDisplayList(property),void 0!==search&&(_this.pageSetting[search]=""),$(classS).each(function(v,i){$(this).prop("checked",!1)}),_this.returnMemberList()}function includeCheck(param,setting,cache){var i=$.inArray(param,_this.pageSetting[setting]);i>-1?_this.pageSetting[setting].splice(i,1):(_this.pageSetting[setting].push(param),_this.masterCopy=!cache),_this.manageFilterDisplayList(setting),_this.returnMemberList(_this.pageSetting.pageSize)}var _this=this;_this.services={getCandidates:"/sp/hiring/getAllCandidates",archive:"/sp/hiring/archiveCandidate",delete:"/sp/hiring/deleteCandidate",hire:"/sp/admin/member/addSingle",notification:"/sp/notifications/sendNotificationWithParams",subscriptions:"/sp/hiring/getAvailableSubscriptions",addCandidate:"/sp/hiring/addCandidate",checkCandidate:"/sp/hiring/checkCandidate",archives:"/sp/hiring/getAllArchivedCandidates",deleteArchive:"/sp/hiring/deleteArchiveCandidate",move:"/sp/hiring/moveToCandidate",memberSubscriptions:"/sp/admin/member/availalbeMemberSubscriptions",addMember:"/sp/admin/member/addSingle",reset:"/sp/hiring/multi/reset",upload:"/sp/hiring/multiInviteAddFile",spEmailCheck:"/sp/signup/validateEmail"},_this.modals={archive:"/sp/resources/html/hiring/candidate-archive.html",delete:"/sp/resources/html/hiring/candidate-delete.html",deleteMulti:"/sp/resources/html/hiring/candidates-deleteMultiple.html",hire:"/sp/resources/html/hiring/hire.html",addNew:"/sp/resources/html/hiring/hiring-addAccounts.html",noMember:"/sp/resources/html/hiring/no-members.html"},_this.pageSetting={pageSize:10,lastPredicate:"name",lastReverse:!1,disabledInfinite:!1,dateRangeSelected:!1,selectedTitles:[],userStatusSelected:[],statusInclude:[],searchTag:[],textSearching:"",searchGroupsFilters:"",searchTitlesFilter:"",user:[]},_this.originalpageSetting=angular.copy(_this.pageSetting),_this.masterMemberList=[],_this.memberList=[],_this.allMembersEmailId=[],_this.addCandidate={},_this.addCandidate.submitted=!1,_this.newCandidate={},_this.candidateListResponse=!1,_this.masterCopy=!0,_this.negative=!1,_this.addCandidatesView=!1,_this.subscriptionCount=0,_this.memberSubscriptionCount=0,_this.msgKey="",_this.existingCandidate=!1,_this.msgKeyHire="",_this.existingCandidateHire=!1,_this.prismAccess=!1,_this.userStatus=[],_this.tagListArray=[],_this.titleFilters=[],_this.selectedFilterList=[],_this.isArchiveListing=void 0!==$localStorage.get("archivesView")&&null!==$localStorage.get("archivesView")&&""!==$localStorage.get("archivesView"),_this.hireCandidateForm={},_this.candidateDetails={},_this.hireSubmitted=!1,_this.isImportForm=!1,_this.isImportList=!1,_this.fileDataObj={},_this.importCandidatesList={},_this.importedFileData={},_this.listSubmitted=!1,_this.invalidFileError=!1,_this.allUsersMenu=!1,_this.addAccountsForm={},_this.addAccountsForm.submitted=!1,_this.requestAccounts=0,_this.requestType="members",_this.companyEmail="",_this.currentPageUrl=window.location.href.replace(window.location.hash,""),_this.newDt=new Date,_this.filterToDate=null,_this.filterFromDate=null,_this.dateFilterCheck=!1,_this.dateErrorFrom=!1,_this.dateErrorTo=!1,_this.dateRangeFilter=null,_this.isAccountAdmin=!1,_this.isHiringAdmin=!1,_this.existingSPemail=!1,_this.getCandidates=getCandidates,_this.getArchivedCandidates=getArchivedCandidates,_this.infinteScroll=infinteScroll,_this.returnMemberList=returnMemberList,_this.checkCount=checkCount,_this.active=active,_this.checkAll=checkAll,_this.getFormattedDate=getFormattedDate,_this.hiringDialogs=hiringDialogs,_this.archiveCandidate=archiveCandidate,_this.deleteCandidate=deleteCandidate,_this.showCandidatesView=showCandidatesView,_this.initAddCandidates=initAddCandidates,_this.addNewCandidate=addNewCandidate,_this.emailCheck=emailCheck,_this.getFilterValue=getFilterValue,_this.includeCheck=includeCheck,_this.manageFilterDisplayList=manageFilterDisplayList,_this.clear=clear,_this.sendEmailReminders=sendEmailReminders,_this.moveCandidate=moveCandidate,_this.viewCandidateDetails=viewCandidateDetails,_this.viewCompare=viewCompare,_this.includeDateCheck=includeDateCheck,_this.hireCandidate=hireCandidate,_this.checkMemberSubscriptions=checkMemberSubscriptions,_this.initImportList=initImportList,_this.fileResetService=fileResetService,_this.triggerInput=triggerInput,_this.clearFile=clearFile,_this.importCandidates=importCandidates,_this.clearMinHeight=clearMinHeight,_this.requestForAccounts=requestForAccounts,_this.processAccountRequest=processAccountRequest,_this.closeRest=closeRest,_this.resetHireForm=resetHireForm,_this.spEmailCheck=spEmailCheck,_this.emailCheckHire=emailCheckHire;var prepareDueDate=function(){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),$('input[name="dueDate1"]').daterangepicker({showDropdowns:!1,minDate:moment(),startDate:moment(),locale:{format:"MMM DD, YYYY"},alwaysShowCalendars:!0,autoApply:!0,singleDatePicker:!0,autoUpdateInput:!1,opens:"right"},function(start,end,label){$scope.$apply(function(){_this.newCandidate.dueDate=start.format("MM/DD/YYYY")})})},prepareDatePicker=function(){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),_this.filterFromDate=moment().subtract(30,"days").format("MM/DD/YYYY"),_this.filterToDate=moment().format("MM/DD/YYYY");var ipadView=$(window).width()>767&&$(window).width()<1025;$('input[name="dateRangeFilter"]').daterangepicker({showDropdowns:!1,maxDate:moment(),startDate:moment().subtract(30,"days").toDate(),endDate:moment(),locale:{format:ipadView?"MM/DD/YY":"MMM DD, YYYY"},alwaysShowCalendars:!0,autoApply:!0,opens:"right"},function(start,end,label){$scope.$apply(function(){_this.filterFromDate=start.format("MM/DD/YYYY"),_this.filterToDate=end.format("MM/DD/YYYY")})})}}function candidateDetailsController($scope,ajaxService,$localStorage,$state,$q,sharedProperties,$filter,$rootScope,ngDialog,$timeout){function spEmailCheck(email){var emailPattern=/^[a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,4}$/i;_this.existingSPemail=!1,emailPattern.test(email)&&(email,ajaxService.getAjaxResponse({url:_this.services.spEmailCheck,data:$.param({email:email}).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){"true"===response.Success?_this.existingSPemail=!1:null!==response.error&&(_this.existingSPemail=!0)}))}function emailCheck(email){var _email,emailPattern=/^[a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,4}$/i;_this.existingCandidate=!1,_this.msgKey="",emailPattern.test(email)&&(_email=email,ajaxService.getAjaxResponse({url:_this.services.checkCandidate,data:$.param({candidateEmail:email}).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){if("true"===response.Success){for(var key in response)if(response.hasOwnProperty(key)){if(-1!==response[key].indexOf(_email)){_this.existingCandidate=!0,_this.msgKey=key;break}if(void 0!==response[key][0]&&response[key][0].email===_email){_this.existingCandidate=!1,_this.msgKey=key,_this.prismAccess=response[key][0].profileSettings.hiringAccessAllowed;break}_this.existingCandidate=!1,_this.msgKey=""}}else null!==response.error&&(_this.existingCandidate=!1,_this.msgKey="",sharedProperties.ajaxError(response))}))}function checkMemberSubscriptions(){_this.candidateDetails={},_this.hireSubmitted=!1,ajaxService.getAjaxResponse({url:_this.services.memberSubscriptions,data:$.param({spPlanType:"Primary"})}).then(function(response){"true"===response.Success?_this.memberSubscriptionCount=response.availalbeMemberSubscriptions>0?response.availalbeMemberSubscriptions:0:null!==response.error&&sharedProperties.ajaxError(response)})}function viewCompare(email,id){$scope.$parent.ctrl.switchViews("advisor",!0,email,id,!1)}function hireCandidate(email){_this.hireSubmitted=!1;var memberDetails,tags;!_this.hireCandidateForm.$valid||_this.existingCandidate||_this.existingSPemail?_this.hireSubmitted=!0:(_this.hireSubmitted=!1,tags=void 0!==_this.candidateDetails.tags&&_this.candidateDetails.tags.length?_this.candidateDetails.tags.map(function(obj){return obj.text}):"",memberDetails={firstName:_this.candidateDetails.firstName,lastName:_this.candidateDetails.lastName,title:_this.candidateDetails.title,email:_this.candidateDetails.email,groupAssociationList:"",tagList:void 0!==tags&&tags.length?tags.join(","):tags},ajaxService.getAjaxResponse({url:_this.services.archive,data:$.param({candidateEmail:email,isHired:!0})}).then(function(response){"true"===response.Success?ajaxService.getAjaxResponse({url:_this.services.addMember,data:$.param(memberDetails)}).then(function(response){if("true"===response.Success)_this.existingCandidate=!1,_this.msgKey="",sharedProperties.setCandidates([]),sharedProperties.setArchivedCandidates([]),_this.closeMemberSection(),ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.memberAdded"));else if(null!==response.error){var errorMessage="";for(var key in response)if("object"==typeof(errorMessage=response[key])){for(var k in errorMessage)if(errorMessage.hasOwnProperty(k)&&errorMessage[k]){sharedProperties.growlMessage(errorMessage[k],$rootScope.pullInterNationalization("service.growl.alert"),"glyphicon glyphicon-ban-circle");break}}else errorMessage&&sharedProperties.growlMessage(errorMessage,$rootScope.pullInterNationalization("service.growl.alert"),"glyphicon glyphicon-ban-circle");ngDialog.close()}}):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response))}))}function resetHireForm(obj){_this.existingSPemail=!1,_this.hireSubmitted=!1,_this.candidateDetails={},_this.existingCandidate=!1,_this.msgKey="",void 0!==obj&&(_this.candidateDetails.firstName=obj.firstName,_this.candidateDetails.lastName=obj.lastName,_this.candidateDetails.email=obj.email,_this.candidateDetails.title=obj.title)}function moveCandidate(email){ajaxService.getAjaxResponse({url:_this.services.move,data:$.param({candidateEmail:email})}).then(function(response){"true"===response.Success?(sharedProperties.setCandidates([]),sharedProperties.setArchivedCandidates([]),_this.closeMemberSection(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidate"))):null!==response.error&&sharedProperties.ajaxError(response)})}function hiringDialogs(type,userObj){_this.deleteMemberInfo=void 0!==userObj?userObj:{},"hire"===type?(resetHireForm(userObj),ngDialog.open({template:_this.modals[_this.memberSubscriptionCount>0?type:"noMember"],scope:$scope})):ngDialog.open({template:_this.modals[type],scope:$scope})}function archiveCandidate(email,flag){ajaxService.getAjaxResponse({url:_this.services.archive,data:$.param({candidateEmail:email,isHired:flag})}).then(function(response){"true"===response.Success?(sharedProperties.setCandidates([]),sharedProperties.setArchivedCandidates([]),_this.closeMemberSection(),ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateArchived"))):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response))})}function deleteCandidate(email){ajaxService.getAjaxResponse({url:_this.archivedUserProfile?_this.services.deleteArchive:_this.services.delete,data:$.param({candidateEmail:email})}).then(function(response){"true"===response.Success?(_this.archivedUserProfile?sharedProperties.setArchivedCandidates([]):sharedProperties.setCandidates([]),_this.closeMemberSection(),ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateDeleted"))):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response))})}function formatDt(dt){var yy=dt.getFullYear(),mm=parseInt(dt.getMonth()+1,10)<10?"0"+(dt.getMonth()+1):dt.getMonth()+1,dd=dt.getDate();return{"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"}[mm.toString()]+", "+dd+" "+yy}function deleteComment(i){ajaxService.getAjaxResponse({url:_this.services.removeComment,data:$.param({candidateEmail:_this.storedEmail,index:i})}).then(function(response){if("true"===response.Success){for(var list=angular.copy(_this.candidateCommentsList),j=0;j<list.length;j++)if(j===i){list.splice(j,1);break}_this.candidateCommentsList=angular.copy(list),_this.candidateCommentsListBackup=angular.copy(_this.candidateCommentsList),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.commentDeletedSuccess"))}else null!==response.error&&sharedProperties.ajaxError(response)})}function updateComment(i){_this.commentSubmitted[i]=!1,""!==_this.commentInputs[i]&&null!==_this.commentInputs[i]&&void 0!==_this.commentInputs[i]?(_this.commentSubmitted[i]=!1,ajaxService.getAjaxResponse({url:_this.services.updateComment,data:$.param({candidateEmail:_this.storedEmail,index:i,comment:_this.commentInputs[i]})}).then(function(response){if("true"===response.Success){for(var list=angular.copy(_this.candidateCommentsList),j=0;j<list.length;j++)if(j===i){list[j].comment=_this.commentInputs[i];break}_this.candidateCommentsList=angular.copy(list),_this.candidateCommentsListBackup=angular.copy(_this.candidateCommentsList),_this.editComment(i),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.commentUpdatedSuccess"))}else null!==response.error&&sharedProperties.ajaxError(response)})):_this.commentSubmitted[i]=!0}function editComment(i){i===_this.selectedComment?_this.selectedComment=-1:_this.selectedComment=i}function addComment(){_this.newCommentSubmit=!1,_this.addCommentForm.$valid?(_this.newCommentSubmit=!1,ajaxService.getAjaxResponse({url:_this.services.addComment,data:$.param({candidateEmail:_this.storedEmail,comment:_this.newComment})}).then(function(response){"true"===response.Success?(_this.newComment="",getCandidateDetails(_this.storedEmail,_this.candidateId),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.commentPostedSuccess"))):null!==response.error&&sharedProperties.ajaxError(response)})):_this.newCommentSubmit=!0}function updateWebLink(){_this.linkSubmitted=!1,_this.candidateExp.$valid?(_this.linkSubmitted=!1,_this.linkEditing=!1,ajaxService.getAjaxResponse({url:_this.services.updateLink,data:$.param({candidateEmail:_this.storedEmail,webUrl:_this.webLink}).replace(/%40/g,"@").replace(/%2C/g,",")}).then(function(response){"true"===response.Success?(sharedProperties.setCandidates([]),sharedProperties.setArchivedCandidates([]),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.experienceUpdated")),getCandidateDetails(_this.storedEmail,_this.candidateId)):null!==response.error&&sharedProperties.ajaxError(response)})):_this.linkSubmitted=!0}function removeTag(type,val){var tList,rList;if("roles"===type){rList=angular.copy(_this.candidateRolesList);for(var i=0;i<rList.length;i++)if(rList[i]===val){rList.splice(i,1),_this.candidateRolesList=angular.copy(rList),updateRolesTags({url:_this.services.updateRoles,data:$.param({hiringRoles:_this.candidateRolesList.join(","),candidateEmail:_this.storedEmail})},type);break}}else if("tags"===type){tList=angular.copy(_this.candidateTagsList);for(var j=0;j<tList.length;j++)if(tList[j]===val){tList.splice(j,1),_this.candidateTagsList=angular.copy(tList),updateRolesTags({url:_this.services.updateTags,data:$.param({tagList:_this.candidateTagsList.join(","),candidateEmail:_this.storedEmail})},type);break}}}function updateRolesTags(options,type){ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?(sharedProperties.growlMessage("tags"===type?$rootScope.pullInterNationalization("growl.tagUpdated"):$rootScope.pullInterNationalization("growl.rolesUpdated")),"tags"===type?_this.candidateTags=[]:"roles"===type&&(_this.candidateRoles=[])):null!==response.error&&sharedProperties.ajaxError(response)})}function updateTag(type){var tags=[],roles=[];if("tags"===type){if(tags=void 0!==_this.candidateTags&&_this.candidateTags.length?_this.candidateTags.map(function(obj){return obj.text}):[],void 0===_this.candidateTags||!_this.candidateTags.length)return;for(var i=0;i<tags.length;i++)-1===_this.candidateTagsList.indexOf(tags[i])?(_this.candidateTagsList.push(tags[i]),updateRolesTags({url:_this.services.updateTags,data:$.param({tagList:_this.candidateTagsList.join(","),candidateEmail:_this.storedEmail})},type)):_this.candidateTagsList.indexOf(tags[i])>-1&&(sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.tagExisting")),_this.candidateTags=[])}else if("roles"===type){if(roles=void 0!==_this.candidateRoles&&_this.candidateRoles.length?_this.candidateRoles.map(function(obj){return obj.text}):[],void 0===_this.candidateRoles||!_this.candidateRoles.length)return;for(var j=0;j<roles.length;j++)-1===_this.candidateRolesList.indexOf(roles[j])?(_this.candidateRolesList.push(roles[j]),updateRolesTags({url:_this.services.updateRoles,data:$.param({hiringRoles:_this.candidateRolesList.join(","),candidateEmail:_this.storedEmail})},type)):_this.candidateRolesList.indexOf(roles[j])>-1&&(sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.roleExisting")),_this.candidateRoles=[])}}function updateMemberProfile(){if(_this.profileSubmitted=!1,_this.memberProfileForm.$valid){_this.profileSubmitted=!1;var profileData={firstName:_this.memberProfile.firstName,lastName:_this.memberProfile.lastName,title:_this.memberProfile.title,email:_this.memberProfile.email,gender:_this.memberProfile.gender,month:_this.memberProfile.month,day:_this.memberProfile.day,year:_this.memberProfile.year,phone:_this.memberProfile.phone,name:_this.memberProfile.firstName+" "+_this.memberProfile.lastName,country:_this.memberProfile.country,address1:_this.memberProfile.addressLine1,address2:_this.memberProfile.addressLine2,city:_this.memberProfile.city,state:_this.memberProfile.state,zip:_this.memberProfile.zipCode,userInitials:_this.memberProfile.firstName.charAt(0)+_this.memberProfile.lastName.charAt(0)};ajaxService.getAjaxResponse({url:_this.services.update,data:$.param(profileData)}).then(function(response){if("true"===response.Success){_this.editProfile=!1,sharedProperties.setCandidates([]),sharedProperties.setArchivedCandidates([]);var temp=angular.copy(_this.memberProfileBackup),newData=$.extend(temp,profileData);newData.zipCode=profileData.zip,newData.addressLine1=profileData.address1,newData.addressLine2=profileData.address2,_this.memberProfileBackup=angular.copy(newData),_this.memberProfile=angular.copy(_this.memberProfileBackup),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateDetailUpdated"))}else null!==response.error&&(sharedProperties.ajaxError(response),cancelUpdateProfile())})}else _this.profileSubmitted=!0}function cancelUpdateProfile(){_this.editProfile=!1,_this.profileSubmitted=!1,_this.memberProfile=angular.copy(_this.memberProfileBackup)}function stateCheck(country){switch(_this.showStatesUS=!1,_this.showStatesCanada=!1,_this.showStatesOthers=!1,country){case"United States":_this.showStatesUS=!0;break;case"Canada":_this.showStatesCanada=!0;break;case"US":_this.showStatesUS=!0;break;case"CA":_this.showStatesCanada=!0;break;default:_this.showStatesUS=!1,_this.showStatesCanada=!1,_this.showStatesOthers=!0}}function resetAddress(){_this.memberProfile.zipCode="",_this.memberProfile.city="",_this.memberProfile.state="",_this.memberProfile.addressLine1="",_this.memberProfile.addressLine2=""}function closeMemberSection(){var v=$localStorage.get("previousView");$scope.$parent.ctrl.switchViews(v)}function initCandidateProfile(){null!==$localStorage.get("previousView")&&""!==$localStorage.get("previousView")&&void 0!==$localStorage.get("previousView")||$localStorage.set("previousView","candidates");var storedUser=$localStorage.get("loggegdInProfile");null!==$localStorage.get("loggegdInProfile")&&$localStorage.get("loggegdInProfile").member.roles;_this.storedEmail=$state.params.cemail.replace(/%2B/g,"+").split("+")[0],_this.candidateId=$state.params.cemail.replace(/%2B/g,"+").split("+")[1],_this.selfEmail=storedUser.member.email,_this.storedUsrObj=$localStorage.get("loggegdInProfile").member,_this.archivedUserProfile=void 0!==$state.params.cemail.replace(/%2B/g,"+").split("+")[2]&&null!==$state.params.cemail.replace(/%2B/g,"+").split("+")[2]&&!1!==$state.params.cemail.replace(/%2B/g,"+").split("+")[2],_this.storedEmail&&(_this.candidateNav="Profile",getCandidateDetails(_this.storedEmail,_this.candidateId)),null!==$localStorage.get("candidateDetailsNav")?_this.candidateNav=$localStorage.get("candidateDetailsNav"):_this.candidateNav="Profile",checkMemberSubscriptions()}function getCandidateDetails(email,id){_this.candidateTagsList=[],_this.candidateRolesList=[],_this.candidateCommentsList=[],_this.candidateCommentsListBackup=[],ajaxService.getAjaxResponse({url:_this.archivedUserProfile?_this.services.getArchiveProfile:_this.services.get,data:$.param({candidateEmail:email,candidateId:id}).replace(/%40/g,"@")}).then(function(response){"true"===response.Success?(_this.memberProfile=$.extend(response.userProfileForm,response.hiring,response.address),_this.memberProfileBackup=angular.copy(_this.memberProfile),_this.candidateTagsList=void 0!==_this.memberProfileBackup.tagList&&null!==_this.memberProfileBackup.tagList&&_this.memberProfileBackup.tagList.length?_this.memberProfileBackup.tagList:[],_this.candidateRolesList=void 0!==_this.memberProfileBackup.hiringRoles&&null!==_this.memberProfileBackup.hiringRoles&&_this.memberProfileBackup.hiringRoles.length?_this.memberProfileBackup.hiringRoles:[],_this.candidateCommentsList=_this.memberProfileBackup.comments.length?_this.memberProfileBackup.comments:[],_this.candidateCommentsListBackup=angular.copy(_this.candidateCommentsList),$localStorage.set("mName",_this.memberProfileBackup.name),_this.archivedUserProfile?_this.assessmentStatus=response.hiring.userStatus:_this.assessmentStatus=response.userProfileForm.userStatus,_this.archivedUserProfile&&(_this.memberProfile.phone=response.hiring.phoneNumber,_this.memberProfile.month=response.hiring.dob[1],_this.memberProfile.day=response.hiring.dob[2],_this.memberProfile.year=response.hiring.dob[0])):null!==response.error&&(sharedProperties.ajaxError(response.error),$scope.$parent.ctrl.switchViews("candidates",!0,"","",!1))}),_this.countries=$localStorage.get("countriesFullList").countries}function setCandidateDetailsView(view){_this.candidateNav=view,$localStorage.set("candidateDetailsNav",view)}var _this=this;_this.services={get:"/sp/hiring/getProfileDetails",getArchiveProfile:"/sp/hiring/getArchivedUserProfileDetails",update:"/sp/hiring/updateProfile",updateRoles:"/sp/hiring/updateRole",updateTags:"/sp/hiring/updateTags",updateLink:"/sp/hiring/updateWebUrl",addComment:"/sp/hiring/addComment",updateComment:"/sp/hiring/updateComment",removeComment:"/sp/hiring/removeComment",archive:"/sp/hiring/archiveCandidate",delete:"/sp/hiring/deleteCandidate",hire:"/sp/admin/member/addSingle",subscriptions:"/sp/hiring/getAvailableSubscriptions",deleteArchive:"/sp/hiring/deleteArchiveCandidate",move:"/sp/hiring/moveToCandidate",addMember:"/sp/admin/member/addSingle",memberSubscriptions:"/sp/admin/member/availalbeMemberSubscriptions",spEmailCheck:"/sp/signup/validateEmail",checkCandidate:"/sp/hiring/checkCandidate"},_this.modals={archive:"/sp/resources/html/hiring/candidate-archive.html",delete:"/sp/resources/html/hiring/candidate-delete.html",hire:"/sp/resources/html/hiring/hire.html",noMember:"/sp/resources/html/hiring/no-members.html"},_this.candidateNav="Profile",_this.memberProfile={},_this.memberProfileBackup={},_this.storedEmail="",_this.selfEmail="",_this.storedUsrObj="",_this.candidateId="",_this.editProfile=!1,_this.profileSubmitted=!1,_this.memberProfileForm={},_this.candidateTags=[],_this.candidateRoles=[],_this.candidateTagsList=[],_this.candidateRolesList=[],_this.linkSubmitted=!1,_this.webLink="",_this.candidateExp={},_this.webLink="",_this.linkEditing=!1,_this.candidateCommentsList=[],_this.candidateCommentsListBackup=[],_this.addCommentForm={},_this.newComment="",_this.newCommentSubmit=!1,_this.currentDt=formatDt(new Date),_this.selectedComment=-1,_this.commentInputs=[],_this.commentForms=[],_this.commentSubmitted=[],_this.archivedUserProfile=!1,_this.hireCandidateForm={},_this.candidateDetails={},_this.hireSubmitted=!1,_this.memberSubscriptionCount=0,_this.existingSPemail=!1,_this.existingCandidate=!1,_this.msgKey="",_this.initCandidateProfile=initCandidateProfile,_this.getCandidateDetails=getCandidateDetails,_this.closeMemberSection=closeMemberSection,_this.setCandidateDetailsView=setCandidateDetailsView,_this.updateMemberProfile=updateMemberProfile,_this.cancelUpdateProfile=cancelUpdateProfile,_this.stateCheck=stateCheck,_this.resetAddress=resetAddress,_this.updateTag=updateTag,_this.removeTag=removeTag,_this.updateRolesTags=updateRolesTags,_this.updateWebLink=updateWebLink,_this.addComment=addComment,_this.editComment=editComment,_this.updateComment=updateComment,_this.deleteComment=deleteComment,_this.hiringDialogs=hiringDialogs,_this.deleteCandidate=deleteCandidate,_this.archiveCandidate=archiveCandidate,_this.moveCandidate=moveCandidate,_this.resetHireForm=resetHireForm,_this.hireCandidate=hireCandidate,_this.viewCompare=viewCompare,_this.checkMemberSubscriptions=checkMemberSubscriptions,_this.spEmailCheck=spEmailCheck,_this.emailCheck=emailCheck}function confirmEmailCheck(){return{restrict:"A",require:"?ngModel",link:function(scope,elem,attrs,ngModel){if(ngModel){scope.$watch(attrs.ngModel,function(){validate()}),attrs.$observe("confirmEmailCheck",function(val){validate()});var validate=function(){var val1=ngModel.$viewValue,val2=attrs.confirmEmailCheck;ngModel.$setValidity("confirmEmailCheck",!val1||!val2||val1===val2)}}}}}angular.module("spApp").controller("manageHiring",manageHiring),angular.module("spApp").controller("candidatesListing",candidatesListing),angular.module("spApp").controller("candidateDetailsController",candidateDetailsController),angular.module("spApp").controller("manageImportListCtrl",manageImportListCtrl),manageHiring.$inject=["$scope","ajaxService","$localStorage","$state","$q","sharedProperties","$filter","$rootScope","ngDialog","$timeout"],manageImportListCtrl.$inject=["$scope","ajaxService","$localStorage","$state","$q","sharedProperties","$filter","$rootScope","ngDialog","$timeout"],candidatesListing.$inject=["$scope","ajaxService","$localStorage","$state","$q","sharedProperties","$filter","$rootScope","ngDialog","$timeout"],candidateDetailsController.$inject=["$scope","ajaxService","$localStorage","$state","$q","sharedProperties","$filter","$rootScope","ngDialog","$timeout"],angular.module("spApp").directive("confirmEmailCheck",confirmEmailCheck);