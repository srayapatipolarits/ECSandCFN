function assessmentController($scope,ajaxService,$timeout,$rootScope,$localStorage,sharedProperties){function configServices(page){if("assessment360"===page){_this.analyticsPageView="PrismLens";var getLink=window.location.href.split("/"),id=getLink[getLink.length-1];_this.page="assessment360",_this.services={start:"/sp/assessment360/start/"+id,next:"/sp/assessment360/process/"+id,previous:"/sp/assessment360/previous/"+id,redirect:"/sp/external/thankyou"},_this.startAssessment()}else"hiringUser"===page?(_this.analyticsPageView="HiringAssessment",_this.services={start:"/sp/assessment/start",next:"/sp/assessment/process",previous:"/sp/assessment/previous",redirect:"/sp/thankYou"},_this.startAssessment()):(_this.analyticsPageView="MemberAssessment",_this.services={start:"/sp/assessment/start",next:"/sp/assessment/process",previous:"/sp/assessment/previous",redirect:"/sp/assessment/completed"},_this.startAssessment())}function resetBtnFlags(){$scope.nextBtn={enable:!1,isClickable:!1},$scope.prevBtn={enable:!0,isClickable:!1,visible:!0}}function generateRandomOrder(ans,type,action,ansMap){var answerSet=[],count=0,randomNo=null,tempArray=[],ansLen=ans.length,count1=0,keyMap=ansMap;if(angular.forEach(ans,function(value,index){answerSet.push({aNo:index,aDesc:value,aDef:"PersonalityRating"===type?"assessment360"===_this.page?$rootScope.pullInterNationalization("assessmentDefinitionsLens."+("undefined"!=typeof keyMap[value]&&null!==keyMap[value]&&""!==keyMap[value]?keyMap[value].replace(/ /g,"").replace(/-/g,""):null)):$rootScope.pullInterNationalization("assessmentDefinitions."+("undefined"!=typeof keyMap[value]&&null!==keyMap[value]&&""!==keyMap[value]?keyMap[value].replace(/ /g,"").replace(/-/g,""):null)):null}),count++}),count===ansLen){if(count1=answerSet.length,"next"!==action&&"start"!==action){if("MultipleChoice"===type&&4===ansLen)return answerSet;if("MultipleChoice"===type&&ansLen<4){var key="S"+_this.sectionDetails.number+"Q"+_this.questionDetails.number;return _this.trackAnswers[key]?_this.trackAnswers[key]:answerSet}return answerSet}if("MultipleChoice"===type&&4===ansLen)return answerSet;if("MultipleChoice"===type&&ansLen<4){if(angular.forEach(answerSet,function(v,i){randomNo=Math.floor(Math.random()*count1),count1--,tempArray=answerSet[count1],answerSet[count1]=answerSet[randomNo],answerSet[randomNo]=tempArray}),0===count1)return answerSet}else if(angular.forEach(answerSet,function(v,i){randomNo=Math.floor(Math.random()*count1),count1--,tempArray=answerSet[count1],answerSet[count1]=answerSet[randomNo],answerSet[randomNo]=tempArray}),0===count1)return answerSet}}function progress(sectionNo,questionNo){for(var currentSection=sectionNo,currentQuestion=questionNo,totalQuestions=(_this.totalCategories,_this.totalQuestions),categoriesList=_this.categoriesList,completedQuestions=0,precentageCompleted=0,j=0;j<currentSection;j++)completedQuestions+=categoriesList[j].totalQuestions;completedQuestions+=currentQuestion,precentageCompleted=Math.floor(completedQuestions/totalQuestions*100),$scope.nextBtnText=1===parseInt(totalQuestions-completedQuestions)?$rootScope.pullInterNationalization("assessment.bnt3"):$rootScope.pullInterNationalization("assessment.btn1"),_this.isLastQuestion=1===parseInt(totalQuestions-completedQuestions),_this.progressDetails=precentageCompleted.toFixed(),sharedProperties.fireAnalyticsEvent("Assessment | In Progress",_this.analyticsPageView+" - User answered Section "+parseInt(currentSection+1)+". Question "+currentQuestion+". Completed "+_this.progressDetails+" %")}function startAssessment(){"PrismLens"!==_this.analyticsPageView&&$localStorage.flush(),_this.assessmentLoaded=!1,resetBtnFlags(),ajaxService.getAjaxResponse({url:_this.services.start,delay:600,maximum:1200}).then(function(response){if("true"===response.Success)if(_this.serverError=!1,"undefined"!=typeof response.question){var _r=response;if(_this.assessmentData=response,_this.sectionDetails={number:_r.question.categoryNumber,total:_r.categories.totalCategories,instruction:_r.categories.categoriesList[_r.question.categoryNumber].instruction,totalQuestions:_r.categories.categoriesList[_r.question.categoryNumber].totalQuestions,currentNo:_r.question.categoryNumber+1,nextNo:_r.question.categoryNumber+2},_this.questionDetails={number:_r.question.number,type:_r.question.type,description:_r.question.description,optionList:_r.question.optionsList,optionsKeyMap:_r.question.optionsKeyMap},_this.randomAnswers=_this.generateRandomOrder(_this.questionDetails.optionList,_r.question.type,"start",_this.questionDetails.optionsKeyMap),"MultipleChoice"===_r.question.type&&_r.question.optionsList.length<4){var key="S"+_r.question.categoryNumber+"Q"+_r.question.number;_this.trackAnswers[key]=_this.randomAnswers}$scope.userParams={c:_r.question.categoryNumber,q:_r.question.number},_this.totalCategories=_r.categories.totalCategories;for(var i=0;i<_this.totalCategories;i++)_this.totalQuestions+=_r.categories.categoriesList[i].totalQuestions;_this.categoriesList=_r.categories.categoriesList,progress(_r.question.categoryNumber,_r.question.number),"MultipleChoice"===_r.question.type?$timeout(function(){0===_r.question.number&&0===_r.question.categoryNumber?($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!1):($scope.prevBtn.enable=!0,$scope.prevBtn.visible=!0),$scope.disableOptionSelection=!1},100):$timeout(function(){0===_r.question.number&&0===_r.question.categoryNumber?($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!1):($scope.prevBtn.enable=!0,$scope.prevBtn.visible=!0),$scope.isDragTemplateLoaded=loadDragTemplate(_r,_this.randomAnswers,"next",_this.page)},100),$timeout(function(){_this.assessmentLoaded=!0},100)}else window.location=_this.services.redirect;else _this.serverError=!0,_this.errorMessage=$rootScope.pullInterNationalization("assessment.refreshError")})}function nextQuestion(){$scope.nextBtn.isClickable===!0&&($scope.isDragTemplateLoaded=!1,"undefined"!=typeof sortable&&null!==sortable.el&&sortable.destroy(),_this.prevAnswer=-1,resetBtnFlags(),$scope.disableOptionSelection===!1&&($scope.disableOptionSelection=!0),ajaxService.getAjaxResponse({url:_this.services.next,delay:600,maximum:1200,data:$.param($scope.userParams).replace(/%2C/g,",")}).then(function(response){if("true"===response.Success)if("undefined"!=typeof response.question){var _r=response;if(_this.questionDetails={number:_r.question.number,type:_r.question.type,description:_r.question.description,optionList:_r.question.optionsList,optionsKeyMap:_r.question.optionsKeyMap},_this.randomAnswers=_this.generateRandomOrder(_this.questionDetails.optionList,_r.question.type,"next",_this.questionDetails.optionsKeyMap),"MultipleChoice"===_r.question.type&&_r.question.optionsList.length<4){var key="S"+_r.question.categoryNumber+"Q"+_r.question.number;_this.trackAnswers[key]=_this.randomAnswers}_this.sectionDetails={number:_r.question.categoryNumber,instruction:_this.assessmentData.categories.categoriesList[_r.question.categoryNumber].instruction},_r.question.categoryNumber+1<=_this.totalCategories&&(_this.sectionDetails.currentNo=_r.question.categoryNumber+1,9===_this.sectionDetails.currentNo?_this.sectionDetails.nextNo="":_this.sectionDetails.nextNo=_r.question.categoryNumber+2),progress(_r.question.categoryNumber,_r.question.number),$scope.userParams={c:_r.question.categoryNumber,q:_r.question.number},"MultipleChoice"===_r.question.type?$timeout(function(){0===_r.question.number&&0===_r.question.categoryNumber?($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!1):($scope.prevBtn.enable=!0,$scope.prevBtn.visible=!0),$scope.disableOptionSelection=!1},100):$timeout(function(){0===_r.question.number&&0===_r.question.categoryNumber?($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!1):($scope.prevBtn.enable=!0,$scope.prevBtn.visible=!0),$scope.isDragTemplateLoaded=loadDragTemplate(_r,_this.randomAnswers,"next",_this.page)},100)}else sharedProperties.fireAnalyticsEvent("Assessment | Completed",_this.analyticsPageView),window.location=_this.services.redirect;else _this.serverError=!0,_this.errorMessage=$rootScope.pullInterNationalization("assessment.refreshError")}))}function previousQuestion(){$scope.prevBtn.isClickable===!1&&($scope.isDragTemplateLoaded=!1,"undefined"!=typeof sortable&&null!==sortable.el&&sortable.destroy(),resetBtnFlags(),$scope.prevBtn.enable=!1,$scope.prevBtn.isClickable=!0,$scope.disableOptionSelection===!1&&($scope.disableOptionSelection=!0),ajaxService.getAjaxResponse({url:_this.services.previous,delay:600,maximum:1200}).then(function(response){if("true"===response.Success)if("undefined"!=typeof response.question){var _r=response;"MultipleChoice"===_r.question.type?_this.prevAnswer=_r.lastAnswer[0]:_this.prevAnswer=_r.lastAnswer,_this.questionDetails={number:_r.question.number,type:_r.question.type,description:_r.question.description,optionList:_r.question.optionsList,optionsKeyMap:_r.question.optionsKeyMap},_this.randomAnswers=_this.generateRandomOrder(_this.questionDetails.optionList,_r.question.type,"previous",_this.questionDetails.optionsKeyMap),_this.sectionDetails={number:_r.question.categoryNumber,instruction:_this.assessmentData.categories.categoriesList[_r.question.categoryNumber].instruction},_r.question.categoryNumber+1<=_this.totalCategories&&(_this.sectionDetails.currentNo=_r.question.categoryNumber+1,9===_this.sectionDetails.currentNo?_this.sectionDetails.nextNo="":_this.sectionDetails.nextNo=_r.question.categoryNumber+2),progress(_r.question.categoryNumber,_r.question.number),$scope.userParams={c:_r.question.categoryNumber,q:_r.question.number,a:_r.lastAnswer},"MultipleChoice"===_r.question.type?$timeout(function(){0===_r.question.number&&0===_r.question.categoryNumber?($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!1):($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!0),$scope.disableOptionSelection=!1},100):$timeout(function(){0===_r.question.number&&0===_r.question.categoryNumber?($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!1):($scope.prevBtn.enable=!0,$scope.prevBtn.visible=!0),$scope.isDragTemplateLoaded=loadDragTemplate(_r,_this.randomAnswers,"previous",_this.page)},100)}else window.location=_this.services.redirect;else _this.serverError=!0,_this.errorMessage=$rootScope.pullInterNationalization("assessment.refreshError")}))}var _this=this;_this.assessmentLoaded=!1,_this.serverError=!1,_this.totalCategories=0,_this.totalQuestions=0,_this.prevAnswer=-1,_this.page="",_this.isLastQuestion=!1,_this.configServices=configServices,_this.startAssessment=startAssessment,_this.nextQuestion=nextQuestion,_this.previousQuestion=previousQuestion,_this.generateRandomOrder=generateRandomOrder,_this.services={},_this.sectionDetails={},_this.progressDetails={},_this.questionDetails={},_this.assessmentData={},_this.randomAnswers={},_this.trackAnswers=[],_this.analyticsPageView="",$scope.nextBtn={enable:!1,isClickable:!1},$scope.prevBtn={enable:!1,isClickable:!1,visible:!0},$scope.userParams={},$scope.nextBtnText=$rootScope.pullInterNationalization("assessment.btn1"),$scope.disableOptionSelection=!1,$scope.isDragTemplateLoaded=!1}function loadDragTemplate(r,rAns,d,pageCheck){$("#drag-list").html("");var counter,previousAns,oList=rAns,type=(r.question.number,r.question.type),oListLength=r.question.optionsList.length,isTemplateLoaded=!1,isAssessment360="assessment360"===pageCheck;if("next"===d)counter=0,$.each(oList,function(i){"PersonalityRating"===type?$("#drag-list").append('<div data-opt="option-'+oList[i].aNo+'" class="draggable-wrapper"><p class="definitions-wrapper active"><span>'+oList[i].aDesc+'<span class="definitions">'+oList[i].aDef+"</span></span></p></div>"):$("#drag-list").append('<div data-opt="option-'+oList[i].aNo+'" class="draggable-wrapper"><p><span>'+oList[i].aDesc+"</span></p></div>"),counter++});else if("previous"===d)if(previousAns=r.lastAnswer,"PersonalityRating"!==type)counter=0,$.each(previousAns,function(i){var _index=previousAns[i];isAssessment360?$("#drag-list").append('<div data-opt="option-'+oList[parseInt(_index)].aNo+'" class="draggable-wrapper"><p class="definitions-wrapper active"><span>'+oList[parseInt(_index)].aDesc+'<span class="definitions">'+oList[parseInt(_index)].aDef+"</span></span></p></div>"):$("#drag-list").append('<div data-opt="option-'+oList[parseInt(_index)].aNo+'" class="draggable-wrapper"><p><span>'+oList[parseInt(_index)].aDesc+"</span></p></div>"),counter++});else{var indexArray=[0,1,2,3],missingAns=[];$.each(indexArray,function(i,j){var ansIndex=$.inArray(indexArray[i],previousAns);ansIndex<0&&missingAns.push(i)}),"PersonalityRating"===type?($("#drag-list").append('<div data-opt="option-'+oList[parseInt(previousAns[0])].aNo+'" class="draggable-wrapper"><p class="definitions-wrapper active"><span>'+oList[parseInt(previousAns[0])].aDesc+'<span class="definitions">'+oList[parseInt(previousAns[0])].aDef+"</span></span></p></div>"),$("#drag-list").append('<div data-opt="option-'+oList[parseInt(missingAns[0])].aNo+'" class="draggable-wrapper"><p class="definitions-wrapper active"><span>'+oList[parseInt(missingAns[0])].aDesc+'<span class="definitions">'+oList[parseInt(missingAns[0])].aDef+"</span></span></p></div>"),$("#drag-list").append('<div data-opt="option-'+oList[parseInt(missingAns[1])].aNo+'" class="draggable-wrapper"><p class="definitions-wrapper active"><span>'+oList[parseInt(missingAns[1])].aDesc+'<span class="definitions">'+oList[parseInt(missingAns[1])].aDef+"</span></span></p></div>"),$("#drag-list").append('<div data-opt="option-'+oList[parseInt(previousAns[1])].aNo+'" class="draggable-wrapper"><p class="definitions-wrapper active"><span>'+oList[parseInt(previousAns[1])].aDesc+'<span class="definitions">'+oList[parseInt(previousAns[1])].aDef+"</span></span></p></div>")):($("#drag-list").append('<div data-opt="option-'+oList[parseInt(previousAns[0])].aNo+'" class="draggable-wrapper"><p><span>'+oList[parseInt(previousAns[0])].aDesc+"</span></p></div>"),$("#drag-list").append('<div data-opt="option-'+oList[parseInt(missingAns[0])].aNo+'" class="draggable-wrapper"><p><span>'+oList[parseInt(missingAns[0])].aDesc+"</span></p></div>"),$("#drag-list").append('<div data-opt="option-'+oList[parseInt(missingAns[1])].aNo+'" class="draggable-wrapper"><p><span>'+oList[parseInt(missingAns[1])].aDesc+"</span></p></div>"),$("#drag-list").append('<div data-opt="option-'+oList[parseInt(previousAns[1])].aNo+'" class="draggable-wrapper"><p><span>'+oList[parseInt(previousAns[1])].aDesc+"</span></p></div>")),counter=4}if(counter===oListLength)return isTemplateLoaded=!0}function optionSelection($rootScope,$timeout){return{restrict:"A",link:function($scope,$element,$attrs){var optionSelectionEvent=function(){$("#assessmentTemplate1").find(".assessment-opts").removeClass("red-shadow"),$("#assessmentTemplate1").off("click").on("click",".answer-options",function(){if($scope.disableOptionSelection!==!1)return!1;var i=$(this).attr("data-option");$("#assessmentTemplate1").find(".assessment-opts").removeClass("red-shadow"),$(this).find(".assessment-opts").addClass("red-shadow"),$scope.userParams.a=i,$scope.$apply(function(){$scope.nextBtn.enable=!1,$scope.nextBtn.isClickable=!0}),$scope.prevBtn.isClickable||$scope.$parent.ctrl.isLastQuestion?$scope.$apply(function(){$scope.nextBtn.enable=!0}):($scope.nextBtn.enable=!1,$timeout(function(){$scope.$parent.ctrl.nextQuestion()},200))}),parseInt($("#assessmentTemplate1").attr("data-prev"))!==-1&&$timeout(function(){var i=parseInt($("#assessmentTemplate1").attr("data-prev"));$("#assessmentTemplate1").find('.answer-options[data-option="'+i+'"]').trigger("click")},100)};$scope.$last===!0&&optionSelectionEvent(),$scope.$watch(function(){return $attrs.question},function(){$scope.$last===!0&&optionSelectionEvent()})}}}function setupLayout(){var maxHeight,maxWidth,dragSlidesHeights=[],dragSlidesWidths=[],labelCont=$("#drag-list").prev(),draggableCont=$("#drag-list"),backLabels=$("#drag-list").next();$.each(draggableCont.find("div"),function(i,j){dragSlidesHeights.push($(this).outerHeight()),dragSlidesWidths.push($(this).outerWidth()),$(this).attr("style","").removeClass("active")}),maxHeight=Math.max.apply(Math,dragSlidesHeights),maxWidth=Math.max.apply(Math,dragSlidesWidths),$.each(draggableCont.find("div"),function(i,j){$(this).find("p").css({height:maxHeight})}),$.each(labelCont.find("div"),function(i,j){$(this).attr("style","").removeClass("active"),$(this).css({height:maxHeight}),$(this).find("p").css({height:maxHeight})}),$.each(backLabels.find("div.assessment-opts"),function(i,j){$(this).attr("style",""),$(this).css({height:maxHeight})})}function dragEnabledTemplate($rootScope,$timeout){return{restrict:"A",link:function($scope,$element,$attrs){var trackListOrder=function(){var updatedListOrder=[],list=$("#drag-list").find("div"),counter=0;$scope.nextBtn.enable=!1,$scope.nextBtn.isClickable=!1,$scope.prevBtn.enable=!1,$scope.prevBtn.isClickable=!0,$scope.$apply(),$.each(list,function(i,j){"undefined"!=typeof $(this).attr("data-opt").split("-")[1]&&(updatedListOrder.push($(this).attr("data-opt").split("-")[1]),counter++)}),counter===list.length&&("personalityrating"===$("#drag-list").attr("data-type").toLowerCase()?$scope.userParams.a=updatedListOrder[0]+","+updatedListOrder[3]:$scope.userParams.a=updatedListOrder.join(),$timeout(function(){parseInt($("#drag-list").attr("data-prev"))===-1?($scope.prevBtn.enable=!0,$scope.prevBtn.isClickable=!1):($scope.prevBtn.enable=!1,$scope.prevBtn.isClickable=!0),$scope.nextBtn.enable=!0,$scope.nextBtn.isClickable=!0,$scope.$apply()},300))},initSortable=function(){var el=document.getElementById("drag-list");sortable=Sortable.create(el,{ghostClass:"is-dragging",scroll:!1,onStart:function(){$scope.nextBtn.enable=!1,$scope.nextBtn.isClickable=!1,$scope.prevBtn.enable=!1,$scope.prevBtn.isClickable=!0,$scope.$apply()},onEnd:function(evt){$timeout(function(){trackListOrder()},300)}})};$scope.isDragTemplateLoaded&&($timeout.cancel(),$timeout(function(){trackListOrder(),setupLayout(),initSortable()},300)),$scope.$watch(function(){return $attrs.tmpl},function(){$timeout.cancel(),$scope.isDragTemplateLoaded&&$timeout(function(){trackListOrder(),setupLayout(),initSortable()},300)})}}}function assessmentVideoCtrl($scope,$timeout,$rootScope,ngDialog,sharedProperties,$localStorage){function videoPopUp(url){sharedProperties.fireAnalyticsEvent("Assessment | Watch Intro Video","N/A"),sharedProperties.videoPopUp(url)}var _this=this;_this.videoPopUp=videoPopUp,_this.setParam=sessionStorage.getItem("langParam"),_this.init=function(){if(null!==_this.setParam&&""!==_this.setParam&&void 0!==_this.setParam){var url=window.location.href+"?lang="+_this.setParam;$timeout(function(){sessionStorage.clear(),$localStorage.flush(),window.location=url},100)}},_this.init()}function assessmentHeader($timeout){return{restrict:"A",link:function($scope,$element,$attrs){var addAssessmentBrdr=function(){var isAssessment=$(".assessment-template-wrapper"),isNonLogged=$(".non-logged-header"),theHeaderAssessment=$("#header"),signInPage=$(".sign-in-default");signInPage.length||"#/reset"===window.location.hash?theHeaderAssessment.addClass("signInBorder"):(isAssessment.length||isNonLogged.length)&&(window.localStorage.clear(),theHeaderAssessment.addClass("addOrangeBrdr"))};addAssessmentBrdr(),$scope.$watch(function(){return $attrs.ready},function(){$timeout(function(){addAssessmentBrdr()},100)})}}}angular.module("spApp").controller("assessmentController",assessmentController);var sortable;assessmentController.$inject=["$scope","ajaxService","$timeout","$rootScope","$localStorage","sharedProperties"],angular.module("spApp").directive("optionSelection",optionSelection),optionSelection.$inject=["$rootScope","$timeout"],angular.module("spApp").directive("dragEnabledTemplate",dragEnabledTemplate),dragEnabledTemplate.$inject=["$rootScope","$timeout"],angular.module("spApp").controller("assessmentVideoCtrl",assessmentVideoCtrl),assessmentVideoCtrl.$inject=["$scope","$timeout","$rootScope","ngDialog","sharedProperties","$localStorage"],angular.module("spApp").directive("assessmentHeader",assessmentHeader),assessmentHeader.$inject=["$timeout"];