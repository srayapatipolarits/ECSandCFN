function createPulseController($scope,$element,$attrs,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage,FileUploader,$filter){$scope.createNewPulse={},$scope.newPulse={},$scope.createNewPulse.validationErrors=!1,$scope.fileUploadException=!1,$scope.newPulse.status="Active",$scope.accountsListException=!1,$scope.updatedAccountListing=[],$scope.selectedAccountsCount=0,$scope.updatedListingIndex=0,$scope.accountList={},$scope.selectedCompanyIdList=[],$scope.pulseFileUploadStatus=!1,$scope.allAccountsIdList=[],$scope.createNewPulseException=!1,$scope.filteredAccountListing={},$scope.mapQuestionObject=[],$scope.triggerOpenFile=function(){jQuery("body").find("#selectFile").click()},$scope.uploader=new FileUploader({url:"/sp/sysAdmin/pulse/createPulseFile",autoUpload:!0,alias:"pulseQuestionSet",onSuccessItem:function(item,response){if($scope.fileUploadException=!1,$scope.pulseFileUploadStatus=!1,null===response.error)$scope.fileUploadException=!1,$scope.pulseFileUploadStatus=!0,$scope.pulseFileName=item._file.name,$scope.questionList=response.success.pulseQuestion,$scope.questionSet(),$scope.pulseDrop=$scope.questionList.categoryKeys,$timeout(function(){$scope.defaultPulseName=0},0),$scope.noChart($scope.pulseDrop,0);else{$scope.pulseFileName=null,$scope.fileUploadException=!0,$scope.pulseFileUploadStatus=!1;for(var key in response.error)$scope.fileUploadExceptionMessage=response.error[key]}}}),$scope.defaultPulse=function(_this){$scope.noChart($scope.pulseDrop,$scope.defaultPulseName)},$scope.increment=function(){return $scope.defaultPulseName++,!0},$scope.decrement=function(){return $scope.defaultPulseName--,!0},$scope.questionSet=function(){"questions"in $scope.questionList&&($scope.mapQuestionObject=$scope.questionList.questions[$scope.activePulse])},$scope.noChart=function(arrayList,index){arrayList.length&&$scope.noChartPulse(arrayList[index])},$scope.noChartPulse=function(keyName){$scope.activePulse=keyName,$scope.mapQuestionObject=$scope.questionList.questions[keyName]},$scope.getAccountList=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/hk/getCompanyList",method:"GET"}).then(function(response){if("true"===response.Success)$scope.accountsListException=!1,$scope.accountListing=response.companies,jQuery.each($scope.accountListing,function(i,j){$scope.updatedAccountListing.push(jQuery.extend({},$scope.accountListing[i],{accountSelectedStatus:!1})),$scope.allAccountsIdList.push($scope.accountListing[i].id)});else{$scope.accountsListException=!0;for(var key in response.error)$scope.accountsListExceptionMsg=response.error[key]}})},$scope.addtoSelectedAccounts=function(id){jQuery.each($scope.updatedAccountListing,function(i){if($scope.updatedAccountListing[i].id===id)return $scope.updatedAccountListing[i].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[i].id),$scope.updatedAccountListing[i].updatedListingIndex=$scope.updatedListingIndex++,!1})},$scope.removeFromSelectedAccounts=function(id){jQuery.each($scope.updatedAccountListing,function(i){if($scope.updatedAccountListing[i].id===id)return $scope.updatedAccountListing[i].accountSelectedStatus=!1,$scope.selectedAccountsCount-=1,$scope.selectedCompanyIdList.splice($scope.selectedCompanyIdList.indexOf(id),1),!1})},$scope.removeAllSelectedAccounts=function(){jQuery.each($scope.updatedAccountListing,function(i){$scope.updatedAccountListing[i].accountSelectedStatus=!1,$scope.updatedAccountListing[i].updatedListingIndex=null}),$scope.selectedAccountsCount=0,$scope.selectedCompanyIdList=[]},$scope.addFilteredAccounts=function(){var selectedList=$filter("filter")($scope.updatedAccountListing,$scope.accountList.search);jQuery.each(selectedList,function(i){jQuery.each($scope.updatedAccountListing,function(j){selectedList[i].id===$scope.updatedAccountListing[j].id&&($scope.updatedAccountListing[j].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[j].id),$scope.updatedAccountListing[j].updatedListingIndex=$scope.updatedListingIndex++)})}),$scope.accountList.search=null},$scope.generateNewPulse=function(fData){var _params;$scope.createNewPulse.validationErrors=!1,$scope.createNewPulseException=!1,"All"===fData.assignAccounts?($scope.accList=$scope.allAccountsIdList,_params={name:fData.name,questionSetType:fData.questionSetType,status:$scope.newPulse.status,forAll:!0}):($scope.accList=$scope.selectedCompanyIdList,_params={name:fData.name,questionSetType:fData.questionSetType,status:$scope.newPulse.status,companyId:$scope.accList.join(),forAll:!1}),this.createNewPulse.$valid&&!0===$scope.pulseFileUploadStatus&&$scope.accList.length>0?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/pulse/createPulse",data:$.param(_params)}).then(function(response){if("true"===response.Success)$scope.createNewPulseException=!1,$localStorage.set("gNotify","AddPulse"),setTimeout(function(){window.location="/sp/sysAdmin/pulse/pulseListings"},100);else{$scope.createNewPulseException=!0;for(var key in response.error)$scope.createNewPulseExceptionMsg=response.error[key]}}):$scope.createNewPulse.validationErrors=!0},$scope.pulsePreview=function(){ngDialog.open({template:"/sp/resources/html/sysAdmin/pulse/pulse-preview.html",scope:$scope})},$scope.cancelRedirect=function(){setTimeout(function(){window.location="/sp/sysAdmin/pulse/pulseListings"},100)},$scope.clearFileStatus=function(){$scope.pulseFileUploadStatus=!1,$scope.pulseFileName=null},function(){$scope.getAccountList()}()}angular.module("spApp").controller("createPulseController",createPulseController),createPulseController.$inject=["$scope","$element","$attrs","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage","FileUploader","$filter"];