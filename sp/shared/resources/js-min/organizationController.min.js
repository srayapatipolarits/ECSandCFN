function organizationAreasController($scope,ajaxService,sharedProperties,$state,$filter,ngDialog,$q,$localStorage,$rootScope,$timeout,$sce){function updateTaskTracker(data){var comp=0,tot=0;data.map(function(obj){comp+=obj.completedActions,tot+=obj.totalActions}),vm.taskTracker={completed:comp,total:tot}}function clearMsgs(data){var list=data.map(function(obj){return obj.uid});ajaxService.getAjaxResponse({url:vm.config.removeMsgs,data:$.param({uidList:list.toString()})}).then(function(response){"true"===response.Success?vm.actionPlanMsgs=[]:null!==response.error&&sharedProperties.ajaxError(response.error)})}function openFeedbackPanel(){var tempObj={id:vm.currentActive.goalId,name:vm.currentActive.name,parentId:vm.actionPlan.id,parentName:vm.actionPlan.name,feature:"OrganizationPlan"};sharedProperties.setFeedbackObjectForPanel(tempObj),tempObj=null}function setContentReference(obj,type){"orgPlanTasks"===type&&(obj.id=vm.currentActive.goalId),obj.parentId=vm.actionPlan.id,obj.pubChannelTitle=vm.currentActive.name,obj.pubChannelDesc=vm.actionPlan.name,obj.overviewText=vm.actionPlanSectionDetail.description;var tempObj={data:obj,type:type};sharedProperties.setContentReference(tempObj),tempObj=null}function showMobileHomePage(){vm.showRightCol=!1,vm.showMobileDD=!1}function openNgOverlay(page,data){void 0!==data&&(vm.devStrategy={id:data.devStrategyId,desc:data.desc}),"manageStratagies"===page&&vm.manageDevelopmentStartegies(),vm.winHeight=$(window).height()+100+"px";ngDialog.open({template:vm.pageTempaltes[page],className:"ngdialog-lnd-theme",scope:$scope})}function changeGroup(){vm.viewDetails(vm.selectedGroup)}function openState(number,text){vm.winWidth>767?(vm.devStrategy.id="",vm.state(number)):(vm.devStrategy.id="",vm.openNgOverlay(text))}function toggleToolTipMobile(i){vm.winWidth<768&&vm.activeToolTipId!==i?vm.activeToolTipId=i:vm.activeToolTipId=-1}function converTime(totalMin,hour,min){return{min:totalMin%60,hour:Math.floor(totalMin/60)}}function parentId(){return vm.actionPlan.id!==vm.urlPlanId&&(sharedProperties.growlMessage($rootScope.pullInterNationalization("practiceArea.noStepAvailable")),vm.urlPlanId=vm.actionPlan.id),vm.urlPlanId}function getSelectedActionPlanList(type){ajaxService.getAjaxResponse({url:vm.config.selectedActionPlanList,method:"get"}).then(function(response){if("true"===response.Success)if(void 0===response.actionPlan)vm.actionPlanList=response.actionPlanList,vm.state(4),vm.actionPlanAvailable=!1;else{vm.actionPlanAvailable=!0,vm.actionPlan=response.actionPlan,vm.badgeObject={name:vm.actionPlan.name,completedCount:vm.actionPlan.completedCount,totalCount:vm.actionPlan.actionCount,level:1},!vm.actionPlanList.length&&vm.getActionPlans(),vm.selectedPlanId=vm.urlFlag&&!1!==vm.urlPlanId?parentId():vm.actionPlan.id,vm.selectedStepType=vm.actionPlan.stepType;for(var index=null,i=0;i<response.actionPlan.practiceAreaList.length;i++)if("ACTIVE"===response.actionPlan.practiceAreaList[i].status){index=i;break}if(null===index)return vm.actionPlanSectionDetail=null,vm.currentActive.name=null,vm.currentActive.index=null,vm.state(),!0;if("onClick"===type&&sharedProperties.fireAnalyticsEvent("OrgPlans | Change Org Plan",vm.actionPlan.name),!1!==vm.urlStepId&&vm.urlFlag){vm.urlFlag=!1;for(var z=0,noStep="false";z<vm.actionPlan.practiceAreaList.length;z++){var goal=vm.actionPlan.practiceAreaList[z];if(goal.id===vm.urlStepId){vm.getActionPlansSectionDetail({name:goal.name,index:z,goalId:goal.id,status:goal.status,enabled:goal.enabled,type:"click"}),noStep="true",$timeout(function(){$("html,body").animate({scrollTop:$("#actId_"+vm.urlActionId).offset().top},350)},350);break}}"false"===noStep&&angular.isArray(vm.actionPlan.practiceAreaList)&&vm.actionPlan.practiceAreaList.length&&(vm.urlStepId=vm.actionPlan.practiceAreaList[0].id,sharedProperties.growlMessage($rootScope.pullInterNationalization("practiceArea.noStepAvailable")),vm.getActionPlansSectionDetail({name:vm.actionPlan.practiceAreaList[0].name,index:0,goalId:vm.actionPlan.practiceAreaList[0].id,status:vm.actionPlan.practiceAreaList[0].status,enabled:vm.actionPlan.practiceAreaList[0].enabled,type:"click"}))}else vm.getActionPlansSectionDetail({name:vm.actionPlan.practiceAreaList[index].name,index:index,goalId:vm.actionPlan.practiceAreaList[index].id,showRight:!0,type:"auto"})}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function getActionPlans(){ajaxService.getAjaxResponse({url:vm.config.allActionPlans,method:"get"}).then(function(response){"true"===response.Success?vm.actionPlanList=response.actionPlanList:null!==response.error&&sharedProperties.ajaxError(response.error)})}function selectActionPlans(actionPlanId,scroll){vm.urlFlag&&(vm.urlFlag=!1),actionPlanId?(vm.collapseBox=!1,ajaxService.getAjaxResponse({url:vm.config.selectActionPlan+actionPlanId,method:"get"}).then(function(response){"true"===response.Success?(vm.displayPlanList=!1,vm.getSelectedActionPlanList("onClick"),scroll&&$("html,body").animate({scrollTop:0},300)):null!==response.error&&(sharedProperties.ajaxError(response.error),vm.getActionPlans(),vm.collapseBox=!0)})):vm.collapseBox=!0}function getActionPlansSectionDetail(options){if("All"!==vm.selectedStepType&&!1===options.enabled||"All"===vm.selectedStepType&&"INACTIVE"===options.status)return!0;vm.currentActive=options,vm.ddSelectedText=vm.currentActive.name,vm.actionPlanSectionDetail=vm.actionPlan.practiceAreaList[vm.currentActive.index],vm.noteTextArea="",vm.feedRequired=!0,vm.updateTaskTracker(vm.actionPlanSectionDetail.devStrategyActionCategoryList),vm.state(),vm.showMobileDD&&(vm.showMobileDD=!1),vm.winWidth<768&&void 0===options.showRight&&(vm.showRightCol=!0),$("html,body").animate({scrollTop:$(".table-flex-cols").offset().top-100},350),$timeout(function(){vm.setContentReference({id:vm.currentActive.goalId,title:vm.currentActive.name,description:vm.actionPlan.name},"orgPlans")},1e3),"click"===options.type&&sharedProperties.fireAnalyticsEvent("OrgPlans | Click Org Plan Step","ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name)}function openChangePlan(){vm.displayPlanList=!vm.displayPlanList}function changeStatus(option,list,mainList,actionList){ajaxService.getAjaxResponse({url:vm.config.completeAction+"?actionPlanId="+option.actionPlanId+"&uid="+option.uid+"&completed="+option.completed+"&stepId="+option.stepId,method:"get"}).then(function(response){if("true"===response.Success){if(list.completed=option.completed,option.completed?mainList.completedActions++:mainList.completedActions--,option.completed&&sharedProperties.fireAnalyticsEvent("OrgPlans | Complete an action step","ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name),vm.badgeObject.completedCount=vm.badgeObject.completedCount+1,void 0===option.group||option.completed)if(void 0!==option.group&&option.completed){actionList.completedActions++;var result=actionList.actionData.filter(function(e){return e.permissions.Completion&&!e.completed});!result.length&&actionList.permissions.Completion&&changeStatus({parentCall:!0,actionPlanId:vm.actionPlan.id,completed:!0,uid:actionList.uid},actionList,list)}else void 0!==option.parentCall&&(option.completed?list.completedActions++:list.completedActions--);else actionList.completedActions--,actionList.completed&&actionList.permissions.Completion&&changeStatus({parentCall:!0,actionPlanId:vm.actionPlan.id,completed:!1,uid:actionList.uid},actionList,list);if(response.enableNextStep)vm.selectActionPlans(vm.actionPlan.id);else{for(var i=0;i<vm.actionPlanList.length;i++)if(vm.actionPlanList[i].id===vm.actionPlan.id){vm.actionPlanList[i].completedKpi++,vm.actionPlan.completedCount++;break}vm.updateTaskTracker(vm.actionPlanSectionDetail.devStrategyActionCategoryList)}ngDialog.closeAll()}else null!==response.error&&(ngDialog.closeAll(),list.completed=!option.completed,sharedProperties.ajaxError(response.error))})}function stateControl(list){return!!list.actionData.filter(function(e){return e.permissions.Completion&&!e.completed}).length}function returnMemberList(pageSize){if(!vm.actionPlanList.length)return!0;vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)}function order(predicate,reverse){vm.pageSetting.lastPredicate=predicate,vm.pageSetting.lastReverse=reverse,vm.actionPlanList=$filter("orderBy")(vm.actionPlanList,predicate,reverse)}function active(event,setting){vm.pageSetting.lastPredicate=setting.predicate,vm.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.pageSetting.lastPredicate),vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)}function resetfilter(){vm.pageSetting=angular.copy(vm.originalPageSetting),vm.returnMemberList();var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")}function developmentRedirect(options){vm.devStrategy={id:options.devStrategyId,desc:options.desc},vm.state(options.state)}function getMemberList(){ajaxService.getAjaxResponse({url:"/sp/allUsers"}).then(function(response){if("true"===response.Success){if(vm.emailMemberList=response.allMembers,null!==$localStorage.get("loggegdInProfile"))for(var i=0;i<vm.emailMemberList.length;i++)if(vm.emailMemberList[i].email===$localStorage.get("loggegdInProfile").member.email){vm.emailMemberList.splice(i,1);break}}else sharedProperties.ajaxError(response.error)})}function loadTags(query){var deferred=$q.defer(),result=vm.emailMemberList.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise}function tagAdded(tag){void 0!==tag.email&&(vm.searchTag.push(tag.email),vm.inputRequired=!1)}function tagRemoved(tag){vm.searchTag.splice(vm.searchTag.indexOf(tag.email),1)}function updateModel(content){vm.updateNoteObj.submitted=!1,vm.tempModel=content}function deleteActivate(options){ngDialog.closeAll()}function deletePop(options){vm.saveDeleteOptions=options,ngDialog.open({template:vm.config.deleteDialog,scope:$scope}).closePromise.then(function(data){vm.saveDeleteOptions=null})}function viewDetails(group){vm.viewDetailsListIndex=group,vm.viewDetailsList=group in vm.allNotesFeedbackData?vm.allNotesFeedbackData[group]:null;var $enableSCroll=$(".overflow-enable");$enableSCroll.length&&$enableSCroll.scrollTop(0)}function viewDetailsIndexChange(i){i===vm.openTabId?vm.openTabId=-1:vm.openTabId=i}function previewVideo(mode,url,title,uid){if("Video"===mode)"introVideo"===title?sharedProperties.fireAnalyticsEvent("OrgPlans | View Intro Video","ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name):sharedProperties.fireAnalyticsEvent("OrgPlans | View Action Plan Video","ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name),sharedProperties.videoPopUp(url);else if("Schedule"===mode)sharedProperties.schedulePopUp(title,uid,vm.actionPlan.id,vm.actionPlan.name);else if("WebInternal"===mode)window.location.href=url;else if("ActionPlan"===mode)$rootScope.displayActionPanel();else{sharedProperties.fireAnalyticsEvent("OrgPlans | View Media Resource",mode+" file viewed in ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name);var win=window.open(url,"_blank");win.focus()}}function state(count){switch(count){case 4:$state.go("selectActionPlan");break;default:vm.devStrategy={id:"",desc:null},$state.go("organization")}}function updateBoxHeights(){var maxHeight=Math.max.apply(null,$(".cc-slide").map(function(){return $(this).outerHeight()}).get());$(".cc-slide").css({"min-height":maxHeight})}function getDueDate(days){return["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][days[1]-1]+" "+days[2]+", "+days[0]}var vm=this;vm.pageType="organization",vm.actionPlanAvailable=!0,vm.actionPlan=null,vm.actionPlanList=[],vm.actionPlanSectionDetail=null,vm.currentActive={name:"",index:-1,goalId:null},vm.devStrategy={id:"",desc:null},vm.emailMemberList=[],vm.inputRequired=!1,vm.requestFeedback={submitted:!1},vm.feedRequired=!0,vm.postANote={submitted:!1},vm.updateNoteObj={submitted:!1},vm.btnEnable=!0,vm.updateNoteFlag=!1,vm.feedRequired=!0,vm.allNotesFeedbackData=[],vm.masterAllNotesFeedbackData=[],vm.displayPlanList=!1,vm.viewDetailsList=null,vm.viewDetailsListIndex=-1,vm.updateModel=updateModel,vm.searchTag=[],vm.idtopass="",vm.iconColorCode=sharedProperties.whiteLabelColorCodes("sp-icon-color").color,vm.config={allActionPlans:"/sp/actionPlan/getActionPlans",selectedActionPlanList:"/sp/actionPlan/getActionPlan?userEmail="+$rootScope.noSelf,selectActionPlan:"/sp/actionPlan/selectPlan?actionPlanId=",deleteDialog:"/sp/resources/html/goals/deleteNoteDialog.html",completeAction:"/sp/actionPlan/completeAction",removeMsgs:"/sp/user/removeMessage"},vm.pageSetting={searchText:"",disabledInfinite:!1,lastPredicate:"name",lastReverse:!1},vm.getActionPlans=getActionPlans,vm.selectActionPlans=selectActionPlans,vm.getSelectedActionPlanList=getSelectedActionPlanList,vm.getActionPlansSectionDetail=getActionPlansSectionDetail,vm.active=active,vm.order=order,vm.resetfilter=resetfilter,vm.returnMemberList=returnMemberList,vm.openChangePlan=openChangePlan,vm.changeStatus=changeStatus,vm.stateControl=stateControl,vm.state=state,vm.getMemberList=getMemberList,vm.tagRemoved=tagRemoved,vm.loadTags=loadTags,vm.tagAdded=tagAdded,vm.developmentRedirect=developmentRedirect,vm.deleteActivate=deleteActivate,vm.deletePop=deletePop,vm.viewDetails=viewDetails,vm.viewDetailsIndexChange=viewDetailsIndexChange,vm.showMobileHomePage=showMobileHomePage,vm.converTime=converTime,vm.previewVideo=previewVideo,vm.openState=openState,vm.showMobileDD=!1,vm.ddSelectedText,vm.winWidth=$(window).width(),vm.winHeight=$(window).height()+100+"px",vm.showRightCol=!1,vm.changeManageStrategy=!0,vm.openNgOverlay=openNgOverlay,vm.changeGroup=changeGroup,vm.openTabId,vm.activeToolTipId=-1,vm.toggleToolTipMobile=toggleToolTipMobile,vm.pageTempaltes={note:"/sp/resources/html/goals/addNoteResponsive.html",feedback:"/sp/resources/html/goals/requestFeedbackResponsive.html",notification:"/sp/resources/html/goals/notesFeedbackOverlayResponsive.html",articlecomplete:"/sp/resources/html/goals/completedArticleResponsive.html",manageStratagies:"/sp/resources/html/goals/manageStratagiesResponsive.html"},vm.setContentReference=setContentReference,vm.openFeedbackPanel=openFeedbackPanel,vm.collapseBox=!1,vm.selectedPlanId="",vm.updateBoxHeights=updateBoxHeights,vm.clearMsgs=clearMsgs,vm.actionPlanMsgs=[],vm.urlPlanId=!!sharedProperties.getParam("parentId")&&sharedProperties.getParam("parentId"),vm.urlStepId=!!sharedProperties.getParam("stepId")&&sharedProperties.getParam("stepId"),vm.urlActionId=!!sharedProperties.getParam("actionId")&&sharedProperties.getParam("actionId"),vm.urlFlag=!1!==vm.urlPlanId||!1!==vm.urlStepId,vm.taskTracker={},vm.radialTracker={},vm.updateTaskTracker=updateTaskTracker,vm.getDueDate=getDueDate,vm.badgeObject=null,$(window).on("hashchange",function(){vm.urlPlanId=!!sharedProperties.getParam("parentId")&&sharedProperties.getParam("parentId"),vm.urlStepId=!!sharedProperties.getParam("stepId")&&sharedProperties.getParam("stepId"),vm.urlActionId=!!sharedProperties.getParam("actionId")&&sharedProperties.getParam("actionId"),vm.urlFlag=!1!==vm.urlPlanId||!1!==vm.urlStepId,vm.urlFlag&&!1!==vm.urlPlanId&&vm.selectActionPlans(vm.urlPlanId)}),vm.urlFlag&&!1!==vm.urlPlanId&&vm.selectActionPlans(vm.urlPlanId);$scope.$on("modalClosed",function(){vm.setContentReference({id:vm.currentActive.goalId,title:vm.currentActive.name,description:vm.actionPlan.name},"orgPlans")}),$scope.$on("stickyOpen",function(){vm.setContentReference({id:vm.currentActive.goalId,title:vm.currentActive.name,description:vm.actionPlan.name},"orgPlans")});$("body").click(function(e){$(".lnd-left-style-box").is(e.target)||0!==$(".lnd-left-style-box").has(e.target).length||$(".drag_handle").is(e.target)||vm.displayPlanList&&$scope.$apply(function(){vm.displayPlanList=!1})})}angular.module("spApp").controller("organizationAreasController",organizationAreasController),organizationAreasController.$inject=["$scope","ajaxService","sharedProperties","$state","$filter","ngDialog","$q","$localStorage","$rootScope","$timeout","$sce"];