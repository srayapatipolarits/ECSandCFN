function pulseController($scope,ajaxService,ngDialog,sharedProperties,$rootScope,$localStorage,$timeout){function getPulseRequest(pulseResultId){ajaxService.getAjaxResponse({url:vm.config.getPulseRequest}).then(function(response){if("true"===response.Success)if(vm.getPulseRequestResponse=response.pulseResults,vm.pulseNameIdMap=response.question,vm.showDefault=!!vm.getPulseRequestResponse.length,vm.showDefault){for(var i=0;i<vm.getPulseRequestResponse.length;i++)for(var j=0;j<vm.pulseNameIdMap.length;j++)if(vm.pulseNameIdMap[j].id===vm.getPulseRequestResponse[i].pulseQuestionSetId){var index=vm.executingPulseDropDown.indexOf(vm.pulseNameIdMap[j].name);-1!==index?vm.pulseRequestResponse[vm.pulseNameIdMap[j].name].push(vm.getPulseRequestResponse[i]):(vm.executingPulseDropDown.push(vm.pulseNameIdMap[j].name),vm.categoryKeysSlot.push(vm.pulseNameIdMap[j].categoryKeys),vm.pulseRequestResponse[vm.pulseNameIdMap[j].name]=[],vm.pulseRequestResponse[vm.pulseNameIdMap[j].name].push(vm.getPulseRequestResponse[i])),!vm.startingPointFound&&vm.getPulseRequestResponse[i].inProgress&&(vm.startingPointFound=!0,vm.objectIndex=vm.pulseNameIdMap[j].name,vm.inProgressObject.push(vm.objectIndex),vm.inProgressObject.push(vm.getPulseRequestResponse[i].id))}if(!vm.objectIndex)for(var z=0;z<vm.pulseNameIdMap.length;z++)vm.pulseNameIdMap[z].id===vm.getPulseRequestResponse[0].pulseQuestionSetId&&(vm.objectIndex=vm.pulseNameIdMap[z].name);vm.questionSetStackquestionSetStack=vm.objectIndex,vm.defaultQuestionSetSelected(vm.objectIndex),createDateDropDown(),vm.getGroupData(),createSubsetRecord(vm.objectIndex,"false")}else vm.getQuestionsSet(createNewPulseQuestionSet),$timeout(function(){prepareDatePicker()},200);else null!=response.error&&sharedProperties.ajaxError(response.error)})}function createDateDropDown(){vm.dateList=[],vm.storeAllIndex=[];for(var i=0;i<vm.pulseRequestResponse[vm.objectIndex].length;i++)vm.dateList.push(vm.pulseRequestResponse[vm.objectIndex][i]),vm.storeAllIndex.push(vm.pulseRequestResponse[vm.objectIndex][i].id);$timeout(function(){vm.groupCollector=0,vm.selectedDate=vm.dateList[0].id},0)}function getGroupData(){if(vm.groupName.length)return!0;ajaxService.getAjaxResponse({url:vm.config.getGroupData}).then(function(response){"true"===response.Success&&(vm.groupName=response.groupInfoList.length?vm.createGroupName(response.groupInfoList):[$rootScope.pullInterNationalization("pulse.allGroups")])})}function createSubsetRecord(index,result){if(void 0!==result&&"false"===result){if(vm.subsetRecord=null===vm.pulseRequestResponse[index][vm.dateIndex].pulseScore?vm.fetchResult(vm.pulseRequestResponse[index][vm.dateIndex].id,vm.groupIndex,index):vm.pulseRequestResponse[index][vm.dateIndex].pulseScore,null!=vm.subsetRecord){var currentSelectedObject=vm.executingPulseDropDown.indexOf(vm.objectIndex),categoryKeysSeleted=vm.categoryKeysSlot[currentSelectedObject];getMapResult(vm.subsetRecord,categoryKeysSeleted[0])}}else void 0!==result&&"true"===result&&(vm.subsetRecord=vm.fetchResult(vm.pulseRequestResponse[index][vm.dateIndex].id,vm.groupIndex,index))}function getQuestionsSet(fn){ajaxService.getAjaxResponse({url:vm.config.getQuestionsSet}).then(function(response){"true"===response.Success?(vm.questionSetStack=response.pulseQuestion,null!==fn&&"function"==typeof fn&&fn()):null!=response.error&&sharedProperties.ajaxError(response.error)})}function fetchResult(pulseResultId,groupIndex,index){ajaxService.getAjaxResponse({url:vm.config.fetchResult,data:$.param({pulseResultId:pulseResultId,groupName:0===groupIndex?"":vm.groupName[groupIndex]})}).then(function(response){if("true"===response.Success){if(0!==groupIndex)for(var i=0;i<vm.pulseRequestResponse[index].length;i++)vm.dateIndex!==i&&(vm.pulseRequestResponse[index][i].pulseScore=null);vm.pulseRequestResponse[index][vm.dateIndex].pulseScore=response.pulseResults.pulseScore,vm.pulseRequestResponse[index][vm.dateIndex].numberOfRespondents=response.pulseResults.numberOfRespondents,vm.pulseRequestResponse[index][vm.dateIndex].numberOfMembers=response.pulseResults.numberOfMembers,vm.subsetRecord=vm.pulseRequestResponse[index][vm.dateIndex].pulseScore;var currentSelectedObject=vm.executingPulseDropDown.indexOf(vm.objectIndex),categoryKeysSeleted=vm.categoryKeysSlot[currentSelectedObject];getMapResult(vm.subsetRecord,categoryKeysSeleted[0])}else null!=response.error&&sharedProperties.ajaxError(response.error)})}function createNewPulseQuestionSet(){vm.questionSetStackquestionSetStack=vm.questionSetStack[0],vm.defaultQuestionSetSelected(vm.questionSetStackquestionSetStack)}function resetToInProgress(){vm.dateIndex=0,vm.groupIndex=0,vm.objectIndex=vm.inProgressObject[0],vm.questionSetStackquestionSetStack=vm.objectIndex,vm.defaultQuestionSetSelected(vm.objectIndex),createDateDropDown(),vm.getGroupData(),createSubsetRecord(vm.objectIndex,"false")}function preChangeMode(){vm.questionSetStack.length?changeMode():vm.getQuestionsSet(changeMode)}function changeMode(){vm.showDefault=!1,$timeout(function(){prepareDatePicker()},200),vm.defaultQuestionSetSelected(vm.questionSetStack[0]),vm.questionSetStackquestionSetStack=vm.questionSetStack[0],vm.defaultDropIndex=0,vm.inviteError=!1}function resultMode(){vm.showDefault=!0,vm.questionSetStackquestionSetStack=vm.objectIndex,vm.questionDropChanged()}function createGroupName(list){vm.groupName=[$rootScope.pullInterNationalization("pulse.allGroups")];for(var i=0;i<list.length;i++)vm.groupName.push(list[i].name);return vm.groupName}function defaultQuestionSetSelected(questionSet,index){if(vm.getQuestions(questionSet),void 0!==index)for(var i=0;i<vm.questionSetStack.length;i++)if(vm.questionSetStack[i].id===questionSet.id){vm.defaultDropIndex=i;break}}function getQuestions(parameter){vm.questionList=[];var param=!0===vm.showDefault?vm.pulseRequestResponse[vm.objectIndex][vm.dateIndex].pulseQuestionSetId:parameter.id;ajaxService.getAjaxResponse({url:vm.config.getQuestions,data:$.param({pulseQuestionSetId:param})}).then(function(response){"true"===response.Success?(vm.questionList=response.pulseQuestion,vm.questionSet(),vm.showDefault||(vm.pulseDrop=vm.questionList.categoryKeys,$timeout(function(){vm.defaultPulseName=0},0),noChart(vm.pulseDrop,0))):null!=response.error&&sharedProperties.ajaxError(response.error)})}function noChart(arrayList,index){arrayList.length&&(vm.activePulse=arrayList[index],vm.mapQuestionObject=vm.questionList.questions[arrayList[index]])}function increment(){return vm.defaultPulseName++,!0}function decrement(){return vm.defaultPulseName--,!0}function defaultPulse(_this){noChart(vm.pulseDrop,vm.defaultPulseName)}function questionSet(){"questions"in vm.questionList&&(vm.mapQuestionObject=vm.questionList.questions[vm.activePulse])}function getMapResult(arrayList,index){if(vm.kyz=Object.keys(arrayList),vm.kyz.length){var startIndex=Object.keys(vm.subsetRecord).indexOf(index);vm.mapResponse(vm.kyz[startIndex])}}function mapResponse(keyName,index){keyName in vm.subsetRecord&&(vm.activePulse=keyName,vm.mapResponseObject=vm.subsetRecord[keyName]);var obj=$(".overall-score-list").find("li:eq("+index+")");$(".overall-score-list").find("li").removeClass("active"),obj.length?$(".overall-score-list").find("li:eq("+index+")").addClass("active"):$(".overall-score-list").find("li:eq(0)").addClass("active"),vm.questionSet()}function dateChanged(_this){null!==this.selectedDate&&(vm.dateIndex=vm.storeAllIndex.indexOf(this.selectedDate),createSubsetRecord(vm.objectIndex,"false"))}function groupChanged(_this){vm.groupIndex=this.groupCollector,createSubsetRecord(vm.objectIndex,"true")}function questionSetChanged(){vm.objectIndex=vm.questionSetStackquestionSetStack,vm.questionDropChanged()}function questionDropChanged(){vm.dateIndex=0,vm.groupIndex=0,vm.defaultQuestionSetSelected(vm.objectIndex),createDateDropDown(),vm.getGroupData(),createSubsetRecord(vm.objectIndex,"false")}function startNewPulsePop(){ngDialog.open({template:vm.config.startNewPulsePopDialog,scope:$scope})}function startPulseFormSubmit(form){form.$valid?ajaxService.getAjaxResponse({url:vm.config.startPulseFormSubmit,data:$.param({pulseQuestionSetId:form.pulse_category_questionsSet.$viewValue.id,startDate:vm.fromDate,endDate:vm.endDate})}).then(function(response){"true"===response.Success?(sharedProperties.fireAnalyticsEvent("Pulse | Start a new Pulse","N/A"),window.location.reload()):null!=response.error&&sharedProperties.ajaxError(response.error)}):vm.inviteError=!0}function cancelPulse(pulseRequestId,save){ajaxService.getAjaxResponse({url:vm.config.cancelPulse,data:$.param({pulseRequestId:pulseRequestId,saveResults:save})}).then(function(response){"true"===response.Success?(sharedProperties.fireAnalyticsEvent("Pulse | Cancel",save?"Save Results":"Discard Results"),window.location.reload()):null!=response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})}function sendReminderPop(idToPass){vm.idToPass=idToPass,ngDialog.open({template:vm.config.pulseReminderDialog,scope:$scope})}function cancelPop(idToCancel){vm.idToCancel=idToCancel,ngDialog.open({template:vm.config.cancelSpDilaog,scope:$scope})}function pulseSendReminder(pulseRequestId){ajaxService.getAjaxResponse({url:vm.config.pulseSendReminder,data:$.param({pulseRequestId:pulseRequestId})}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("dashboard.prismLensSuccess")),sharedProperties.fireAnalyticsEvent("Pulse | Send Reminder","N/A")):null!=response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})}function seletedPulseName(){for(var i=0;i<vm.questionSetStack.length;i++)if(vm.questionSetStack[i].id===vm.questionSetStackquestionSetStack)return vm.questionSetStack[i].name}var vm=this;vm.getPulseRequestResponse=[],vm.dateList=[],vm.kyz=[],vm.mapQuestionObject=[],vm.subsetRecord="",vm.activePulse="",vm.lastGroup="",vm.dateIndex=0,vm.groupIndex=0,vm.objectIndex=0,vm.groupName=[],vm.inviteError=!1,vm.hideStart=!1,vm.questionSetStack=[],vm.selectedDate="",vm.groupCollector="",vm.endDate=null,vm.executingPulseDropDown=[],vm.startingPointFound=!1,vm.pulseRequestResponse={},vm.defaultDropIndex=0,vm.inProgressObject=[],vm.categoryKeysSlot=[],vm.config={getPulseRequest:"/sp/pulse/getRequests",getGroupData:"/sp/admin/group/all",getQuestionsSet:"/sp/pulse/getQuestionSets",fetchResult:"/sp/pulse/getScore",getQuestions:"/sp/pulse/getQuestions",startNewPulsePopDialog:"/sp/pulse/startNewPulse",startPulseFormSubmit:"/sp/pulse/start",cancelPulse:"/sp/pulse/cancelPulse",pulseReminderDialog:"/sp/pulse/pulseReminder",cancelSpDilaog:"/sp/pulse/cancelSP",pulseSendReminder:"/sp/pulse/sendReminder"},vm.getPulseRequest=getPulseRequest,vm.getGroupData=getGroupData,vm.getQuestionsSet=getQuestionsSet,vm.fetchResult=fetchResult,vm.resetToInProgress=resetToInProgress,vm.preChangeMode=preChangeMode,vm.resultMode=resultMode,vm.createGroupName=createGroupName,vm.defaultQuestionSetSelected=defaultQuestionSetSelected,vm.getQuestions=getQuestions,vm.increment=increment,vm.decrement=decrement,vm.defaultPulse=defaultPulse,vm.questionSet=questionSet,vm.mapResponse=mapResponse,vm.dateChanged=dateChanged,vm.groupChanged=groupChanged,vm.questionSetChanged=questionSetChanged,vm.questionDropChanged=questionDropChanged,vm.startNewPulsePop=startNewPulsePop,vm.startPulseFormSubmit=startPulseFormSubmit,vm.cancelPulse=cancelPulse,vm.sendReminderPop=sendReminderPop,vm.cancelPop=cancelPop,vm.pulseSendReminder=pulseSendReminder,vm.seletedPulseName=seletedPulseName;var prepareDatePicker=function(){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),$('input[name="endDate"]').daterangepicker({showDropdowns:!1,minDate:moment().add(1,"days").toDate(),maxDate:moment().add(14,"days").toDate(),locale:{format:"MM/DD/YYYY"},alwaysShowCalendars:!0,singleDatePicker:!0,autoUpdateInput:!1,opens:"right"},function(start,end,label){$scope.$apply(function(){vm.fromDate=moment().format("MM/DD/YYYY"),vm.endDate=start.format("MM/DD/YYYY")})})}}function pulseQuestionController($scope,ajaxService,sharedProperties,$localStorage,$rootScope){function startQuestion(){ajaxService.getAjaxResponse({url:vm.config.startQuestion,data:$.param({pulseRequestId:sharedProperties.getParam("pulseRequestId")})}).then(function(response){"true"===response.Success?(vm.getQuestion=response.pulseQuestion,vm.categoryQuestion=Object.keys(vm.getQuestion.questions),vm.createQuestionSet()):null!=response.error&&(window.location.href="/sp/linkExpired")})}function createQuestionSet(){vm.questionSet=vm.getAllQuestionSet(vm.getQuestion.questions),vm.createSetsToDisplay(vm.questionSet,vm.getQuestion.questions)}function getAllQuestionSet(arrayList){return Object.keys(arrayList)}function createSetsToDisplay(keyName,arrayList){vm.createSubset=[];for(var i=0;i<keyName.length;i++)if(keyName[i]in arrayList){var ans=vm.createAnswerSheet(arrayList[keyName[i]].length);vm.createSubset.push({name:keyName[i],result:arrayList[keyName[i]],answer:ans,sectionNumber:vm.categoryQuestion.indexOf(keyName[i])+1,lengthQuestion:""}),vm.keyNameToPrint.push(keyName[i])}vm.startRepeat=angular.copy(vm.createSubset)}function createAnswerSheet(size){for(var tempArray=[],i=0;i<size;i++)tempArray.push(null);return tempArray}function inputStyleCheck(searchIndex,answerValue,answerIndex){if(vm.startRepeat[searchIndex].answer[answerIndex]=answerValue,void 0!==vm.errorScope&&vm.errorScope.length)for(var _this=$(".pulse-question-list-checkbox"),i=0;i<vm.errorScope.length;i++)null!=vm.startRepeat[vm.currentIndex].answer[vm.errorScope[i]]&&(_this.find("li.realState:eq("+vm.errorScope[i]+")").removeClass("showError"),vm.errorScope.splice(i,1))}function spliceArray(arrayList,spliceIndex,keyName){for(var i=0;i<arrayList.length;i+=spliceIndex){vm.temparray=arrayList.slice(i,i+spliceIndex);var ans=vm.createAnswerSheet(vm.temparray.length);vm.createSubset.push({name:keyName,lengthQuestion:"",result:vm.temparray,answer:ans,sectionNumber:vm.categoryQuestion.indexOf(keyName)+1}),vm.keyNameToPrint.push(keyName)}}function setIndex(currentIndex,argument,status){if(status){var loop=vm.startRepeat[currentIndex].answer;vm.errorScope=[];for(var i=0;i<loop.length;i++)null===loop[i]&&vm.errorScope.push(i);vm.errorScope.length?vm.showError(vm.errorScope,currentIndex):(vm.currentIndex=argument,gotoTop())}else vm.currentIndex=argument,gotoTop()}function gotoTop(){$("html,body").animate({scrollTop:$(".pulse-survey").offset().top-80},300)}function showError(errorArrayIndex,currentvalue){var _this=$(".pulse-question-list-checkbox");_this.find("li.realState").removeClass("showError"),vm.errorScope=errorArrayIndex;for(var i=0;i<errorArrayIndex.length;i++)_this.find("li.realState:eq("+errorArrayIndex[i]+")").addClass("showError")}function isItChecked(currentIndex,index,row){var checkUncheck=vm.startRepeat[currentIndex].answer[row];return null!=checkUncheck&&checkUncheck===index}function submitRequest(currentIndex){var loop=vm.startRepeat[currentIndex].answer;vm.errorScope=[];for(var i=0;i<loop.length;i++)null===loop[i]&&vm.errorScope.push(i);vm.errorScope.length?vm.showError(vm.errorScope,currentIndex):vm.callSubmit()}function callSubmit(){vm.clubResult=[];for(var i=0;i<vm.startRepeat.length;i++)vm.isItAlreadyInArray(vm.clubResult,vm.startRepeat[i])&&vm.clubResult.push({categoryName:vm.startRepeat[i].name,questionSelectionIndex:vm.startRepeat[i].answer});ajaxService.getAjaxResponse({url:vm.config.callSubmit,data:vm.clubResult,headers:{"Content-Type":"application/json"}}).then(function(response){"true"===response.Success?($localStorage.set("pulseDone","true"),sharedProperties.fireAnalyticsEvent("Pulse | Submitted Pulse data","N/A"),window.location.href="/sp"):null!=response.error&&sharedProperties.ajaxError(response.error)})}function isItAlreadyInArray(clubResult,returnResult){if(clubResult.length){for(var i=0;i<clubResult.length;i++)if(returnResult.name===clubResult[i].categoryName)return vm.clubResult[i].questionSelectionIndex=vm.clubResult[i].questionSelectionIndex.concat(returnResult.answer),!1;return!0}return!0}var vm=this;vm.getQuestion=[],vm.currentIndex=0,vm.keyNameToPrint=[],vm.errorIndex=[],vm.clubResult=[],vm.config={startQuestion:"/sp/pulse/getQuestions",callSubmit:"/sp/pulseUser/saveAssessment?pulseRequestId="+sharedProperties.getParam("pulseRequestId")},vm.startQuestion=startQuestion,vm.createQuestionSet=createQuestionSet,vm.getAllQuestionSet=getAllQuestionSet,vm.createSetsToDisplay=createSetsToDisplay,vm.createAnswerSheet=createAnswerSheet,vm.inputStyleCheck=inputStyleCheck,vm.spliceArray=spliceArray,vm.setIndex=setIndex,vm.showError=showError,vm.isItChecked=isItChecked,vm.submitRequest=submitRequest,vm.callSubmit=callSubmit,vm.isItAlreadyInArray=isItAlreadyInArray}angular.module("spApp").controller("pulseController",pulseController),angular.module("spApp").controller("pulseQuestionController",pulseQuestionController),pulseController.$inject=["$scope","ajaxService","ngDialog","sharedProperties","$rootScope","$localStorage","$timeout"],pulseQuestionController.$inject=["$scope","ajaxService","sharedProperties","$localStorage","$rootScope"];