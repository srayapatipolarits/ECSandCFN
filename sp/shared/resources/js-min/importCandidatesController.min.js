function importCandidatesController($scope,FileUploader,$element,$attrs,$http,userDataService,ngDialog,$timeout,ajaxService,$localStorage){$scope.zeroAvailabilityError=!1,$scope.submitDisabled=!1,$scope.fileNameList=[],$scope.serverException=!1,$scope.serverExceptionMessage="",$scope.noFilesError=!1,$scope.fileFormatError=!1;var storedProfile=$localStorage.get("loggegdInProfile"),userRoles=storedProfile.member.roles.sort();$scope.isAccountAdmin=0===jQuery.inArray("AccountAdministrator",userRoles),$scope.openFileUploadModal=function(){var fileInput=jQuery("body").find("#selectFile");$scope.zeroAvailabilityError===!1&&(fileInput.click(),$scope.fileFormatError===!0&&($scope.fileFormatError=!1),$scope.noFilesError===!0&&($scope.noFilesError=!1))},$scope.clearFileInput=function(){if($scope.fileFormatError===!0&&($scope.fileFormatError=!1),$scope.noFilesError===!0&&($scope.noFilesError=!1),jQuery("html").hasClass("ie")){var fileInput=jQuery("body").find('form[name="importCandidates"]');fileInput[0].reset(),$scope.fileFormatError===!0&&($scope.fileFormatError=!1),$scope.noFilesError===!0&&($scope.noFilesError=!1)}};var uploader=$scope.uploader=new FileUploader({url:"/sp/hiring/multiInviteAddFile",alias:"hiringCandidateFile",onAfterAddingFile:function(){$scope.fileFormatError===!0&&($scope.fileFormatError=!1),$scope.noFilesError===!0&&($scope.noFilesError=!1)}});$scope.uploader.filters.push({name:"csvFilter",fn:function(item,options){var type="|"+item.name.slice(item.name.lastIndexOf(".")+1)+"|",x=-1!=="|csv|".indexOf(type);return x?$scope.fileFormatError===!0&&($scope.fileFormatError=!1):($scope.noFilesError===!0&&($scope.noFilesError=!1),$scope.clearFileInput(),$scope.fileFormatError=!0),x}}),$scope.clearCache=function(){ajaxService.getAjaxResponse({url:"/sp/hiring/multi/reset"})},$scope.getCandidateAvailability=function(){ajaxService.getAjaxResponse({url:"/sp/hiring/getAvailableSubscriptions"}).then(function(response){if("true"===response.Success)$scope.availableSubscriptions=response.availableHiringSubscripitons,0===$scope.availableSubscriptions?($scope.zeroAvailabilityError=!0,$scope.submitDisabled=!0):($scope.zeroAvailabilityError=!1,$scope.submitDisabled=!1);else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.validateImportedContacts=function(){if($scope.fileFormatError===!0&&($scope.fileFormatError=!1),$scope.submitDisabled===!1&&$scope.zeroAvailabilityError===!1)if(uploader.queue.length>0){$scope.importFailed=!1,$scope.noFilesError=!1,$scope.serverError=!1;var failedFailList=[],fileCounter=0,successFileList=[];uploader.uploadAll(),uploader.onCompleteItem=function(fileItem,response,status,headers){if(fileCounter+=1,null===response.error)successFileList.push(fileItem._file.name);else for(var key in response.error)failedFailList.push(response.error[key])},uploader.onCompleteAll=function(){fileCounter===uploader.queue.length&&(0===failedFailList.length?($scope.importFailed=!1,$localStorage.set("files",successFileList.join(",")),$timeout(function(){window.location="/sp/tools/hiring/validateList"},200)):(uploader.clearQueue(),$scope.clearCache(),$scope.importFailed=!0,$scope.importFailedMsg=failedFailList.join(", ")))}}else $scope.noFilesError=!0},$scope.cancelRedirect=function(){window.location="/sp/tools/hiring/"},$scope.initImportCandidates=function(){$scope.getCandidateAvailability();var growlNotification=$localStorage.get("addAccounts");null!==growlNotification&&"undefined"!=typeof growlNotification&&($.growl({icon:"glyphicon glyphicon-ok",message:growlNotification}),$timeout(function(){$localStorage.remove("addAccounts")},300))},$scope.initImportCandidates(),$scope.currentPageUrl=window.location.href,$scope.addAccountsModal=function(addType){$localStorage.remove("addAccounts"),$scope.addAccountsForm={},$scope.addAccountsForm.submitted=!1,$scope.addAccounts={};var processAddAccounts=function(data,e){$scope.addAccountsForm.submitted=!1,this.addAccountsForm.$valid?($localStorage.set("addAccounts","Request submitted successfully!"),$scope.addAccountsForm.submitted=!1):($scope.addAccountsForm.submitted=!0,e.preventDefault())};$scope.processAddAccounts=processAddAccounts,$scope.addType=addType,ngDialog.open({template:"/sp/resources/html/admin/account/addAccountsModal.html",scope:$scope})}}angular.module("spApp").controller("importCandidatesController",importCandidatesController),importCandidatesController.$inject=["$scope","FileUploader","$element","$attrs","$http","userDataService","ngDialog","$timeout","ajaxService","$localStorage"];