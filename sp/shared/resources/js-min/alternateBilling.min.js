function alternateBilling($scope,$element,ajaxService,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage){$scope.abMasterList=[],$scope.getAllError=!1,$scope.searchTag=[],$scope.pageSize=10,$scope.statusInclude=[],$scope.textSearching="",$scope.intialPageSize=10,$scope.load=!0,$scope.updateStatusError=!1,$scope.accountDetails=null,$scope.submitted=!1,$scope.accountList={},$scope.currentId=null,$scope.signup={},$scope.imports={},$timeout(function(){$scope.imports.cpt=-1,$scope.signup.paymentAgreement=-1,$scope.signup.paymentType=-1},0),$scope.imports.camount=null,$scope.ptype=!1,$scope.errorMessage=!1;var config={getAllAccount:"/sp/sysAdmin/alternateBilling/getAllAccounts",fetchAccountDetails:"/sp/sysAdmin/alternateBilling/account/businessAccountDetails",fetchAccountDetailsIndividual:"/sp/sysAdmin/alternateBilling/account/individualAccountDetails"};$scope.masterMemberList=[],$scope.selectMemberList=[],$scope.allArchived=[],$scope.responseRecieved=!1,$scope.formatMonth=function(d){if(null!==d&&void 0!==d){var splitDate=d.split(" ");return splitDate[0].substr(0,3).toUpperCase()+" "+splitDate[1]+" "+splitDate[2]}},$scope.getResponse=function(type,existingAccount){var growlNotification=$localStorage.get("createAccount");null!==growlNotification&&void 0!==growlNotification&&(sharedProperties.growlMessage(growlNotification),$timeout(function(){$localStorage.remove("createAccount")},300)),$scope.mode=type,ajaxService.getAjaxResponse({url:config.getAllAccount,data:$.param({accountType:type,isExistingAccount:existingAccount})}).then(function(response){if("true"===response.Success)$scope.getAllError=!1,$scope.abMasterList=response.accountDetails,$scope.abMasterList.length&&!existingAccount&&$scope.returnMemberList($scope.pageSize);else{$scope.getAllError=!0;for(var key in response.error)$scope.getAllErrorMsg=response.error[key]}})},$scope.getPlanList=function(data){var list=[];if(data){for(var key in data)data.hasOwnProperty(key)&&list.push(key);return list}},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.returnMemberList($scope.pageSize)},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize))},$scope.enableCancel=function(search){return void 0!==search&&search.length>1},$scope.returnMemberList=function(pageSize){if(!$scope.abMasterList.length)return!0;$scope.pageSize=pageSize,pageSize>=$scope.abMasterList.length&&($scope.disabledInfinite=!0,$scope.pageSize=$scope.abMasterList.length),$scope.load&&($scope.lastPredicate="Individual"===$scope.mode?"memberName":"companyName",$scope.lastReverse=!1,$scope.load=!1),$scope.abList=$scope.abMasterList,$scope.order($scope.lastPredicate,$scope.lastReverse)},$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.order=function(predicate,reverse){$scope.lastPredicate=predicate,$scope.lastReverse=reverse,$scope.abList=$filter("orderBy")($scope.abList,predicate,reverse)},$scope.resetfilter=function(allmembers){$scope.pageSize=$scope.intialPageSize,$scope.newArr=[],$scope.searchTag=[],$scope.tags=[],$scope.filter={},$scope.statusInclude=[],$scope.adminc=!1,$scope.leadC=!1,$scope.textSearching="",$scope.searchText="",void 0!==$scope.selectedSearch&&($scope.selectedSearch.userStatusFormatted="",$scope.selectedSearch.hiringRoles=""),$scope.abList=angular.copy($scope.abMasterList),void 0!==allmembers&&($scope.pageSize=$scope.abMasterList.length),$scope.load=!0,$scope.disabledInfinite=!1,$rootScope.$broadcast("$scrollStart"),$scope.returnMemberList($scope.pageSize);var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")},$scope.activateAccount=function(pid,status,plantype){var url="/sp/sysAdmin/alternateBilling/account/reActivateAccount",mode=!1;"INACTIVE"===status&&(url="/sp/sysAdmin/alternateBilling/account/deactivateAccount",mode=!0),ajaxService.getAjaxResponse({url:url,data:$.param({accountId:pid})}).then(function(response){if("true"===response.Success){for(var i=0;i<$scope.abMasterList.length;i++)if($scope.abMasterList[i].id===pid){$scope.abMasterList[i].deactivated=mode;break}$scope.returnMemberList($scope.pageSize),ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("manageAccountContent.statusUpdated"))}else ngDialog.close("ngdialog1"),$scope.updateStatusError=!0,sharedProperties.ajaxError(response.error)})},$scope.archiveAccount=function(options){$scope.saveArchiveOptions=options,ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/archivedConfirmation.html",scope:$scope})},$scope.archiveAccountService=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/archive/archiveAccount",data:$.param({accountId:$scope.saveArchiveOptions.id})}).then(function(response){if("true"===response.Success){for(var i=0;i<$scope.abMasterList.length;i++)if($scope.abMasterList[i].id===$scope.saveArchiveOptions.id){$scope.abMasterList.splice(i,1);break}for(var j=0;j<$scope.abList.length;j++)if($scope.abList[j].id===$scope.saveArchiveOptions.id){$scope.abList.splice(j,1);break}ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("billing.archivedMsg"))}else ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error)})},$scope.getAllArchived=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/archive/getAllArchiveAccounts",data:$.param({accountType:sharedProperties.getParam("type")})}).then(function(response){"true"===response.Success?($scope.abMasterList=response.account,$scope.returnMemberList($scope.pageSize)):sharedProperties.ajaxError(response.error)})},$scope.deleteConfirm=function(d){$scope.afid=d,ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/deleteConfirmation.html",scope:$scope})},$scope.fetchAccountDetails=function(accountId,accountDetails){if($scope.currentId===accountId)return!0;$scope.currentId=accountId,$scope.submitted=!1,$scope.detailModule=accountDetails,ajaxService.getAjaxResponse({url:"b"===accountDetails.mode?config.fetchAccountDetails:config.fetchAccountDetailsIndividual,data:$.param({accountId:accountId})}).then(function(response){"true"===response.Success?($scope.accountDetails=null,$scope.accountDetails=response,$scope.errorMessage=!1,$scope.signup.paymentAgreement=response.account.agreementterm||1,$scope.signup.paymentType=0,$timeout(function(){$scope.imports.cpt=-1},0),$scope.imports.camount=null,$scope.imports.ccomment=null):sharedProperties.ajaxError(response.error)})},$scope.validateSendResponse=function(){if($scope.submitted=!1,$scope.errorMessage=!1,$scope.ptype=!1,null===$scope.accountDetails)return $scope.errorMessage=!0,!0;if(this.importAccount.$valid&&-1!==parseInt(this.imports.cpt)){var obj={chargeAmount:this.imports.camount,isTrial:"TRIAL"===this.imports.cpt,paymentType:this.imports.cpt,comment:this.imports.ccomment,accountId:this.accountDetails.account.id},options={url:"/sp/sysAdmin/alternateBilling/account/importExisting",data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){sharedProperties.growlMessage($rootScope.pullInterNationalization("billing.accImport"));for(var i=0;i<$scope.abMasterList.length;i++)if($scope.abMasterList[i].id===$scope.accountDetails.account.id){$scope.abMasterList.splice(i,1),$("html,body").animate({scrollTop:$(".bgWhiteBord").offset().top-20},300);break}$scope.accountDetails=null,$scope.accountList.search=null,$scope.currentId=null,$timeout(function(){$scope.imports.cpt=-1,$scope.signup.paymentAgreement=-1,$scope.signup.paymentType=-1},0),$scope.imports.camount=null,$scope.imports.ccomment=null}else null!==response.error&&($scope.failure=response.error,$scope.sfailure=!0)})}else{$scope.submitted=!0,-1===parseInt(this.imports.cpt)&&($scope.ptype=!0);var elem=angular.element($element);$(elem).find("form .ng-invalid:first").length&&$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300)}},$scope.backToDefault=function(){$scope.accountDetails=null,$scope.accountList.search=null,$scope.currentId=null,$timeout(function(){$scope.imports.cpt=-1,$scope.signup.paymentAgreement=-1,$scope.signup.paymentType=-1},0),$scope.imports.camount=null,$scope.imports.ccomment=null,$scope.errorMessage=!1,$scope.ptype=!1,$scope.submitted=!1,$("html,body").animate({scrollTop:$(".bgWhiteBord").offset().top-20},300)},$scope.removeError=function(val){-1!==val&&($scope.ptype=!1)}}function accountViewDetail($scope,ajaxService,$localStorage,sharedProperties,ngDialog,$timeout,$filter,$rootScope){$scope.disableIndividualEditing=!0,$scope.formStatus={},$scope.dialogStatus={},$scope.adminsList=[],$scope.hiringAdminsList=[],$scope.creditInfo={},$scope.serverError=!1,$scope.activeView="erti",$scope.flags={companyEditing:!0},$scope.switchView=function(view){view!==$scope.activeView&&($scope.activeView=view)},!0===$localStorage.get("creditted")&&($localStorage.remove("creditted"),sharedProperties.growlMessage($rootScope.pullInterNationalization("billing.amoutcred")));var growlNotification=$localStorage.get("addMembers");null!==growlNotification&&void 0!==growlNotification&&(sharedProperties.growlMessage(growlNotification),$timeout(function(){$localStorage.remove("addMembers")},300));var growlNotification1=$localStorage.get("addCandidates");null!==growlNotification1&&void 0!==growlNotification1&&(sharedProperties.growlMessage(growlNotification1),$timeout(function(){$localStorage.remove("addCandidates")},300));var growlNotification2=$localStorage.get("updateAccount");null!==growlNotification2&&void 0!==growlNotification2&&(sharedProperties.growlMessage(growlNotification2),$timeout(function(){$localStorage.remove("updateAccount")},300));var growlNotification3=$localStorage.get("planAdded");null!==growlNotification3&&void 0!==growlNotification3&&(sharedProperties.growlMessage(growlNotification3),$timeout(function(){$localStorage.remove("planAdded")},300));var config={getAllAccountDetails:"/sp/sysAdmin/alternateBilling/account/businessAccountDetails",getAllAccountIndividualDetails:"/sp/sysAdmin/alternateBilling/account/individualAccountDetails",updateCompany:"/sp/sysAdmin/alternateBilling/account/updateCompany",updateIndividualProfile:"/sp/sysAdmin/alternateBilling/account/updateIndividualProfile",deactivateRenewal:"/sp/sysAdmin/alternateBilling/account/cancel",deactivateAccount:"/sp/sysAdmin/alternateBilling/account/deactivateAccount"};$scope.updatePlanStatusPop=function(accId,planType,status){$scope.info={id:accId,plan:planType,status:status},ngDialog.open({template:"/sp/resources/html/admin/account/planDeavtivate.html",scope:$scope})},$scope.updatePlanStatus=function(accId,planType,status){ajaxService.getAjaxResponse({url:"ACTIVE"===status?"/sp/sysAdmin/alternateBilling/account/reActivateAccount":"/sp/sysAdmin/alternateBilling/account/deactivateAccount",data:$.param({accountId:accId,spPlanType:planType})}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),$scope.getAccountValue(),sharedProperties.growlMessage($rootScope.pullInterNationalization("manageAccountContent.statusUpdated"))):null!==response.error&&sharedProperties.ajaxError(response.error)})},$scope.getPlanList=function(data){var list=[];if(data){for(var key in data)data.hasOwnProperty(key)&&list.push(key);return list}},$scope.getAccountValue=function(type,isInit){ajaxService.getAjaxResponse({url:"Individual"===type?config.getAllAccountIndividualDetails:config.getAllAccountDetails,data:$.param({accountId:sharedProperties.getParam("accountId")})}).then(function(response){if("true"===response.Success)"Individual"!==type?($scope.accountInfo=response,$scope.account=response,$scope.companyDetail=response.company,$scope.companyDetail.companyId=response.company.id,$scope.companyDetail.address.address1=response.company.address.addressLine1,$scope.companyDetail.address.address2=response.company.address.addressLine2,$scope.companyDetail.address.zip=response.company.address.zipCode,$scope.stateCheck.forSelectedCountry=response.company.address.country,$scope.accountDetails=response.account,$scope.memberList=response.accountUsers,$scope.masterCompanyDetail=angular.copy($scope.companyDetail),$scope.adminsList=response.planAdminUsers.Primary,$scope.hiringAdminsList=response.planAdminUsers.IntelligentHiring,$scope.planDetails=response.account.spPlans,$scope.accountDetails=response.account,$scope.companyInfo=response.company,isInit&&("Primary"in $scope.planDetails?$scope.switchView("erti"):"IntelligentHiring"in $scope.planDetails&&$scope.switchView("hiring"))):($scope.account=response,$scope.accountInfo=response,$scope.accountDetails=response.account,$scope.userDetail=response.profileForm,$scope.userDetail.userId=response.userSummary.id,$scope.userDetail.address1=response.address.addressLine1,$scope.userDetail.address2=response.address.addressLine2,$scope.userDetail.zip=response.address.zipCode,$scope.userDetail.city=response.address.city,$scope.userDetail.state=response.address.state,$scope.userDetail.country=response.address.country,$scope.masterUserDetail=angular.copy($scope.userDetail));else{$scope.getAllError=!0;for(var key in response.error)$scope.getAllErrorMsg=response.error[key]}}),$scope.countries=$localStorage.get("countriesFullList").countries},$scope.saveAndUpdate=function(formData,formName){$scope.formStatus.sumbit=!1;var empCountErr;empCountErr=!(void 0!==formData.numberOfEmployees&&formData.numberOfEmployees<1);var URL="companyDetails"===formName?config.updateCompany:config.updateIndividualProfile,vCount=0;for(var k in formData)if("object"==typeof formData[k])for(var l in formData[k])"default"!==formData[k][l]&&"default1"!==formData[k][l]||vCount++;else"default"!==formData[k]&&"default1"!==formData[k]||vCount++;this[formName].$valid&&0===vCount&&empCountErr?ajaxService.getAjaxResponse({url:URL,data:$.param(formData).replace(/address%5B/g,"").replace(/%5D/g,"").replace(/%2C/g,",")}).then(function(response){"true"===response.Success?($scope.masterCompanyDetail=angular.copy($scope.companyDetail),$scope.flags.companyEditing=!0,$scope.masterUserDetail=angular.copy($scope.userDetail),$scope.disableIndividualEditing=!0):null!==response.error&&sharedProperties.ajaxError(response.error)}):$scope.formStatus.sumbit=!0},$scope.disableEdit=function(){$scope.formStatus.sumbit=!1,$scope.flags.companyEditing=!0,$scope.companyDetail=angular.copy($scope.masterCompanyDetail),$scope.disableIndividualEditing=!0,$scope.userDetail=angular.copy($scope.masterUserDetail)},$scope.showDetailsDialog=function(t){"members"===t?($scope.showDetails={title:"Member account details",total:'Total member accounts purchased : <span class="b-700">'+parseInt($scope.accountDetails.spPlans.Primary.numActive+$scope.accountDetails.spPlans.Primary.availalbeMemberSubscriptions+$scope.accountDetails.spPlans.Primary.numDeleted)+"</span>",active:$scope.accountDetails.spPlans.Primary.numActive,deleted:$scope.accountDetails.spPlans.Primary.numDeleted,available:$scope.accountDetails.spPlans.Primary.numberOfMembers},ngDialog.open({template:"/sp/resources/html/admin/account/show-details-dialog.html",scope:$scope})):($scope.showDetails={title:"Candidate account details",total:'Total Candidates accounts purchased : <span class="b-700">'+parseInt($scope.accountDetails.spPlans.IntelligentHiring.numActive+$scope.accountDetails.spPlans.IntelligentHiring.availalbeMemberSubscriptions+$scope.accountDetails.spPlans.IntelligentHiring.numDeleted)+"</span>",active:$scope.accountDetails.spPlans.IntelligentHiring.numActive,deleted:$scope.accountDetails.spPlans.IntelligentHiring.numDeleted,available:$scope.accountDetails.spPlans.IntelligentHiring.availalbeMemberSubscriptions},ngDialog.open({template:"/sp/resources/html/admin/account/show-details-dialog.html",scope:$scope}))},$scope.showReactivateDialog=function(i){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/reActivate",data:$.param({accountId:sharedProperties.getParam("accountId"),planType:"Primary"})}).then(function(response){"true"===response.Success&&($scope.getAccountValue("Individual"),sharedProperties.growlMessage($rootScope.pullInterNationalization("billing.accRenew")))})},$scope.showReactivateAccount=function(i){var _data;_data="Primary"===i||"IntelligentHiring"===i?{url:"/sp/sysAdmin/alternateBilling/account/reActivate",data:$.param({accountId:sharedProperties.getParam("accountId"),planType:i})}:{url:"/sp/sysAdmin/alternateBilling/account/reActivate",data:$.param({accountId:sharedProperties.getParam("accountId"),planType:"Primary"})},ajaxService.getAjaxResponse(_data).then(function(response){"true"===response.Success?"Primary"===i?(sharedProperties.growlMessage($rootScope.pullInterNationalization("billing.accRenewActive")),$scope.getAccountValue()):"IntelligentHiring"===i?(sharedProperties.growlMessage($rootScope.pullInterNationalization("billing.hiringAddon")),$scope.getAccountValue()):($scope.getAccountValue(i),sharedProperties.growlMessage($rootScope.pullInterNationalization("billing.accActive"))):sharedProperties.ajaxError(response.error)})},$scope.showCancelDialog=function(i){$scope.showCancelType=i,$scope.dialogStatus.title="Cancel Subscription",$scope.dialogStatus.content="Subscription cancelled successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/cancel-subscription-dialog.html",scope:$scope})},$scope.showCancelAccountDialog=function(i){$scope.showCancelType=i,$scope.dialogStatus.title="Cancel Subscription",$scope.dialogStatus.content="Account deactivated successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/cancel-subscription-account-dialog.html",scope:$scope})},$scope.showDetailsDialog=function(t){"members"===t?($scope.showDetails={title:"Member account details",total:'Total member accounts purchased : <span class="b-700">'+parseInt($scope.accountDetails.spPlans.Primary.numActive+$scope.accountDetails.spPlans.Primary.availalbeMemberSubscriptions+$scope.accountDetails.spPlans.Primary.numDeleted)+"</span>",active:$scope.accountDetails.spPlans.Primary.numActive,deleted:$scope.accountDetails.spPlans.Primary.numDeleted,available:$scope.accountDetails.spPlans.Primary.availalbeMemberSubscriptions},ngDialog.open({template:"/sp/resources/html/admin/account/show-details-dialog.html",scope:$scope})):($scope.showDetails={title:"Candidate account details",total:'Total candidates accounts purchased : <span class="b-700">'+parseInt($scope.accountDetails.spPlans.IntelligentHiring.numActive+$scope.accountDetails.spPlans.IntelligentHiring.availalbeMemberSubscriptions+$scope.accountDetails.spPlans.IntelligentHiring.numDeleted)+"</span>",active:$scope.accountDetails.spPlans.IntelligentHiring.numActive,deleted:$scope.accountDetails.spPlans.IntelligentHiring.numDeleted,available:$scope.accountDetails.spPlans.IntelligentHiring.availalbeMemberSubscriptions},ngDialog.open({template:"/sp/resources/html/admin/account/show-details-dialog.html",scope:$scope}))},$scope.cancelSubscription=function(mode){ajaxService.getAjaxResponse({url:config.deactivateRenewal,data:$.param({accountId:sharedProperties.getParam("accountId"),planType:"Primary"})}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("billing.subsCancel")),$timeout(function(){$scope.getAccountValue("Individual")},300)):(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error),$timeout(function(){$scope.getAccountValue("Individual")},300))})},$scope.cancelAccountSubscription=function(mode){var _data;_data="Primary"===mode||"IntelligentHiring"===mode?{url:"/sp/sysAdmin/alternateBilling/account/cancel",data:$.param({accountId:sharedProperties.getParam("accountId"),planType:mode})}:{url:"/sp/sysAdmin/alternateBilling/account/cancel",data:$.param({accountId:sharedProperties.getParam("accountId"),planType:"Primary"})},ajaxService.getAjaxResponse(_data).then(function(response){if("true"===response.Success){var m;m="Primary"===mode?"billing.accRenewDeactive":"IntelligentHiring"===mode?"billing.hiringDeactive":"billing.accDeactive",ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization(m)),$timeout(function(){"Primary"===mode||"IntelligentHiring"===mode?$scope.getAccountValue():$scope.getAccountValue(mode)},300)}else ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error),$timeout(function(){$scope.getAccountValue()},300)})},$scope.addAdmin=function(email,userObj){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/addAdminMember",data:$.param({companyId:$scope.accountInfo.company.id,planType:$scope.addAdminType,userEmail:email})}).then(function(response){"true"===response.Success?("Primary"===$scope.addAdminType?$scope.adminsList.push(userObj):$scope.hiringAdminsList.push(userObj),ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("manageAccountContent.AdminAdded"))):null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})},$scope.removeAdmin=function(email,userObj){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/removeAdminMember",data:$.param({companyId:$scope.accountInfo.company.id,planType:$scope.updatedPlanType,userEmail:email})}).then(function(response){if("true"===response.Success){var dupeList="Primary"===$scope.updatedPlanType?angular.copy($scope.adminsList):angular.copy($scope.hiringAdminsList);jQuery.each(dupeList,function(i,j){if(dupeList[i].email===email)return dupeList.splice(i,1),"Primary"===$scope.updatedPlanType?$scope.adminsList=angular.copy(dupeList):$scope.hiringAdminsList=angular.copy(dupeList),!1}),ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("manageAccountContent.AdminRemoved"))}else null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})},$scope.removeAdminAccess=function(type,userObj){$scope.updatedPlanType=type,$scope.removeAdminMember=userObj,ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/removeAdminModal.html",scope:$scope})},$scope.addAdminAccess=function(type){$scope.addAdminType=type,ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/members",data:$.param({companyId:$scope.accountInfo.company.id,planType:$scope.addAdminType})}).then(function(response){"true"===response.Success?($scope.masterMemberList=response.memberList.length?response.memberList:[],$scope.selectMemberList=angular.copy($scope.masterMemberList),$scope.responseRecieved=!0,$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.order=function(predicate,reverse){$scope.lastPredicate=predicate,$scope.lastReverse=reverse,$scope.selectMemberList=$filter("orderBy")($scope.selectMemberList,predicate,reverse)},ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/selectAdminModal.html",scope:$scope})):null!=response.error&&($scope.responseRecieved=!0,sharedProperties.ajaxError(response.error))})},$scope.addCreditPop=function(page){$scope.acPageType=page,$scope.creditInfo={},$scope.creditInfo.cpt=$scope.account.account.paymentInstrument.paymentType,$scope.creditInfo.ccomment=$scope.account.account.paymentInstrument.comment,$scope.serverError=!1,$scope.serverErrorMsg=null,ngDialog.open({template:"/sp/resources/html/admin/account/addcreditspop.html",scope:$scope})},$scope.addCredit=function(form){$scope.submitted=!1,this.spSubscribe.$valid&&"0"!==this.amount?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addCredit",data:$.param({accountId:$scope.account.account.id,chargeAmount:$scope.creditInfo.amount,paymentType:$scope.creditInfo.cpt,comment:$scope.creditInfo.ccomment})}).then(function(response){if("true"===response.Success)"individual"===$scope.acPageType?$scope.getAccountValue($scope.acPageType):$scope.getAccountValue(),!0===$scope.sfailure&&($scope.signup.submitted=!1,$scope.sfailure=!1,$scope.failure=null),ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("billing.amoutcred"));else{for(var key in response.error)$scope.errorMessage=response.error[key];$scope.serverError=!0,$scope.serverErrorMsg=$scope.errorMessage}}):$scope.submitted=!0},$scope.deleteConfirm=function(d,page){$scope.afid=d,$scope.afPage=page,ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/deleteConfirmationView.html",scope:$scope})},$scope.activateAccount=function(pid,status,page){var url="/sp/sysAdmin/alternateBilling/account/reActivateAccount";"INACTIVE"===status&&(url="/sp/sysAdmin/alternateBilling/account/deactivateAccount"),ajaxService.getAjaxResponse({url:url,data:$.param({accountId:pid})}).then(function(response){"true"===response.Success?("individual"===page?$scope.getAccountValue(page):$scope.getAccountValue(),ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("billing.accstat"))):(ngDialog.close("ngdialog1"),$scope.updateStatusError=!0,sharedProperties.ajaxError(response.error))})},$scope.addCreditForm={},$scope.creditInfo={},$scope.creditFormSubmit=!1,$scope.currentPlanInfo={},$scope.creditSubmitErrors=!1,$scope.creditErrors=null,$scope.processCredit=function(){$scope.creditErrors=null,$scope.creditFormSubmit=!1,$scope.creditSubmitErrors=!1,this.addCreditForm.$valid?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addCredit",data:$.param({accountId:$scope.accountDetails.id,chargeAmount:$scope.creditInfo.amount,paymentType:$scope.creditInfo.cpt,comment:$scope.creditInfo.ccomment,spPlanType:$scope.currentPlanInfo.planType})}).then(function(response){if("true"===response.Success)$scope.planDetails[$scope.currentPlanInfo.planType].creditBalance+=$scope.creditInfo.amount,$scope.planDetails[$scope.currentPlanInfo.planType].paymentInstrument.comment=$scope.creditInfo.ccomment,$scope.currentPlanInfo={},ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("billing.amoutcred"));else if(null!==response.error){var errorMessage="";for(var key in response)errorMessage=response[key];$scope.creditSubmitErrors=!0,$scope.creditErrors=errorMessage}}):$scope.creditFormSubmit=!0},$scope.showAddCredit=function(planType){$scope.creditFormSubmit=!1,$scope.creditInfo={},$scope.currentPlanInfo={planType:planType,term:$scope.planDetails[planType].agreementTerm,paymentType:$scope.planDetails[planType].paymentType,expiry:$scope.planDetails[planType].planInfo.expiresTime,balance:$scope.planDetails[planType].creditBalance},ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/addCreditsDetailsView.html",scope:$scope})}}function payToolTip($timeout){return{restrict:"A",link:function($scope,$element,$attrs){new Drop({target:$element[0],content:$attrs.desc,position:"bottom center",openOn:"hover",remove:!0})}}}angular.module("spApp").controller("alternateBilling",alternateBilling),alternateBilling.$inject=["$scope","$element","ajaxService","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage"],angular.module("spApp").controller("accountViewDetail",accountViewDetail),accountViewDetail.$inject=["$scope","ajaxService","$localStorage","sharedProperties","ngDialog","$timeout","$filter","$rootScope"],angular.module("spApp").directive("payToolTip",payToolTip),payToolTip.$inject=["$timeout"];