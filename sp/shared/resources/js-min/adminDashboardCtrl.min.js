function adminDashboardCtrl($scope,ajaxService,$localStorage,$state,$q,sharedProperties,$filter,$rootScope,ngDialog,$timeout){this.selectedTab="posts"}function adminMsgPostCtrl($scope,ajaxService,$localStorage,$state,$q,sharedProperties,$filter,$rootScope,ngDialog,$timeout,newsFeedService,basicService,notesService){function infinteScroll(pageSize){_this.disabledInfinite||(_this.listSize=pageSize,pageSize>=_this.messagePosts.length&&(_this.disabledInfinite=!0,_this.listSize=_this.messagePosts.length))}function showMoreComments(pageSize,masterLength){_this.pageSetting.pageSize=pageSize,pageSize>=masterLength&&(_this.pageSetting.pageSize=masterLength)}function imageUrl(loop){var arrayofObj=[];for(var key in loop.media)if("Video"===loop.media[key].mediaType||"VideoTab"===loop.media[key].mediaType){arrayofObj.push(loop.media[key]);break}return arrayofObj.length||arrayofObj.push({url:loop.imageUrl,mediaType:"image"}),arrayofObj}function addComment(news){if(!news.tempcomment.comment.comment.length)return!1;var obj=null;"PublicChannel"===news.type?(obj=notesService.publicChannelObj(),obj.comment.comment=news.tempcomment.comment.comment,obj.comment.contentReference=news.tempcomment.comment.contentReference,obj.spFeature=news.spFeature,obj.pcRefId=news.pcRefId,obj.parentRefId=news.parentRefId,obj.id=news.id,obj.title=news.title,obj.subModuleFeature=news.subModuleFeature,news.tempcomment=createCommentObject(),notesService.addComment(obj).then(function(data){if(null===data)return!0;!angular.isArray(news.comments)&&(news.comments=[]),news.comments.unshift(data.comment),news.commentCount++,news.number++})):(obj=newsFeedService.postMessageObject(),obj.comment.comment=news.tempcomment.comment.comment,obj.comment.contentReference=news.tempcomment.comment.contentReference,news.tempcomment=createCommentObject(),obj.messageId=news.id,newsFeedService.addComment(obj).then(function(data){if(null===data)return!0;!angular.isArray(news.comments)&&(news.comments=[]),news.comments.unshift(data.message.comment),news.commentCount++,news.number++}))}function likePost(news){newsFeedService.likePost({messageId:news.id}).then(function(data){news.likeCount=data.likeCount,news.likedByUser=!news.likedByUser})}function videoPopUp(url,mode){if("Video"===mode)sharedProperties.videoPopUp(url);else{window.open(url,"_blank").focus()}}function likedUserName(messageId,event){newsFeedService.likeUserName({messageId:messageId}).then(function(data){if(null===data)return!0;ngDialog.open({template:"/sp/resources/html/dashboard/liked-user.html",scope:$scope}),_this.likedUsersList=data.likeUsers})}function daysCalculator(second){if(!angular.isArray(second))return!0;var date=second[0]+"/"+second[1]+"/"+second[2]+" "+second[3]+":"+second[4]+":"+second[5],diff=Date.parse(new Date)-Date.parse(new Date(date));return isNaN(diff)?NaN:{diff:diff,ms:Math.floor(diff%1e3),s:Math.floor(diff/1e3%60),m:Math.floor(diff/6e4%60),h:Math.floor(diff/36e5%24),d:Math.floor(diff/864e5)}}function createCommentObject(){return{comment:{comment:[],contentReference:{title:null,description:null,name:null,SPMedia:null}}}}function setOptions(view,save,edit,isAction,action,post){_this.listView=view,_this.saveMode=save,_this.editMode=edit,_this.viewPostActivity=!1,$("body").scrollTop(0),_this.listView?(getPosts(),_this.resetFilters()):(_this.userInfo=[],_this.selectedPostData=[],_this.postActivityDetails=[],_this.viewPostActivity=!1,_this.publishCompanyList=[],_this.selectedAuthorInfo=!1,_this.removeReference(_this.postMessageObject.comment.contentReference),_this.postMessageObject=newsFeedService.postMessageObject(),_this.postMessageObject.selectedAuthor="",_this.postMessageObject.comment.comment="",_this.newPost="",_this.newPublishedPost="",_this.postMessageSubmit=!1,_this.getAuthors(isAction,action,post))}function getPostActivity(id){ajaxService.getAjaxResponse({url:_this.services.postActivity,data:$.param({id:id})}).then(function(response){"true"===response.Success?(_this.userInfo=_this.selectedAuthorInfo,_this.selectedPostData=[],_this.selectedPostCompany=[],_this.responseReceived=!0,_this.selectedTab=0,_this.postActivityDetails=response.messagePost,_this.displayPostData(_this.postActivityDetails[0],0)):null!=response.error&&sharedProperties.ajaxError(response.error)})}function displayPostData(data,index){_this.selectedPostData=[],_this.selectedPostCompany=[],_this.selectedTab=index,_this.selectedPostData=data.dashboardMessage,_this.selectedPostCompany=data.company,_this.pageSetting.pageSize=5,_this.selectedPostData.tempcomment=newsFeedService.postMessageObject(),$(".activity-posts-desc, .previous-comment-container").scrollTop(0)}function deletePost(post){_this.deleteInfo=post,_this.newFeedsOnly="all",ngDialog.open({template:"/sp/resources/html/sysAdmin/dashboard/delete-post.html",scope:$scope})}function deletePostWithOptions(post,feedsOnly){var newsFeedsOnly="notAll"===feedsOnly;ajaxService.getAjaxResponse({url:_this.services.deletePost,data:$.param({id:post.id,newsFeedOnly:!(!post.published||post.published&&!newsFeedsOnly)})}).then(function(response){if("true"===response.Success){ngDialog.close();for(var temp=angular.copy(_this.messagePosts),i=temp.length-1;i>=0;i--)if(temp[i].id===post.id){if(newsFeedsOnly){temp[i].companList=null,temp[i].published=!1,temp[i].companyNames=null;break}temp.splice(i,1);break}_this.messagePosts=angular.copy(temp),sharedProperties.growlMessage("Post Deleted Successfully")}else null!=response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})}function resetFilters(){_this.searchPostList="",_this.searchByAuthor="",_this.searchByStatus="",_this.searchByCompany=""}function removeReference(reference){reference.authorSource=null,reference.description=null,reference.imageUrl=null,reference.media=null,reference.title=null}function getPosts(){ajaxService.getAjaxResponse({url:_this.services.getAll}).then(function(response){if("true"===response.Success){_this.messagePosts=response.messagePostListing,_this.responseReceived=!0;for(var temp=angular.copy(_this.messagePosts),temp1=[],aTemp=[],i=0;i<temp.length;i++)temp[i].companList&&(temp1=temp[i].companList.map(function(obj){return obj.name}),$.extend(temp[i],{companyNames:temp1}));for(var j=0;j<temp.length;j++)aTemp.push(temp[j].message.onBehalfUser.firstName);_this.messagePosts=angular.copy(temp.reverse()),_this.postAuthorsList=aTemp.unique()}else null!=response.error&&sharedProperties.ajaxError(response.error)})}function getCompanies(){sharedProperties.getAllCompaniesList().length?_this.updatedCompaniesList=sharedProperties.getAllCompaniesList():ajaxService.getAjaxResponse({url:_this.services.getCompanies,method:"GET"}).then(function(response){"true"===response.Success?(_this.companyList=response.companies,_this.updatedCompaniesList=angular.copy(_this.companyList),sharedProperties.setAllCompaniesList(response.companies)):null!=response.error&&sharedProperties.ajaxError(response.error)}),_this.selectedCompanies=[],_this.publishPostSubmit=!1,_this.selectAllMembers=!1,_this.companySearch="",_this.selectAllCompanies=!1,ngDialog.open({template:"/sp/resources/html/sysAdmin/dashboard/assign-post.html",scope:$scope}),$("#postCheckBx").find("input").each(function(){$(this).prop("checked",!1)})}function getAuthors(isAction,action,post){ajaxService.getAjaxResponse({url:_this.services.getAuthors}).then(function(response){"true"===response.Success?(_this.authorsList=response.author,_this.responseReceived=!0,isAction&&_this.postAction(action,post)):null!=response.error&&sharedProperties.ajaxError(response.error)})}function displayAuthor(id){if(void 0===id||null===id||""===id)return void(_this.selectedAuthorInfo=!1);for(var i=0;i<_this.authorsList.length;i++)if(id===_this.authorsList[i].id){_this.selectedAuthorInfo=_this.authorsList[i];break}}function savePost(){_this.postMessageSubmit=!1,_this.postMessageForm.$valid?(_this.postMessageSubmit=!1,ajaxService.getAjaxResponse({url:_this.editMode?_this.services.update:_this.services.create,headers:{"Content-Type":"application/json"},data:{id:_this.editMode?_this.newPost.id:null,message:_this.postMessageObject.comment,onBehalfUser:{id:_this.selectedAuthorInfo.id,name:_this.selectedAuthorInfo.firstName,title:_this.selectedAuthorInfo.title,smallProfileImage:_this.selectedAuthorInfo.smallProfileImage}}}).then(function(response){"true"===response.Success?(_this.publishMode=!response.messagePost.published,sharedProperties.growlMessage(_this.editMode?"Post Updated Successfully":"New Post Created Successfully"),_this.saveMode=!1,_this.editMode=!1,_this.newPost=response.messagePost):null!=response.error&&sharedProperties.ajaxError(response.error)})):_this.postMessageSubmit=!0}function getTimeStamp(ary){if(void 0!==ary){var month=ary[1],day=ary[2],year=ary[0];return["January","February","March","April","May","June","July","August","September","October","November","December"][month-1].substr(0,3)+" "+day+", "+year}}function updateSelectionList(id){-1===$.inArray(id,_this.selectedCompanies)&&_this.selectedCompanies.push(id)}function publishPost(){return _this.publishPostSubmit=!1,_this.selectedCompanies.length&&(_this.selectAllMembers||_this.selectedRoles.length)?void ajaxService.getAjaxResponse({url:_this.services.publish,headers:{"Content-Type":"application/json"},data:{id:_this.newPost.id,companyIds:_this.selectedCompanies.length?_this.selectedCompanies:[],userRoles:!_this.selectAllMembers&&_this.selectedRoles.length?_this.selectedRoles:[],allCompany:_this.selectAllMembers}}).then(function(response){"true"===response.Success?(_this.publishMode=!1,_this.newPublishedPost=response.messagePost,_this.publishCompanyList=_this.newPublishedPost.companList.map(function(obj){return obj.name}),ngDialog.close(),sharedProperties.growlMessage("Post Published Successfully")):null!=response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))}):void(_this.publishPostSubmit=!0)}function selectAll(check){_this.selectedRoles=[],$("#postCheckBx").find(".pBx").each(function(){$(this).prop("checked",!1)})}function includeRole(role){var roleIndex=$.inArray(role,_this.selectedRoles);-1===roleIndex?_this.selectedRoles.push(role):_this.selectedRoles.splice(roleIndex,1),_this.selectedRoles.length&&_this.selectAllMembers&&(_this.selectAllMembers=!1)}function addAllCompanies(check){check?(_this.selectedCompanies=[],_this.companyList.map(function(obj){_this.selectedCompanies.push(obj.id)})):_this.selectedCompanies=[]}function postAction(action,post){var _post=post,isPublished=_post.published;"clone"===action?(_this.postMessageObject.comment.contentReference=_post.message.contentReference,_this.postMessageObject.selectedAuthor="",_this.selectedAuthorInfo=_post.message.onBehalfUser,_this.postMessageObject.comment.comment=_post.message.text):"edit"===action&&(_this.publishMode=!isPublished,_this.postMessageObject.comment.contentReference=_post.message.contentReference,_this.postMessageObject.selectedAuthor="",_this.selectedAuthorInfo=_post.message.onBehalfUser,_this.postMessageObject.comment.comment=_post.message.text,ajaxService.getAjaxResponse({url:_this.services.get,data:$.param({id:post.id})}).then(function(response){"true"===response.Success?(_this.newPost=response.messagePost,_this.newPublishedPost=post.published?response.messagePost:"",_this.publishCompanyList=post.published?response.messagePost.companList.map(function(obj){return obj.name}):[]):null!=response.error&&sharedProperties.ajaxError(response.error)}))}var _this=this;_this.services={getAuthors:"/sp/sysAdmin/posts/author/getAll",create:"/sp/sysAdmin/message/post/create",update:"/sp/sysAdmin/message/post/update",getAll:"/sp/sysAdmin/message/post/getAll",publish:"/sp/sysAdmin/message/post/publish",deletePost:"/sp/sysAdmin/message/post/deletePost",delete:"/sp/sysAdmin/message/post/delete",getCompanies:"/sp/sysAdmin/hk/getCompanyList",get:"/sp/sysAdmin/message/post/get",postActivity:"/sp/sysAdmin/message/post/postActivityDetails"},_this.listView=!0,_this.setOptions=setOptions,_this.authorsList=[],_this.messagePosts=[],_this.postMessageForm={},_this.selectedAuthorInfo=!1,_this.selectedCompanies=[],_this.updatedCompaniesList=[],_this.saveMode=!0,_this.editMode=!1,_this.publishMode=!1,_this.selectedRoles=[],_this.selectAllMembers=!1,_this.publishPostSubmit=!1,_this.selectAllCompanies=!1,_this.newPost="",_this.newPublishedPost="",_this.responseReceived=!1,_this.selectedMsgPosts=[],_this.postAuthorsList=[],_this.searchPostList="",_this.searchByAuthor="",_this.searchByStatus="",_this.searchByCompany="",_this.newFeedsOnly="all",_this.publishCompanyList=[],_this.viewPostActivity=!1,_this.searchList="",_this.selectedTab=0,_this.getAuthors=getAuthors,_this.getCompanies=getCompanies,_this.displayAuthor=displayAuthor,_this.savePost=savePost,_this.publishPost=publishPost,_this.getTimeStamp=getTimeStamp,_this.updateSelectionList=updateSelectionList,_this.includeRole=includeRole,_this.selectAll=selectAll,_this.addAllCompanies=addAllCompanies,_this.getPosts=getPosts,_this.postAction=postAction,_this.resetFilters=resetFilters,_this.deletePost=deletePost,_this.deletePostWithOptions=deletePostWithOptions,_this.getPostActivity=getPostActivity,_this.displayPostData=displayPostData,_this.selectedPostData=[],_this.postMessageObject=newsFeedService.postMessageObject(),_this.removeReference=removeReference,_this.postMessageSubmit=!1,_this.createCommentObject=createCommentObject,_this.daysCalculator=daysCalculator,_this.likedUserName=likedUserName,_this.videoPopUp=videoPopUp,_this.likedUsersList=[],_this.likePost=likePost,_this.addComment=addComment,_this.request=!1,_this.pageSetting={pageSize:5},_this.imageUrl=imageUrl,_this.showMoreComments=showMoreComments,_this.disabledInfinite=!1,_this.listSize=10,_this.infinteScroll=infinteScroll}function activityFeedsCtrl($scope,ajaxService,$localStorage,$state,$q,sharedProperties,$filter,$rootScope,ngDialog,$timeout){function deleteConfirm(feed){_this.deleteInfo=feed,ngDialog.open({template:"/sp/resources/html/sysAdmin/dashboard/delete-feed.html",scope:$scope})}function posNo(index){return parseInt(index,10)+1}function getFeeds(){ajaxService.getAjaxResponse({url:_this.services.getAll}).then(function(response){"true"===response.Success?(_this.activityList=response.activityFeeds,_this.responseReceived=!0):null!=response.error&&sharedProperties.ajaxError(response.error)})}function addNewFeed(){_this.newFeedSubmit=!1,_this.newFeedForm.$valid?(_this.newFeedSubmit=!1,ajaxService.getAjaxResponse({url:_this.updateFeedStatus?_this.services.update:_this.services.add,headers:{"Content-Type":"application/json"},data:{id:_this.updateFeedStatus?_this.updateFeedId:null,position:(parseInt(_this.newFeed.position,10)-1).toString(),text:_this.newFeed.text,feature:_this.newFeed.feature}}).then(function(response){"true"===response.Success?(_this.newFeedSubmit=!1,_this.newFeed={},sharedProperties.growlMessage(_this.updateFeedStatus?"Activity Feed Updated Successfully":"Activity Feed Created Successfully"),_this.updateFeedStatus=!1,getFeeds()):null!=response.error&&sharedProperties.ajaxError(response.error)})):_this.newFeedSubmit=!0}function deleteFeed(feed){ajaxService.getAjaxResponse({url:_this.services.delete,data:$.param({id:feed.id})}).then(function(response){if("true"===response.Success){for(var list=angular.copy(_this.activityList),i=list.length-1;i>=0;i--)if(list[i].id===feed.id){list.splice(i,1);break}_this.activityList=angular.copy(list),ngDialog.close(),sharedProperties.growlMessage("Activity Feed Deleted Successfully")}else null!=response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})}function editFeed(feed,pos){_this.updateFeedStatus=!0,_this.updateFeedId=feed.id,_this.newFeed.text=feed.text,_this.newFeed.position=pos,_this.newFeed.feature=feed.feature,$("html,body").animate({scrollTop:0},300)}var _this=this;_this.tinymceOptions={plugins:["link"],toolbar:"bold italic underline | link",height:100},_this.services={getAll:"/sp/sysAdmin/activityFeeds/getAll",add:"/sp/sysAdmin/activityFeeds/add",update:"/sp/sysAdmin/activityFeeds/update",delete:"/sp/sysAdmin/activityFeeds/delete"},_this.activityList=[],_this.newFeedForm={},_this.newFeed={},_this.newFeedSubmit=!1,_this.updateFeedStatus=!1,_this.responseReceived=!1,_this.searchActivityFeeds="",_this.addNewFeed=addNewFeed,_this.deleteConfirm=deleteConfirm,_this.deleteFeed=deleteFeed,_this.editFeed=editFeed,_this.getFeeds=getFeeds,_this.posNo=posNo}function authorsListCtrl($scope,ajaxService,$localStorage,$state,$q,sharedProperties,$filter,$rootScope,ngDialog,$timeout){function deleteConfirm(author,isMulti){_this.deleteInfo=author,_this.multi=isMulti,ngDialog.open({template:"/sp/resources/html/sysAdmin/dashboard/delete-author.html",scope:$scope})}function uploadImg(){$rootScope.showMediaManager=!0;var destroyRoot=$scope.$on("mediaData",function(e,data){if(destroyRoot(),null===data)return!0;_this.authorImage=data.url})}function getAuthors(){ajaxService.getAjaxResponse({url:_this.services.getAll}).then(function(response){"true"===response.Success?(_this.authorsList=response.author,_this.responseReceived=!0,_this.order("firstName",_this.nameReverse)):null!=response.error&&sharedProperties.ajaxError(response.error)})}function addAuthor(){_this.authorFormSubmit=!1,_this.newAuthorForm.$valid?(_this.authorFormSubmit=!1,ajaxService.getAjaxResponse({url:_this.updateAuthor?_this.services.update:_this.services.add,headers:{"Content-Type":"application/json"},data:{id:_this.updateAuthor?_this.updateAuthorId:null,name:_this.author.name,title:_this.author.title,smallProfileImage:_this.authorImage?_this.authorImage:null}}).then(function(response){"true"===response.Success?(_this.author={},_this.authorFormSubmit=!1,_this.authorImage=$rootScope.pullInterNationalization("dashboardAdmin.defaultImg"),getAuthors(),sharedProperties.growlMessage(_this.updateAuthor?"Author details Updated Successfully":"New Author added Successfully"),_this.updateAuthor=!1):null!=response.error&&sharedProperties.ajaxError(response.error)})):_this.authorFormSubmit=!0}function deleteAuthor(author){ajaxService.getAjaxResponse({url:_this.services.delete,data:$.param({authorId:author.id})}).then(function(response){if("true"===response.Success){for(var list=angular.copy(_this.authorsList),i=list.length-1;i>=0;i--)if(list[i].id===author.id){list.splice(i,1);break}_this.authorsList=angular.copy(list),ngDialog.close(),sharedProperties.growlMessage("Author Deleted Successfully")}else null!=response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})}function editAuthor(author){_this.updateAuthor=!0,_this.updateAuthorId=author.id,_this.author.name=author.firstName,_this.author.title=author.title,_this.authorImage=author.smallProfileImage,$("html,body").animate({scrollTop:0},300)}function order(predicate,reverse){_this.authorsList=$filter("orderBy")(_this.authorsList,predicate,reverse),_this.nameReverse="firstName"===predicate?!_this.nameReverse:_this.nameReverse,_this.titleReverse="title"===predicate?!_this.titleReverse:_this.titleReverse,_this.activeFilter=predicate}var _this=this;_this.services={getAll:"/sp/sysAdmin/posts/author/getAll",add:"/sp/sysAdmin/posts/author/add",update:"/sp/sysAdmin/posts/author/update",delete:"/sp/sysAdmin/posts/author/delete"},_this.newAuthorForm={},_this.author={},_this.authorsList=[],_this.authorFormSubmit=!1,_this.updateAuthor=!1,_this.imageEditBox=!1,_this.searchAuthors="",_this.responseReceived=!1,_this.multi=!1,_this.authorImage=$rootScope.pullInterNationalization("dashboardAdmin.defaultImg"),_this.nameReverse=!1,_this.titleReverse=!1,_this.activeFilter="firstName",_this.getAuthors=getAuthors,_this.addAuthor=addAuthor,_this.deleteConfirm=deleteConfirm,_this.deleteAuthor=deleteAuthor,_this.editAuthor=editAuthor,_this.uploadImg=uploadImg,_this.order=order}angular.module("spApp").controller("adminDashboardCtrl",adminDashboardCtrl),adminDashboardCtrl.$inject=["$scope","ajaxService","$localStorage","$state","$q","sharedProperties","$filter","$rootScope","ngDialog","$timeout"],angular.module("spApp").controller("adminMsgPostCtrl",adminMsgPostCtrl),adminMsgPostCtrl.$inject=["$scope","ajaxService","$localStorage","$state","$q","sharedProperties","$filter","$rootScope","ngDialog","$timeout","newsFeedService","basicService","notesService"],angular.module("spApp").controller("activityFeedsCtrl",activityFeedsCtrl),activityFeedsCtrl.$inject=["$scope","ajaxService","$localStorage","$state","$q","sharedProperties","$filter","$rootScope","ngDialog","$timeout"],angular.module("spApp").controller("authorsListCtrl",authorsListCtrl),authorsListCtrl.$inject=["$scope","ajaxService","$localStorage","$state","$q","sharedProperties","$filter","$rootScope","ngDialog","$timeout"];