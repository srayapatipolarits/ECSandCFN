function changeSubscriptionController($scope,$element,$attrs,$http,ngDialog,$timeout,ajaxService){$scope.priceFormatter=function(p){if(void 0!==p&&""!==p&&null!==p){return"$"+p.toFixed(2)}},$scope.product={},$scope.promoApplied=!1,$scope.finalAmount=0,$scope.promo={},$scope.updatedPromoDetails={},$scope.updateCC={},$scope.activeMembers=0,$scope.renewBusiness={},$scope.account={},$scope.promoFormSubmitted=!1,$scope.promoError={},$scope.promoError.error=!1,$scope.dialogStatus={},$scope.timeout=0,$scope.submitDisabled=!1,$scope.getMemberCount=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/getActiveMemberCount"}).then(function(response){if("true"===response.Success)$scope.activeMembers=response.activeMembers,$scope.account.numAccounts=response.activeMembers;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getAcccountInfo=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/businessAccountDetails"}).then(function(response){if("true"===response.Success)$scope.accountDetails=response,$scope.renewalDate=response.account.productInfo.renewalDate;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getPlanInfo=function(){ajaxService.getAjaxResponse({url:"/sp/signup/getProducts",data:$.param({productType:"BUSINESS"})}).then(function(response){if("true"===response.Success)$scope.products=response.products,$.each($scope.products,function(i){"YEARLY"===$scope.products[i].validityType&&($scope.annualProduct=$scope.products[i],$scope.annulUnitPrice=$scope.products[i].unitPrice)});else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getProductInfo=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/getCurrentBusinessProductInfo"}).then(function(response){if("true"===response.Success){$scope.productInfoError=!1,$scope.submitDisabled=!1,$scope.product=response.product;var multiplier=12;void 0!==response.promotion&&void 0!==response.promotion.unitPrice?($scope.product.updatedUnitPrice=parseFloat(response.promotion.unitPrice).toFixed(2),$scope.promoApplied=!0,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.activeMembers*multiplier).toFixed(2)):($scope.product.updatedUnitPrice=parseFloat(response.product.unitPrice).toFixed(2),$scope.promoApplied=!1,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.activeMembers*multiplier).toFixed(2))}else $scope.productInfoError=!0,$scope.submitDisabled=!0,jQuery("html, body").animate({scrollTop:0})})},$scope.paymentCalculator=function(empNo,action,type,event){var currentEmpNo=parseInt(empNo),updatedEmpNo=0,multiplier="YEARLY"===type?12:1;void 0===event?currentEmpNo>=20&&"add"===action?(updatedEmpNo=parseInt(currentEmpNo+1),$scope.account.numAccounts=updatedEmpNo,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*updatedEmpNo*multiplier).toFixed(2)):currentEmpNo>20&&"remove"===action?(updatedEmpNo=parseInt(currentEmpNo-1),$scope.account.numAccounts=updatedEmpNo,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*updatedEmpNo*multiplier).toFixed(2)):($scope.account.numAccounts=parseInt($scope.account.minEmployee),$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.account.numAccounts*multiplier).toFixed(2)):/^[0-9\b]+$/g.test(empNo)&&empNo>=20?($scope.account.numAccounts=empNo,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.account.numAccounts*multiplier).toFixed(2),$timeout.cancel($scope.timeout)):($timeout.cancel($scope.timeout),$scope.timeout=$timeout(function(){$scope.account.numAccounts=20,$scope.finalAmount=parseFloat(20*$scope.product.updatedUnitPrice*multiplier).toFixed(2)},1500))},$scope.activatePromo=function(promoCode){if(void 0!==promoCode){var _params={code:promoCode,productId:$scope.product.id};ajaxService.getAjaxResponse({url:"/sp/signup/promotion",data:$.param(_params)}).then(function(response){"true"===response.Success?($scope.updatedPromoDetails=response.promotion,$scope.product.updatedUnitPrice=parseFloat(response.promotion.unitPrice).toFixed(2),$scope.promoApplied=!0,$scope.finalAmount=parseFloat(12*$scope.product.updatedUnitPrice).toFixed(2)):($scope.promoError.error=!0,$scope.promoError.msg=response.error,$scope.promo.code=null,$timeout(function(){$scope.promoError.error=!1},1500))})}else $scope.promoFormSubmitted=!0,$scope.promo.code=null},$scope.renewIndividualSubscription=function(fData){var _paramsUpdated,_params={};_params=!1===$scope.promoApplied?{productId:$scope.product.id}:{productId:$scope.product.id,promotionId:$scope.updatedPromoDetails.id},$scope.updateCC.$valid?(_paramsUpdated=$.extend({},_params,fData),ajaxService.getAjaxResponse({url:"/sp/admin/account/renewAccount",data:$.param(_paramsUpdated)}).then(function(response){if("true"===response.Success)$scope.dialogStatus.title="Subscription Renewal",$scope.dialogStatus.content="Subscription renewed successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/success-dialog.html",scope:$scope});else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})):$scope.updateCC.submitted=!0},$scope.deactivatePromo=function(){$scope.product.updatedUnitPrice=parseFloat($scope.product.unitPrice).toFixed(2),$scope.finalAmount=parseFloat(12*$scope.product.updatedUnitPrice).toFixed(2),$scope.promoApplied=!1,$scope.promo.code=null},$scope.cancelRedirect=function(){window.location="/sp/admin/account/business"},$scope.renewBusinessSubscription=function(fData){var _paramsUpdated,_params={};_params=!1===$scope.promoApplied?{numAccounts:$scope.account.numAccounts,productId:$scope.product.id}:{numAccounts:$scope.account.numAccounts,productId:$scope.product.id,promotionId:$scope.updatedPromoDetails.id},!1===$scope.submitDisabled&&($scope.renewBusiness.$valid?(_paramsUpdated=$.extend({},_params,fData),ajaxService.getAjaxResponse({url:"/sp/admin/account/renewAccount",data:$.param(_paramsUpdated)}).then(function(response){"true"===response.Success?console.log("Success"):($scope.submitException=!0,$scope.submitExceptionMsg=void 0!==response.error.InvalidRequestException?response.error.InvalidRequestException:"Error occured on server.",jQuery("html, body").animate({scrollTop:0}))})):($scope.renewBusiness.submitted=!0,jQuery("html, body").animate({scrollTop:0})))},$scope.initRenewBusiness=function(){$scope.getMemberCount(),$scope.getProductInfo(),$scope.getAcccountInfo()},$scope.initRenewBusiness()}angular.module("spApp").controller("changeSubscriptionController",changeSubscriptionController),changeSubscriptionController.$inject=["$scope","$element","$attrs","$http","ngDialog","$timeout","ajaxService"];