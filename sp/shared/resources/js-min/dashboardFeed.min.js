!function(){function dashBoardFeed($scope,ajaxService,$localStorage,sharedProperties,newsFeedService,ngDialog,basicService,$q,notesService,$rootScope,$timeout,$templateRequest,$compile,$sce,miniPollsService){function miniPollHexOps(newsId,index,mEvents){mEvents?vm.hexHoverIndex[newsId]=index:vm.hexSelectedIndex[newsId]!==index?vm.hexSelectedIndex[newsId]=index:(vm.hexSelectedIndex[newsId]=-1,$timeout(function(){$("input[name=pollOptionsListingScale_"+newsId+"]").prop("checked",!1),vm.pollVotingDetails[newsId]=""},200))}function endPollCheck(id,dt){if(null!==dt&&void 0!==dt){var today=(new Date).setHours(0,0,0,0),eDate=new Date(parseInt(dt[0],10),parseInt(dt[1]-1,10),parseInt(dt[2],10)).setHours(0,0,0,0);vm.pollEnded[id]=today>=eDate}else vm.pollEnded[id]=!1}function assignPollCheck(ary,id,result){var ele=result?"#miniPollResult_"+id+" li.miniPollsOptsInput":"#miniPoll_"+id+" li.miniPollsOptsInput";$timeout(function(){$.each($(ele),function(index,val){-1!==ary.indexOf(index)&&($(this).find("input").prop("checked","checked"),vm.hexSelectedIndex[id]=index)})},200)}function pollActions(type,id){var newsId=vm.newsFeedArray.indexOf(id);switch(type){case"view":-1!==newsId&&(null===vm.newsFeed[newsId].message.miniPoll.result&&(vm.newsFeed[newsId].message.miniPoll.result={results:[0,0,0,0],averageScore:0}),vm.newsFeed[newsId].message.miniPoll.hideResults=!1,vm.viewPollResult[id]=!0,vm.newsFeed[newsId].userNewsFeedSelection&&vm.assignPollCheck(vm.newsFeed[newsId].userNewsFeedSelection,id,!0));break;case"share":-1!==newsId&&updatePollActions("share",id);break;case"end":-1!==newsId&&updatePollActions("end",id);break;case"vote":vm.newsFeed[newsId].message.miniPoll.hideResults=!0,vm.viewPollResult[id]=!1}}function setPollEndDate(){var dt=new Date;return[parseInt(dt.getFullYear(),10),parseInt(dt.getMonth()+1,10),parseInt(dt.getDate(),10),parseInt(dt.getHours(),10),parseInt(dt.getMinutes(),10),parseInt(dt.getSeconds(),10),parseInt(dt.getMilliseconds(),10)]}function updatePollActions(type,id){miniPollsService.updatePoll("shareNote",type,{messageId:id}).then(function(response){if(null===response)return!0;var newsId=vm.newsFeedArray.indexOf(id);-1!==newsId&&("share"===type?(vm.newsFeed[newsId].message.miniPoll.hideResults=!1,vm.pollHideResult[id]=!1,vm.viewPollResult[id]=!1,vm.assignPollCheck(vm.newsFeed[newsId].userNewsFeedSelection,id,!0)):"end"===type&&(vm.pollEnded[id]=!0,vm.newsFeed[newsId].message.miniPoll.result=response.miniPollResult,vm.newsFeed[newsId].message.miniPoll.endDate=setPollEndDate()))})}function getPollTotal(ary){return ary.reduce(function(a,b){return a+b})}function processVote(id){vm.pollVotingError[id]=!1;var param={messageId:id},opts=[];if(void 0!==vm.pollVotingDetails[id]&&null!==vm.pollVotingDetails[id]&&""!==vm.pollVotingDetails[id])if(vm.pollVotingError[id]=!1,"object"==typeof vm.pollVotingDetails[id]){for(var key in vm.pollVotingDetails[id])vm.pollVotingDetails[id].hasOwnProperty(key)&&vm.pollVotingDetails[id][key]&&opts.push(parseInt(key,10));opts.length?(param.selection=opts.toString(),answerPoll(id,param)):vm.pollVotingError[id]=!0}else param.selection=parseInt(vm.pollVotingDetails[id],10),answerPoll(id,param);else vm.pollVotingError[id]=!0}function answerPoll(id,param){miniPollsService.updatePoll("shareNote","answer",param).then(function(response){if(null===response)return!0;var newsId=vm.newsFeedArray.indexOf(id);-1!==newsId&&(vm.newsFeed[newsId].hasCompleted=!0,vm.newsFeed[newsId].message.miniPoll.result=response.miniPollResult,vm.newsFeed[newsId].userNewsFeedSelection=param.selection.toString().split(",").map(Number),vm.newsFeed[newsId].message.miniPoll.hideResults?vm.assignPollCheck(vm.newsFeed[newsId].userNewsFeedSelection,id,!1):vm.assignPollCheck(vm.newsFeed[newsId].userNewsFeedSelection,id,!0))})}function typeSelect(sec,elem){vm.activeProfileContent=sec,vm.activeProfileSummary=sec,vm.togglePrimaryGraph(sec,elem)}function togglePrimaryGraph(id,elem){var g0=$(elem).find(".prismG0"),g1=$(elem).find(".prismG1"),g2=$(elem).find(".prismG2"),c0=$(elem).find(".crossLines0"),c1=$(elem).find(".crossLines1");vm.label="",vm.prismLabelContent=!1,jQuery(".outer-labels").find("p").removeClass("active"),1===id?(g0.attr({"fill-opacity":0,"stroke-width":0}),g1.attr({"fill-opacity":.6,"stroke-width":3,"stroke-opacity":.6,"stroke-dasharray":0}),c1.attr({"stroke-width":1}),c0.attr({"stroke-width":0}),g2.attr({"fill-opacity":.3,"stroke-opacity":.3,"stroke-dasharray":"3,6"})):(g0.attr({"fill-opacity":.3,"stroke-width":3,"stroke-opacity":.3,"stroke-dasharray":"3,6"}),g1.attr({"fill-opacity":0,"stroke-width":0,"stroke-opacity":0}),g2.attr({"fill-opacity":.6,"stroke-opacity":.6,"stroke-dasharray":0}),c1.attr({"stroke-width":0}),c0.attr({"stroke-width":1}))}function init(mode){$(document).ready(function(){$("html, body").scrollTop(0),$(window).on("load",function(){setTimeout(function(){$("html, body").scrollTop(0)},0)})}),vm.userInfo=basicService.getUserInfo(),sharedProperties.changeMomentDefaults(),$localStorage.remove("feedbackUserId"),basicService.getAllValidMember().then(function(response){switch(vm.allMember=response,vm.pageReady=!0,vm.bindEvents(),mode){case"home":vm.getNewsFeed();break;case"profile":vm.getUserProfileFeed(),!vm.mobile&&(vm.prismLensDetail(),vm.recentActivities());break;case"message":vm.getMessageDetail()}})}function getMessageDetail(){switch(vm.viewName){case"user":newsPrivate();break;case"community":newsPublic()}}function newsPrivate(){ajaxService.getAjaxResponse({url:vm.serviceApis.message,data:$.param({messageId:vm.viewType,msgDetailsPage:!0})}).then(function(response){if("true"===response.Success){var res={newsFeed:[]};res.newsFeed.push(response.message),newsFeedOperation(res)}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function newsPublic(){ajaxService.getAjaxResponse({url:vm.serviceApis.publicChannel,data:$.param({pcRefId:vm.viewType,all:!1})}).then(function(response){if("true"===response.Success){var res={newsFeed:[]};vm.highlighted=sharedProperties.getParam("cid"),res.newsFeed.push(response.publicChannel),newsFeedOperation(res)}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function getNewsFeed(){ajaxService.getAjaxResponse({url:vm.changeFilterOption(),data:$.param({startIdx:vm.pageSetting.startIdx})}).then(function(response){if("true"===response.Success){newsFeedOperation(response);var openTab=sharedProperties.getParam("open"),gdParam=$localStorage.get("gdParam");openTab&&"gd"===openTab&&""!==gdParam&&null!==gdParam&&!vm.mobile?vm.selectedTab="gd":openTab&&"gd"===openTab&&""!==gdParam&&null!==gdParam&&vm.mobile&&$rootScope.handleGlobalGDState()}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function getUserProfileFeed(){ajaxService.getAjaxResponse({url:vm.serviceApis.getUserProfileFeed,data:$.param({startIdx:vm.pageSetting.startIdx,userId:vm.profilePage})}).then(function(response){"true"===response.Success?(void 0!==response.member&&(vm.profilePageDetail=response),void 0===response.newsFeed&&(response.newsFeed=[]),newsFeedOperation(response)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function prismLensDetail(){ajaxService.getAjaxResponse({url:vm.serviceApis.prismLensDetail,data:$.param({userId:vm.profilePage})}).then(function(response){"true"===response.Success?vm.prismLensView=response:null!==response.error&&sharedProperties.ajaxError(response.error)})}function recentActivities(){ajaxService.getAjaxResponse({url:vm.serviceApis.recentActivities,data:$.param({userId:vm.profilePage})}).then(function(response){"true"===response.Success?vm.recentActivities=response.activityMessages:null!==response.error&&sharedProperties.ajaxError(response.error)})}function sendReminderFeedback(email,id){ajaxService.getAjaxResponse({url:vm.serviceApis.sendReminder,data:$.param({brandHeader:"",ctaLabel:"",ctaUrl:"",logType:"PrismLens",type:"FeedbackReminder",memberList:email,feedbackUserId:id})}).then(function(response){"true"===response.Success?sharedProperties.growlMessage($rootScope.pullInterNationalization("dashboard.prismLensSuccess")):null!==response.error&&sharedProperties.ajaxError(response.error)})}function addComment(news,taggedObject,event){if(!news.tempcomment.comment.comment.length&&null===news.tempcomment.comment.contentReference.title||news.edit)return!1;var obj=null;"PublicChannel"===news.type?(obj=notesService.publicChannelObj(),obj.comment.comment=news.tempcomment.comment.comment,obj.comment.contentReference=news.tempcomment.comment.contentReference,obj.cid=news.cid||-1,obj.taggedMemberIds=taggedObject.map(function(e){return e.id}),obj.spFeature=news.spFeature,obj.pcRefId=news.pcRefId,obj.parentRefId=news.parentRefId,obj.id=news.id,obj.title=news.title,obj.subModuleFeature=news.subModuleFeature,news.tempcomment=vm.createCommentObject(news.tempcomment.comment.cid),notesService.addComment(obj).then(function(data){if(null===data)return!0;!angular.isArray(news.comments)&&(news.comments=[]),vm.previous=!1,news.comments.unshift(data.comment),news.commentCount++,news.number++,vm.pageSetting.commentPageSize++,sharedProperties.fireAnalyticsEvent("Newsfeed | Add Comment",obj.title)})):(obj=newsFeedService.postMessageObject(),obj.comment.comment=news.tempcomment.comment.comment,obj.comment.contentReference=news.tempcomment.comment.contentReference,obj.cid=news.cid||-1,obj.taggedMemberIds=taggedObject.map(function(e){return e.id}),news.tempcomment=vm.createCommentObject(news.tempcomment.comment.cid),obj.messageId=news.id,newsFeedService.addComment(obj).then(function(data){if(null===data)return!0;!angular.isArray(news.comments)&&(news.comments=[]),vm.previous=!1,news.comments.unshift(data.message.comment),news.commentCount++,news.number++,vm.pageSetting.commentPageSize++,sharedProperties.fireAnalyticsEvent("Newsfeed | Add Comment",data.actionType)}))}function addChildComment(news,collection,taggedObject,uniqueId){if(!news.tempcomment.comment.comment.length&&null===news.tempcomment.comment.contentReference.title||news.edit)return!1;var obj=null;"PublicChannel"===collection.type?(obj=notesService.publicChannelObj(),obj.comment.comment=news.tempcomment.comment.comment,obj.comment.contentReference=news.tempcomment.comment.contentReference,obj.cid=news.cid,obj.taggedMemberIds=taggedObject.map(function(e){return e.id}),obj.spFeature=collection.spFeature,obj.pcRefId=collection.pcRefId,obj.parentRefId=collection.parentRefId,obj.id=collection.id,obj.title=collection.title,obj.subModuleFeature=collection.subModuleFeature,news.tempcomment=vm.createCommentObject(news.tempcomment.comment.cid),notesService.addComment(obj).then(function(data){if(null===data)return!0;!angular.isArray(news.childComments)&&(news.childComments=[]),vm.previous=!1,news.childComments.unshift(data.comment),news.commentCount++,news.number++,sharedProperties.fireAnalyticsEvent("Newsfeed | Add Comment",obj.title)})):(obj=newsFeedService.postMessageObject(),obj.comment.comment=news.tempcomment.comment.comment,obj.comment.contentReference=news.tempcomment.comment.contentReference,obj.cid=news.cid,obj.taggedMemberIds=taggedObject.map(function(e){return e.id}),news.tempcomment=vm.createCommentObject(news.tempcomment.comment.cid),obj.messageId=collection.id,newsFeedService.addComment(obj).then(function(data){if(null===data)return!0;!angular.isArray(news.childComments)&&(news.childComments=[]),vm.previous=!1,news.childComments.unshift(data.message.comment),news.commentCount++,news.number++,vm.hideShow[uniqueId]=!1,sharedProperties.fireAnalyticsEvent("Newsfeed | Add Comment",data.actionType)}))}function likePost(obj){newsFeedService.likePost({messageId:obj.news.id,cid:obj.comment.cid,childCid:obj.childComment.cid}).then(function(data){if(null===data)return!0;stackSwitch(data,!1)})}function stackSwitch(data,sse){var newsId=vm.newsFeedArray.indexOf(data.messageId),commentId=-1,childCommentsId=-1;-1!==newsId&&(-1!==data.childCid?(commentId=returnIndex(vm.newsFeed[newsId].comments,data.cid),childCommentsId=returnIndex(vm.newsFeed[newsId].comments[commentId].childComments,data.childCid),likeCount(vm.newsFeed[newsId].comments[commentId].childComments[childCommentsId],data,childCommentsId,sse)):-1!==data.cid?(commentId=returnIndex(vm.newsFeed[newsId].comments,data.cid),likeCount(vm.newsFeed[newsId].comments[commentId],data,commentId,sse)):likeCount(vm.newsFeed[newsId],data,newsId,sse))}function returnIndex(obj,data){for(var i=0;i<obj.length;i++)if(obj[i].cid===data)return i;return-1}function likeCount(obj,data,index,sse){-1!==index&&(sse?$scope.$apply(function(){obj.likeCount=data.likeCount,obj.likedByUser=!obj.likedByUser}):(obj.likeCount=data.likeCount,obj.likedByUser=!obj.likedByUser))}function childComment(news){news.number=news.number+(null!==vm.viewType?vm.pageSetting.commentIncrement:vm.pageSetting.commentIncrementLimit)}function previousComment(obj,news,SSE){return news.comments.length===news.commentCount?(vm.previous=!0,vm.childComment(news),vm.request=!1,!0):!0===vm.request||(vm.request=!0,void newsFeedService.previousComments(obj).then(function(data){if(null===data)return!0;if(void 0!==SSE&&SSE)$scope.$apply(function(){vm.previous=!0;for(var i=0;i<news.length;i++)data.message.comments[i].number=news.comments[i].number;news.comments=data.message.comments,vm.childComment(news),vm.request=!1});else{vm.previous=!0;for(var i=0;i<news.length;i++)data.message.comments[i].number=news.comments[i].number;news.comments=data.message.comments,vm.childComment(news),vm.request=!1}}))}function previousCommentPublic(obj,news,SSE){return news.comments.length===news.commentCount?(vm.childComment(news),vm.request=!1,!0):!0===vm.request||(vm.request=!0,void notesService.getAllComment(obj).then(function(data){if(null===data)return!0;void 0!==SSE&&SSE?$scope.$apply(function(){news.comments=data.comment,vm.childComment(news),vm.request=!1}):(news.comments=data.comment,vm.childComment(news),vm.request=!1)}))}function blockComment(news){newsFeedService.blockComment({messageId:news.id,blockCommenting:!news.blockCommenting}).then(function(data){if(ngDialog.close(),null===data)return!0;news.blockCommenting=!news.blockCommenting})}function deletePost(id){newsFeedService.deletePost({messageId:id}).then(function(data){if(ngDialog.close(),null===data)return!0;var index=vm.newsFeedArray.indexOf(id);-1!==index&&(vm.newsFeedArray.splice(index,1),vm.newsFeed.splice(index,1)),vm.newsFeed.length&&!vm.fetchingData&&vm.pagination&&(vm.fetchingData=!0,vm.getNewsFeed()),sharedProperties.growlMessage($rootScope.pullInterNationalization("dashboard.postdeleted"))})}function deleteComment(obj){"PublicChannel"===obj.news.type?newsFeedService.deleteCommmentPublic({pcRefId:obj.news.pcRefId,cid:obj.comment.cid,childCid:obj.childComment.cid}).then(function(data){if(ngDialog.close(),null===data)return!0;stackDelete(data),sharedProperties.growlMessage($rootScope.pullInterNationalization("dashboard.commentdeleted"))}):newsFeedService.deleteComment({messageId:obj.news.id,cid:obj.comment.cid,childCid:obj.childComment.cid}).then(function(data){if(ngDialog.close(),null===data)return!0;stackDelete(data),sharedProperties.growlMessage($rootScope.pullInterNationalization("dashboard.commentdeleted"))})}function stackDelete(data){var newsId=vm.newsFeedArray.indexOf(data.messageId||data.id),commentId=-1,childCommentsId=-1;-1!==newsId&&(-1!==data.childCid?(commentId=returnIndex(vm.newsFeed[newsId].comments,data.cid),childCommentsId=returnIndex(vm.newsFeed[newsId].comments[commentId].childComments,data.childCid),deleteCommentPost(vm.newsFeed[newsId].comments[commentId].childComments,childCommentsId,vm.newsFeed[newsId].comments[commentId],!1,vm.newsFeed[newsId])):-1!==data.cid?(commentId=returnIndex(vm.newsFeed[newsId].comments,data.cid),deleteCommentPost(vm.newsFeed[newsId].comments,commentId,vm.newsFeed[newsId],!1,vm.newsFeed[newsId])):deleteCommentPost(vm.newsFeed,newsId,vm.newsFeed[newsId],!1,vm.newsFeed[newsId]))}function getPreviousComments(data,SSE){"PublicChannel"===data.type?vm.previousCommentPublic({pcRefId:data.pcRefId,all:!0},data,SSE):vm.previousComment({messageId:data.id,commentsOnly:!0},data,SSE)}function deleteCommentPost(obj,deletedIndex,count,SSE,complete){-1!==deletedIndex&&(SSE?$scope.$apply(function(){obj.splice(deletedIndex,1),count.commentCount--}):(obj.splice(deletedIndex,1),count.commentCount--),obj.length<2&&count.commentCount>2&&getPreviousComments(complete,SSE))}function saveFeed(){var obj={comment:{comment:vm.cloneFeed.message.text,contentReference:vm.cloneFeed.message.contentReference},taggedMemberIds:vm.cloneFeed.taggedMembers,messageId:vm.cloneFeed.id,deletedTaggedMemberIds:vm.cloneFeed.deletedTaggedMemberIds};newsFeedService.updatePost(obj).then(function(data){if(null===data)return!0;for(var i=0;i<vm.newsFeed.length;i++)if(vm.newsFeed[i].id===vm.cloneFeed.id){vm.newsFeed[i].message=data.message.message,vm.newsFeed[i].taggedMembers=data.message.taggedMembers,vm.newsFeed[i].updatedOn=data.message.updatedOn,vm.newsFeed[i].edit=!1,vm.cloneFeed=null,vm.lastNewsFeed=null;break}vm.emitLazy()})}function follow(news,bool){newsFeedService.follow({messageId:news.id,follow:bool}).then(function(data){if(null===data)return!0;news.hide=!bool,news.hide&&vm.newsFeed.length&&!vm.fetchingData&&vm.pagination?(vm.fetchingData=!0,vm.getNewsFeed(),sharedProperties.fireAnalyticsEvent("Newsfeed | Hide",news.type+" - "+!news.hide)):vm.emitLazy()})}function followPublic(news,bool){notesService.followPublicChannel(news.pcRefId,bool).then(function(data){if(null===data)return!0;news.hide=!bool,news.hide&&vm.newsFeed.length&&!vm.fetchingData&&vm.pagination?(vm.fetchingData=!0,vm.getNewsFeed(),sharedProperties.fireAnalyticsEvent("Newsfeed | Follow/Unfollow",news.title+" - "+!news.follow)):vm.emitLazy()})}function newsFeedOperation(response){if(vm.pageSetting.startIdx)for(var j=0,index=-1;j<response.newsFeed.length;j++)index=vm.newsFeedArray.indexOf(response.newsFeed[j].id),-1===index?(response.newsFeed[j].number=vm.mobile?1:null===response.newsFeed[j].comments?3:response.newsFeed[j].comments.length,vm.newsFeedArray.push(response.newsFeed[j].id),vm.newsFeed.push(response.newsFeed[j])):(vm.newsFeedArray.move(index,vm.newsFeedArray.length-1),vm.newsFeed.move(index,vm.newsFeed.length-1));else{vm.newsFeedArray=[],vm.update={update:!1,count:0};for(var i=0;i<response.newsFeed.length;i++)response.newsFeed[i].number=vm.mobile?1:null===response.newsFeed[i].comments?3:response.newsFeed[i].comments.length,vm.newsFeedArray.push(response.newsFeed[i].id);vm.newsFeed=response.newsFeed}vm.pagination=void 0!==response.pagination&&response.pagination,vm.pageSetting.startIdx=vm.newsFeed.length,vm.fetchingData=!1,vm.responseRecieved=!0}function tagAddedEdit(tag){vm.cloneFeed.taggedMembers.push(tag.id);var deletedIndex=vm.cloneFeed.deletedTaggedMemberIds.indexOf(tag.id);-1!==deletedIndex&&vm.cloneFeed.deletedTaggedMemberIds.splice(deletedIndex,1)}function tagRemovedEdit(tag){vm.cloneFeed.taggedMembers.splice(vm.cloneFeed.taggedMembers.indexOf(tag.id),1),vm.cloneFeed.deletedTaggedMemberIds.push(tag.id)}function cloneFeedFn(news){vm.mobile?vm.overlay("edit",news):cloneNews(news)}function cloneNews(news){null===vm.lastNewsFeed?vm.lastNewsFeed=news:(vm.lastNewsFeed.edit=!1,vm.lastNewsFeed=news);for(var i=0;i<vm.newsFeed.length;i++)if(vm.newsFeed[i].id===news.id){vm.cloneFeed=angular.copy(vm.newsFeed[i]),angular.isArray(vm.newsFeed[i].taggedMembers)?vm.cloneFeed.taggedMembersFull=angular.copy(vm.newsFeed[i].taggedMembers):vm.cloneFeed.taggedMembersFull=[];break}basicService.getAllValidMember().then(function(response){vm.allMember=response,vm.cloneFeed.taggedMembers=[],vm.cloneFeed.deletedTaggedMemberIds=[];for(var i=0;i<vm.cloneFeed.taggedMembersFull.length;i++)vm.cloneFeed.taggedMembers.push(vm.cloneFeed.taggedMembersFull[i].id);vm.copyCloneFeed=angular.copy(vm.cloneFeed),news.edit=!0,vm.emitLazy()})}function loadEmail(query){for(var deferred=$q.defer(),result=[],i=0;i<vm.allMember.length&&result.length<5;i++)-1===vm.allMember[i].name.toLowerCase().indexOf(query.toLowerCase())&&-1===vm.allMember[i].email.toLowerCase().indexOf(query.toLowerCase())||result.push(vm.allMember[i]);return deferred.resolve(result),deferred.promise}function blockPostModal(id){vm.newsID=id,ngDialog.open({template:vm.mortalUrl.blockCommenting,scope:$scope})}function deletePostModal(id){vm.deleteID=id,ngDialog.open({template:vm.mortalUrl.deletePost,scope:$scope})}function deleteCommentModal(news){vm.obj=news,ngDialog.open({template:vm.mortalUrl.deleteComment,scope:$scope})}function displayRole(userObj){vm.winWidth=$(window).width();var userRoles=userObj.roles,complete=[];return-1!==userRoles.indexOf("GroupLead")&&complete.push('<span class="thin">'+$rootScope.pullInterNationalization("manageAccountContent.l")+"</span>"),-1!==userRoles.indexOf("AccountAdministrator")&&complete.push('<span class="thin">'+$rootScope.pullInterNationalization("manageAccountContent.admin")+"</span>"),userObj.deactivated&&complete.push('<span class="thin blocked">'+$rootScope.pullInterNationalization("manageAccountContent.blocked")+"</span>"),complete.join("")}function viewMemberDetails(email){$localStorage.set("previousView","members"),window.location.href="/sp/admin/manageAccount#/memberDetails?email="+email}function videoPopUp(url,mode,newtab){if("Video"===mode)if(newtab){var wind=window.open(url,"_blank");wind.focus()}else sharedProperties.videoPopUp(url);else{var modes=newtab?"_blank":"_self";window.open(url,modes).focus()}}function removeReference(reference){reference.authorSource=null,reference.description=null,reference.imageUrl=null,reference.media=null,reference.title=null}function createCommentObject(cid){return{comment:{comment:"",contentReference:{title:null,description:null,name:null,SPMedia:null},cid:cid||-1}}}function getAppropiateTemplate(type){switch(type){case"Default":case"SurePeoplePost":case"UserActivity":case"Announcement":return"/sp/resources/html/dashboard/default.html";case"PublicChannel":return"/sp/resources/html/dashboard/public.html";case"SPActivityFeed":return"/sp/resources/html/dashboard/SPactivity.html";case"MiniPolls":return"/sp/resources/html/mini-polls/result-newsFeed.html"}}function infinteScroll(mode){if(vm.newsFeed.length&&!vm.fetchingData&&vm.pagination)switch(vm.fetchingData=!0,mode){case"home":vm.getNewsFeed();break;case"profile":vm.getUserProfileFeed();break;case"message":vm.getMessageDetail()}}function likedUserName(obj,event){newsFeedService.likeUserName({messageId:obj.news.id,cid:obj.comment.cid,childCid:obj.childComment.cid}).then(function(data){if(null===data)return!0;ngDialog.open({template:vm.mortalUrl.likedUsersList,scope:$scope}),vm.likedUsersList=data.likeUsers})}function deleteIndex(id){var index=vm.newsFeedArray.indexOf(id);-1!==index&&(vm.newsFeedArray.splice(index,1),vm.newsFeed.splice(index,1))}function receiveSSEData(e,data){if(null===data)return!0;switch(data.op){case"ADD_COMMENT":addCommentSSE(data.message||data);break;case"DELETE_COMMENT":deleteCommentSSE(data.message||data);break;case"ADD":$scope.$apply(function(){vm.update.update=!0,vm.update.count++});break;case"DELETE":deletepostSSE(data.messageId||data.id);break;case"LIKE_COMMENT":likePostSSE(data);break;case"UPDATE":data.message.message.user.id!==vm.userInfo.member.id&&$scope.$apply(function(){vm.update.update=!0,vm.update.count++});break;case"VOTE_MINIPOLL":var newsId=vm.newsFeedArray.indexOf(data.messageId);-1!==newsId&&$scope.$apply(function(){void 0!==data.miniPollShare&&null!==data.miniPollShare&&(vm.newsFeed[newsId].message.miniPoll.hideResults=!1,vm.pollHideResult[data.messageId]=!1),void 0!==data.endDate&&null!==data.endDate&&(vm.newsFeed[newsId].message.miniPoll.endDate=data.endDate,vm.endPollCheck(data.messageId,data.endDate)),vm.newsFeed[newsId].message.miniPoll.result=data.miniPollResult})}}function likePostSSE(response){stackSwitch(response,!0)}function addCommentSSE(response){var newsId=vm.newsFeedArray.indexOf(response.id),commentId=-1;-1!==newsId&&(void 0!==response.cid&&-1!==response.cid?-1!==(commentId=returnIndex(vm.newsFeed[newsId].comments,response.cid))&&$scope.$apply(function(){!angular.isArray(vm.newsFeed[newsId].comments[commentId].childComments)&&(vm.newsFeed[newsId].comments[commentId].childComments=[]),vm.previous=!1,vm.newsFeed[newsId].comments[commentId].childComments.unshift(response.comment),vm.newsFeed[newsId].comments[commentId].commentCount++,vm.newsFeed[newsId].comments[commentId].number++,vm.pageSetting.commentPageSize++}):$scope.$apply(function(){!angular.isArray(vm.newsFeed[newsId].comments)&&(vm.newsFeed[newsId].comments=[]),vm.previous=!1,vm.newsFeed[newsId].comments.unshift(response.comment),vm.newsFeed[newsId].commentCount++,vm.newsFeed[newsId].number++,vm.pageSetting.commentPageSize++}))}function deleteCommentSSE(response){var newsId=vm.newsFeedArray.indexOf(response.id||response.messageId),commentId=-1,childCommentsId=-1;-1!==newsId&&(void 0!==response.childCid&&-1!==response.childCid?(commentId=returnIndex(vm.newsFeed[newsId].comments,response.cid),childCommentsId=returnIndex(vm.newsFeed[newsId].comments[commentId].childComments,response.childCid),deleteCommentPost(vm.newsFeed[newsId].comments[commentId].childComments,childCommentsId,vm.newsFeed[newsId].comments[commentId],!0,vm.newsFeed[newsId])):void 0!==response.cid&&-1!==response.cid?(commentId=returnIndex(vm.newsFeed[newsId].comments,response.cid),deleteCommentPost(vm.newsFeed[newsId].comments,commentId,vm.newsFeed[newsId],!0,vm.newsFeed[newsId])):deleteCommentPost(vm.newsFeed,newsId,vm.newsFeed[newsId],!0,vm.newsFeed[newsId]))}function deletepostSSE(messageId){var index=vm.newsFeedArray.indexOf(messageId);-1!==index&&$scope.$apply(function(){vm.newsFeed[index].hide=!0,vm.newsFeed[index].delete=!0})}function sseFeedUpdate(){vm.pageSetting.startIdx=0,vm.getNewsFeed()}function imageUrl(loop){var arrayofObj=[];for(var key in loop.media)if("Video"===loop.media[key].mediaType||"VideoTab"===loop.media[key].mediaType){arrayofObj.push(loop.media[key]);break}return arrayofObj.length||arrayofObj.push({url:loop.imageUrl,mediaType:"image"}),arrayofObj}function changeFilterOption(){return"owner"===vm.pageSetting.filter?vm.serviceApis.userNewsFeed:"tagged"===vm.pageSetting.filter?vm.serviceApis.announcementNewsFeed:vm.serviceApis.getNewsFeed}function updateTabView(tab){tab===vm.selectedTab?vm.selectedTab=-1:vm.selectedTab=tab,"gd"!==tab&&($rootScope.gdActive=!1),vm.mobile||$("html,body").animate({scrollTop:$(".dashboard-section-tabs").offset().top},500)}function openMobileFeedbackPanel(){$rootScope.mobileDashboardFeedback=!0}function whatispublic(){ngDialog.open({template:vm.mortalUrl.publicMessage,scope:$scope})}function shareInGD(content){$localStorage.set("shareComment",content),vm.selectedTab="gd"}function whiteSpace(text){return/\s/.test(text)}function bindEvents(){$("body").on("click",".sp-video-inline",function(event){event.preventDefault(),sharedProperties.videoPopUp($(this).attr("href"))}),$(document).on("DOMNodeInserted",function(e){if($(e.target).is(".sp-user-tool-tip")){for(var user,_this=$(e.target),id=sharedProperties.getParam("userId",_this.attr("href")),i=0;i<=vm.allMember.length;i++)if(vm.allMember[i].id===id){user=vm.allMember[i];break}_this.bind("click",function(e){user.id===vm.userInfo.member.id&&e.preventDefault()}),$templateRequest("/sp/resources/html/common/tooltip.html").then(function(html){var newScope=$scope.$new(!1);newScope.user=user,newScope.self=user.id!==vm.userInfo.member.id,!newScope.self&&_this.addClass("default_true");var template=angular.element(html),elem=$compile(template)(newScope);Tipped.create(_this,elem[0],{showDelay:1e3,maxWidth:"220",detach:!0,size:"large",stem:{height:60,width:220}})})}});$scope.$on("updateUserInfoSSE",function(e){vm.userInfo=basicService.getUserInfo()})}function emitLazy(){$timeout(function(){$rootScope.$emit("lazyImg:refresh")},100)}function changeNewsFeed(filter){vm.pageSetting.filter=filter,vm.pageSetting.startIdx=0,vm.getNewsFeed()}function setLocalStorage(){$localStorage.set(arguments[0],arguments[1]),window.location.href=arguments[2]}function prism_portrait(page,active){var dialog=ngDialog.open({template:vm.pageTempaltes[page],className:"ngdialog-lnd-theme ngDialog-z-index",scope:$scope});vm.dialog=!0;var destroyRoot=$scope.$on("personalityGraph",function(e){destroyRoot(),vm.typeSelect(active,"#personalityChartDashboard1")});dialog.closePromise.then(function(data){vm.dialog=!1})}function overlay(page,news){vm.currentNews=news,vm.pageType="PublicChannel"===news.type?"public":"default",vm.winHeight=$(window).height()+"px",vm.pageSetting.commentPageSize=vm.originalPageSetting.commentPageSize,vm.dialog=!0,vm.getMoreComment();var dialog=ngDialog.open({template:vm.pageTempaltes[page],className:"ngdialog-lnd-theme ngDialog-z-index dashboard-comment-scroll",scope:$scope});vm.page=page,vm.emitLazy(),dialog.closePromise.then(function(data){vm.currentNews.number=1,vm.currentNews.edit=!1,vm.cloneFeed=null,vm.dialogEnable=!1,vm.dialog=!1})}function clearOverlayVar(){ngDialog.close()}function specficTheme(page){switch(vm.currentNews.number=3,page){case"comment":break;case"edit":cloneNews(vm.currentNews)}}function getMoreComment(){if(!angular.isArray(vm.currentNews.comments))return!0;vm.currentNews.commentCount>vm.currentNews.comments.length&&("PublicChannel"===vm.currentNews.type?vm.previousCommentPublic({pcRefId:vm.currentNews.pcRefId,all:!0},vm.currentNews):vm.previousComment({messageId:vm.currentNews.id,commentsOnly:!0},vm.currentNews))}function infinteScrollComment(pageSize){return!angular.isArray(vm.currentNews.comments)||(!vm.currentNews.comments.length||(vm.pageSetting.commentPageSize=pageSize,void(pageSize>=vm.currentNews.comments.length&&(vm.pageSetting.commentPageSize=vm.currentNews.comments.length))))}function prismLens(){sharedProperties.setObject(vm.profilePageDetail.member),ngDialog.open({template:vm.mortalUrl.prismLens,scope:$scope}).closePromise.then(function(data){vm.prismLensDetail()}),$rootScope.$on("ngDialog.opened",function(e){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),$('input[name="endDate"]').daterangepicker({showDropdowns:!1,minDate:moment(),locale:{format:"MM/DD/YYYY"},alwaysShowCalendars:!0,singleDatePicker:!0,autoUpdateInput:!1,opens:"right"},function(start,end,label){$scope.$apply(function(){$scope.untilDate=start.format("MM/DD/YYYY")})})})}var vm=this;new Date;vm.serviceApis={getNewsFeed:"/sp/dashboard/getNewsFeed",getUserProfileFeed:"/sp/dashboard/getUserProfileFeed",userNewsFeed:"/sp/dashboard/getUserNewsFeed",announcementNewsFeed:"/sp/dashboard/getAnnouncements",message:"/sp/dashboard/message/details",publicChannel:"/sp/pubchannel/getComments/details",prismLensDetail:"/sp/feedback/getFeedbackStatus",recentActivities:"/sp/logs/getUserActivityLogs",sendReminder:"/sp/notifications/sendNotificationWithParams"},vm.mortalUrl={deletePost:"/sp/resources/html/dashboard/post-delete.html",blockCommenting:"/sp/resources/html/dashboard/post-block.html",deleteComment:"/sp/resources/html/dashboard/delete-comment.html",likedUsersList:"/sp/resources/html/dashboard/liked-user.html",publicMessage:"/sp/resources/html/dashboard/what-is-public.html",prismLens:"/sp/resources/html/dashboard/prism-lens.html"};var width=$(window).width();vm.mobile=width<768,vm.specificSide=width<1250,vm.newsFeed=[],vm.profilePageDetail=null,vm.allMember=[],vm.cloneFeed=null,vm.lastNewsFeed=null,vm.prismLensView=null,vm.recentActivities=[],vm.newsFeedArray=[],vm.fetchingData=!0,vm.responseRecieved=!1,vm.request=!1,vm.pageSetting={startIdx:0,filter:"",pageSize:"25",commentIncrement:10,commentPageSize:10,commentIncrementLimit:7,defaultMessageCount:50,totalComment:10},vm.originalPageSetting=angular.copy(vm.pageSetting),vm.update={update:!1,count:0},vm.selectedTab="share",vm.previous=!1,vm.viewType=null!==sharedProperties.getParam("msgId")?sharedProperties.getParam("msgId"):sharedProperties.getParam("id"),
vm.viewName=null!==sharedProperties.getParam("msgId")?"user":null!==sharedProperties.getParam("id")?"community":"home",vm.profilePage=sharedProperties.getParam("userId"),vm.hideShow={},vm.pageReady=!1,vm.getNewsFeed=getNewsFeed,vm.getUserProfileFeed=getUserProfileFeed,vm.addComment=addComment,vm.addChildComment=addChildComment,vm.likePost=likePost,vm.previousComment=previousComment,vm.previousCommentPublic=previousCommentPublic,vm.deletePost=deletePost,vm.deleteComment=deleteComment,vm.blockComment=blockComment,vm.saveFeed=saveFeed,vm.follow=follow,vm.followPublic=followPublic,vm.getMessageDetail=getMessageDetail,vm.prismLensDetail=prismLensDetail,vm.recentActivities=recentActivities,vm.sendReminderFeedback=sendReminderFeedback,vm.init=init,vm.blockPostModal=blockPostModal,vm.deletePostModal=deletePostModal,vm.deleteCommentModal=deleteCommentModal,vm.cloneFeedFn=cloneFeedFn,vm.loadEmail=loadEmail,vm.tagAddedEdit=tagAddedEdit,vm.tagRemovedEdit=tagRemovedEdit,vm.displayRole=displayRole,vm.viewMemberDetails=viewMemberDetails,vm.videoPopUp=videoPopUp,vm.removeReference=removeReference,vm.createCommentObject=createCommentObject,vm.getAppropiateTemplate=getAppropiateTemplate,vm.likedUserName=likedUserName,vm.infinteScroll=infinteScroll,vm.infinteScrollComment=infinteScrollComment,vm.deleteIndex=deleteIndex,vm.sseFeedUpdate=sseFeedUpdate,vm.imageUrl=imageUrl,vm.changeFilterOption=changeFilterOption,vm.updateTabView=updateTabView,vm.openMobileFeedbackPanel=openMobileFeedbackPanel,vm.whatispublic=whatispublic,vm.shareInGD=shareInGD,vm.whiteSpace=whiteSpace,vm.bindEvents=bindEvents,vm.emitLazy=emitLazy,vm.changeNewsFeed=changeNewsFeed,vm.childComment=childComment,vm.setLocalStorage=setLocalStorage,vm.prismLens=prismLens,vm.overlay=overlay,vm.prism_portrait=prism_portrait,vm.specficTheme=specficTheme,vm.clearOverlayVar=clearOverlayVar,vm.getMoreComment=getMoreComment,vm.pageTempaltes={comment:"/sp/resources/html/dashboard/addcommentResponsive.html",edit:"/sp/resources/html/dashboard/addcommentResponsive.html",publicMessage:"/sp/resources/html/dashboard/what-is-public-responsive.html",profile:"/sp/resources/html/dashboard/profile-responsive.html"},vm.dialog=!1,vm.pollVotingDetails=[],vm.pollResults=[],vm.pollHideResult=[],vm.pollVotingError=[],vm.pollEnded=[],vm.viewPollResult=[],vm.hexSelectedIndex=[],vm.hexHoverIndex=[],vm.hexChar=$sce.trustAsHtml(sharedProperties.processRatingHex(1,"minipolls")),vm.hexAvg=$sce.trustAsHtml(sharedProperties.processRatingHex(5,"minipolls")),vm.processVote=processVote,vm.getPollTotal=getPollTotal,vm.pollActions=pollActions,vm.assignPollCheck=assignPollCheck,vm.endPollCheck=endPollCheck,vm.miniPollHexOps=miniPollHexOps,vm.label="",vm.prismLabelContent=!1,vm.activeProfileSummary=0,vm.activeProfileContent=0,vm.typeSelect=typeSelect,vm.togglePrimaryGraph=togglePrimaryGraph,$scope.$on("dashboardMessage",receiveSSEData),$scope.$on("publicChannel",receiveSSEData),$scope.imagePop=function(url,title){$rootScope.showImageModal=!0,$rootScope.modalImageUrl=url}}angular.module("spApp").controller("dashBoardFeed",dashBoardFeed),dashBoardFeed.$inject=["$scope","ajaxService","$localStorage","sharedProperties","newsFeedService","ngDialog","basicService","$q","notesService","$rootScope","$timeout","$templateRequest","$compile","$sce","miniPollsService"]}();