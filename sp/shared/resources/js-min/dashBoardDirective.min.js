function goalProgress($compile,$templateRequest){var controller=function($scope,$rootScope,$attrs,sharedProperties,ajaxService,$q,$localStorage,$parse){function getGoalsInProgress(){var deferred=$q.defer();return promise||(ajaxService.getAjaxResponse({url:self.serviceApis.goalsProgress}).then(function(response){if("true"===response.Success){var data=response.goalsInProgress;self.dataCount=response.goalsInProgress.length;for(var goalsJson={},goalsArray=[],goalsObj={},i=0;i<data.length;i++)void 0===goalsJson[data[i].badgeType]?(goalsArray=[],goalsObj={},goalsObj.badge=data[i].level,goalsObj.percentComplete=Math.round(parseInt(data[i].completedCount)/parseInt(data[i].totalCount)*100)+"%",goalsObj.totalTasks=data[i].totalCount,goalsObj.completedTasks=data[i].completedCount,goalsObj.title=data[i].contentReference.title,goalsObj.goalName=data[i].badgeType,goalsObj.refId=data[i].refId,goalsArray.push(goalsObj),goalsJson[data[i].badgeType]=goalsArray):(goalsArray=goalsJson[data[i].badgeType],goalsObj={},goalsObj.badge=data[i].level,goalsObj.percentComplete=Math.round(parseInt(data[i].completedCount)/parseInt(data[i].totalCount)*100)+"%",goalsObj.totalTasks=data[i].totalCount,goalsObj.completedTasks=data[i].completedCount,goalsObj.title=data[i].contentReference.title,goalsObj.goalName=data[i].badgeType,goalsObj.refId=data[i].refId,goalsArray.push(goalsObj),goalsJson[data[i].badgeType]=[],goalsJson[data[i].badgeType]=goalsArray);self.goals=goalsJson,self.goalKeys=Object.keys(self.goals),void 0!==self.goalKeys&&1===self.goalKeys.length&&"Tutorial"===self.goalKeys[0]&&"/sp/dashboard"===window.location.pathname&&(self.goalKeys=[]),self.goalKeys.length&&(expressions.full?(self.goalProgress=self.goals,self.expanded=!0):(self.goalProgress[Object.keys(self.goals)[expressions.show]]=self.goals[Object.keys(self.goals)[expressions.show]],self.expanded=!1)),null!==$localStorage.get("loggegdInProfile")&&(self.badges=$localStorage.get("loggegdInProfile").member.userBadges),self.badges.length&&!self.goalKeys.length&&(self.state="completed")}else null!==response.error&&sharedProperties.ajaxError(response.error)}),promise=deferred.promise)}function toggle(){!0===expressions.toggle&&("progress"===self.state?(self.goalProgress={},expressions.turn?(self.goalProgress[Object.keys(self.goals)[expressions.show]]=self.goals[Object.keys(self.goals)[expressions.show]],expressions.turn=!1,self.expanded=!1):(self.goalProgress=self.goals,expressions.turn=!0,self.expanded=!0)):expressions.turn?(expressions.turn=!1,self.expanded=!1):(expressions.turn=!0,self.expanded=!0)),self.expanded?$rootScope.$broadcast("refreshStickyDetach"):$rootScope.$broadcast("refreshStickyEnable")}function calculateHeight(){!expressions.toggle&&$rootScope.$broadcast("refreshStickyEnable")}function switchState(state){"completed"===state&&(null!==$localStorage.get("loggegdInProfile")&&(self.badges=$localStorage.get("loggegdInProfile").member.userBadges),self.badges.length||(state="progress")),"progress"===state&&(self.goalKeys.length||(state="completed")),self.state=state,sharedProperties.fireAnalyticsEvent("progress"===state?"Dashboard | Goals in Progress":"Dashboard | Goals Accomplished","N/A")}function changeHoverColor(state,moduleName,index){"on"===state?($("#badge-icon_"+moduleName+"_"+index).removeClass("badge-grey"),$("#badge-icon_"+moduleName+"_"+index).addClass("sp-icon-color")):($("#badge-icon_"+moduleName+"_"+index).removeClass("sp-icon-color"),$("#badge-icon_"+moduleName+"_"+index).addClass("badge-grey"))}function redirectToModule(obj){switch(obj.goalName){case"Tutorial":$rootScope.handleStickyTabs("tutorial");break;case"Erti":window.location.href="/sp/trainingLibrary/results#/topicCategory=Themes&topicValue="+obj.refId+":"+obj.title;break;case"OrgPlan":window.location.href="/sp/goalsOrg?parentId="+obj.refId}}var promise,self=this,options={full:!1,show:0,toggle:!0,turn:!1},expressions={},goalOption=$parse($attrs.goalOption)($scope);angular.extend(expressions,options,goalOption),self.goalProgress={},self.goals={},self.getGoalsInProgress=getGoalsInProgress,self.expanded=!1,self.state="progress",self.badges=[],self.dataCount=0,$scope.pullInterNationalization=$rootScope.pullInterNationalization,self.serviceApis={goalsProgress:"/sp/dashboard/goalsInProgress"},self.toggle=toggle,self.switchState=switchState,self.calculateHeight=calculateHeight,self.toogleEnable=expressions.toggle,self.changeHoverColor=changeHoverColor,self.redirectToModule=redirectToModule;$scope.$on("taskCompleted",function(){void 0!==self.goals&&void 0!==self.goals.Tutorial&&self.goals.Tutorial.length&&(self.goals.Tutorial[0].completedTasks=self.goals.Tutorial[0].completedTasks+1,self.goals.Tutorial[0].percentComplete=Math.round(parseInt(self.goals.Tutorial[0].completedTasks)/parseInt(self.goals.Tutorial[0].totalTasks)*100)+"%",self.goalProgress=self.goals)}),$scope.$on("actionPlanSSE",function(e,data){if(null===data)return!0;$scope.$apply(function(){if(void 0!==data.todo&&"OrgPlan"===data.todo.type&&"UPDATE"===data.op){if(void 0!==self.goals&&void 0!==self.goals.OrgPlan&&self.goals.OrgPlan.length)for(var zz=0;zz<self.goals.OrgPlan.length;zz++)self.goals.OrgPlan[zz].refId===data.todo.parentRefId&&(self.goals.OrgPlan[zz].completedTasks=self.goals.OrgPlan[zz].completedTasks+1,self.goals.OrgPlan[zz].percentComplete=Math.round(parseInt(self.goals.OrgPlan[zz].completedTasks)/parseInt(self.goals.OrgPlan[zz].totalTasks)*100)+"%",self.goalProgress=self.goals)}else void 0===data.todo&&"OrgPlan"===data.type&&"DELETE"===data.op&&void 0!==self.goals&&void 0!==self.goals.OrgPlan&&self.goals.OrgPlan.length&&(sharedProperties.spilceIndexWithBreak(self.goals.OrgPlan,"refId",data.parentRefId),self.goalProgress=self.goals)})});!function(){getGoalsInProgress()}()};return controller.$inject=["$scope","$rootScope","$attrs","sharedProperties","ajaxService","$q","$localStorage","$parse"],{restrict:"EA",link:function($scope,$element,$attrs){$templateRequest($attrs.urlSrc||"/sp/resources/html/dashboard/goal-progress.html").then(function(html){var template=angular.element(html);$element.append(template),$compile(template)($scope)})},scope:{},controller:controller,controllerAs:"ctrl",bindToController:!0,replace:!0}}function badgeInfo($templateRequest,$compile,$rootScope){return{restrict:"A",link:function($scope,$element,$attrs){function displayBadgeInfo(){$templateRequest("/sp/resources/html/"+$attrs.urlSrc).then(function(html){var template=angular.element(html),elem=$compile(template)($scope),styles=$attrs.styles,moduleName=$attrs.moduleName;new Drop({target:$element[0],content:elem[0],position:"bottom left",openOn:"click",remove:!0,classes:void 0!==styles?styles:"notes-options",$scope:$scope});switch($scope.badgeInfo="",moduleName){case"Erti":$scope.badgeInfo=$rootScope.pullInterNationalization("badges.description.erti");break;case"OrgPlan":$scope.badgeInfo=$rootScope.pullInterNationalization("badges.description.lp");break;case"Tutorial":$scope.badgeInfo=$rootScope.pullInterNationalization("badges.description.tutorial")}})}void 0!==$attrs.moduleName?$attrs.$observe("moduleName",function(newValue,oldValue){displayBadgeInfo()},!0):displayBadgeInfo()}}}goalProgress.$inject=["$compile","$templateRequest"],angular.module("spApp").directive("goalProgress",goalProgress),angular.module("spApp").filter("replaceGoalName",["$rootScope",function($rootScope){return function(input){return null===input||void 0===input?"":("OrgPlan"===input&&(input=$rootScope.pullInterNationalization("manageAccountContent.organization")),"Erti"===input&&(input=$rootScope.pullInterNationalization("manageAccountContent.erti")),"SPTutorial"===input&&(input=$rootScope.pullInterNationalization("badge.dashboard.tutorial")),input)}}]),angular.module("spApp").directive("badgeInfo",badgeInfo),badgeInfo.$inject=["$templateRequest","$compile","$rootScope"];
function knowledgeCenter($compile,$templateRequest){var controller=function($scope,$rootScope,sharedProperties,ajaxService,$q,basicService,$localStorage){function getKnowledgeCenter(){var deferred=$q.defer();if(null===$localStorage.get("dashboardArticle")){if(promise)return promise;ajaxService.getAjaxResponse({url:vm.serviceApis.knowledgeCenter}).then(function(response){"true"===response.Success?(vm.dashboardArticle=response,$localStorage.set("dashboardArticle",vm.dashboardArticle),$rootScope.$broadcast("refreshSticky")):null!==response.error&&(vm.dashboardArticle=null)})}else vm.dashboardArticle=$localStorage.get("dashboardArticle");return promise=deferred.promise}function goToArticlePage(id){sharedProperties.fireAnalyticsEvent("Dashboard | Goto Article Page","/sp/trainingLibrary/article?"+id),window.location.href="/sp/trainingLibrary/article?"+id}function videoPopUp(url,mode,newtab){if("VIDEO"===mode)if(newtab){var wind=window.open(url,"_blank");wind.focus()}else sharedProperties.videoPopUp(url);else{var modes=newtab?"_blank":"_self";window.open(url,modes).focus()}}var promise,vm=this;$scope.pullInterNationalization=$rootScope.pullInterNationalization,vm.serviceApis={knowledgeCenter:"/sp/dashboard/learning/getArticle"},vm.videoPopUp=videoPopUp,vm.goToArticlePage=goToArticlePage,vm.dashboardArticle={},function(){getKnowledgeCenter();var openTab=sharedProperties.getParam("open"),gdParam=$localStorage.get("gdParam");openTab&&"gd"===openTab&&""!==gdParam&&null!==gdParam&&$rootScope.handleStickyTabs("gd")}()};return controller.$inject=["$scope","$rootScope","sharedProperties","ajaxService","$q","basicService","$localStorage"],{restrict:"EA",link:function($scope,$element,$attrs){$templateRequest($attrs.urlSrc||"/sp/resources/html/dashboard/knowledge-center.html").then(function(html){var template=angular.element(html);$element.append(template),$compile(template)($scope)})},scope:{},controller:controller,controllerAs:"ctrl",bindToController:!0,replace:!0}}knowledgeCenter.$inject=["$compile","$templateRequest"],angular.module("spApp").directive("knowledgeCenter",knowledgeCenter);
function learningProgram($compile,$templateRequest){var controller=function($scope,$rootScope,sharedProperties,ajaxService,$timeout){function getLearningProgram(){sharedProperties.checkPermission().org&&ajaxService.getAjaxResponse({url:self.serviceApis.getLearningProgram,method:"get"}).then(function(response){if("true"===response.Success){if(self.learningProgram=response.actionPlan,void 0!==self.learningProgram&&self.learningProgram.completedCount!==self.learningProgram.actionCount){self.completedTaskCount=self.learningProgram.completedCount;for(var i=0;i<self.learningProgram.practiceAreaList.length;i++)if(self.learningProgram.practiceAreaList[i].enabled)for(var j=0;j<self.learningProgram.practiceAreaList[i].devStrategyActionCategoryList.length;j++)for(var k=0;k<self.learningProgram.practiceAreaList[i].devStrategyActionCategoryList[j].actionList.length;k++)if(1!==self.learningProgram.practiceAreaList[i].devStrategyActionCategoryList[j].actionList[k].completedActions)if("Single"===self.learningProgram.practiceAreaList[i].devStrategyActionCategoryList[j].actionList[k].type&&!0===self.learningProgram.practiceAreaList[i].devStrategyActionCategoryList[j].actionList[k].permissions.Completion)self.lpTask.stepId=self.learningProgram.practiceAreaList[i].id,self.lpTask.taskData=self.learningProgram.practiceAreaList[i].devStrategyActionCategoryList[j].actionList[k],self.taskList.push(self.lpTask),self.lpTask={};else if("Group"===self.learningProgram.practiceAreaList[i].devStrategyActionCategoryList[j].actionList[k].type){!0===self.learningProgram.practiceAreaList[i].devStrategyActionCategoryList[j].actionList[k].permissions.Completion&&(self.lpTask.stepId=self.learningProgram.practiceAreaList[i].id,self.lpTask.taskData=self.learningProgram.practiceAreaList[i].devStrategyActionCategoryList[j].actionList[k],self.taskList.push(self.lpTask),self.lpTask={});for(var abc=0;abc<self.learningProgram.practiceAreaList[i].devStrategyActionCategoryList[j].actionList[k].actionData.length;abc++)0===self.learningProgram.practiceAreaList[i].devStrategyActionCategoryList[j].actionList[k].actionData[abc].completedActions&&!0===self.learningProgram.practiceAreaList[i].devStrategyActionCategoryList[j].actionList[k].actionData[abc].permissions.Completion&&(self.lpTask.stepId=self.learningProgram.practiceAreaList[i].id,self.lpTask.taskData=self.learningProgram.practiceAreaList[i].devStrategyActionCategoryList[j].actionList[k].actionData[abc],self.taskList.push(self.lpTask),self.lpTask={})}self.currentTask=0}$rootScope.$broadcast("refreshSticky")}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function displayConfirmBox(){self.showConfirmBox?self.showConfirmBox=!1:self.showConfirmBox=!0}function markCompletion(uid,stepId){ajaxService.getAjaxResponse({url:self.serviceApis.markCompletion+"?actionPlanId="+self.learningProgram.id+"&stepId="+stepId+"&uid="+uid+"&completed=true",method:"get"}).then(function(response){"true"===response.Success?sharedProperties.fireAnalyticsEvent("Dashboard | Complete LP Task","N/A"):null!==response.error&&sharedProperties.ajaxError(response.error)})}function messages(message){return $rootScope.pullInterNationalization(message)}function previewMedia(mode,url,title,uid){if(sharedProperties.fireAnalyticsEvent("Dashboard | LP Widget Click Attachment","N/A"),"Video"===mode)sharedProperties.videoPopUp(url);else if("Schedule"===mode)sharedProperties.schedulePopUp(title,uid,self.learningProgram.id,self.learningProgram.name);else if("WebInternal"===mode)window.location.href=url;else if("ActionPlan"===mode)$rootScope.handleStickyTabs("action");else{var win=window.open(url,"_blank");win.focus()}}function showMore(id){self.btnCont[id]=!self.btnCont[id],$rootScope.$broadcast("refreshSticky")}var self=this;self.learningProgram={},self.lpTask={},self.showConfirmBox=!1,self.taskList=[],self.currentTask=0,self.completedTask=-1,self.currentIndex=0,self.completedTaskCount=0,self.messages=messages,self.getLearningProgram=getLearningProgram,self.displayConfirmBox=displayConfirmBox,self.markCompletion=markCompletion,self.previewMedia=previewMedia,self.showMore=showMore,self.serviceApis={getLearningProgram:"/sp/actionPlan/getActionPlan",markCompletion:"/sp/actionPlan/completeAction"};var handleTaskCompletion=($scope.$on("actionPlanSSE",function(e,data){if(null===data)return!0;$scope.$apply(function(){(void 0!==data.todo?data.todo.parentRefId:data.parentRefId)===self.learningProgram.id&&(void 0===data.todo&&"DELETE"===data.op?(self.taskList=[],$(".learning-program-widget").fadeOut(1e3)):handleTaskCompletion())})}),function(){self.completedTaskCount=self.completedTaskCount+1,self.completedTask=self.currentIndex,$timeout(function(){$("#task_"+self.currentIndex).hide(),self.currentIndex=self.currentIndex+1,self.currentTask=self.currentIndex,void 0===self.taskList[self.currentIndex]&&self.completedTaskCount!==self.learningProgram.actionCount&&window.location.reload()},500),self.completedTaskCount===self.learningProgram.actionCount&&($timeout(function(){$(".task-complete").addClass("content-fadeIn")},500),$timeout(function(){$(".learning-program-widget").fadeOut(1e3)},3e3))})};return controller.$inject=["$scope","$rootScope","sharedProperties","ajaxService","$timeout"],{restrict:"EA",link:function($scope,$element,$attrs){$templateRequest("/sp/resources/html/"+$attrs.urlSrc).then(function(html){var template=angular.element(html);$element.append(template),$compile(template)($scope)})},controller:controller,controllerAs:"lpCtrl",bindToController:!0}}angular.module("spApp").directive("learningProgram",learningProgram),learningProgram.$inject=["$compile","$templateRequest"];
function newsFeed($compile,$templateRequest,sharedProperties,basicService,$q,newsFeedService,ngDialog){var controller=function($scope,$attrs,ajaxService,$localStorage,notesService,$rootScope,$timeout,$templateRequest,$compile,miniPollsService,$sce){function getNewsFeed(){ajaxService.getAjaxResponse({url:vm.changeFilterOption(),data:$.param({startIdx:vm.pageSetting.startIdx}),loader:{obj:$(".sp-loading-bar")}}).then(function(response){"true"===response.Success?"activity"===vm.pageSetting.filter?(vm.pageSetting.startIdx=0,newsFeedService.news.newsFeedArray=[],newsFeedService.news.newsFeed=response.activityMessages,vm.pagination=void 0!==response.pagination&&response.pagination,sticky_element()):newsFeedOperation(response):null!==response.error&&(vm.responseRecieved=!0,sharedProperties.ajaxError(response.error),sticky_element())})}function follow(news,bool){newsFeedService.follow({messageId:news.id,follow:bool}).then(function(data){if(null===data)return!0;news.hide=!bool,news.hide&&newsFeedService.news.newsFeed.length&&!vm.fetchingData&&vm.pagination?(vm.fetchingData=!0,vm.getNewsFeed(),sharedProperties.fireAnalyticsEvent("Newsfeed | Hide",news.type+" - "+!news.hide)):vm.emitLazy()})}function saveFeed(){var obj={comment:{comment:vm.cloneFeed.message.text,contentReference:vm.cloneFeed.message.contentReference},taggedMemberIds:vm.cloneFeed.taggedMembers,messageId:vm.cloneFeed.id,deletedTaggedMemberIds:vm.cloneFeed.deletedTaggedMemberIds};newsFeedService.updatePost(obj).then(function(data){if(null===data)return!0;for(var i=0;i<newsFeedService.news.newsFeed.length;i++)if(newsFeedService.news.newsFeed[i].id===vm.cloneFeed.id){newsFeedService.news.newsFeed[i].message=data.message.message,newsFeedService.news.newsFeed[i].taggedMembers=data.message.taggedMembers,newsFeedService.news.newsFeed[i].updatedOn=data.message.updatedOn,newsFeedService.news.newsFeed[i].edit=!1,vm.cloneFeed=null,vm.lastNewsFeed=null;break}vm.emitLazy()})}function previousComment(obj,news,SSE){return news.comments.length===news.commentCount?(vm.previous=!0,vm.childComment(news),vm.request=!1,!0):!0===vm.request||(vm.request=!0,void newsFeedService.previousComments(obj).then(function(data){if(null===data)return!0;if(void 0!==SSE&&SSE)$scope.$apply(function(){vm.previous=!0;for(var i=0;i<news.length;i++)data.message.comments[i].number=news.comments[i].number;news.comments=data.message.comments,vm.childComment(news),vm.request=!1});else{vm.previous=!0;for(var i=0;i<news.length;i++)data.message.comments[i].number=news.comments[i].number;news.comments=data.message.comments,vm.childComment(news),vm.request=!1}}))}function deletePost(id){newsFeedService.deletePost({messageId:id}).then(function(data){if(ngDialog.close(),null===data)return!0;var index=newsFeedService.news.newsFeedArray.indexOf(id);-1!==index&&(newsFeedService.news.newsFeedArray.splice(index,1),newsFeedService.news.newsFeed.splice(index,1)),newsFeedService.news.newsFeed.length&&!vm.fetchingData&&vm.pagination&&(vm.fetchingData=!0,vm.getNewsFeed()),"individual"===vm.viewName&&(vm.currentNews=null),sharedProperties.growlMessage($rootScope.pullInterNationalization("dashboard.postdeleted"))})}function blockComment(news){newsFeedService.blockComment({messageId:news.id,blockCommenting:!news.blockCommenting}).then(function(data){if(ngDialog.close(),null===data)return!0;news.blockCommenting=!news.blockCommenting})}function likedUserName(obj,event){newsFeedService.likeUserName({messageId:obj.news.id,cid:obj.comment.cid,childCid:obj.childComment.cid}).then(function(data){if(null===data)return!0;ngDialog.open({template:vm.mortalUrl.likedUsersList,scope:$scope}),vm.likedUsersList=data.likeUsers})}function likePost(obj){newsFeedService.likePost({messageId:obj.news.id,cid:obj.comment.cid,childCid:obj.childComment.cid}).then(function(data){if(null===data)return!0;stackSwitch(data,!1)})}function getUserProfileFeed(){ajaxService.getAjaxResponse({url:changeFilterOptionProfile(),data:$.param({startIdx:vm.pageSetting.startIdx,userId:vm.profilePage||vm.userInfo.member.id}),loader:{obj:$(".sp-loading-bar")}}).then(function(response){"true"===response.Success?"activity"===vm.pageSetting.filter?(vm.pageSetting.startIdx=0,newsFeedService.news.newsFeedArray=[],newsFeedService.news.newsFeed=response.activityMessages,sticky_element()):(void 0!==response.member&&(vm.profilePageDetail=response),void 0===response.newsFeed&&(response.newsFeed=[]),newsFeedOperation(response)):null!==response.error&&(vm.responseRecieved=!0,sharedProperties.ajaxError(response.error),sticky_element())})}function addComment(news,taggedObject,event){if(!news.tempcomment.comment.comment.length&&null===news.tempcomment.comment.contentReference.title||news.edit)return!1;var obj=null;obj=newsFeedService.postMessageObject(),obj.comment.comment=news.tempcomment.comment.comment,obj.comment.contentReference=news.tempcomment.comment.contentReference,obj.cid=news.cid||-1,obj.taggedMemberIds=taggedObject.map(function(e){return e.id}),news.tempcomment=vm.createCommentObject(news.tempcomment.comment.cid),obj.messageId=news.id,newsFeedService.addComment(obj).then(function(data){if(null===data)return!0;!angular.isArray(news.comments)&&(news.comments=[]),vm.previous=!1,news.comments.unshift(data.message.comment),news.commentCount++,news.number++,vm.pageSetting.commentPageSize++,sharedProperties.fireAnalyticsEvent("Newsfeed | Add Comment",data.actionType)})}function addChildComment(news,collection,taggedObject,uniqueId){if(!news.tempcomment.comment.comment.length&&null===news.tempcomment.comment.contentReference.title||news.edit)return!1;var obj=null;obj=newsFeedService.postMessageObject(),obj.comment.comment=news.tempcomment.comment.comment,obj.comment.contentReference=news.tempcomment.comment.contentReference,obj.cid=news.cid,obj.taggedMemberIds=taggedObject.map(function(e){return e.id}),news.tempcomment=vm.createCommentObject(news.tempcomment.comment.cid),obj.messageId=collection.id,newsFeedService.addComment(obj).then(function(data){if(null===data)return!0;!angular.isArray(news.childComments)&&(news.childComments=[]),vm.previous=!1,news.childComments.unshift(data.message.comment),void 0!==news.commentCount?news.commentCount++:news.commentCount=1,news.number++,vm.hideShow[uniqueId]=!1,sharedProperties.fireAnalyticsEvent("Newsfeed | Add Comment",data.actionType)})}function deleteComment(obj){newsFeedService.deleteComment({messageId:obj.news.id,cid:obj.comment.cid,childCid:obj.childComment.cid}).then(function(data){if(ngDialog.close(),null===data)return!0;stackDelete(data),sharedProperties.growlMessage($rootScope.pullInterNationalization("dashboard.commentdeleted"))})}function newsPrivate(){ajaxService.getAjaxResponse({url:vm.serviceApis.message,data:$.param({messageId:vm.viewType,msgDetailsPage:!0}),loader:{obj:$(".sp-loading-bar")}}).then(function(response){if("true"===response.Success){var res={newsFeed:[]};res.newsFeed.push(response.message),newsFeedOperation(res,"store")}else null!==response.error&&(vm.responseRecieved=!0,vm.currentNews=null,sharedProperties.ajaxError(response.error),sticky_element())})}function updatePollActions(type,id){miniPollsService.updatePoll("shareNote",type,{messageId:id}).then(function(response){if(null===response)return!0;var newsId=newsFeedService.news.newsFeedArray.indexOf(id);-1!==newsId&&("share"===type?(newsFeedService.news.newsFeed[newsId].message.miniPoll.hideResults=!1,vm.pollHideResult[id]=!1,vm.viewPollResult[id]=!1,vm.assignPollCheck(newsFeedService.news.newsFeed[newsId].userNewsFeedSelection,id,!0)):"end"===type&&(vm.pollEnded[id]=!0,newsFeedService.news.newsFeed[newsId].message.miniPoll.result=response.miniPollResult,newsFeedService.news.newsFeed[newsId].message.miniPoll.endDate=setPollEndDate()))})}function answerPoll(id,param){miniPollsService.updatePoll("shareNote","answer",param).then(function(response){if(null===response)return!0;var newsId=newsFeedService.news.newsFeedArray.indexOf(id);-1!==newsId&&(newsFeedService.news.newsFeed[newsId].hasCompleted=!0,newsFeedService.news.newsFeed[newsId].message.miniPoll.result=response.miniPollResult,newsFeedService.news.newsFeed[newsId].userNewsFeedSelection=param.selection.toString().split(",").map(Number),newsFeedService.news.newsFeed[newsId].message.miniPoll.hideResults?vm.assignPollCheck(newsFeedService.news.newsFeed[newsId].userNewsFeedSelection,id,!1):vm.assignPollCheck(newsFeedService.news.newsFeed[newsId].userNewsFeedSelection,id,!0))})}function newsFeedOperation(response,currentNews){if(vm.pageSetting.startIdx)for(var j=0,index=-1;j<response.newsFeed.length;j++)index=newsFeedService.news.newsFeedArray.indexOf(response.newsFeed[j].id),-1===index?(response.newsFeed[j].number=vm.mobile?1:null===response.newsFeed[j].comments?3:response.newsFeed[j].comments.length,newsFeedService.news.newsFeedArray.push(response.newsFeed[j].id),newsFeedService.news.newsFeed.push(response.newsFeed[j])):(newsFeedService.news.newsFeedArray.move(index,newsFeedService.news.newsFeedArray.length-1),newsFeedService.news.newsFeed.move(index,newsFeedService.news.newsFeed.length-1));else{newsFeedService.news.newsFeedArray=[],vm.update={update:!1,count:0};for(var i=0;i<response.newsFeed.length;i++)response.newsFeed[i].number=vm.mobile?1:null===response.newsFeed[i].comments?3:response.newsFeed[i].comments.length,newsFeedService.news.newsFeedArray.push(response.newsFeed[i].id);newsFeedService.news.newsFeed=response.newsFeed}vm.pagination=void 0!==response.pagination&&response.pagination,vm.pageSetting.startIdx=newsFeedService.news.newsFeed.length,void 0!==currentNews?(newsFeedService.news.newsFeed.length&&(vm.currentNews=newsFeedService.news.newsFeed[0]),vm.noScroll=!1,vm.mobile&&(messageDialog=!0,vm.overlay("comment",vm.currentNews))):(vm.getAll=!0,vm.noPost=!0),newsFeedService.news.newsFeed.length&&(vm.noPost=!1),vm.fetchingData=!1,vm.responseRecieved=!0,newsFeedService.news.newsFeed.length||"home"!==vm.viewingPage||switching||vm.changeNewsFeed(vm.filterOptions[1]),sticky_element()}function bindEvents(){$("body").on("click",".sp-video-inline",function(event){event.preventDefault(),sharedProperties.videoPopUp($(this).attr("href"))}),$(document).on("DOMNodeInserted",function(e){if($(e.target).is(".sp-user-tool-tip")){for(var user,_this=$(e.target),id=sharedProperties.getParam("userId",_this.attr("href")),i=0;i<=vm.allMember.length;i++)if(vm.allMember[i].id===id){user=vm.allMember[i];break}_this.bind("click",function(e){user.id===vm.userInfo.member.id&&e.preventDefault()}),$templateRequest("/sp/resources/html/common/tooltip.html").then(function(html){var newScope=$scope.$new(!1);newScope.user=user,newScope.self=user.id!==vm.userInfo.member.id;var template=angular.element(html),elem=$compile(template)(newScope);Tipped.create(_this,elem[0],{showDelay:1e3,maxWidth:"220",detach:!0,size:"large",stem:{height:60,width:220}})})}});var updatePermissionSSEData=$scope.$on("updateUserInfoSSE",function(e){updatePermissionSSEData(),vm.userInfo=basicService.getUserInfo()}),destroyStick=$scope.$on("personalityGraph",function(e){destroyStick(),vm.callSticky()})}function changeFilterOption(){return"activity"===vm.pageSetting.filter?(switching=1,vm.filterOptionsSelected=1,vm.serviceApis.dashboardActivities):"announcement"===vm.pageSetting.filter?(switching=1,vm.filterOptionsSelected=2,vm.serviceApis.announcementNewsFeed):(vm.filterOptionsSelected=0,vm.serviceApis.getNewsFeed)}function changeFilterOptionProfile(){return"activity"===vm.pageSetting.filter?(switching=1,vm.filterOptionsSelected=1,vm.serviceApis.userActivities):(vm.filterOptionsSelected=0,vm.serviceApis.getUserProfileFeed)}function getAppropiateTemplate(type){switch(type){case"Default":case"SurePeoplePost":case"UserActivity":case"Announcement":case"UserBadge":return"/sp/resources/html/dashboard/default.html";case"SPActivityFeed":return"/sp/resources/html/dashboard/SPactivity.html";case"MiniPolls":return"/sp/resources/html/mini-polls/result-newsFeed.html";default:return"/sp/resources/html/dashboard/userActivity.html"}}function changeNewsFeed(filter){vm.pageSetting.filter=filter.value,vm.pageSetting.filterName=filter.name,vm.pageSetting.startIdx=0,profileCall()}function infinteScroll(){if(newsFeedService.news.newsFeed.length&&!vm.fetchingData&&vm.pagination)switch(vm.fetchingData=!0,vm.viewingPage){case"home":vm.getNewsFeed();break;case"profile":vm.getUserProfileFeed();break;case"message":vm.getMessageDetail()}}function sseFeedUpdate(){vm.pageSetting.startIdx=0,vm.getNewsFeed()}function cloneFeedFn(news){vm.mobile?vm.overlay("edit",news):cloneNews(news)}function overlay(page,news){vm.currentNews=news,vm.pageType="MiniPolls"===news.type?"miniPoll":"default",vm.winHeight=$(window).height()+"px",vm.pageSetting.commentPageSize=vm.originalPageSetting.commentPageSize,vm.dialog=!0,vm.getMoreComment(),vm.hideFocus(news.id);var dialog=ngDialog.open({template:vm.pageTempaltes[page],className:"ngdialog-lnd-theme ngDialog-z-index dashboard-comment-scroll",scope:$scope});vm.page=page,vm.emitLazy(),dialog.closePromise.then(function(data){vm.currentNews.number=1,vm.currentNews.edit=!1,vm.cloneFeed=null,messageDialog&&(vm.showAll("default",vm.currentNews),newsFeedService.news.newsFeed[0].number=vm.mobile?1:null===newsFeedService.news.newsFeed[0].comments?3:newsFeedService.news.newsFeed[0].comments.length,messageDialog=!1),vm.currentNews=null,vm.dialogEnable=!1,vm.dialog=!1})}function individualPost(page,news){if("individual"!==vm.viewName){var oldOffset=$(".news-feed-holder").offset().top;newsOffset=$("#"+news.id).offset().top,vm.currentNews=news,vm.pageSetting.commentPageSize=vm.originalPageSetting.commentPageSize,vm.getMoreComment(),vm.viewName="individual",vm.page=page,$("html,body").animate({scrollTop:oldOffset-20},1e3),vm.noScroll=!0}else vm.previousComment({messageId:news.id,commentsOnly:!0},news)}function cloneNews(news){null===vm.lastNewsFeed?vm.lastNewsFeed=news:(vm.lastNewsFeed.edit=!1,vm.lastNewsFeed=news);for(var i=0;i<newsFeedService.news.newsFeed.length;i++)if(newsFeedService.news.newsFeed[i].id===news.id){vm.cloneFeed=angular.copy(newsFeedService.news.newsFeed[i]),angular.isArray(newsFeedService.news.newsFeed[i].taggedMembers)?vm.cloneFeed.taggedMembersFull=angular.copy(newsFeedService.news.newsFeed[i].taggedMembers):vm.cloneFeed.taggedMembersFull=[];break}basicService.getAllValidMember().then(function(response){vm.allMember=response,vm.cloneFeed.taggedMembers=[],vm.cloneFeed.deletedTaggedMemberIds=[];for(var i=0;i<vm.cloneFeed.taggedMembersFull.length;i++)vm.cloneFeed.taggedMembers.push(vm.cloneFeed.taggedMembersFull[i].id);vm.copyCloneFeed=angular.copy(vm.cloneFeed),news.edit=!0,vm.emitLazy()})}function getMoreComment(){if(!angular.isArray(vm.currentNews.comments))return!0;vm.currentNews.commentCount>vm.currentNews.comments.length&&vm.previousComment({messageId:vm.currentNews.id,commentsOnly:!0},vm.currentNews)}function whiteSpace(text){return/\s/.test(text)}function childComment(news){news.number=news.number+(null!==vm.viewType?vm.pageSetting.commentIncrement:vm.pageSetting.commentIncrementLimit)}function deletePostModal(id){vm.deleteID=id,ngDialog.open({template:vm.mortalUrl.deletePost,scope:$scope})}function blockPostModal(id){vm.newsID=id,ngDialog.open({template:vm.mortalUrl.blockCommenting,scope:$scope})}function stackSwitch(data,sse){var newsId=newsFeedService.news.newsFeedArray.indexOf(data.messageId),commentId=-1,childCommentsId=-1;-1!==newsId&&(-1!==data.childCid?(commentId=returnIndex(newsFeedService.news.newsFeed[newsId].comments,data.cid),childCommentsId=returnIndex(newsFeedService.news.newsFeed[newsId].comments[commentId].childComments,data.childCid),likeCount(newsFeedService.news.newsFeed[newsId].comments[commentId].childComments[childCommentsId],data,childCommentsId,sse)):-1!==data.cid?(commentId=returnIndex(newsFeedService.news.newsFeed[newsId].comments,data.cid),likeCount(newsFeedService.news.newsFeed[newsId].comments[commentId],data,commentId,sse)):likeCount(newsFeedService.news.newsFeed[newsId],data,newsId,sse))}function returnIndex(obj,data){for(var i=0;i<obj.length;i++)if(obj[i].cid===data)return i;return-1}function likeCount(obj,data,index,sse){-1!==index&&(sse?$scope.$apply(function(){obj.likeCount=data.likeCount}):(obj.likeCount=data.likeCount,obj.likedByUser=!obj.likedByUser))}function clearOverlayVar(){vm.hideShow={},ngDialog.close()}function specficTheme(page){switch(vm.currentNews.number=3,page){case"comment":break;case"edit":cloneNews(vm.currentNews)}}function tagAddedEdit(tag){vm.cloneFeed.taggedMembers.push(tag.id);var deletedIndex=vm.cloneFeed.deletedTaggedMemberIds.indexOf(tag.id);-1!==deletedIndex&&vm.cloneFeed.deletedTaggedMemberIds.splice(deletedIndex,1)}function tagRemovedEdit(tag){vm.cloneFeed.taggedMembers.splice(vm.cloneFeed.taggedMembers.indexOf(tag.id),1),vm.cloneFeed.deletedTaggedMemberIds.push(tag.id)}function loadEmail(query){for(var deferred=$q.defer(),result=[],i=0;i<vm.allMember.length&&result.length<5;i++)-1===vm.allMember[i].name.toLowerCase().indexOf(query.toLowerCase())&&-1===vm.allMember[i].email.toLowerCase().indexOf(query.toLowerCase())||result.push(vm.allMember[i]);return deferred.resolve(result),deferred.promise}function receiveSSEData(e,data){if(null===data)return!0;switch(data.op){case"ADD_COMMENT":addCommentSSE(data.message||data);break;case"DELETE_COMMENT":deleteCommentSSE(data.message||data);break;case"ADD":$scope.$apply(function(){vm.update.update=!0,vm.update.count++});break;case"DELETE":deletepostSSE(data.messageId||data.id);break;case"LIKE_COMMENT":likePostSSE(data);break;case"UPDATE":data.message.message.user.id!==vm.userInfo.member.id&&$scope.$apply(function(){vm.update.update=!0,vm.update.count++});break;case"VOTE_MINIPOLL":var newsId=newsFeedService.news.newsFeedArray.indexOf(data.messageId);-1!==newsId&&$scope.$apply(function(){void 0!==data.miniPollShare&&null!==data.miniPollShare&&(newsFeedService.news.newsFeed[newsId].message.miniPoll.hideResults=!1,vm.pollHideResult[data.messageId]=!1),void 0!==data.endDate&&null!==data.endDate&&(newsFeedService.news.newsFeed[newsId].message.miniPoll.endDate=data.endDate,vm.endPollCheck(data.messageId,data.endDate)),newsFeedService.news.newsFeed[newsId].message.miniPoll.result=data.miniPollResult});break;case"COMMENT_BLOCKED":var index=newsFeedService.news.newsFeedArray.indexOf(data.messageId);-1!==index&&$scope.$apply(function(){newsFeedService.news.newsFeed[index].blockCommenting=!newsFeedService.news.newsFeed[index].blockCommenting})}}function likePostSSE(response){stackSwitch(response,!0)}function addCommentSSE(response){var newsId=newsFeedService.news.newsFeedArray.indexOf(response.id),commentId=-1;-1!==newsId&&(void 0!==response.cid&&-1!==response.cid?-1!==(commentId=returnIndex(newsFeedService.news.newsFeed[newsId].comments,response.cid))&&$scope.$apply(function(){!angular.isArray(newsFeedService.news.newsFeed[newsId].comments[commentId].childComments)&&(newsFeedService.news.newsFeed[newsId].comments[commentId].childComments=[]),vm.previous=!1,newsFeedService.news.newsFeed[newsId].comments[commentId].childComments.unshift(response.comment),newsFeedService.news.newsFeed[newsId].comments[commentId].commentCount++,newsFeedService.news.newsFeed[newsId].comments[commentId].number++,vm.pageSetting.commentPageSize++}):$scope.$apply(function(){!angular.isArray(newsFeedService.news.newsFeed[newsId].comments)&&(newsFeedService.news.newsFeed[newsId].comments=[]),vm.previous=!1,newsFeedService.news.newsFeed[newsId].comments.unshift(response.comment),newsFeedService.news.newsFeed[newsId].commentCount++,newsFeedService.news.newsFeed[newsId].number++,vm.pageSetting.commentPageSize++}))}function deleteCommentSSE(response){var newsId=newsFeedService.news.newsFeedArray.indexOf(response.id||response.messageId),commentId=-1,childCommentsId=-1;-1!==newsId&&(void 0!==response.childCid&&-1!==response.childCid?(commentId=returnIndex(newsFeedService.news.newsFeed[newsId].comments,response.cid),childCommentsId=returnIndex(newsFeedService.news.newsFeed[newsId].comments[commentId].childComments,response.childCid),deleteCommentPost(newsFeedService.news.newsFeed[newsId].comments[commentId].childComments,childCommentsId,newsFeedService.news.newsFeed[newsId].comments[commentId],!0,newsFeedService.news.newsFeed[newsId])):void 0!==response.cid&&-1!==response.cid?(commentId=returnIndex(newsFeedService.news.newsFeed[newsId].comments,response.cid),deleteCommentPost(newsFeedService.news.newsFeed[newsId].comments,commentId,newsFeedService.news.newsFeed[newsId],!0,newsFeedService.news.newsFeed[newsId])):deleteCommentPost(newsFeedService.news.newsFeed,newsId,newsFeedService.news.newsFeed[newsId],!0,newsFeedService.news.newsFeed[newsId]))}function deletepostSSE(messageId){var index=newsFeedService.news.newsFeedArray.indexOf(messageId);-1!==index&&$scope.$apply(function(){newsFeedService.news.newsFeed[index].hide=!0,newsFeedService.news.newsFeed[index].delete=!0})}function imageUrl(loop){var arrayofObj=[];for(var key in loop.media)if("Video"===loop.media[key].mediaType||"VideoTab"===loop.media[key].mediaType){arrayofObj.push(loop.media[key]);break}return arrayofObj.length||arrayofObj.push({url:loop.imageUrl,mediaType:"image"}),arrayofObj}function stackDelete(data){var newsId=newsFeedService.news.newsFeedArray.indexOf(data.messageId||data.id),commentId=-1,childCommentsId=-1;-1!==newsId&&(-1!==data.childCid?(commentId=returnIndex(newsFeedService.news.newsFeed[newsId].comments,data.cid),childCommentsId=returnIndex(newsFeedService.news.newsFeed[newsId].comments[commentId].childComments,data.childCid),deleteCommentPost(newsFeedService.news.newsFeed[newsId].comments[commentId].childComments,childCommentsId,newsFeedService.news.newsFeed[newsId].comments[commentId],!1,newsFeedService.news.newsFeed[newsId])):-1!==data.cid?(commentId=returnIndex(newsFeedService.news.newsFeed[newsId].comments,data.cid),deleteCommentPost(newsFeedService.news.newsFeed[newsId].comments,commentId,newsFeedService.news.newsFeed[newsId],!1,newsFeedService.news.newsFeed[newsId])):deleteCommentPost(newsFeedService.news.newsFeed,newsId,newsFeedService.news.newsFeed[newsId],!1,newsFeedService.news.newsFeed[newsId]))}function getPreviousComments(data,SSE){vm.previousComment({messageId:data.id,commentsOnly:!0},data,SSE)}function deleteCommentPost(obj,deletedIndex,count,SSE,complete){-1!==deletedIndex&&(SSE?$scope.$apply(function(){obj.splice(deletedIndex,1),count.commentCount--}):(obj.splice(deletedIndex,1),count.commentCount--),obj.length<2&&count.commentCount>2&&getPreviousComments(complete,SSE))}function getMessageDetail(){newsPrivate()}function deleteCommentModal(news){vm.obj=news,ngDialog.open({template:vm.mortalUrl.deleteComment,scope:$scope})}function videoPopUp(url,mode,newtab){if("Video"===mode)if(newtab){var wind=window.open(url,"_blank");wind.focus()}else sharedProperties.videoPopUp(url);else{var modes=newtab?"_blank":"_self";window.open(url,modes).focus()}}function removeReference(reference){reference.authorSource=null,reference.description=null,reference.imageUrl=null,reference.media=null,reference.title=null}function createCommentObject(cid){return{comment:{comment:"",contentReference:{title:null,description:null,name:null,SPMedia:null},cid:cid||-1}}}function infinteScrollComment(pageSize){return!angular.isArray(vm.currentNews.comments)||(!vm.currentNews.comments.length||(vm.pageSetting.commentPageSize=pageSize,void(pageSize>=vm.currentNews.comments.length&&(vm.pageSetting.commentPageSize=vm.currentNews.comments.length))))}function hideFocus(id){vm.hideShow[id]=!0,vm.hideShowFocus[id]=!0}function deleteIndex(id){var index=newsFeedService.news.newsFeedArray.indexOf(id);-1!==index&&(newsFeedService.news.newsFeedArray.splice(index,1),newsFeedService.news.newsFeed.splice(index,1))}function miniPollHexOps(newsId,index,mEvents){mEvents?vm.hexHoverIndex[newsId]=index:vm.hexSelectedIndex[newsId]!==index?vm.hexSelectedIndex[newsId]=index:(vm.hexSelectedIndex[newsId]=-1,$timeout(function(){$("input[name=pollOptionsListingScale_"+newsId+"]").prop("checked",!1),vm.pollVotingDetails[newsId]=""},200))}function endPollCheck(id,dt){if(null!==dt&&void 0!==dt){var today=(new Date).setHours(0,0,0,0),eDate=new Date(parseInt(dt[0],10),parseInt(dt[1]-1,10),parseInt(dt[2],10)).setHours(0,0,0,0);vm.pollEnded[id]=today>=eDate}else vm.pollEnded[id]=!1}function assignPollCheck(ary,id,result){var ele=result?"#miniPollResult_"+id+" li.miniPollsOptsInput":"#miniPoll_"+id+" li.miniPollsOptsInput";$timeout(function(){$.each($(ele),function(index,val){-1!==ary.indexOf(index)&&($(this).find("input").prop("checked","checked"),vm.hexSelectedIndex[id]=index)})},200)}function pollActions(type,id){var newsId=newsFeedService.news.newsFeedArray.indexOf(id);switch(type){case"view":-1!==newsId&&(null===newsFeedService.news.newsFeed[newsId].message.miniPoll.result&&(newsFeedService.news.newsFeed[newsId].message.miniPoll.result={results:[0,0,0,0],averageScore:0}),newsFeedService.news.newsFeed[newsId].message.miniPoll.hideResults=!1,vm.viewPollResult[id]=!0,newsFeedService.news.newsFeed[newsId].userNewsFeedSelection&&vm.assignPollCheck(newsFeedService.news.newsFeed[newsId].userNewsFeedSelection,id,!0));break;case"share":-1!==newsId&&updatePollActions("share",id);break;case"end":-1!==newsId&&updatePollActions("end",id);break;case"vote":newsFeedService.news.newsFeed[newsId].message.miniPoll.hideResults=!0,vm.viewPollResult[id]=!1}}function setPollEndDate(){var dt=new Date;return[parseInt(dt.getFullYear(),10),parseInt(dt.getMonth()+1,10),parseInt(dt.getDate(),10),parseInt(dt.getHours(),10),parseInt(dt.getMinutes(),10),parseInt(dt.getSeconds(),10),parseInt(dt.getMilliseconds(),10)]}function getPollTotal(ary){return ary.reduce(function(a,b){return a+b})}function processVote(id){vm.pollVotingError[id]=!1;var param={messageId:id},opts=[];if(void 0!==vm.pollVotingDetails[id]&&null!==vm.pollVotingDetails[id]&&""!==vm.pollVotingDetails[id])if(vm.pollVotingError[id]=!1,"object"==typeof vm.pollVotingDetails[id]){for(var key in vm.pollVotingDetails[id])vm.pollVotingDetails[id].hasOwnProperty(key)&&vm.pollVotingDetails[id][key]&&opts.push(parseInt(key,10));opts.length?(param.selection=opts.toString(),answerPoll(id,param)):vm.pollVotingError[id]=!0}else param.selection=parseInt(vm.pollVotingDetails[id],10),answerPoll(id,param);else vm.pollVotingError[id]=!0}function showAll(type,news){vm.viewName=type||"home",void 0!==news&&null!==news&&(news.number=3),vm.currentNews=null,vm.noScroll=!1,vm.getAll?$("html,body").animate({scrollTop:newsOffset-20},1e3):(vm.viewingPage="home",invoke())}function typeSelect(sec,elem){vm.activeProfileContent=sec,vm.activeProfileSummary=sec,vm.togglePrimaryGraph(sec,elem)}function togglePrimaryGraph(id,elem){var g0=$(elem).find(".prismG0"),g1=$(elem).find(".prismG1"),g2=$(elem).find(".prismG2"),c0=$(elem).find(".crossLines0"),c1=$(elem).find(".crossLines1");vm.label="",vm.prismLabelContent=!1,jQuery(".outer-labels").find("p").removeClass("active"),1===id?(g0.attr({"fill-opacity":0,"stroke-width":0}),g1.attr({"fill-opacity":.6,"stroke-width":3,"stroke-opacity":.6,"stroke-dasharray":0}),c1.attr({"stroke-width":1}),c0.attr({"stroke-width":0}),g2.attr({"fill-opacity":.3,"stroke-opacity":.3,"stroke-dasharray":"3,6"})):(g0.attr({"fill-opacity":.3,"stroke-width":3,"stroke-opacity":.3,"stroke-dasharray":"3,6"}),g1.attr({"fill-opacity":0,"stroke-width":0,"stroke-opacity":0}),g2.attr({"fill-opacity":.6,"stroke-opacity":.6,"stroke-dasharray":0}),c1.attr({"stroke-width":0}),c0.attr({"stroke-width":1}))}function prism_portrait(page,active){var dialog=ngDialog.open({template:vm.pageTempaltes[page],className:"ngdialog-lnd-theme ngDialog-z-index",scope:$scope});vm.dialog=!0;var destroyRoot=$scope.$on("personalityGraph",function(e){destroyRoot(),vm.typeSelect(active,"#personalityChartDashboard1"),vm.callSticky()});dialog.closePromise.then(function(data){vm.dialog=!1})}function openTab(evt,tabActive){var i,tablinks;for($(".tabcontent").removeClass("show-tab").addClass("hide-tab"),tablinks=document.getElementsByClassName("tablinks"),i=0;i<tablinks.length;i++)tablinks[i].className=tablinks[i].className.replace(" active","");$("#"+tabActive).addClass("show-tab"),evt.currentTarget.parentElement.className+=" active",vm.viewTab=tabActive,vm.noScroll=vm.stopNewsFeed&&"tab1"===vm.viewTab||"individual"===vm.viewName}function init(){$(document).ready(function(){$("html, body").scrollTop(0)}),$(window).on("load",function(){$timeout(function(){$("html, body").scrollTop(0)},0),$(window).resize(function(){sticky_element()}),window.addEventListener("orientationchange",function(){sticky_element()}),sticky_element()}),vm.userInfo=basicService.getUserInfo(),sharedProperties.changeMomentDefaults(),$localStorage.remove("feedbackUserId"),invoke()}function sticky_element(){var width=$(window).width();vm.mobile=width<768,vm.stopNewsFeed=width<769,vm.specificSide=width<1250,$("#tab1").hasClass("show-tab")?vm.viewTab="tab1":vm.viewTab="tab2",vm.noScroll=vm.stopNewsFeed&&"tab1"===vm.viewTab||"individual"===vm.viewName,vm.stopNewsFeed?disableSticky():enableSticky()}function disableSticky(){$(".stick-me-in").trigger("sticky_kit:detach");var goal=$(".goal-information");!vm.stopNewsFeed&&goal.length&&$("html,body").animate({scrollTop:goal.offset().top-10},500)}function enableSticky(){if(!vm.disabled){$(".stick-me-in").stick_in_parent({offset_top:10,spacer:!1});var height=$(".stick-me-in").height();$(".right-section").css("min-height",height||"700px")}}function callSticky(){var height=$(".stick-me-in").height();$(".right-section").css("min-height",height||"700px")}function invoke(){basicService.getAllValidMember().then(function(response){vm.allMember=response,vm.bindEvents(),profileCall()})}function editProfileFn(){$rootScope.handleStickyTabs("profile")}function editSetting(){ngDialog.open({template:vm.mortalUrl.editSetting,scope:$scope})}function profileCall(){switch(vm.viewingPage){case"home":vm.getNewsFeed();break;case"profile":vm.getUserProfileFeed();break;case"message":vm.viewName="individual",vm.getMessageDetail()}}function redirectHome(){window.location.href="/sp"}var vm=this,newsOffset=0,messageDialog=!1;vm.viewingPage=$attrs.view,$scope.pullInterNationalization=$rootScope.pullInterNationalization,vm.news=newsFeedService.news,vm.serviceApis={getNewsFeed:"/sp/dashboard/getNewsFeed",userNewsFeed:"/sp/dashboard/getUserNewsFeed",announcementNewsFeed:"/sp/dashboard/getAnnouncements",getUserProfileFeed:"/sp/dashboard/getUserProfileFeed",message:"/sp/dashboard/message/details",prismLensDetail:"/sp/feedback/getFeedbackStatus",recentActivities:"/sp/logs/getUserActivityLogs",dashboardActivities:"/sp/logs/getDashboardActivityLogs",userActivities:"/sp/logs/getUserActivityLogs",sendReminder:"/sp/notifications/sendNotificationWithParams"},vm.mortalUrl={deletePost:"/sp/resources/html/dashboard/post-delete.html",blockCommenting:"/sp/resources/html/dashboard/post-block.html",deleteComment:"/sp/resources/html/dashboard/delete-comment.html",likedUsersList:"/sp/resources/html/dashboard/liked-user.html",prismLens:"/sp/resources/html/dashboard/prism-lens.html",editSetting:"/sp/resources/html/dashboard/edit-setting.html"};var width=$(window).width(),switching=0;vm.mobile=width<768,vm.stopNewsFeed=width<769,vm.specificSide=width<1250,vm.mobile?vm.viewTab="tab1":vm.viewTab="none",vm.noScroll=vm.stopNewsFeed&&"tab1"===vm.viewTab||"individual"===vm.viewName,vm.pageSetting={startIdx:0,filter:"all",filterName:"allPost",pageSize:"25",commentIncrement:10,commentPageSize:10,commentIncrementLimit:7,defaultMessageCount:50,totalComment:10},vm.update={update:!1,count:0},vm.fetchingData=!0,vm.responseRecieved=!1,vm.dialog=!1,vm.filterOptions=[{name:"allPost",value:"all"},{name:"notification.activities",value:"activity"},{name:"announcement",value:"announcement"}],vm.filterOptionsSelected=0,vm.allMember=[],vm.cloneFeed=null,vm.lastNewsFeed=null,vm.previous=!1,vm.viewType=null!==sharedProperties.getParam("msgId")?sharedProperties.getParam("msgId"):null,
vm.viewName=null!==sharedProperties.getParam("msgId")?"individual":"home",vm.viewingPage=null===vm.viewType?vm.viewingPage:"message",vm.profilePage=sharedProperties.getParam("userId"),vm.originalPageSetting=angular.copy(vm.pageSetting),vm.hideShow={},vm.hideShowFocus={},vm.getAll=!1,vm.noPost=!1,vm.disabled=!1,vm.checkPermission=sharedProperties.checkPermission(),vm.currentNews=null,vm.specficTheme=specficTheme,vm.clearOverlayVar=clearOverlayVar,vm.pageTempaltes={comment:"/sp/resources/html/dashboard/addcommentResponsive.html",edit:"/sp/resources/html/dashboard/addcommentResponsive.html",publicMessage:"/sp/resources/html/dashboard/what-is-public-responsive.html",profile:"/sp/resources/html/dashboard/profile-responsive.html"},vm.getNewsFeed=getNewsFeed,vm.follow=follow,vm.saveFeed=saveFeed,vm.childComment=childComment,vm.previousComment=previousComment,vm.deletePost=deletePost,vm.blockComment=blockComment,vm.likedUserName=likedUserName,vm.likePost=likePost,vm.getUserProfileFeed=getUserProfileFeed,vm.addComment=addComment,vm.addChildComment=addChildComment,vm.deleteComment=deleteComment,vm.getMessageDetail=getMessageDetail,vm.bindEvents=bindEvents,vm.changeFilterOption=changeFilterOption,vm.infinteScroll=infinteScroll,vm.getAppropiateTemplate=getAppropiateTemplate,vm.changeNewsFeed=changeNewsFeed,vm.emitLazy=sharedProperties.emitLazy,vm.sseFeedUpdate=sseFeedUpdate,vm.cloneFeedFn=cloneFeedFn,vm.whiteSpace=whiteSpace,vm.deletePostModal=deletePostModal,vm.blockPostModal=blockPostModal,vm.loadEmail=loadEmail,vm.tagAddedEdit=tagAddedEdit,vm.tagRemovedEdit=tagRemovedEdit,vm.deleteCommentModal=deleteCommentModal,vm.videoPopUp=videoPopUp,vm.removeReference=removeReference,vm.createCommentObject=createCommentObject,vm.infinteScrollComment=infinteScrollComment,vm.deleteIndex=deleteIndex,vm.imageUrl=imageUrl,vm.individualPost=individualPost,vm.showAll=showAll,vm.hideFocus=hideFocus,vm.callSticky=callSticky,vm.redirectHome=redirectHome,vm.pollVotingDetails=[],vm.pollResults=[],vm.pollHideResult=[],vm.pollVotingError=[],vm.pollEnded=[],vm.viewPollResult=[],vm.hexSelectedIndex=[],vm.hexHoverIndex=[],vm.hexChar=$sce.trustAsHtml(sharedProperties.processRatingHex(1,"minipolls")),vm.hexAvg=$sce.trustAsHtml(sharedProperties.processRatingHex(5,"minipolls")),vm.processVote=processVote,vm.getPollTotal=getPollTotal,vm.pollActions=pollActions,vm.assignPollCheck=assignPollCheck,vm.endPollCheck=endPollCheck,vm.miniPollHexOps=miniPollHexOps,vm.overlay=overlay,vm.getMoreComment=getMoreComment,vm.openTab=openTab,vm.editProfileFn=editProfileFn,vm.editSetting=editSetting,$scope.$on("dashboardMessage",receiveSSEData),$scope.imagePop=function(url,title){$rootScope.showImageModal=!0,$rootScope.modalImageUrl=url},vm.profilePageDetail=null,vm.prism_portrait=prism_portrait,vm.label="",vm.prismLabelContent=!1,vm.activeProfileSummary=0,vm.activeProfileContent=0,vm.typeSelect=typeSelect,vm.togglePrimaryGraph=togglePrimaryGraph,$rootScope.$on("refreshSticky",function(){if(!vm.disabled){$(document.body).trigger("sticky_kit:recalc");var height=$(".stick-me-in").height();$(".right-section").css("min-height",height||"700px")}}),$rootScope.$on("refreshStickyDetach",function(){vm.disabled=!0,disableSticky(),$(".right-section").addClass("overflowHidden")}),$rootScope.$on("refreshStickyEnable",function(){vm.disabled=!1,$("html,body").animate({scrollTop:$(".dashboard-feed").offset().top-30},500,function(){$(".left-section").removeClass("positionRelative"),$(".right-section").removeClass("overflowHidden"),sticky_element()})}),init()};return controller.$inject=["$scope","$attrs","ajaxService","$localStorage","notesService","$rootScope","$timeout","$templateRequest","$compile","miniPollsService","$sce"],{restrict:"EA",link:function($scope,$element,$attrs){$templateRequest($attrs.urlSrc||"/sp/resources/html/dashboard/newsFeed.html").then(function(html){var template=angular.element(html);$element.append(template),$compile(template)($scope)})},scope:{},controller:controller,controllerAs:"ctrl",bindToController:!0,replace:!0}}newsFeed.$inject=["$compile","$templateRequest","sharedProperties","basicService","$q","newsFeedService","ngDialog"],angular.module("spApp").directive("newsFeed",newsFeed);
function prismLabelDesc($rootScope){return{restrict:"A",link:function($scope,$element,$attrs){var label="",lno="",isTouch="ontouchstart"in window||navigator.msMaxTouchPoints>0,isRMtool=!1,isMem=!1;isTouch?$element.on("click",function(){isRMtool=void 0!==$element.attr("data-rm"),$element.hasClass("active")?($element.removeClass("active"),jQuery(".outer-labels").find("p").removeClass("active"),$scope.$apply(function(){isRMtool?($scope.$parent.$parent.prismLabelContent1=!1,$scope.$parent.$parent.prismLabelContent=!1,$scope.$parent.$parent.label=""):($scope.$parent.ctrl.prismLabelContent=!1,$scope.$parent.ctrl.label="")})):(jQuery(".outer-labels").find("p").removeClass("active"),$element.addClass("active"),label=$rootScope.pullInterNationalization($element.attr("data-label")).toLowerCase(),$scope.$apply(function(){isRMtool?($scope.$parent.$parent.prismLabelContent1=!1,$scope.$parent.$parent.prismLabelContent=!1,isMem=void 0!==$element.attr("data-mem"),isMem?$scope.$parent.$parent.prismLabelContent1=!0:$scope.$parent.$parent.prismLabelContent=!0,$scope.$parent.$parent.label=lno):($scope.$parent.ctrl.prismLabelContent=!0,$scope.$parent.ctrl.label=lno)}))}):($element.on("mouseenter",function(){isRMtool=void 0!==$element.attr("data-rm"),jQuery(".outer-labels").find("p").removeClass("active"),$element.addClass("active"),label=$rootScope.pullInterNationalization($element.attr("data-label")).toLowerCase(),lno=parseInt($element.attr("data-lno"),10),$scope.$apply(function(){isRMtool?(isMem=void 0!==$element.attr("data-mem"),isMem?$scope.$parent.$parent.prismLabelContent1=!0:$scope.$parent.$parent.prismLabelContent=!0,$scope.$parent.$parent.label=lno):($scope.$parent.ctrl.prismLabelContent=!0,$scope.$parent.ctrl.label=lno)})}),$element.on("mouseleave",function(){isRMtool=void 0!==$element.attr("data-rm"),$element.removeClass("active"),jQuery(".outer-labels").find("p").removeClass("active"),$scope.$apply(function(){isRMtool?(isMem=void 0!==$element.attr("data-mem"),isMem?$scope.$parent.$parent.prismLabelContent1=!1:$scope.$parent.$parent.prismLabelContent=!1,$scope.$parent.$parent.label=""):($scope.$parent.ctrl.prismLabelContent=!1,$scope.$parent.ctrl.label="")})}))}}}angular.module("spApp").directive("prismLabelDesc",prismLabelDesc),prismLabelDesc.$inject=["$rootScope"];
function prismLensFeed($templateRequest,$compile){var controller=function($scope,$rootScope,sharedProperties,ajaxService,ngDialog,$localStorage){function getFeedbackTeam(){vm.selectedUser=sharedProperties.getObject()}function resetErrors(){vm.formErrors={dateCheck:!1}}function sendRequestFeedbackAdmin(date){if(resetErrors(),!1===vm.formErrors.dateCheck){var param={firstName:vm.selectedUser.firstName,lastName:vm.selectedUser.lastName,email:vm.selectedUser.email,requestType:"INTERNAL",referenceType:"Colleague",comment:"",endDate:$scope.untilDate,groupMemberEmail:sharedProperties.getParam("email")};ajaxService.getAjaxResponse({url:vm.serviceApis.submitFeedbackRequest,data:$.param(param)}).then(function(response){"true"===response.Success?(ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("dashboard.requestSend")),sharedProperties.fireAnalyticsEvent("DashBoardFeed | Request Prism Lens","N/A")):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})}}function prismLensDetail(){ajaxService.getAjaxResponse({url:vm.serviceApis.prismLensDetail,data:$.param({userId:vm.parentDirective.profilePage})}).then(function(response){"true"===response.Success?(vm.prismLensView=response,$rootScope.$broadcast("refreshSticky")):null!==response.error&&sharedProperties.ajaxError(response.error)})}function prismLens(){sharedProperties.setObject(vm.parentDirective.profilePageDetail.member),ngDialog.open({template:vm.mortalUrl.prismLens,scope:$scope}).closePromise.then(function(data){vm.prismLensDetail()})}function setLocalStorage(){$localStorage.set(arguments[0],arguments[1]),window.location.href=arguments[2]}function sendReminderFeedback(email,id){ajaxService.getAjaxResponse({url:vm.serviceApis.sendReminder,data:$.param({brandHeader:"",ctaLabel:"",ctaUrl:"",logType:"PrismLens",type:"FeedbackReminder",memberList:email,feedbackUserId:id})}).then(function(response){"true"===response.Success?sharedProperties.growlMessage($rootScope.pullInterNationalization("dashboard.prismLensSuccess")):null!==response.error&&sharedProperties.ajaxError(response.error)})}function init(){permission.prismLens&&vm.prismLensDetail()}var vm=this,permission=sharedProperties.checkPermission();$scope.pullInterNationalization=$rootScope.pullInterNationalization,vm.serviceApis={prismLensDetail:"/sp/feedback/getFeedbackStatus",sendReminder:"/sp/notifications/sendNotificationWithParams",submitFeedbackRequest:"/sp/feedback/submitFeedbackRequest"},vm.mortalUrl={prismLens:"/sp/resources/html/dashboard/prism-lens-dialog.html"},vm.prismLensView=null,vm.feedbackEnable=!1,vm.formErrors={dateCheck:!1,emailCheck:!1,firstName:!1,lastName:!1},vm.showNames=!1,vm.selectedUser={},vm.showRequestFeedbackForm=!1,vm.nameDataForm={},vm.featuresSectionSelected=-1,vm.getAllMembersToInvite=null,vm.untilDate=null,vm.sendRequestFeedbackAdmin=sendRequestFeedbackAdmin,vm.prismLensDetail=prismLensDetail,vm.sendReminderFeedback=sendReminderFeedback,vm.prismLens=prismLens,vm.setLocalStorage=setLocalStorage,vm.getFeedbackTeam=getFeedbackTeam,$rootScope.$on("ngDialog.opened",function(e){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),$('input[name="endDate"]').daterangepicker({showDropdowns:!1,minDate:moment(),locale:{format:"MM/DD/YYYY"},alwaysShowCalendars:!0,singleDatePicker:!0,autoUpdateInput:!1,opens:"right"},function(start,end,label){$scope.$apply(function(){$scope.untilDate=start.format("MM/DD/YYYY")})})}),init()};return controller.$inject=["$scope","$rootScope","sharedProperties","ajaxService","ngDialog","$localStorage"],{restrict:"EA",link:function($scope,$element,$attrs,$ctrl){$templateRequest($attrs.urlSrc||"/sp/resources/html/dashboard/prism-lens.html").then(function(html){var template=angular.element(html);$element.append(template),$compile(template)($scope)})},scope:{},controller:controller,controllerAs:"ctrl",bindToController:{parentDirective:"="},replace:!0}}prismLensFeed.$inject=["$templateRequest","$compile"],angular.module("spApp").directive("prismLensFeed",prismLensFeed);
angular.module("spApp").directive("relationShipAdvisor",["$rootScope","ajaxService","sharedProperties","$q","basicService",function($rootScope,ajaxService,sharedProperties,$q,basicService){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return attrs.urlSrc||"/sp/resources/html/dashboard/relationship.html"},link:function(scope,element,attrs){function getRelationShipAdvisor(){var deferred=$q.defer();return promise||(ajaxService.getAjaxResponse({url:vm.serviceApis.relationShipAdvisor}).then(function(response){"true"===response.Success?(vm.list=response.memberList,deferred.resolve(response.memberList)):null!==response.error&&sharedProperties.ajaxError(response.error)}),promise=deferred.promise)}function relationShipAdvisorPage(withs){sharedProperties.fireAnalyticsEvent("Dashboard | View RelationshipAdvisor",vm.version),window.location.href="/sp/prism/relationship-advisor?userId="+vm.selfEmail+"&compare="+withs}function localSearch(query,list,callback){list.length?processRequest(query,list,callback):vm.getRelationShipAdvisor().then(function(list){processRequest(query,list,callback)})}function processRequest(query,list,callback){for(var matches=[],i=0;i<list.length&&matches.length<5;i++)list[i].email===vm.selfEmail||-1===list[i].name.toLowerCase().indexOf(query.searchStr.toLowerCase())&&-1===list[i].email.toLowerCase().indexOf(query.searchStr.toLowerCase())||matches.push(list[i]);callback&&callback(matches)}var promise,vm=scope;vm.serviceApis={relationShipAdvisor:"/sp/relationship/getMembers"},vm.list=[],vm.selfEmail=basicService.getUserInfo().member.email,vm.localSearch=localSearch,vm.getRelationShipAdvisor=getRelationShipAdvisor,vm.relationShipAdvisorPage=relationShipAdvisorPage,vm.version=$rootScope.marketingVersion,$rootScope.$broadcast("refreshSticky")}}}]);
function shareNote($compile,$templateRequest,sharedProperties,basicService,$q,newsFeedService,ngDialog){var controller=function($scope,$rootScope,sharedProperties,$timeout){function init(){self.permission=sharedProperties.checkPermission(),self.moreOptions=self.permission.iamaccountadmin||self.permission.groupLead,self.mobile=$(window).width()<768,self.getUserInfo=basicService.getUserInfo(),basicService.getAllValidMember().then(function(response){self.allMember=response}),self.postMessageObject=newsFeedService.postMessageObject(),self.pageSetting.searchMode=null}function groupFilter(){var copyList=angular.copy(self.allGroup),tempList=[],tempList1=[];self.groupsList=[],$.each(copyList,function(i,j){$.inArray(copyList[i].id||copyList[i].groupId,self.clonePostMessageObject.groupIds)>-1?tempList1.push(copyList[i]):tempList.push(copyList[i])}),self.groupAvailable=angular.copy(tempList),self.groupsList=angular.copy(tempList1)}function callGroupMortal(){self.clonePostMessageObject={},self.clonePostMessageObject.groupIds=[],self.allGroup=[],self.permission.iamaccountadmin?adminG():groupLeadG()}function groupLeadG(){for(var i=0;i<self.getUserInfo.member.groupAssociationList.length;i++)self.getUserInfo.member.groupAssociationList[i].groupLead&&self.allGroup.push(self.getUserInfo.member.groupAssociationList[i]);openGroupModal()}function adminG(){basicService.getAllGroup(function(response){self.allGroup=response,openGroupModal()})}function openGroupModal(){self.groupAvailable=angular.copy(self.allGroup),self.clonePostMessageObject.groupIds=angular.copy(self.postMessageObject.groupIds),groupFilter(),ngDialog.open({template:"/sp/resources/html/dashboard/share-update-group.html",scope:$scope})}function callCustomizeMortal(){self.clonePostMessageObject={},self.pageSetting.organizationSearch="",self.pageSetting.competencySearch="",basicService.getAllOrganization(function(response){self.allOrganization=response.actionPlanListing,self.clonePostMessageObject.actionPlanIds=angular.copy(self.postMessageObject.actionPlanIds),null===self.pageSetting.searchMode&&(self.pageSetting.searchMode="o"),openCustomizeModal()}),basicService.getAllCompetency(function(response){self.allCompetency=response.competencyProfile,self.clonePostMessageObject.competencyIds=angular.copy(self.postMessageObject.competencyIds)})}function openCustomizeModal(){ngDialog.open({template:"/sp/resources/html/dashboard/share-update-customize.html",scope:$scope})}var self=this;self.postMessageForm={submitted:!1},self.pageSetting={organizationSearch:"",competencySearch:""},self.miniPollsView=!1,self.tagMembers=!1;var filterOptionArray=["All","Activity","Announcement"],filterSelected="All";self.loadEmail=function(query){for(var deferred=$q.defer(),result=[],i=0;i<self.allMember.length&&result.length<5;i++)-1===self.allMember[i].name.toLowerCase().indexOf(query.toLowerCase())&&-1===self.allMember[i].email.toLowerCase().indexOf(query.toLowerCase())||result.push(self.allMember[i]);return deferred.resolve(result),deferred.promise},self.tagAdded=function(tag){self.postMessageObject.taggedMemberIds.push(tag.id)},self.tagRemoved=function(tag){self.postMessageObject.taggedMemberIds.splice(self.postMessageObject.taggedMemberIds.indexOf(tag.id),1)},self.groupList=function(groupData,isRemove){var groupId=isRemove?groupData:groupData.originalObject.id||groupData.originalObject.groupId,index=self.clonePostMessageObject.groupIds.indexOf(groupId);-1!==index?self.clonePostMessageObject.groupIds.splice(index,1):self.clonePostMessageObject.groupIds.push(groupId),groupFilter()},self.shareSelection=function(selected,action){filterSelected=selected,"All"===selected?(self.postMessageObject.allMembers=!0,self.actionSelected=action):self.postMessageObject.allMembers=!1,"Announcement"===selected?(self.postMessageObject.announcement=!0,self.postMessageObject.allMembers=!0,self.actionSelected=action):self.postMessageObject.announcement=!1,"Group"===selected?(callGroupMortal(),self.actionSelected=action):(self.postMessageObject.groupIds=[],self.groupsList=[]),"Customize"===selected?(callCustomizeMortal(),self.actionSelected=action):(self.pageSetting.searchMode=null,self.postMessageObject.actionPlanIds=[],self.postMessageObject.competencyIds=[])},self.saveGroup=function(execute){if(!execute)return!0;self.postMessageObject.groupIds=angular.copy(self.clonePostMessageObject.groupIds),ngDialog.close()},self.clearSelection=function(){self.clonePostMessageObject.actionPlanIds=[],self.clonePostMessageObject.competencyIds=[],self.pageSetting.organizationSearch="",self.pageSetting.competencySearch=""},self.includeCheck=function(param,setting){var i=$.inArray(param,self.clonePostMessageObject[setting]);i>-1?self.clonePostMessageObject[setting].splice(i,1):self.clonePostMessageObject[setting].push(param)},self.saveCustomize=function(){"o"===self.pageSetting.searchMode?(self.postMessageObject.actionPlanIds=angular.copy(self.clonePostMessageObject.actionPlanIds),self.clonePostMessageObject.actionPlanIds.length?self.clonePostMessageObject.actionPlanIds=[]:self.shareSelection("All",$rootScope.pullInterNationalization("dashboard.sharewithall"))):"c"===self.pageSetting.searchMode&&(self.postMessageObject.competencyIds=angular.copy(self.clonePostMessageObject.competencyIds),self.clonePostMessageObject.competencyIds.length?self.clonePostMessageObject.competencyIds=[]:self.shareSelection("All",$rootScope.pullInterNationalization("dashboard.sharewithall"))),ngDialog.close()},self.closeMortal=function(lg){lg?ngDialog.close():(self.shareSelection("All",$rootScope.pullInterNationalization("dashboard.sharewithall")),ngDialog.close())},self.processMessage=function(param){newsFeedService.postMessage(param).then(function(response){if(null===response)return!0;var actionSelected=self.actionSelected;filterOptionArray[$scope.notesCtrl.filterOption]===filterSelected||"All"===filterOptionArray[$scope.notesCtrl.filterOption]?(response.message.number=self.mobile?1:3,newsFeedService.news.newsFeed.unshift(response.message),newsFeedService.news.newsFeedArray.unshift(response.message.id)):sharedProperties.growlMessage("Announcement"!==filterSelected?$rootScope.pullInterNationalization("growl.sharedPost"):$rootScope.pullInterNationalization("growl.sharedAnnouncement")),self.postMessageObject.comment.miniPoll=null,self.shareSelection("All",$rootScope.pullInterNationalization("dashboard.sharewithall")),self.postMessageObject.comment.comment="",self.removeReference(self.postMessageObject.comment.contentReference),self.tagsAdded=[],self.postMessageObject.taggedMemberIds=[],self.postMessageObject.sendEmail=!1,$("#shareUpdateText").css("height","80px"),$(".tagsEmailInput").find("input").val("").width("auto"),sharedProperties.fireAnalyticsEvent("Newsfeed | Share an update",actionSelected)})},self.postMessage=function(param){self.postMessageForm.submitted=!1,self.postMessageForm.$valid?self.processMessage(param):self.postMessageForm.submitted=!0},self.rootScope=function(message){return $rootScope.pullInterNationalization(message)},self.closeThis=function(){$rootScope.selectedNotesTab=-1},self.videoPopUp=function(url,mode,newtab){if("Video"===mode)if(newtab){var wind=window.open(url,"_blank");wind.focus()}else sharedProperties.videoPopUp(url);else{window.open(url,"_blank").focus()}},self.removeReference=function(reference){reference.authorSource=null,reference.description=null,reference.imageUrl=null,reference.media=null,reference.title=null,void 0!==reference.url&&(reference.url=null),void 0!==reference.valid&&(reference.valid=!1)},self.pollsView=function(action){self.miniPollsView=!0},init()};return controller.$inject=["$scope","$rootScope","sharedProperties","$timeout"],{restrict:"EA",link:function($scope,$element,$attrs){$templateRequest($attrs.urlSrc||"/sp/resources/html/dashboard/share-update.html").then(function(html){var template=angular.element(html);$element.append(template),$compile(template)($scope)})},scope:{filterOption:"=filter"},controller:controller,controllerAs:"notesCtrl",bindToController:!0,replace:!0}}angular.module("spApp").directive("shareNote",shareNote),shareNote.$inject=["$compile","$templateRequest","sharedProperties","basicService","$q","newsFeedService","ngDialog"];