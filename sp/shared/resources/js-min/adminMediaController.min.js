function adminMediaController($scope,ajaxService,$localStorage,ngDialog,sharedProperties,filterFilter,$filter,$rootScope,$timeout){function uploadMediaFile(){if(self.uploadFormSubmitted=!1,self.uploadMediaForm.$valid&&void 0!==self.media.file.name){var formObj=new FormData(document.getElementById("mediaForm"));"IMAGE"===self.media.mediaType&&(formObj.append("width",self.media.width),formObj.append("height",self.media.height)),formObj.append("file",self.media.file,self.media.file.name),-1!==self.orgURLs.indexOf(window.location.pathname)?(formObj.append("companyId",$localStorage.get("companyId").id),formObj.append("companyName",$localStorage.get("companyId").name)):(formObj.append("companyId","SurePeople"),formObj.append("companyName","SurePeople")),"upload"===$rootScope.mediaView&&formObj.append("status","Active");var multiPartRequest=$.ajax({url:self.serviceApis.uploadMedia,type:"POST",data:formObj,processData:!1,contentType:!1,beforeSend:function(){$rootScope.$broadcast("httpLoaderStart")}});multiPartRequest.done(function(response){"true"===response.success.Success?($.growl({icon:"glyphicon glyphicon-ok",message:" Media updated Successfully"}),$rootScope.$broadcast("httpLoaderEnd"),"upload"===$rootScope.mediaView?($localStorage.set("mediaData",response.success.mediaInfo),delete $rootScope.mediaView,ngDialog.close()):$timeout(function(){window.location.href="/sp/sysAdmin/media/listPage"},500)):($.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Media Upload Failed."}),$rootScope.$broadcast("httpLoaderEnd"))}),multiPartRequest.fail(function(jqXHR,textStatus){$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Media Upload Failed."}),$rootScope.$broadcast("httpLoaderEnd")})}else self.uploadFormSubmitted=!0}function cancelRedirect(){window.location.href="/sp/sysAdmin/media/listPage"}function switchView(type){$rootScope.mediaView=type}function changeMediaAcceptType(){switch(self.media.mediaType){case"IMAGE":self.acceptedFileType="image/gif, image/jpg, image/jpeg, image/png";break;case"PDF":self.acceptedFileType="application/pdf";break;case"PPT":self.acceptedFileType="application/vnd.ms-powerpoint, application/vnd.openxmlformats-officedocument.presentationml.presentation";break;case"MSDOC":self.acceptedFileType="application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document"}if(self.media.file={},"SELECT"===self.media.mediaType){document.querySelector("img.image-preview").src="/sp/resources/images/placeholder.png"}}var self=this;self.serviceApis={uploadMedia:"/sp/media/save"},self.media={},self.hasValidationErrors=!1,self.uploadFormSubmitted=!1,self.imageData=null,self.media.mediaType="SELECT",self.media.status="Active",self.tags="",self.acceptedFileType="image/gif, image/jpg, image/jpeg, image/png",self.cancelRedirect=cancelRedirect,self.media.file={},self.uploadMediaFile=uploadMediaFile,self.switchView=switchView,self.changeMediaAcceptType=changeMediaAcceptType,self.orgURLs=["/sp/admin/account/actionPlan/updatePage","/sp/admin/account/actionPlan/createPage","/sp/sysAdmin/actionPlan/updateOrgPlan","/sp/sysAdmin/actionPlan/createOrgPlan"],jQuery(".select-image-btn").on("click",function(e){if(e.preventDefault(),"SELECT"!==self.media.mediaType){jQuery("input:file").click(),$scope.$apply()}}),jQuery("input:file").change(function(){var preview=document.querySelector("img.image-preview");if(self.media.file=this.files[0],$scope.$apply(),"IMAGE"===self.media.mediaType){var fr=new FileReader;fr.onload=function(){var img=new Image;img.onload=function(){self.media.width=img.width,self.media.height=img.height},img.src=fr.result,preview.src=fr.result},fr.readAsDataURL(self.media.file)}})}function adminMediaUpdateController($scope,ajaxService,$localStorage,ngDialog,sharedProperties,filterFilter,$filter,$rootScope,$timeout){function cancelRedirect(){window.location.href="/sp/sysAdmin/media/listPage"}function updateImage(formData){formData.tags=self.tags;var _params={};if(self.uploadFormSubmitted=!1,self.uploadMediaForm.$valid){_params=formData;var options={url:self.serviceApis.updateImage,data:$.param(_params)};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?($.growl({icon:"glyphicon glyphicon-ok",message:" Media updated Successfully"}),$timeout(function(){window.location.href="/sp/sysAdmin/media/listPage"},500)):$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Image update failed."})})}else self.uploadFormSubmitted=!0}var self=this;self.serviceApis={getImage:"/sp/sysAdmin/media/get",updateImage:"/sp/sysAdmin/media/update"},self.media={},self.hasValidationErrors=!1,self.uploadFormSubmitted=!1,self.updateImage=updateImage,self.cancelRedirect=cancelRedirect,self.tags="";var getParameter=function(val){for(var query=window.location.search.substring(1),vars=query.split("&"),pair=[],i=0;i<vars.length;i++)return pair=vars[i].split("="),pair[0]===val?pair[1]:null},getImage=function(id){ajaxService.getAjaxResponse({url:self.serviceApis.getImage,data:$.param({id:id}),method:"POST"}).then(function(response){if("true"===response.Success)self.media=response.mediaInfo,0===self.media.tags.length?self.tags="":self.tags=self.media.tags.length>1?self.media.tags.join(","):self.media.tags[0];else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})};!function(){var param=getParameter("id");null!==param?getImage(param):window.location.href="/sp/sysAdmin/media/uploadPage"}()}angular.module("spApp").controller("adminMediaController",adminMediaController),angular.module("spApp").controller("adminMediaUpdateController",adminMediaUpdateController),adminMediaController.$inject=["$scope","ajaxService","$localStorage","ngDialog","sharedProperties","filterFilter","$filter","$rootScope","$timeout"],adminMediaUpdateController.$inject=["$scope","ajaxService","$localStorage","ngDialog","sharedProperties","filterFilter","$filter","$rootScope","$timeout"];