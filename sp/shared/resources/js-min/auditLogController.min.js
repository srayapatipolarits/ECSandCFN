function auditLogController($scope,$q,ajaxService,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage){var self=this;self.auditFilteredList=[],self.masterAuditList=[],self.urls={getAuditHome:"/sp/sysAdmin/audit/getAuditHome",getAllServices:"/sp/sysAdmin/audit/getAllServices"};var d=new Date;self.filterDialog=null,self.allServices=[],self.pageSetting={pageSize:10,intialPageSize:10,filter:{},userEmail:{email:[]},checkBox:[],statusInclude:["online","offline"],userTypeSelected:"",userServiceSelected:"",lastPredicate:"name",lastReverse:!1,loadBtnCLicked:!1,load:!0,textSearching:"",disabledInfinite:!1,onlineC:!0,offlineC:!0,selectedActivity:"",time:"WEEK",maxDate:d.setMonth(d.getMonth()-3)},self.originalpageSetting=angular.copy(self.pageSetting),self.inviteError=!1,self.auditLog={},self.advanceOn=!1,self.filterFromDate=null,self.filterToDate=null,self.dateRangeFilter=null,self.getAuditHomeData=function(){ajaxService.getAjaxResponse({url:self.urls.getAuditHome}).then(function(response){self.masterAuditList=response.auditLogHome,self.auditFilteredList=angular.copy(self.masterAuditList),self.getAuditFilteredList(self.pageSetting.pageSize)})},self.advancedFilterDialog=function(){self.filterDialog=ngDialog.open({template:"/sp/sysAdmin/audit/advancedFilterPopup",scope:$scope}),$rootScope.$on("ngDialog.opened",function(e){$timeout(function(){prepareDatePicker()},500)})};var prepareDatePicker=function(){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),self.filterFromDate=moment().subtract(30,"days").format("MM/DD/YYYY"),self.filterToDate=moment().format("MM/DD/YYYY"),$('input[name="dateRangeFilter"]').daterangepicker({showDropdowns:!1,maxDate:moment(),startDate:moment().subtract(30,"days").toDate(),endDate:moment(),locale:{format:"MMM DD, YYYY"},alwaysShowCalendars:!0,autoApply:!0,opens:"right"},function(start,end,label){$scope.$apply(function(){self.filterFromDate=start.format("MM/DD/YYYY"),self.filterToDate=end.format("MM/DD/YYYY")})})};self.advanceSearch=function(){self.inviteError=!1,self.auditLog.$valid?ajaxService.getAjaxResponse({url:self.urls.getAuditHome,data:$.param({fromDate:self.filterFromDate,endDate:self.filterToDate})}).then(function(response){self.advanceOn=!0,self.masterAuditList=response.auditLogHome,self.auditFilteredList=angular.copy(self.masterAuditList),self.getAuditFilteredList(self.pageSetting.pageSize),self.filterDialog.close()}):self.inviteError=!0},self.getAllServices=function(){ajaxService.getAjaxResponse({url:self.urls.getAllServices}).then(function(response){self.allServices=response.services})},self.resetfilter=function(){self.pageSetting=angular.copy(self.originalpageSetting),self.searchText="",self.advanceOn?self.getAuditHomeData():self.getAuditFilteredList(self.pageSetting.pageSize),self.advanceOn=!1},self.filterByService=function(status){self.getAuditFilteredList(self.pageSetting.pageSize)},self.includeCheck=function(status){self.getAuditFilteredList(self.pageSetting.pageSize)},self.infiniteScroll=function(arg){self.pageSetting.loadBtnCLicked=!0,self.getAuditFilteredList(arg)},self.searchTextFilter=function(search){self.pageSetting.textSearching=search},self.clearSearch=function(){self.pageSetting.textSearching.length&&(self.pageSetting.textSearching="",self.searchText="")},self.enableCancel=function(search){return void 0!==search&&search.length>1},self.getAuditFilteredList=function(pageSize){if(!self.masterAuditList.length)return!0;var result=self.masterAuditList;self.auditFilteredList=result.filter(function(e){var userTypeFlag=null!=self.pageSetting.userTypeSelected&&self.pageSetting.userTypeSelected===e.accountType||""===self.pageSetting.userTypeSelected&&e.accountType,activityFlag=null!=self.pageSetting.selectedActivity&&self.pageSetting.selectedActivity===e.activityType||""===self.pageSetting.selectedActivity&&e.activityType,serviceFlag=null!=self.pageSetting.userServiceSelected&&$.inArray(self.pageSetting.userServiceSelected,e.serviceType)>-1||""===self.pageSetting.userServiceSelected&&e.serviceType,onlineFlag=self.pageSetting.onlineC===e.online,offlineFlag=self.pageSetting.offlineC===e.offline,timeFilterFlag=!1;return $.inArray(self.pageSetting.time,e.timeFilters)>-1&&(timeFilterFlag=!0),userTypeFlag&&activityFlag&&serviceFlag&&(onlineFlag||offlineFlag)&&timeFilterFlag}),self.pageSetting.pageSize=pageSize,pageSize>=self.masterAuditList.length&&(self.pageSetting.disabledInfinite=!0,self.pageSetting.pageSize=self.masterAuditList.length),self.pageSetting.load&&(self.pageSetting.lastPredicate="name",self.pageSetting.lastReverse=!1,self.pageSetting.loadBtnCLicked=!1,self.pageSetting.load=!1)}}function auditLogDetailController($scope,$q,ajaxService,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage){var self=this;self.auditFilteredList=[],self.masterAuditList=[],self.userDetail=null,self.urls={getAuditDetail:"/sp/sysAdmin/audit/getAuditDetail",getAllServices:"/sp/sysAdmin/audit/getAllServices"};var d=new Date;self.allServices=[],self.pageSetting={pageSize:10,intialPageSize:10,filter:{},userEmail:{email:[]},checkBox:[],statusInclude:["online","offline"],userTypeSelected:"",userServiceSelected:"",lastPredicate:"name",lastReverse:!1,loadBtnCLicked:!1,load:!0,textSearching:"",disabledInfinite:!1,onlineC:!0,offlineC:!0,time:"WEEK",maxDate:d.setMonth(d.getMonth()-3)},self.originalpageSetting=angular.copy(self.pageSetting),self.filterFromDate=null,self.filterToDate=null,self.dateRangeFilter=null,self.getAuditDetailData=function(){ajaxService.getAjaxResponse({url:self.urls.getAuditDetail,data:$.param({email:sharedProperties.getParam("email")})}).then(function(response){self.masterAuditList=response.auditDetails,self.userDetail=response.userDetails,self.auditFilteredList=angular.copy(self.masterAuditList)})},self.resetfilter=function(){self.pageSetting=angular.copy(self.originalpageSetting),self.getAuditFilteredList(self.pageSetting.pageSize)},self.getAllServices=function(){ajaxService.getAjaxResponse({url:self.urls.getAllServices}).then(function(response){self.allServices=response.services})},self.advancedFilterDialog=function(){self.filterDialog=ngDialog.open({template:"/sp/sysAdmin/audit/advancedFilterPopup",scope:$scope}),$timeout(function(){prepareDatePicker()},500)};var prepareDatePicker=function(){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),self.filterFromDate=moment().subtract(30,"days").format("MM/DD/YYYY"),self.filterToDate=moment().format("MM/DD/YYYY"),$('input[name="dateRangeFilter"]').daterangepicker({showDropdowns:!1,maxDate:moment(),startDate:moment().subtract(30,"days").toDate(),endDate:moment(),locale:{format:"MMM DD, YYYY"},alwaysShowCalendars:!0,autoApply:!0,opens:"right"},function(start,end,label){$scope.$apply(function(){self.filterFromDate=start.format("MM/DD/YYYY"),self.filterToDate=end.format("MM/DD/YYYY")})})};self.advanceSearch=function(){ajaxService.getAjaxResponse({url:self.urls.getAuditDetail,data:$.param({email:sharedProperties.getParam("email"),fromDate:self.filterFromDate,endDate:self.filterToDate})}).then(function(response){self.masterAuditList=response.auditDetails,self.userDetail=response.userDetails,self.auditFilteredList=angular.copy(self.masterAuditList),self.filterDialog.close()})},self.searchTextFilter=function(search){self.pageSetting.textSearching=search},self.clearSearch=function(){self.pageSetting.textSearching.length&&(self.pageSetting.textSearching="",self.searchText="")},self.enableCancel=function(search){return void 0!==search&&search.length>1},self.filterByService=function(status){self.getAuditFilteredList(self.pageSetting.pageSize)},self.includeCheck=function(status){self.getAuditFilteredList(self.pageSetting.pageSize)},self.infiniteScroll=function(arg){self.pageSetting.loadBtnCLicked=!0,self.getAuditFilteredList(arg)},self.getAuditFilteredList=function(pageSize){if(!self.masterAuditList.length)return!0;var result=self.masterAuditList;self.auditFilteredList=result.filter(function(e){var serviceFlag=null!=self.pageSetting.userServiceSelected&&self.pageSetting.userServiceSelected===e.serviceType||""===self.pageSetting.userServiceSelected&&e.serviceType,timeFilterFlag=!1;return $.inArray(self.pageSetting.time,e.timeFilter)>-1&&(timeFilterFlag=!0),serviceFlag&&timeFilterFlag}),self.pageSetting.pageSize=pageSize,pageSize>=self.masterAuditList.length&&(self.pageSetting.disabledInfinite=!0,self.pageSetting.pageSize=self.masterAuditList.length),self.pageSetting.load&&(self.pageSetting.lastPredicate="name",self.pageSetting.lastReverse=!1,self.pageSetting.loadBtnCLicked=!1,self.pageSetting.load=!1)}}angular.module("spApp").controller("auditLogListController",auditLogController),angular.module("spApp").controller("auditLogDetailController",auditLogDetailController),auditLogController.$inject=["$scope","$q","ajaxService","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage"],auditLogDetailController.$inject=["$scope","$q","ajaxService","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage"];