angular.module("spApp").directive("candidatePublicProfile",["sharedProperties","memberService","commonService","$rootScope","spConfig","spValue","ngDialog","$filter","$localStorage","$q","groupsService","rolesService","archiveService","idealPortraitService","ajaxService",function(sharedProperties,memberService,commonService,$rootScope,spConfig,spValue,ngDialog,$filter,$localStorage,$q,groupsService,rolesService,archiveService,idealPortraitService,ajaxService){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/people-analytics/"+attrs.urlSrc},link:function(scope,element,attrs){function getFeedbackDetails(memberObj){var param={id:memberObj.id,archiveUser:!1};ajaxService.getAjaxResponse({url:"/sp/hiring/lens/get",data:$.param(param)}).then(function(response){"true"===response.Success?(self.getInviteMemberDetail=response.hiringLens.lensResponse,self.swotMemId=memberObj.id,self.swotanalysis=response.hiringLens.lensResponse.swotanalysis,void 0!==response.hiringLens.lensResponse.swotanalysis&&(self.feedbackEnable=!0,self.swotView=!0)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function init(){ajaxService.getAjaxResponse({url:"/sp/hiring/ext/portrait/get"}).then(function(response){"true"===response.Success?(self.profileDetail=response.hiringUser,self.rolesList=response.rolesAndMatch,self.feedbackTeamList=response.feedbackFlow,(null===self.profileDetail.dob||void 0===self.profileDetail.dob)&&(self.profileDetail.dob=["","",""])&&(self.dobEmpty=!0),null===self.profileDetail.address&&(self.profileDetail.address={},self.profileDetail.address.zipCode="",self.profileDetail.address.city="",self.profileDetail.address.state="",self.profileDetail.address.addressLine1="",self.profileDetail.address.addressLine2="",self.profileDetail.address.country="US"),self.profileDetailBackup=angular.copy(self.profileDetail),"US"===self.profileDetail.address.country?self.showStatesUS=!0:"CA"===self.profileDetail.address.country?self.showStatesCanada=!0:self.showStatesOthers=!0,!self.isMobile&&self.setActiveView("prismPortrait"),self.responseAvailable=!0):null!==response.error&&sharedProperties.ajaxError(response)})}var self=scope;self.activeUserId=$localStorage.get("empUserId"),self.loggedInUser=$localStorage.get("loggegdInProfile"),self.noErti=null!==$localStorage.get("noErti"),self.roleView=null!==$localStorage.get("roleView"),self.memberType="Member",self.responseAvailable=!1,self.profileDetail={},self.memberNav="",self.groupObj={},self.editProfile=!1,self.profileDetailForm={},self.todayDate=moment().format("MMM D, YYYY"),self.editedComment={comment:null,cid:null,userId:null},self.noteObj={userId:null,comment:null,cid:null},self.activeNoteIndex=0,self.existingCandidate=!1,self.userSelectedTags=[],self.displayTags=[],self.userSelectedProfileTags=[],self.masterCandidatesList=[],self.dobEmpty=!1,self.tagsVisited=!1,self.viewPortraitFlag=!1,self.selectedPortrait={},self.selectedUserPortrait={},self.portraitSearch="",self.pageSetting={updateSearchText:""},self.portraitsListing=[],self.selectedTabText=null,self.tabOpen=!1,self.isMobile=$(window).width()<768,self.isSafari=!!navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i)&&void 0!==document.body.style.webkitFilter&&!window.chrome,self.setActiveView=function(viewName){switch(self.memberNav=viewName,viewName){case"prismPortrait":break;case"notes":self.noteSubmitted=!1,self.noteObj={userId:self.activeUserId,comment:null,cid:null}}self.isMobile&&$("html,body").animate({scrollTop:0},200)},self.toggleProfileView=function(){!self.editProfile&&(self.profileDetailBackup=angular.copy(self.profileDetail)),self.editProfile=!self.editProfile,self.profileSubmitted=!1,self.profileDetail=angular.copy(self.profileDetailBackup)},self.stateCheck=function(country){switch(self.showStatesUS=!1,self.showStatesCanada=!1,self.showStatesOthers=!1,country){case"United States":self.showStatesUS=!0;break;case"Canada":self.showStatesCanada=!0;break;case"US":self.showStatesUS=!0;break;case"CA":self.showStatesCanada=!0;break;default:self.showStatesUS=!1,self.showStatesCanada=!1,self.showStatesOthers=!0}},self.viewMatchReport=function(role){self.selectedPortrait=role.portrait,self.selectedUserPortrait.matchResult=role.matchResult,self.selectedUserPortrait.firstName=self.profileDetail.firstName,self.selectedUserPortrait.lastName=self.profileDetail.lastName,self.viewPortraitFlag=!0},self.closeReportView=function(){self.viewPortraitFlag=!1,self.selectedPortrait={},self.selectedUserPortrait={}},self.toggleView=function(memberObj){self.featuresSectionSelected!==memberObj.id?self.featuresSectionSelected=memberObj.id:self.featuresSectionSelected=-1,self.swotView?self.swotView=!1:getFeedbackDetails(memberObj)},self.changeTab=function(tabsName){self.selectedTabText=tabsName,self.setActiveView(tabsName)},init()}}}]);
angular.module("spApp").directive("archives",["spConfig","ajaxService","sharedProperties","commonService","spValue","ngDialog","$filter","$localStorage","$q","$timeout","$rootScope","rolesService","archiveService","memberService",function(spConfig,ajaxService,sharedProperties,commonService,spValue,ngDialog,$filter,$localStorage,$q,$timeout,$rootScope,rolesService,archiveService,memberService){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/people-analytics/"+attrs.urlSrc},link:function(scope,element,attrs){function order(predicate,reverse){self.pageSetting.lastPredicate=predicate,self.pageSetting.lastReverse=reverse;var orderedList=$filter("orderBy")(self.memberList,self.pageSetting.lastPredicate,self.pageSetting.lastReverse);self.memberList=function(array,key){if("lastName"===key){for(var list=[],empty=[],i=0;i<array.length;i++)null!==array[i][key]&&""!==array[i][key]&&void 0!==array[i][key]?list.push(array[i]):empty.push(array[i]);return $.merge(list,empty)}return orderedList}(orderedList,self.pageSetting.lastPredicate)}function filterWithDateRange(createdDate){if(null===createdDate)return!1;var createDt=createdDate[1]+"/"+createdDate[2]+"/"+createdDate[0];return moment(createDt,"MM/DD/YYYY").isBetween(moment(self.filterFromDate,"MM/DD/YYYY"),moment(self.filterToDate,"MM/DD/YYYY"),"days","[]")}function filterRoles(roles){return null!==roles&&roles.some(function(obj){return-1!==self.pageSetting.userRoleSelected.indexOf(obj.id)})}function filterInArray(tags,array){return array.some(function(v){return-1!==tags.indexOf(v)})}function memberOperation(response){getFilterValue(),self.returnMemberList(self.pageSetting.pageSize),self.responseAvailable=!0,$timeout(function(){prepareDatePicker()},200)}function getFilterValue(){for(var userStatus=[],titleFilters=[],rolesFilter=[],tagsFilter=[],arr=[],i=0;i<self.masterMemberList.length;i++){if(null!==self.masterMemberList[i].title&&"Member"===self.masterMemberList[i].type&&titleFilters.push(self.masterMemberList[i].title),null!==self.masterMemberList[i].userStatus&&userStatus.push({userStatus:self.masterMemberList[i].userStatus,userFormatted:self.masterMemberList[i].userStatusFormatted}),null!==self.masterMemberList[i].tagList)for(var k=0;k<self.masterMemberList[i].tagList.length;k++)tagsFilter.push(self.masterMemberList[i].tagList[k]);if(null!==self.masterMemberList[i].hiringRoles&&void 0!==self.masterMemberList[i].hiringRoles)for(var xyz=0;xyz<self.masterMemberList[i].hiringRoles.length;xyz++)rolesFilter.push(self.masterMemberList[i].hiringRoles[xyz])}self.filterOptions.userStatus=userStatus.filter(function(e){if(-1===arr.indexOf(e.userStatus))return arr.push(e.userStatus),e}),self.filterOptions.titleFilters=titleFilters.unique();for(var zz=0;zz<tagsFilter.length;zz++)-1===self.filterOptions.tagList.indexOf(tagsFilter[zz])&&self.filterOptions.tagList.push(tagsFilter[zz]);arr=[];for(var abc=0;abc<rolesFilter.length;abc++)arr[rolesFilter[abc].id]=rolesFilter[abc];for(var key1 in arr)self.filterOptions.hiringRole.push(arr[key1])}function init(){$localStorage.remove("fromCompare"),archiveService.getAll().then(function(response){self.masterMemberList=response,self.memberList=angular.copy(self.masterMemberList),memberOperation(response.memberList),scope.$parent.activeView=attrs.activeView,$localStorage.set("activeView",scope.$parent.activeView)})}var self=scope;self.responseAvailable=!1,self.masterMemberList=[],self.memberList=[],self.negative=!1,self.checkedAll=!1,self.userInfo=$localStorage.get("loggegdInProfile"),self.isAccountAdmin=-1!==self.userInfo.member.roles.indexOf("AccountAdministrator"),self.candidateRoles=[],self.selectedObj=null,self.filterOptions={tagList:[],hiringRole:[],userStatus:[],titleFilters:[]},self.pageSetting={pageSize:10,lastPredicate:"lastName",lastReverse:!1,disabledInfinite:!1,dateRangeSelected:!1,textSearching:"",updateSearchText:"",user:[],selectedTitles:[],searchTitlesFilter:"",searchTag:[],heightParam:800,userRoleSelected:[],searchRoleFilters:[],userStatusSelected:[],candidateFlag:!1,employeeFlag:!1,hiredFlag:!1},self.selfEmail="",self.noteObj={userId:null,comment:null,cid:null},self.noteSubmitted=!1,self.newDt=new Date,self.filterToDate=null,self.filterFromDate=null,self.dateFilterCheck=!1,self.dateErrorFrom=!1,self.dateErrorTo=!1,self.dateRangeFilter=null,self.masterCopy=!0,self.pageType="Archives",self.selectedFilterList=[],self.originalpageSetting=angular.copy(self.pageSetting),self.updateSearchVal=function(searchTxt){self.pageSetting.updateSearchText=void 0!==searchTxt&&""!==searchTxt?window.escape(searchTxt):""},self.resetUpdatedSearchVal=function(){self.pageSetting.updateSearchText=""},self.checkAll=function(checked){self.negative?self.pageSetting.user=self.memberList.map(function(item){return{userId:item.id,email:item.email,name:item.name,title:item.title}}):self.pageSetting.user=[]},self.checkCount=function(checked){var userLength=self.pageSetting.user.length;checked&&userLength+1===self.memberList.length?self.negative=!0:self.negative=!1},self.returnMemberList=function(pageSize){if(!self.masterMemberList.length)return self.memberList=angular.copy(self.masterMemberList),!0;self.pageSetting.pageSize=self.originalpageSetting.pageSize,self.pageSetting.disabledInfinite=!1;var result=self.masterCopy?self.masterMemberList:self.memberList;self.memberList=result.filter(function(e){return(self.pageSetting.candidateFlag&&"HiringCandidate"===e.type||!self.pageSetting.candidateFlag&&e)&&(self.pageSetting.employeeFlag&&"Member"===e.type||!self.pageSetting.employeeFlag&&e)&&(!1!==self.pageSetting.dateRangeSelected&&filterWithDateRange(e.dateToShow)||!1===self.pageSetting.dateRangeSelected&&e)&&(self.pageSetting.selectedTitles.length&&-1!==self.pageSetting.selectedTitles.indexOf(e.title)||!self.pageSetting.selectedTitles.length&&e)&&(self.pageSetting.userStatusSelected.length&&-1!==self.pageSetting.userStatusSelected.indexOf(e.userStatus)||!self.pageSetting.userStatusSelected.length&&e)&&(!1!==self.pageSetting.hiredFlag&&e.hired||!1===self.pageSetting.hiredFlag&&e)&&(self.pageSetting.userRoleSelected.length&&filterRoles(e.hiringRoles)||!self.pageSetting.userRoleSelected.length&&e)&&(self.pageSetting.searchTag.length&&filterInArray(self.pageSetting.searchTag,null===e.tagList?[]:e.tagList)||!self.pageSetting.searchTag.length&&e)&&sharedProperties.singleElementSearch(self.pageSetting.textSearching,e,2)||self.pageSetting.candidateFlag&&self.pageSetting.employeeFlag&&!1===self.pageSetting.dateRangeSelected&&e||self.pageSetting.candidateFlag&&self.pageSetting.employeeFlag&&!1!==self.pageSetting.dateRangeSelected&&filterWithDateRange(e.dateToShow)}),order(self.pageSetting.lastPredicate,self.pageSetting.lastReverse),self.pageSetting.user.length!==self.memberList.length&&(self.negative=!1),self.masterCopy=!0},self.active=function(event,setting){self.pageSetting.lastPredicate=setting.predicate,self.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.pageSetting.lastPredicate),order(self.pageSetting.lastPredicate,self.pageSetting.lastReverse)},self.manageFilterDisplayList=function(filterSetting){var existing=$.inArray(filterSetting,self.selectedFilterList),isArray=$.isArray(self.pageSetting[filterSetting]),settingLength=self.pageSetting[filterSetting]?self.pageSetting[filterSetting].length:0,settingFlag=self.pageSetting[filterSetting];isArray&&settingLength>0?-1===existing&&self.selectedFilterList.push(filterSetting):isArray&&0===settingLength?-1!==existing&&self.selectedFilterList.splice(existing,1):isArray||!1===settingFlag||/false/.test(settingFlag)?isArray||!1!==settingFlag&&!/false/.test(settingFlag)||-1!==existing&&self.selectedFilterList.splice(existing,1):-1===existing&&self.selectedFilterList.push(filterSetting)},self.includeDateCheck=function(fromDt,toDt,flag){self.dateErrorFrom=!1,self.dateErrorTo=!1,!flag||self.dateErrorFrom||self.dateErrorTo?(self.pageSetting.dateRangeSelected=!1,self.manageFilterDisplayList("dateRangeSelected")):(self.pageSetting.dateRangeSelected=!0,self.manageFilterDisplayList("dateRangeSelected")),self.negative=!1,self.pageSetting.user=[],self.returnMemberList(self.pageSetting.pageSize)},self.infinteScroll=function(pageSize){self.pageSetting.disabledInfinite||(self.pageSetting.pageSize=pageSize,pageSize>=self.masterMemberList.length&&(self.pageSetting.disabledInfinite=!0,self.pageSetting.pageSize=self.masterMemberList.length))};var prepareDatePicker=function(){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),self.filterFromDate=moment().subtract(30,"days").format("MM/DD/YYYY"),self.filterToDate=moment().format("MM/DD/YYYY"),self.dateIntitator()};self.dateIntitator=function(){var ipadView=$(window).width()>767&&$(window).width()<1025;$('input[name="dateRangeFilter"]').daterangepicker({showDropdowns:!1,maxDate:moment(),startDate:moment().subtract(30,"days").toDate(),endDate:moment(),locale:{format:ipadView?"MM/DD/YY":"MMM DD, YYYY"},alwaysShowCalendars:!0,autoApply:!0,opens:"right"},function(start,end,label){scope.$apply(function(){self.filterFromDate=start.format("MM/DD/YYYY"),self.filterToDate=end.format("MM/DD/YYYY")})})},self.includeCheck=function(param,setting,cache){var i=$.inArray(param,self.pageSetting[setting]);i>-1?self.pageSetting[setting].splice(i,1):(self.pageSetting[setting].push(param),self.masterCopy=!cache),self.manageFilterDisplayList(setting),self.negative=!1,self.pageSetting.user=[],self.returnMemberList(self.pageSetting.pageSize)},self.hiredFilterCheck=function(){self.pageSetting.hiredFlag=!self.pageSetting.hiredFlag,self.returnMemberList(self.pageSetting.pageSize)},self.closeRest=function(index,noScroll){var val=void 0===noScroll?0:1;$(".accordian-checkbox").each(function(i){i!==$(index.currentTarget.parentNode).index()-val&&$(this).prop("checked",!0)})},self.clear=function(classS,property,search){self.pageSetting[property]=[],self.manageFilterDisplayList(property),void 0!==search&&(self.pageSetting[search]=""),$(classS).each(function(v,i){$(this).prop("checked",!1)}),"userStatusSelected"===property&&(self.pageSetting.hiredFlag=!1),self.returnMemberList()},self.candidateChecked=function(){!self.pageSetting.candidateFlag&&self.pageSetting.employeeFlag&&self.clear(".groupCheckBox","userRoleSelected","searchRoleFilters"),self.pageSetting.candidateFlag&&!self.pageSetting.employeeFlag&&self.clear(".titlesCheckBox","selectedTitles","searchTitlesFilter"),self.returnMemberList(self.pageSetting.pageSize)},self.employeeChecked=function(){!self.pageSetting.employeeFlag&&self.pageSetting.candidateFlag&&self.clear(".titlesCheckBox","selectedTitles","searchTitlesFilter"),self.pageSetting.employeeFlag&&!self.pageSetting.candidateFlag&&self.clear(".groupCheckBox","userRoleSelected","searchRoleFilters"),self.returnMemberList(self.pageSetting.pageSize)},self.calculateHeight=function(event){var obj=$("#"+event);obj.height()>self.pageSetting.heightParam&&obj.addClass("scroller")},self.viewMemberDetails=function(userId){$localStorage.set("empUserId",userId),$localStorage.set("archiveUser",!0),sharedProperties.fireAnalyticsEvent("PA | Archives View Portrait","N/A"),scope.$parent.updateView("archiveDetailsModule",!1)},self.goToRoleView=function(userId,email){$localStorage.set("empUserId",userId),$localStorage.set("archiveUser",!0),$localStorage.set("roleView",!0),scope.$parent.updateView("employeeDetailsModule",!1,email)},self.compareMember=function(email){scope.$parent.updateView("employeeCompare",!1,email)},self.notePopup=function(member){self.selectedMemberInfo=member,self.noteObj.userId=member.id,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.addNote,scope:self})},self.postNote=function(){self.noteSubmitted=!0,null!==self.noteObj.comment&&""!==self.noteObj.comment&&memberService.addNote(self.noteObj).then(function(response){"true"===response.Success?(self.noteSubmitted=!1,ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("notes.ajaxMessage.noteSaved"))):null!==response.error&&(self.noteSubmitted=!1,ngDialog.close(),sharedProperties.ajaxError(response.error))})},self.deleteModalSingle=function(member){self.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteEmployeeSingle,scope:self})},self.deleteModalMultiple=function(){ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteEmployeeMultiple,scope:self})},self.deleteSingle=function(userId){var selectedUsersIds=[];selectedUsersIds.push(userId),self.deleteCall(selectedUsersIds)},self.deleteMultiMembers=function(){for(var selectedUsersIds=[],i=0;i<self.pageSetting.user.length;i++)selectedUsersIds.push(self.pageSetting.user[i].userId);self.deleteCall(selectedUsersIds)},self.deleteCall=function(selectedUsersIds){archiveService.deleteMember(selectedUsersIds).then(function(response){if("true"===response.Success){var templList=angular.copy(self.masterMemberList),tempList0=[];$.each(templList,function(i,j){-1===$.inArray(templList[i].id,selectedUsersIds)&&tempList0.push(templList[i])}),self.masterMemberList=angular.copy(tempList0),self.negative=!1,self.pageSetting.user=[],self.returnMemberList(self.pageSetting.pageSize),spValue.getAllArchive=angular.copy(self.masterMemberList),ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("manageAccountContent.memberDeleted")),sharedProperties.fireAnalyticsEvent("PA | Archives Delete","N/A")}else null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})},self.putBackPop=function(member){self.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.archiveService.dialog.putBack,scope:self})},self.putBack=function(userId){var selectedUsersIds=[];selectedUsersIds.push(userId),archiveService.putBack(selectedUsersIds).then(function(response){if("true"===response.Success){var templList=angular.copy(self.masterMemberList),tempList0=[];$.each(templList,function(i,j){-1===$.inArray(templList[i].id,selectedUsersIds)&&tempList0.push(templList[i])}),self.masterMemberList=angular.copy(tempList0),self.negative=!1,self.pageSetting.user=[],self.returnMemberList(self.pageSetting.pageSize),spValue.getAllArchive=angular.copy(self.masterMemberList),ngDialog.close(),"Member"===self.selectedMemberInfo.type?(spValue.getAllEmployees=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.employeedMoved"))):(spValue.getAllCandidates=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidatesMoved"))),sharedProperties.fireAnalyticsEvent("PA | Archives Move Members",self.selectedMemberInfo.type)}else null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})},init()}}}]);
angular.module("spApp").directive("candidatesList",["spConfig","ajaxService","sharedProperties","commonService","spValue","ngDialog","$filter","$localStorage","memberService","$q","$timeout","$rootScope","rolesService","groupsService","idealPortraitService",function(spConfig,ajaxService,sharedProperties,commonService,spValue,ngDialog,$filter,$localStorage,memberService,$q,$timeout,$rootScope,rolesService,groupsService,idealPortraitService){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/people-analytics/"+attrs.urlSrc},link:function(scope,element,attrs){function order(predicate,reverse){vm.pageSetting.lastPredicate=predicate,vm.pageSetting.lastReverse=reverse;var orderedList=$filter("orderBy")(vm.memberList,vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse);vm.memberList=function(array,key){if("lastName"===key){for(var list=[],empty=[],i=0;i<array.length;i++)null!==array[i][key]&&""!==array[i][key]&&void 0!==array[i][key]?list.push(array[i]):empty.push(array[i]);return $.merge(list,empty)}return orderedList}(orderedList,vm.pageSetting.lastPredicate)}function filterWithDateRange(createdDate){if(null===createdDate)return!1;var createDt=createdDate[1]+"/"+createdDate[2]+"/"+createdDate[0];return moment(createDt,"MM/DD/YYYY").isBetween(moment(vm.filterFromDate,"MM/DD/YYYY"),moment(vm.filterToDate,"MM/DD/YYYY"),"days","[]")}function filterRoles(roles){return null!==roles&&roles.some(function(obj){return-1!==vm.pageSetting.userRoleSelected.indexOf(obj.id)})}function filterByGroups(groupObj){return null!==groupObj&&groupObj.some(function(obj){return-1!==vm.pageSetting.userGroupSelected.indexOf(obj.name)})}function filterInArray(tags,array){return array.some(function(v){return-1!==tags.indexOf(v)})}function subscriptionCount(countExceedCheck){memberService.getSubcription().then(function(response){vm.subscriptionCount=response.availableHiringSubscripitons,countExceedCheck&&!vm.subscriptionCount&&void 0!==vm.addCandidate&&(vm.addCandidate.emailErrors.countExceed=!0)})}function memberOperation(response){getFilterValue(),subscriptionCount(),idealPortraitService.getAll().then(function(response){if(null===response)return!0;vm.portraitsListing=response}),null!==vm.filterStatusEnabled&&(vm.pageSetting.userStatusSelected.push(vm.filterStatusEnabled),vm.filterStatusEnabled=null,$("#statusCheck").removeAttr("checked")),vm.returnMemberList(vm.pageSetting.pageSize),null!==sharedProperties.getParam("add")&&(vm.initAddCandidate(),vm.candidateRoles=[],vm.candidateTags=[],vm.candidateEmails=[]),vm.pageReady=!0,$localStorage.remove("archiveUser"),$timeout(function(){prepareDatePicker()},200)}function getFilterValue(){var userStatus=[],titleFilters=[],rolesFilter=[],groupsFilter=[],tagsFilter=[],arr=[];memberService.getRolesAndTag().then(function(response){vm.filterOptions.masterTagList=response.tagList,vm.filterOptions.masterHiringRole=response.hiringRoles});for(var i=0;i<vm.masterMemberList.length;i++){if(null!==vm.masterMemberList[i].title&&titleFilters.push(vm.masterMemberList[i].title),null!==vm.masterMemberList[i].userStatus&&userStatus.push({userStatus:vm.masterMemberList[i].userStatus,userFormatted:vm.masterMemberList[i].userStatusFormatted}),!angular.isArray(vm.masterMemberList[i].hiringCoordinatorIds)&&(vm.masterMemberList[i].hiringCoordinatorIds=[]),-1!==vm.masterMemberList[i].hiringCoordinatorIds.indexOf(vm.userInfo.member.id)&&vm.candidateCount++,null!==vm.masterMemberList[i].groups)for(var j=0;j<vm.masterMemberList[i].groups.length;j++)groupsFilter.push(vm.masterMemberList[i].groups[j]);if(null!==vm.masterMemberList[i].tagList)for(var k=0;k<vm.masterMemberList[i].tagList.length;k++)tagsFilter.push(vm.masterMemberList[i].tagList[k]);if(null!==vm.masterMemberList[i].hiringRoles&&void 0!==vm.masterMemberList[i].hiringRoles)for(var xyz=0;xyz<vm.masterMemberList[i].hiringRoles.length;xyz++)rolesFilter.push(vm.masterMemberList[i].hiringRoles[xyz])}vm.filterOptions.userStatus=userStatus.filter(function(e){if(-1===arr.indexOf(e.userStatus))return arr.push(e.userStatus),e}),vm.filterOptions.titleFilters=titleFilters.unique(),arr=[];for(var kk=0;kk<groupsFilter.length;kk++)arr[groupsFilter[kk].id]=groupsFilter[kk];for(var key in arr)vm.filterOptions.allGroupsFilter.push(arr[key]);for(var zz=0;zz<tagsFilter.length;zz++)-1===vm.filterOptions.tagList.indexOf(tagsFilter[zz])&&vm.filterOptions.tagList.push(tagsFilter[zz]);arr=[];for(var abc=0;abc<rolesFilter.length;abc++)arr[rolesFilter[abc].id]=rolesFilter[abc];for(var key1 in arr)vm.filterOptions.hiringRole.push(arr[key1])}function resetHireForm(obj){vm.addCandidate=angular.copy(newCandidate),vm.hireSubmitted=!1,vm.existingCandidate=!1,void 0!==obj&&(vm.addCandidate.hiringValues.firstName=obj.firstName,vm.addCandidate.hiringValues.lastName=obj.lastName,vm.addCandidate.hiringValues.email=obj.email,vm.addCandidate.hiringValues.title=obj.title,vm.addCandidate.hiringValues.id=obj.id)}function updateUserSelectedTags(){if(null!==vm.selectedMemberInfo.tagList&&void 0!==vm.selectedMemberInfo.tagList)for(var i=0;i<vm.selectedMemberInfo.tagList.length;i++)vm.userSelectedTags.push(vm.selectedMemberInfo.tagList[i]),vm.displayTags.push(vm.selectedMemberInfo.tagList[i])}function init(){null!==$localStorage.get("accountRequest")&&sharedProperties.growlMessage($rootScope.pullInterNationalization($localStorage.get("accountRequest"))),$localStorage.remove("accountRequest","fromCompare"),memberService.getAllCandidates().then(function(response){vm.masterMemberList=response,vm.memberList=angular.copy(vm.masterMemberList),memberOperation(response.memberList),scope.$parent.activeView=attrs.activeView,$localStorage.set("activeView",scope.$parent.activeView)})}var vm=scope;vm.pageReady=!1;var width=$(window).width();vm.mobile=width<1100,vm.masterMemberList=[],vm.memberList=[],vm.memberType="HiringCandidate",vm.addCandidateViewFlag=!!sharedProperties.getParam("add")||!1,vm.filterStatusEnabled=sharedProperties.getParam("userStatus"),vm.initLoad=!1,vm.masterCopy=!0,vm.negative=!1,vm.checkedAll=!1,vm.userInfo=$localStorage.get("loggegdInProfile"),vm.isAccountAdmin=-1!==vm.userInfo.member.roles.indexOf("AccountAdministrator"),vm.showAddReference=!1,vm.candidateRoles=[],vm.candidateTags=[],vm.candidateEmails=[],vm.candidateCount=0,vm.selectedObj=null,vm.filterOptions={tagList:[],hiringRole:[],allGroupsFilter:[],userStatus:[],titleFilters:[],allName:[],masterHiringRole:[],masterTagList:[]},vm.addRolesCollector={existingRole:[],newRole:[]};var newCandidate={referenceRequest:{start:1,max:3,value:[!1,!1,!1]},referenceArray:["manager","colleague_peer","direct_report","professor","advisor_coach","client_customer"],emailErrors:{isExisting:!1,isInvalid:!1,required:!1,countExceed:!1,dateCheck:!1,roleRequired:!1,subscriptionCount:null},hiringValues:{firstName:null,lastName:null,email:null,title:null,id:null},formValues:{emails:[],dueBy:null,dueDisplayed:null,tags:[],type:"HiringCandidate",roleIds:[],referenceTypes:[],referenceCheck:!1,tagList:[]}};vm.shareProfileObj={},vm.pageSetting={pageSize:10,lastPredicate:"lastName",lastReverse:!1,disabledInfinite:!1,dateRangeSelected:!1,textSearching:"",updateSearchText:"",user:[],searchGroupsFilters:[],userGroupSelected:[],selectedTitles:[],searchTitlesFilter:"",searchTag:[],heightParam:800,userRoleSelected:[],searchRoleFilters:[],userStatusSelected:[],myCandidate:!1},vm.selfEmail="",vm.noteObj={userId:null,comment:null,cid:null},vm.noteSubmitted=!1,vm.hireSubmitted=!1,vm.existingCandidate=!1,vm.newDt=new Date,vm.filterToDate=null,vm.filterFromDate=null,vm.dateFilterCheck=!1,vm.dateErrorFrom=!1,vm.dateErrorTo=!1,vm.dateRangeFilter=null,vm.selectedFilterList=[],vm.userSelectedTags=[],vm.displayTags=[],vm.pageType="Candidate",vm.originalpageSetting=angular.copy(vm.pageSetting),vm.portraitSearch="",vm.portraitsListing=[],vm.viewPortraitFlag=!1,vm.selectedPortrait={},vm.selectedUserPortrait={},vm.currentPageUrl=window.location.href,vm.salesForceForm=!1,vm.requestAccounts=0,vm.requestType="",vm.candidateImage=spConfig.image.candidateDefault,window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),vm.sendEmailReminders=function(memberList){commonService.sendEmail(memberList.userStatus,memberList.id).then(function(response){if(null===response)return!0;sharedProperties.fireAnalyticsEvent("PA | Candidate send reminder","N/A"),memberList.lastRemindedOn=[moment().format("Y"),moment().format("M"),moment().format("D")]})},vm.updateSearchVal=function(searchTxt){vm.pageSetting.updateSearchText=void 0!==searchTxt&&""!==searchTxt?window.escape(searchTxt):""},vm.resetUpdatedSearchVal=function(){vm.pageSetting.updateSearchText=""},vm.checkAll=function(checked){vm.negative?vm.pageSetting.user=vm.memberList.map(function(item){return{userId:item.id,email:item.email,name:item.name,title:item.title}}):vm.pageSetting.user=[]},vm.checkCount=function(checked){var userLength=vm.pageSetting.user.length;checked&&userLength+1===vm.memberList.length?vm.negative=!0:vm.negative=!1},vm.returnMemberList=function(pageSize){if(vm.initLoad&&(vm.addCandidateViewFlag=!1),vm.initLoad=!0,!vm.masterMemberList.length)return vm.memberList=angular.copy(vm.masterMemberList),!0;vm.pageSetting.pageSize=vm.originalpageSetting.pageSize,vm.pageSetting.disabledInfinite=!1;var result=vm.masterCopy?vm.masterMemberList:vm.memberList;vm.memberList=result.filter(function(e){return(vm.pageSetting.myCandidate&&void 0!==e.hiringCoordinatorIds&&-1!==e.hiringCoordinatorIds.indexOf(vm.userInfo.member.id)||!vm.pageSetting.myCandidate&&e)&&(!1!==vm.pageSetting.dateRangeSelected&&filterWithDateRange(e.dateToShow)||!1===vm.pageSetting.dateRangeSelected&&e)&&(vm.pageSetting.userGroupSelected.length&&filterByGroups(e.groups)||!vm.pageSetting.userGroupSelected.length&&e)&&(vm.pageSetting.selectedTitles.length&&-1!==vm.pageSetting.selectedTitles.indexOf(e.title)||!vm.pageSetting.selectedTitles.length&&e)&&(vm.pageSetting.userStatusSelected.length&&-1!==vm.pageSetting.userStatusSelected.indexOf(e.userStatus)||!vm.pageSetting.userStatusSelected.length&&e)&&(vm.pageSetting.userRoleSelected.length&&filterRoles(e.hiringRoles)||!vm.pageSetting.userRoleSelected.length&&e)&&(vm.pageSetting.searchTag.length&&filterInArray(vm.pageSetting.searchTag,null===e.tagList?[]:e.tagList)||!vm.pageSetting.searchTag.length&&e)&&sharedProperties.singleElementSearch(vm.pageSetting.textSearching,e,2)}),order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse),vm.pageSetting.user.length!==vm.memberList.length&&(vm.negative=!1),vm.masterCopy=!0},vm.active=function(event,setting){vm.pageSetting.lastPredicate=setting.predicate,vm.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.pageSetting.lastPredicate),order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)},vm.manageFilterDisplayList=function(filterSetting){var existing=$.inArray(filterSetting,vm.selectedFilterList),isArray=$.isArray(vm.pageSetting[filterSetting]),settingLength=vm.pageSetting[filterSetting]?vm.pageSetting[filterSetting].length:0,settingFlag=vm.pageSetting[filterSetting];isArray&&settingLength>0?-1===existing&&vm.selectedFilterList.push(filterSetting):isArray&&0===settingLength?-1!==existing&&vm.selectedFilterList.splice(existing,1):isArray||!1===settingFlag||/false/.test(settingFlag)?isArray||!1!==settingFlag&&!/false/.test(settingFlag)||-1!==existing&&vm.selectedFilterList.splice(existing,1):-1===existing&&vm.selectedFilterList.push(filterSetting)},vm.includeDateCheck=function(fromDt,toDt,flag){vm.dateErrorFrom=!1,vm.dateErrorTo=!1,!flag||vm.dateErrorFrom||vm.dateErrorTo?(vm.pageSetting.dateRangeSelected=!1,vm.manageFilterDisplayList("dateRangeSelected")):(vm.pageSetting.dateRangeSelected=!0,vm.manageFilterDisplayList("dateRangeSelected")),vm.negative=!1,vm.pageSetting.user=[],vm.returnMemberList(vm.pageSetting.pageSize)},vm.infinteScroll=function(pageSize){vm.pageSetting.disabledInfinite||(vm.pageSetting.pageSize=pageSize,pageSize>=vm.masterMemberList.length&&(vm.pageSetting.disabledInfinite=!0,vm.pageSetting.pageSize=vm.masterMemberList.length))},vm.addCandidateview=function(){vm.addCandidateViewFlag=!vm.addCandidateViewFlag,vm.addCandidateViewFlag&&vm.initAddCandidate(),vm.candidateRoles=[],vm.candidateTags=[],vm.candidateEmails=[]},vm.initAddCandidate=function(){subscriptionCount(),vm.addCandidate=angular.copy(newCandidate),vm.overlayDim={width:$(".new-cols.content-col").width(),height:$(".new-cols.content-col").height()}},vm.dateMortal=function(){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),$('input[name="endDate"]').daterangepicker({showDropdowns:!1,minDate:moment(),locale:{format:"MM/DD/YYYY"},alwaysShowCalendars:!0,singleDatePicker:!0,autoUpdateInput:!1,opens:"right"},function(start,end,label){scope.$apply(function(){vm.addCandidate.formValues.dueBy=start.format("MM/DD/YYYY"),vm.addCandidate.formValues.dueDisplayed=start.format("MM/DD/YYYY")})})},vm.tagAdded=function(tag,format){void 0!==tag[format.obj]&&(vm.addCandidate.formValues[format.store].push(tag[format.obj].replace(/\n/gi,"")),vm.inputRequired=!1)},vm.tagRemoved=function(tag,format){vm.addCandidate.formValues[format.store].splice(vm.addCandidate.formValues[format.store].indexOf(tag[format.obj].replace(/\n/gi,"")),1)},vm.loadSource=function(query,format,obj){for(var deferred=$q.defer(),result=[],toggle=vm.filterOptions[format],i=0;i<toggle.length&&result.length<5;i++)void 0!==obj&&-1!==toggle[i][obj].toLowerCase().indexOf(query.toLowerCase())?result.push(toggle[i]):void 0===obj&&-1!==toggle[i].toLowerCase().indexOf(query.toLowerCase())&&result.push(toggle[i]);return deferred.resolve(result),deferred.promise},vm.tagShareAdded=function(tag){tag.email=tag.email.toLowerCase(),vm.shareLinkEmail=tag},vm.tagShareRemoved=function(tag){vm.shareLinkEmail=null},vm.loadNames=function(query){for(var deferred=$q.defer(),result=[],i=0;i<vm.employeeList.length&&result.length<5;i++)if("VALID"===vm.employeeList[i].userStatus&&(-1!==vm.employeeList[i].name.toLowerCase().indexOf(query.toLowerCase())||-1!==vm.employeeList[i].email.toLowerCase().indexOf(query.toLowerCase()))){for(var j=0,count=0;j<vm.feedbackUser.length;j++)vm.feedbackUser[j].email===vm.employeeList[i].email&&count++;0===count&&result.push(vm.employeeList[i])}return deferred.resolve(result),deferred.promise},vm.addNewCandidate=function(){var list=$(".tagsTextarea").find(".tag-list");if(list.find(".tag-item").removeClass("invalid-tag"),vm.addCandidate.emailErrors=angular.copy(newCandidate.emailErrors),vm.addCandidate.formValues.emails.length||(vm.addCandidate.emailErrors.required=!0),vm.addCandidate.formValues.emails.length>vm.subscriptionCount&&(vm.addCandidate.emailErrors.countExceed=!0),vm.addCandidate.formValues.roleIds.length||(vm.addCandidate.emailErrors.roleRequired=!0),null===vm.addCandidate.formValues.dueDisplayed&&(vm.addCandidate.emailErrors.dateCheck=!0),!0===vm.addCandidate.emailErrors.required||!0===vm.addCandidate.emailErrors.countExceed||!0===vm.addCandidate.emailErrors.roleRequired||!0===vm.addCandidate.emailErrors.dateCheck)return!0;vm.addCandidate.formValues.referenceTypes.length&&(vm.addCandidate.formValues.referenceTypes=vm.addCandidate.formValues.referenceTypes.filter(function(e){return e.length})),memberService.isMemberPresent({candidateEmail:vm.addCandidate.formValues.emails.toString()}).then(function(response){if(null!==response.Success&&void 0!==response.Success){var tempDt=moment(vm.addCandidate.formValues.dueDisplayed,"MM/DD/YYYY");vm.addCandidate.formValues.dueBy=[parseInt(tempDt.format("Y")),parseInt(tempDt.format("M")),parseInt(tempDt.format("D"))],memberService.addMember(vm.addCandidate.formValues).then(function(response){vm.addCandidate=angular.copy(newCandidate);for(var i=0;i<response.hiring.length;i++)vm.masterMemberList.push(response.hiring[i]);null!==response.error&&void 0!==response.error?(vm.addCandidate.emailErrors.subscriptionCount=response.error,vm.candidateRoles=[],vm.candidateEmails=[],vm.candidateTags=[],vm.initLoad=!1,subscriptionCount(!0)):subscriptionCount(),vm.returnMemberList(vm.pageSetting.pageSize),spValue.getAllMembersForGroups=[],$("html,body").animate({scrollTop:$(".candidates-list-container").offset().top-20},1e3),response.hiring.length&&sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateAdded")),sharedProperties.fireAnalyticsEvent("PA | Candidate Added","N/A")})}else{vm.existingUserEmailError=[];for(var i in response.error){vm.existingUserEmailError.push({name:i,msg:response.error[i]});var index=vm.addCandidate.formValues.emails.indexOf(i);-1!==index&&list.find('.tag-item:eq("'+index+'")').addClass("invalid-tag")}vm.addCandidate.emailErrors.isExisting=!0,$("html,body").animate({scrollTop:$(".tagsTextarea").offset().top-20},1e3)}})};var prepareDatePicker=function(){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),vm.filterFromDate=moment().subtract(30,"days").format("MM/DD/YYYY"),vm.filterToDate=moment().format("MM/DD/YYYY"),vm.dateIntitator()};vm.dateIntitator=function(){var ipadView=$(window).width()>767&&$(window).width()<1025;$('input[name="dateRangeFilter"]').daterangepicker({showDropdowns:!1,maxDate:moment(),startDate:moment().subtract(30,"days").toDate(),endDate:moment(),locale:{format:ipadView?"MM/DD/YY":"MMM DD, YYYY"},alwaysShowCalendars:!0,autoApply:!0,opens:"right"},function(start,end,label){scope.$apply(function(){vm.filterFromDate=start.format("MM/DD/YYYY"),vm.filterToDate=end.format("MM/DD/YYYY")})})},vm.includeCheck=function(param,setting,cache){var i=$.inArray(param,vm.pageSetting[setting]);i>-1?vm.pageSetting[setting].splice(i,1):(vm.pageSetting[setting].push(param),vm.masterCopy=!cache),vm.negative=!1,vm.pageSetting.user=[],vm.manageFilterDisplayList(setting),vm.returnMemberList(vm.pageSetting.pageSize)},vm.closeRest=function(index,noScroll){var val=void 0===noScroll?0:1;$(".accordian-checkbox").each(function(i){i!==$(index.currentTarget.parentNode).index()-val&&$(this).prop("checked",!0)})},vm.clear=function(classS,property,search){vm.pageSetting[property]=[],vm.manageFilterDisplayList(property),void 0!==search&&(vm.pageSetting[search]=""),$(classS).each(function(v,i){$(this).prop("checked",!1)}),vm.returnMemberList()},vm.calculateHeight=function(event){var obj=$("#"+event);obj.height()>vm.pageSetting.heightParam&&obj.addClass("scroller")},vm.sharePortrait=function(memberList){memberService.getShareId({userId:memberList.id}).then(function(response){if(null===response)return!0;vm.selectedMemberInfo=memberList,vm.shareProfileUrl=window.location.origin+"/sp/profilePublic/"+response.hiringPublicId,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.shareProfileId,scope:vm})})},vm.addMoreRequest=function(){vm.addCandidate.referenceRequest.start<=vm.addCandidate.referenceRequest.max&&(vm.addCandidate.referenceRequest.start=parseInt(vm.addCandidate.referenceRequest.start+1,10),vm.addCandidate.referenceRequest.value[vm.addCandidate.referenceRequest.start-1]=!0,vm.addCandidate.formValues.referenceTypes[vm.addCandidate.referenceRequest.start-1]=["manager","colleague_peer","direct_report","professor","advisor_coach","client_customer"],vm.checkAddReference())},vm.checkAddReference=function(){for(var j=0,count=0;j<vm.addCandidate.formValues.referenceTypes.length;j++)vm.addCandidate.formValues.referenceTypes[j].length>=1?count++:count--;vm.showAddReference=vm.addCandidate.referenceRequest.start<vm.addCandidate.referenceRequest.max&&count===vm.addCandidate.referenceRequest.start},vm.referenceToggleSelection=function(list,insert,active){var idx=-1;void 0===vm.addCandidate.formValues.referenceTypes[insert]?vm.addCandidate.formValues.referenceTypes.push([]):idx=vm.addCandidate.formValues.referenceTypes[insert].indexOf(list),idx>-1?vm.addCandidate.formValues.referenceTypes[insert].splice(idx,1):vm.addCandidate.formValues.referenceTypes[insert].push(list),vm.checkAddReference()},vm.referenceSelection=function(index){var value=vm.addCandidate.referenceRequest.value[index];!value&&vm.addCandidate.referenceRequest.start>1?(vm.addCandidate.formValues.referenceTypes.splice(index,1),vm.addCandidate.referenceRequest.start--,vm.addCandidate.referenceRequest.value.swapItems(index,vm.addCandidate.referenceRequest.start)):vm.addCandidate.formValues.referenceTypes[index]=value?["manager","colleague_peer","direct_report","professor","advisor_coach","client_customer"]:[],vm.checkAddReference()},vm.showNewRoleView=function(isEdit,roleDetails){vm.initAddRole();ngDialog.open({template:spConfig.talentAnalytics.roles.dialog.createRole,scope:vm})},vm.initAddRole=function(){vm.submitError=!1,vm.loadCreateRole=!0,vm.formSubmit=!1,vm.newRole={form:{},details:{description:"",portraitId:""}}},vm.createNewRole=function(isUpdate,isAdded){if(vm.formSubmit=!1,vm.submitError=!1,vm.newRole.form.$valid){if(void 0!==vm.newRole.details.portraitId&&void 0!==vm.newRole.details.portraitId.originalObject&&""!==vm.newRole.details.portraitId){var oldPortraitObject=angular.copy(vm.newRole.details.portraitId);vm.newRole.details.portraitId=vm.newRole.details.portraitId.originalObject.id}rolesService.createRole(vm.newRole.details,isUpdate).then(function(response){if("true"===response.Success)sharedProperties.fireAnalyticsEvent("PA | Candidate Create new Role","N/A"),void 0===isAdded?(vm.candidateRoles.push({id:response.hiringRole.id,name:response.hiringRole.name}),vm.addCandidate.formValues.roleIds.push(response.hiringRole.id)):vm.addRoleCall(response.hiringRole),void 0!==spValue.getAllRoles.hiringRoleListing&&spValue.getAllRoles.hiringRoleListing.unshift(response.hiringRole),vm.filterOptions.masterHiringRole.push({id:response.hiringRole.id,name:response.hiringRole.name}),vm.filterOptions.hiringRole.push({id:response.hiringRole.id,name:response.hiringRole.name}),ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.roleCreated"));else{var errorMessage="";for(var key in response.error)errorMessage=response.error[key];vm.submitError=errorMessage,vm.newRole.details.portraitId=angular.copy(oldPortraitObject)}})}else vm.formSubmit=!0},vm.switchType=function(type){if(vm.addRolesCollector.active===type)return!0;vm.addRolesCollector.active=type},vm.clearPortraitInputBox=function(){$(".autoCompleteCss").val(""),vm.newRole.details.portraitId=""},vm.addRole=function(memberObj,roles,active){vm.selectedObj=memberObj,!angular.isArray(roles)&&(roles=[]);for(var i=0,existingRoles=[];i<roles.length;i++)existingRoles.push(roles[i].id);vm.resetUpdatedSearchVal(),vm.addRolesCollector={existing:existingRoles,roleSearch:"",roleLeft:vm.filterOptions.masterHiringRole,types:["add","create"],active:"add"},void 0!==active&&(vm.addRolesCollector.active=active),ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.addRole,scope:vm})},vm.addRoleCall=function(roleObj){rolesService.addRole({userId:vm.selectedObj.id,roleId:roleObj.id}).then(function(response){if(null===response)return!0;for(var i=0;i<vm.masterMemberList.length;i++)if(vm.masterMemberList[i].id===vm.selectedObj.id){!angular.isArray(vm.masterMemberList[i].hiringRoles)&&(vm.masterMemberList[i].hiringRoles=[]),vm.masterMemberList[i].hiringRoles.push(roleObj);break}vm.addRolesCollector.existing.push(roleObj.id),vm.returnMemberList(vm.pageSetting.pageSize),sharedProperties.fireAnalyticsEvent("PA | Candidate Role added to User","N/A")})},vm.removeRoleCall=function(roleObj){rolesService.removeRole({userId:vm.selectedObj.id,roleId:roleObj.id}).then(function(response){if(null===response)return!0;for(var j=0;j<vm.masterMemberList.length;j++)if(vm.masterMemberList[j].id===vm.selectedObj.id)for(var k=0;k<vm.masterMemberList[j].hiringRoles.length;k++)if(vm.masterMemberList[j].hiringRoles[k].id===roleObj.id){vm.masterMemberList[j].hiringRoles.splice(k,1),vm.addRolesCollector.existing.splice(k,1);break}vm.returnMemberList(vm.pageSetting.pageSize),sharedProperties.fireAnalyticsEvent("PA | Candidate Role removed from User","N/A")})},vm.closeNewRoleView=function(){ngDialog.close("ngdialog1")},vm.viewMemberDetails=function(userId,type){$localStorage.set("empUserId",userId),void 0!==type&&sharedProperties.fireAnalyticsEvent("PA | Candidate View Portrait","N/A"),scope.$parent.updateView("employeeDetailsModule",!1)},vm.printPrimPortrait=function(memberObj){$localStorage.remove("printEmail","printName"),vm.profileDetails=[],memberService.getProfileInfo(memberObj.id,!1).then(function(response){if(null===response)return!0;vm.profileDetails=response.hiringUser,$localStorage.set(vm.profileDetails.email,response),$localStorage.set("printEmail",vm.profileDetails.email),$localStorage.set("printName",vm.profileDetails.firstName+" "+vm.profileDetails.lastName),$timeout(function(){var url="/sp/resources/html/common/prism-print-template.html?mode=print&email="+memberObj.email+"&fullName="+memberObj.firstName+" "+memberObj.lastName;window.open(url,"_blank"),window.focus()},100)})},vm.goToRoleView=function(userId,email){$localStorage.set("empUserId",userId),$localStorage.set("roleView",!0),scope.$parent.updateView("employeeDetailsModule",!1,email)},vm.compareMember=function(userId){memberService.getProfileInfo(userId,!1).then(function(response){$localStorage.set("activeEmp",response.hiringUser),sharedProperties.fireAnalyticsEvent("PA | Candidate Compare","N/A"),scope.$parent.updateView("employeeCompare",!1,response.hiringUser.email)})},vm.notePopup=function(member){vm.selectedMemberInfo=member,vm.noteObj.userId=member.id,vm.noteSubmitted=!1,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.addNote,scope:vm}).closePromise.then(function(){vm.noteObj.comment=""})},vm.postNote=function(){vm.noteSubmitted=!0,null!==vm.noteObj.comment&&""!==vm.noteObj.comment&&memberService.addNote(vm.noteObj).then(function(response){"true"===response.Success?(vm.noteSubmitted=!1,ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("notes.ajaxMessage.noteSaved")),sharedProperties.fireAnalyticsEvent("PA | Candidate Add Note","N/A")):null!==response.error&&(vm.noteSubmitted=!1,ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})},vm.deleteModalSingle=function(member){vm.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteEmployeeSingle,scope:vm})},vm.deleteModalMultiple=function(){ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteEmployeeMultiple,scope:vm})},vm.deleteSingle=function(userId){var selectedUsersIds=[];selectedUsersIds.push(userId),vm.deleteCall(selectedUsersIds)},vm.deleteMultiMembers=function(){for(var selectedUsersIds=[],i=0;i<vm.pageSetting.user.length;i++)selectedUsersIds.push(vm.pageSetting.user[i].userId);vm.deleteCall(selectedUsersIds)},vm.deleteCall=function(selectedUsersIds){memberService.deleteMember(selectedUsersIds).then(function(response){if("true"===response.Success){var templList=angular.copy(vm.masterMemberList),tempList0=[];$.each(templList,function(i,j){-1===$.inArray(templList[i].id,selectedUsersIds)?tempList0.push(templList[i]):void 0!==templList[i].hiringCoordinatorIds&&-1!==templList[i].hiringCoordinatorIds.indexOf(vm.userInfo.member.id)&&vm.candidateCount--}),vm.masterMemberList=angular.copy(tempList0),vm.negative=!1,vm.pageSetting.user=[],vm.returnMemberList(vm.pageSetting.pageSize),spValue.getAllCandidates=angular.copy(vm.masterMemberList),spValue.getAllMembersForGroups=[],ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateDeleted")),sharedProperties.fireAnalyticsEvent("PA | Candidate Deleted","N/A")}else null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})},vm.archiveModalSingle=function(member){vm.selectedMemberInfo=member,vm.userSelectedTags=[],vm.displayTags=[],updateUserSelectedTags(),ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.archiveEmployeeSingle,scope:vm})},vm.archiveModalMultiple=function(){ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.archiveEmployeeMultiple,scope:vm})},vm.archiveSingle=function(userId){var selectedUsersIds=[];selectedUsersIds.push(userId),vm.archiveCall(selectedUsersIds)},vm.archiveMultiMembers=function(){for(var selectedUsersIds=[],i=0;i<vm.pageSetting.user.length;i++)selectedUsersIds.push(vm.pageSetting.user[i].userId);vm.archiveCall(selectedUsersIds)},vm.archiveCall=function(selectedUsersIds){memberService.archiveUser(selectedUsersIds,vm.userSelectedTags.join()).then(function(response){if("true"===response.Success){var templList=angular.copy(vm.masterMemberList),tempList0=[];$.each(templList,function(i,j){-1===$.inArray(templList[i].id,selectedUsersIds)?tempList0.push(templList[i]):void 0!==templList[i].hiringCoordinatorIds&&-1!==templList[i].hiringCoordinatorIds.indexOf(vm.userInfo.member.id)&&vm.candidateCount--}),vm.masterMemberList=angular.copy(tempList0),vm.negative=!1,vm.pageSetting.user=[],vm.returnMemberList(vm.pageSetting.pageSize),spValue.getAllCandidates=angular.copy(vm.masterMemberList),spValue.getAllArchive=[],spValue.getAllMembersForGroups=[],ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateArchived")),sharedProperties.fireAnalyticsEvent("PA | Candidate Archived","N/A")}else null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})},vm.hiringDialogs=function(type,userObj){vm.addCandidate=angular.copy(newCandidate),vm.deleteMemberInfo=void 0!==userObj?userObj:{},"hire"===type?(resetHireForm(userObj),ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog[type],scope:vm})):ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog[type],scope:vm})},vm.hireCandidate=function(){vm.hireSubmitted=!1,vm.existingCandidate=!1,this.hireCandidateForm.$valid?memberService.hireCandidate({id:vm.addCandidate.hiringValues.id,firstName:vm.addCandidate.hiringValues.firstName,lastName:vm.addCandidate.hiringValues.lastName,title:vm.addCandidate.hiringValues.title,email:vm.addCandidate.hiringValues.email,tags:vm.addCandidate.formValues.tags.toString()}).then(function(response){if(void 0!==response.error&&null!==response.error){vm.existingCandidate=!0;var responses=response.error;for(var key in responses){vm.existingCandidateMessage=responses[key];break}vm.hireSubmitted=!0}else{ngDialog.close("ngdialog1"),vm.existingCandidate=!1;for(var i=0;i<vm.masterMemberList.length;i++)if(vm.masterMemberList[i].id===vm.addCandidate.hiringValues.id){void 0!==vm.masterMemberList[i].hiringCoordinatorIds&&-1!==vm.masterMemberList[i].hiringCoordinatorIds.indexOf(vm.userInfo.member.id)&&vm.candidateCount--,vm.masterMemberList.splice(i,1);break}spValue.getAllEmployees=[],spValue.getAllCandidates=angular.copy(vm.masterMemberList),vm.returnMemberList(vm.pageSetting.pageSize),subscriptionCount(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateHired")),sharedProperties.fireAnalyticsEvent("PA | Candidate Hired","N/A")}}):vm.hireSubmitted=!0},vm.shareProfile=function(memberList){memberService.getAllEmployees().then(function(response){vm.employeeList=response,memberService.getUserShareList({userId:memberList.id}).then(function(response){if(null===response)return!0;vm.selectedMemberInfo=memberList,vm.shareLinkEmail={},vm.shareLinkEmailForm={submitted:!1,required:!1,candidate:!1},vm.feedbackUser=response.feedbackUser,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.shareUserId,scope:vm})})})},vm.sharePortraitOtherFn=function(){if(vm.shareLinkEmailForm.submitted=!1,vm.shareLinkEmailForm.candidate=!1,vm.shareLinkEmailForm.required=!1,void 0===vm.shareLinkEmail.email)return vm.shareLinkEmailForm.required=!0,void(vm.shareLinkEmailForm.submitted=!0);this.shareApprovalForm.$valid?memberService.shareUserProfile({
firstName:vm.shareLinkEmail.firstName,lastName:vm.shareLinkEmail.lastName,email:vm.shareLinkEmail.email,userFor:vm.selectedMemberInfo.id}).then(function(response){if(void 0!==response.error&&null!==response.error)return!0;vm.feedbackUser.push(response.feedbackUser),ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.portraitShared")),sharedProperties.fireAnalyticsEvent("PA | Candidate Share Profile","N/A")}):vm.shareLinkEmailForm.submitted=!0},vm.feedbackUserRemovedDialog=function(member){vm.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteEmployeeSingle,scope:vm})},vm.feedbackUserRemoved=function(userId){memberService.shareFeedbackRemoved({userId:userId}).then(function(response){for(var i=0;i<vm.feedbackUser.length;i++)if(vm.feedbackUser[i].id===userId){vm.feedbackUser.splice(i,1),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.portraitSharedRemoved"));break}})},vm.sendProfilePortrait=function(){commonService.sendEmail({type:"HiringSharePortrait"},vm.selectedMemberInfo.id).then(function(response){if(ngDialog.close("ngdialog1"),sharedProperties.fireAnalyticsEvent("PA | Candidate share portrait","N/A"),null===response)return!0})},vm.addedTag=function(tag){vm.userSelectedTags.push(tag.text)},vm.removedTag=function(tag){vm.userSelectedTags.splice(vm.userSelectedTags.indexOf(tag.text),1)},vm.loadSourceTags=function(query){var deferred=$q.defer(),result=vm.filterOptions.masterTagList.filter(function(e){return-1!==e.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise},vm.portraitsPop=function(member){vm.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.idealPortrait.dialog.portraitsList,scope:vm}).closePromise.then(function(){vm.portraitSearch=""})},vm.matchPortrait=function(id){var userIdsList=[];userIdsList.push(vm.selectedMemberInfo.id),idealPortraitService.matchPortrait({id:id,userIds:userIdsList.join(),groupIds:[]}).then(function(response){if(null===response)return!0;vm.selectedPortrait=response.portraitMatch.portrait,vm.selectedUserPortrait=response.portraitMatch.users[0],ngDialog.close(),sharedProperties.fireAnalyticsEvent("PA | Candidate Ideal portrait","N/A"),vm.viewPortraitFlag=!0,$("html,body").animate({scrollTop:$(".col-content-wrapper").offset().top-20},1e3)})},vm.closeReportView=function(){vm.viewPortraitFlag=!1,vm.selectedPortrait={},vm.selectedUserPortrait={}},vm.processAccountRequest=function(e,requestAccounts){vm.salesForceForm=!1,requestAccounts>0?(vm.salesForceForm=!1,$localStorage.set("accountRequest","manageAccountContent.requestSubmit"),sharedProperties.fireAnalyticsEvent("PA | Candidate Request more accounts","N/A")):(e.preventDefault(),vm.salesForceForm=!0)},vm.requestForAccounts=function(requestType){vm.requestAccounts=0,vm.requestType=requestType,vm.salesForceForm=!1,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.accountsRequest,scope:scope})},init()}}}]);
angular.module("spApp").directive("employeeDetail",["sharedProperties","memberService","commonService","$rootScope","spConfig","spValue","ngDialog","$filter","$localStorage","$q","groupsService","rolesService","archiveService","idealPortraitService",function(sharedProperties,memberService,commonService,$rootScope,spConfig,spValue,ngDialog,$filter,$localStorage,$q,groupsService,rolesService,archiveService,idealPortraitService){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/people-analytics/"+attrs.urlSrc},link:function(scope,element,attrs){function getAllTags(){memberService.getRolesAndTag().then(function(response){self.masterTagList=response.tagList})}function updateUserTags(){memberService.updateUserTags(self.activeUserId,self.userSelectedProfileTags.toString()).then(function(response){"true"===response.Success?"Member"===self.profileDetail.type?spValue.getAllEmployees=[]:spValue.getAllCandidates=[]:null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})}function getUserGroups(){groupsService.getGroup().then(function(response){self.masterGroupList=response,self.allGroups=angular.copy(self.masterGroupList),memberService.getUserGroups(self.activeUserId).then(function(response){self.userGroups=response.hiringGroup,$.each(self.allGroups,function(i,j){$.each(self.userGroups,function(k,l){if(void 0!==self.allGroups[i]&&self.allGroups[i].id===self.userGroups[k].id)return void self.allGroups.splice(i,1)})})})})}function resetHireForm(obj){self.addCandidate=angular.copy(newCandidate),self.hireSubmitted=!1,self.existingCandidate=!1,void 0!==obj&&(self.addCandidate.hiringValues.firstName=obj.firstName,self.addCandidate.hiringValues.lastName=obj.lastName,self.addCandidate.hiringValues.email=obj.email,self.addCandidate.hiringValues.title=obj.title,self.addCandidate.hiringValues.id=obj.id)}function subscriptionCount(){memberService.getSubcription().then(function(response){self.subscriptionCount=response.availableHiringSubscripitons})}function init(){null===self.activeUserId&&(scope.$parent.activeView="employeesModule"),memberService.getProfileInfo(self.activeUserId,self.archivedUser).then(function(response){self.profileDetail=response.hiringUser,(null===self.profileDetail.dob||void 0===self.profileDetail.dob)&&(self.profileDetail.dob=["","",""])&&(self.dobEmpty=!0),null===self.profileDetail.address&&(self.profileDetail.address={},self.profileDetail.address.zipCode="",self.profileDetail.address.city="",self.profileDetail.address.state="",self.profileDetail.address.addressLine1="",self.profileDetail.address.addressLine2="",self.profileDetail.address.country="US"),self.profileDetailBackup=angular.copy(self.profileDetail),$localStorage.set("mName",self.profileDetail.firstName+" "+self.profileDetail.lastName),"US"===self.profileDetail.address.country?self.showStatesUS=!0:"CA"===self.profileDetail.address.country?self.showStatesCanada=!0:self.showStatesOthers=!0,self.responseAvailable=!0,idealPortraitService.getAll().then(function(response){if(null===response)return!0;self.portraitsListing=response}),self.roleView?(self.memberNav="roles",self.archivedUser||self.getUserRolesAndMatch(),$localStorage.remove("roleView")):"VALID"===self.profileDetail.userStatus?(self.memberNav="prismPortrait","HiringCandidate"===self.profileDetail.type&&subscriptionCount()):"HiringCandidate"===self.profileDetail.type?(self.memberNav="roles",self.archivedUser||self.getUserRolesAndMatch()):(self.memberNav="groupsAndTags",getUserGroups(),getAllTags()),$localStorage.set(self.profileDetail.email,response),$localStorage.set("printEmail",self.profileDetail.email),$localStorage.set("printName",self.profileDetail.firstName+" "+self.profileDetail.lastName),$localStorage.set("activeEmp",self.profileDetail),self.archivedUser?(scope.$parent.previousView="archivesPAModule",$localStorage.set("activeView","archiveDetailsModule")):(null===scope.$parent.previousView&&("HiringCandidate"===self.profileDetail.type?scope.$parent.previousView="candidatesModule":scope.$parent.previousView="employeesModule"),$localStorage.set("activeView","employeeDetailsModule"))}),$("html,body").animate({scrollTop:$(".member-details-wrap").offset().top-40},1e3)}var self=scope;self.activeUserId=$localStorage.get("empUserId"),self.loggedInUser=$localStorage.get("loggegdInProfile"),self.archivedUser=null!==$localStorage.get("archiveUser"),self.noErti=null!==$localStorage.get("noErti"),self.roleView=null!==$localStorage.get("roleView"),self.memberType="Member",self.responseAvailable=!1,self.profileDetail={},self.memberNav="",self.showCreateGroupSection=!1,self.userGroups=[],self.groupObj={},self.allGroups=[],self.editProfile=!1,self.profileSubmitted=!1,self.profileDetailForm={},self.countries=$localStorage.get("countriesFullList").countries,self.showStatesUS=!1,self.showStatesCanada=!1,self.showStatesOthers=!1,self.todayDate=moment().format("MMM D, YYYY"),self.editedComment={comment:null,cid:null,userId:null},self.noteObj={userId:null,comment:null,cid:null},self.noteSubmitted=!1,self.noteUpdated=!1,self.activeNoteIndex=0,self.subscriptionCount=0,self.isSafari=!!navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i)&&void 0!==document.body.style.webkitFilter&&!window.chrome;var newCandidate={referenceRequest:{start:[0],max:2},referenceArray:["manager","colleague_peer","direct_report","professor","advisor_coach","client_customer"],emailErrors:{isExisting:!1,isInvalid:!1,required:!1,countExceed:!1,dateCheck:!1,roleRequired:!1},hiringValues:{firstName:null,lastName:null,email:null,title:null,id:null},formValues:{emails:[],dueBy:null,dueDisplayed:null,tags:[],type:"HiringCandidate",roleIds:[],referenceTypes:[],referenceCheck:!1,tagList:[]}};self.hireSubmitted=!1,self.existingCandidate=!1,self.masterTagList=[],self.userSelectedTags=[],self.displayTags=[],self.userSelectedProfileTags=[],self.masterCandidatesList=[],self.dobEmpty=!1,self.tagsVisited=!1,self.roleResponseAvailable=!1,self.viewPortraitFlag=!1,self.selectedPortrait={},self.selectedUserPortrait={},self.portraitSearch="",self.pageSetting={updateSearchText:""},self.portraitsListing=[],self.candidateExp={linkEditing:!1,webLink:null,linkSubmitted:!1,index:-1},self.attachmentObj={url:null,name:null,type:null};scope.$on("fileStackSuccessNotes",function(e,data){if(null===data)return!0;self.attachmentObj.url=data.fileData.url,self.attachmentObj.name=data.fileData.filename,self.attachmentObj.mediaType=sharedProperties.mapMediaType(data.fileData.mimetype),self.updateWebLink(self.attachmentObj.url,!1)});self.linkEdit=function(index,url){self.candidateExp.webLink=url,self.candidateExp.index=index,self.candidateExp.linkEditing=!1,self.candidateExp.linkSubmitted=!1},self.cancelEdit=function(){self.candidateExp.webLink=null,self.candidateExp.index=-1,self.candidateExp.linkSubmitted=!1},self.updateWebLink=function(fData,profile,index){if(self.candidateExp.linkSubmitted=!1,profile?fData.$valid:fData){self.candidateExp.linkSubmitted=!1;var spMedia={};profile?(spMedia={userId:self.activeUserId,url:fData.webLink.$modelValue,profileUrl:profile},void 0!==index&&(spMedia.index=index)):spMedia={userId:self.activeUserId,url:self.attachmentObj.url,name:self.attachmentObj.name,mediaType:self.attachmentObj.mediaType,profileUrl:profile},memberService.addUpdateUrl(spMedia).then(function(response){if(null===response)return!0;profile?(!angular.isArray(self.profileDetail.profileUrls)&&(self.profileDetail.profileUrls=[]),void 0!==index?(self.profileDetail.profileUrls[index].url=fData.webLink.$modelValue,self.cancelEdit()):self.profileDetail.profileUrls.push({url:fData.webLink.$modelValue}),sharedProperties.fireAnalyticsEvent("PA | Add Resume Link for User","N/A")):(!angular.isArray(self.profileDetail.urls)&&(self.profileDetail.urls=[]),self.profileDetail.urls.push(self.attachmentObj),sharedProperties.fireAnalyticsEvent("PA | Upload resume file for User","N/A")),self.attachmentObj={url:null,name:null,mediaType:null},self.candidateExp={linkEditing:!1,webLink:null,linkSubmitted:!1},sharedProperties.growlMessage(profile?$rootScope.pullInterNationalization("growl.experienceUpdated"):$rootScope.pullInterNationalization("growl.documentUpdated"))})}else self.candidateExp.linkSubmitted=!0},self.removeWebLink=function(profile,url){memberService.removeUrl({userId:self.activeUserId,url:url,profileUrl:profile}).then(function(response){if(null===response)return!0;if(profile){for(var ii=0;ii<self.profileDetail.profileUrls.length;ii++)if(self.profileDetail.profileUrls[ii].url===url){self.profileDetail.profileUrls.splice(ii,1);break}self.cancelEdit(),sharedProperties.fireAnalyticsEvent("PA | Remove Resume Link for User","N/A")}else{for(var i=0;i<self.profileDetail.urls.length;i++)if(self.profileDetail.urls[i].url===url){self.profileDetail.urls.splice(i,1);break}self.cancelEdit(),sharedProperties.fireAnalyticsEvent("PA | Remove resume file for User","N/A")}sharedProperties.growlMessage(profile?$rootScope.pullInterNationalization("growl.experienceRemoved"):$rootScope.pullInterNationalization("growl.documentRemoved"))})},self.closeMemberSection=function(){if($localStorage.remove("empUserId",self.profileDetail.email,"archiveUser","activeEmp","mName"),self.archivedUser)scope.$parent.updateView("archivesPAModule",!1);else if(null!==$localStorage.get("fromCompare")){var fromCompare=$localStorage.get("fromCompare");$localStorage.remove("fromCompare"),scope.$parent.updateView(fromCompare,!1)}else"HiringCandidate"===self.profileDetail.type?scope.$parent.updateView(scope.$parent.previousView||"candidatesModule",!1):scope.$parent.updateView(scope.$parent.previousView||"employeesModule",!1)},self.setActiveView=function(viewName){switch(self.memberNav=viewName,$localStorage.set("empDetailView",viewName),viewName){case"prismPortrait":"HiringCandidate"===self.profileDetail.type&&subscriptionCount();break;case"groupsAndTags":self.userGroups.length||getUserGroups(),self.masterTagList.length||getAllTags();break;case"notes":self.noteSubmitted=!1,self.noteObj={userId:self.activeUserId,comment:null,cid:null};break;case"roles":self.closeReportView(),self.roleResponseAvailable||self.archivedUser||self.getUserRolesAndMatch()}},self.updateUserSelectedTags=function(){if(null!==self.profileDetail.tagList&&void 0!==self.profileDetail.tagList){for(var i=0;i<self.profileDetail.tagList.length;i++)self.tagsVisited?(self.userSelectedTags.push(self.profileDetail.tagList[i].text),self.displayTags.push(self.profileDetail.tagList[i].text)):(self.userSelectedTags.push(self.profileDetail.tagList[i]),self.displayTags.push(self.profileDetail.tagList[i]));self.tagsVisited=!0}},self.updateUserSelectedProfileTags=function(){if(self.userSelectedProfileTags=[],null!==self.profileDetail.tagList&&void 0!==self.profileDetail.tagList){for(var i=0;i<self.profileDetail.tagList.length;i++)self.tagsVisited?self.userSelectedProfileTags.push(self.profileDetail.tagList[i].text):self.userSelectedProfileTags.push(self.profileDetail.tagList[i]);self.tagsVisited=!0}},self.addedTag=function(tag){self.userSelectedTags.push(tag.text)},self.removedTag=function(tag){self.userSelectedTags.splice(self.userSelectedTags.indexOf(tag.text),1)},self.addedProfileTag=function(tag){self.userSelectedProfileTags.push(tag.text),sharedProperties.fireAnalyticsEvent("PA | Tags added to user",self.profileDetail.type),updateUserTags()},self.removedProfileTag=function(tag){var index=self.userSelectedProfileTags.indexOf(tag.text);-1!==index&&(self.userSelectedProfileTags.splice(index,1),self.profileDetail.tagList.splice(index,1),sharedProperties.fireAnalyticsEvent("PA | Tags removed from user",self.profileDetail.type),updateUserTags())},self.loadSourceTags=function(query){var deferred=$q.defer(),result=self.masterTagList.filter(function(e){return-1!==e.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise},self.newGroupFlow=function(){self.showCreateGroupSection=!0,self.addGroupSubmitDisabled=!0,self.createGroupName="",self.errornewEmptyGroup=!1,self.errornewGroup=!1},self.defaultGroupsView=function(){self.showCreateGroupSection=!1,self.addGroupSubmitDisabled=!1,self.createGroupName="",self.errornewEmptyGroup=!1,self.errornewGroup=!1},self.saveNewGroup=function(groupName){if(""===groupName||void 0===groupName)return self.errornewEmptyGroup=!0,self.errornewGroup=!1,!1;groupsService.userGroup({name:groupName},"createGroup").then(function(response){null===response?(self.errornewGroup=!0,self.errornewEmptyGroup=!1):(self.showCreateGroupSection=!1,self.createGroupName="",self.addGroupSubmitDisabled=!1,self.errornewGroup=!1,self.errornewEmptyGroup=!1,sharedProperties.fireAnalyticsEvent("PA | User New group created",self.profileDetail.type),self.addUserToGroup(response.hiringGroup.id,groupName))})},self.userSelectGroup=function(obj){self.addUserToGroup(obj.originalObject.id,obj.originalObject.name)},self.addUserToGroup=function(id,groupName){var userList=[];userList.push(self.activeUserId),groupsService.userGroup({id:id,userIds:userList},"addUser").then(function(response){if(null===response)return!0;self.groupObj.id=id,self.groupObj.name=groupName,self.groupObj.count=1;var tmpGroup=angular.copy(self.userGroups);self.userGroups=[],tmpGroup.unshift(self.groupObj),self.userGroups=angular.copy(tmpGroup),sharedProperties.spilceIndexWithBreak(self.allGroups,"id",id),spValue.getAllGroups=[],"Member"===self.profileDetail.type?spValue.getAllEmployees=[]:spValue.getAllCandidates=[],sharedProperties.fireAnalyticsEvent("PA | User Added to Group",self.profileDetail.type)})},self.removeUserFromGroupPop=function(groupObj){self.groupInfo=groupObj,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.removeUserFromGroup,scope:self})},self.removeUserFromGroup=function(id){var userList=[];userList.push(self.activeUserId),groupsService.userGroup({id:id,userIds:userList},"removeUser").then(function(response){if(ngDialog.close(),null===response)return!0;sharedProperties.spilceIndexWithBreak(self.userGroups,"id",id),self.allGroups.push(self.groupInfo),spValue.getAllGroups=[],"Member"===self.profileDetail.type?(spValue.getAllEmployees=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.employeeRemoveGroup"))):(spValue.getAllCandidates=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateRemoveGroup"))),sharedProperties.fireAnalyticsEvent("PA | User Removed from Group",self.profileDetail.type)})},self.toggleProfileView=function(){!self.editProfile&&(self.profileDetailBackup=angular.copy(self.profileDetail)),self.editProfile=!self.editProfile,self.profileSubmitted=!1,self.profileDetail=angular.copy(self.profileDetailBackup)},self.stateCheck=function(country){switch(self.showStatesUS=!1,self.showStatesCanada=!1,self.showStatesOthers=!1,country){case"United States":self.showStatesUS=!0;break;case"Canada":self.showStatesCanada=!0;break;case"US":self.showStatesUS=!0;break;case"CA":self.showStatesCanada=!0;break;default:self.showStatesUS=!1,self.showStatesCanada=!1,self.showStatesOthers=!0}},self.resetAddress=function(){self.profileDetail.address.zipCode="",self.profileDetail.address.city="",self.profileDetail.address.state="",self.profileDetail.address.addressLine1="",self.profileDetail.address.addressLine2=""},self.updateProfileData=function(form){if(form.$valid){self.profileSubmitted=!1;var profileData={id:self.activeUserId,firstName:self.profileDetail.firstName,lastName:self.profileDetail.lastName,title:self.profileDetail.title,email:self.profileDetail.email,gender:self.profileDetail.gender,dob:self.profileDetail.dob,phoneNumber:self.profileDetail.phoneNumber,name:self.profileDetail.firstName+" "+self.profileDetail.lastName,userInitials:self.profileDetail.firstName.charAt(0)+self.profileDetail.lastName.charAt(0),address:{country:self.profileDetail.address.country,addressLine1:self.profileDetail.address.addressLine1,addressLine2:self.profileDetail.address.addressLine2,city:self.profileDetail.address.city,state:self.profileDetail.address.state,zipCode:self.profileDetail.address.zipCode}};memberService.updateProfile(profileData).then(function(response){self.editProfile=!1,self.dobEmpty=!1;var temp=angular.copy(self.profileDetailBackup),newData=$.extend(temp,profileData);newData.zipCode=profileData.address.zipCode,newData.addressLine1=profileData.address.addressLine1,newData.addressLine2=profileData.address.addressLine2,self.profileDetailBackup=angular.copy(newData),self.profileDetail=angular.copy(self.profileDetailBackup),sharedProperties.growlMessage($rootScope.pullInterNationalization("manageAccountContent.personalDetailUpdated")),sharedProperties.fireAnalyticsEvent("PA | Update Profile from Detail page",self.profileDetail.type)})}else self.profileSubmitted=!0},self.editModeNotes=function(comment,cid,index){$(".commentBoxForm").hide(),$(".commentBoxView").show(),$("#commentEdit_"+index).fadeIn(),$("#commentView_"+index).hide(),self.editedComment.comment=comment,self.editedComment.cid=cid,self.activeNoteIndex=index},self.defaultModeNotes=function(index){$("#commentView_"+index).fadeIn(),$("#commentEdit_"+index).hide(),self.editedComment.comment="",self.editedComment.cid=null,self.activeNoteIndex=0},self.deleteNotePop=function(cid){self.noteObj={userId:self.activeUserId,comment:null,cid:cid},ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteNote,scope:self})},self.saveNote=function(){self.noteSubmitted=!0,null!==self.noteObj.comment&&""!==self.noteObj.comment&&(self.noteObj.userId=self.activeUserId,memberService.addNote(self.noteObj).then(function(response){"true"===response.Success?(self.noteSubmitted=!1,self.noteObj.comment="",sharedProperties.growlMessage($rootScope.pullInterNationalization("notes.ajaxMessage.noteSaved")),self.profileDetail.comments.unshift(response.comment),sharedProperties.fireAnalyticsEvent("PA | Save note from detail page",self.profileDetail.type)):null!==response.error&&(self.noteSubmitted=!1,sharedProperties.ajaxError(response.error))}))},self.updateNote=function(index){self.noteUpdated=!0,void 0!==self.editedComment.comment&&null!==self.editedComment.comment&&""!==self.editedComment.comment&&(self.editedComment.userId=self.activeUserId,memberService.updateNote(self.editedComment).then(function(response){if("true"===response.Success){self.noteUpdated=!1,sharedProperties.growlMessage($rootScope.pullInterNationalization("notes.ajaxMessage.notesUpdates"));for(var i=0;i<self.profileDetail.comments.length;i++)self.profileDetail.comments[i].cid===response.comment.cid&&(self.profileDetail.comments[i].comment=response.comment.comment);$("#commentView_"+index).fadeIn(),$("#commentEdit_"+index).hide(),self.editedComment.comment="",self.editedComment.cid=null,sharedProperties.fireAnalyticsEvent("PA | Update note from detail page",self.profileDetail.type)}else null!==response.error&&(self.noteUpdated=!1,sharedProperties.ajaxError(response.error))}))},self.deleteNote=function(){memberService.removeNote(self.noteObj).then(function(response){"true"===response.Success?(ngDialog.close(),sharedProperties.spilceIndexWithBreak(self.profileDetail.comments,"cid",self.noteObj.cid),sharedProperties.growlMessage($rootScope.pullInterNationalization("notes.ajaxMessage.noteDeleted")),sharedProperties.fireAnalyticsEvent("PA | Delete note from detail page",self.profileDetail.type)):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})},self.notePopup=function(member){self.selectedMemberInfo=member,self.noteObj.userId=member.id,self.noteSubmitted=!1,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.addNote,scope:self}).closePromise.then(function(){self.noteObj.comment=""})},self.postNote=function(){self.noteSubmitted=!0,null!==self.noteObj.comment&&""!==self.noteObj.comment&&memberService.addNote(self.noteObj).then(function(response){"true"===response.Success?(self.noteSubmitted=!1,self.profileDetail.comments.unshift(response.comment),ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("notes.ajaxMessage.noteSaved")),sharedProperties.fireAnalyticsEvent("PA | Employee Add Note","N/A")):null!==response.error&&(self.noteSubmitted=!1,ngDialog.close(),sharedProperties.ajaxError(response.error))})},self.redirectToGroup=function(id){scope.$parent.activeView="groupsPAModule",$localStorage.set("activeView",scope.$parent.activeView),window.location.href="/sp/pa/tools#/groupsPA?gId="+id},self.archiveModalSingle=function(member){self.selectedMemberInfo=member,self.userSelectedTags=[],self.displayTags=[],self.masterTagList.length||getAllTags(),self.updateUserSelectedTags(),ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.archiveEmployeeSingle,scope:self})},self.addRole=function(){var rolesList=null;rolesService.getAll().then(function(response){if(null===response)return!0;rolesList=response,null===self.profileDetail.hiringRoles&&(self.profileDetail.hiringRoles=[]);for(var i=0,existingRoles=[];i<self.profileDetail.hiringRoles.length;i++)existingRoles.push(self.profileDetail.hiringRoles[i].id);self.resetUpdatedSearchVal(),self.addRolesCollector={existing:existingRoles,roleSearch:"",roleLeft:rolesList,types:["add"],active:"add"},ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.addRole,scope:self})})},self.addRoleCall=function(roleObj){rolesService.addRole({userId:self.profileDetail.id,roleId:roleObj.id,addMatch:!0}).then(function(response){if(null===response)return!0;roleObj.matchResult=response.roleAndMatch.matchResult,roleObj.portrait=response.roleAndMatch.portrait,self.addRolesCollector.existing.push(roleObj.id),self.profileDetail.hiringRoles.push(roleObj),sharedProperties.fireAnalyticsEvent("PA | Role added to User","N/A"),spValue.getAllCandidates=[]})},self.updateSearchVal=function(searchTxt){self.pageSetting.updateSearchText=void 0!==searchTxt&&""!==searchTxt?window.escape(searchTxt):""},self.resetUpdatedSearchVal=function(){self.pageSetting.updateSearchText=""},self.removeRoleDialog=function(roleObj){self.selectedMemberInfo=roleObj,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.removeRole,scope:self})},self.removeRoleCall=function(roleObj,dialog){rolesService.removeRole({userId:self.profileDetail.id,roleId:roleObj.id}).then(function(response){if(void 0!==dialog&&ngDialog.close("ngdialog1"),null===response)return!0;for(var j=0;j<self.profileDetail.hiringRoles.length;j++)if(self.profileDetail.hiringRoles[j].id===roleObj.id){self.profileDetail.hiringRoles.splice(j,1),void 0===dialog&&self.addRolesCollector.existing.splice(j,1);break}spValue.getAllCandidates=[],sharedProperties.fireAnalyticsEvent("PA | Role removed from User","N/A")})},self.getUserRolesAndMatch=function(){rolesService.getUserRolesAndMatch(self.profileDetail.id).then(function(response){if(null===response)return!0;self.profileDetail.hiringRoles=[],self.profileDetail.hiringRoles=response.hiringRoleAndMatch,self.roleResponseAvailable=!0})},self.viewMatchReport=function(role){self.selectedPortrait=role.portrait,self.selectedUserPortrait.matchResult=role.matchResult,self.selectedUserPortrait.firstName=self.profileDetail.firstName,self.selectedUserPortrait.lastName=self.profileDetail.lastName,self.viewPortraitFlag=!0},self.closeReportView=function(){self.viewPortraitFlag=!1,self.selectedPortrait={},self.selectedUserPortrait={}},self.compareMember=function(email){sharedProperties.fireAnalyticsEvent("PA | User Compare",self.profileDetail.type),scope.$parent.updateView("employeeCompare",!1,email)},self.addToErtiPop=function(member){self.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.addToErti,scope:self})},self.addToErti=function(userId){memberService.addToErti(userId).then(function(response){"true"===response.Success?(ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.employeesAddToErti")),sharedProperties.fireAnalyticsEvent("PA | User added to ERT-i",self.selectedMemberInfo.type),spValue.getAllEmployees=[],self.closeMemberSection()):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})},self.archiveSingle=function(userId){var selectedUsersIds=[];selectedUsersIds.push(userId),self.archiveCall(selectedUsersIds)},self.archiveCall=function(selectedUsersIds){memberService.archiveUser(selectedUsersIds,self.userSelectedTags.join()).then(function(response){"true"===response.Success?(spValue.getAllArchive=[],ngDialog.close(),"Member"===self.profileDetail.type?(spValue.getAllEmployees=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.employeesArchived"))):(spValue.getAllCandidates=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateArchived"))),sharedProperties.fireAnalyticsEvent("PA | User Archived",self.selectedMemberInfo.type),self.closeMemberSection()):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})},self.deleteModalSingle=function(member){self.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteEmployeeSingle,scope:self})},self.deleteSingle=function(userId){var selectedUsersIds=[];selectedUsersIds.push(userId),self.deleteCall(selectedUsersIds)},self.deleteCall=function(selectedUsersIds){memberService.deleteMember(selectedUsersIds,self.archivedUser).then(function(response){"true"===response.Success?(ngDialog.close(),self.archivedUser?(spValue.getAllArchive=[],sharedProperties.fireAnalyticsEvent("PA | Archives Detail Delete",self.selectedMemberInfo.type)):("Member"===self.profileDetail.type?(spValue.getAllEmployees=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.employeesDeleted"))):(spValue.getAllCandidates=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateDeleted"))),sharedProperties.fireAnalyticsEvent("PA | User Deleted",self.selectedMemberInfo.type)),self.closeMemberSection()):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})},self.putBackPop=function(member){self.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.archiveService.dialog.putBack,scope:self})},self.putBack=function(userId){var selectedUsersIds=[];selectedUsersIds.push(userId),archiveService.putBack(selectedUsersIds).then(function(response){"true"===response.Success?(ngDialog.close(),"Member"===self.selectedMemberInfo.type?(spValue.getAllEmployees=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.employeedMoved"))):(spValue.getAllCandidates=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidatesMoved"))),sharedProperties.fireAnalyticsEvent("PA | Archives Detail Move Members",self.selectedMemberInfo.type),spValue.getAllArchive=[],self.closeMemberSection()):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})},self.hiringDialogs=function(type,userObj){self.addCandidate=angular.copy(newCandidate),self.masterTagList.length||getAllTags(),self.deleteMemberInfo=void 0!==userObj?userObj:{},"hire"===type?(resetHireForm(userObj),ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog[type],scope:self})):ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog[type],scope:self})},self.tagAdded=function(tag,format){void 0!==tag[format.obj]&&(self.addCandidate.formValues[format.store].push(tag[format.obj].replace(/\n/gi,"")),self.inputRequired=!1)},self.tagRemoved=function(tag,format){self.addCandidate.formValues[format.store].splice(self.addCandidate.formValues[format.store].indexOf(tag[format.obj].replace(/\n/gi,"")),1)},self.loadSource=function(query,format,obj){for(var deferred=$q.defer(),result=[],toggle=self.masterTagList,i=0;i<toggle.length&&result.length<5;i++)void 0!==obj&&-1!==toggle[i][obj].toLowerCase().indexOf(query.toLowerCase())?result.push(toggle[i]):void 0===obj&&-1!==toggle[i].toLowerCase().indexOf(query.toLowerCase())&&result.push(toggle[i]);return deferred.resolve(result),deferred.promise},self.hireCandidate=function(){self.hireSubmitted=!1,self.existingCandidate=!1,this.hireCandidateForm.$valid?memberService.hireCandidate({id:self.addCandidate.hiringValues.id,firstName:self.addCandidate.hiringValues.firstName,lastName:self.addCandidate.hiringValues.lastName,title:self.addCandidate.hiringValues.title,email:self.addCandidate.hiringValues.email,tags:self.addCandidate.formValues.tags.toString()}).then(function(response){if(void 0!==response.error&&null!==response.error){self.existingCandidate=!0;var responses=response.error;for(var key in responses){self.existingCandidateMessage=responses[key];break}self.hireSubmitted=!0}else ngDialog.close("ngdialog1"),self.existingCandidate=!1,spValue.getAllEmployees=[],spValue.getAllCandidates=[],subscriptionCount(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.memberAdded")),sharedProperties.fireAnalyticsEvent("PA | User Hired","N/A"),self.closeMemberSection()}):self.hireSubmitted=!0},self.tagShareAdded=function(tag){self.shareLinkEmail=tag},self.tagShareRemoved=function(tag){self.shareLinkEmail=null},self.loadNames=function(query){for(var deferred=$q.defer(),result=[],i=0;i<self.employeeList.length&&result.length<5;i++)if("VALID"===self.employeeList[i].userStatus&&(-1!==self.employeeList[i].name.toLowerCase().indexOf(query.toLowerCase())||-1!==self.employeeList[i].email.toLowerCase().indexOf(query.toLowerCase()))){for(var j=0,count=0;j<self.feedbackUser.length;j++)self.feedbackUser[j].email===self.employeeList[i].email&&count++;0===count&&result.push(self.employeeList[i])}return deferred.resolve(result),deferred.promise},self.shareProfile=function(memberList){memberService.getAllEmployees().then(function(response){self.employeeList=response,memberService.getUserShareList({userId:memberList.id}).then(function(response){if(null===response)return!0;self.selectedMemberInfo=memberList,self.shareLinkEmail={},self.shareLinkEmailForm={submitted:!1,required:!1,candidate:!1},self.feedbackUser=response.feedbackUser,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.shareUserId,scope:self})})})},self.sharePortraitOtherFn=function(){if(self.shareLinkEmailForm.submitted=!1,self.shareLinkEmailForm.candidate=!1,self.shareLinkEmailForm.required=!1,void 0===self.shareLinkEmail.email)return self.shareLinkEmailForm.required=!0,void(self.shareLinkEmailForm.submitted=!0);memberService.getAllCandidates().then(function(response){self.masterCandidatesList=response}),this.shareApprovalForm.$valid?memberService.shareUserProfile({firstName:self.shareLinkEmail.firstName,lastName:self.shareLinkEmail.lastName,email:self.shareLinkEmail.email,userFor:self.selectedMemberInfo.id}).then(function(response){if(void 0!==response.error&&null!==response.error)return!0;self.feedbackUser.push(response.feedbackUser),ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.portraitShared")),sharedProperties.fireAnalyticsEvent("PA | Share Profile of User","N/A")}):self.shareLinkEmailForm.submitted=!0},self.feedbackUserRemovedDialog=function(member){self.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteEmployeeSingle,scope:self})},self.feedbackUserRemoved=function(userId){memberService.shareFeedbackRemoved({userId:userId}).then(function(response){for(var i=0;i<self.feedbackUser.length;i++)if(self.feedbackUser[i].id===userId){self.feedbackUser.splice(i,1),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.portraitSharedRemoved"));break}})},self.portraitsPop=function(member){self.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.idealPortrait.dialog.portraitsList,scope:self}).closePromise.then(function(){self.portraitSearch=""})},self.matchPortrait=function(id){var userIdsList=[]
;userIdsList.push(self.selectedMemberInfo.id),idealPortraitService.matchPortrait({id:id,userIds:userIdsList.join(),groupIds:[]}).then(function(response){if(null===response)return!0;self.selectedPortrait=response.portraitMatch.portrait,self.selectedUserPortrait=response.portraitMatch.users[0],ngDialog.close(),sharedProperties.fireAnalyticsEvent("PA | Employee Ideal portrait","N/A"),self.viewPortraitFlag=!0,$("html,body").animate({scrollTop:$(".col-content-wrapper").offset().top-20},1e3)})},self.closeReportView=function(){self.viewPortraitFlag=!1,self.selectedPortrait={},self.selectedUserPortrait={}},init()}}}]);
angular.module("spApp").directive("employees",["sharedProperties","memberService","commonService","$rootScope","spConfig","spValue","ngDialog","$filter","$localStorage","$q","groupsService","rolesService","$timeout","idealPortraitService",function(sharedProperties,memberService,commonService,$rootScope,spConfig,spValue,ngDialog,$filter,$localStorage,$q,groupsService,rolesService,$timeout,idealPortraitService){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/people-analytics/"+attrs.urlSrc},link:function(scope,element,attrs){function filterWithDateRange(createdDate){if(null===createdDate)return!1;var createDt=createdDate[1]+"/"+createdDate[2]+"/"+createdDate[0];return moment(createDt,"MM/DD/YYYY").isBetween(moment(self.filterFromDate,"MM/DD/YYYY"),moment(self.filterToDate,"MM/DD/YYYY"),"days","[]")}function memberOperation(response){getFilterValue(),subscriptionCount(),idealPortraitService.getAll().then(function(response){if(null===response)return!0;self.portraitsListing=response}),null!==self.filterStatusEnabled&&(self.pageSetting.userStatusSelected.push(self.filterStatusEnabled),self.filterStatusEnabled=null,$("#statusCheck").removeAttr("checked")),self.returnMemberList(self.pageSetting.pageSize),null!==sharedProperties.getParam("add")&&self.initAddMember(),self.responseAvailable=!0,$localStorage.remove("archiveUser"),$timeout(function(){prepareDatePicker()},200)}function getFilterValue(){var userStatus=[],titleFilters=[],groupsFilter=[],tagsFilter=[],arr=[];memberService.getRolesAndTag().then(function(response){self.filterOptions.masterTagList=response.tagList,self.filterOptions.masterHiringRole=response.hiringRoles});for(var i=0;i<self.masterMemberList.length;i++){if(null!==self.masterMemberList[i].title&&titleFilters.push(self.masterMemberList[i].title),null!==self.masterMemberList[i].userStatus&&userStatus.push({userStatus:self.masterMemberList[i].userStatus,userFormatted:self.masterMemberList[i].userStatusFormatted}),null!==self.masterMemberList[i].groups)for(var j=0;j<self.masterMemberList[i].groups.length;j++)groupsFilter.push(self.masterMemberList[i].groups[j]);if(null!==self.masterMemberList[i].tagList)for(var k=0;k<self.masterMemberList[i].tagList.length;k++)tagsFilter.push(self.masterMemberList[i].tagList[k])}self.filterOptions.userStatus=userStatus.filter(function(e){if(-1===arr.indexOf(e.userStatus))return arr.push(e.userStatus),e}),self.filterOptions.titleFilters=titleFilters.unique(),arr=[];for(var kk=0;kk<groupsFilter.length;kk++)arr[groupsFilter[kk].id]=groupsFilter[kk];for(var key in arr)self.filterOptions.allGroupsFilter.push(arr[key]);for(var zz=0;zz<tagsFilter.length;zz++)-1===self.filterOptions.tagList.indexOf(tagsFilter[zz])&&self.filterOptions.tagList.push(tagsFilter[zz])}function filterByGroups(groupObj){return null!==groupObj&&groupObj.some(function(obj){return-1!==self.pageSetting.userGroupSelected.indexOf(obj.name)})}function subscriptionCount(countExceedCheck){memberService.getSubcription().then(function(response){self.subscriptionCount=response.availableHiringSubscripitons,countExceedCheck&&!self.subscriptionCount&&void 0!==self.addMember&&(self.addCandidate.emailErrors.countExceed=!0)})}function updateUserSelectedTags(){if(null!==self.selectedMemberInfo.tagList&&void 0!==self.selectedMemberInfo.tagList)for(var i=0;i<self.selectedMemberInfo.tagList.length;i++)self.userSelectedTags.push(self.selectedMemberInfo.tagList[i]),self.displayTags.push(self.selectedMemberInfo.tagList[i])}function init(){null!==$localStorage.get("accountRequest")&&sharedProperties.growlMessage($rootScope.pullInterNationalization($localStorage.get("accountRequest"))),$localStorage.remove("accountRequest","fromCompare"),memberService.getAllEmployees().then(function(response){self.masterMemberList=response,self.memberList=angular.copy(self.masterMemberList),memberOperation(response.memberList),self.noErti=null!==$localStorage.get("noErti"),scope.$parent.activeView=attrs.activeView,$localStorage.set("activeView",scope.$parent.activeView)})}var self=scope;self.masterMemberList=[],self.memberList=[],self.memberType="Member",self.responseAvailable=!1,self.pageSetting={pageSize:10,lastPredicate:"lastName",lastReverse:!1,disabledInfinite:!1,dateRangeSelected:!1,userGroupSelected:[],selectedTitles:[],userStatusSelected:[],userBlocked:!1,statusInclude:[],searchTag:[],textSearching:"",heightParam:800,searchGroupsFilters:"",searchTitlesFilter:"",user:[],ertiFlag:!1,updateSearchText:""},self.userInfo=$localStorage.get("loggegdInProfile"),self.isAccountAdmin=-1!==self.userInfo.member.roles.indexOf("AccountAdministrator"),self.filterOptions={tagList:[],allGroupsFilter:[],userStatus:[],titleFilters:[],masterTagList:[],masterHiringRole:[]},self.addRolesCollector={existingRole:[],newRole:[]};var newMember={selectedEmailsList:[],tagsList:[],displayDate:null,emailErrors:{isExisting:!1,isInvalid:!1,required:!1,countExceed:!1,dateCheck:!1,subscriptionCount:null},formValues:{emails:[],dueBy:null,type:"Member",tags:[]}};self.selfEmail="",self.noteObj={userId:null,comment:null,cid:null},self.noteSubmitted=!1,self.addMembersViewFlag=!!sharedProperties.getParam("add")||!1,self.filterStatusEnabled=sharedProperties.getParam("userStatus"),self.initLoad=!1,self.newDt=new Date,self.filterToDate=null,self.filterFromDate=null,self.dateFilterCheck=!1,self.dateErrorFrom=!1,self.dateErrorTo=!1,self.dateRangeFilter=null,self.selectedFilterList=[],self.originalpageSetting=angular.copy(self.pageSetting),self.userStatus=[],self.tagListArray=[],self.titleFilters=[],self.allGroupsFilter=[],self.allMembersEmailId=[],self.alltoggle=!1,self.negative=!1,self.checkedAll=!1,self.allUsersMenu=!1,self.masterCopy=!0,self.isGroupsDelete=!1,self.userSelectedTags=[],self.displayTags=[],self.pageType="Member",self.portraitSearch="",self.portraitsListing=[],self.viewPortraitFlag=!1,self.selectedPortrait={},self.selectedUserPortrait={},self.currentPageUrl=window.location.href,self.salesForceForm=!1,self.requestAccounts=0,self.requestType="",window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),self.sendEmailReminders=function(status,memberList){var option={type:"HiringEmployeeReminder"};commonService.sendEmail(option,memberList.id).then(function(response){if(null===response)return!0;sharedProperties.fireAnalyticsEvent("PA | Employee send reminder","N/A"),memberList.lastRemindedOn=[moment().format("Y"),moment().format("M"),moment().format("D")]})},self.returnMemberList=function(){if(self.initLoad=!0,!self.masterMemberList.length)return self.memberList=angular.copy(self.masterMemberList),!0;self.pageSetting.pageSize=self.originalpageSetting.pageSize,self.pageSetting.disabledInfinite=!1;var result=self.masterCopy?self.masterMemberList:self.memberList;self.memberList=result.filter(function(e){return(!1!==self.pageSetting.dateRangeSelected&&filterWithDateRange(e.dateToShow)||!1===self.pageSetting.dateRangeSelected&&e)&&(self.pageSetting.userGroupSelected.length&&filterByGroups(e.groups)||!self.pageSetting.userGroupSelected.length&&e)&&(self.pageSetting.selectedTitles.length&&-1!==self.pageSetting.selectedTitles.indexOf(e.title)||!self.pageSetting.selectedTitles.length&&e)&&(self.pageSetting.userStatusSelected.length&&(-1!==self.pageSetting.userStatusSelected.indexOf(e.userStatus)||self.pageSetting.userBlocked&&e.deactivated===self.pageSetting.userBlocked)||!self.pageSetting.userStatusSelected.length&&e)&&(self.pageSetting.statusInclude.length&&self.filterInArray(self.pageSetting.statusInclude,null===e.roles?[]:e.roles)||!self.pageSetting.statusInclude.length&&e)&&(!1!==self.pageSetting.ertiFlag&&e.inErti||!1===self.pageSetting.ertiFlag&&e)&&(self.pageSetting.searchTag.length&&self.filterInArray(self.pageSetting.searchTag,null===e.tagList?[]:e.tagList)||!self.pageSetting.searchTag.length&&e)&&sharedProperties.singleElementSearch(self.pageSetting.textSearching,e,2)}),self.order(self.pageSetting.lastPredicate,self.pageSetting.lastReverse),self.pageSetting.user.length!==self.memberList.length&&(self.negative=!1),self.masterCopy=!0},self.checkAll=function(checked){self.pageSetting.user=checked?self.memberList.map(function(item){return{userId:item.id,email:item.email,name:item.name,title:item.title,inErti:item.inErti,roles:item.roles}}):[]},self.includeDateCheck=function(fromDt,toDt,flag){self.dateErrorFrom=!1,self.dateErrorTo=!1,!flag||self.dateErrorFrom||self.dateErrorTo?(self.pageSetting.dateRangeSelected=!1,self.manageFilterDisplayList("dateRangeSelected")):(self.pageSetting.dateRangeSelected=!0,self.manageFilterDisplayList("dateRangeSelected")),self.negative=!1,self.pageSetting.user=[],self.returnMemberList(self.pageSetting.pageSize)},self.ertiFilterCheck=function(){self.pageSetting.ertiFlag=!self.pageSetting.ertiFlag,self.returnMemberList(self.pageSetting.pageSize)},self.active=function(event,setting){self.pageSetting.lastPredicate=setting.predicate,self.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.pageSetting.lastPredicate),self.order(self.pageSetting.lastPredicate,self.pageSetting.lastReverse)},self.order=function(predicate,reverse){self.pageSetting.lastPredicate=predicate,self.pageSetting.lastReverse=reverse;var orderedList=$filter("orderBy")(self.memberList,self.pageSetting.lastPredicate,self.pageSetting.lastReverse);self.memberList=function(array,key){if("lastName"===key){for(var list=[],empty=[],i=0;i<array.length;i++)null!==array[i][key]&&""!==array[i][key]&&void 0!==array[i][key]?list.push(array[i]):empty.push(array[i]);return $.merge(list,empty)}return orderedList}(orderedList,self.pageSetting.lastPredicate)};var prepareDatePicker=function(){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),self.filterFromDate=moment().subtract(30,"days").format("MM/DD/YYYY"),self.filterToDate=moment().format("MM/DD/YYYY"),self.datePickerForFilter()};self.datePickerForFilter=function(){var ipadView=$(window).width()>767&&$(window).width()<1025;$('input[name="dateRangeFilter"]').daterangepicker({showDropdowns:!1,maxDate:moment(),startDate:moment().subtract(30,"days").toDate(),endDate:moment(),locale:{format:ipadView?"MM/DD/YY":"MMM DD, YYYY"},alwaysShowCalendars:!0,autoApply:!0,opens:"right"},function(start,end,label){scope.$apply(function(){self.filterFromDate=start.format("MM/DD/YYYY"),self.filterToDate=end.format("MM/DD/YYYY")})})},self.includeCheck=function(param,setting,cache){var i=$.inArray(param,self.pageSetting[setting]);i>-1?self.pageSetting[setting].splice(i,1):(self.pageSetting[setting].push(param),self.masterCopy=!cache),self.negative=!1,self.pageSetting.user=[],self.manageFilterDisplayList(setting),self.returnMemberList(self.pageSetting.pageSize)},self.closeRest=function(index,noScroll){var val=void 0===noScroll?0:1;$(".accordian-checkbox").each(function(i){i!==$(index.currentTarget.parentNode).index()-val&&$(this).prop("checked",!0)})},self.clear=function(classS,property,search){self.pageSetting[property]=[],self.manageFilterDisplayList(property),void 0!==search&&(self.pageSetting[search]=""),$(classS).each(function(v,i){$(this).prop("checked",!1)}),"userStatusSelected"===property&&(self.pageSetting.ertiFlag=!1),self.returnMemberList()},self.calculateHeight=function(event){var obj=$("#"+event);obj.height()>self.pageSetting.heightParam&&obj.addClass("scroller")},self.active=function(event,setting){self.pageSetting.lastPredicate=setting.predicate,self.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.pageSetting.lastPredicate),self.order(self.pageSetting.lastPredicate,self.pageSetting.lastReverse)},self.manageFilterDisplayList=function(filterSetting){var existing=$.inArray(filterSetting,self.selectedFilterList),isArray=$.isArray(self.pageSetting[filterSetting]),settingLength=self.pageSetting[filterSetting]?self.pageSetting[filterSetting].length:0,settingFlag=self.pageSetting[filterSetting];isArray&&settingLength>0?-1===existing&&self.selectedFilterList.push(filterSetting):isArray&&0===settingLength?-1!==existing&&self.selectedFilterList.splice(existing,1):isArray||!1===settingFlag||/false/.test(settingFlag)?isArray||!1!==settingFlag&&!/false/.test(settingFlag)||-1!==existing&&self.selectedFilterList.splice(existing,1):-1===existing&&self.selectedFilterList.push(filterSetting)},self.filterInArray=function(tags,array){return array.some(function(v){return-1!==tags.indexOf(v)})},self.addMemberView=function(){self.addMembersViewFlag=!self.addMembersViewFlag,self.addMembersViewFlag&&self.initAddMember()},self.initAddMember=function(){self.addMember=angular.copy(newMember),self.overlayDim={width:$(".new-cols.content-col").width(),height:$(".new-cols.content-col").height()},subscriptionCount()},self.datePickerForAdd=function(){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),$('input[name="endDate"]').daterangepicker({showDropdowns:!1,minDate:moment(),locale:{format:"MM/DD/YYYY"},alwaysShowCalendars:!0,singleDatePicker:!0,autoUpdateInput:!1,opens:"right"},function(start,end,label){scope.$apply(function(){self.addMember.formValues.dueBy=start.format("MM/DD/YYYY"),self.addMember.displayDate=start.format("MM/DD/YYYY")})})},self.tagAdded=function(tag,format){void 0!==tag[format.obj]&&(self.addMember.formValues[format.store].push(tag[format.obj].replace(/\n/gi,"")),self.inputRequired=!1)},self.tagRemoved=function(tag,format){self.addMember.formValues[format.store].splice(self.addMember.formValues[format.store].indexOf(tag[format.obj].replace(/\n/gi,"")),1)},self.loadSource=function(query,format){var deferred=$q.defer(),result=self.filterOptions[format].filter(function(e){return-1!==e.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise},self.addNewMember=function(){var list=$(".tagsTextarea").find(".tag-list");return list.find(".tag-item").removeClass("invalid-tag"),self.addMember.emailErrors.required=!1,self.addMember.emailErrors.countExceed=!1,self.addMember.emailErrors.isInvalid=!1,self.addMember.emailErrors.isExisting=!1,self.addMember.selectedEmailsList=[],self.addMember.formValues.emails.length?null===self.addMember.displayDate?(self.addMember.emailErrors.dateCheck=!0,!1):self.addMember.formValues.emails.length>self.subscriptionCount?(self.addMember.emailErrors.countExceed=!0,!1):void memberService.isMemberPresent({candidateEmail:self.addMember.formValues.emails.toString()}).then(function(response){if(null!==response.Success&&void 0!==response.Success){var tempDt=moment(self.addMember.formValues.dueBy,"MM/DD/YYYY");self.addMember.formValues.dueBy=[parseInt(tempDt.format("Y")),parseInt(tempDt.format("M")),parseInt(tempDt.format("D"))],memberService.addMember(self.addMember.formValues).then(function(response){self.addMember=angular.copy(newMember),response.hiring.length&&sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.employeeAdded")),sharedProperties.fireAnalyticsEvent("PA | Employee Added","N/A");for(var i=0;i<response.hiring.length;i++)self.masterMemberList.push(response.hiring[i]);null!==response.error&&void 0!==response.error?(self.addMember.emailErrors.subscriptionCount=response.error,self.candidateEmails=[],self.memberTags=[],subscriptionCount(!0)):(subscriptionCount(),self.addMembersViewFlag=!1),spValue.getAllMembersForGroups=[],self.returnMemberList(self.pageSetting.pageSize),$("html,body").animate({scrollTop:$(".employees-list-container").offset().top-20},1e3)})}else{self.existingUserEmailError=[];for(var i in response.error){self.existingUserEmailError.push({name:i,msg:response.error[i]});var index=self.addMember.formValues.emails.indexOf(i);-1!==index&&list.find('.tag-item:eq("'+index+'")').addClass("invalid-tag")}self.addMember.emailErrors.isExisting=!0,$("html,body").animate({scrollTop:$(".tagsTextarea").offset().top-20},1e3)}}):(self.addMember.emailErrors.required=!0,!1)},self.infinteScroll=function(pageSize){self.pageSetting.disabledInfinite||(self.pageSetting.pageSize=pageSize,pageSize>=self.masterMemberList.length&&(self.pageSetting.disabledInfinite=!0,self.pageSetting.pageSize=self.masterMemberList.length))},self.deleteModalSingle=function(member){self.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteEmployeeSingle,scope:self})},self.deleteModalMultiple=function(){for(var userInErti=!1,userIsAdmin=!1,i=0;i<self.pageSetting.user.length&&(!0===self.pageSetting.user[i].inErti&&(userInErti=!0),-1!==self.pageSetting.user[i].roles.indexOf("Hiring")&&(userIsAdmin=!0),!userInErti||!userIsAdmin);i++);userInErti?sharedProperties.growlMessage($rootScope.pullInterNationalization("pa.employees.inErti"),"","glyphicon glyphicon-ban-circle"):userIsAdmin?sharedProperties.growlMessage($rootScope.pullInterNationalization("pa.employees.adminError"),"","glyphicon glyphicon-ban-circle"):ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteEmployeeMultiple,scope:self})},self.archiveModalSingle=function(member){self.selectedMemberInfo=member,self.userSelectedTags=[],self.displayTags=[],updateUserSelectedTags(),ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.archiveEmployeeSingle,scope:self})},self.archiveModalMultiple=function(){for(var userInErti=!1,userIsAdmin=!1,i=0;i<self.pageSetting.user.length&&(!0===self.pageSetting.user[i].inErti&&(userInErti=!0),-1!==self.pageSetting.user[i].roles.indexOf("Hiring")&&(userIsAdmin=!0),!userInErti||!userIsAdmin);i++);userInErti?sharedProperties.growlMessage($rootScope.pullInterNationalization("pa.employees.inErti"),"","glyphicon glyphicon-ban-circle"):userIsAdmin?sharedProperties.growlMessage($rootScope.pullInterNationalization("pa.employees.adminError"),"","glyphicon glyphicon-ban-circle"):ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.archiveEmployeeMultiple,scope:self})},self.notePopup=function(member){self.selectedMemberInfo=member,self.noteObj.userId=member.id,self.noteSubmitted=!1,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.addNote,scope:self}).closePromise.then(function(){self.noteObj.comment=""})},self.checkCount=function(checked){var userLength=self.pageSetting.user.length;checked&&userLength+1===self.memberList.length?self.negative=!0:self.negative=!1},self.deleteSingle=function(userId){var selectedUsersIds=[];selectedUsersIds.push(userId),self.deleteCall(selectedUsersIds)},self.deleteMultiMembers=function(){for(var selectedUsersIds=[],i=0;i<self.pageSetting.user.length;i++)selectedUsersIds.push(self.pageSetting.user[i].userId);self.deleteCall(selectedUsersIds)},self.deleteCall=function(selectedUsersIds){memberService.deleteMember(selectedUsersIds).then(function(response){if("true"===response.Success){var templList=angular.copy(self.masterMemberList),tempList0=[];$.each(templList,function(i,j){-1===$.inArray(templList[i].id,selectedUsersIds)&&tempList0.push(templList[i])}),self.masterMemberList=angular.copy(tempList0),self.negative=!1,self.pageSetting.user=[],self.returnMemberList(self.pageSetting.pageSize),spValue.getAllEmployees=angular.copy(self.masterMemberList),spValue.getAllMembersForGroups=[],ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.employeesDeleted")),sharedProperties.fireAnalyticsEvent("PA | Employee Deleted","N/A")}else null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})},self.archiveSingle=function(userId){var selectedUsersIds=[];selectedUsersIds.push(userId),self.archiveCall(selectedUsersIds)},self.archiveMultiMembers=function(){for(var selectedUsersIds=[],i=0;i<self.pageSetting.user.length;i++)selectedUsersIds.push(self.pageSetting.user[i].userId);self.archiveCall(selectedUsersIds)},self.archiveCall=function(selectedUsersIds){memberService.archiveUser(selectedUsersIds,self.userSelectedTags.join()).then(function(response){if("true"===response.Success){var templList=angular.copy(self.masterMemberList),tempList0=[];$.each(templList,function(i,j){-1===$.inArray(templList[i].id,selectedUsersIds)&&tempList0.push(templList[i])}),self.masterMemberList=angular.copy(tempList0),self.negative=!1,self.pageSetting.user=[],self.returnMemberList(self.pageSetting.pageSize),spValue.getAllArchive=[],spValue.getAllMembersForGroups=[],ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.employeesArchived")),sharedProperties.fireAnalyticsEvent("PA | Employee Archived","N/A")}else null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})},self.postNote=function(){self.noteSubmitted=!0,null!==self.noteObj.comment&&""!==self.noteObj.comment&&memberService.addNote(self.noteObj).then(function(response){"true"===response.Success?(self.noteSubmitted=!1,ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("notes.ajaxMessage.noteSaved")),sharedProperties.fireAnalyticsEvent("PA | Employee Add Note","N/A")):null!==response.error&&(self.noteSubmitted=!1,ngDialog.close(),sharedProperties.ajaxError(response.error))})},self.viewMemberDetails=function(userId,type){$localStorage.set("empUserId",userId),void 0!==type&&sharedProperties.fireAnalyticsEvent("PA | Employee View Portrait","N/A"),scope.$parent.updateView("employeeDetailsModule",!1)},self.printPrimPortrait=function(memberObj){$localStorage.remove("printEmail","printName"),self.profileDetails=[],memberService.getProfileInfo(memberObj.id,!1).then(function(response){if(null===response)return!0;self.profileDetails=response.hiringUser,$localStorage.set(self.profileDetails.email,response),$localStorage.set("printEmail",self.profileDetails.email),$localStorage.set("printName",self.profileDetails.firstName+" "+self.profileDetails.lastName),$timeout(function(){var url="/sp/resources/html/common/prism-print-template.html?mode=print&email="+memberObj.email+"&fullName="+memberObj.firstName+" "+memberObj.lastName;window.open(url,"_blank"),window.focus()},100)})},self.compareMember=function(userId){memberService.getProfileInfo(userId,!1).then(function(response){$localStorage.set("activeEmp",response.hiringUser),sharedProperties.fireAnalyticsEvent("PA | Employee Compare","N/A"),scope.$parent.updateView("employeeCompare",!1,response.hiringUser.email)})},self.sharePortrait=function(memberList){memberService.getShareId({userId:memberList.id}).then(function(response){if(null===response)return!0;self.selectedMemberInfo=memberList,self.shareProfileUrl=window.location.origin+"/sp/profilePublic/"+response.hiringPublicId,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.shareProfileId,scope:self})})},self.sendProfilePortrait=function(){commonService.sendEmail({type:"HiringSharePortrait"},self.selectedMemberInfo.id).then(function(response){if(null===response)return!0;ngDialog.close("ngdialog1"),sharedProperties.fireAnalyticsEvent("PA | Employee share portrait","N/A")})},self.addToErtiPop=function(member){self.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.addToErti,scope:self})},self.addToErti=function(userId){memberService.addToErti(userId).then(function(response){"true"===response.Success?(ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.employeesAddToErti")),sharedProperties.fireAnalyticsEvent("PA | Employee Add to ERT-i","N/A"),spValue.getAllEmployees=[],memberService.getAllEmployees().then(function(response){self.masterMemberList=response,self.memberList=angular.copy(self.masterMemberList)})):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})},self.addedTag=function(tag){self.userSelectedTags.push(tag.text)},self.removedTag=function(tag){self.userSelectedTags.splice(self.userSelectedTags.indexOf(tag.text),1)},self.loadSourceTags=function(query){var deferred=$q.defer(),result=self.filterOptions.masterTagList.filter(function(e){return-1!==e.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise},self.portraitsPop=function(member){self.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.idealPortrait.dialog.portraitsList,scope:self}).closePromise.then(function(){self.portraitSearch=""})},self.matchPortrait=function(id){var userIdsList=[];userIdsList.push(self.selectedMemberInfo.id),idealPortraitService.matchPortrait({id:id,userIds:userIdsList.join(),groupIds:[]}).then(function(response){if(null===response)return!0;self.selectedPortrait=response.portraitMatch.portrait,self.selectedUserPortrait=response.portraitMatch.users[0],ngDialog.close(),sharedProperties.fireAnalyticsEvent("PA | Employee Ideal portrait","N/A"),self.viewPortraitFlag=!0,$("html,body").animate({scrollTop:$(".col-content-wrapper").offset().top-20},1e3)})},self.closeReportView=function(){self.viewPortraitFlag=!1,self.selectedPortrait={},self.selectedUserPortrait={}},self.processAccountRequest=function(e,requestAccounts){self.salesForceForm=!1,requestAccounts>0?(self.salesForceForm=!1,$localStorage.set("accountRequest","manageAccountContent.requestSubmit"),sharedProperties.fireAnalyticsEvent("PA | Employee Request more accounts","N/A")):(e.preventDefault(),self.salesForceForm=!0)},self.requestForAccounts=function(requestType){self.requestAccounts=0,self.requestType=requestType,self.salesForceForm=!1,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.accountsRequest,scope:scope})},self.showNewRoleView=function(isEdit,roleDetails){self.initAddRole();ngDialog.open({template:spConfig.talentAnalytics.roles.dialog.createRole,scope:self})},self.initAddRole=function(){self.submitError=!1,self.loadCreateRole=!0,self.formSubmit=!1,self.newRole={form:{},details:{description:"",portraitId:""}}},self.createNewRole=function(isUpdate,isAdded){if(self.formSubmit=!1,self.submitError=!1,self.newRole.form.$valid){if(void 0!==self.newRole.details.portraitId&&void 0!==self.newRole.details.portraitId.originalObject&&""!==self.newRole.details.portraitId){var oldPortraitObject=angular.copy(self.newRole.details.portraitId);self.newRole.details.portraitId=self.newRole.details.portraitId.originalObject.id}rolesService.createRole(self.newRole.details,isUpdate).then(function(response){if("true"===response.Success)sharedProperties.fireAnalyticsEvent("PA | Candidate Create new Role","N/A"),self.addRoleCall(response.hiringRole),void 0!==spValue.getAllRoles.hiringRoleListing&&spValue.getAllRoles.hiringRoleListing.unshift(response.hiringRole),self.filterOptions.masterHiringRole.push({id:response.hiringRole.id,name:response.hiringRole.name}),ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.roleCreated"));else{var errorMessage="";for(var key in response.error)errorMessage=response.error[key];self.submitError=errorMessage,self.newRole.details.portraitId=angular.copy(oldPortraitObject)}})}else self.formSubmit=!0},self.switchType=function(type){if(self.addRolesCollector.active===type)return!0;self.addRolesCollector.active=type},self.clearPortraitInputBox=function(){$(".autoCompleteCss").val(""),self.newRole.details.portraitId=""},self.addRole=function(memberObj,active){self.selectedObj=memberObj,memberService.getUserRoles({userId:self.selectedObj.id}).then(function(response){if(null===response)return!0;!angular.isArray(response.hiringRoles)&&(response.hiringRoles=[]);for(var i=0,existingRoles=[];i<response.hiringRoles.length;i++)existingRoles.push(response.hiringRoles[i]);self.resetUpdatedSearchVal(),self.addRolesCollector={existing:existingRoles,roleSearch:"",roleLeft:self.filterOptions.masterHiringRole,types:["add","create"],active:"add"},void 0!==active&&(self.addRolesCollector.active=active),ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.addRole,scope:self})})},self.updateSearchVal=function(searchTxt){self.pageSetting.updateSearchText=void 0!==searchTxt&&""!==searchTxt?window.escape(searchTxt):""},self.resetUpdatedSearchVal=function(){self.pageSetting.updateSearchText=""},self.addRoleCall=function(roleObj){rolesService.addRole({userId:self.selectedObj.id,roleId:roleObj.id}).then(function(response){if(null===response)return!0;for(var i=0;i<self.masterMemberList.length;i++)if(self.masterMemberList[i].id===self.selectedObj.id){!angular.isArray(self.masterMemberList[i].hiringRoles)&&(self.masterMemberList[i].hiringRoles=[]),self.masterMemberList[i].hiringRoles.push(roleObj);break}self.addRolesCollector.existing.push(roleObj.id),self.returnMemberList(self.pageSetting.pageSize),sharedProperties.fireAnalyticsEvent("PA | Candidate Role added to User","N/A")})},self.removeRoleCall=function(roleObj){rolesService.removeRole({userId:self.selectedObj.id,roleId:roleObj.id}).then(function(response){if(null===response)return!0;var index=self.addRolesCollector.existing.indexOf(roleObj.id);index>-1&&self.addRolesCollector.existing.splice(index,1),self.returnMemberList(self.pageSetting.pageSize),sharedProperties.fireAnalyticsEvent("PA | Candidate Role removed from User","N/A")})},self.closeNewRoleView=function(){ngDialog.close("ngdialog1")},init()}}}]);
angular.module("spApp").directive("groupsList",["ajaxService","sharedProperties","groupsService","$rootScope","spConfig","spValue","ngDialog","$filter","commonService","$localStorage","memberService","$q",function(ajaxService,sharedProperties,groupsService,$rootScope,spConfig,spValue,ngDialog,$filter,commonService,$localStorage,memberService,$q){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/people-analytics/"+attrs.urlSrc},link:function(scope,element,attrs){function updateSearchList(){allMail=angular.copy(vm.memberList);for(var i=0;i<vm.groupsDetail.users.length;i++)for(var j=vm.memberList.length-1;j>=0;j--)if(vm.groupsDetail.users[i].id===vm.memberList[j].id){delete allMail[j];break}vm.searchListFn()}function updateUserSelectedTags(){if(null!==vm.selectedMemberInfo.tagList&&void 0!==vm.selectedMemberInfo.tagList){for(var i=0;i<vm.selectedMemberInfo.tagList.length;i++)vm.tagsVisited?vm.userSelectedTags.push(vm.selectedMemberInfo.tagList[i].text):vm.userSelectedTags.push(vm.selectedMemberInfo.tagList[i]);vm.tagsVisited=!0}}function updateUserTags(){memberService.updateUserTags(vm.selectedMemberInfo.id,vm.userSelectedTags.toString()).then(function(response){"true"===response.Success?console.log("tag updated"):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})}function init(param){$localStorage.remove("fromCompare");var groupsId=null;groupsService.getGroup().then(function(response){vm.groupList=response,vm.pageReady=!0,vm.groupList.length&&(void 0!==param&&(groupsId=sharedProperties.getParam("gId")),null!==scope.$parent.selectedGroupId&&(groupsId=scope.$parent.selectedGroupId),vm.getGroupDetail(groupsId||vm.groupList[0].id,param)),scope.$parent.activeView=attrs.activeView,scope.$parent.selectedGroupId=null,$localStorage.set("activeView",scope.$parent.activeView)}),memberService.getRolesAndTag().then(function(response){vm.filterOptions.tagList=response.tagList,vm.filterOptions.hiringRole=response.hiringRoles})}var vm=scope,allMail=[];vm.pageReady=!1,vm.groupList=[],vm.groupsDetail=null,vm.createGroupName="",vm.activeGroup=null,vm.showRenameGroup=!1,vm.showCreateGroup=!1,vm.memberList=[],vm.hideMember=[],vm.pageSetting={errornewEmptyGroup:!1,errornewGroup:!1,savenewGroup:!1,newEmptyGroup:!1,newGroup:!1,searchForGroups:"",textSearching:"",memberListSearch:"",modeSelected:[]},vm.filterOptions={tagList:[],hiringRole:[]},vm.contentSetting={userSearching:"",pageSize:10,intialVal:10,lastReverse:!1,currentPredicate:"lastName",disabledInfinite:!1,user:[]},vm.negative=!1,vm.checkedAll=!1,vm.userInfo=$localStorage.get("loggegdInProfile"),vm.originalContentSetting=angular.copy(vm.contentSetting),vm.originalPageSetting=angular.copy(vm.pageSetting),vm.candidateImage=spConfig.image.candidateDefault,vm.employeeImage=spConfig.image.default,vm.viewCompare=function(groupId,groupType,groupName){vm.groupType=groupType,vm.groupId=groupId,vm.groupName=groupName,vm.groupUsers=vm.contentSetting.user,sharedProperties.fireAnalyticsEvent("PA | Groups compare Portraits","N/A"),ngDialog.open({template:spConfig.talentAnalytics.groupService.dialog.teamAdvisor,scope:vm,className:"roles-compare-full-view"})},vm.getGroupDetail=function(id,param){if(vm.activeGroup===id)return!0;vm.activeGroup=id,groupsService.getGroupDetail({id:id}).then(function(response){if(void 0!==response.error&&null!==response.error)return void 0!==param&&vm.groupList.length&&vm.getGroupDetail(vm.groupList[0].id),!0;vm.groupsDetail=response.hiringGroup,!angular.isArray(vm.groupsDetail.users)&&(vm.groupsDetail.users=[]),vm.contentSetting=angular.copy(vm.originalContentSetting),vm.pageSetting=angular.copy(vm.originalPageSetting),vm.negative=!1,vm.order(vm.contentSetting.currentPredicate,vm.contentSetting.lastReverse)})},vm.saveNewGroup=function(groupName){if(vm.pageSetting=angular.copy(vm.originalPageSetting),""===groupName||void 0===groupName)return vm.pageSetting.errornewEmptyGroup=!0,!1;groupsService.userGroup({name:groupName},"createGroup").then(function(response){if(null===response)return vm.pageSetting.errornewGroup=!0,!0;vm.groupList.unshift(response.hiringGroup),vm.showCreateGroup=!1,vm.showRenameGroup=!1,vm.createGroupName="",vm.getGroupDetail(response.hiringGroup.id),sharedProperties.growlMessage($rootScope.pullInterNationalization("admin.group.saveMessage")),sharedProperties.fireAnalyticsEvent("PA | Groups New","N/A")})},vm.renameGroup=function(renamedname){return vm.pageSetting=angular.copy(vm.originalPageSetting),""===renamedname?(vm.pageSetting.newEmptyGroup=!0,!0):renamedname===vm.groupsDetail.name?(vm.showRenameGroup=!1,!0):void groupsService.userGroup({id:vm.groupsDetail.id,name:renamedname},"renameGroup").then(function(response){if(null===response)return vm.pageSetting.newGroup=!0,!0;vm.groupsDetail.name=renamedname;for(var i=0;i<vm.groupList.length;i++)if(vm.groupsDetail.id===vm.groupList[i].id){vm.groupList[i].name=renamedname,spValue.getAllGroups=angular.copy(vm.groupList);break}sharedProperties.growlMessage($rootScope.pullInterNationalization("admin.group.profile.updateGroupNameMessage")),sharedProperties.fireAnalyticsEvent("PA | Groups Rename","N/A"),vm.renameGroupReset(!0)})},vm.deleteGroup=function(){groupsService.deleteGroup({id:vm.groupsDetail.id}).then(function(response){if(ngDialog.close("ngdialog1"),null===response)return!0;for(var i=0;i<vm.groupList.length;i++)if(vm.groupsDetail.id===vm.groupList[i].id){vm.groupList.splice(i,1),vm.groupsDetail=null,init();break}sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.groupDeletedSuccefully")),sharedProperties.fireAnalyticsEvent("PA | Groups Delete","N/A")})},vm.addUsers=function(){groupsService.userGroup({id:vm.groupsDetail.id,userIds:vm.addedList},"addUser").then(function(response){if(ngDialog.close("ngdialog1"),null===response)return!0;vm.pageSetting=angular.copy(vm.originalPageSetting);for(var i=0;i<response.hiringGroupUsers.length;i++)vm.groupsDetail.users.push(response.hiringGroupUsers[i]);for(var j=0;j<vm.groupList.length;j++)if(vm.groupsDetail.id===vm.groupList[j].id){vm.groupList[j].count=vm.groupsDetail.users.length;break}spValue.getAllEmployees=[],spValue.getAllCandidates=[],vm.order(vm.contentSetting.currentPredicate,vm.contentSetting.lastReverse),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.memberAddedtogroup")),sharedProperties.fireAnalyticsEvent("PA | Groups add users","N/A")})},vm.deleteUsers=function(userIds,single){var userList=[];if(single)userList.push(userIds);else for(var e=0;e<userIds.length;e++)userList.push(userIds[e].userId);groupsService.userGroup({id:vm.groupsDetail.id,userIds:userList},"removeUser").then(function(response){if(ngDialog.close("ngdialog1"),null===response)return!0;vm.contentSetting=angular.copy(vm.originalContentSetting),vm.negative=!1,vm.contentSetting.user=[];for(var i=vm.groupsDetail.users.length-1;i>=0;i--)-1!==userList.indexOf(vm.groupsDetail.users[i].id)&&vm.groupsDetail.users.splice(i,1);for(var j=0;j<vm.groupList.length;j++)if(vm.groupsDetail.id===vm.groupList[j].id){vm.groupList[j].count=vm.groupsDetail.users.length;break}spValue.getAllEmployees=[],spValue.getAllCandidates=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("admin.group.profile.deleteMessage")),sharedProperties.fireAnalyticsEvent("PA | Groups remove user","N/A")})},vm.confirmDeleteUser=function(userIds,single){console.log("deleteUser")},vm.resetCreateNewGroup=function(cancel){vm.showCreateGroup=!cancel,vm.showRenameGroup=!1,vm.pageSetting.errornewEmptyGroup=!1,vm.pageSetting.errornewGroup=!1,vm.createGroupName=""},vm.renameGroupReset=function(rename){vm.showRenameGroup=!rename,vm.showCreateGroup=!1,vm.pageSetting.newEmptyGroup=!1,vm.pageSetting.newGroup=!1,vm.newGroupSelector=vm.groupsDetail.name},vm.includeCheck=function(status,area){var i=$.inArray(status,area);i>-1?area.splice(i,1):area.push(status),vm.searchListFn()},vm.searchListFn=function(searchClear){searchClear&&(vm.pageSetting.memberListSearch=""),vm.searchList=allMail.filter(function(e){return void 0===e.name&&(e.name=e.firstName+" "+e.lastName),-1===vm.hideMember.indexOf(e.id)&&(vm.pageSetting.modeSelected.length?-1!==vm.pageSetting.modeSelected.indexOf(e.type):e)&&sharedProperties.singleElementSearch(vm.pageSetting.memberListSearch,e,2)})},vm.makeMemberList=function(id){var added=$.inArray(id,vm.addedList);added>-1?vm.addedList.splice(added,1):vm.addedList.push(id)},vm.active=function(event,setting){vm.contentSetting.currentPredicate=setting.predicate,vm.contentSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.contentSetting.currentPredicate),vm.order(vm.contentSetting.currentPredicate,vm.contentSetting.lastReverse)},vm.order=function(predicate,reverse){vm.pageSetting.lastPredicate=predicate,vm.pageSetting.lastReverse=reverse;var orderedList=$filter("orderBy")(vm.groupsDetail.users,vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse);vm.groupsDetail.users=function(array,key){if("lastName"===key){for(var list=[],empty=[],i=0;i<array.length;i++)null!==array[i][key]&&""!==array[i][key]&&void 0!==array[i][key]?list.push(array[i]):empty.push(array[i]);return $.merge(list,empty)}return orderedList}(orderedList,vm.pageSetting.lastPredicate)},vm.pageCounter=function(pageSize,nosorting){void 0===nosorting&&vm.order(vm.contentSetting.currentPredicate,vm.contentSetting.lastReverse),vm.contentSetting.pageSize=pageSize,pageSize>=vm.groupsDetail.users.length&&(vm.contentSetting.disabledInfinite=!0,vm.contentSetting.pageSize=pageSize)},vm.checkAll=function(checked){vm.contentSetting.user=checked?vm.groupsDetail.users.map(function(item){return{userId:item.id,email:item.email,name:item.name,title:item.title,userStatus:item.userStatus}}):[]},vm.checkCount=function(checked){var userLength=vm.contentSetting.user.length;checked&&userLength+1===vm.groupsDetail.users.length?vm.negative=!0:vm.negative=!1},vm.sendEmailReminders=function(memberList){var option={type:"HiringCandidate"===memberList.type?"HiringCandidateReminder":"HiringEmployeeReminder"};commonService.sendEmail(option,memberList.id).then(function(response){if(null===response)return!0;memberList.lastRemindedOn=[moment().format("Y"),moment().format("M"),moment().format("D")]})},vm.viewMemberDetails=function(userId){$localStorage.set("empUserId",userId),scope.$parent.selectedGroupId=vm.activeGroup,scope.$parent.updateView("employeeDetailsModule",!1)},vm.deletePopup=function(){ngDialog.open({template:spConfig.talentAnalytics.groupService.dialog.deleteGroup,scope:vm})},vm.removeMultiMember=function(){ngDialog.open({template:spConfig.talentAnalytics.groupService.dialog.removeMulti,scope:vm})},vm.removeSingleMember=function(memberObj){vm.deleteMemberInfo=memberObj,ngDialog.open({template:spConfig.talentAnalytics.groupService.dialog.removeSingle,scope:vm})},vm.deleteModalSingle=function(member){vm.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteEmployeeSingle,scope:vm})},vm.deleteSingle=function(userId){var selectedUsersIds=[];selectedUsersIds.push(userId),vm.deleteCall(selectedUsersIds)},vm.archiveModalSingle=function(member){vm.selectedMemberInfo=member,vm.selectedMemberInfo.type=-1!==member.roles.indexOf("HiringCandidate")?"HiringCandidate":"Member",vm.userSelectedTags=[],updateUserSelectedTags(),ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.archiveEmployeeSingle,scope:vm})},vm.addedTag=function(tag){vm.userSelectedTags.push(tag.text),updateUserTags()},vm.removedTag=function(tag){vm.userSelectedTags.splice(vm.userSelectedTags.indexOf(tag.text),1),updateUserTags()},vm.loadSourceTags=function(query){var deferred=$q.defer(),result=vm.filterOptions.tagList.filter(function(e){return-1!==e.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise},vm.archiveSingle=function(userId){var selectedUsersIds=[];selectedUsersIds.push(userId),vm.archiveCall(selectedUsersIds)},vm.archiveCall=function(selectedUsersIds){memberService.archiveUser(selectedUsersIds).then(function(response){if("true"===response.Success){for(var i=0;i<vm.groupsDetail.users.length;i++)if(-1!==selectedUsersIds.indexOf(vm.groupsDetail.users[i].id)){vm.hideMember.push(vm.groupsDetail.users[i].id),vm.groupsDetail.users.splice(i,1);break}vm.contentSetting=angular.copy(vm.originalContentSetting),vm.negative=!1,vm.contentSetting.user=[],spValue.getAllCandidates=[],spValue.getAllEmployyes=[],spValue.getAllArchive=[];for(var j=0;j<vm.groupList.length;j++)if(vm.groupsDetail.id===vm.groupList[j].id){vm.groupList[j].count=vm.groupsDetail.users.length;break}ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.employeesArchived"))}else null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})},vm.deleteCall=function(selectedUsersIds){memberService.deleteMember(selectedUsersIds).then(function(response){if("true"===response.Success){for(var i=0;i<vm.groupsDetail.users.length;i++)if(-1!==selectedUsersIds.indexOf(vm.groupsDetail.users[i].id)){vm.hideMember.push(vm.groupsDetail.users[i].id),vm.groupsDetail.users.splice(i,1);break}vm.contentSetting=angular.copy(vm.originalContentSetting),vm.negative=!1,vm.contentSetting.user=[],spValue.getAllCandidates=[],spValue.getAllEmployyes=[];for(var j=0;j<vm.groupList.length;j++)if(vm.groupsDetail.id===vm.groupList[j].id){vm.groupList[j].count=vm.groupsDetail.users.length;break}ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("manageAccountContent.memberDeleted"))}else null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})},vm.addMembersModal=function(){vm.addedList=[],groupsService.getAllMembers({validOnly:!1}).then(function(response){if(null===response)return!0;vm.pageSetting=angular.copy(vm.originalPageSetting),vm.memberList=response.hiring,vm.memberListSearch="",updateSearchList(),ngDialog.open({template:spConfig.talentAnalytics.groupService.dialog.addMemberModalGroup,scope:vm})})},init("begin")}}}]);
angular.module("spApp").directive("peopleAnalyticsListing",["spConfig","ajaxService","sharedProperties","$q","$state","$localStorage",function(spConfig,ajaxService,sharedProperties,$q,$state,$localStorage){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/people-analytics/"+attrs.urlSrc},link:function(scope,element,attrs){var vm=scope;vm.activeView=null,vm.previousView=null,vm.selectedGroupId=null,vm.selectedRoleId=null,vm.permissionLevel=sharedProperties.checkPermission(),vm.clearPrintData=function(){$localStorage.remove("printEmail","printName")},vm.updateView=function(viewName,clearPrev,email){vm.clearPrintData(),vm.previousView=vm.activeView,vm.activeView=viewName,sharedProperties.fireAnalyticsEvent("PA | Tools",vm.activeView),email?$state.transitionTo(vm.activeView,{email:email},{reload:!0}):$state.transitionTo(vm.activeView)},vm.init=function(){var viewName="";null!==sharedProperties.getParam("userId")&&""!==sharedProperties.getParam("userId")?($localStorage.set("empUserId",sharedProperties.getParam("userId")),$localStorage.set("activeView","employeeDetailsModule"),window.location.href="/sp/pa/tools#/memberDetail"):(""===window.location.hash?(vm.activeView="employeesModule",$localStorage.set("activeView",vm.activeView)):(viewName=window.location.href.split("#/")[1],-1!==viewName.indexOf("?")&&(viewName=viewName.split("?")[0]),null!==$localStorage.get("activeView")?vm.activeView=$localStorage.get("activeView"):vm.activeView=viewName+"Module",$localStorage.set("activeView",vm.activeView)),$localStorage.remove("gdParam","portraitId"),$state.go(vm.activeView))};var stateNotFound=vm.$on("$stateNotFound",function(event){stateNotFound(),event.preventDefault(),vm.activeView=$localStorage.get("activeView")||"employeesModule",$state.transitionTo(vm.activeView)});vm.init()}}}]);
function prismLensEmployee($compile,$templateRequest,ajaxService,$filter,ngDialog,sharedProperties,$rootScope,$timeout,$q,$localStorage,spValue,spConfig,commonService,memberService){var controller=function($scope){function getAllFeedbackMembers(){self.getAllMembersToInvite.length||memberService.getAllEmployees().then(function(response){self.memberList=response;for(var i=0;i<self.memberList.length;i++)"VALID"!==self.memberList[i].userStatus&&"ASSESSMENT_PENDING"!==self.memberList[i].userStatus||self.activeUser.email===self.memberList[i].email||(self.getAllMembersToInvite.push(self.memberList[i]),$.each(self.feedbackTeamList,function(j){self.memberList[i].email===self.feedbackTeamList[j].email&&sharedProperties.spilceIndexWithBreak(self.getAllMembersToInvite,"email",self.memberList[i].email)}))})}function toggleView(memberObj){self.featuresSectionSelected!==memberObj.id?self.featuresSectionSelected=memberObj.id:self.featuresSectionSelected=-1,self.swotView?self.swotView=!1:getFeedbackDetails(memberObj)}function getFeedbackDetails(memberObj){var param={id:memberObj.id,archiveUser:self.archivedUser};ajaxService.getAjaxResponse({url:self.services.getFeedbackDetails,data:$.param(param)}).then(function(response){"true"===response.Success?(self.getInviteMemberDetail=response.hiringLens.lensResponse,self.swotMemId=memberObj.id,self.swotanalysis=response.hiringLens.lensResponse.swotanalysis,void 0!==response.hiringLens.lensResponse.swotanalysis&&(self.feedbackEnable=!0,self.swotView=!0)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function getFeedbackTeam(){var param={feedbackFor:self.activeUser.id};ajaxService.getAjaxResponse({url:self.services.getAllRequests,data:$.param(param)}).then(function(response){"true"===response.Success?(self.feedbackDataResponse=!0,self.feedbackTeamList=response.hiringLensListing):null!==response.error&&sharedProperties.ajaxError(response.error)})}function resetErrors(){self.formErrors={emailCheck:!1,firstName:!1,lastName:!1}}function showHideRequestFeedbackForm(){self.showRequestFeedbackForm=!self.showRequestFeedbackForm,resetErrors(),self.emailExists=!1,self.currentUser=!1,self.showNames=!1,self.selectedUser=null,self.showRequestFeedbackForm&&getAllFeedbackMembers()}function loadTags(query){self.showNames=!1,resetErrors();var deferred=$q.defer(),result=self.getAllMembersToInvite.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise}function tagAdded(tag){if(self.emailExists=!1,self.currentUser=!1,self.showNames=!1,tag.email.toLowerCase()===self.activeUser.email.toLowerCase()&&(self.currentUser=!0),!self.currentUser)for(var zz=0;zz<self.feedbackTeamList.length;zz++)if(tag.email.toLowerCase()===self.feedbackTeamList[zz].email.toLowerCase()){self.emailExists=!0;break}self.emailExists||self.currentUser||(self.searchTag.push(tag.email),self.selectedUser=tag,void 0!==tag.id&&null!==tag.id&&""!==tag.id||(self.showNames=!0))}function tagRemoved(tag){resetErrors(),self.emailExists=!1,self.currentUser=!1,self.showNames=!1,self.selectedUser=null,self.nameDataFormfirstName=null,self.nameDataFormlastName=null,self.searchTag.splice(self.searchTag.indexOf(tag.email),1)}function deleteConfirm(info){self.deleteInfo=info,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.prismLensDelete,scope:$scope})}function openRequestFeedback(){resetErrors(),self.showNames=!1,self.selectedUser=null,getAllFeedbackMembers(),ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.requestLens,scope:$scope})}function deleteFeedback(id){var param={id:id};ajaxService.getAjaxResponse({url:self.services.deleteRequest,data:$.param(param)}).then(function(response){"true"===response.Success?(sharedProperties.spilceIndexWithBreak(self.feedbackTeamList,"id",id),ngDialog.close(),self.getAllMembersToInvite=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("prismLens.feedbackDeleted")),sharedProperties.fireAnalyticsEvent("Action Plan | Create a new TODO from dashboard",self.activeUser.type)):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})}function sendEmailReminders(member){commonService.sendEmail({type:"HiringLensReminder"},member.id).then(function(response){if(null===response)return!0;sharedProperties.fireAnalyticsEvent("PA | Lens Send Reminder",self.activeUser.type),member.lastRemindedOn=[moment().format("Y"),moment().format("M"),moment().format("D")]})}function addReferenceForm(){self.candidateRefListSubmitted=!1,self.selfEmailAdded=!1,self.candidateRefDetail={firstName:null,lastName:null,email:null,phoneNumber:null,referenceType:null,feedbackFor:self.activeUser.id,requestNow:!1},ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.sendRequestReference,scope:$scope})}function processRefList(fData){self.candidateRefListSubmitted=!1,self.selfEmailAdded=!1,fData.$valid?self.candidateRefDetail.email!==self.activeUser.email?ajaxService.getAjaxResponse({url:self.services.submitFeedbackRequest,data:self.candidateRefDetail,headers:{"Content-Type":"application/json"}}).then(function(response){"true"===response.Success?(ngDialog.close("ngDialog1"),self.feedbackTeamList.push(response.hiringLens),sharedProperties.growlMessage($rootScope.pullInterNationalization("prismLens.memberInvited")),sharedProperties.fireAnalyticsEvent("PA | Request Prism Lens/Reference","HiringCandidate")):sharedProperties.ajaxError(response)}):self.selfEmailAdded=!0:self.candidateRefListSubmitted=!0}function sendRequest(memberId){ajaxService.getAjaxResponse({url:self.services.referenceSendRequest,data:$.param({id:memberId})}).then(function(response){"true"===response.Success?(getFeedbackTeam(),sharedProperties.growlMessage($rootScope.pullInterNationalization("prismLens.memberInvited")),sharedProperties.fireAnalyticsEvent("Manage Account | Request Prism Lens","N/A")):null!==response.error&&sharedProperties.ajaxError(response.error)})}function updateRefListDialog(memberObj){self.deleteInfo=angular.copy(memberObj),self.updateMemberListError=!1,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.updateRefListDialog,scope:$scope})}function updateRefList(fData){if(self.updateMemberListError=!1,self.selfEmailAdded=!1,fData.$valid)if(fData.email!==self.deleteInfo.email){var param={firstName:self.deleteInfo.firstName,lastName:self.deleteInfo.lastName,email:self.deleteInfo.email,id:self.deleteInfo.id,phoneNumber:self.deleteInfo.phoneNumber,referenceType:self.deleteInfo.referenceType,feedbackFor:self.activeUser.id};ajaxService.getAjaxResponse({url:self.services.updateLensProfile,data:param,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success){for(var i=0;self.feedbackTeamList.length;i++)if(self.feedbackTeamList[i].id===response.hiringLens.id){self.feedbackTeamList[i]=response.hiringLens;break}ngDialog.close("ngDialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.profileUpdated"))}else null!==response.error&&sharedProperties.ajaxError(response.error)})}else self.selfEmailAdded=!0;else self.updateMemberListError=!0}function sendRequestFeedbackAdmin(fName,lName){if(resetErrors(),void 0===self.selectedUser||null===self.selectedUser||""===self.selectedUser?self.formErrors.emailCheck=!0:(void 0!==self.selectedUser.email&&null!==self.selectedUser.email&&""!==self.selectedUser.email||(self.formErrors.emailCheck=!0),void 0!==self.selectedUser.id&&null!==self.selectedUser.id&&""!==self.selectedUser.id||(void 0===fName||null===fName||""===fName?self.formErrors.firstName=!0:(self.formErrors.firstName=!1,self.selectedUser.firstName=fName),void 0===lName||null===lName||""===lName?self.formErrors.lastName=!0:(self.formErrors.lastName=!1,self.selectedUser.lastName=lName))),!1===self.formErrors.emailCheck&&!1===self.formErrors.firstName&&!1===self.formErrors.lastName){var param={firstName:self.selectedUser.firstName,lastName:self.selectedUser.lastName,email:self.selectedUser.email,feedbackFor:self.activeUser.id,phoneNumber:self.selectedUser.phoneNumber,requestNow:!0};ajaxService.getAjaxResponse({url:self.services.submitFeedbackRequest,data:param,headers:{"Content-Type":"application/json"}}).then(function(response){"true"===response.Success?(getFeedbackTeam(),ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.lensRequestSent")),sharedProperties.spilceIndexWithBreak(self.getAllMembersToInvite,"email",self.selectedUser.email),sharedProperties.fireAnalyticsEvent("PA | Request Prism Lens/Reference","Member")):null!==response.error&&sharedProperties.ajaxError(response.error)})}}var self=this;self.services={getAllRequests:spConfig.talentAnalytics.memberService.getAllPrismLensRequests,getFeedbackDetails:spConfig.talentAnalytics.memberService.getPrismLensDetails,submitFeedbackRequest:spConfig.talentAnalytics.memberService.submitPrismLensFeedbackRequest,deleteRequest:spConfig.talentAnalytics.memberService.deletePrismLensRequest,referenceSendRequest:spConfig.talentAnalytics.memberService.referenceSendRequest,updateLensProfile:spConfig.talentAnalytics.memberService.updateLensProfile},self.getAllFeedbackMembers=getAllFeedbackMembers,self.getFeedbackTeam=getFeedbackTeam,self.getFeedbackDetails=getFeedbackDetails,self.feedbackEnable=!1,self.formErrors={emailCheck:!1,firstName:!1,lastName:!1},self.candidateRefDetail={firstName:null,lastName:null,email:null,phoneNumber:null,referenceType:null,feedbackFor:null,requestNow:!1},self.candidateRef=["manager","colleague_peer","direct_report","professor","advisor_coach","client_customer"],self.selfEmailAdded=!1,self.candidateRefListSubmitted=!1,self.activeUser=$localStorage.get("activeEmp"),self.archivedUser=null!==$localStorage.get("archiveUser"),self.showHideRequestFeedbackForm=showHideRequestFeedbackForm,self.sendRequestFeedbackAdmin=sendRequestFeedbackAdmin,self.deleteConfirm=deleteConfirm,self.sendEmailReminders=sendEmailReminders,self.deleteFeedback=deleteFeedback,self.toggleView=toggleView,self.openRequestFeedback=openRequestFeedback,self.addReferenceForm=addReferenceForm,self.processRefList=processRefList,self.sendRequest=sendRequest,self.updateRefListDialog=updateRefListDialog,self.updateRefList=updateRefList,self.loadTags=loadTags,self.tagAdded=tagAdded,self.tagRemoved=tagRemoved,self.showNames=!1,self.searchTag=[],self.selectedUser={},self.showRequestFeedbackForm=!1,self.nameDataForm={},self.feedbackDataResponse=!1,self.featuresSectionSelected=-1,self.getAllMembersToInvite=[],self.swotView=!1,self.memberList=[],self.feedbackTeamList=[],self.emailExists=!1,self.currentUser=!1};return controller.$inject=["$scope"],{restrict:"EA",link:function($scope,$element,$attrs){$templateRequest("/sp/resources/html/people-analytics/view/"+$attrs.urlSrc).then(function(html){var template=angular.element(html);$element.append(template),$compile(template)($scope)})},controller:controller,controllerAs:"ctrl",bindToController:!0}}prismLensEmployee.$inject=["$compile","$templateRequest","ajaxService","$filter","ngDialog","sharedProperties","$rootScope","$timeout","$q","$localStorage","spValue","spConfig","commonService","memberService"],angular.module("spApp").directive("prismLensEmployee",prismLensEmployee);
angular.module("spApp").directive("roleDetails",["sharedProperties","memberService","commonService","$rootScope","spConfig","spValue","ngDialog","$filter","$localStorage","$q","groupsService","$timeout","idealPortraitService","$state","rolesService",function(sharedProperties,memberService,commonService,$rootScope,spConfig,spValue,ngDialog,$filter,$localStorage,$q,groupsService,$timeout,idealPortraitService,$state,rolesService){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/people-analytics/"+attrs.urlSrc},link:function(scope,element,attrs){function subscriptionCount(){memberService.getSubcription().then(function(response){vm.subscriptionCount=response.availableHiringSubscripitons})}function resetHireForm(obj){vm.addCandidate=angular.copy(newCandidate),vm.hireSubmitted=!1,vm.existingCandidate=!1,void 0!==obj&&(vm.addCandidate.hiringValues.firstName=obj.firstName,vm.addCandidate.hiringValues.lastName=obj.lastName,vm.addCandidate.hiringValues.email=obj.email,vm.addCandidate.hiringValues.title=obj.title,vm.addCandidate.hiringValues.id=obj.id)}function memberOperation(response){vm.returnMemberList(vm.pageSetting.pageSize),vm.responseReceived=!0}function updateSearchList(){allMail=angular.copy(vm.roleList);for(var i=0;i<vm.memberList.length;i++)for(var j=vm.roleList.length-1;j>=0;j--)if(vm.memberList[i].id===vm.roleList[j].id){delete allMail[j];break}vm.searchListFn()}function init(){vm.selectedRoleId=$state.params.id||$localStorage.get("selectedRoleId"),vm.getRoleDetails(vm.selectedRoleId)}var vm=scope,allMail=[];vm.selectedRoleId=null,vm.responseReceived=!1,vm.selectedRoleDetails={},vm.masterMemberList=[],vm.memberList=[],vm.hideMember=[],vm.selectedObj=null;var newCandidate={referenceRequest:{start:[0],max:2},referenceArray:["manager","colleague_peer","direct_report","professor","advisor_coach","client_customer"],emailErrors:{isExisting:!1,isInvalid:!1,required:!1,countExceed:!1,dateCheck:!1,roleRequired:!1},hiringValues:{firstName:null,lastName:null,email:null,title:null,id:null},formValues:{emails:[],dueBy:null,dueDisplayed:null,tags:[],type:"HiringCandidate",roleIds:[],referenceTypes:[],referenceCheck:!1,tagList:[]}};vm.shareProfileObj={},vm.pageSetting={pageSize:10,lastPredicate:"lastName",lastReverse:!1,disabledInfinite:!1,dateRangeSelected:!1,textSearching:"",user:[],searchGroupsFilters:[],userGroupSelected:[],selectedTitles:[],searchTitlesFilter:"",searchTag:[],heightParam:800,userRoleSelected:[],searchRoleFilters:[],userStatusSelected:[],myCandidate:!1,roleListSearch:"",modeSelected:[]},vm.selfEmail="",vm.noteObj={userId:null,comment:null,cid:null},vm.noteSubmitted=!1,vm.originalpageSetting=angular.copy(vm.pageSetting),vm.negative=!1,vm.checkedAll=!1,vm.allUsersMenu=!1,vm.masterCopy=!0,vm.portraitSearch="",vm.portraitsListing=[],vm.viewPortraitFlag=!1,vm.selectedPortrait={},vm.selectedUserPortrait={},vm.selectedRole={},vm.portraitSelected=!1,vm.selectedPortraitId=null,vm.portraitSearch="",vm.portraitSelected=!1,vm.showCompareOpt=!1,vm.noErti=null!==$localStorage.get("noErti"),vm.candidateImage=spConfig.image.candidateDefault,vm.employeeImage=spConfig.image.default,vm.whiteSpace=function(text){return/\s/.test(text)},vm.showAssignPortraitModal=function(rolesObj){vm.getAllPortraits(rolesObj)},vm.getAllPortraits=function(rolesObj){idealPortraitService.getAll().then(function(response){if(null===response)return!0;vm.portraitsListing=response,$timeout(function(){vm.assignPortraitModal(rolesObj)},100)})},vm.assignPortraitModal=function(roleObj){vm.selectedRole=roleObj,vm.portraitSelected=!1,vm.selectedPortraitId=null,ngDialog.open({template:spConfig.talentAnalytics.roles.dialog.assignPortrait,scope:vm})},vm.assignPortrait=function(){rolesService.assignPortrait({id:vm.selectedRole.id,portraitId:vm.selectedPortraitId,addPrism:!1}).then(function(response){if(null===response)return!0;vm.getRoleDetails(vm.selectedRoleDetails.id),ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.portraitAssigned")),sharedProperties.fireAnalyticsEvent("PA | Role Detail Assign Portrait","N/A")})},vm.selectPortrait=function(id){vm.portraitSelected||(vm.portraitSelected=!0,vm.selectedPortraitId=id)},vm.removeSelectedPortrait=function(){vm.portraitSelected=!1,vm.selectedPortraitId=null},vm.checkAll=function(checked){vm.pageSetting.user=checked?vm.memberList.map(function(item){return{userId:item.id,email:item.email,name:item.name,title:item.title}}):[]},vm.checkCount=function(checked){var userLength=vm.pageSetting.user.length;checked&&userLength+1===vm.memberList.length?vm.negative=!0:vm.negative=!1},vm.viewMemberDetails=function(userId){$localStorage.set("empUserId",userId),scope.$parent.selectedRoleId=vm.selectedRoleId,sharedProperties.fireAnalyticsEvent("PA | Role Detail View Portrait","N/A"),scope.$parent.updateView("employeeDetailsModule",!1)},vm.compareMember=function(userId){memberService.getProfileInfo(userId,!1).then(function(response){$localStorage.set("activeEmp",response.hiringUser),sharedProperties.fireAnalyticsEvent("PA | Role Detail Compare","N/A"),scope.$parent.updateView("employeeCompare",!1,response.hiringUser.email)})},vm.notePopup=function(member){vm.selectedMemberInfo=member,vm.noteObj.userId=member.id,vm.noteSubmitted=!1,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.addNote,scope:vm}).closePromise.then(function(){vm.noteObj.comment=""})},vm.postNote=function(){vm.noteSubmitted=!0,null!==vm.noteObj.comment&&""!==vm.noteObj.comment&&memberService.addNote(vm.noteObj).then(function(response){"true"===response.Success?(vm.noteSubmitted=!1,ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("notes.ajaxMessage.noteSaved")),sharedProperties.fireAnalyticsEvent("PA | Role Detail Add Note","N/A")):null!==response.error&&(vm.noteSubmitted=!1,ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})},vm.deleteModalSingle=function(member){vm.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteEmployeeSingle,scope:vm})},vm.deleteModalMultiple=function(){ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteEmployeeMultiple,scope:vm})},vm.deleteSingle=function(userId){var selectedUsersIds=[];selectedUsersIds.push(userId),vm.deleteCall(selectedUsersIds)},vm.deleteMultiMembers=function(){for(var selectedUsersIds=[],i=0;i<vm.pageSetting.user.length;i++)selectedUsersIds.push(vm.pageSetting.user[i].userId);vm.deleteCall(selectedUsersIds)},vm.deleteCall=function(selectedUsersIds){memberService.deleteMember(selectedUsersIds).then(function(response){if("true"===response.Success){var templList=angular.copy(vm.masterMemberList),tempList0=[];$.each(templList,function(i,j){-1===$.inArray(templList[i].id,selectedUsersIds)&&tempList0.push(templList[i])}),vm.masterMemberList=angular.copy(tempList0),vm.negative=!1,vm.pageSetting.user=[],vm.returnMemberList(vm.pageSetting.pageSize),spValue.getAllCandidates=[],ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("manageAccountContent.memberDeleted"))}else null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})},vm.archiveModalSingle=function(member){vm.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.archiveEmployeeSingle,scope:vm})},vm.archiveModalMultiple=function(){ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.archiveEmployeeMultiple,scope:vm})},vm.archiveSingle=function(userId){var selectedUsersIds=[];selectedUsersIds.push(userId),vm.archiveCall(selectedUsersIds)},vm.archiveMultiMembers=function(){for(var selectedUsersIds=[],i=0;i<vm.pageSetting.user.length;i++)selectedUsersIds.push(vm.pageSetting.user[i].userId);vm.archiveCall(selectedUsersIds)},vm.archiveCall=function(selectedUsersIds){memberService.archiveUser(selectedUsersIds).then(function(response){if("true"===response.Success){var templList=angular.copy(vm.masterMemberList),tempList0=[];$.each(templList,function(i,j){-1===$.inArray(templList[i].id,selectedUsersIds)&&tempList0.push(templList[i])}),vm.masterMemberList=angular.copy(tempList0),vm.negative=!1,vm.pageSetting.user=[],vm.returnMemberList(vm.pageSetting.pageSize),spValue.getAllCandidates=[],spValue.getAllArchive=[],ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.employeesArchived"))}else null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})},vm.hiringDialogs=function(type,userObj){vm.addCandidate=angular.copy(newCandidate),vm.deleteMemberInfo=void 0!==userObj?userObj:{},"hire"===type?(resetHireForm(userObj),ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog[type],scope:vm})):ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog[type],scope:vm})},vm.hireCandidate=function(){vm.hireSubmitted=!1,vm.existingCandidate=!1,this.hireCandidateForm.$valid?memberService.hireCandidate({id:vm.addCandidate.hiringValues.id,firstName:vm.addCandidate.hiringValues.firstName,lastName:vm.addCandidate.hiringValues.lastName,title:vm.addCandidate.hiringValues.title,email:vm.addCandidate.hiringValues.email,tags:vm.addCandidate.formValues.tags.toString()}).then(function(response){void 0!==response.error&&null!==response.error?(vm.existingCandidate=!0,vm.hireSubmitted=!0):(ngDialog.close("ngdialog1"),spValue.getAllEmployees=[],spValue.getAllCandidates=[],vm.getRoleDetails(vm.selectedRoleDetails.id),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.candidateHired")),sharedProperties.fireAnalyticsEvent("PA | Role Detail Candidate Hired","N/A"))}):vm.hireSubmitted=!0},vm.shareProfile=function(memberList){memberService.getAllEmployees().then(function(response){vm.employeeList=response,memberService.getUserShareList({userId:memberList.id}).then(function(response){if(null===response)return!0;vm.selectedMemberInfo=memberList,vm.shareLinkEmail={},vm.shareLinkEmailForm={submitted:!1,required:!1,candidate:!1},vm.feedbackUser=response.feedbackUser,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.shareUserId,scope:vm})})})},vm.sharePortraitOtherFn=function(){if(vm.shareLinkEmailForm.submitted=!1,vm.shareLinkEmailForm.candidate=!1,vm.shareLinkEmailForm.required=!1,void 0===vm.shareLinkEmail.email)return vm.shareLinkEmailForm.required=!0,void(vm.shareLinkEmailForm.submitted=!0);for(var i=0;i<vm.masterMemberList.length;i++)if(vm.masterMemberList[i].email===vm.shareLinkEmail.email)return vm.shareLinkEmailForm.candidate=!0,void(vm.shareLinkEmailForm.submitted=!0);this.shareApprovalForm.$valid?memberService.shareUserProfile({firstName:vm.shareLinkEmail.firstName,lastName:vm.shareLinkEmail.lastName,email:vm.shareLinkEmail.email,userFor:vm.selectedMemberInfo.id}).then(function(response){if(void 0!==response.error&&null!==response.error)return!0;vm.feedbackUser.push(response.feedbackUser),ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.portraitShared")),sharedProperties.fireAnalyticsEvent("PA | Role Detail Share Profile","N/A")}):vm.shareLinkEmailForm.submitted=!0},vm.feedbackUserRemovedDialog=function(member){vm.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.deleteEmployeeSingle,scope:vm})},vm.feedbackUserRemoved=function(userId){memberService.shareFeedbackRemoved({userId:userId}).then(function(response){for(var i=0;i<vm.feedbackUser.length;i++)if(vm.feedbackUser[i].id===userId){vm.feedbackUser.splice(i,1),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.portraitSharedRemoved"));break}})},vm.sendProfilePortrait=function(){commonService.sendEmail({type:"HiringSharePortrait"},vm.selectedMemberInfo.id).then(function(response){if(ngDialog.close("ngdialog1"),null===response)return!0;sharedProperties.fireAnalyticsEvent("PA | Role Detail Share portrait","N/A")})},vm.sharePortrait=function(memberList){memberService.getShareId({userId:memberList.id}).then(function(response){if(null===response)return!0;vm.selectedMemberInfo=memberList,vm.shareProfileUrl=window.location.origin+"/sp/profilePublic/"+response.hiringPublicId,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.shareProfileId,scope:vm})})},vm.viewReport=function(portraitData,userData){vm.selectedPortrait=portraitData,vm.selectedUserPortrait=userData,vm.viewPortraitFlag=!0,$("html,body").animate({scrollTop:$(".col-content-wrapper").offset().top-20},1e3),sharedProperties.fireAnalyticsEvent("PA | Role Detail Ideal portrait","N/A")},vm.closeReportView=function(){vm.viewPortraitFlag=!1,vm.selectedPortrait={},vm.selectedUserPortrait={}},vm.sendEmailReminders=function(memberList){commonService.sendEmail({type:"HiringCandidateReminder"},memberList.id).then(function(response){if(null===response)return!0;sharedProperties.fireAnalyticsEvent("PA | Role Detail Send Reminder","N/A"),memberList.lastRemindedOn=[moment().format("Y"),moment().format("M"),moment().format("D")]})},vm.returnMemberList=function(){if(!vm.masterMemberList.length)return!0;vm.pageSetting.pageSize=vm.originalpageSetting.pageSize,vm.pageSetting.disabledInfinite=!1;var result=vm.masterCopy?vm.masterMemberList:vm.memberList;vm.memberList=result.filter(function(e){return sharedProperties.singleElementSearch(vm.pageSetting.textSearching,e,2)}),vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse),vm.pageSetting.user.length!==vm.memberList.length&&(vm.negative=!1),vm.masterCopy=!0},vm.order=function(predicate,reverse){vm.pageSetting.lastPredicate=predicate,vm.pageSetting.lastReverse=reverse;var orderedList=$filter("orderBy")(vm.memberList,vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse);vm.memberList=function(array,key){if("lastName"===key){for(var list=[],empty=[],i=0;i<array.length;i++)null!==array[i][key]&&""!==array[i][key]&&void 0!==array[i][key]?list.push(array[i]):empty.push(array[i]);return $.merge(list,empty)}return orderedList}(orderedList,vm.pageSetting.lastPredicate)},vm.active=function(event,setting){vm.pageSetting.lastPredicate=setting.predicate,vm.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.pageSetting.lastPredicate),vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)},vm.infinteScroll=function(pageSize){vm.pageSetting.disabledInfinite||(vm.pageSetting.pageSize=pageSize,pageSize>=vm.masterMemberList.length&&(vm.pageSetting.disabledInfinite=!0,vm.pageSetting.pageSize=vm.masterMemberList.length))},vm.closeRolesListView=function(){scope.$parent.updateView("rolesPAModule",!1)},vm.getRoleDetails=function(id){rolesService.get({id:id}).then(function(response){if(null===response)return scope.$parent.updateView("rolesPAModule",!1),!0;vm.selectedRoleDetails=response.hiringRole,vm.masterMemberList=response.hiringRole.users,vm.memberList=angular.copy(vm.masterMemberList);var validList=[];validList=vm.memberList.map(function(e){return"VALID"===e.userStatus}),vm.showCompareOpt=!!validList.length,memberOperation(response.memberList),subscriptionCount()})},vm.tagShareAdded=function(tag){vm.shareLinkEmail=tag},vm.tagShareRemoved=function(tag){vm.shareLinkEmail=null},vm.loadNames=function(query){for(var deferred=$q.defer(),result=[],i=0;i<vm.employeeList.length&&result.length<5;i++)if("VALID"===vm.employeeList[i].userStatus&&(-1!==vm.employeeList[i].name.toLowerCase().indexOf(query.toLowerCase())||-1!==vm.employeeList[i].email.toLowerCase().indexOf(query.toLowerCase()))){for(var j=0,count=0;j<vm.feedbackUser.length;j++)vm.feedbackUser[j].email===vm.employeeList[i].email&&count++;0===count&&result.push(vm.employeeList[i])}return deferred.resolve(result),deferred.promise},vm.viewCompare=function(compareId,compareType){vm.compareTypeAttr=compareType,vm.compareTypeId=compareId,sharedProperties.fireAnalyticsEvent("PA | Role Detail Compare Portraits","N/A"),ngDialog.open({template:spConfig.talentAnalytics.roles.dialog.rolesCompareOverlay,scope:vm,className:"roles-compare-full-view"})},vm.addMembersRoleModal=function(){vm.addedList=[],groupsService.getAllMembers({validOnly:!1}).then(function(response){if(null===response)return!0;vm.pageSetting=angular.copy(vm.originalpageSetting),vm.roleList=response.hiring,vm.pageSetting.roleListSearch="",updateSearchList(),ngDialog.open({template:spConfig.talentAnalytics.roles.dialog.addMemberModalGroup,scope:vm})})},vm.includeCheck=function(status,area){var i=$.inArray(status,area);i>-1?area.splice(i,1):area.push(status),vm.searchListFn()},vm.searchListFn=function(searchClear){searchClear&&(vm.pageSetting.roleListSearch=""),vm.searchList=allMail.filter(function(e){return void 0===e.name&&(e.name=e.firstName+" "+e.lastName),-1===vm.hideMember.indexOf(e.id)&&(vm.pageSetting.modeSelected.length?-1!==vm.pageSetting.modeSelected.indexOf(e.type):e)&&sharedProperties.singleElementSearch(vm.pageSetting.roleListSearch,e,2)})},vm.makeMemberList=function(id){var added=$.inArray(id,vm.addedList);added>-1?vm.addedList.splice(added,1):vm.addedList.push(id)},vm.addUserToRole=function(){rolesService.addRoleToUser({id:vm.selectedRoleDetails.id,userIds:vm.addedList},"addUser").then(function(response){if(ngDialog.close("ngdialog1"),null===response)return!0;vm.pageSetting=angular.copy(vm.originalpageSetting),vm.getRoleDetails(vm.selectedRoleDetails.id),spValue.getAllEmployees=[],spValue.getAllCandidates=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.roleAdded")),sharedProperties.fireAnalyticsEvent("PA | User added to role: "+vm.selectedRoleDetails.id,"N/A")})},vm.removeUserDialog=function(memberObj){vm.selectedObj=memberObj,ngDialog.open({template:spConfig.talentAnalytics.roles.dialog.removeRole,scope:vm})},vm.removeUserFromRole=function(){rolesService.removeRole({userId:vm.selectedObj.id,roleId:vm.selectedRoleDetails.id}).then(function(response){if(ngDialog.close("ngdialog1"),null===response)return!0;for(var i=0;i<vm.masterMemberList.length;i++)if(vm.masterMemberList[i].id===vm.selectedObj.id){vm.masterMemberList.splice(i,1);break}vm.memberList=angular.copy(vm.masterMemberList),memberOperation(vm.masterMemberList),subscriptionCount(),spValue.getAllEmployees=[],spValue.getAllCandidates=[],sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.roleRemoved")),sharedProperties.fireAnalyticsEvent("PA | User removed from role: "+vm.selectedRoleDetails.id,"N/A")})},vm.addToErtiPop=function(member){vm.selectedMemberInfo=member,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.addToErti,scope:vm})},vm.addToErti=function(userId){memberService.addToErti(userId).then(function(response){if("true"===response.Success){ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.employeesAddToErti")),sharedProperties.fireAnalyticsEvent("PA | Employee Add to ERT-i","N/A"),spValue.getAllEmployees=[],spValue.getAllMembersForGroups=[];for(var i=0;i<vm.masterMemberList.length;i++)if(vm.masterMemberList[i].id===userId){vm.masterMemberList.splice(i,1);break}vm.memberList=angular.copy(vm.masterMemberList),memberOperation(vm.masterMemberList),subscriptionCount()}else null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})},init()}}}]);
angular.module("spApp").directive("compareOverlay",["sharedProperties","memberService","commonService","$rootScope","spConfig","spValue","ngDialog","$filter","$localStorage","$q","groupsService","$timeout","idealPortraitService","$state","rolesService",function(sharedProperties,memberService,commonService,$rootScope,spConfig,spValue,ngDialog,$filter,$localStorage,$q,groupsService,$timeout,idealPortraitService,$state,rolesService){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/people-analytics/"+attrs.urlSrc},link:function(scope,element,attrs){function matchSort(order){vm.memberList.sort(function(a,b){var af=a.matchResult.matchPercent,bf=b.matchResult.matchPercent;switch(order){case"asc":return af===bf?0:+(af>bf)||-1;case"dsc":return af===bf?0:+(af<bf)||-1}})}function compareOperation(){vm.returnMemberList(vm.pageSetting.pageSize),vm.responseReceived=!0}function rolesInit(customUserFilter){vm.compareRoleId=vm.compareId,vm.getRolesCompare(vm.compareRoleId),vm.filteredRolesUsersList=angular.copy(vm.parentScope.pageSetting.user).map(function(e){return e.email})}function groupsInit(){groupsService.getGroupCompare({id:vm.compareId}).then(function(response){if(null===response)return!0;vm.masterMemberList=response.hiringGroupListing,vm.memberList=angular.copy(vm.masterMemberList),vm.filteredUsersList=angular.copy(vm.parentScope.contentSetting.user).map(function(e){return e.email}),compareOperation()})}function init(type){switch(type){case"roles":rolesInit();break;case"groups":groupsInit();break;default:rolesInit()}}var vm=scope;vm.parentScope=scope.$parent,vm.compareType=attrs.type,vm.compareId=attrs.id,vm.compareRoleId=null,vm.compareDetails={},vm.responseReceived=!1,vm.pageSetting={pageSize:12,lastPredicate:"name",lastReverse:!1,disabledInfinite:!1,textSearching:"",filterOptions:null},vm.originalpageSetting=angular.copy(vm.pageSetting),vm.gridLastCol=0,vm.gridClearCol=0,vm.gridUpdated=!1,vm.graphType=-1,vm.graphSelector=null,vm.motivationGraphType="why",vm.motivationGraphSelected="why",vm.graphLabelList={learning:[]},vm.filteredUsersList=[],vm.filteredRolesUsersList=[],function(){$(window).resize(function(){$timeout(function(){$(".roles-compare-view, .roles-compare-wrapper").css({"min-height":$(window).outerHeight()}),$(window).width()>=1400&&scope.$apply(function(){vm.gridLastCol=Math.floor($(".roles-compare-listing").outerWidth()/350),vm.gridClearCol=vm.gridLastCol+1}),$(window).width()<1400&&scope.$apply(function(){vm.gridLastCol=3,vm.gridClearCol=4}),$(window).width()<1107&&scope.$apply(function(){vm.gridLastCol=2,vm.gridClearCol=3})},100)})}(),vm.getGraphLabel=function(graphObj,memberId,graphType){"learning"===graphType&&(vm.graphLabelList.learning[memberId]=Object.keys(graphObj).reduce(function(a,b){return graphObj[a]>graphObj[b]?a:b}))},vm.customOrderBy=function(sort){switch(vm.pageSetting.textSearching="",sort){case"matchAO":matchSort("asc");break;case"matchDO":matchSort("dsc");break;case"nameDO":vm.order("name",!0);break;default:vm.pageSetting.filterOptions=null,vm.order("name",!1)}},vm.displayMotivationGraph=function(grpahType){vm.motivationGraphSelected=grpahType},vm.updateGraphs=function(id){void 0===id||null===id||""===id?vm.graphType=-1:parseInt(id,10)!==vm.graphType&&(vm.graphType=parseInt(id,10)),vm.motivationGraphType="why",vm.motivationGraphSelected="why"},vm.updateCompareLayout=function(){$(".roles-compare-view, .roles-compare-wrapper").css({"min-height":$(window).outerHeight()}),$(window).width()<1400&&(vm.gridLastCol=3,vm.gridClearCol=4),$(window).width()<1107&&(vm.gridLastCol=2,vm.gridClearCol=3),$(window).width()>=1400&&(vm.gridLastCol=Math.floor($(".roles-compare-listing").outerWidth()/335),vm.gridClearCol=vm.gridLastCol+1)},vm.order=function(predicate,reverse){vm.pageSetting.lastPredicate=predicate,vm.pageSetting.lastReverse=reverse;var orderedList=$filter("orderBy")(vm.memberList,vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse);vm.memberList=function(array,key){if("name"===key){for(var list=[],empty=[],i=0;i<array.length;i++)null!==array[i][key]&&""!==array[i][key]&&void 0!==array[i][key]?list.push(array[i]):empty.push(array[i]);return $.merge(list,empty)}return orderedList}(orderedList,vm.pageSetting.lastPredicate)},vm.active=function(event,setting){vm.pageSetting.lastPredicate=setting.predicate,vm.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.pageSetting.lastPredicate),vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)},vm.infinteScroll=function(pageSize){vm.pageSetting.disabledInfinite||(vm.pageSetting.pageSize=pageSize,pageSize>=vm.masterMemberList.length&&(vm.pageSetting.disabledInfinite=!0,vm.pageSetting.pageSize=vm.masterMemberList.length)),$timeout(function(){vm.updateCompareLayout()},200)},vm.returnMemberList=function(){if(!vm.masterMemberList.length)return!0;vm.pageSetting.pageSize=vm.originalpageSetting.pageSize,vm.pageSetting.disabledInfinite=!1;var result=vm.masterCopy?vm.masterMemberList:vm.memberList;"groups"===vm.compareType?vm.memberList=result.filter(function(e){return"VALID"===e.userStatus&&-1!==vm.filteredUsersList.indexOf(e.email)&&sharedProperties.singleElementSearch(vm.pageSetting.textSearching,e,2)}):vm.memberList=result.filter(function(e){return"VALID"===e.userStatus&&-1!==vm.filteredRolesUsersList.indexOf(e.email)&&sharedProperties.singleElementSearch(vm.pageSetting.textSearching,e,2)}),vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse),vm.masterCopy=!0,$timeout(function(){vm.updateCompareLayout()},200)},vm.closeRolesCompareView=function(){ngDialog.closeAll(),"roles"===vm.compareType&&($localStorage.set("selectedRoleId",vm.compareRoleId),$state.transitionTo("roleDetails",{id:vm.compareRoleId},{reload:!0}))},vm.getRolesCompare=function(id){rolesService.get({id:id,addPrism:!0}).then(function(response){if(null===response)return!0;vm.compareDetails=response.hiringRole,vm.masterMemberList=response.hiringRole.users,vm.memberList=angular.copy(vm.masterMemberList),compareOperation()})},init(vm.compareType)}}}]);
angular.module("spApp").directive("rolesList",["ajaxService","sharedProperties","rolesService","$rootScope","spConfig","spValue","ngDialog","$filter","basicService","$localStorage","$state","idealPortraitService","$q",function(ajaxService,sharedProperties,rolesService,$rootScope,spConfig,spValue,ngDialog,$filter,basicService,$localStorage,$state,idealPortraitService,$q){var rolesList={restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/people-analytics/"+attrs.urlSrc},link:function(scope,element,attrs){function roleOperation(){getFilterValue(),self.returnRoleList(self.contentSetting.pageSize),self.responseRecieved=!0}function getFilterValue(){for(var portraitsFilter=[],arr=[],i=0;i<self.masterRolesList.length;i++)null!==self.masterRolesList[i].portrait&&portraitsFilter.push(self.masterRolesList[i].portrait);for(var kk=0;kk<portraitsFilter.length;kk++)arr[portraitsFilter[kk].id]=portraitsFilter[kk];for(var key in arr)"object"==typeof arr[key]&&self.portraitFilterList.push(arr[key])}function filterPortrait(portrait){return null!==portrait&&-1!==self.contentSetting.portraitSelected.indexOf(portrait.id)}function noDuplicates(name,isUpdate){var nameFound=!1;if(!isUpdate)for(var i=0;i<self.masterRolesList.length;i++)if(self.masterRolesList[i].name.toLowerCase()===name.toLowerCase()){nameFound=!0,sharedProperties.growlMessage($rootScope.pullInterNationalization("error.hire.role.exist"),"","glyphicon glyphicon-ban-circle");break}return nameFound}function getAllPortraits(){idealPortraitService.getAll().then(function(response){if(null===response)return!0;self.portraitsListing=response})}var self=scope;self.responseRecieved=!1,self.contentSetting={userSearching:"",pageSize:10,intialVal:10,lastReverse:!1,currentPredicate:"name",disabledInfinite:!1,user:[],portraitSelected:[],searchPortraitFilters:[],searchTag:[],heightParam:800,textSearching:"",updateSearchText:""},self.selectedFilterList=[],self.originalpageSetting=angular.copy(self.contentSetting),self.loadCreateRole=!1,self.formSubmit=!1,self.newRole={form:{},details:{description:"",portraitId:""}},self.masterRolesList=[],self.portraitFilterList=[],self.rolesList=[],self.deleteRoleDetails=null,self.isUpdate=!1,self.submitError=!1,self.selectedRole={},self.selectedPortraitId=null,self.portraitsListing=[],self.masterCopy=!0,self.portraitSearch="",self.portraitSelected=!1,self.portraitDisplayName="",self.updateSearchVal=function(searchTxt){self.contentSetting.updateSearchText=void 0!==searchTxt&&""!==searchTxt?window.escape(searchTxt):""},self.resetUpdatedSearchVal=function(){self.contentSetting.updateSearchText=""},self.viewRoleDetails=function(roleId){$localStorage.set("selectedRoleId",roleId),$state.transitionTo("roleDetails",{id:roleId},{reload:!0})},self.deletePopup=function(data){self.deleteRoleDetails=data,ngDialog.open({template:spConfig.talentAnalytics.roles.dialog.delete,scope:self})},self.returnRoleList=function(pageSize){if(!self.masterRolesList.length)return!0;self.contentSetting.pageSize=self.originalpageSetting.pageSize,self.contentSetting.disabledInfinite=!1;var result=self.masterCopy?self.masterRolesList:self.rolesList;self.rolesList=result.filter(function(e){return self.contentSetting.portraitSelected.length&&filterPortrait(e.portrait)||!self.contentSetting.portraitSelected.length&&e}),self.order(self.contentSetting.currentPredicate,self.contentSetting.lastReverse),self.masterCopy=!0},self.deleteRole=function(data){rolesService.deleteRole(data).then(function(response){if(ngDialog.close("ngdialog1"),null===response)return!0;sharedProperties.spilceIndexWithBreak(self.masterRolesList,"id",data.id),self.rolesList=angular.copy(self.masterRolesList),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.roleDeleted")),sharedProperties.fireAnalyticsEvent("PA | Roles Delete","N/A")})},self.active=function(event,setting){self.contentSetting.currentPredicate=setting.predicate,self.contentSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.contentSetting.currentPredicate),self.order(self.contentSetting.currentPredicate,self.contentSetting.lastReverse)},self.order=function(predicate,reverse){self.contentSetting.currentPredicate=predicate,self.contentSetting.lastReverse=reverse;var orderedList=$filter("orderBy")(self.rolesList,self.contentSetting.currentPredicate,self.contentSetting.lastReverse);self.rolesList=function(array,key){if("name"===key){for(var list=[],empty=[],i=0;i<array.length;i++)null!==array[i][key]&&""!==array[i][key]&&void 0!==array[i][key]?list.push(array[i]):empty.push(array[i]);return $.merge(list,empty)}return orderedList}(orderedList,self.contentSetting.currentPredicate)},self.pageCounter=function(pageSize,nosorting){void 0===nosorting&&self.order(self.contentSetting.currentPredicate,self.contentSetting.lastReverse),self.contentSetting.pageSize=pageSize,pageSize>=rolesList.length&&(self.contentSetting.disabledInfinite=!0,self.contentSetting.pageSize=pageSize)},self.includeCheck=function(param,setting,cache){var i=$.inArray(param,self.contentSetting[setting]);i>-1?self.contentSetting[setting].splice(i,1):(self.contentSetting[setting].push(param),self.masterCopy=!cache),self.manageFilterDisplayList(setting),self.returnRoleList(self.contentSetting.pageSize)},self.closeRest=function(index,noScroll){var val=void 0===noScroll?0:1;$(".accordian-checkbox").each(function(i){i!==$(index.currentTarget.parentNode).index()-val&&$(this).prop("checked",!0)})},self.clear=function(classS,property,search){self.contentSetting[property]=[],self.manageFilterDisplayList(property),void 0!==search&&(self.contentSetting[search]=""),$(classS).each(function(v,i){$(this).prop("checked",!1)}),self.returnRoleList()},self.calculateHeight=function(event){var obj=$("#"+event);obj.height()>self.contentSetting.heightParam&&obj.addClass("scroller")},self.manageFilterDisplayList=function(filterSetting){var existing=$.inArray(filterSetting,self.selectedFilterList),isArray=$.isArray(self.contentSetting[filterSetting]),settingLength=self.contentSetting[filterSetting]?self.contentSetting[filterSetting].length:0,settingFlag=self.contentSetting[filterSetting];isArray&&settingLength>0?-1===existing&&self.selectedFilterList.push(filterSetting):isArray&&0===settingLength?-1!==existing&&self.selectedFilterList.splice(existing,1):isArray||!1===settingFlag||/false/.test(settingFlag)?isArray||!1!==settingFlag&&!/false/.test(settingFlag)||-1!==existing&&self.selectedFilterList.splice(existing,1):-1===existing&&self.selectedFilterList.push(filterSetting)},self.filterInArray=function(tags,array){return array.some(function(v){return-1!==tags.indexOf(v)})},self.getAllRoles=function(){rolesService.getAll().then(function(response){if(null===response)return!0;self.masterRolesList=response,self.rolesList=angular.copy(self.masterRolesList),roleOperation()})},self.createNewRole=function(isUpdate,portraitObj){self.formSubmit=!1,self.submitError=!1,self.newRole.form.$valid&&!noDuplicates(window.escape(self.newRole.details.name),isUpdate)?(void 0!==portraitObj&&null!==portraitObj?self.newRole.details.portraitId=portraitObj.originalObject.id:""===self.portraitDisplayName&&(self.newRole.details.portraitId=""),rolesService.createRole(self.newRole.details,isUpdate).then(function(response){if("true"===response.Success){if(isUpdate){self.isUpdate=!1,sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.roleUpdated"));for(var i=0;i<self.masterRolesList.length;i++)if(self.newRole.details.id===self.masterRolesList[i].id){self.masterRolesList[i].name=response.hiringRole.name,self.masterRolesList[i].description=response.hiringRole.description,self.masterRolesList[i].portrait=response.hiringRole.portrait,self.masterRolesList[i].updatedBy=response.hiringRole.updatedBy,self.masterRolesList[i].updatedOn=response.hiringRole.updatedOn,self.rolesList=angular.copy(self.masterRolesList),self.returnRoleList(self.contentSetting.pageSize);break}sharedProperties.fireAnalyticsEvent("PA | Roles Update","N/A")}else self.masterRolesList.unshift(response.hiringRole),self.rolesList=angular.copy(self.masterRolesList),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.roleCreated")),self.returnRoleList(self.contentSetting.pageSize),sharedProperties.fireAnalyticsEvent("PA | Roles Create","N/A");self.isUpdate=!1,self.loadCreateRole=!1}else{var errorMessage="";for(var key in response.error)errorMessage=response.error[key];self.submitError=errorMessage}})):self.formSubmit=!0},self.closeNewRoleView=function(){self.isUpdate=!1,self.loadCreateRole=!1},self.showNewRoleView=function(isEdit,roleDetails){self.submitError=!1,self.loadCreateRole=!0,self.formSubmit=!1,getAllPortraits(),isEdit&&void 0!==roleDetails?(self.isUpdate=!0,self.newRole={form:{},details:{id:roleDetails.id,name:window.unescape(roleDetails.name),description:roleDetails.description?roleDetails.description:"",portraitId:null!==roleDetails.portrait?roleDetails.portrait.id:""}},self.portraitDisplayName=null!==roleDetails.portrait?roleDetails.portrait.name:""):(self.newRole={form:{},details:{description:"",portraitId:""}},self.portraitDisplayName=""),$("html,body").animate({scrollTop:$(".roles-list-container").offset().top-20},1e3)},self.initAddRole=function(){self.overlayDim={width:$(".new-cols.content-col").width(),height:$(".new-cols.content-col").height()}},self.removePortraitModal=function(roleObj){self.selectedRole=roleObj,ngDialog.open({template:spConfig.talentAnalytics.roles.dialog.removePortrait,scope:self})},self.assignPortraitModal=function(roleObj){getAllPortraits(),self.selectedRole=roleObj,self.portraitSelected=!1,self.selectedPortraitId=null,ngDialog.open({template:spConfig.talentAnalytics.roles.dialog.assignPortrait,scope:self})},self.assignPortrait=function(){var portraitFound=!1,portraitObj={};rolesService.assignPortrait({id:self.selectedRole.id,portraitId:self.selectedPortraitId,addPrism:!1}).then(function(response){if(null===response)return!0;for(var j=0;j<self.masterRolesList.length;j++)if(self.masterRolesList[j].id===self.selectedRole.id){self.masterRolesList[j].portrait=response.hiringRole.portrait,portraitObj=response.hiringRole.portrait,self.rolesList=self.masterRolesList;break}for(var zz=0;zz<self.portraitFilterList.length;zz++)if(self.portraitFilterList[zz].id===self.selectedPortraitId){portraitFound=!0;break}portraitFound||self.portraitFilterList.push(portraitObj),ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.portraitAssigned")),sharedProperties.fireAnalyticsEvent("PA | Roles Assign Portrait","N/A")})},self.clearPortraitInputBox=function(){$(".autoCompleteCss").val(""),self.portraitDisplayName=""},self.updateInputBox=function(obj){self.portraitDisplayName=obj.originalObject.name},self.selectPortrait=function(id){self.portraitSelected||(self.portraitSelected=!0,self.selectedPortraitId=id)},self.removeSelectedPortrait=function(){self.portraitSelected=!1,self.selectedPortraitId=null},self.removePortrait=function(){rolesService.removePortrait({id:self.selectedRole.id,portraitId:self.selectedRole.portrait.id}).then(function(response){if(null===response)return!0;for(var j=0;j<self.masterRolesList.length;j++)if(self.masterRolesList[j].id===self.selectedRole.id){self.masterRolesList[j].portrait=null,self.rolesList=self.masterRolesList;break}ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.portraitRemoved")),sharedProperties.fireAnalyticsEvent("PA | Roles Remove Portrait","N/A")})},self.init=function(){self.getAllRoles(),scope.$parent.activeView=attrs.activeView,$localStorage.set("activeView",scope.$parent.activeView),null!==scope.$parent.selectedRoleId&&(scope.$parent.selectedRoleId=null,self.viewRoleDetails($localStorage.get("selectedRoleId")))},self.init()}};return rolesList}]);
angular.module("spApp").directive("settingsSection",["spConfig","ajaxService","sharedProperties","$q","$localStorage","$timeout","$rootScope","ngDialog","spValue",function(spConfig,ajaxService,sharedProperties,$q,$localStorage,$timeout,$rootScope,ngDialog,spValue){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/people-analytics/"+attrs.urlSrc},link:function(scope,element,attrs){function closeTransactionsView(val){vm.flags.viewTransactions=val}function updateRenewalStatus(flag,plan){ajaxService.getAjaxResponse({url:flag?spConfig.talentAnalytics.settings.activateRenewal:spConfig.talentAnalytics.settings.deactivateRenewal,data:$.param({spPlanType:"IntelligentHiring"})}).then(function(response){"true"===response.Success?(vm.autoRenewalStatus=flag,sharedProperties.growlMessage(flag?$rootScope.pullInterNationalization("manageAccountContent.subscriptionrenewal"):$rootScope.pullInterNationalization("manageAccountContent.subscriptionCancelled")),sharedProperties.fireAnalyticsEvent("PA | Toggle Auto Renewal Status",flag)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function processAccountRequest(e,requestAccounts){vm.salesForceForm=!1,requestAccounts>0?(vm.salesForceForm=!1,sharedProperties.fireAnalyticsEvent("PA | Request Accounts Salesforce","N/A"),$localStorage.set("accountRequest","manageAccountContent.requestSubmit")):(e.preventDefault(),vm.salesForceForm=!0)}function requestForAccounts(requestType){vm.requestAccounts=0,vm.salesForceForm=!1,vm.requestType=requestType,vm.companyEmail=vm.userInfo.member.email,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.accountsRequest,scope:scope})}function restrictShareportrait(flag){ajaxService.getAjaxResponse({url:spConfig.talentAnalytics.settings.enableShare,data:$.param({enableSharePortrait:flag})}).then(function(response){"true"===response.Success?(vm.enableSharePortrait=flag,sharedProperties.growlMessage($rootScope.pullInterNationalization("manageAccountContent.permissionsUpdated")),sharedProperties.fireAnalyticsEvent("PA | Toggle Prism Portrait Share Feature",flag)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function cancelCompanyUpdate(){vm.flags.editCompanyDetails=!1,vm.formSubmitted=!1,vm.companyDetails=angular.copy(vm.companyDetailsBackup)}function updateCompanyDetails(){vm.formSubmitted=!1,this.companyInfoForm.$valid&&vm.companyDetails.numberOfEmployees>0?(vm.formSubmitted=!1,ajaxService.getAjaxResponse({url:spConfig.talentAnalytics.settings.updateCompanyInfo,data:$.param(vm.companyDetails)}).then(function(response){"true"===response.Success?(vm.companyDetailsBackup=angular.copy(vm.companyDetails),vm.flags.editCompanyDetails=!1,sharedProperties.growlMessage($rootScope.pullInterNationalization("manageAccountContent.companyDetailUpdated")),sharedProperties.fireAnalyticsEvent("PA | Update Company Details","N/A")):null!==response.error&&sharedProperties.ajaxError(response.error),cancelCompanyUpdate()})):vm.formSubmitted=!0}function getCompanyDetails(){ajaxService.getAjaxResponse({url:spConfig.talentAnalytics.settings.getCompanyInfo}).then(function(response){"true"===response.Success?(vm.companyInfo=response.company,vm.companyDetails={name:vm.companyInfo.name,industry:vm.companyInfo.industry,numberOfEmployees:vm.companyInfo.numberOfEmployees,phoneNumber:vm.companyInfo.phoneNumber,country:vm.companyInfo.address.country,address1:vm.companyInfo.address.addressLine1,address2:vm.companyInfo.address.addressLine2,city:vm.companyInfo.address.city,state:vm.companyInfo.address.state,zip:vm.companyInfo.address.zipCode},vm.companyDetailsBackup=angular.copy(vm.companyDetails),stateCheck(vm.companyDetails.country),vm.showRelationshipAdvisor=-1!==vm.companyInfo.featureList.indexOf("RelationShipAdvisor"),vm.showThemeManager=-1!==vm.companyInfo.featureList.indexOf("CompanyTheme"),vm.showEmailManager=-1!==vm.companyInfo.featureList.indexOf("EmailManagement"),vm.restrictRelationShipAdvisor=vm.companyInfo.restrictRelationShipAdvisor,vm.blockPorTraitpermissions=vm.companyInfo.blockPorTraitpermissions,vm.enableSharePortrait=vm.companyInfo.sharePortrait):null!==response.error&&sharedProperties.ajaxError(response.error)})}function getAccountDetails(){ajaxService.getAjaxResponse({url:spConfig.talentAnalytics.settings.getAccountInfo,data:$.param({planType:"IntelligentHiring"})}).then(function(response){"true"===response.Success?(vm.accountInfo=response,vm.accountDetails=response.account,vm.existingAdmins=response.planAdminUsers,vm.companySettings=response.profileSettings,vm.memberCounts=response.account.spPlans,vm.isPrimaryPlanActive=void 0!==response.account.spPlans.Primary&&null!==response.account.spPlans.Primary&&""!==response.account.spPlans.Primary,vm.isHiringPlanActive=void 0!==response.account.spPlans.IntelligentHiring&&null!==response.account.spPlans.IntelligentHiring&&""!==response.account.spPlans.IntelligentHiring,vm.autoRenewalStatus="ACTIVE"===vm.memberCounts.IntelligentHiring.planStatus,vm.initLoaded=!0):null!==response.error&&sharedProperties.ajaxError(response.error)})}function stateCheck(country){switch(vm.showStatesUS=!1,vm.showStatesCanada=!1,vm.showStatesOthers=!1,country){case"United States":vm.showStatesUS=!0;break;case"Canada":vm.showStatesCanada=!0;break;case"US":vm.showStatesUS=!0;break;case"CA":vm.showStatesCanada=!0;break;default:vm.showStatesUS=!1,vm.showStatesCanada=!1,vm.showStatesOthers=!0}}function resetAddress(){vm.companyDetails.zip="",vm.companyDetails.city="",vm.companyDetails.state="",vm.companyDetails.address1="",vm.companyDetails.address2=""}function removeAdminAccess(type,userObj){vm.updatedPlanType=type,vm.deleteMemberInfo=userObj,ngDialog.open({template:"/sp/resources/html/people-analytics/dialog/settings-removeAdmin.html",scope:scope})}function addAdminAccess(type){vm.addAdminType=type,vm.selectedAdminsList=[],ajaxService.getAjaxResponse({url:spConfig.talentAnalytics.settings.getAdminMembers,data:$.param({planType:type})}).then(function(response){if("true"===response.Success){vm.masterMemberList=response.hiring.length?response.hiring:[],vm.selectMemberList=angular.copy(vm.masterMemberList);ngDialog.open({template:"/sp/resources/html/people-analytics/dialog/settings-selectAdmins.html",scope:scope}).closePromise.then(function(data){vm.memberListSearch=""})}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function removeAdmin(id){ajaxService.getAjaxResponse({url:spConfig.talentAnalytics.settings.removeAdmin,data:$.param({planType:vm.updatedPlanType,userId:id})}).then(function(response){"true"===response.Success?(spValue.getAllEmployees=[],ngDialog.close("ngdialog1"),vm.getAdminSubscriptions(),vm.getAccountDetails(),sharedProperties.growlMessage($rootScope.pullInterNationalization("manageAccountContent.AdminRemoved")),sharedProperties.fireAnalyticsEvent("PA | Remove Administrator","N/A")):null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})}function addSelectedAdmin(memberObj){ajaxService.getAjaxResponse({url:spConfig.talentAnalytics.settings.addAdmin,data:$.param({planType:vm.addAdminType,userId:memberObj.id})}).then(function(response){"true"===response.Success?(vm.existingAdmins=[],vm.selectedAdminsList.push(memberObj.email),vm.getAdminSubscriptions(),vm.getAccountDetails(),sharedProperties.growlMessage($rootScope.pullInterNationalization("manageAccountContent.AdminAdded")),spValue.getAllEmployees=[],sharedProperties.fireAnalyticsEvent("PA | Add Administrator","N/A")):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})}function getTransactionsHistory(){vm.overlayDim={width:$(".new-cols.content-col").width(),height0:parseInt($(".new-cols.content-col").height()-100)+"px",height1:parseInt($(".new-cols.content-col").height()-70)+"px"},ajaxService.getAjaxResponse({url:spConfig.talentAnalytics.settings.transactions,data:$.param({spPlanType:"IntelligentHiring"})}).then(function(response){"true"===response.Success?(vm.paymentDetails=response.paymentHistory,$("html,body").animate({scrollTop:0},200)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function initSettings(){scope.$parent.activeView=attrs.activeView,$localStorage.set("activeView",scope.$parent.activeView),$localStorage.get("accountRequest")&&(sharedProperties.growlMessage($rootScope.pullInterNationalization($localStorage.get("accountRequest"))),$localStorage.remove("accountRequest")),null!==$localStorage.get("settingsNav")?vm.settingsNav=$localStorage.get("settingsNav"):(vm.settingsNav="admins",$localStorage.set("settingsNav",vm.settingsNav)),vm.selfEmail=vm.userInfo.member.email,vm.initLoaded||(vm.getAdminSubscriptions(),vm.getCompanyDetails(),vm.getAccountDetails()),vm.countries=$localStorage.get("countriesFullList").countries}function getAdminSubscriptions(){ajaxService.getAjaxResponse({url:spConfig.talentAnalytics.settings.getAdminSubscriptions}).then(function(response){"true"===response.Success?vm.adminSubscriptions=response.availableHiringSubscripitons:null!==response.error&&sharedProperties.ajaxError(response.error)})}function setSettingsView(settingsView){vm.settingsNav=settingsView,$localStorage.set("settingsNav",settingsView)}var vm=scope;vm.companyInfo={},vm.accountInfo={},vm.companyDetails={},vm.companyDetailsBackup={},vm.companyInfoForm={},vm.showStatesUS=!1,vm.showStatesCanada=!1,vm.showStatesOthers=!1,vm.formSubmitted=!1,vm.showRelationshipAdvisor=!1,vm.blockPortraitPermissions=!1,vm.initLoaded=!1,vm.settingsNav="admins",vm.autoRenewalStatus=!1,vm.showEmailManager=!1,vm.isPrimaryPlanActive=!1,vm.isHiringPlanActive=!1,vm.enableSharePortrait=!1,vm.getCompanyDetails=getCompanyDetails,vm.getAccountDetails=getAccountDetails,vm.updateCompanyDetails=updateCompanyDetails,vm.cancelCompanyUpdate=cancelCompanyUpdate,vm.stateCheck=stateCheck,vm.resetAddress=resetAddress,vm.initSettings=initSettings,vm.restrictShareportrait=restrictShareportrait,vm.updateRenewalStatus=updateRenewalStatus,vm.currentPageUrl=window.location.href,vm.salesForceForm=!1,vm.requestAccounts=0,vm.requestType="",vm.processAccountRequest=processAccountRequest,vm.requestForAccounts=requestForAccounts,vm.companyEmail="",vm.removeAdminAccess=removeAdminAccess,vm.removeAdmin=removeAdmin,vm.addAdminAccess=addAdminAccess,vm.addSelectedAdmin=addSelectedAdmin,vm.selectedAdminsList=[],vm.getTransactionsHistory=getTransactionsHistory,vm.setSettingsView=setSettingsView,vm.closeTransactionsView=closeTransactionsView,vm.adminSubscriptions=0,vm.getAdminSubscriptions=getAdminSubscriptions,vm.userInfo=$localStorage.get("loggegdInProfile"),vm.flags={viewTransactions:!1,editCompanyDetails:!1},vm.viewMemberDetails=function(userId,email){$localStorage.set("empUserId",userId),scope.$parent.updateView("employeeDetailsModule",!1,email)},vm.initSettings()}}}]);
function profileMainController($scope,$timeout,ajaxService,$rootScope,sharedProperties,$localStorage,ngDialog,$sce,spConfig){function isObjectEmpty(prismObj){return 0===Object.keys(prismObj).length}function customInfoBox(action,id){if(1===action){var h=parseInt($("#pBox").outerHeight()+$("#mHead").outerHeight()+40,10);$("#"+id).css({height:h+"px"}).removeClass("hide")}else $("#"+id).addClass("hide")}function getGoals(id){ajaxService.getAjaxResponse({url:"/sp/goals/getGoalInfo",data:$.param({goalId:id})}).then(function(response){"true"===response.Success?viewDevelopmentStartegy(response):null!==response.error&&sharedProperties.ajaxError(response.error)})}function viewDevelopmentStartegy(goalResponse){_this.viewGoalsObj={},_this.viewStrategy=[],_this.winWidth=$(window).width(),_this.winHeight=$(window).height()+100+"px",_this.viewGoalsObj=goalResponse.goal,_this.viewStrategy=goalResponse.goal.developmentStrategyList;ngDialog.open({template:_this.winWidth>767?"/sp/resources/html/profile/viewDevelopmentStartegy.html":"/sp/resources/html/profile/viewDevelopmentStartegyResponsive.html",scope:$scope,className:_this.winWidth>767?"ngdialog-theme-default":"ngdialog-lnd-theme"})}function viewLensReport(id){var param={id:id};ajaxService.getAjaxResponse({url:spConfig.talentAnalytics.memberService.viewLensReportExt,data:$.param(param)}).then(function(response){if("true"===response.Success){_this.getInviteMemberDetail=response.hiringLens.lensResponse,_this.swotanalysis=response.hiringLens.lensResponse.swotanalysis,_this.lensDialog=!0;ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.viewLensReportExt,scope:$scope}).closePromise.then(function(data){_this.lensDialog=!1})}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function typeSelect(number){_this.activeProfileContent=number,_this.activeProfileSummary=number,$timeout(function(){_this.togglePrimaryGraph(number)},100)}function setContentReference(obj,type){var tempObj={data:obj,type:type};sharedProperties.setContentReference(tempObj),tempObj=null}function togglePrimaryGraph(id){sharedProperties.fireAnalyticsEvent("Prism Portrait | Change Primary Personality Tabs",0===_this.activeProfileSummary?"Viewed Primary Personality Tab":"Viewed Personality Under Pressure Tab");var g0=$("#personalityChart").find(".prismG0"),g1=$("#personalityChart").find(".prismG1"),g2=$("#personalityChart").find(".prismG2"),c0=$("#personalityChart").find(".crossLines0"),c1=$("#personalityChart").find(".crossLines1");_this.label="",_this.prismLabelContent=!1,jQuery(".outer-labels").find("p").removeClass("active"),1===id?(g0.attr({"fill-opacity":0,"stroke-width":0}),g1.attr({"fill-opacity":.6,"stroke-width":3,"stroke-opacity":.6,"stroke-dasharray":0}),c1.attr({"stroke-width":1}),c0.attr({"stroke-width":0}),g2.attr({"fill-opacity":.3,"stroke-opacity":.3,"stroke-dasharray":"3,6"})):(g0.attr({"fill-opacity":.3,"stroke-width":3,"stroke-opacity":.3,"stroke-dasharray":"3,6"}),g1.attr({"fill-opacity":0,"stroke-width":0,"stroke-opacity":0}),g2.attr({"fill-opacity":.6,"stroke-opacity":.6,"stroke-dasharray":0}),c1.attr({"stroke-width":0}),c0.attr({"stroke-width":1}))}function updateTab(tab,text,profile){var _profile=void 0!==profile&&null!==profile&&""!==profile?profile:0;_this.selectedTab=tab,_this.selectedTabText=text,_this.activeProfileSummary=_profile,_this.activeProfileContent=_profile,_this.mobileMenuShow=!1,_this.label="",_this.prismLabelContent=!1,jQuery(".outer-labels").find("p").removeClass("active"),$scope.selectedProfileTab=text,$timeout(function(){_this.typeSelect("9"===tab||9===tab?1:_profile),("7"===tab||7===tab)&&$(window).width()>767&&($(window).resize(),_this.activeProfileSummary=0,_this.activeProfileContent=0,_this.typeSelect(0))},200),_this.setContentReference({mainModule:"Prism",subModule:formatSubmoduleName(tab)},"prism"),sharedProperties.fireAnalyticsEvent("Prism Portrait | Click Personality Module Tab",formatSubmoduleName(tab))}function getCurrentUserEmail(){var getProfileDetails,getEmail=!1;return!0===$rootScope.profileReady&&(getProfileDetails=$localStorage.get("loggegdInProfile"),getEmail=getProfileDetails.member.email),getEmail}function getTokenDetails(){var _location=window.location.href,_getToken=_location.split("/"),_token=_getToken[_getToken.length-1];return _this.publicToken=_token,_token}function setOptions(o){var memberEmail=sharedProperties.getParam("email"),candidateEmail=void 0!==sharedProperties.getParam("cemail")&&null!==sharedProperties.getParam("cemail")&&""!==sharedProperties.getParam("cemail")?sharedProperties.getParam("cemail").replace(/%2B/g,"+").split("+")[0]:null,defaultEmail=getCurrentUserEmail(),_options={},hashUsed=""!==window.location.hash&&null!==window.location.hash&&void 0!==window.location.hash;if(_this.publicToken=!1,null===memberEmail&&null!==_this.activeUser&&(memberEmail=_this.activeUser.email),"publicProfile"===o||"spCertificate"===o){var token=getTokenDetails(),updatedUrl="publicProfile"===o?_this.prismServices.publicProfile:_this.prismServices.spCertificate;void 0!==token&&null!==token&&(_this.winWidth<768?(_this.selectedTab=0,_this.mobileHelpLink=!0):_this.selectedTab=8,_options={url:updatedUrl+token},cachedPrismCheck(_options,token))}else if(void 0!==memberEmail&&null!==memberEmail)_options={url:_this.prismServices.member,data:$.param({email:memberEmail})},cachedPrismCheck(_options,memberEmail);else if(void 0!==candidateEmail&&null!==candidateEmail)_options={url:_this.prismServices.candidate,data:$.param({userId:sharedProperties.getParam("cemail").replace(/%2B/g,"+").split("+")[1]})},cachedPrismCheck(_options,sharedProperties.getParam("cemail").replace(/%2B/g,"+").split("+")[1]);else if("sharePortrait"===o)_options={url:window.location.pathname},_this.externalLink=!0,getPrismAnalysis(_options);else if("sharePortraitUser"===o)_options={url:_this.prismServices.sharePortraitUser},_this.sharePortrait=!0,_this.externalLink=!0,getPrismAnalysis(_options);else if("publicAnalysis"===o){var publicToken=getTokenDetails();void 0!==publicToken&&null!==publicToken&&(_options={url:_this.prismServices.publicAnalysis+publicToken},cachedPrismCheck(_options,publicToken))}else"partnerAnalysis"===o?(_options={url:_this.prismServices.partnerAnalysis},getPrismAnalysis(_options)):(_options={url:_this.prismServices.member,data:$.param({email:defaultEmail})},cachedPrismCheck(_options,defaultEmail),!hashUsed&&_this.urlTab>-1&&(_this.selectedTab=_this.urlTab,$timeout(function(){window.location.href=window.location.href+"#noRef"},200)));$timeout(function(){_this.setContentReference({mainModule:"Prism",subModule:"Personality"},"prism")},1e3),$rootScope.showStickyTutorial=!0}function cachedPrismCheck(options,id){var storedProfile=$localStorage.get(id);_this.isAnalysisLoaded=!1,_this.prismData=null,_this.prismContent=null,void 0!==storedProfile&&null!==storedProfile?(_this.prismData=storedProfile.Analysis,_this.prismContent=storedProfile,_this.prismPrimaryGoals=void 0!==storedProfile.primaryGoals&&null!==storedProfile.primaryGoals?storedProfile.primaryGoals:null,_this.prismSecondaryGoals=void 0!==storedProfile.underPressureGoals&&null!==storedProfile.underPressureGoals?storedProfile.underPressureGoals:null,_this.showSpProfile=void 0!==storedProfile.Analysis,_this.personalityVideo1=$rootScope.pullInterNationalization("profile.video."+_this.prismData.personality.Primary.personalityType),_this.personalityVideo2=$rootScope.pullInterNationalization("profile.video."+_this.prismData.personality.UnderPressure.personalityType),void 0!==storedProfile.user&&null!==storedProfile.user&&(_this.userDetails=storedProfile.user),void 0!==storedProfile.hiringUser&&null!==storedProfile.hiringUser&&(_this.hiringUserDetails=storedProfile.hiringUser,_this.hiringUserFeedBack=storedProfile.feedbackFlow),$timeout(function(){_this.isAnalysisLoaded=!0},100),_this.winWidth<768&&_this.updateTab(0,$rootScope.pullInterNationalization("prismTab1"),0),$scope.selectedProfileTab=$rootScope.pullInterNationalization("prismTab1"),$timeout(function(){docRapFinishedFlag=!0},3e3)):getPrismAnalysis(options)}function getPrismAnalysis(options){ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success)_this.analysisError=!1,!1!==_this.publicToken?_this.showSpProfile=void 0!==response.Analysis:void 0!==options.data&&$localStorage.set(options.data.split("=")[1].replace(/%40/g,"@"),response),void 0!==response.user&&null!==response.user&&(_this.userDetails=response.user),void 0!==response.hiringUser&&null!==response.hiringUser&&(_this.hiringUserDetails=response.hiringUser,_this.hiringUserFeedBack=response.feedbackFlow),_this.prismData=response.Analysis,_this.prismContent=response,_this.prismPrimaryGoals=void 0!==response.primaryGoals&&null!==response.primaryGoals?response.primaryGoals:null,_this.prismSecondaryGoals=void 0!==response.underPressureGoals&&null!==response.underPressureGoals?response.underPressureGoals:null,_this.personalityVideo1=$rootScope.pullInterNationalization("profile.video."+_this.prismData.personality.Primary.personalityType),_this.personalityVideo2=$rootScope.pullInterNationalization("profile.video."+_this.prismData.personality.UnderPressure.personalityType),_this.sharePortrait&&(_this.rolesList=response.rolesAndMatch),$timeout(function(){_this.isAnalysisLoaded=!0},100),_this.winWidth<768&&_this.updateTab(0,$rootScope.pullInterNationalization("prismTab1"),0,!1,!0,!0),$scope.selectedProfileTab="Personality Profile",$timeout(function(){docRapFinishedFlag=!0},3e3);else if(null!==response.error)if(docRapFinishedFlag=!1,sharedProperties.ajaxError(response.error),_this.isAnalysisLoaded=!1,!1!==_this.publicToken)window.location.href="/?status=404";else if(_this.externalLink)window.location.href="/?status=profileExpired";else{_this.analysisError=!0;for(var key in response.error)_this.analysisErrorContent=response.error[key]}})}function videoPopUp(url,type){void 0!==type&&"personalityVideo"===type?sharedProperties.fireAnalyticsEvent(0===_this.activeProfileSummary?"Prism Portrait | Click Primary Personality Video":"Prism Portrait | Click Personality under Pressure Video","N/A"):sharedProperties.fireAnalyticsEvent("Prism Portrait | Click Personality Module Info Video",$scope.selectedProfileTab),sharedProperties.videoPopUp(url)}function showInfoBoxMobile(t,v){$scope.winScreenHeight=jQuery(window).height()+"px",$scope.infoBoxTab=t,sharedProperties.fireAnalyticsEvent("Prism Portrait | Click Personality Module Info icon",$scope.selectedProfileTab);var videoSrc=v;$scope.vWidth=$(document).width()-40,$scope.vHeight=.56428571428571*$scope.vWidth;var infoTab=$scope.infoBoxTab;$scope.prepareVideo=function(){if(/youtube/g.test(videoSrc)){$scope.videoType="youtube";var youtubeId=parseYouTube(videoSrc);$scope.videoUrl=$sce.trustAsResourceUrl("https://www.youtube.com/embed/"+youtubeId+"?autoplay=0&rel=0&autohide=1&showinfo=0&wmode=transparent&modestbranding=1&iv_load_policy=3&vq=large")}else if(/vimeo/g.test(videoSrc)){$scope.videoType="vimeo";var vimeoId=parseVimeo(videoSrc),userLocale=sharedProperties.provideVendorSpecificLocale("vimeo"),options={id:vimeoId,width:parseInt($scope.vWidth),height:parseInt($scope.vHeight)};$timeout(function(){new Vimeo.Player("vimeoPlayer_"+infoTab,options).enableTextTrack(userLocale).then(function(track){track.language=userLocale,track.kind="captions"})},500)}else $scope.videoType="html5",$scope.videoUrl=$sce.trustAsResourceUrl(videoSrc)};var parseYouTube=function(url){var p=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return!!url.match(p)&&RegExp.$1},parseVimeo=function(url){var m=url.match(/^.+vimeo.com\/(.*\/)?([^#\?]*)/);return m?m[2]||m[1]:null};ngDialog.open({template:"/sp/resources/html/profile/mobile-info-box.html",scope:$scope,className:"ngdialog-theme-default no-padding-top"})}docRapFinishedFlag=!1;var _this=this;$rootScope.renderedGraphsInfo={count:0,list:[]},_this.printEmail=$localStorage.get("printEmail"),null!==_this.printEmail&&void 0!==_this.printEmail?_this.printName=$localStorage.get("printName"):$localStorage.remove("printName"),_this.isAnalysisLoaded=!1,_this.analysisError=!1,_this.publicToken=!1,_this.selectedTab=0,_this.mobileMenuHide=!0,_this.activeProfileSummary=0,_this.activeProfileContent=0,_this.showHelpLink=!1,_this.mobileHelpLink=!1,_this.showSpProfile=!1,_this.prismLabelContent=!1,_this.externalLink=!1,_this.label="",_this.setOptions=setOptions,_this.showInfoBoxMobile=showInfoBoxMobile,_this.videoPopUp=videoPopUp,_this.updateTab=updateTab,_this.prismData={},_this.prismContent={},_this.personalityVideo1,_this.personalityVideo2,_this.globalNav=$localStorage.get("userSelectedNav"),_this.prismServices={publicProfile:"/sp/profilePublic/",spCertificate:"/sp/spCertificate/",member:"/sp/signedIn/getAnalysisFull",candidate:"/sp/hiring/getAnalysisFull",sharePortrait:"/sp/profilePublic/",sharePortraitUser:"/sp/hiring/ext/portrait/get",getLensInfoPortraitUser:"/sp/hiring/ext/portrait/lens/get",publicAnalysis:"/sp/profilePublic/analysis/",partnerAnalysis:"/sp/profile/hiring/getHiringPersonalityAnalysis"},_this.videos={scientist:"https://vimeo.com/175366653",ambassador:"https://vimeo.com/175366495",pioneer:"https://vimeo.com/175366597",peacemaker:"https://vimeo.com/175366575",influencer:"https://vimeo.com/175366553",strategist:"https://vimeo.com/175366659",instructor:"https://vimeo.com/175366560",catalyst:"https://vimeo.com/175366531",navigator:"https://vimeo.com/175366569",pragmatist:"https://vimeo.com/175366598",connector:"https://vimeo.com/175366541",architect:"https://vimeo.com/175366503",ally:"https://vimeo.com/175366485",researcher:"https://vimeo.com/175366613",toughtender:"https://vimeo.com/175366685",visionary:"https://vimeo.com/175366704"},_this.winWidth=jQuery(window).width(),_this.mobileMenuShow=!1,_this.togglePrimaryGraph=togglePrimaryGraph,_this.refreshFlag=!1,_this.storedName=$localStorage.get("mName")?$localStorage.get("mName"):null,$scope.videoReady=!1,moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),$scope.currDate=moment().format("MMMM DD, YYYY"),_this.viewLensReport=viewLensReport,_this.getInviteMemberDetail={},_this.swotanalysis={},_this.lensDialog=!1,_this.sharePortrait=!1,_this.rolesList=[],_this.viewPortraitFlag=!1,$scope.selectedPortrait={},$scope.selectedUserPortrait={},_this.setContentReference=setContentReference,_this.typeSelect=typeSelect,_this.tabNames=["Personality","ProcessingBlueprint","Motivation","ConflictManagement","FundamentalNeeds","DecisionMaking","LearningStyle"],_this.urlTab=null!==sharedProperties.getParam("refId")&&""!==sharedProperties.getParam("refId")&&void 0!==sharedProperties.getParam("refId")?_this.tabNames.indexOf(sharedProperties.getParam("refId")):-1,_this.getGoals=getGoals,_this.customInfoBox=customInfoBox,_this.activeUser=$localStorage.get("activeEmp"),_this.isObjectEmpty=isObjectEmpty;var formatSubmoduleName=function(name){switch(name){case 0:name="Personality";break;case 1:name="ProcessingBlueprint";break;case 2:name="Motivation";break;case 3:name="ConflictManagement";break;case 4:name="FundamentalNeeds";break;case 5:name="DecisionMaking";break;case 6:name="LearningStyle"}return name};$scope.viewMatchReport=function(role){$scope.selectedPortrait=role.portrait,$scope.selectedUserPortrait.matchResult=role.matchResult,$scope.selectedUserPortrait.firstName=_this.hiringUserDetails.firstName,$scope.selectedUserPortrait.lastName=_this.hiringUserDetails.lastName,_this.viewPortraitFlag=!0},$scope.closeReportView=function(){_this.viewPortraitFlag=!1,$scope.selectedPortrait={},$scope.selectedUserPortrait={}},$rootScope.switchPrismView=function(type){"standard"===type?sharedProperties.fireAnalyticsEvent("Prism Portrait | Click Standard View","N/A"):"charts"===type&&sharedProperties.fireAnalyticsEvent("Prism Portrait | Click Charts View","N/A")},$rootScope.openPdfView=function(url,_this,profileName){sharedProperties.fireAnalyticsEvent("Prism Portrait | Print to PDF","N/A"),$scope.clickedItem=_this,$scope.sp_profileName=profileName,ngDialog.open({template:url,scope:$scope,className:"ngdialog-theme-default ngdialog-clearBg"})};var isIE=!!jQuery("html").hasClass("ie"),ieTimer=isIE?2500:1e3;$scope.$on("ngDialog.opened",function(e,$dialog){_this.lensDialog||($scope.nameofUser=$localStorage.get("loggegdInProfile"),$scope.sp_name=void 0===$scope.sp_profileName||null==$scope.sp_profileName?$scope.nameofUser.member.name:$scope.sp_profileName,$timeout(function(){sharedProperties.printPdfProfile({holder:".printVersion",cssName:"sp-profile-pdf.css",url:"/sp/pdf/generatePdf",extraParam:"Prism-Portrait-"+$scope.sp_name.replace(" ","-"),obj:$scope.clickedItem})},ieTimer))}),$rootScope.$on("pdfGenerated",function(e,opt){if("object"!=typeof opt.obj)return!1;opt.obj.generatingPdf=!1,$scope.urlRedirect=opt.url,$scope.sp_profileName=null,$(".ngdialog").removeClass("ngdialog-clearBg")});var destroyRoot=$scope.$on("personalityGraph",function(e){destroyRoot(),null!==sharedProperties.getParam("type")&&_this.typeSelect("PP"===sharedProperties.getParam("type")?0:1)}),updateGraphCount=$scope.$on("updateGraphCounter",function(e,data){if(null===data)return!0;$scope.$apply(function(){-1===$rootScope.renderedGraphsInfo.list.indexOf(data.graphName)&&($rootScope.renderedGraphsInfo.list.push(data.graphName),$rootScope.renderedGraphsInfo.count=$rootScope.renderedGraphsInfo.count+1),25===$rootScope.renderedGraphsInfo.count&&(updateGraphCount(),$rootScope.$broadcast("graphsLoaded"))})});$scope.updatePrintDetails=function(profileName){null!==sharedProperties.getParam("email")&&void 0!==sharedProperties.getParam("email")?null!==$localStorage.get("printName")&&void 0!==$localStorage.get("printName")?$scope.sp_profileName=profileName:$scope.sp_profileName=sharedProperties.getParam("fullName").replace(/%20/g," "):null!==sharedProperties.getParam("hiringName")&&void 0!==sharedProperties.getParam("hiringName")?$scope.sp_profileName=sharedProperties.getParam("hiringName").replace(/%20/g," "):$localStorage.remove("printEmail","printName"),$scope.nameofUser=$localStorage.get("loggegdInProfile"),$scope.sp_name=(void 0===$scope.sp_profileName||null==$scope.sp_profileName)&&null!==$scope.nameofUser&&void 0!==$scope.nameofUser?$scope.nameofUser.member.name:$scope.sp_profileName},$rootScope.openPrintWin=function(url,_this,profileName){window.open(url,"_blank"),window.focus()};$scope.$on("graphsLoaded",function(e){var isPrintMode="print"===sharedProperties.getParam("mode");$timeout(function(){isPrintMode&&angular.element(document).ready(function(){window.print(),window.close()})},0)})}function showInfoBox($timeout,$rootScope,ngDialog,sharedProperties){return{restrict:"A",link:function($scope,$element,$attrs){var _this=jQuery($element[0]),id=_this.attr("data-boxid"),infoBox=jQuery('div[data-box="'+id+'"]'),extraHeight=void 0!==infoBox.attr("data-extraheight"),autoWidth=void 0!==infoBox.attr("data-width"),colSide=void 0!==infoBox.attr("data-cols")?parseInt(infoBox.attr("data-cols"),10):1,infoBoxP=infoBox.parent();_this.off("click").on("click",function(e){e.preventDefault();var personalityType="";switch(id){case"listptp":case"chartptp":personalityType="Personality Profile";break;case"listpbp":case"chartpbp":personalityType="Processing Blueprint";break;case"listmot":case"chartmot":personalityType="Motivation";break;case"listcm":case"chartcm":personalityType="Conflict Management";break;case"listfm":case"chartfm":personalityType="Fundamental Needs";break;case"listdms":case"chartdms":personalityType="Decision Making";break;case"listls":case"chartls":personalityType="Learning Style"}sharedProperties.fireAnalyticsEvent("Prism Portrait | Click Personality Module Info icon",personalityType);var iHeight=jQuery(infoBoxP).outerHeight(),iWidth=jQuery(infoBoxP).outerWidth(),colHeight=jQuery("body").find(".chart-box-cols:first-child").outerHeight(),boxHeights=parseInt(jQuery("body").find(".chart-box-cols.right .motivation-wrapper").outerHeight()+jQuery("body").find(".chart-box-cols.right .fundamental-needs-wrapper").outerHeight()),boxHeights1=parseInt(jQuery("body").find(".chart-box-cols.left .processing-blueprint-wrapper").outerHeight()+jQuery("body").find(".chart-box-cols.left .conflict-management-wrapper").outerHeight()+jQuery("body").find(".chart-box-cols.left .decision-making-wrapper").outerHeight());1===colSide?infoBox.css({height:jQuery(window).width()>767&&extraHeight?iHeight+parseInt(colHeight-boxHeights):iHeight,width:autoWidth?"auto":iWidth}).addClass("active-info-box").removeClass("hide"):infoBox.css({height:jQuery(window).width()>767&&extraHeight?iHeight+parseInt(colHeight-boxHeights1):iHeight,width:autoWidth?"auto":iWidth}).addClass("active-info-box").removeClass("hide")}),jQuery(".ibClose").off("click").on("click",function(e){e.preventDefault();var id=jQuery(this).attr("data-boxid");jQuery('div[data-box="'+id+'"]').addClass("hide").removeClass("active-info-box")}),jQuery(window).resize(function(){if(jQuery(window).width()>767){if(jQuery("body").find(".mobile-infoBox-modal").length){var id1=jQuery("body").find(".mobile-infoBox-modal").parent().parent().attr("id");jQuery("#"+id1).length&&ngDialog.closeAll()}if(jQuery(".active-info-box").length>0){var iHeight=jQuery(infoBoxP).outerHeight(),iWidth=jQuery(infoBoxP).outerWidth(),colHeight=jQuery("body").find(".chart-box-cols:first-child").outerHeight(),boxHeights=parseInt(jQuery("body").find(".chart-box-cols.right .motivation-wrapper").outerHeight()+jQuery("body").find(".chart-box-cols.right .decision-making-wrapper").outerHeight());jQuery(".active-info-box").css({height:jQuery(window).width()>767&&extraHeight?iHeight+parseInt(colHeight-boxHeights):iHeight,width:autoWidth?"auto":iWidth}),$timeout(function(){$.each(jQuery(".active-info-box"),function(i,j){$(this).css({width:$(this).parent().outerWidth(),height:$(this).parent().outerHeight()})})},100)}}else if(jQuery(".active-info-box").length>0&&jQuery(".active-info-box").addClass("hide").removeClass("active-info-box"),jQuery("body").find(".videoPopDialog").length){var id=jQuery("body").find(".videoPopDialog").parent().parent().attr("id");jQuery("#"+id).length&&ngDialog.closeAll()}})}}}function resizeInfoBoxes($timeout,$rootScope){return{restrict:"A",link:function($scope,$element,$attrs){function init(){jQuery(window).width()>767?setTimeout(function(){$rootScope.setBoxSizes(".charbox-wrapper",".chart-box-cols")},50):jQuery("body").find(".chart-box-cols").removeAttr("style"),jQuery(window).resize(function(){jQuery(window).width()>767?setTimeout(function(){$rootScope.setBoxSizes(".charbox-wrapper",".chart-box-cols")},50):jQuery("body").find(".chart-box-cols").removeAttr("style")})}init(),$scope.$watch("width",function(oldVal,newVal){init()})}}}function mobileDropdown(){return{restrict:"A",link:function($scope,$element,$attrs){$element.bind("click",function(){!1===$scope.$parent.ctrl.mobileMenuShow?$scope.$apply(function(){$scope.$parent.ctrl.mobileMenuShow=!0}):$scope.$apply(function(){$scope.$parent.ctrl.mobileMenuShow=!1})})}}}var docRapFinishedFlag=!1,docraptorJavaScriptFinished=function(){return docRapFinishedFlag};angular.module("spApp").controller("profileMainController",profileMainController),profileMainController.$inject=["$scope","$timeout","ajaxService","$rootScope","sharedProperties","$localStorage","ngDialog","$sce","spConfig"],angular.module("spApp").directive("showInfoBox",showInfoBox),showInfoBox.$inject=["$timeout","$rootScope","ngDialog","sharedProperties"],angular.module("spApp").directive("resizeInfoBoxes",resizeInfoBoxes),resizeInfoBoxes.$inject=["$timeout","$rootScope"],angular.module("spApp").directive("mobileDropdown",mobileDropdown);
function candidateAdvisorController($scope,$timeout,ajaxService,$rootScope,$localStorage,ngDialog,sharedProperties,$state,memberService){var _this=this;_this.selectedCandidate={},_this.memberMasterList={},_this.validMemberList=[],_this.candidateMasterList={},_this.validCandidateList=[],_this.selectedMemberDetails={},_this.candidateProfileDetails={},_this.memberProfileDetails={},_this.candidateAdvise={},_this.memberAdvise={},_this.candidateAvoidFormatted=[],_this.resultTabs={},_this.personalityFlags=[],_this.cachedAdvisorData=[],_this.showMemberListingWidget=!1,_this.memberSelected=!1,_this.showContent=!1,_this.resultTabs.leftSelected=0,_this.resultTabs.rightSelected=0,_this.mobileControls={},_this.mobileControls.display=!1,"print"===sharedProperties.getParam("mode")&&null!==sharedProperties.getParam("printParams")&&"false"!==sharedProperties.getParam("printParams").split(",")[3]?_this.viewMode={list:!0,chart:!1}:"print"===sharedProperties.getParam("mode")&&null!==sharedProperties.getParam("printParams")&&"false"===sharedProperties.getParam("printParams").split(",")[3]?_this.viewMode={list:!1,chart:!0}:_this.viewMode={list:!0,chart:!1},_this.switchToUser1=!0,_this.cachedUSerEmails=null,_this.winWidth=jQuery(window).width(),_this.sResizeFlag=0,_this.lResizeFlag=0,$scope.prismLabelContent=!1,$scope.prismLabelContent1=!1,$scope.label="",_this.changeList="member",_this.candidateSelected=!1,_this.selectedCandidate="",_this.activeUser=$localStorage.get("activeEmp"),$rootScope.renderedPrintGraphsInfo={},$rootScope.renderedPrintGraphsInfo.count=0,$rootScope.renderedPrintGraphsInfo.list=[];var lang=sharedProperties.getUserLocale();_this.setHeadings=function(name,heading){return"en-US"===lang?name+heading:name+" "+heading},jQuery(window).resize(function(){_this.winWidth=jQuery(window).width()}),_this.returnBack=function(){"HiringCandidate"===_this.activeUser.type?$localStorage.set("fromCompare","candidatesModule"):$localStorage.set("fromCompare","employeesModule"),$localStorage.remove("activeEmp"),window.history.back()},$scope.labelsReset=function(){jQuery(".outer-labels").find("p").removeClass("active"),$scope.prismLabelContent=!1,$scope.prismLabelContent1=!1,$scope.label=""},_this.getAllCandidateDetails=function(){memberService.getAllCandidates().then(function(response){null===sharedProperties.getParam("mode")?_this.selectedCandidateEmailAddress=void 0!==$state.params.email&&null!==$state.params.email&&""!==$state.params.email?$state.params.email.replace(/%2B/g,"+").split("+")[0]:"":_this.selectedCandidateEmailAddress=sharedProperties.getParam("email");var counter=0,newList=[];_this.candidateMasterList=response,jQuery.each(_this.candidateMasterList,function(i,j){"VALID"===_this.candidateMasterList[i].userStatus&&_this.candidateMasterList[i].id!==_this.activeUser.id&&(null===_this.candidateMasterList[i].spUserId||void 0===_this.candidateMasterList[i].spUserId?(newList=jQuery.extend({},_this.candidateMasterList[i],{selectedCandidateFromList:!1,selectedCandidateRight:!1}),_this.validCandidateList.push(newList)):void 0!==_this.candidateMasterList[i].profileSettings&&!0===_this.candidateMasterList[i].profileSettings.hiringAccessAllowed&&(newList=jQuery.extend({},_this.candidateMasterList[i],{selectedCandidateFromList:!1,selectedCandidateRight:!1}),_this.validCandidateList.push(newList),_this.winWidth<768&&$timeout(function(){$rootScope.setBoxSizes("#dd-wrap",".dd","full")},300))),counter++}),_this.selectedCandidate=_this.activeUser,_this.candidateSelected=!0,_this.winWidth<768&&$timeout(function(){$rootScope.setBoxSizes("#dd-wrap",".dd","full")},300),null===sharedProperties.getParam("mode")&&$("html,body").animate({scrollTop:$(".header-info-container").offset().top-40},1e3),$rootScope.$broadcast("candidateListAvailable")})},_this.getAllMemberDetails=function(){memberService.getAllEmployees().then(function(response){_this.memberMasterList=response,jQuery.each(_this.memberMasterList,function(i,j){if("VALID"===_this.memberMasterList[i].userStatus&&_this.memberMasterList[i].id!==_this.activeUser.id){var newList=jQuery.extend({},_this.memberMasterList[i],{selectedMember:!1});_this.validMemberList.push(newList)}}),$rootScope.$broadcast("memberListAvailable")})},_this.showDropdownWidget=function(side){"right"===side&&(_this.showMemberListingWidget=!_this.showMemberListingWidget,_this.showCandidateListingWidget=!1)},_this.listReset=function(){jQuery.each(_this.validCandidateList,function(j){_this.validCandidateList[j].selectedCandidateRight=!1})},_this.compareToolReset=function(){_this.cachedUSerEmails=null,_this.resultTabs={},_this.personalityFlags=[],_this.cachedAdvisorData=[],_this.resultTabs.leftSelected=0,_this.resultTabs.rightSelected=0,_this.showContent=!1,_this.showMemberListingWidget=!1,_this.memberSelected=!1,_this.showCandidateListingWidget=!1,_this.selectedCandidateEmailAddress=null,_this.selectedMemberEmailAddress=null,jQuery.each(_this.validMemberList,function(j){_this.validMemberList[j].selectedMember=!1}),jQuery.each(_this.validCandidateList,function(j){_this.validCandidateList[j].selectedCandidateFromList=!1,_this.validCandidateList[j].selectedCandidateRight=!1}),_this.mobileControls.display=!1,_this.viewMode={list:!0,chart:!1},_this.switchToUser1=!0,_this.changeList="member",_this.selectedMemberDetails="",_this.selectedMemberEmailAddress=""},_this.updateCompareMember=function(i,col){$scope.labelsReset(),_this.cachedUSerEmails=null,_this.showMemberListingWidget=!1,_this.personalityFlags=[],_this.cachedAdvisorData=[],_this.resultTabs.leftSelected=0,_this.resultTabs.rightSelected=0,col?jQuery.each(_this.validCandidateList,function(j){_this.validCandidateList[j].selectedCandidateRight=!1}):(_this.listReset(),jQuery.each(_this.validMemberList,function(j){_this.validMemberList[j].selectedMember=!1}));var list=col?_this.validCandidateList:_this.validMemberList;jQuery.each(list,function(j){if(list[j].email===i)return list[j].selectedMember=!0,_this.memberSelected=!0,_this.selectedMemberDetails=list[parseInt(j)],_this.selectedMemberEmailAddress=list[parseInt(j)].id,col?list[j].selectedCandidateRight=!0:list[j].selectedMember=!0,void(!0===_this.viewMode.list?_this.compareCandidate(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress,{user1PersonalityType:"Primary",user2PersonalityType:"Primary"}):_this.getCompareCharts(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress))}),col?_this.validCandidateList=angular.copy(list):_this.validMemberList=angular.copy(list)},_this.updateCompareCandidate=function(i){$scope.labelsReset(),_this.cachedUSerEmails=null,_this.showCandidateListingWidget=!1,_this.personalityFlags=[],_this.cachedAdvisorData=[],_this.resultTabs.leftSelected=0,_this.resultTabs.rightSelected=0,jQuery.each(_this.validCandidateList,function(j){_this.validCandidateList[j].selectedCandidateFromList=!1}),jQuery.each(_this.validCandidateList,function(j){_this.validCandidateList[j].email===i&&(_this.validCandidateList[parseInt(j)].selectedCandidateFromList=!0,_this.candidateSelected=!0,_this.selectedCandidate=_this.validCandidateList[parseInt(j)],_this.selectedCandidateEmailAddress=_this.validCandidateList[parseInt(j)].email,!0===_this.viewMode.list?_this.compareCandidate(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress,{user1PersonalityType:"Primary",user2PersonalityType:"Primary"}):_this.getCompareCharts(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress))}),_this.winWidth<768&&$timeout(function(){$rootScope.setBoxSizes("#dd-wrap",".dd","full")},300)},_this.getCompareCharts=function(c,m){if(_this.candidateSelected&&_this.memberSelected&&null===_this.cachedUSerEmails){var _o={url:"/sp/hiring/compareProfile",data:$.param({user1Id:_this.activeUser.id,user2Id:m})};_this.cachedUSerEmails=c+m,ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&(_this.compareProfileData=response,_this.candidateProfileDetails=response.user1Analysis,_this.memberProfileDetails=response.user2Analysis,_this.cacheCompareResponse=response,_this.winWidth>767?(_this.showContent=!0,_this.mobileControls.display=!1,_this.cachedUSerEmails=null):(_this.showContent=!1,_this.mobileControls.display=!0,_this.switchToUser1=!0,setTimeout(function(){$rootScope.setBoxSizes(".mobile-tabs",".mtabs")},200)),_this.personalityFormatted={candidate:{primary:$rootScope.pullInterNationalization("profileKeys."+_this.candidateProfileDetails.personality.Primary.personalityType.trim()),pressure:$rootScope.pullInterNationalization("profileKeys."+_this.candidateProfileDetails.personality.UnderPressure.personalityType.trim())},member:{primary:$rootScope.pullInterNationalization("profileKeys."+_this.memberProfileDetails.personality.Primary.personalityType.trim()),pressure:$rootScope.pullInterNationalization("profileKeys."+_this.memberProfileDetails.personality.UnderPressure.personalityType.trim())}},$timeout(function(){_this.dataAvailablity=!0},300))})}},_this.changeViewMode=function(v){$scope.labelsReset(),_this.showMemberListingWidget=!1,_this.showCandidateListingWidget=!1,"list"===v?(_this.viewMode.list=!0,_this.viewMode.chart=!1,_this.compareCandidate(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress,{user1PersonalityType:"Primary",user2PersonalityType:"Primary"})):(_this.viewMode.list=!1,_this.viewMode.chart=!0,_this.getCompareCharts(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress))},_this.compareCandidate=function(c,m,pTypes){if(_this.candidateSelected&&_this.memberSelected){var data=$.extend({},{user1Id:_this.activeUser.id,user2Id:m},pTypes),_o={url:"/sp/hiring/compareRelation",data:$.param(data)};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&(_this.cacheResults(data,response),_this.winWidth>767?(_this.showContent=!0,_this.mobileControls.display=!1,_this.cachedUSerEmails=null):(_this.showContent=!1,_this.mobileControls.display=!0,_this.switchToUser1=!0,setTimeout(function(){$rootScope.setBoxSizes(".mobile-tabs",".mtabs")},200)),setTimeout(function(){$rootScope.setBoxSizes(".results-wrapper",".results-content")},500))})}},_this.cacheResults=function(p,r){var pType=p.user1PersonalityType.charAt(0)+p.user2PersonalityType.charAt(0);-1===$.inArray(pType,_this.personalityFlags)&&(_this.personalityFlags.push(pType),_this.cachedAdvisorData[pType]=r,_this.candidateAdvise=_this.cachedAdvisorData[pType].primary,_this.memberAdvise=_this.cachedAdvisorData[pType].secondary),$localStorage.set("ca_candAdvise",_this.candidateAdvise),$localStorage.set("ca_memberAdvise",_this.memberAdvise),$localStorage.set("ca_selectedMemberDetails",_this.selectedMemberDetails),$localStorage.set("ca_selectedCandidate",_this.selectedCandidate),$localStorage.set("ca_resultTabs",_this.resultTabs),$rootScope.$broadcast("reportAvailable")},$scope.formatList=_this.formatList=function(list){if(void 0!==list){var rawList=list.split("</p>"),listHTML="",counter=0;if(jQuery.each(rawList,function(i){void 0!==rawList[i].split("<p>")[1]&&(listHTML+="<li>"+rawList[i].split("<p>")[1]+"</li>"),counter++}),counter===rawList.length)return listHTML}},_this.changeContentTabs=function(s,i){"left"===s?_this.resultTabs.leftSelected=parseInt(i):_this.resultTabs.rightSelected=parseInt(i);var u1PType=0===_this.resultTabs.leftSelected?"Primary":"UnderPressure",u2PType=0===_this.resultTabs.rightSelected?"Primary":"UnderPressure",pFlag=u1PType.charAt(0)+u2PType.charAt(0);-1===$.inArray(pFlag,_this.personalityFlags)?$timeout(function(){_this.compareCandidate(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress,{user1PersonalityType:u1PType,user2PersonalityType:u2PType})},100):(_this.candidateAdvise=_this.cachedAdvisorData[pFlag].primary,_this.memberAdvise=_this.cachedAdvisorData[pFlag].secondary)},_this.initCandiateCompare=function(){_this.getAllCandidateDetails(),_this.getAllMemberDetails()},_this.getMobileReport=function(v){_this.winScreenHeight=jQuery(window).height()+"px",!0===v?ngDialog.open({template:"/sp/resources/html/tools/hiring/mobile-report.html",scope:$scope}):ngDialog.open({template:"/sp/resources/html/tools/hiring/mobile-charts.html",scope:$scope})},jQuery(window).resize(function(){_this.winWidth<768?(_this.candidateSelected&&_this.memberSelected&&0===_this.sResizeFlag&&!1===_this.mobileControls.display&&(_this.showContent=!1,$timeout(function(){_this.mobileControls.display=!0},500),_this.sResizeFlag=1,_this.lResizeFlag=0),$rootScope.setBoxSizes("#dd-wrap",".dd","full")):(_this.candidateSelected&&_this.memberSelected&&0===_this.lResizeFlag&&($timeout(function(){_this.mobileControls.display=!1,_this.showContent=!0},500),_this.sResizeFlag=0,_this.lResizeFlag=1),ngDialog.close("ngdialog1"),jQuery("body").find("#dd-wrap").find(".dd").removeAttr("style"))}),_this.openPdfView=function(url,_this,profileName){window.open(url,"_blank"),window.focus()},_this.initPrint=function(){$rootScope.renderedPrintGraphsInfo={},$rootScope.renderedPrintGraphsInfo.count=0,$rootScope.renderedPrintGraphsInfo.list=[],_this.initCandiateCompare()};var memberListAvailable="print"===sharedProperties.getParam("mode")&&$scope.$on("memberListAvailable",function(e){memberListAvailable();var printParams=sharedProperties.getParam("printParams").split(","),email1=printParams[0],tab1=printParams[1],tab2=printParams[2],clist="member"!==printParams[4];_this.updateCompareMember(email1,clist),"false"!==printParams[3]&&(_this.changeContentTabs("left",tab1),_this.changeContentTabs("right",tab2))}),candidateListAvailable="print"===sharedProperties.getParam("mode")&&$scope.$on("candidateListAvailable",function(e){candidateListAvailable();var printParams=sharedProperties.getParam("printParams").split(","),email1=printParams[0],tab1=printParams[1],tab2=printParams[2],clist="member"!==printParams[4];_this.updateCompareMember(email1,clist),"false"!==printParams[3]&&(_this.changeContentTabs("left",tab1),_this.changeContentTabs("right",tab2))}),reportAvailable="print"===sharedProperties.getParam("mode")&&$scope.$on("reportAvailable",function(e){reportAvailable();var isPrintMode="print"===sharedProperties.getParam("mode")&&"false"!==sharedProperties.getParam("printParams").split(",")[3];$timeout(function(){isPrintMode&&angular.element(document).ready(function(){window.print(),window.close()})},0)}),updateGraphCount="print"===sharedProperties.getParam("mode")&&$scope.$on("updateGraphCounter",function(e,data){if(null===data)return!0;$scope.$apply(function(){-1===$rootScope.renderedPrintGraphsInfo.list.indexOf(data.graphName)&&($rootScope.renderedPrintGraphsInfo.list.push(data.graphName),$rootScope.renderedPrintGraphsInfo.count=$rootScope.renderedPrintGraphsInfo.count+1),25===$rootScope.renderedPrintGraphsInfo.count&&(updateGraphCount(),$rootScope.$broadcast("graphsLoaded"))})}),printGraphs="print"===sharedProperties.getParam("mode")&&$scope.$on("graphsLoaded",function(e){printGraphs();var isPrintMode="print"===sharedProperties.getParam("mode")&&"false"===sharedProperties.getParam("printParams").split(",")[3];$timeout(function(){isPrintMode&&angular.element(document).ready(function(){window.print(),window.close()})},0)})}angular.module("spApp").controller("candidateAdvisorController",candidateAdvisorController),candidateAdvisorController.$inject=["$scope","$timeout","ajaxService","$rootScope","$localStorage","ngDialog","sharedProperties","$state","memberService"];