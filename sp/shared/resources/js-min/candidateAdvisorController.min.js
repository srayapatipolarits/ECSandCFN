function candidateAdvisorController($scope,$timeout,ajaxService,$rootScope,$localStorage,ngDialog,sharedProperties,$state,memberService){var _this=this;_this.selectedCandidate={},_this.memberMasterList={},_this.validMemberList=[],_this.candidateMasterList={},_this.validCandidateList=[],_this.selectedMemberDetails={},_this.candidateProfileDetails={},_this.memberProfileDetails={},_this.candidateAdvise={},_this.memberAdvise={},_this.candidateAvoidFormatted=[],_this.resultTabs={},_this.personalityFlags=[],_this.cachedAdvisorData=[],_this.showMemberListingWidget=!1,_this.memberSelected=!1,_this.showContent=!1,_this.resultTabs.leftSelected=0,_this.resultTabs.rightSelected=0,_this.mobileControls={},_this.mobileControls.display=!1,"print"===sharedProperties.getParam("mode")&&null!==sharedProperties.getParam("printParams")&&"false"!==sharedProperties.getParam("printParams").split(",")[3]?_this.viewMode={list:!0,chart:!1}:"print"===sharedProperties.getParam("mode")&&null!==sharedProperties.getParam("printParams")&&"false"===sharedProperties.getParam("printParams").split(",")[3]?_this.viewMode={list:!1,chart:!0}:_this.viewMode={list:!0,chart:!1},_this.switchToUser1=!0,_this.cachedUSerEmails=null,_this.winWidth=jQuery(window).width(),_this.sResizeFlag=0,_this.lResizeFlag=0,$scope.prismLabelContent=!1,$scope.prismLabelContent1=!1,$scope.label="",_this.changeList="member",_this.candidateSelected=!1,_this.selectedCandidate="",_this.activeUser=$localStorage.get("activeEmp"),$rootScope.renderedPrintGraphsInfo={},$rootScope.renderedPrintGraphsInfo.count=0,$rootScope.renderedPrintGraphsInfo.list=[];var lang=sharedProperties.getUserLocale();_this.setHeadings=function(name,heading){return"en-US"===lang?name+heading:name+" "+heading},jQuery(window).resize(function(){_this.winWidth=jQuery(window).width()}),_this.returnBack=function(){"HiringCandidate"===_this.activeUser.type?$localStorage.set("fromCompare","candidatesModule"):$localStorage.set("fromCompare","employeesModule"),$localStorage.remove("activeEmp"),window.history.back()},$scope.labelsReset=function(){jQuery(".outer-labels").find("p").removeClass("active"),$scope.prismLabelContent=!1,$scope.prismLabelContent1=!1,$scope.label=""},_this.getAllCandidateDetails=function(){memberService.getAllCandidates().then(function(response){null===sharedProperties.getParam("mode")?_this.selectedCandidateEmailAddress=void 0!==$state.params.email&&null!==$state.params.email&&""!==$state.params.email?$state.params.email.replace(/%2B/g,"+").split("+")[0]:"":_this.selectedCandidateEmailAddress=sharedProperties.getParam("email");var counter=0,newList=[];_this.candidateMasterList=response,jQuery.each(_this.candidateMasterList,function(i,j){"VALID"===_this.candidateMasterList[i].userStatus&&_this.candidateMasterList[i].id!==_this.activeUser.id&&(null===_this.candidateMasterList[i].spUserId||void 0===_this.candidateMasterList[i].spUserId?(newList=jQuery.extend({},_this.candidateMasterList[i],{selectedCandidateFromList:!1,selectedCandidateRight:!1}),_this.validCandidateList.push(newList)):void 0!==_this.candidateMasterList[i].profileSettings&&!0===_this.candidateMasterList[i].profileSettings.hiringAccessAllowed&&(newList=jQuery.extend({},_this.candidateMasterList[i],{selectedCandidateFromList:!1,selectedCandidateRight:!1}),_this.validCandidateList.push(newList),_this.winWidth<768&&$timeout(function(){$rootScope.setBoxSizes("#dd-wrap",".dd","full")},300))),counter++}),_this.selectedCandidate=_this.activeUser,_this.candidateSelected=!0,_this.winWidth<768&&$timeout(function(){$rootScope.setBoxSizes("#dd-wrap",".dd","full")},300),null===sharedProperties.getParam("mode")&&$("html,body").animate({scrollTop:$(".header-info-container").offset().top-40},1e3),$rootScope.$broadcast("candidateListAvailable")})},_this.getAllMemberDetails=function(){memberService.getAllEmployees().then(function(response){_this.memberMasterList=response,jQuery.each(_this.memberMasterList,function(i,j){if("VALID"===_this.memberMasterList[i].userStatus&&_this.memberMasterList[i].id!==_this.activeUser.id){var newList=jQuery.extend({},_this.memberMasterList[i],{selectedMember:!1});_this.validMemberList.push(newList)}}),$rootScope.$broadcast("memberListAvailable")})},_this.showDropdownWidget=function(side){"right"===side&&(_this.showMemberListingWidget=!_this.showMemberListingWidget,_this.showCandidateListingWidget=!1)},_this.listReset=function(){jQuery.each(_this.validCandidateList,function(j){_this.validCandidateList[j].selectedCandidateRight=!1})},_this.compareToolReset=function(){_this.cachedUSerEmails=null,_this.resultTabs={},_this.personalityFlags=[],_this.cachedAdvisorData=[],_this.resultTabs.leftSelected=0,_this.resultTabs.rightSelected=0,_this.showContent=!1,_this.showMemberListingWidget=!1,_this.memberSelected=!1,_this.showCandidateListingWidget=!1,_this.selectedCandidateEmailAddress=null,_this.selectedMemberEmailAddress=null,jQuery.each(_this.validMemberList,function(j){_this.validMemberList[j].selectedMember=!1}),jQuery.each(_this.validCandidateList,function(j){_this.validCandidateList[j].selectedCandidateFromList=!1,_this.validCandidateList[j].selectedCandidateRight=!1}),_this.mobileControls.display=!1,_this.viewMode={list:!0,chart:!1},_this.switchToUser1=!0,_this.changeList="member",_this.selectedMemberDetails="",_this.selectedMemberEmailAddress=""},_this.updateCompareMember=function(i,col){$scope.labelsReset(),_this.cachedUSerEmails=null,_this.showMemberListingWidget=!1,_this.personalityFlags=[],_this.cachedAdvisorData=[],_this.resultTabs.leftSelected=0,_this.resultTabs.rightSelected=0,col?jQuery.each(_this.validCandidateList,function(j){_this.validCandidateList[j].selectedCandidateRight=!1}):(_this.listReset(),jQuery.each(_this.validMemberList,function(j){_this.validMemberList[j].selectedMember=!1}));var list=col?_this.validCandidateList:_this.validMemberList;jQuery.each(list,function(j){if(list[j].email===i)return list[j].selectedMember=!0,_this.memberSelected=!0,_this.selectedMemberDetails=list[parseInt(j)],_this.selectedMemberEmailAddress=list[parseInt(j)].id,col?list[j].selectedCandidateRight=!0:list[j].selectedMember=!0,void(!0===_this.viewMode.list?_this.compareCandidate(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress,{user1PersonalityType:"Primary",user2PersonalityType:"Primary"}):_this.getCompareCharts(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress))}),col?_this.validCandidateList=angular.copy(list):_this.validMemberList=angular.copy(list)},_this.updateCompareCandidate=function(i){$scope.labelsReset(),_this.cachedUSerEmails=null,_this.showCandidateListingWidget=!1,_this.personalityFlags=[],_this.cachedAdvisorData=[],_this.resultTabs.leftSelected=0,_this.resultTabs.rightSelected=0,jQuery.each(_this.validCandidateList,function(j){_this.validCandidateList[j].selectedCandidateFromList=!1}),jQuery.each(_this.validCandidateList,function(j){_this.validCandidateList[j].email===i&&(_this.validCandidateList[parseInt(j)].selectedCandidateFromList=!0,_this.candidateSelected=!0,_this.selectedCandidate=_this.validCandidateList[parseInt(j)],_this.selectedCandidateEmailAddress=_this.validCandidateList[parseInt(j)].email,!0===_this.viewMode.list?_this.compareCandidate(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress,{user1PersonalityType:"Primary",user2PersonalityType:"Primary"}):_this.getCompareCharts(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress))}),_this.winWidth<768&&$timeout(function(){$rootScope.setBoxSizes("#dd-wrap",".dd","full")},300)},_this.getCompareCharts=function(c,m){if(_this.candidateSelected&&_this.memberSelected&&null===_this.cachedUSerEmails){var _o={url:"/sp/hiring/compareProfile",data:$.param({user1Id:_this.activeUser.id,user2Id:m})};_this.cachedUSerEmails=c+m,ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&(_this.compareProfileData=response,_this.candidateProfileDetails=response.user1Analysis,_this.memberProfileDetails=response.user2Analysis,_this.cacheCompareResponse=response,_this.winWidth>767?(_this.showContent=!0,_this.mobileControls.display=!1,_this.cachedUSerEmails=null):(_this.showContent=!1,_this.mobileControls.display=!0,_this.switchToUser1=!0,setTimeout(function(){$rootScope.setBoxSizes(".mobile-tabs",".mtabs")},200)),_this.personalityFormatted={candidate:{primary:$rootScope.pullInterNationalization("profileKeys."+_this.candidateProfileDetails.personality.Primary.personalityType.trim()),pressure:$rootScope.pullInterNationalization("profileKeys."+_this.candidateProfileDetails.personality.UnderPressure.personalityType.trim())},member:{primary:$rootScope.pullInterNationalization("profileKeys."+_this.memberProfileDetails.personality.Primary.personalityType.trim()),pressure:$rootScope.pullInterNationalization("profileKeys."+_this.memberProfileDetails.personality.UnderPressure.personalityType.trim())}},$timeout(function(){_this.dataAvailablity=!0},300))})}},_this.changeViewMode=function(v){$scope.labelsReset(),_this.showMemberListingWidget=!1,_this.showCandidateListingWidget=!1,"list"===v?(_this.viewMode.list=!0,_this.viewMode.chart=!1,_this.compareCandidate(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress,{user1PersonalityType:"Primary",user2PersonalityType:"Primary"})):(_this.viewMode.list=!1,_this.viewMode.chart=!0,_this.getCompareCharts(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress))},_this.compareCandidate=function(c,m,pTypes){if(_this.candidateSelected&&_this.memberSelected){var data=$.extend({},{user1Id:_this.activeUser.id,user2Id:m},pTypes),_o={url:"/sp/hiring/compareRelation",data:$.param(data)};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&(_this.cacheResults(data,response),_this.winWidth>767?(_this.showContent=!0,_this.mobileControls.display=!1,_this.cachedUSerEmails=null):(_this.showContent=!1,_this.mobileControls.display=!0,_this.switchToUser1=!0,setTimeout(function(){$rootScope.setBoxSizes(".mobile-tabs",".mtabs")},200)),setTimeout(function(){$rootScope.setBoxSizes(".results-wrapper",".results-content")},500))})}},_this.cacheResults=function(p,r){var pType=p.user1PersonalityType.charAt(0)+p.user2PersonalityType.charAt(0);-1===$.inArray(pType,_this.personalityFlags)&&(_this.personalityFlags.push(pType),_this.cachedAdvisorData[pType]=r,_this.candidateAdvise=_this.cachedAdvisorData[pType].primary,_this.memberAdvise=_this.cachedAdvisorData[pType].secondary),$localStorage.set("ca_candAdvise",_this.candidateAdvise),$localStorage.set("ca_memberAdvise",_this.memberAdvise),$localStorage.set("ca_selectedMemberDetails",_this.selectedMemberDetails),$localStorage.set("ca_selectedCandidate",_this.selectedCandidate),$localStorage.set("ca_resultTabs",_this.resultTabs),$rootScope.$broadcast("reportAvailable")},$scope.formatList=_this.formatList=function(list){if(void 0!==list){var rawList=list.split("</p>"),listHTML="",counter=0;if(jQuery.each(rawList,function(i){void 0!==rawList[i].split("<p>")[1]&&(listHTML+="<li>"+rawList[i].split("<p>")[1]+"</li>"),counter++}),counter===rawList.length)return listHTML}},_this.changeContentTabs=function(s,i){"left"===s?_this.resultTabs.leftSelected=parseInt(i):_this.resultTabs.rightSelected=parseInt(i);var u1PType=0===_this.resultTabs.leftSelected?"Primary":"UnderPressure",u2PType=0===_this.resultTabs.rightSelected?"Primary":"UnderPressure",pFlag=u1PType.charAt(0)+u2PType.charAt(0);-1===$.inArray(pFlag,_this.personalityFlags)?$timeout(function(){_this.compareCandidate(_this.selectedCandidateEmailAddress,_this.selectedMemberEmailAddress,{user1PersonalityType:u1PType,user2PersonalityType:u2PType})},100):(_this.candidateAdvise=_this.cachedAdvisorData[pFlag].primary,_this.memberAdvise=_this.cachedAdvisorData[pFlag].secondary)},_this.initCandiateCompare=function(){_this.getAllCandidateDetails(),_this.getAllMemberDetails()},_this.getMobileReport=function(v){_this.winScreenHeight=jQuery(window).height()+"px",!0===v?ngDialog.open({template:"/sp/resources/html/tools/hiring/mobile-report.html",scope:$scope}):ngDialog.open({template:"/sp/resources/html/tools/hiring/mobile-charts.html",scope:$scope})},jQuery(window).resize(function(){_this.winWidth<768?(_this.candidateSelected&&_this.memberSelected&&0===_this.sResizeFlag&&!1===_this.mobileControls.display&&(_this.showContent=!1,$timeout(function(){_this.mobileControls.display=!0},500),_this.sResizeFlag=1,_this.lResizeFlag=0),$rootScope.setBoxSizes("#dd-wrap",".dd","full")):(_this.candidateSelected&&_this.memberSelected&&0===_this.lResizeFlag&&($timeout(function(){_this.mobileControls.display=!1,_this.showContent=!0},500),_this.sResizeFlag=0,_this.lResizeFlag=1),ngDialog.close("ngdialog1"),jQuery("body").find("#dd-wrap").find(".dd").removeAttr("style"))}),_this.openPdfView=function(url,_this,profileName){window.open(url,"_blank"),window.focus()},_this.initPrint=function(){$rootScope.renderedPrintGraphsInfo={},$rootScope.renderedPrintGraphsInfo.count=0,$rootScope.renderedPrintGraphsInfo.list=[],_this.initCandiateCompare()};var memberListAvailable="print"===sharedProperties.getParam("mode")&&$scope.$on("memberListAvailable",function(e){memberListAvailable();var printParams=sharedProperties.getParam("printParams").split(","),email1=printParams[0],tab1=printParams[1],tab2=printParams[2],clist="member"!==printParams[4];_this.updateCompareMember(email1,clist),"false"!==printParams[3]&&(_this.changeContentTabs("left",tab1),_this.changeContentTabs("right",tab2))}),candidateListAvailable="print"===sharedProperties.getParam("mode")&&$scope.$on("candidateListAvailable",function(e){candidateListAvailable();var printParams=sharedProperties.getParam("printParams").split(","),email1=printParams[0],tab1=printParams[1],tab2=printParams[2],clist="member"!==printParams[4];_this.updateCompareMember(email1,clist),"false"!==printParams[3]&&(_this.changeContentTabs("left",tab1),_this.changeContentTabs("right",tab2))}),reportAvailable="print"===sharedProperties.getParam("mode")&&$scope.$on("reportAvailable",function(e){reportAvailable();var isPrintMode="print"===sharedProperties.getParam("mode")&&"false"!==sharedProperties.getParam("printParams").split(",")[3];$timeout(function(){isPrintMode&&angular.element(document).ready(function(){window.print(),window.close()})},0)}),updateGraphCount="print"===sharedProperties.getParam("mode")&&$scope.$on("updateGraphCounter",function(e,data){if(null===data)return!0;$scope.$apply(function(){-1===$rootScope.renderedPrintGraphsInfo.list.indexOf(data.graphName)&&($rootScope.renderedPrintGraphsInfo.list.push(data.graphName),$rootScope.renderedPrintGraphsInfo.count=$rootScope.renderedPrintGraphsInfo.count+1),25===$rootScope.renderedPrintGraphsInfo.count&&(updateGraphCount(),$rootScope.$broadcast("graphsLoaded"))})}),printGraphs="print"===sharedProperties.getParam("mode")&&$scope.$on("graphsLoaded",function(e){printGraphs();var isPrintMode="print"===sharedProperties.getParam("mode")&&"false"===sharedProperties.getParam("printParams").split(",")[3];$timeout(function(){isPrintMode&&angular.element(document).ready(function(){window.print(),window.close()})},0)})}angular.module("spApp").controller("candidateAdvisorController",candidateAdvisorController),candidateAdvisorController.$inject=["$scope","$timeout","ajaxService","$rootScope","$localStorage","ngDialog","sharedProperties","$state","memberService"];