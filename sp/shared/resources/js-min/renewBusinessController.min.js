function renewBusinessController($scope,$element,$attrs,$http,ngDialog,$timeout,ajaxService,$rootScope){$scope.priceFormatter=function(p){if(void 0!==p&&""!==p&&null!==p){return"$"+p.toFixed(2)}},$scope.product={},$scope.promoApplied=!1,$scope.finalAmount=0,$scope.promo={},$scope.updatedPromoDetails={},$scope.updateCC={},$scope.activeMembers=0,$scope.renewBusiness={},$scope.account={},$scope.promoFormSubmitted=!1,$scope.promoError={},$scope.promoError.error=!1,$scope.dialogStatus={},$scope.timeout=0,$scope.submitDisabled=!1,$scope.pricing={},$scope.bBox={},$scope.getMemberCount=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/getActiveMemberCount"}).then(function(response){if("true"===response.Success)$scope.activeMembers=response.activeMembers,$scope.account.numAccounts=response.activeMembers;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getAcccountInfo=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/businessAccountDetails"}).then(function(response){if("true"===response.Success)$scope.accountDetails=response,$scope.renewalDate=response.account.productInfo.renewalDate;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getPlanInfo=function(){ajaxService.getAjaxResponse({url:"/sp/signup/getProducts",data:$.param({productType:"BUSINESS"})}).then(function(response){if("true"===response.Success)$scope.products=response.products,$.each($scope.products,function(i){"YEARLY"===$scope.products[i].validityType&&($scope.annualProduct=$scope.products[i],$scope.pricing.yearlyUnitPrice=$scope.products[i].unitPrice),"MONTHLY"===$scope.products[i].validityType&&($scope.monthlyProduct=$scope.products[i],$scope.pricing.monthlyUnitPrice=$scope.products[i].unitPrice)}),$scope.getProductInfo();else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getProductInfo=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/getCurrentBusinessProductInfo"}).then(function(response){if("true"===response.Success){$scope.productInfoError=!1,$scope.submitDisabled=!1,$scope.product=response.product;var multiplier="YEARLY"===$scope.product.validityType?12:1;$scope.bBox.yearly="YEARLY"===$scope.product.validityType,void 0!==response.promotion&&void 0!==response.promotion.unitPrice?($scope.product.updatedUnitPrice=parseFloat(response.promotion.unitPrice).toFixed(2),$scope.promoApplied=!0,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.activeMembers*multiplier).toFixed(2)):($scope.product.updatedUnitPrice=parseFloat("YEARLY"===$scope.product.validityType?$scope.pricing.yearlyUnitPrice:$scope.pricing.monthlyUnitPrice).toFixed(2),$scope.promoApplied=!1,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.activeMembers*multiplier).toFixed(2))}else $scope.productInfoError=!0,$scope.submitDisabled=!0,jQuery("html, body").animate({scrollTop:0})})},$scope.paymentCalculator=function(empNo,action,type,event){var currentEmpNo=parseInt(empNo),updatedEmpNo=0,multiplier="YEARLY"===type?12:1;void 0===event?currentEmpNo>=20&&"add"===action?(updatedEmpNo=parseInt(currentEmpNo+1),$scope.account.numAccounts=updatedEmpNo,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*updatedEmpNo*multiplier).toFixed(2)):currentEmpNo>20&&"remove"===action?(updatedEmpNo=parseInt(currentEmpNo-1),$scope.account.numAccounts=updatedEmpNo,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*updatedEmpNo*multiplier).toFixed(2)):($scope.account.numAccounts=parseInt($scope.account.minEmployee),$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.account.numAccounts*multiplier).toFixed(2)):/^[0-9\b]+$/g.test(empNo)&&empNo>=20?($scope.account.numAccounts=empNo,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.account.numAccounts*multiplier).toFixed(2),$timeout.cancel($scope.timeout)):($timeout.cancel($scope.timeout),$scope.timeout=$timeout(function(){$scope.account.numAccounts=20,$scope.finalAmount=parseFloat(20*$scope.product.updatedUnitPrice*multiplier).toFixed(2)},1500))},$scope.activatePromo=function(promoCode){if($scope.promoFormSubmitted=!1,$scope.promoError.error=!1,void 0!==promoCode){var _params={code:promoCode,productId:$scope.product.id};ajaxService.getAjaxResponse({url:"/sp/signup/promotion",data:$.param(_params)}).then(function(response){"true"===response.Success?($scope.updatedPromoDetails=response.promotion,$scope.pricing.promoUnitPrice=parseFloat(response.promotion.unitPrice).toFixed(2),$scope.product.updatedUnitPrice=parseFloat(response.promotion.unitPrice).toFixed(2),$scope.promoApplied=!0,!0===$scope.bBox.yearly?$scope.finalAmount=parseFloat($scope.pricing.promoUnitPrice*$scope.account.numAccounts*12).toFixed(2):$scope.finalAmount=parseFloat($scope.pricing.promoUnitPrice*$scope.account.numAccounts*1).toFixed(2)):($scope.promoError.error=!0,$scope.promoError.msg=response.error)})}else $scope.promoFormSubmitted=!0},$scope.renewIndividualSubscription=function(fData){var _paramsUpdated,_params={},vCount=0;for(var k in fData)"default"!==fData[k]&&"default1"!==fData[k]||vCount++;_params=!1===$scope.promoApplied?{productId:$scope.product.id}:{productId:$scope.product.id,promotionId:$scope.updatedPromoDetails.id},$scope.updateCC.$valid&&0===vCount?(_paramsUpdated=$.extend({},_params,fData),ajaxService.getAjaxResponse({url:"/sp/admin/account/renewAccount",data:$.param(_paramsUpdated)}).then(function(response){if("true"===response.Success)$scope.dialogStatus.title="Subscription Renewal",$scope.dialogStatus.content="Subscription renewed successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/success-dialog.html",scope:$scope});else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})):$scope.updateCC.submitted=!0},$scope.deactivatePromo=function(){$scope.pricing.promoUnitPrice=0,!0===$scope.bBox.yearly?$scope.finalAmount=parseFloat($scope.pricing.yearlyUnitPrice*$scope.account.numAccounts*12).toFixed(2):$scope.finalAmount=parseFloat($scope.pricing.monthlyUnitPrice*$scope.account.numAccounts*1).toFixed(2),$scope.promoApplied=!1,$scope.promo.code=null},$scope.cancelRedirect=function(){window.location="/sp/admin/account/business"},$scope.renewBusinessSubscription=function(fData){var _paramsUpdated,_params={};_params=!1===$scope.promoApplied?{numAccounts:$scope.account.numAccounts,productId:$scope.product.id}:{numAccounts:$scope.account.numAccounts,productId:$scope.product.id,promotionId:$scope.updatedPromoDetails.id},!1===$scope.submitDisabled&&($scope.renewBusiness.$valid?(_paramsUpdated=$.extend({},_params,fData),ajaxService.getAjaxResponse({url:"/sp/admin/account/renewAccount",data:$.param(_paramsUpdated)}).then(function(response){if("true"===response.Success)$scope.dialogStatus.title="Subscription Renewal",$scope.dialogStatus.content="Subscription renewed successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/success-dialog.html",scope:$scope});else{$scope.submitException=!0;for(var key in response.error)$scope.submitExceptionMsg=response.error[key];jQuery("html, body").animate({scrollTop:0})}})):$scope.renewBusiness.submitted=!0)},$scope.changePlan=function(type){"YEARLY"===type?($scope.product.updatedUnitPrice=!0===$scope.promoApplied?$scope.pricing.promoUnitPrice:$scope.pricing.yearlyUnitPrice,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.account.numAccounts*12).toFixed(2),$scope.bBox.yearly=!0):($scope.product.updatedUnitPrice=!0===$scope.promoApplied?$scope.pricing.promoUnitPrice:$scope.pricing.monthlyUnitPrice,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.account.numAccounts*1).toFixed(2),$scope.bBox.yearly=!1)},$scope.initRenewBusiness=function(){$scope.getMemberCount(),$scope.getPlanInfo(),$scope.getAcccountInfo()},$scope.initRenewBusiness()}angular.module("spApp").controller("Additional Member Accounts",renewBusinessController),renewBusinessController.$inject=["$scope","$element","$attrs","$http","ngDialog","$timeout","ajaxService","$rootScope"];