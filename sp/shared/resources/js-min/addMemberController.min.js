function addMemberController($scope,$http,$element,$attrs,ngDialog,ajaxService,$timeout,$localStorage){$scope.subscriptionStatus=0,$scope.subscriptionStatus.error=!1,$scope.groupDataSet={},$scope.groupDataSetBackup={},$scope.previousGroup=[],$scope.dataWithFlags=[],$scope.dataWithOrder=[],$scope.tagList=[],$scope.flagCounter=0,$scope.addMemberStatus={},$scope.addMemberStatus.serverError=!1,$scope.subscriptionStatus.error=!1,$scope.addMemberStatus.existingEmailError=!1,$scope.addMemberStatus.exceedEmailError=!1,$scope.addMemberEmailCount=0,$scope.emailCountError=!1,$scope.newOrderFlag=0,$scope.failedEmailList=[],$scope.failedEmailFlag=!1,$scope.addMemberStatus.inValidEmailError=!1,$scope.addMemberStatus.requiredError=!1,$scope.member={},$scope.newHireCheck=!1,$scope.errornewGroup=!1;var storedProfile=$localStorage.get("loggegdInProfile"),userRoles=storedProfile.member.roles.sort();if($scope.isAccountAdmin=0===jQuery.inArray("AccountAdministrator",userRoles),null!==$localStorage.get("addAccounts")&&void 0!==$localStorage.get("addAccounts")&&$timeout(function(){ngDialog.open({template:"/sp/resources/html/admin/account/request-success.html",scope:$scope}),$localStorage.remove("addAccounts")},300),null!==$localStorage.get("newHireDetails")){var newHireDetails=$localStorage.get("newHireDetails");$scope.member.firstName=newHireDetails.firstName,$scope.member.lastName=newHireDetails.lastName,$scope.cId=newHireDetails.candidateId}null!==$localStorage.get("newHireCheck")?$scope.newHireCheck=!0:$scope.newHireCheck=!1,$scope.getSubscriptionStatus=function(){ajaxService.getAjaxResponse({url:"/sp/admin/member/availalbeMemberSubscriptions",data:$.param({spPlanType:"Primary"})}).then(function(response){if("true"===response.Success)$scope.subscriptionStatus=response.availalbeMemberSubscriptions,0===$scope.subscriptionStatus&&($scope.subscriptionStatusError=!0);else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getSubscriptionStatus(),$scope.getGroupList=function(){ajaxService.getAjaxResponse({url:"/sp/admin/group/all"}).then(function(response){if("true"===response.Success)$scope.groupDataSet=response.groupInfoList,$scope.groupDataSetBackup=response.groupInfoList,jQuery.each($scope.groupDataSet,function(i,j){$scope.dataWithFlags.push(jQuery.extend({},$scope.groupDataSet[i],{selectedFlag:!1,isGroupLead:!1}))}),$scope.flagCounter=$scope.dataWithFlags.length;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getGroupList(),$scope.callCancel=function(){window.location="/sp/admin/memberListing#/member"},$scope.callRedirect=function(go){!0===go&&(window.location="/sp/admin/memberListing#/member")},$scope.updateTagList=function(single,multiple){$scope.member.groupAssociationList=null,$scope.tagList=[],jQuery.each($scope.dataWithFlags,function(i,j){!0===$scope.dataWithFlags[i].selectedFlag&&!0===multiple?$scope.tagList.push($scope.dataWithFlags[i].name):!0===$scope.dataWithFlags[i].selectedFlag&&!0===single&&(!0===$scope.dataWithFlags[i].isGroupLead?$scope.tagList.push($scope.dataWithFlags[i].name+":true"):$scope.tagList.push($scope.dataWithFlags[i].name+":false")),$scope.member.groupAssociationList=$scope.tagList.join()})},$scope.updateGroupLeadStatus=function(i,email,single,multiple){void 0!==$scope.dataWithFlags[i]&&null===email&&(!0===$scope.dataWithFlags[i].isGroupLead?$scope.dataWithFlags[i].isGroupLead=!1:$scope.dataWithFlags[i].isGroupLead=!0,$scope.updateTagList(single,multiple))},$scope.changeGroup=function(flag,single,multiple){"default"!==flag&&("createGroupCall_custom"===flag?($scope.params={p1:single,p2:multiple},$scope.errornewEmptyGroup=!1,$scope.errornewGroup=!1,ngDialog.open({template:"/sp/admin/group/createGroup",scope:$scope}),$scope.member.gList="default"):($scope.dataWithFlags[flag].selectedFlag=!0,$scope.flagCounter-=1,$scope.updateTagList(single,multiple),$scope.member.gList="default",$scope.dataWithFlags[flag].newOrder=$scope.newOrderFlag++,$scope.dataWithFlags[flag].originalIndex=flag))},$scope.removeGroup=function(flag,single,multiple){"default"!==flag&&($scope.dataWithFlags[flag].selectedFlag=!1,$scope.dataWithFlags[flag].isGroupLead=!1,$scope.flagCounter+=1,$scope.updateTagList(single,multiple))},$scope.addSingleMember=function(fData){var _data=$scope.newHireCheck?$.extend(fData,{candidateId:$scope.cId}):fData;$scope.addMember.submitted=!1,$scope.addMemberStatus={},$scope.addMember.$valid?ajaxService.getAjaxResponse({url:"/sp/admin/member/addSingle",data:$.param(_data).replace(/%2C/g,",")}).then(function(response){"true"===response.Success?($scope.addMemberStatus=response,$scope.addMemberStatus.title="Add Member",$localStorage.remove("newHireDetails","newHireCheck"),$localStorage.set("gNotify","single"),setTimeout(function(){window.location="/sp/admin/memberListing#/member"},150)):($scope.addMemberStatus.serverError=!0,$scope.addMemberStatus.content=response.error)}):$scope.addMember.submitted=!0},$scope.highlightTags=function(list){var tagContainer=jQuery("body").find(".add-member").find("p.emailTags").find(".tagsinput"),emailList=list;jQuery.each(jQuery(tagContainer).find("span.tag"),function(i,j){var tagEmail=jQuery(this).find("span").attr("data-email");-1!==jQuery.inArray(tagEmail,emailList)&&jQuery(j).addClass("error-email")})},$scope.searchExistingEmailList=function(fData){$scope.addMemberStatus.requiredError=!1;var updatedEmailList=fData.memberList.split(",").unique(),_param={memberList:updatedEmailList.toString()};void 0!==fData.memberList?ajaxService.getAjaxResponse({url:"/sp/signup/validateEmails",data:$.param(_param).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){if("true"===response.Success&&0===response.failureList.length)$scope.failedEmailList=[],$scope.failedEmailFlag=!1,$scope.addMemberStatus.existingEmailError=!1,$scope.addMultipleMembers(fData);else if("true"===response.Success&&response.failureList.length>0)$scope.addMemberStatus.existingEmailError=!0,$scope.failedEmailList=response.failureList,$scope.failedEmailFlag=!0,$scope.highlightTags($scope.failedEmailList);else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}}):$scope.addMemberStatus.requiredError=!0},$scope.addMultipleMembers=function(fData){var updatedEmailList=fData.memberList.split(",").unique();fData.memberList=updatedEmailList.toString(),$scope.addMember.submitted=!1,$scope.emailCountError=!1,$scope.getSubscriptionStatus(),$scope.addMemberEmailCount>$scope.subscriptionStatus?$scope.emailCountError=!0:$scope.addMember.$valid?ajaxService.getAjaxResponse({url:"/sp/admin/member/addMultiple",data:$.param(fData).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){if($scope.addMemberStatus=response,$scope.addMemberStatus.title="Add members","true"===response.Success&&0===response.failureList.length)$localStorage.set("gNotify","multiple"),setTimeout(function(){window.location="/sp/admin/memberListing#/member"},100);else if("true"===response.Success&&response.failureList.length>0)$scope.serverError=!0,$scope.errorMessage="Server exception: Failed to add "+response.failureList.join(", ");else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}}):$scope.addMember.submitted=!0},$scope.saveNewGroup=function(groupname,groupLeadEmailId){if($scope.errornewEmptyGroup=!1,$scope.errornewGroup=!1,""===groupname||void 0===groupname)return $scope.errornewEmptyGroup=!0,!1;var obj={name:groupname},options={url:"/sp/admin/group/create",data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),$scope.dataWithFlags.push({name:groupname,groupLead:null,numOfMembers:0,memberSummaryList:null,selectedFlag:!0,originalIndex:$scope.dataWithFlags.length,newOrder:$scope.newOrderFlag}),$scope.flagCounter-=1,$scope.member.gList="default",$scope.newOrderFlag+=1,$scope.updateTagList($scope.params.p1,$scope.params.p2)):null!=response.error&&($scope.member.gList="default",$scope.errornewGroup=!0)})},$scope.closeGroup=function(){$scope.member.gList="default",ngDialog.close("ngdialog1")},$scope.currentPageUrl=window.location.href,$scope.addAccountsModal=function(addType){$localStorage.remove("addAccounts"),$scope.addAccountsForm={},$scope.addAccountsForm.submitted=!1,$scope.addAccounts={};var processAddAccounts=function(data,e){$scope.noZeros="members"===addType?parseInt($scope.addAccounts.memberAccounts+$scope.addAccounts.memberAdminAccounts):parseInt($scope.addAccounts.candidateBundles+$scope.addAccounts.hiringAdminAccounts),$scope.addAccountsForm.submitted=!1,this.addAccountsForm.$valid&&0!==$scope.noZeros?($localStorage.set("addAccounts",!0),$scope.addAccountsForm.submitted=!1):($scope.addAccountsForm.submitted=!0,e.preventDefault())};$scope.processAddAccounts=processAddAccounts,$scope.addType=addType,ngDialog.open({template:"/sp/resources/html/admin/account/addAccountsModal.html",scope:$scope})}}angular.module("spApp").controller("addMemberController",addMemberController),addMemberController.$inject=["$scope","$http","$element","$attrs","ngDialog","ajaxService","$timeout","$localStorage"];