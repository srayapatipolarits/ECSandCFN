function pulseDetailsController($scope,$element,$attrs,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage,FileUploader,$filter){$scope.accountsListException=!1,$scope.updatedAccountListing=[],$scope.selectedAccountsCount=0,$scope.updatedListingIndex=0,$scope.accountList={},$scope.selectedCompanyIdList=[],$scope.allAccountsIdList=[],$scope.getDetailsException=!1,$scope.createNewPulse={},$scope.newPulse={},$scope.pulseEditing={},$scope.pulseEditing.status=!1,$scope.pulseIdStatus=!1,$scope.selectedAccountsDisplayList=[],$scope.showAccountsDisplayList=!1,$scope.pulseEnableEdit=function(s){"enable"===s?$scope.pulseEditing.status=!0:($scope.pulseEditing.status=!1,$scope.getPulseDetailsWithId()),$scope.accountList.search=null},$scope.getAccountList=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/hk/getCompanyList",method:"GET"}).then(function(response){if("true"===response.Success)$scope.accountsListException=!1,$scope.accountListing=response.companies,jQuery.each($scope.accountListing,function(i,j){$scope.updatedAccountListing.push(jQuery.extend({},$scope.accountListing[i],{accountSelectedStatus:!1})),$scope.allAccountsIdList.push($scope.accountListing[i].id)}),$scope.getPulseDetailsWithId();else{$scope.accountsListException=!0;for(var key in response.error)$scope.accountsListExceptionMsg=response.error[key]}})},$scope.addtoSelectedAccounts=function(id){var _temp=angular.copy($scope.updatedAccountListing);jQuery.each(_temp,function(i){if(_temp[i].id===id)return _temp[i].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push(_temp[i].id),_temp[i].updatedListingIndex=$scope.updatedListingIndex++,$scope.updatedAccountListing=angular.copy(_temp),!1})},$scope.removeFromSelectedAccounts=function(id){var _temp=angular.copy($scope.updatedAccountListing);jQuery.each(_temp,function(i){if(_temp[i].id===id)return _temp[i].accountSelectedStatus=!1,$scope.selectedAccountsCount-=1,$scope.selectedCompanyIdList.splice($scope.selectedCompanyIdList.indexOf(id),1),$scope.updatedAccountListing=angular.copy(_temp),!1})},$scope.removeAllSelectedAccounts=function(){var _temp=angular.copy($scope.updatedAccountListing);jQuery.each(_temp,function(i){_temp[i].accountSelectedStatus=!1,_temp[i].updatedListingIndex=null}),$scope.updatedAccountListing=angular.copy(_temp),$scope.selectedAccountsCount=0,$scope.selectedCompanyIdList=[]},$scope.addFilteredAccounts=function(){var selectedList=$filter("filter")($scope.updatedAccountListing,$scope.accountList.search);jQuery.each(selectedList,function(i){jQuery.each($scope.updatedAccountListing,function(j){selectedList[i].id===$scope.updatedAccountListing[j].id&&($scope.updatedAccountListing[j].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[j].id),$scope.updatedAccountListing[j].updatedListingIndex=$scope.updatedListingIndex++)})}),$scope.accountList.search=null},$scope.getPulseId=function(){var url=window.location.href,splitUrl=url.split("?")[1];void 0!==splitUrl?($scope.urlPulseId=splitUrl.split("=")[1],$timeout(function(){$scope.pulseIdStatus=!0},100)):($scope.urlPulseId=null,$timeout(function(){$scope.pulseIdStatus=!1},100))},$scope.getPulseDetailsWithId=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/pulse/getDetails",data:$.param({pulseQuestionSetId:$scope.urlPulseId})}).then(function(response){if("true"===response.Success){$scope.showAccountsDisplayList=!1,$scope.getDetailsException=!1,$scope.pulseDetails=response.pulseQuestion,$scope.pulseNameDisplay=$scope.pulseDetails.name,$scope.newPulse.name=$scope.pulseNameDisplay,$scope.newPulse.questionSetType=$scope.pulseDetails.questionSetType;var loopCount=0;if(!1===$scope.pulseDetails.forAll){$scope.selectedAccountsCount=0,$scope.selectedCompanyIdList=[],$scope.selectedAccountsDisplayList=[],$scope.newPulse.assignAccounts="Selected";var _temp=angular.copy($scope.updatedAccountListing);jQuery.each($scope.pulseDetails.companyId,function(i){jQuery.each(_temp,function(j){$scope.pulseDetails.companyId[i]===_temp[j].id&&(_temp[j].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push(_temp[j].id),_temp[j].updatedListingIndex=$scope.updatedListingIndex++,$scope.selectedAccountsDisplayList.push(_temp[j]))}),loopCount++}),loopCount===$scope.pulseDetails.companyId.length&&($scope.updatedAccountListing=angular.copy(_temp),$scope.showAccountsDisplayList=!0)}else $scope.newPulse.assignAccounts="All"}else{$scope.pulseNameDisplay=null,$scope.getDetailsException=!0;for(var key in response.error)$scope.getDetailsExceptionMsg=response.error[key]}})},$scope.updateThisPulse=function(fData){var _params;"All"===fData.assignAccounts?($scope.accList=$scope.allAccountsIdList,_params={name:fData.name,pulseQuestionSetId:$scope.urlPulseId,type:fData.questionSetType,isForAll:!0}):($scope.accList=$scope.selectedCompanyIdList,_params={name:fData.name,pulseQuestionSetId:$scope.urlPulseId,type:fData.questionSetType,companyIds:$scope.accList.join(),isForAll:!1}),this.createNewPulse.$valid&&$scope.accList.length>0?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/pulse/update",data:$.param(_params)}).then(function(response){if("true"===response.Success)$scope.updatePulseException=!1,$scope.pulseEnableEdit(),sharedProperties.growlMessage("Details updated successfully");else{$scope.updatePulseException=!1;for(var key in response.error)$scope.updatePulseExceptionMsg=response.error[key]}}):$scope.createNewPulse.validationErrors=!0},$scope.pulseJsonDownload=function(){setTimeout(function(){window.location="/sp/sysAdmin/pulse/downloadJson?pulseQuestionSetId="+$scope.urlPulseId},100)},$scope.defaultPulse=function(_this){$scope.noChart($scope.pulseDrop,$scope.defaultPulseName)},$scope.increment=function(){return $scope.defaultPulseName++,!0},$scope.decrement=function(){return $scope.defaultPulseName--,!0},$scope.questionSet=function(){"questions"in $scope.questionList&&($scope.mapQuestionObject=$scope.questionList.questions[$scope.activePulse])},$scope.noChart=function(arrayList,index){arrayList.length&&$scope.noChartPulse(arrayList[index])},$scope.noChartPulse=function(keyName){$scope.activePulse=keyName,$scope.mapQuestionObject=$scope.questionList.questions[keyName]},$scope.pulsePreview=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/pulse/previewJson?pulseQuestionSetId="+$scope.urlPulseId,method:"GET"}).then(function(response){response&&($scope.questionList=response.pulseQuestionSetPreview,$scope.questionSet(),$scope.pulseDrop=$scope.questionList.categoryKeys,$timeout(function(){$scope.defaultPulseName=0},0),$scope.noChart($scope.pulseDrop,0),ngDialog.open({template:"/sp/resources/html/sysAdmin/pulse/pulse-preview.html",scope:$scope}))})},function(){$scope.getPulseId(),$scope.getAccountList()}()}angular.module("spApp").controller("pulseDetailsController",pulseDetailsController),pulseDetailsController.$inject=["$scope","$element","$attrs","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage","FileUploader","$filter"];