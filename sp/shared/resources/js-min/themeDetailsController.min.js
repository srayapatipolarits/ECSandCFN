function themeDetailsController($scope,$element,$attrs,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage,$filter){$scope.accountsListException=!1,$scope.updatedAccountListing=[],$scope.selectedAccountsCount=0,$scope.updatedListingIndex=0,$scope.accountList={},$scope.selectedCompanyIdList=[],$scope.allAccountsIdList=[],$scope.accountList.search=null,$scope.filteredAccountListing={},$scope.newTheme={},$scope.newTheme.validationErrors=!1,$scope.newThemeDetails={},$scope.updateThemeException=!1,$scope.themeDetailsEditing={},$scope.themeDetailsEditing.status=!1,$scope.themeId=sharedProperties.getParam("t"),$scope.getThemeDetailsException=!1,$scope.selectedAccountsDisplayList=[],$scope.getAccountList=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/hk/getCompanyList",method:"GET"}).then(function(response){if("true"===response.Success)$scope.accountsListException=!1,$scope.accountListing=response.companies,jQuery.each($scope.accountListing,function(i,j){$scope.updatedAccountListing.push(jQuery.extend({},$scope.accountListing[i],{accountSelectedStatus:!1})),$scope.allAccountsIdList.push($scope.accountListing[i].id)});else{$scope.accountsListException=!0;for(var key in response.error)$scope.accountsListExceptionMsg=response.error[key]}})},$scope.addtoSelectedAccounts=function(id){jQuery.each($scope.updatedAccountListing,function(i){if($scope.updatedAccountListing[i].id===id)return $scope.updatedAccountListing[i].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[i].id),$scope.updatedAccountListing[i].updatedListingIndex=$scope.updatedListingIndex++,!1})},$scope.removeFromSelectedAccounts=function(id){jQuery.each($scope.updatedAccountListing,function(i){if($scope.updatedAccountListing[i].id===id)return $scope.updatedAccountListing[i].accountSelectedStatus=!1,$scope.selectedAccountsCount-=1,$scope.selectedCompanyIdList.splice($scope.selectedCompanyIdList.indexOf(id),1),!1})},$scope.removeAllSelectedAccounts=function(){jQuery.each($scope.updatedAccountListing,function(i){$scope.updatedAccountListing[i].accountSelectedStatus=!1,$scope.updatedAccountListing[i].updatedListingIndex=null}),$scope.selectedAccountsCount=0,$scope.selectedCompanyIdList=[]},$scope.addFilteredAccounts=function(){var selectedList=$filter("filter")($scope.updatedAccountListing,$scope.accountList.search);jQuery.each(selectedList,function(i){jQuery.each($scope.updatedAccountListing,function(j){selectedList[i].id===$scope.updatedAccountListing[j].id&&($scope.updatedAccountListing[j].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[j].id),$scope.updatedAccountListing[j].updatedListingIndex=$scope.updatedListingIndex++)})}),$scope.accountList.search=null},$scope.themeDetailsEdit=function(s){"enable"===s?$scope.themeDetailsEditing.status=!0:($scope.themeDetailsEditing.status=!1,$scope.getThemeDetails()),$scope.accountList.search=null},$scope.updateThemeDetails=function(fData){var _params;$scope.newTheme.validationErrors=!1,$scope.createNewThemeException=!1,"All"===fData.assignAccounts?($scope.accList=$scope.allAccountsIdList,_params={name:fData.name,description:fData.description,status:fData.status,category:fData.category,isMandatory:fData.isMandatory,allAccounts:!0,goalId:$scope.themeId}):($scope.accList=$scope.selectedCompanyIdList,_params={name:fData.name,description:fData.description,status:fData.status,category:fData.category,isMandatory:fData.isMandatory,accounts:$scope.accList.join(),allAccounts:!1,goalId:$scope.themeId}),this.newTheme.$valid&&$scope.accList.length>0?($scope.newTheme.validationErrors=!1,ajaxService.getAjaxResponse({url:"/sp/sysAdmin/goals/updateGoal",data:$.param(_params)}).then(function(response){if("true"===response.Success)$scope.updateThemeException=!1,$scope.themeDetailsEdit(),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Details</strong>",message:" updated successfully."});else{$scope.updateThemeException=!0;for(var key in response.error)$scope.updateThemeExceptionMsg=response.error[key]}})):$scope.newTheme.validationErrors=!0},$scope.getThemeDetails=function(){null!==$scope.themeId&&void 0!==$scope.themeId&&ajaxService.getAjaxResponse({url:"/sp/sysAdmin/goals/getGoalDetail",data:$.param({goalId:$scope.themeId})}).then(function(response){if("true"===response.Success)if($scope.getThemeDetailsException=!1,$scope.currentThemeDetails=response.goal,$scope.newThemeDetails.name=$scope.currentThemeDetails.name,$scope.newThemeDetails.description=$scope.currentThemeDetails.description,$scope.newThemeDetails.category=$scope.currentThemeDetails.category,$scope.newThemeDetails.isMandatory=$scope.currentThemeDetails.mandatory.toString(),$scope.newThemeDetails.status=$scope.currentThemeDetails.status,!0===$scope.currentThemeDetails.allAccounts)$scope.newThemeDetails.assignAccounts="All";else{$scope.selectedAccountsDisplayList=[],$scope.selectedCompanyIdList=[],$scope.selectedAccountsCount=0,$scope.newThemeDetails.assignAccounts="Selected";var _c=$scope.currentThemeDetails.companyDTO;jQuery.each(_c,function(i){jQuery.each($scope.updatedAccountListing,function(j){_c[i].id===$scope.updatedAccountListing[j].id&&($scope.updatedAccountListing[j].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[j].id),$scope.updatedAccountListing[j].updatedListingIndex=$scope.updatedListingIndex++,$scope.selectedAccountsDisplayList.push($scope.updatedAccountListing[j]))})})}else $scope.getThemeDetailsException=!0})},function(){$scope.getAccountList(),$timeout(function(){$scope.getThemeDetails()},300)}()}angular.module("spApp").controller("themeDetailsController",themeDetailsController),themeDetailsController.$inject=["$scope","$element","$attrs","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage","$filter"];