function spectrumController($scope,ajaxService,$localStorage,$timeout,$rootScope,ngDialog,$state,sharedProperties,$filter){function animate(){$("html,body").animate({scrollTop:$(".spectrum-filter-toggle").offset().top-80},300)}function calculateHeight(event){var obj=$("#"+event);obj.height()>vm.pageSetting.heightParam&&obj.addClass("scroller")}function checkPermission(){var permissions=$localStorage.get("loggegdInProfile").member.roles;vm.permissionLevel={prism:-1!==permissions.indexOf("Prism"),blueprint:-1!==permissions.indexOf("Blueprint"),analytics:-1!==permissions.indexOf("Prism"),org:-1!==permissions.indexOf("OrganizationPlan"),insights:-1!==permissions.indexOf("Prism"),competency:-1!==permissions.indexOf("Competency"),engagement:-1!==permissions.indexOf("Engagement")},vm.permissionLevel.prism?vm.routeToState("profile"):vm.permissionLevel.analytics?vm.routeToState("analytics"):vm.permissionLevel.insights?vm.routeToState("insights"):vm.permissionLevel.org?vm.routeToState("org"):vm.permissionLevel.blueprint?vm.routeToState("blueprint"):vm.permissionLevel.competency?vm.routeToState("competency"):vm.permissionLevel.engagement&&vm.routeToState("engagement"),$state.go("visual")}function filterOpen(state){vm.routeToState(state),$("html,body").animate({scrollTop:$(".spectrum-filter-toggle").offset().top-80},300)}function routeToState(state){if(vm.viewBox[state])return!0;switch(vm.noData=!1,vm.pageSetting=angular.copy(vm.originalPageSetting),vm.routeStateMode=state,vm.chartDataReady=!1,state){case"profile":Object.keys(vm.personalityBalance).length?vm.profileBalanceFilterLogic():vm.getProfileBalance(),vm.moduleNameForAnalytics="PERSONALITY BALANCE",vm.filterNameForAnalytics="Groups";break;case"blueprint":Object.keys(vm.blueprintAnalytics).length?vm.blueprintFilterLogic():vm.getBlueprint(),vm.moduleNameForAnalytics="BLUEPRINT ANALYTICS",vm.filterNameForAnalytics="Groups";break;case"analytics":Object.keys(vm.analytics).length?vm.ertAnalyticFilterLogic():vm.getErtAnalytics(),vm.moduleNameForAnalytics="ERT-i ANALYTICS",vm.filterNameForAnalytics="Personality";break;case"insights":Object.keys(vm.insights).length?vm.ertInsightsFilterLogic():vm.getErtInsights(),vm.moduleNameForAnalytics="ERT-i INSIGHTS",vm.filterNameForAnalytics="Traits & Attributes";break;case"org":Object.keys(vm.orgPlan).length?vm.orgPlanFilterLogic():vm.getOrganizationPlanActivities(),vm.moduleNameForAnalytics="ORGANIZATION PLAN ACTIVITY",vm.filterNameForAnalytics="Organizational Plans";break;case"competency":vm.getCompetency(),vm.moduleNameForAnalytics="COMPETENCY INSIGHTS",vm.filterNameForAnalytics="Competency Profile";break;case"engagement":Object.keys(vm.engagementMatrix).length?resetEngagementChart():vm.getEngagementMatrix(),vm.moduleNameForAnalytics="ENGAGEMENT MATRIX",vm.filterNameForAnalytics="Engagement Matrix"}sharedProperties.fireAnalyticsEvent("Spectrum | View Module",vm.moduleNameForAnalytics)}function available(a,b){var result=0;breakAvailable:for(var i=0;i<b.length;i++)for(var j=0;j<a.length;j++)if(b[i]===a[j]){result=1;break breakAvailable}return result}function inBetween(age,number){for(var result=0,i=0;i<number.length;i++){var splitNumber=number[i].split("-");age>=splitNumber[0]&&age<=splitNumber[1]&&result++}return result}function stateMode(){switch(vm.routeStateMode){case"profile":vm.profileBalanceFilterLogic();break;case"blueprint":vm.blueprintFilterLogic();break;case"insights":vm.ertInsightsFilterLogic();break;case"org":vm.orgPlanFilterLogic();break;case"analytics":vm.ertAnalyticFilterLogic();break;case"competency":vm.competencyFilterLogic();break;case"engagement":vm.engagementFilterLogic()}}function returnClampName(name,length){return name=name.length>length?name.substring(0,length)+"...":name}function getProfileBalance(){ajaxService.getAjaxResponse({url:vm.config.getProfileBalance}).then(function(response){"true"===response.Success?(vm.personalityBalance=response.profileBalance,buildMasterDataSet()):null!=response.error&&(vm.profileChartNoData=!0,vm.noData=!0,vm.viewBox={profile:!0,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!1,engagement:!1},sharedProperties.ajaxError(response.error))})}function getBlueprint(){ajaxService.getAjaxResponse({url:vm.config.getBlueprint}).then(function(response){"true"===response.Success?(vm.blueprintAnalytics=response.bluePrintAnalytics,vm.blueprintFilterLogic()):null!=response.error&&(vm.profileChartNoData=!0,vm.noData=!0,vm.viewBox={profile:!1,blueprint:!0,insights:!1,org:!1,analytics:!1,competency:!1,engagement:!1},sharedProperties.ajaxError(response.error))})}function getErtInsights(){ajaxService.getAjaxResponse({url:vm.config.getErtInsights}).then(function(response){"true"===response.Success?(vm.insights=response.ertiInsights,vm.ertInsightsFilterLogic()):null!=response.error&&(vm.profileChartNoData=!0,vm.noData=!0,vm.viewBox={profile:!1,blueprint:!1,insights:!0,org:!1,analytics:!1,competency:!1,engagement:!1},sharedProperties.ajaxError(response.error))})}function getOrganizationPlanActivities(){ajaxService.getAjaxResponse({url:vm.config.getOrganizationPlanActivities}).then(function(response){if("true"===response.Success){var arr=[];if(null!==response.organizationPlanActivities.spectrumFilter){for(var key in response.organizationPlanActivities.spectrumFilter.filters.organizationPlan)arr.push(response.organizationPlanActivities.spectrumFilter.filters.organizationPlan[key]);response.organizationPlanActivities.spectrumFilter.filters.organizationPlan=arr}vm.orgPlan=response.organizationPlanActivities,vm.orgPlanFilterLogic()}else null!=response.error&&(vm.profileChartNoData=!0,vm.noData=!0,vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!0,analytics:!1,competency:!1,engagement:!1},sharedProperties.ajaxError(response.error))})}function getErtAnalytics(){ajaxService.getAjaxResponse({url:vm.config.getErtAnalytics}).then(function(response){"true"===response.Success?(vm.analytics=response.ertiAnalytics,vm.ertAnalyticFilterLogic()):null!=response.error&&(vm.profileChartNoData=!0,vm.noData=!0,vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!0,competency:!1,engagement:!1},sharedProperties.ajaxError(response.error))})}function getCompetency(id){ajaxService.getAjaxResponse({url:vm.config.getCompetency,data:$.param({competencyProfileId:id})}).then(function(response){"true"===response.Success?(vm.viewTableIndex={in:0,increment:innerWidth<1025?3:6},vm.competencyChartTable=[],vm.masterCompetencyChartTable=[],vm.competencyEvaluationList=[],vm.pageSetting.competencySelected=[],vm.helpingData={ratingSize:0,requiredEvaluationList:[]},vm.lastPredicate="startDate",vm.lastReverse=!0,vm.evaluationsSelected={manager:!1,self:!1,peer:!1},void 0===id?(vm.competencyList=response.competencyProfileListing,vm.competencyList=$filter("orderBy")(vm.competencyList,"name"),vm.competencyList.length?(vm.pageSetting.competencyProfile=response.competencyProfileListing[0],competencyCalculation(response)):(vm.noData=!0,vm.chartDataReady=!1,vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!0,engagement:!1})):competencyCalculation(response)):null!=response.error&&(vm.noData=!0,vm.chartDataReady=!1,vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!0,engagement:!1},sharedProperties.ajaxError(response.error))})}function competencyCalculation(response){"use strict";var details=null;vm.companyEvaluationId=[],details=response.competencyProfileDetails.evaluationResults;for(var i=0;i<details.length;i++){void 0===details[i].checked&&(details[i].checked=!1),vm.companyEvaluationId.push(details[i].competencyEvaluationId),vm.competencyEvaluationList=vm.competencyEvaluationList.concat(details[i].competencyProfile.competencyList.map(function(e){return e.name})).unique();for(var key in details[i].averageScores)if(null!==details[i].averageScores[key].competencyScores){!angular.isObject(details[i].averageScores[key].collaboratedScore)&&(details[i].averageScores[key].collaboratedScore={});for(var ii=0;ii<details[i].averageScores[key].competencyScores.length;ii++)details[i].averageScores[key].collaboratedScore[details[i].competencyProfile.competencyList[ii].name]=details[i].averageScores[key].competencyScores[ii]}vm.helpingData.ratingSize=vm.helpingData.ratingSize<details[i].competencyProfile.ratingConfiguration.size?details[i].competencyProfile.ratingConfiguration.size:vm.helpingData.ratingSize,vm.helpingData.requiredEvaluationList=vm.helpingData.requiredEvaluationList.length<details[i].requiredEvaluationList.length?details[i].requiredEvaluationList:vm.helpingData.requiredEvaluationList;var selfExist=void 0!==details[i].averageScores.Self,managerExist=void 0!==details[i].averageScores.Manager,peerExist=void 0!==details[i].averageScores.Peer;vm.competencyChartTable.push({index:vm.competencyChartTable.length,Groups:details[i].startDate}),selfExist&&(vm.competencyChartTable[vm.competencyChartTable.length-1].Self={score:details[i].averageScores.Self.score,completedCount:details[i].averageScores.Self.completedCount,count:details[i].averageScores.Self.count,ratingSize:details[i].competencyProfile.ratingConfiguration.size}),managerExist&&(vm.competencyChartTable[vm.competencyChartTable.length-1].Manager={score:details[i].averageScores.Manager.score,completedCount:details[i].averageScores.Manager.completedCount,count:details[i].averageScores.Manager.count,ratingSize:details[i].competencyProfile.ratingConfiguration.size}),peerExist&&(vm.competencyChartTable[vm.competencyChartTable.length-1].Peer={score:details[i].averageScores.Peer.score,completedCount:details[i].averageScores.Peer.completedCount,count:details[i].averageScores.Peer.count,ratingSize:details[i].competencyProfile.ratingConfiguration.size}),vm.masterCompetencyChartTable=angular.copy(vm.competencyChartTable)}dropDownCheckCompetency(),vm.competencyEvaluation=angular.copy(details),vm.noData=!1,vm.competencyFilterLogic()}function getEngagementMatrix(type,fromDate,endDate){var startQueryDate=moment().subtract(3,"month").startOf("month").format("MM/DD/YYYY"),endQueryDate=moment().format("MM/DD/YYYY"),url=vm.config.getEngagementMatrix+"?fromDate="+startQueryDate+"&endDate="+endQueryDate;void 0!==type&&null!==type&&(url=vm.config.getEngagementMatrix+"?fromDate="+fromDate+"&endDate="+endDate),ajaxService.getAjaxResponse({url:url}).then(function(response){"true"===response.Success?(vm.engagementMatrix=response.engagmentMatrixData,vm.engagementStartDate=moment().startOf("week").format("YYYY-MM-DD"),vm.engagementEndDate=moment().format("YYYY-MM-DD"),vm.responseStartDate=response.startDate[0]+"-"+response.startDate[1]+"-"+response.startDate[2],vm.responseEndDate=response.endDate[0]+"-"+response.endDate[1]+"-"+response.endDate[2],vm.profileChartNoData=!1,vm.dateDiffCount=calculateDateRange(vm.engagementStartDate,vm.engagementEndDate),void 0!==type&&null!==type||(vm.engagementFilters=response.filter.filters),void 0!==type&&null!==type||null===response.topPraticeArea||void 0===response.topPraticeArea||prepareTopPA(response.topPraticeArea),vm.noData=!1,vm.chartDataReady=!0,vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!1,engagement:!0},vm.datePickerRange[$rootScope.pullInterNationalization("spectrum.engagement.datePicker.options1")]=[moment().startOf("week"),moment()],vm.datePickerRange[$rootScope.pullInterNationalization("spectrum.engagement.datePicker.options2")]=[moment().subtract(1,"week").startOf("week"),moment().subtract(1,"week").endOf("week")],vm.datePickerRange[$rootScope.pullInterNationalization("spectrum.engagement.datePicker.options3")]=[moment().startOf("month"),moment()],vm.datePickerRange[$rootScope.pullInterNationalization("spectrum.engagement.datePicker.options4")]=[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],vm.datePickerRange[$rootScope.pullInterNationalization("spectrum.engagement.datePicker.options5")]=[moment().subtract(2,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],vm.datePickerRange[$rootScope.pullInterNationalization("spectrum.engagement.datePicker.options6")]=[moment().subtract(3,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],vm.engagementFilterLogic()):null!=response.error&&(vm.profileChartNoData=!0,vm.noData=!0,vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!1,engagement:!0},sharedProperties.ajaxError(response.error))})}function changeTopPA(){vm.topPAList=[],vm.topPAList=angular.copy(vm.topPAMap[vm.selectedMonthForPA])}function viewTopPADetails(obj){vm.selectedTopPA=obj;ngDialog.open({template:"/sp/resources/html/spectrum/topPAModal.html",scope:$scope})}function prepareDatePicker(){moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker"));var min=moment().subtract(3,"month").startOf("month"),max=moment();$('input[name="daterange"]').daterangepicker({showDropdowns:!1,minDate:min,maxDate:max,startDate:moment(vm.engagementStartDate,"YYYY-MM-DD"),endDate:moment(vm.engagementEndDate,"YYYY-MM-DD"),locale:{format:"MMM DD, YYYY",applyLabel:$rootScope.pullInterNationalization("manageAccountContent.apply"),cancelLabel:$rootScope.pullInterNationalization("manageAccountContent.cancel")},alwaysShowCalendars:!0,showCustomRangeLabel:!1,ranges:vm.datePickerRange,opens:vm.ipadView?"left":"right"},function(start,end,label){$scope.$apply(function(){vm.engagementStartDate=start.format("YYYY-MM-DD"),vm.engagementEndDate=end.format("YYYY-MM-DD"),vm.dateDiffCount=calculateDateRange(vm.engagementStartDate,vm.engagementEndDate),1===vm.dateDiffCount&&(vm.analyticsChartGroup="day")}),moment(start.format("YYYY-MM-DD"),"YYYY-MM-DD").isBefore(moment(vm.responseStartDate,"YYYY MM DD"))||moment(end.format("YYYY-MM-DD"),"YYYY-MM-DD").isAfter(moment(vm.responseEndDate,"YYYY MM DD"))?vm.getEngagementMatrix("datePicker",start.format("MM/DD/YYYY"),end.format("MM/DD/YYYY")):$scope.$apply(function(){vm.engagementFilterLogic("datePicker")})})}function engagementFilterLogic(type){vm.userScreen=!1,vm.showEngagementAggregation=!1,$rootScope.$broadcast("httpLoaderStart"),vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail);var data=vm.engagementMatrix.filter(function(e){return(vm.pageSetting.groupSelected.length&&available(null===e.groups?[]:e.groups,vm.pageSetting.groupSelected)||!vm.pageSetting.groupSelected.length&&e)&&(vm.pageSetting.ageSelected.length&&inBetween(null===e.age?[]:e.age,vm.pageSetting.ageSelected)||!vm.pageSetting.ageSelected.length&&e)&&(vm.pageSetting.genderSelected.length&&-1!==vm.pageSetting.genderSelected.indexOf(e.gender)||!vm.pageSetting.genderSelected.length&&e)&&(vm.pageSetting.tagSelected.length&&available(null===e.tags?[]:e.tags,vm.pageSetting.tagSelected)||!vm.pageSetting.tagSelected.length&&e)&&moment(e.date[0]+"-"+e.date[1]+"-"+e.date[2],"YYYY-MM-DD").isBetween(moment(vm.engagementStartDate,"YYYY MM DD"),moment(vm.engagementEndDate,"YYYY MM DD"),"days","[]")}).map(function(e){return vm.profileBalanceDetail.total++,vm.profileBalanceDetail.total>1&&vm.profileBalanceDetail.divisionTotal++,"M"===e.gender?vm.profileBalanceDetail.gender.male++:vm.profileBalanceDetail.gender.female++,ageSwitch(e.age),e});vm.profileChartNoData=!data.length,vm.profileChartNoData?$rootScope.$broadcast("httpLoaderEnd"):(createEngagementMaps(data),vm.engagementMapsAvailable?(aggregateEngagementData(),vm.googleChartReady?$timeout(function(){drawAnalyticsChart()},500):(google.charts.load("current",{packages:["corechart","line"]}),google.charts.setOnLoadCallback(drawAnalyticsChart),vm.googleChartReady=!0)):(vm.profileChartNoData=!0,$rootScope.$broadcast("httpLoaderEnd"),resetAgeAndGender())),vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!1,engagement:!0},vm.chartDataReady=!0}function competencyFilterLogic(){vm.userScreen=!1,vm.evaluationTable=[];var data=angular.copy(vm.competencyEvaluation);if(!data.length)return!0;vm.pageSetting.pageSize=10,vm.pageSetting.disabledInfinite=!1,vm.pageSetting.competencySelected.length?(vm.competencyChartTable=[],vm.helpingData={ratingSize:0,requiredEvaluationList:[]},vm.evaluationTable=data.filter(function(e){"use strict";e.competencyProfile.competencyList=e.competencyProfile.competencyList.filter(function(e1,index){var result=-1!==vm.pageSetting.competencySelected.indexOf(e1.name);for(var key in e.averageScores)null!==e.averageScores[key].competencyScores&&(result?e.averageScores[key].collaboratedScore[e1.name]=e.averageScores[key].competencyScores[index]:!result&&e.averageScores[key].collaboratedScore.hasOwnProperty([e1.name])&&delete e.averageScores[key].collaboratedScore[e1.name]);return result});var len=e.competencyProfile.competencyList.length;if(len){for(var average in e.averageScores){e.averageScores[average].score=0;for(var value in e.averageScores[average].collaboratedScore)e.averageScores[average].score+=e.averageScores[average].collaboratedScore[value];e.averageScores[average].score=parseFloat(e.averageScores[average].score/len).toFixed(2)}vm.helpingData.ratingSize=vm.helpingData.ratingSize<e.competencyProfile.ratingConfiguration.size?e.competencyProfile.ratingConfiguration.size:vm.helpingData.ratingSize,vm.helpingData.requiredEvaluationList=vm.helpingData.requiredEvaluationList.length<e.requiredEvaluationList.length?e.requiredEvaluationList:vm.helpingData.requiredEvaluationList;var selfExist=void 0!==e.averageScores.Self,managerExist=void 0!==e.averageScores.Manager,peerExist=void 0!==e.averageScores.Peer;vm.competencyChartTable.push({index:vm.competencyChartTable.length,Groups:e.startDate}),selfExist&&(vm.competencyChartTable[vm.competencyChartTable.length-1].Self={score:e.averageScores.Self.score,completedCount:e.averageScores.Self.completedCount,count:e.averageScores.Self.count,ratingSize:e.competencyProfile.ratingConfiguration.size}),managerExist&&(vm.competencyChartTable[vm.competencyChartTable.length-1].Manager={score:e.averageScores.Manager.score,completedCount:e.averageScores.Manager.completedCount,count:e.averageScores.Manager.count,ratingSize:e.competencyProfile.ratingConfiguration.size}),peerExist&&(vm.competencyChartTable[vm.competencyChartTable.length-1].Peer={score:e.averageScores.Peer.score,completedCount:e.averageScores.Peer.completedCount,count:e.averageScores.Peer.count,ratingSize:e.competencyProfile.ratingConfiguration.size})}return!!len&&e})):(vm.evaluationTable=angular.copy(data),vm.competencyChartTable=angular.copy(vm.masterCompetencyChartTable)),competencyOrder(),competencyChartOrder(),vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!0,engagement:!1},vm.chartDataReady=!0}function competencyActive(event,setting){vm.lastPredicate=setting.predicate,vm.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.lastPredicate),vm.viewTableIndex={in:0,increment:innerWidth<1025?3:6},competencyOrder(),competencyChartOrder()}function updateviewTableIndex(follow){"use strict";switch(follow){case"prev":vm.viewTableIndex.in&&vm.viewTableIndex.in--;break;case"next":vm.competencyChartTable.length>(vm.viewTableIndex.in+1)*vm.viewTableIndex.increment&&vm.viewTableIndex.in++}}function dropDownCheckCompetency(){"use strict";vm.competencyDropDownList=vm.masterCompetencyDropDownList.filter(function(e){return e.value.every(function(element){return-1!==vm.helpingData.requiredEvaluationList.indexOf(element)})}),vm.pageSetting.competencyDrop=vm.competencyDropDownList[0],vm.evaluationsSelected={manager:-1!==vm.pageSetting.competencyDrop.value.indexOf("Manager"),self:-1!==vm.pageSetting.competencyDrop.value.indexOf("Self"),peer:-1!==vm.pageSetting.competencyDrop.value.indexOf("Peer")}}function competencyCheckTriggered(status){"use strict";var area=angular.copy(vm.pageSetting.competencyDrop.value),i=$.inArray(status,area);i>-1?area.splice(i,1):area.push(status),area.length&&(vm.pageSetting.competencyDrop=vm.competencyDropDownList.find(function(e){return e.value.length===area.length&&area.every(function(e1){return-1!==e.value.indexOf(e1)})})),vm.evaluationsSelected={manager:-1!==vm.pageSetting.competencyDrop.value.indexOf("Manager"),self:-1!==vm.pageSetting.competencyDrop.value.indexOf("Self"),peer:-1!==vm.pageSetting.competencyDrop.value.indexOf("Peer")}}function resolve(path,obj){return path.split(".").reduce(function(prev,curr){return prev?prev[curr]:void 0},obj||window.self)}function competencyOrder(sort){vm.evaluationTable.sort(function(a,b){var selfScoreFirst=resolve(vm.lastPredicate,a),selfScoreSecond=resolve(vm.lastPredicate,b);switch(vm.lastReverse){case!0:return void 0===selfScoreFirst&&(selfScoreFirst=-1),void 0===selfScoreSecond&&(selfScoreSecond=-1),selfScoreFirst===selfScoreSecond?0:+(selfScoreSecond>selfScoreFirst)||-1;case!1:return 0===selfScoreFirst&&(selfScoreFirst=11),0===selfScoreSecond&&(selfScoreSecond=11),void 0===selfScoreFirst&&(selfScoreFirst=12),void 0===selfScoreSecond&&(selfScoreSecond=12),selfScoreFirst===selfScoreSecond?0:+(selfScoreFirst>selfScoreSecond)||-1}})}function competencyChartOrder(){"use strict";var lastPredicate=null;switch(vm.lastPredicate){case"startDate":lastPredicate="Groups";break;case"averageScores.Self.score":lastPredicate="Self.score";break;case"averageScores.Manager.score":lastPredicate="Manager.score";break;case"averageScores.Peer.score":lastPredicate="Peer.score"}vm.competencyChartTable.sort(function(a,b){var selfScoreFirst=resolve(lastPredicate,a),selfScoreSecond=resolve(lastPredicate,b);switch(vm.lastReverse){case!0:return void 0===selfScoreFirst&&(selfScoreFirst=-1),void 0===selfScoreSecond&&(selfScoreSecond=-1),selfScoreFirst===selfScoreSecond?0:+(selfScoreSecond>selfScoreFirst)||-1;case!1:return 0===selfScoreFirst&&(selfScoreFirst=11),0===selfScoreSecond&&(selfScoreSecond=11),void 0===selfScoreFirst&&(selfScoreFirst=12),void 0===selfScoreSecond&&(selfScoreSecond=12),selfScoreFirst===selfScoreSecond?0:+(selfScoreFirst>selfScoreSecond)||-1}}),vm.competencyChartTable=angular.copy(vm.competencyChartTable)}function infinteScroll(pageSize){"use strict";vm.pageSetting.disabledInfinite||(vm.pageSetting.pageSize=pageSize,pageSize>=vm.evaluationTable.length&&(vm.pageSetting.disabledInfinite=!0,vm.pageSetting.pageSize=vm.evaluationTable.length))}function toggleDrawer(competency,ele,id){"use strict";id!==vm.activeToggleId?vm.activeToggleId=id:vm.activeToggleId=-1,$(ele).slideToggle("normal");var index=vm.companyEvaluationId.indexOf(competency.competencyEvaluationId);-1!==index&&(vm.competencyEvaluation[index].checked=!vm.competencyEvaluation[index].checked)}function changeCompetency(){vm.getCompetency(vm.pageSetting.competencyProfile.id)}function orgOrderBy(sort){for(var percent=0,i=0;i<vm.orgPlanGraphData.length;i++){percent+=vm.orgPlanGraphData[i].completedKpiPercent;var totalKpi=vm.orgPlanGraphData[i].totalKpi;vm.orgPlanGraphData[i].userActivities.sort(function(a,b){var atotalCompletedKpi=void 0===a.totalCompletedKpi?a.completedLKpi:a.totalCompletedKpi,btotalCompletedKpi=void 0===b.totalCompletedKpi?b.completedLKpi:b.totalCompletedKpi,an=Math.round(atotalCompletedKpi/totalKpi*100)||0,bn=Math.round(btotalCompletedKpi/totalKpi*100)||0,af=a.firstName,bf=b.firstName;switch(sort){case"plus":return an===bn?af===bf?0:+(af>bf)||-1:+(bn>an)||-1;case"minus":return an===bn?af===bf?0:+(af>bf)||-1:+(an>bn)||-1}}),vm.orgPlanGraphData[i].orgPlanGroupActivities.sort(function(a,b){var atotalCompletedKpi=void 0===a.totalCompletedKpi?a.completedLKpi:a.totalCompletedKpi,btotalCompletedKpi=void 0===b.totalCompletedKpi?b.completedLKpi:b.totalCompletedKpi,an=Math.round(atotalCompletedKpi/(totalKpi*a.totalMembers)*100)||0,bn=Math.round(btotalCompletedKpi/(totalKpi*b.totalMembers)*100)||0,af=a.firstName,bf=b.firstName;switch(sort){case"plus":return an===bn?af===bf?0:+(af>bf)||-1:+(bn>an)||-1;case"minus":return an===bn?af===bf?0:+(af>bf)||-1:+(an>bn)||-1}})}vm.pageSetting.totalOrgPerc=parseFloat(percent/vm.orgPlanGraphData.length).toFixed(2)}function openUserGroupActivitiesModal(orgData,groupName){vm.orgUserGroupData.planName=orgData.planName,vm.orgUserGroupData.groupName=groupName,vm.orgUserGroupData.userActivities=[];for(var i=0;i<orgData.userActivities.length;i++)-1!==orgData.userActivities[i].groups.indexOf(groupName)&&(orgData.userActivities[i].totalKpi=orgData.totalKpi,vm.orgUserGroupData.userActivities.push(orgData.userActivities[i]));ngDialog.open({template:"/sp/resources/html/spectrum/org-group-userActivities.html",scope:$scope})}function getMatch(a,b){for(var matches=[],i=0;i<a.length;i++)for(var e=0;e<b.length;e++)a[i]===b[e]&&matches.push(a[i]);return matches.length}function filterOrgDataByGroups(){var tempList=[];if("All Groups"!==vm.pageSetting.selectedOrgGroup)for(var i=0;i<vm.originalOrgDetailData.length;i++)-1!==vm.originalOrgDetailData[i].groups.indexOf(vm.pageSetting.selectedOrgGroup)&&tempList.push(vm.originalOrgDetailData[i]);else tempList=angular.copy(vm.originalOrgDetailData);vm.screenInfo.userActivities=angular.copy(tempList)}function stepChanged(list){var match=vm.screenInfo.orgPlanSteps[vm.pageSetting.allSteps];vm.pageSetting.totalCompletedKpi=0,vm.pageSetting.totalKpi=0,vm.pageSetting.completedKpiPercent=0,vm.originalOrgDetailData=list.userActivities,vm.pageSetting.selectedOrgGroup="All Groups";for(var i=0,number=0,all=0;i<list.userActivities.length;i++)null!==list.userActivities[i].completedUserSteps&&null!==vm.pageSetting.allSteps&&""!==vm.pageSetting.allSteps?number=getMatch(list.userActivities[i].completedUserSteps,match.uids):(number=list.userActivities[i].completedLKpi,list.userActivities[i].totalKpi=list.totalKpi),null!==vm.pageSetting.allSteps&&""!==vm.pageSetting.allSteps?(list.userActivities[i].totalKpi=match.uids.length,all+=match.uids.length):all+=list.totalKpi,list.userActivities[i].totalCompletedKpi=number,vm.pageSetting.totalCompletedKpi+=number;vm.pageSetting.totalKpi=all,null===vm.pageSetting.allSteps||""===vm.pageSetting.allSteps?vm.pageSetting.completedKpiPercent=vm.screenInfo.completedKpiPercent:vm.pageSetting.completedKpiPercent=vm.percentCalc(all,vm.pageSetting.totalCompletedKpi);for(var ii=0,numberi=0;ii<list.orgPlanGroupActivities.length;ii++)numberi=null!==list.orgPlanGroupActivities[ii].completedGroupSteps&&null!==vm.pageSetting.allSteps&&""!==vm.pageSetting.allSteps?getMatch(list.orgPlanGroupActivities[ii].completedGroupSteps,match.uids):list.orgPlanGroupActivities[ii].completdKpi,list.orgPlanGroupActivities[ii].totalCompletedKpi=numberi;if(vm.orgAvailableGroups=[],"i"===vm.pageSetting.viewType){for(var j=0;j<list.orgPlanGroupActivities.length;j++)-1===vm.orgAvailableGroups.indexOf(list.orgPlanGroupActivities[j].groupName)&&vm.orgAvailableGroups.push(list.orgPlanGroupActivities[j].groupName);vm.orgAvailableGroups.length&&vm.orgAvailableGroups.unshift("All Groups")}vm.orgOrderBy(vm.pageSetting.sort)}function ertOrderBy(sort){vm.analyticsGraphData.sort(function(a,b){var an=a.percent,bn=b.percent,ap=a.power,bp=b.power,af=a.firstName,bf=b.firstName;switch(sort){case"plus":return an===bn?ap===bp?af===bf?0:+(af>bf)||-1:+(bp>ap)||-1:+(bn>an)||-1;case"minus":return an===bn?ap===bp?af===bf?0:+(af>bf)||-1:+(ap>bp)||-1:+(an>bn)||-1}})}function mapToTriat(){var checkvalue=2===arguments.length?0:50;vm.pageSetting.allTrait.hasOwnProperty(arguments[0])?(vm.pageSetting.allTrait[arguments[0]][arguments[1]]={currentValue:checkvalue,checked:!1},void 0!==arguments[2]&&(vm.pageSetting.allTrait[arguments[0]][arguments[2]]={currentValue:checkvalue,checked:!1})):(vm.pageSetting.allTrait[arguments[0]]={},vm.pageSetting.allTrait[arguments[0]][arguments[1]]={currentValue:checkvalue,checked:!1},void 0!==arguments[2]&&(vm.pageSetting.allTrait[arguments[0]][arguments[2]]={currentValue:checkvalue,checked:!1}))}function calucalteTiltGraph(){var bigData=(parseInt(vm.pageSetting.allTrait.Personality.Powerfull.currentValue,10)+parseInt(vm.pageSetting.allTrait.Personality.Versatile.currentValue,10))/2,detail=(parseInt(vm.pageSetting.allTrait.Personality.Precise.currentValue,10)+parseInt(vm.pageSetting.allTrait.Personality.Adaptable.currentValue,10))/2,mission=(parseInt(vm.pageSetting.allTrait.Personality.Powerfull.currentValue,10)+parseInt(vm.pageSetting.allTrait.Personality.Precise.currentValue,10))/2,relational=(parseInt(vm.pageSetting.allTrait.Personality.Versatile.currentValue,10)+parseInt(vm.pageSetting.allTrait.Personality.Adaptable.currentValue,10))/2;0===bigData&&0===detail&&0===mission&&0===relational?(vm.tilt.big=100,vm.tilt.detail=0,vm.tilt.mission=100,vm.tilt.relational=0):(bigData===detail?(vm.tilt.big=50,vm.tilt.detail=50):(vm.tilt.big=100-Math.round(bigData/(bigData+detail)*100),vm.tilt.detail=Math.round(detail/(bigData+detail)*100)),mission===relational?(vm.tilt.mission=50,vm.tilt.relational=50):(vm.tilt.mission=100-Math.round(mission/(mission+relational)*100),vm.tilt.relational=Math.round(relational/(mission+relational)*100)))}function conflictManagerChecked(category,name,name1,area){var primary=vm.pageSetting.allTrait[category][name].currentValue,secondary=vm.pageSetting.allTrait[category][name1].currentValue,checked=vm.pageSetting.allTrait[category][name].checked,existence=vm.pageSetting.traitSelectedOrder.indexOf(category),regExp=new RegExp(category,"g"),existenceCheck=vm.pageSetting.traitSelectedOrder.toString().match(regExp),existenceCount=null!==existenceCheck&&existenceCheck.length>1,lastIndex=existenceCount?vm.pageSetting.traitSelectedOrder.lastIndexOf(category):-1;checked?(0===primary||null===primary?(lastIndex>-1&&(area.splice(lastIndex,1),vm.pageSetting.traitSelectedOrder.splice(lastIndex,1)),existence>-1&&(area.splice(existence,1),vm.pageSetting.traitSelectedOrder.splice(existence,1))):null!==secondary&&primary===secondary&&(secondary=null,vm.pageSetting.allTrait[category][name1].currentValue=null),0!==primary&&null!==primary&&(primary.length&&existence>-1?area[existence]=primary:primary.length&&-1===existence&&(area.push(primary),vm.pageSetting.traitSelectedOrder.push(category))),null!==primary&&null!==secondary&&primary.length&&secondary.length?lastIndex>-1?area[lastIndex]=secondary:-1===lastIndex&&(area.push(secondary),vm.pageSetting.traitSelectedOrder.push(category)):null===primary||!primary.length||null!==secondary&&secondary.length||lastIndex>-1&&(area.splice(lastIndex,1),vm.pageSetting.traitSelectedOrder.splice(lastIndex,1))):existence>-1&&(lastIndex>-1&&(area.splice(lastIndex,1),vm.pageSetting.traitSelectedOrder.splice(lastIndex,1)),area.splice(existence,1),vm.pageSetting.traitSelectedOrder.splice(existence,1)),sharedProperties.fireAnalyticsEvent("Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+(null!==primary&&0!==primary?primary:"N/A")+(null!==secondary&&0!==secondary?", "+secondary:"")),stateMode()}function fundamentalNeedChecked(category,name,area){var i=vm.pageSetting.allTrait[category][name].currentValue,ii=vm.pageSetting.traitSelectedOrder.indexOf(category);("none"===i||null===i)&&ii>-1?(area.splice(ii,1),vm.pageSetting.traitSelectedOrder.splice(ii,1)):ii>-1?area[ii]=i:(area.push(i),vm.pageSetting.traitSelectedOrder.push(category)),sharedProperties.fireAnalyticsEvent("Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+i),stateMode()}function traitCheck(category,name,area){var i=$.inArray(name,area);i>-1?(area.splice(i,1),vm.pageSetting.traitSelectedOrder.splice(i,1),vm.pageSetting.allTrait[category][name].currentValue=0):(area.push(name),vm.pageSetting.traitSelectedOrder.push(category),vm.pageSetting.allTrait[category][name].currentValue=vm.pageSetting.personalityTypeDeviation),vm.calucalteTiltGraph(),sharedProperties.fireAnalyticsEvent("Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+name),stateMode()}function traitCheckTwo(category,name1,name2,area){var i=$.inArray(name1,area),j=$.inArray(name2,area);i>-1?(area.splice(j,1),area.splice(i,1),
vm.pageSetting.traitSelectedOrder.splice(j,1),vm.pageSetting.traitSelectedOrder.splice(i,1)):(area.push(name1),area.push(name2),vm.pageSetting.traitSelectedOrder.push(category),vm.pageSetting.traitSelectedOrder.push(category)),sharedProperties.fireAnalyticsEvent("Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+name1+","+name2),stateMode()}function fundamentalNeedClear(category,name,area){var index=vm.pageSetting.traitSelectedOrder.indexOf(category);index>-1&&(area.splice(index,1),vm.pageSetting.traitSelectedOrder.splice(index,1)),vm.pageSetting.allTrait[category][name].currentValue="none",stateMode()}function conflictManagementclear(category,name,name1,area){var existence=vm.pageSetting.traitSelectedOrder.indexOf(category),regExp=new RegExp(category,"g"),existenceCheck=vm.pageSetting.traitSelectedOrder.toString().match(regExp),existenceCount=null!==existenceCheck&&existenceCheck.length>1,lastIndex=existenceCount?vm.pageSetting.traitSelectedOrder.lastIndexOf(category):-1;lastIndex>-1&&(area.splice(lastIndex,1),vm.pageSetting.traitSelectedOrder.splice(lastIndex,1)),existence>-1&&(area.splice(existence,1),vm.pageSetting.traitSelectedOrder.splice(existence,1)),vm.pageSetting.allTrait[category].Primary.checked=!1,stateMode()}function traitClear(checked,property,category){for(var j=vm.pageSetting[property].length-1;j>=0;j--){"Personality"===vm.pageSetting.traitSelectedOrder[j]&&(vm.pageSetting.allTrait[vm.pageSetting.traitSelectedOrder[j]][vm.pageSetting[property][j]].currentValue=0);for(var keys=Object.keys(vm.pageSetting.allTrait[category]),k=0;k<keys.length;k++)if(vm.pageSetting[property][j]===keys[k]){vm.pageSetting[property].splice(j,1);break}}"Personality"===category&&(vm.pageSetting.personalityMode="navigator",vm.calucalteTiltGraph());for(var i=vm.pageSetting.traitSelectedOrder.length-1;i>=0;i--)vm.pageSetting.traitSelectedOrder[i]===category&&vm.pageSetting.traitSelectedOrder.splice(i,1);if(void 0!==checked)for(var key in checked)checked[key].checked=!1;stateMode()}function traitFilter(e,parentE){for(var data=0,value=0,match=0,type=0,length=vm.pageSetting.personalityTraitSelected.length,difference=0,power=0,i=0,number=0;i<vm.pageSetting.personalityTraitSelected.length;i++)if(type=vm.pageSetting.traitSelectedOrder[i],match=e[vm.pageSetting.personalityTraitSelected[i]],"Processing"===type||"Motivation"===type||"LearningStyle"===type||"DecisionMaking"===type)value=parseInt(vm.pageSetting.allTrait[vm.pageSetting.traitSelectedOrder[i]][vm.pageSetting.personalityTraitSelected[i]].currentValue,10),match>=value-vm.pageSetting.deviation&&match<=value+vm.pageSetting.deviation&&(number=100-(match-value),power+=number,number>100&&(number=100),number<0&&(number=0),difference+=number,data++);else if("Personality"===type)match>=vm.pageSetting.personalityTypeDeviation&&(number=match,power+=number,difference+=number,data++);else if("FundamentalNeeds"===type){var fundamental=fundamentalFilter(e,vm.pageSetting.allTrait.FundamentalNeeds.fundamental.currentValue);fundamental&&(power+=100,difference+=100,data++)}else if("ConflictManagement"===type){var conflict=conflictFilter(e,vm.pageSetting.allTrait[vm.pageSetting.traitSelectedOrder[i]]);conflict&&(power+=100,difference+=100,data++)}return data===length&&(parentE.percent=Math.round(difference/vm.pageSetting.personalityTraitSelected.length),parentE.power=power),data===length}function conflictFilter(e,conflict){if(0===conflict.Primary.currentValue||null===conflict.Primary.currentValue)return!1;var primaryNumber=0,primary=conflict.Primary.currentValue,restTrait=angular.copy(vm.pageSetting.conflictTraitAvailable);restTrait.splice(vm.pageSetting.conflictTraitAvailable.indexOf(primary),1);for(var i=0;i<restTrait.length;i++)e[primary]>=e[restTrait[i]]&&primaryNumber++;if(0!==conflict.Secondary.currentValue&&null!==conflict.Secondary.currentValue&&primaryNumber===restTrait.length){var secondaryNumber=0,secondary=conflict.Secondary.currentValue,restCopy=angular.copy(restTrait);restCopy.splice(restTrait.indexOf(secondary),1);for(var j=0;j<restCopy.length;j++)e[secondary]>=e[restCopy[j]]&&secondaryNumber++;return secondaryNumber===restCopy.length}return primaryNumber===restTrait.length}function fundamentalFilter(e,fundamental){var club=["Control","Significance","Security"],result=0,order=[];switch(fundamental){case"Control":case"Significance":case"Security":order=angular.copy(club),order.splice(club.indexOf(fundamental),1);for(var i=0;i<order.length;i++)e[fundamental]>=parseInt(e[order[i]],10)&&result++;break;case"Balanced":order=angular.copy(club);for(var j=0;j<order.length;j++)33>=parseInt(e[order[j]],10)-vm.pageSetting.fundamentalNeedDeviation&&33<=parseInt(e[order[j]],10)+vm.pageSetting.fundamentalNeedDeviation&&result++}return order.length===result}function ertAnalyticFilterLogic(){vm.userScreen=!1,vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail),vm.pageSetting.personalityTypes=angular.copy(vm.pageSetting.personalityTraitSelected);var len=vm.pageSetting.traitSelectedOrder.toString().match(/Personality/g);vm.pageSetting.visiblePercentage=(null===len?0:len.length)===vm.pageSetting.traitSelectedOrder.length,vm.pageSetting.searchPersonality="navigator"===vm.pageSetting.personalityMode?"ertiData":"ertiUnderPressureData",vm.pageSetting.personalityTypesLang=vm.pageSetting.personalityTypes.map(function(e){return $rootScope.pullInterNationalization("spectrum.trait.type."+e)}),vm.analyticsGraphData=vm.analytics.userAnalytics.filter(function(e){return(vm.pageSetting.groupSelected.length&&available(null===e.groups?[]:e.groups,vm.pageSetting.groupSelected)||!vm.pageSetting.groupSelected.length&&e)&&(vm.pageSetting.ageSelected.length&&inBetween(null===e.age?[]:e.age,vm.pageSetting.ageSelected)||!vm.pageSetting.ageSelected.length&&e)&&(vm.pageSetting.genderSelected.length&&-1!==vm.pageSetting.genderSelected.indexOf(e.gender)||!vm.pageSetting.genderSelected.length&&e)&&(vm.pageSetting.tagSelected.length&&available(null===e.tags?[]:e.tags,vm.pageSetting.tagSelected)||!vm.pageSetting.tagSelected.length&&e)&&(vm.pageSetting.personalityTraitSelected.length&&traitFilter(e[vm.pageSetting.searchPersonality],e)||!vm.pageSetting.personalityTraitSelected.length&&e)}).map(function(e){return vm.profileBalanceDetail.total++,vm.profileBalanceDetail.total>1&&vm.profileBalanceDetail.divisionTotal++,"M"===e.gender?vm.profileBalanceDetail.gender.male++:vm.profileBalanceDetail.gender.female++,ageSwitch(e.age),e}),vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!0,competency:!1,engagement:!1},vm.chartDataReady=!0,vm.ertOrderBy(vm.pageSetting.sort)}function orgPlanFilterLogic(){vm.userScreen=!1,vm.chartDataReady=!0,vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail),vm.orgPlanGraphData=vm.orgPlan.orgPlanActivities.filter(function(e){return vm.pageSetting.orgSelected.length?-1!==vm.pageSetting.orgSelected.indexOf(e.planName):e}),vm.profileBalanceDetail.total=vm.orgPlanGraphData.length,vm.orgOrderBy(vm.pageSetting.sort),vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!0,analytics:!1,competency:!1,engagement:!1},vm.chartDataReady=!0}function calculateInsights(e){for(var count=!1,iterateObj=vm.pageSetting.traitSelected.length?vm.pageSetting.traitSelected:vm.insights.spectrumFilter.filters.trait,i=0;i<iterateObj.length;i++)!e[vm.pageSetting.searchPersonality][iterateObj[i]]||vm.pageSetting.traitSelected.length&&-1===vm.pageSetting.traitSelected.indexOf(iterateObj[i])||(-1!==vm.insightsMasterDataSet.indexOf(iterateObj[i])?vm.cloneInsightsGraphData[vm.insightsMasterDataSet.indexOf(iterateObj[i])].userDto.push({name:e.name,profile:e.smallProfileImage,initial:e.userInitials,percent:e[vm.pageSetting.searchPersonality][iterateObj[i]],title:e.title}):(vm.insightsMasterDataSet.push(iterateObj[i]),vm.cloneInsightsGraphData.push({traitName:iterateObj[i],traitDescription:null,userDto:[{name:e.name,profile:e.smallProfileImage,initial:e.userInitials,percent:e[vm.pageSetting.searchPersonality][iterateObj[i]],title:e.title}]})),count=!0);return count&&(vm.profileBalanceDetail.total++,vm.profileBalanceDetail.total>1&&vm.profileBalanceDetail.divisionTotal++,"M"===e.gender?vm.profileBalanceDetail.gender.male++:vm.profileBalanceDetail.gender.female++,ageSwitch(e.age)),!0}function ertInsightsFilterLogic(){vm.userScreen=!1,vm.cloneInsightsGraphData=[],vm.insightsMasterDataSet=[],vm.pageSetting.traitSelectedDisplay=[],vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail);vm.insights.userAnalytics.filter(function(e){return(vm.pageSetting.groupSelected.length&&available(null===e.groups?[]:e.groups,vm.pageSetting.groupSelected)||!vm.pageSetting.groupSelected.length&&e)&&(vm.pageSetting.ageSelected.length&&inBetween(null===e.age?[]:e.age,vm.pageSetting.ageSelected)||!vm.pageSetting.ageSelected.length&&e)&&(vm.pageSetting.genderSelected.length&&-1!==vm.pageSetting.genderSelected.indexOf(e.gender)||!vm.pageSetting.genderSelected.length&&e)&&(vm.pageSetting.tagSelected.length&&available(null===e.tags?[]:e.tags,vm.pageSetting.tagSelected)||!vm.pageSetting.tagSelected.length&&e)&&sharedProperties.singleElementSearch(vm.pageSetting.memberSearch,e,2)&&calculateInsights(e)});vm.insightsGraphData=angular.copy(vm.cloneInsightsGraphData),vm.orderBy(vm.pageSetting.sort),vm.pageSetting.traitSelectedDisplay=vm.pageSetting.traitSelected.map(function(e){return $rootScope.pullInterNationalization("spectrum.trait.type."+e)}),vm.profileChartNoData=!vm.insightsGraphData.length,vm.chartDataReady=!0,vm.viewBox={profile:!1,blueprint:!1,insights:!0,org:!1,analytics:!1,competency:!1,engagement:!1}}function orderBy(sort){for(var i=0;i<vm.insightsGraphData.length;i++)vm.insightsGraphData[i].userDto.sort(function(a,b){var an=a.percent,bn=b.percent,af=a.firstName,bf=b.firstName;switch(sort){case"plus":return an===bn?af===bf?0:+(af>bf)||-1:+(bn>an)||-1;case"minus":return an===bn?af===bf?0:+(af>bf)||-1:+(an>bn)||-1}})}function calculatePerc(e){return vm.percent=vm.percent+(e.completedKpi/e.totalKpi*100||0),!0}function blueprintFilterLogic(){vm.percent=0,vm.blueprintAnalyticsGraphData=vm.blueprintAnalytics.userAnalytics.filter(function(e){return(vm.pageSetting.groupSelected.length&&available(null===e.groups?[]:e.groups,vm.pageSetting.groupSelected)||!vm.pageSetting.groupSelected.length&&e)&&(vm.pageSetting.tagSelected.length&&available(null===e.tags?[]:e.tags,vm.pageSetting.tagSelected)||!vm.pageSetting.tagSelected.length&&e)&&calculatePerc(e)}),vm.pageSetting.bluePerc=Math.round(vm.percent/vm.blueprintAnalyticsGraphData.length),vm.matchSort(vm.pageSetting.sort),vm.viewBox={profile:!1,blueprint:!0,insights:!1,org:!1,analytics:!1,competency:!1,engagement:!1}}function matchSort(sort){vm.blueprintAnalyticsGraphData.sort(function(a,b){var an=Math.ceil(a.completedKpi/a.totalKpi*100)||0,bn=Math.ceil(b.completedKpi/b.totalKpi*100)||0,af=a.firstName,bf=b.firstName;switch(sort){case"plus":return an===bn?af===bf?0:+(af>bf)||-1:+(bn>an)||-1;case"minus":return an===bn?af===bf?0:+(af>bf)||-1:+(an>bn)||-1}}),vm.chartDataReady=!0}function percentCalc(total,number,floating){return void 0===floating?Math.round(number/total*100)||0:parseFloat(number/total*100).toFixed(floating)}function buildMasterDataSet(){for(var key in vm.personalityBalance.personalityData)vm.masterDataSet.push({dimensionType:vm.personalityBalance.personalityData[key].dimesionType,number:0,percent:0,personalityDescription:vm.personalityBalance.personalityData[key].description,personalityType:key,usersId:[],videoUrl:vm.personalityBalance.personalityData[key].videoUrl}),vm.keyList.push(key);vm.profileBalanceFilterLogic()}function ageSwitch(age){for(var i=0;i<ageCategory.length;i++){var splitNumber=ageCategory[i].split("-");if(age>=splitNumber[0]&&age<=splitNumber[1]){vm.profileBalanceDetail.age[category[i]]++;break}}}function calculateFilterValue(e){var index=void 0===e[vm.pageSetting.barPersonalityMode]||null===e[vm.pageSetting.barPersonalityMode]?-1:vm.keyList.indexOf(e[vm.pageSetting.barPersonalityMode]);return index>-1&&(vm.personalityBalanceGraphData[index].number++,vm.personalityBalanceGraphData[index].usersId.push(e),vm.profileBalanceDetail.total++,vm.profileBalanceDetail.total>1&&vm.profileBalanceDetail.divisionTotal++,"M"===e.gender?vm.profileBalanceDetail.gender.male++:vm.profileBalanceDetail.gender.female++,ageSwitch(e.age),!0)}function profileBalanceFilterLogic(){vm.userScreen=!1,vm.personalityBalanceGraphData=angular.copy(vm.masterDataSet),vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail);var data=vm.personalityBalance.spectrumUserDTOs.filter(function(e){return(vm.pageSetting.groupSelected.length&&available(null===e.groups?[]:e.groups,vm.pageSetting.groupSelected)||!vm.pageSetting.groupSelected.length&&e)&&(vm.pageSetting.ageSelected.length&&inBetween(null===e.age?[]:e.age,vm.pageSetting.ageSelected)||!vm.pageSetting.ageSelected.length&&e)&&(vm.pageSetting.genderSelected.length&&-1!==vm.pageSetting.genderSelected.indexOf(e.gender)||!vm.pageSetting.genderSelected.length&&e)&&(vm.pageSetting.tagSelected.length&&available(null===e.tags?[]:e.tags,vm.pageSetting.tagSelected)||!vm.pageSetting.tagSelected.length&&e)&&calculateFilterValue(e)});vm.personalityBalanceGraphData.sort(function(a,b){var aP=$rootScope.pullInterNationalization("spectrum."+a.personalityType),bP=$rootScope.pullInterNationalization("spectrum."+b.personalityType);return a.number===b.number?aP===bP?0:+(aP>bP)||-1:+(b.number>a.number)||-1}),vm.profileChartNoData=!data.length,vm.viewBox={profile:!0,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!1,engagement:!1},vm.chartDataReady=!0}function includeCheck(status,area){var i=$.inArray(status,area);i>-1?area.splice(i,1):area.push(status),sharedProperties.fireAnalyticsEvent("Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+status),stateMode()}function secondaryDrop(val){return!!Object.keys(vm.pageSetting.allTrait).length&&val!==vm.pageSetting.allTrait.ConflictManagement.Primary.currentValue}function clear(classS,property,search,checked){if(vm.pageSetting[property]=[],void 0!==search&&(vm.pageSetting[search]=""),void 0!==checked)for(var key in checked)checked[key].checked=!1;$(classS).each(function(v,i){$(this).prop("checked",!1)}),stateMode()}function closeRest(index,noScroll){var val=void 0===noScroll?0:1;$(".accordian-checkbox").each(function(i){i!==$(index.currentTarget.parentNode).index()-val&&$(this).prop("checked",!0)}),void 0===noScroll&&$("html,body").animate({scrollTop:$(".spectrum-filter-toggle").offset().top-80},300);for(var i=0;i<index.currentTarget.parentNode.children.length;i++)"H3"===index.currentTarget.parentNode.children[i].tagName&&(vm.filterNameForAnalytics=index.currentTarget.parentNode.children[i].textContent)}function profileUpdateFn(callback){$scope.$apply(function(){vm.userScreen=!0,vm.userDetail=callback.userDetail,vm.profileName=callback.name,vm.profileBalanceSelect=callback.className,vm.profileNumber=callback.number,vm.dimensionType=callback.dimensionType,vm.personalityDescription=callback.personalityDescription,vm.videoUrl=callback.videoUrl})}function videoPopUp(url){sharedProperties.videoPopUp(url)}var vm=this;vm.config={getProfileBalance:"/sp/spectrum/getProfileBalance",getBlueprint:"/sp/spectrum/getBlueprintAnalytics",getErtInsights:"/sp/spectrum/getErtiInsights",getOrganizationPlanActivities:"/sp/spectrum/getOrganizationPlanActivities",getErtAnalytics:"/sp/spectrum/getErtiAnalytics",getCompetency:"/sp/spectrum/getCompetencyInsights",videoPopUpDialog:"/sp/support/videoPopUp",getEngagementMatrix:"/sp/spectrum/getEngagementMatrix"},vm.chartDataReady=!1,vm.userScreen=!1,vm.profileChartNoData=!0,vm.noData=!1;var ageCategory=["0-21","22-34","35-44","45-54","55-64","65-200"],category=["YOUNG","MILIENIAL","GEN_X","BOOMERS","OLD","SILENT"];vm.masterProfileBalanceDetail={gender:{male:0,female:0},age:{YOUNG:0,MILIENIAL:0,GEN_X:0,BOOMERS:0,OLD:0,SILENT:0},total:0,divisionTotal:1,matched:0},vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail),vm.personalityBalance=[],vm.personalityBalanceGraphData={},vm.blueprintAnalytics=[],vm.blueprintAnalyticsGraphData=[],vm.insights=[],vm.insightsGraphData=[],vm.cloneInsightsGraphData=[],vm.insightsMasterDataSet=[],vm.orgPlan=[],vm.orgPlanGraphData=[],vm.orgUserGroupData={},vm.orgAvailableGroups=[],vm.originalOrgDetailData={},vm.analytics=[],vm.analyticsGraphData=[],vm.tilt={big:100,detail:0,mission:100,relational:0},vm.screenInfo=[],vm.activeToggleId=-1,vm.competencyEvaluation=[],vm.competencyEvaluationList=[],vm.lastPredicate="startDate",vm.lastReverse=!0,vm.competencyChartTable=[],vm.masterCompetencyDropDownList=[{id:2,name:"SelfAndManager",value:["Self","Manager"],color:["#600","#C30"]},{id:1,name:"AllEvaluationType",value:["Self","Manager","Peer"],color:["#600","#C30","#eb6b10"]},{id:7,name:"SelfAndPeer",value:["Self","Peer"],color:["#600","#eb6b10"]},{id:3,name:"ManagerAndPeer",value:["Manager","Peer"],color:["#C30","#eb6b10"]},{id:4,name:"Manager",value:["Manager"],color:["#C30"]},{id:5,name:"Peer",value:["Peer"],color:["#eb6b10"]},{id:6,name:"Self",value:["Self"],color:["#600"]}],vm.evaluationsSelected={manager:!1,self:!1,peer:!1};var innerWidth=window.innerWidth;vm.viewTableIndex={in:0,increment:innerWidth<1025?3:6},vm.engagementMatrix=[],vm.engagementFilters=[],vm.engagementMap={logins:{},users:{},averageSessions:{},articlesViewed:{},articlesCompleted:{},uniqueUsers:{},emails:{}},vm.engagementAggregate={logins:0,users:0,averageSessions:0,articlesViewed:0,articlesCompleted:0,uniqueUsers:0},vm.datePickerRange={},vm.responseStartDate=null,vm.responseEndDate=null,vm.engagementStartDate=null,vm.engagementEndDate=null,vm.engagementOpt="unique",vm.showEngagementAggregation=!1,vm.analyticsChartGroup="day",vm.sessionTicks="",vm.paFilterMonths=[],vm.selectedMonthForPA="",vm.dateDiffCount=0,vm.topPAList=[],vm.topPAMap={},vm.selectedTopPA={},vm.engagementMapsAvailable=!1,vm.yAxisLabel="Users",vm.ipadView=$(window).width()>767&&$(window).width()<1025,vm.windowWidth=$(window).width(),vm.rowDataArray=[],vm.topPADefault="",vm.globalNav=$localStorage.get("userSelectedNav"),vm.pa=!1,vm.pageSetting={groupSearch:"",competencySearch:"",groupSelected:[],individualSearch:"",individualSelected:[],ageSelected:[],genderSelected:[],tagSelected:[],tagSearch:"",memberSearch:"",sort:"plus",traitSearch:"",traitSelected:[],orgSelected:[],orgSearch:"",viewType:"i",allSteps:"",totalCompletedKpi:"",totalKpi:"",checked:!1,personalityTraitSelected:[],allTrait:{},conflictTraitPrimary:"",conflictTraitSecondary:"",traitSelectedOrder:[],deviation:10,personalityTypeDeviation:66,conflictTraitSelected:!1,fundamentalNeed:"none",fundamentalNeedDeviation:4,totalOrgPerc:0,bluePerc:0,personalityMode:"navigator",searchPersonality:"ertiData",primarypersonalityTraitSelected:[],heightParam:800,competencySelected:[],competencyProfile:-1,competencyDuration:-1,barPersonalityMode:"primaryPersonality",competencyDrop:-1,pageSize:10,disabledInfinite:!1,selectedOrgGroup:"All Groups"},vm.originalPageSetting=angular.copy(vm.pageSetting),vm.masterDataSet=[],vm.keyList=[],vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!1,engagement:!1},vm.permissionLevel={prism:!1,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!1,engagement:!1},vm.routeStateMode=0,vm.checkPermission=checkPermission,vm.routeToState=routeToState,vm.filterOpen=filterOpen,vm.getProfileBalance=getProfileBalance,vm.profileBalanceFilterLogic=profileBalanceFilterLogic,vm.includeCheck=includeCheck,vm.profileUpdateFn=profileUpdateFn,vm.clear=clear,vm.closeRest=closeRest,vm.getBlueprint=getBlueprint,vm.blueprintFilterLogic=blueprintFilterLogic,vm.percentCalc=percentCalc,vm.matchSort=matchSort,vm.getErtInsights=getErtInsights,vm.ertInsightsFilterLogic=ertInsightsFilterLogic,vm.returnClampName=returnClampName,vm.orderBy=orderBy,vm.getOrganizationPlanActivities=getOrganizationPlanActivities,vm.orgPlanFilterLogic=orgPlanFilterLogic,vm.orgOrderBy=orgOrderBy,vm.stepChanged=stepChanged,vm.openUserGroupActivitiesModal=openUserGroupActivitiesModal,vm.filterOrgDataByGroups=filterOrgDataByGroups,vm.getErtAnalytics=getErtAnalytics,vm.ertAnalyticFilterLogic=ertAnalyticFilterLogic,vm.ertOrderBy=ertOrderBy,vm.traitCheck=traitCheck,vm.traitCheckTwo=traitCheckTwo,vm.mapToTriat=mapToTriat,vm.traitClear=traitClear,vm.calucalteTiltGraph=calucalteTiltGraph,vm.conflictManagerChecked=conflictManagerChecked,vm.fundamentalNeedChecked=fundamentalNeedChecked,vm.conflictManagementclear=conflictManagementclear,vm.fundamentalNeedClear=fundamentalNeedClear,vm.secondaryDrop=secondaryDrop,vm.getCompetency=getCompetency,vm.competencyFilterLogic=competencyFilterLogic,vm.competencyOrder=competencyOrder,vm.changeCompetency=changeCompetency,vm.competencyActive=competencyActive,vm.updateviewTableIndex=updateviewTableIndex,vm.infinteScroll=infinteScroll,vm.toggleDrawer=toggleDrawer,vm.competencyCheckTriggered=competencyCheckTriggered,vm.getEngagementMatrix=getEngagementMatrix,vm.engagementFilterLogic=engagementFilterLogic,vm.changeTopPA=changeTopPA,vm.viewTopPADetails=viewTopPADetails,vm.prepareDatePicker=prepareDatePicker,vm.calculateHeight=calculateHeight,vm.animate=animate,vm.videoPopUp=videoPopUp,vm.moduleNameForAnalytics="",vm.filterNameForAnalytics="",vm.googleChartReady=!1,vm.ipad=$(window).width()<1100&&$(window).width()>992;var width=$(window).width();vm.mobile=width<1100,vm.userType="Employees",vm.sharedProp=sharedProperties;var calculateDateRange=function(startDate,endDate){return moment(endDate,"YYYY-MM-DD").diff(moment(startDate,"YYYY-MM-DD"),"days")+1},prepareTopPA=function(data){vm.paFilterMonths=[],vm.topPAList=[],vm.topPAMap={},vm.topPADefault=$rootScope.pullInterNationalization("spectrum.engagement.datePicker.options3");for(var pa=0;pa<data.length;pa++)vm.topPAMap[data[pa].month+"-"+data[pa].year]=data[pa].practiceAreasGoals;moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker"));for(var month=0;month<data.length;month++)vm.paFilterMonths.unshift({name:moment(data[month].year+"-"+data[month].month,"YYYY-MM").format("MMMM, YYYY"),value:moment(data[month].year+"-"+data[month].month,"YYYY-MM").format("M-YYYY")});vm.paFilterMonths.length&&(vm.selectedMonthForPA=vm.paFilterMonths[0].value,vm.topPAList=vm.topPAMap[vm.selectedMonthForPA])},processAnalyticRows=function(map){var tmpData=[],orderedDates={};Object.keys(map).sort(function(a,b){return moment(a,"YYYY,MM,DD").toDate()-moment(b,"YYYY,MM,DD").toDate()}).forEach(function(key){orderedDates[key]=map[key]});var keys=Object.keys(orderedDates);if(vm.rowDataArray=[],1===keys.length)"month"===vm.analyticsChartGroup?"avgSessions"===vm.engagementOpt?tmpData.push([moment(keys[0],"YYYY,MM,DD").format("MMM YYYY"),map[keys[0]],createCustomTooltip(moment(keys[0],"YYYY,MM,DD").format("MMM YYYY"),secsToHHMMSSLabel(map[keys[0]]))]):tmpData.push([moment(keys[0],"YYYY,MM,DD").format("MMM YYYY"),map[keys[0]]]):"avgSessions"===vm.engagementOpt?tmpData.push([moment(keys[0],"YYYY,MM,DD").format("MMM D"),map[keys[0]],createCustomTooltip(moment(keys[0],"YYYY,MM,DD").format("MMM D"),secsToHHMMSSLabel(map[keys[0]]))]):tmpData.push([moment(keys[0],"YYYY,MM,DD").format("MMM D"),map[keys[0]]]);else for(var j=0;j<keys.length;j++)"avgSessions"===vm.engagementOpt?(tmpData.push([moment(keys[j],"YYYY,MM,DD").toDate(),map[keys[j]],createCustomTooltip(moment(keys[j],"YYYY,MM,DD").format("MMM DD,YYYY"),secsToHHMMSSLabel(map[keys[j]]))]),vm.rowDataArray.push(map[keys[j]])):tmpData.push([moment(keys[j],"YYYY,MM,DD").toDate(),map[keys[j]]]);return tmpData},createCustomTooltip=function(xAxisVal,yAxisVal){return'<div style="padding:5px 5px 5px 5px;width:180px;"><strong>'+xAxisVal+"</strong><br/>"+$rootScope.pullInterNationalization("spectrum.engagement.tick.tooltip")+"<strong>"+yAxisVal+"</strong></div>"},indexOfMax=function(arr){if(0===arr.length)return-1;for(var max=arr[0],maxIndex=0,i=1;i<arr.length;i++)arr[i]>max&&(maxIndex=i,max=arr[i]);return maxIndex},drawAnalyticsChart=function(){try{var data=new google.visualization.DataTable,colName="",rowData=[],weeklyRowData=[],monthlyRowData=[],grouped_data=null,isHTMLToolTip=!1;if("logins"===vm.engagementOpt?(rowData=processAnalyticRows(vm.engagementMap.logins),colName=$rootScope.pullInterNationalization("spectrum.engagement.options.yAxisLabel1"),vm.yAxisLabel=$rootScope.pullInterNationalization("spectrum.engagement.options.yAxisLabel1")):"avgSessions"===vm.engagementOpt?(rowData=processAnalyticRows(vm.engagementMap.averageSessions),colName=$rootScope.pullInterNationalization("spectrum.engagement.options.yAxisLabel2"),vm.yAxisLabel=$rootScope.pullInterNationalization("spectrum.engagement.options.yAxisLabel2")):"users"===vm.engagementOpt?(rowData=processAnalyticRows(vm.engagementMap.users),colName=$rootScope.pullInterNationalization("spectrum.engagement.options.yAxisLabel3"),vm.yAxisLabel=$rootScope.pullInterNationalization("spectrum.engagement.options.yAxisLabel3")):(rowData=processAnalyticRows(vm.engagementMap.users),colName=$rootScope.pullInterNationalization("spectrum.engagement.options.yAxisLabel4"),vm.yAxisLabel=$rootScope.pullInterNationalization("spectrum.engagement.options.yAxisLabel4")),1===rowData.length?data.addColumn("string","X"):data.addColumn("date","X"),data.addColumn("number",colName),"avgSessions"===vm.engagementOpt?(data.addColumn({type:"string",role:"tooltip",p:{html:!0}}),isHTMLToolTip=!0):(vm.sessionTicks="",isHTMLToolTip=!1),data.addRows(rowData),"avgSessions"===vm.engagementOpt&&"day"===vm.analyticsChartGroup)if(vm.sessionTicks=[],vm.sessionTicks.push({v:0,f:"00:00:00"}),rowData.length>5){for(var tempMathVal=Math.floor(rowData.length/5),tempLoopVal=tempMathVal,maxIndex=indexOfMax(vm.rowDataArray),row=0;row<5;row++)rowData.length>tempLoopVal&&(vm.sessionTicks.push({v:rowData[tempLoopVal][1],f:secsToHHMMSSLabel(rowData[tempLoopVal][1])}),tempLoopVal+=tempMathVal);vm.sessionTicks.push({v:rowData[maxIndex][1],f:secsToHHMMSSLabel(rowData[maxIndex][1])}),vm.sessionTicks.push({v:rowData[rowData.length-1][1],f:secsToHHMMSSLabel(rowData[rowData.length-1][1])})}else for(var row1=0;row1<rowData.length;row1++)vm.sessionTicks.push({v:rowData[row1][1],f:secsToHHMMSSLabel(rowData[row1][1])});"month"===vm.analyticsChartGroup&&rowData.length>1&&(monthlyRowData=[],"unique"===vm.engagementOpt?monthlyRowData=groupUniqueUsersByMonth(vm.engagementMap.emails):(grouped_data=google.visualization.data.group(data,[{column:0,modifier:groupByMonths,type:"string"}],[{column:1,aggregation:google.visualization.data.sum,type:"number"}]),monthlyRowData=monthRowCalc(grouped_data))),"week"===vm.analyticsChartGroup&&rowData.length>1&&(weeklyRowData=[],"unique"===vm.engagementOpt?weeklyRowData=groupUniqueUsersByWeek(vm.engagementMap.emails):(grouped_data=google.visualization.data.group(data,[{column:0,modifier:groupByWeeks,type:"string"}],[{column:1,aggregation:google.visualization.data.sum,type:"number"}]),weeklyRowData=weekRowCalc(grouped_data)));var weeklyData=new google.visualization.DataTable;if(weeklyData.addColumn("string","X"),weeklyData.addColumn("number",colName),"avgSessions"===vm.engagementOpt&&weeklyData.addColumn({type:"string",role:"tooltip",p:{html:!0}}),weeklyData.addRows(weeklyRowData),"avgSessions"===vm.engagementOpt&&"week"===vm.analyticsChartGroup&&rowData.length>1){vm.sessionTicks=[],vm.sessionTicks.push({v:0,f:"00:00:00"});for(var week=0;week<weeklyRowData.length;week++)vm.sessionTicks.push({v:weeklyRowData[week][1],f:secsToHHMMSSLabel(weeklyRowData[week][1])})}var monthlyData=new google.visualization.DataTable;if(monthlyData.addColumn("string","X"),monthlyData.addColumn("number",colName),"avgSessions"===vm.engagementOpt&&monthlyData.addColumn({type:"string",role:"tooltip",p:{html:!0}}),monthlyData.addRows(monthlyRowData),"avgSessions"===vm.engagementOpt&&"month"===vm.analyticsChartGroup&&rowData.length>1){vm.sessionTicks=[],vm.sessionTicks.push({v:0,f:"00:00:00"});for(var month=0;month<monthlyRowData.length;month++)vm.sessionTicks.push({v:monthlyRowData[month][1],f:secsToHHMMSSLabel(monthlyRowData[month][1])})}var options={hAxis:{title:"",format:"MMM d",textPosition:"in",gridlines:{color:"none"}},vAxis:{title:"",minValue:0,textPosition:"in",ticks:vm.sessionTicks},tooltip:{isHtml:isHTMLToolTip},chartArea:{width:"95%"},pointSize:8,lineWidth:5,colors:["#f63"],legend:{position:"none"},pointShape:"circle",animation:{duration:500,startup:!0,easing:"linear"}},chart=new google.visualization.LineChart(document.getElementById("chart_div"));google.visualization.events.addListener(chart,"ready",onChartReady),"month"===vm.analyticsChartGroup&&rowData.length>1?chart.draw(monthlyData,options):"week"===vm.analyticsChartGroup&&rowData.length>1?chart.draw(weeklyData,options):chart.draw(data,options)}catch(err){$rootScope.$broadcast("httpLoaderEnd"),sharedProperties.growlMessage($rootScope.pullInterNationalization("spectrum.engagement.error"),"","glyphicon glyphicon-ban-circle")}$timeout(function(){$rootScope.$broadcast("httpLoaderEnd"),vm.showEngagementAggregation=!0},2e3)},groupUniqueUsersByMonth=function(map){var uniqueData=[],orderedUniqueMap={},tempUniqueList=[],tempUniqueMap={};Object.keys(map).sort(function(a,b){return moment(a,"MM/DD/YYYY").toDate()-moment(b,"MM/DD/YYYY").toDate()}).forEach(function(key){orderedUniqueMap[key]=map[key]});for(var keys=Object.keys(orderedUniqueMap),unique=0;unique<keys.length;unique++)if(void 0!==tempUniqueMap[moment(keys[unique],"MM/DD/YYYY").month()+"-"+moment(keys[unique],"MM/DD/YYYY").format("YYYY")]){tempUniqueList=[],tempUniqueList=angular.copy(tempUniqueMap[moment(keys[unique],"MM/DD/YYYY").month()+"-"+moment(keys[unique],"MM/DD/YYYY").format("YYYY")]);for(var user=0;user<orderedUniqueMap[keys[unique]].length;user++)-1===tempUniqueList.indexOf(orderedUniqueMap[keys[unique]][user])&&tempUniqueList.push(orderedUniqueMap[keys[unique]][user]);tempUniqueMap[moment(keys[unique],"MM/DD/YYYY").month()+"-"+moment(keys[unique],"MM/DD/YYYY").format("YYYY")]=[],tempUniqueMap[moment(keys[unique],"MM/DD/YYYY").month()+"-"+moment(keys[unique],"MM/DD/YYYY").format("YYYY")]=angular.copy(tempUniqueList)}else tempUniqueList=[],tempUniqueList=angular.copy(orderedUniqueMap[keys[unique]]),tempUniqueMap[moment(keys[unique],"MM/DD/YYYY").month()+"-"+moment(keys[unique],"MM/DD/YYYY").format("YYYY")]=tempUniqueList;for(var uniqueKeys=Object.keys(tempUniqueMap),j=0;j<uniqueKeys.length;j++)uniqueData.push([moment([uniqueKeys[j].substr(uniqueKeys[j].indexOf("-")+1)]).month(uniqueKeys[j].substr(0,uniqueKeys[j].indexOf("-"))).startOf("month").format("MMM YYYY"),tempUniqueMap[uniqueKeys[j]].length]);return uniqueData},monthRowCalc=function(dataTable){for(var rowcount=dataTable.getNumberOfRows(),newMap={},orderedMap={},tmpData=[],i=0;i<rowcount;i++)newMap[dataTable.getValue(i,0)]=dataTable.getValue(i,1);Object.keys(newMap).sort(function(a,b){return moment(a,"MMM YYYY").toDate()-moment(b,"MMM YYYY").toDate()}).forEach(function(key){orderedMap[key]=newMap[key]});for(var keys=Object.keys(orderedMap),j=0;j<keys.length;j++)"avgSessions"===vm.engagementOpt?tmpData.push([keys[j],orderedMap[keys[j]],createCustomTooltip(keys[j],secsToHHMMSSLabel(orderedMap[keys[j]]))]):tmpData.push([keys[j],orderedMap[keys[j]]]);return tmpData},groupUniqueUsersByWeek=function(map){var uniqueData=[],orderedUniqueMap={},tempUniqueList=[],tempUniqueMap={};Object.keys(map).sort(function(a,b){return moment(a,"MM/DD/YYYY").toDate()-moment(b,"MM/DD/YYYY").toDate()}).forEach(function(key){orderedUniqueMap[key]=map[key]});for(var keys=Object.keys(orderedUniqueMap),unique=0;unique<keys.length;unique++)if(void 0!==tempUniqueMap[moment(keys[unique],"MM/DD/YYYY").week()+"-"+moment(keys[unique],"MM/DD/YYYY").format("YYYY")]){tempUniqueList=[],
tempUniqueList=angular.copy(tempUniqueMap[moment(keys[unique],"MM/DD/YYYY").week()+"-"+moment(keys[unique],"MM/DD/YYYY").format("YYYY")]);for(var user=0;user<orderedUniqueMap[keys[unique]].length;user++)-1===tempUniqueList.indexOf(orderedUniqueMap[keys[unique]][user])&&tempUniqueList.push(orderedUniqueMap[keys[unique]][user]);tempUniqueMap[moment(keys[unique],"MM/DD/YYYY").week()+"-"+moment(keys[unique],"MM/DD/YYYY").format("YYYY")]=[],tempUniqueMap[moment(keys[unique],"MM/DD/YYYY").week()+"-"+moment(keys[unique],"MM/DD/YYYY").format("YYYY")]=angular.copy(tempUniqueList)}else tempUniqueList=[],tempUniqueList=angular.copy(orderedUniqueMap[keys[unique]]),tempUniqueMap[moment(keys[unique],"MM/DD/YYYY").week()+"-"+moment(keys[unique],"MM/DD/YYYY").format("YYYY")]=tempUniqueList;for(var uniqueKeys=Object.keys(tempUniqueMap),j=0;j<uniqueKeys.length;j++){var hAxisVal=moment([uniqueKeys[j].substr(uniqueKeys[j].indexOf("-")+1)]).week(uniqueKeys[j].substr(0,uniqueKeys[j].indexOf("-"))).startOf("week").format("MMM D");0===j&&moment(vm.engagementStartDate,"YYYY-MM-DD").isAfter(moment([uniqueKeys[j].substr(uniqueKeys[j].indexOf("-")+1)]).week(uniqueKeys[j].substr(0,uniqueKeys[j].indexOf("-"))).startOf("week").format("YYYY-MM-DD"))&&(hAxisVal=moment(vm.engagementStartDate,"YYYY-MM-DD").format("MMM D")),uniqueData.push([hAxisVal,tempUniqueMap[uniqueKeys[j]].length])}return uniqueData},weekRowCalc=function(dataTable){for(var rowcount=dataTable.getNumberOfRows(),newMap={},orderedMap={},tmpData=[],i=0;i<rowcount;i++){var subValue=dataTable.getValue(i,0).substr(dataTable.getValue(i,0).indexOf("|")+1),actualValue=dataTable.getValue(i,0).substr(0,dataTable.getValue(i,0).indexOf("|"));newMap[subValue]={key:actualValue,value:dataTable.getValue(i,1)}}Object.keys(newMap).sort(function(a,b){return moment(a,"YYYY,MM,DD").toDate()-moment(b,"YYYY,MM,DD").toDate()}).forEach(function(key){orderedMap[key]=newMap[key]});for(var keys=Object.keys(orderedMap),j=0;j<keys.length;j++){var hAxisVal=null,hAxisValtmp=null,hAxisFinal=null;hAxisVal=orderedMap[keys[j]].key,0===j&&moment(vm.engagementStartDate,"YYYY-MM-DD").isAfter(moment(keys[j],"YYYY-MM-DD"))&&(hAxisValtmp=hAxisVal.substr(hAxisVal.indexOf("-")+1),hAxisVal=hAxisValtmp===moment(vm.engagementStartDate,"YYYY-MM-DD").format("MMM D")?hAxisValtmp:moment(vm.engagementStartDate,"YYYY-MM-DD").format("MMM D")+"-"+hAxisValtmp),j===keys.length-1&&moment(vm.engagementEndDate,"YYYY-MM-DD").isBefore(moment(keys[j],"YYYY-MM-DD").add(6,"d").format("YYYY-MM-DD"))&&(hAxisValtmp=hAxisVal.substr(0,hAxisVal.indexOf("-")),hAxisVal=hAxisValtmp===moment(vm.engagementEndDate,"YYYY-MM-DD").format("MMM D")?hAxisValtmp:hAxisValtmp+"-"+moment(vm.engagementEndDate,"YYYY-MM-DD").format("MMM D")),hAxisFinal=-1!==hAxisVal.indexOf("-")?hAxisVal.substr(0,hAxisVal.indexOf("-")):hAxisVal,"avgSessions"===vm.engagementOpt?tmpData.push([hAxisFinal,orderedMap[keys[j]].value,createCustomTooltip(hAxisFinal,secsToHHMMSSLabel(orderedMap[keys[j]].value))]):tmpData.push([hAxisFinal,orderedMap[keys[j]].value])}return tmpData},groupByMonths=function(value){var month=value.getMonth(),year=value.getFullYear();moment(value).format("YYYY,MM,DD");return moment(new Date(year,month)).format("MMM YYYY")},groupByWeeks=function(value){var begin=moment(value).startOf("week").weekday(0),beginDate=begin.format("YYYY-MM-DD");return begin.format("MMM D")+"-"+begin.add(6,"d").format("MMM D")+"|"+beginDate},onChartReady=function(){$rootScope.$broadcast("httpLoaderEnd"),vm.showEngagementAggregation=!0},secsToHHMMSS=function(secs){var sec_num=parseInt(secs,10),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60),seconds=sec_num-3600*hours-60*minutes;return hours<10&&(hours="0"+hours),minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds),hours+":"+minutes+":"+seconds},secsToHHMMSSLabel=function(secs){var sec_num=parseInt(secs,10),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60),seconds=sec_num-3600*hours-60*minutes;return hours<10&&(hours="0"+hours),minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds),hours+":"+minutes+":"+seconds},createEngagementMaps=function(data){vm.engagementMap={logins:{},users:{},averageSessions:{},articlesViewed:{},articlesCompleted:{},uniqueUsers:{},emails:{}},vm.engagementAggregate={logins:0,users:0,averageSessions:0,articlesViewed:0,articlesCompleted:0,uniqueUsers:0},vm.engagementMapsAvailable=!1;for(var emailList=[],i=0;i<data.length;i++)0!==data[i].loggedInCount&&(vm.engagementMapsAvailable=!0,void 0!==vm.engagementMap.logins[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]?vm.engagementMap.logins[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]=parseInt(data[i].loggedInCount)+parseInt(vm.engagementMap.logins[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]):vm.engagementMap.logins[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]=data[i].loggedInCount,void 0!==vm.engagementMap.users[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]?vm.engagementMap.users[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]=1+parseInt(vm.engagementMap.users[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]):vm.engagementMap.users[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]=1,void 0!==vm.engagementMap.averageSessions[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]?vm.engagementMap.averageSessions[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]=parseFloat(parseInt(data[i].totalSessionDuration)/parseInt(data[i].loggedInCount))+vm.engagementMap.averageSessions[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]:vm.engagementMap.averageSessions[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]=parseFloat(parseInt(data[i].totalSessionDuration)/parseInt(data[i].loggedInCount)),void 0!==vm.engagementMap.articlesViewed[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]?vm.engagementMap.articlesViewed[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]=parseInt(data[i].articleViewed)+parseInt(vm.engagementMap.articlesViewed[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]):vm.engagementMap.articlesViewed[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]=data[i].articleViewed,void 0!==vm.engagementMap.articlesCompleted[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]?vm.engagementMap.articlesCompleted[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]=parseInt(data[i].articleCompleted)+parseInt(vm.engagementMap.articlesCompleted[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]):vm.engagementMap.articlesCompleted[data[i].date[0]+","+data[i].date[1]+","+data[i].date[2]]=data[i].articleCompleted,void 0!==vm.engagementMap.emails[data[i].date[1]+"/"+data[i].date[2]+"/"+data[i].date[0]]?(emailList=[],emailList=angular.copy(vm.engagementMap.emails[data[i].date[1]+"/"+data[i].date[2]+"/"+data[i].date[0]]),emailList.push(data[i].email),vm.engagementMap.emails[data[i].date[1]+"/"+data[i].date[2]+"/"+data[i].date[0]]=[],vm.engagementMap.emails[data[i].date[1]+"/"+data[i].date[2]+"/"+data[i].date[0]]=angular.copy(emailList)):(emailList=[],emailList.push(data[i].email),vm.engagementMap.emails[data[i].date[1]+"/"+data[i].date[2]+"/"+data[i].date[0]]=emailList),void 0===vm.engagementMap.uniqueUsers[data[i].email]&&(vm.engagementMap.uniqueUsers[data[i].email]=1,vm.engagementAggregate.uniqueUsers=vm.engagementAggregate.uniqueUsers+1));for(var mapKeys=Object.keys(vm.engagementMap.averageSessions),j=0;j<mapKeys.length;j++){var averageValue=null;averageValue=parseFloat(vm.engagementMap.averageSessions[mapKeys[j]]/vm.engagementMap.users[mapKeys[j]]),vm.engagementMap.averageSessions[mapKeys[j]]=averageValue}},aggregateEngagementData=function(){for(var login in vm.engagementMap.logins)vm.engagementAggregate.logins=parseInt(vm.engagementMap.logins[login])+parseInt(vm.engagementAggregate.logins);for(var user in vm.engagementMap.users)vm.engagementAggregate.users=parseInt(vm.engagementMap.users[user])+parseInt(vm.engagementAggregate.users);for(var avgSession in vm.engagementMap.averageSessions)vm.engagementAggregate.averageSessions=parseFloat(vm.engagementMap.averageSessions[avgSession])+parseFloat(vm.engagementAggregate.averageSessions);for(var articleViewed in vm.engagementMap.articlesViewed)vm.engagementAggregate.articlesViewed=parseInt(vm.engagementMap.articlesViewed[articleViewed])+parseInt(vm.engagementAggregate.articlesViewed);for(var articleComplete in vm.engagementMap.articlesCompleted)vm.engagementAggregate.articlesCompleted=parseInt(vm.engagementMap.articlesCompleted[articleComplete])+parseInt(vm.engagementAggregate.articlesCompleted);vm.engagementAggregate.averageSessions=secsToHHMMSS(vm.engagementAggregate.averageSessions.toFixed(2)/parseInt(vm.dateDiffCount))},resetEngagementChart=function(){vm.engagementStartDate=moment().startOf("week").format("YYYY-MM-DD"),vm.engagementEndDate=moment().format("YYYY-MM-DD"),vm.engagementOpt="unique",vm.analyticsChartGroup="day",vm.engagementFilterLogic()},resetAgeAndGender=function(){vm.profileBalanceDetail={gender:{male:0,female:0},age:{YOUNG:0,MILIENIAL:0,GEN_X:0,BOOMERS:0,OLD:0,SILENT:0},divisionTotal:1}};$(window).resize(function(){vm.ipadView&&"engagement"===vm.routeStateMode&&$(window).width()!==vm.windowWidth&&(vm.windowWidth=$(window).width(),90===window.orientation?(vm.viewBox.engagement=!1,$timeout(function(){vm.engagementFilterLogic()},100)):0===window.orientation&&drawAnalyticsChart())})}angular.module("spApp").controller("spectrumController",spectrumController),spectrumController.$inject=["$scope","ajaxService","$localStorage","$timeout","$rootScope","ngDialog","$state","sharedProperties","$filter"],angular.module("spApp").directive("rangeDrag",["$rootScope",function($rootScope){return{restrict:"E",replace:!1,templateUrl:"/sp/resources/html/spectrum/twoRangeDrag.html",scope:{data_1:"=rangeData1",data_2:"=rangeData2",dragRange:"=dragRange",editable:"=editable",updateFn:"&updateFn",checkboxFn:"&checkboxFn"},link:function(scope,element,attr){var inputCreator=function(){var ele=$(element).find(".dragdealer")[0],leftRange=$(element).find(".labels .minRange"),rightRange=$(element).find(".labels .maxRange");new Dragdealer(ele,{animationCallback:function(x,y){leftRange.text(Math.round(100-100*x)),rightRange.text(Math.round(100*x))},dragStartCallback:function(x,y){scope.editable||scope.$apply(function(){(scope.editable=!0)&&scope.checkboxFn()})},callback:function(x,y){sliderValue(x),scope.editable||scope.$apply(function(){(scope.editable=!0)&&scope.checkboxFn()})},x:scope.dragRange})},sliderValue=function(x){var xAxis=Math.round(100-100*x),yAxis=Math.round(100*x);scope.$apply(function(){xAxis!==scope.data_1.currentValue&&yAxis!==scope.data_2.currentValue&&(scope.data_1.currentValue=xAxis,scope.data_2.currentValue=yAxis,scope.updateFn())})};void 0!==scope.editable&&inputCreator()}}}]),angular.module("spApp").directive("twoRange",["$rootScope",function($rootScope){return{restrict:"E",replace:!1,templateUrl:"/sp/resources/html/spectrum/twoRange.html",scope:{data_1:"=rangeData1",data_2:"=rangeData2",editable:"=editable",updateFn:"&updateFn",checkboxFn:"&checkboxFn"},link:function(scope,element,attr){element.bind("change",function(){sliderValue()});var inputCreator=function(){scope.minValue=0,scope.maxValue=100,scope.which=-1,scope.editable=void 0!==scope.editable&&scope.editable,scope.currentValue1=null===scope.data_1.currentValue?0:100-parseInt(scope.data_1.currentValue),scope.currentValue2=null===scope.data_2.currentValue?0:scope.data_2.currentValue},sliderValue=function(){scope.$apply(function(){0===scope.which?(scope.data_1.currentValue=100-parseInt(scope.currentValue1,10),scope.data_2.currentValue=scope.currentValue1,scope.currentValue2=parseInt(scope.currentValue1,10)):1===scope.which&&(scope.data_1.currentValue=100-parseInt(scope.currentValue2,10),scope.data_2.currentValue=scope.currentValue2,scope.currentValue1=parseInt(scope.currentValue2,10)),scope.updateFn(),scope.editable||(scope.editable=!0,scope.checkboxFn())})};scope.$watch("editable",function(newValue,oldValue){void 0!==scope.data_1&&inputCreator()},!0)}}}]),angular.module("spApp").directive("singleRange",["$rootScope",function($rootScope){return{restrict:"E",replace:!1,templateUrl:"/sp/resources/html/spectrum/singleRange.html",scope:{data:"=rangeData",editable:"=editable",updateFn:"&updateFn",checkboxFn:"&checkboxFn"},link:function(scope,element,attr){element.bind("change",function(){getSliderValue()});var getSliderValue=function(){scope.$apply(function(){scope.data.currentValue=scope.currentValue,scope.editable||(scope.editable=!0,scope.checkboxFn()),scope.updateFn()})},inputCreator=function(){scope.minValue=0,scope.maxValue=100,scope.editable=void 0!==scope.editable&&scope.editable,scope.currentValue=void 0===scope.data.currentValue?0:scope.data.currentValue};scope.$watch("editable",function(newValue,oldValue){void 0!==scope.data&&inputCreator()},!0)}}}]),angular.module("spApp").directive("ellipsis",["$rootScope",function($rootScope){return{restrict:"E",replace:!1,templateUrl:"/sp/resources/html/spectrum/structure.html",scope:{data:"=elData",length:"=elLength",fontsize:"=elFontsize",total:"=elTotal",message:"=elMessage",lang:"=elLang"},link:function(scope,element,attrs){var resize=function(){ellipsisCreator(scope.data),scope.$apply()},ellipsisCreator=function(array){var arraySize=[],size=0,stopCounter=0,length=$(scope.length).width()/1.7;if(scope.toolTiptext=null,scope.visibleText=null,scope.remaining=0,scope.more=$rootScope.pullInterNationalization("spectrum.more"),scope.total!==scope.data.length){for(var i=0;i<array.length;i++){var e=document.createElement("span");if(document.body.appendChild(e),e.style.fontSize=scope.fontsize+"px",e.setAttribute("class","posAbs"),e.innerHTML=array[i],arraySize.push(e.offsetWidth+5),$(".posAbs").remove(),size+arraySize[i]>=length){stopCounter=i-1;break}size+=arraySize[i],stopCounter=i}scope.visibleText=array.slice(0,stopCounter+1).join(", "),stopCounter<array.length-1&&(scope.toolTiptext=array.slice(stopCounter+1,array.length).join(", "),scope.remaining=array.length-1-stopCounter)}else scope.visibleText=scope.message};scope.$watch("data",function(newValue,oldValue){void 0!==scope.data&&ellipsisCreator(scope.data)},!0),$(window).on("resize",resize)}}}]),angular.module("spApp").directive("barChart",["$rootScope","$window",function($rootScope,$window){function tickLength(dataMax){for(var max=0,i=0;i<dataMax.length;i++)max<dataMax[i].name.length&&(max=dataMax[i].name.length);return max*=10,max=max<160?max:max-28}function change(d){d3.select(".bar-"+d.className).classed("hovered",!0),d3.select(".x-"+d.className).classed("hovered",!0)}function restore(d){d3.select(".bar-"+d.className).classed("hovered",!1),d3.select(".x-"+d.className).classed("hovered",!1)}function classes(root){function recurse(name,node){null===name?node.forEach(function(child){recurse(child.personalityType,child)}):classesList.push({name:$rootScope.pullInterNationalization("spectrum."+name),className:name.toLowerCase(),number:node.number,userDetail:node.usersId,percent:node.percent,index:node.percent+name+node.number,dimensionType:node.dimensionType,personalityDescription:node.personalityDescription,videoUrl:node.videoUrl})}var classesList=[];return recurse(null,root),{children:classesList}}return{restrict:"E",replace:!1,scope:{data:"=chartData",clickOperation:"=clickEvent",updateFn:"&"},link:function(scope,element,attrs){var duration=800,delay=200,classToBind=$("."+attrs.classBind),legendSpace=170,barHeight=35,boxArea=5,margin={top:20,right:50,bottom:30,left:170},rangeBandHeight=barHeight*scope.data.length+margin.top,width=classToBind.width()-margin.left-margin.right,height=classToBind.height()-margin.top-margin.bottom,widthMar=(d3.format(",d"),width+margin.left+margin.right),heightMar=height+margin.top+margin.bottom,ease="cubic-in-out",svg=d3.select(element[0]).append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+widthMar+" "+heightMar).attr("preserveAspectRatio","xMinYMin").attr("class","barChart").append("g").attr("transform","translate("+margin.left+","+margin.top+")"),chart=$(".barChart"),barChartCreation=(chart.width(),chart.height(),chart.parent(),function(svgElem,data,scopePass){var x=d3.scale.linear().domain([0,d3.max(data,function(d){return 10*Math.ceil(d.number/10)})]).range([0,width-legendSpace]),y=d3.scale.ordinal().domain(d3.range(data.length)).rangeBands([0,rangeBandHeight]),maxLength=tickLength(data);svgElem.selectAll("g.axis").remove(),svgElem.selectAll(".bar").remove(),svgElem.append("line").attr("x1",-maxLength).attr("y1",0).attr("x2",-maxLength).attr("y2",rangeBandHeight).style("stroke-width",1).style("stroke","#ddd").style("fill","none");var yAxis=d3.svg.axis().scale(y).orient("right").tickSize(0).tickPadding(-(maxLength-boxArea)).tickFormat(function(d){return data[d].name});svgElem.append("g").attr("class","y axis").call(yAxis).append("text"),svgElem.select(".y").selectAll(".tick").data(data).attr("class",function(d,i){return"tick xAxisClick x-"+d.className}).on("mouseout",restore).on("mouseover",change).on("click",function(d,i){if(!scopePass.clickOperation)return!0;scopePass.updateFn({callback:d})}),svgElem.select(".y").selectAll(".tick").insert("rect","text").attr("width",maxLength).attr("height",barHeight).attr("y","-18.9").attr("x",-maxLength),svgElem.select(".y").selectAll(".tick line").attr("x2",-maxLength).attr("y1","16.8").attr("y2","16.8"),svgElem.select(".xAxisClick").insert("line","rect").attr("x2",-maxLength).attr("y1","-17.5").attr("y2","-17.5");var bars=svgElem.selectAll(".bar").data(data);bars.enter().append("g").attr("class",function(d){return"bar bar-"+d.className+" number_"+d.number}).on("mouseout",restore).on("mouseover",change).on("click",function(d){if(!scopePass.clickOperation)return!0;scopePass.updateFn({callback:d})}).attr("transform",function(d,i){return"translate(0,"+y(i)+")"}),bars.append("rect").transition().duration(duration).ease(ease).attr("height",barHeight).attr("width",0).transition().delay(delay).duration(duration).attr("width",function(d){var num=x(d.number);return Math.abs(num)}),bars.append("text").transition().duration(duration).ease(ease).attr("x",10).attr("y",18).attr("dy",".35em").attr("text-anchor","end").transition().delay(delay).duration(duration).attr("x",function(d){return 10+Math.abs(x(d.number))+7*d.number.toString().length}).text(function(d){return d.number}),bars.exit().transition().style({opacity:0}).remove()});scope.$watch("data",function(newValue,oldValue){if(void 0!==scope.data&&scope.data.length){var dataToPass=classes(scope.data);barChartCreation(svg,dataToPass.children,scope)}},!0)}}}]),angular.module("spApp").directive("elemReady",["$parse",function($parse){return{restrict:"A",link:function($scope,elem,attrs){elem.ready(function(){$scope.$apply(function(){$parse(attrs.elemReady)($scope)})})}}}]),angular.module("spApp").directive("groupBarChart",["$rootScope","$filter",function($rootScope,$filter){function processRatingHex(ratingCount,type){var str="";if(void 0!==type&&"minipolls"===type)for(var i=1;i<=ratingCount;i++)str+="";else for(var j=1;j<=ratingCount;j++)str+="";return str}function translateName(key){switch(key){case"Self":return selfText;case"Manager":return managerText;case"Peer":return peerText}}var selfText=$rootScope.pullInterNationalization("spectrum.self"),managerText=$rootScope.pullInterNationalization("spectrum.manager"),peerText=$rootScope.pullInterNationalization("competency.admin.peer");return{restrict:"E",replace:!1,scope:{data:"=chartData",filter:"=chartFilter",colors:"=chartColor",views:"=chartView",ratingSize:"=chartRating"},link:function(scope,element,attrs){var evaluationText=$rootScope.pullInterNationalization("spectrum.evaluation"),margin={top:20,right:20,bottom:30,left:40},classToBind=$("."+attrs.classBind),width=classToBind.width()-margin.left-margin.right,widthMar=classToBind.width(),desktop=window.innerWidth>1024,height=300-margin.top-margin.bottom,svg=d3.select(element[0]).append("svg").attr("viewBox","0 0 "+widthMar+" 400").attr("preserveAspectRatio","xMinYMin meet").attr("class","svg-content").append("g").attr("transform","translate("+margin.left+","+margin.top+")"),divTooltip=d3.select(element[0]).append("div").attr("class","toolTip-bar"),barChartCreation=function(svg,data,filters,colors,ratingSize){var x0=d3.scale.ordinal().rangeRoundBands([0,width],"0.6"),x1=d3.scale.ordinal(),y=d3.scale.linear().range([height,0]),color=d3.scale.ordinal().range(colors),xAxis=d3.svg.axis().scale(x0).orient("bottom").tickFormat(function(d,i){return $filter("spLocaleDate")(data[i].Groups)}),yAxis=d3.svg.axis().scale(y).orient("left").ticks("10").tickFormat(d3.format("d"));data.forEach(function(d){d.cluster=filters.filter(function(e){"use strict";return-1!==filters.indexOf(e)}).map(function(e){var defined=void 0!==d[e];return{name:e,value:defined?+d[e].score:0,count:defined?+d[e].count:0,completedCount:defined?+d[e].completedCount:0,ratingSize:defined?+d[e].ratingSize:0}})}),x0.domain(data.map(function(d){return d.index})),x1.domain(filters).rangeRoundBands([0,x0.rangeBand()]),y.domain([0,ratingSize]),svg.selectAll("g.axis").remove(),svg.selectAll(".groups").remove(),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis).selectAll(".x .tick text").call(function(t){t.each(function(d){var self=d3.select(this),s=self.text().split(",");self.text(""),self.append("tspan").attr("x",0).attr("dy",".8em").text(s[0]),self.append("tspan").attr("x",0).attr("dy","1.2em").text(s[1])})}),svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end"),svg.selectAll(".groups").data(data).enter().append("g").attr("class","groups").attr("transform",function(d){return"translate("+x0(d.index)+",0)"}).selectAll("rect").data(function(d){return d.cluster}).enter().append("rect").attr("class","group-bar").attr("width",x1.rangeBand()).attr("x",function(d){return x1(d.name)}).attr("y",function(d){return height}).style("fill",function(d){return color(d.name)}).on("mousemove",function(d){divTooltip.style("left",d3.event.layerX-76+"px").style("top",d3.event.layerY-110+"px").style("display","inline-block").html("<div class='tooltip-element'><span class='title'>"+translateName(d.name)+"</span><div class='rating-val sp-link-color'>"+d.value+"</div><div class='ratings-hex'><div class='empty-hex size_"+d.ratingSize+"' data-rating='"+processRatingHex(d.ratingSize)+"'></div><div class='full-hex size_"+d.ratingSize+"' data-rating='"+processRatingHex(d.ratingSize)+"' style='width:"+d.value/(d.ratingSize/10)*10+"%'></div></div><div class='status-completed-comptency'><div class='status-completed'><span class='countCompleted'>"+d.completedCount+"</span>/<span class='countTotal'>"+d.count+"</span></div><div class='evaluations'>"+evaluationText+"</div></div></div>")}).on("mouseout",function(d){d3.select(".x-"+d.className).classed("hovered",!1),divTooltip.style("display","none")}).attr("height",0).transition().duration(300).delay(function(d,i){return 300*i}).attr("y",function(d,i){return y(d.value)}).attr("height",function(d,i){return height-y(d.value)})};scope.$watchCollection("[data,filter,views]",function(newValue,oldValue){if(void 0!==scope.data&&scope.data.length){var increment=desktop?6:3,data=angular.copy(scope.data),start=scope.views*increment,end=(scope.views+1)*increment;if(end>data.length){var last=end-data.length;start-=last,start<0&&(start=0),end-=last}data=data.slice(start,end),barChartCreation(svg,data,scope.filter,scope.colors,scope.ratingSize)}},!0)}}}]);