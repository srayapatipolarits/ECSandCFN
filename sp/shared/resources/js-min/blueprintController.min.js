function bluePrintController($scope,ajaxService,$localStorage,$state,sharedProperties,$q,$filter,$rootScope,ngDialog,$timeout){function openFeedbackPanel(){var tempObj={id:vm.blueprint.id,name:"Blueprint",parentId:null,parentName:"Performance",feature:"Blueprint"};sharedProperties.setFeedbackObjectForPanel(tempObj),tempObj=null}function setContentReference(obj,type){var tempObj={data:obj,type:type};sharedProperties.setContentReference(tempObj),tempObj=null}function openState(number,text){vm.winWidth>767?(vm.devStrategy.id="",vm.state(number)):(vm.devStrategy.id="",vm.openNgOverlay(text))}function openNgOverlay(page,data){void 0!==data&&(vm.devStrategy={id:"",desc:data.desc}),vm.currentActive.goalId=vm.blueprint.id,vm.winHeight=$(window).height()+100+"px";ngDialog.open({template:vm.pageTempaltes[page],className:"ngdialog-lnd-theme",scope:$scope})}function editModeCheck(obj,togglekey,index,scrollToOpt){vm.editModeEnabled&&(void 0===index?obj[togglekey]=!obj[togglekey]:obj[togglekey][index].value=!obj[togglekey][index].value,vm.editModeEnabled=!1),void 0!==scrollToOpt&&$timeout(function(){$("html,body").animate({scrollTop:$("#"+scrollToOpt.id+"_"+scrollToOpt.index+"_"+scrollToOpt.child).offset().top-($(window).width()<1024?0:80)},300)},200)}function viewDirect(count){switch(count=void 0===count?"EDIT":count){case"EDIT":"user"===vm.mode?$state.go("create"):vm.bpNav="create";break;case"UNDER_APPROVAL":case"APPROVED":"user"===vm.mode?$state.go("approvalRequest"):vm.bpNav="approval";break;case"PUBLISHED":"user"===vm.mode?$state.go("publish"):vm.bpNav="publish"}vm.createScreenReady=!0}function getBluePrint(mode){vm.mode=mode,ajaxService.getAjaxResponse({url:vm.config.getBluePrint,data:$.param({memberEmail:$rootScope.noSelf})}).then(function(response){"true"===response.Success?(void 0!==response.blueprintSettings?(vm.bluePrintSetting=response.blueprintSettings,vm.dataMap=vm.bluePrintSetting.dataMap,$localStorage.set("bluePrintSetting",vm.bluePrintSetting),vm.viewDirect(vm.blueprint.status),vm.showIt=!0):createDevloop(response),$(".lnd-left-sec-stick").stick_in_parent(),$timeout(function(){"PUBLISHED"===vm.blueprint.status?vm.setContentReference({title:"Mission Statement",description:vm.blueprint.missionStatement.text},"Blueprint_Published"):vm.setContentReference({title:"Blueprint",description:$rootScope.pullInterNationalization("dashboard.publicchannel.description.blueprint")},"Blueprint_NotPublished"),$("html,body").animate({scrollTop:0},300)},1e3)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function createDevloop(response){vm.blueprint=response.blueprint,vm.saveObject=angular.copy(vm.blueprint),vm.getBluePrintSetting()}function addObjective(devStrategy,scrollToOpt){if(!angular.isArray(devStrategy.devStrategyActionCategoryList)&&(devStrategy.devStrategyActionCategoryList=[]),vm.bluePrintSetting.maxObjectives<=devStrategy.devStrategyActionCategoryList.length||!vm.editModeEnabled)return!1;devStrategy.devStrategyActionCategoryList.push({title:null}),void 0!==scrollToOpt&&$timeout(function(){$("html,body").animate({scrollTop:$("#"+scrollToOpt.id+"_"+scrollToOpt.index).offset().top-($(window).width()<1024?0:80)},300),$(".lnd-left-sec-stick").stick_in_parent()},200),vm.editModeEnabled=!1}function addKeyInitiative(devStrategy,scrollToOpt,toggle){if(!angular.isArray(devStrategy.actionList)&&(devStrategy.actionList=[]),vm.bluePrintSetting.maxInitiatives<=devStrategy.actionList.length)return!1;devStrategy.actionList.push({title:null,actionData:[{title:null}]}),vm.editModeEnabled=!1,void 0!==toggle&&(toggle.value=!toggle.value),void 0!==scrollToOpt&&$timeout(function(){$("html,body").animate({scrollTop:$("#"+scrollToOpt.id+"_"+scrollToOpt.index+"_"+scrollToOpt.child).offset().top-($(window).width()<1024?0:80)},300),$(".lnd-left-sec-stick").stick_in_parent()},200)}function addCriticalSuccessMeasure(actionList,scrollToOpt,toggle){if(!angular.isArray(actionList.actionData)&&(actionList.actionData=[]),vm.bluePrintSetting.maxSuccessMeasures<=actionList.actionData.length)return!1;actionList.actionData.push({title:null}),vm.editModeEnabled=!1,void 0!==toggle&&(toggle.value=!toggle.value),void 0!==scrollToOpt&&$timeout(function(){$("html,body").animate({scrollTop:$("#"+scrollToOpt.id+"_"+scrollToOpt.parent+"_"+scrollToOpt.index+"_"+scrollToOpt.child).offset().top-($(window).width()<1024?0:80)},300),$(".lnd-left-sec-stick").stick_in_parent()},200)}function getBluePrintSetting(){var settings=$localStorage.get("bluePrintSetting");null!==settings?(vm.bluePrintSetting=settings,vm.dataMap=vm.bluePrintSetting.dataMap,vm.viewDirect(vm.blueprint.status)):ajaxService.getAjaxResponse({url:vm.config.bluePrintSetting}).then(function(response){"true"===response.Success?(vm.bluePrintSetting=response.blueprintSettings,vm.dataMap=vm.bluePrintSetting.dataMap,$localStorage.set("bluePrintSetting",vm.bluePrintSetting),vm.viewDirect(vm.blueprint.status)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function revertToPreviousState(){vm.blueprint=angular.copy(vm.saveObject),vm.bluePrintform.submitted=!1,$("html,body").animate({scrollTop:$(".lnd-right-sec").offset().top-20},300)}function assignKeyWord(option1){option1.key1 in option1.obj1?option1.obj1[option1.key1][option1.index1]={value:option1.value}:(option1.obj1[option1.key1]=[],option1.obj1[option1.key1][option1.index1]={value:option1.value})}function deleteModel(){switch(vm.deleteList.push(vm.saveDeleteOption.delete[vm.saveDeleteOption.index].uid),vm.saveDeleteOption.key){case"objective":vm.saveDeleteOption.obj[vm.saveDeleteOption.key].splice(vm.saveDeleteOption.index,1),vm.saveDeleteOption.delete.splice(vm.saveDeleteOption.index,1),null!==vm.saveObject.devStrategyActionCategoryList&&vm.saveAndUpdate();break;case"initiative":vm.saveDeleteOption.obj[vm.saveDeleteOption.key].splice(vm.saveDeleteOption.index,1),vm.saveDeleteOption.delete.splice(vm.saveDeleteOption.index,1);break;case"csm":vm.saveDeleteOption.delete.splice(vm.saveDeleteOption.index,1)}vm.editModeEnabled=!0,vm.saveDeleteOption=null,ngDialog.close("ngdialog1")}function deleteEmptyObjective(options){vm.saveDeleteOption=options,vm.bluePrintform.submitted=!1,vm.deleteModel()}function deleteObjective(options){vm.saveDeleteOption=options,ngDialog.open({template:"/sp/resources/html/blueprint/delete-modal.html",scope:$scope}).closePromise.then(function(data){vm.saveDeleteOption=null,vm.editModeEnabled=!0})}function saveAndUpdate(toggle,togglekey,index){vm.bluePrintform.submitted=!1,vm.bluePrintform.$valid?(vm.blueprintRequest={},vm.blueprintRequest.missionStatement=vm.blueprint.missionStatement,void 0!==vm.blueprintRequest.missionStatement.commentsList&&delete vm.blueprintRequest.missionStatement.commentsList,vm.blueprintRequest.devStrategyActionCategoryList=vm.blueprint.devStrategyActionCategoryList,angular.isArray(vm.blueprintRequest.devStrategyActionCategoryList)&&vm.blueprintRequest.devStrategyActionCategoryList.filter(function(e){void 0!==e.commentsList&&delete e.commentsList,angular.isArray(e.actionList)&&e.actionList.filter(function(e1){void 0!==e1.commentsList&&delete e1.commentsList})}),vm.blueprintRequest.deleteList=vm.deleteList,ajaxService.getAjaxResponse({url:vm.config.createUpdate,data:vm.blueprintRequest,headers:{"Content-Type":"application/json"}}).then(function(response){"true"===response.Success?(void 0!==toggle&&(void 0===index?toggle[togglekey]=!0:toggle[togglekey][index].value=!0),vm.editModeEnabled=!0,vm.blueprint=response.blueprint,vm.saveObject=angular.copy(vm.blueprint),vm.deleteList=[],vm.showIt=!1,$("html,body").animate({scrollTop:$(".lnd-right-sec").offset().top-20},300),sharedProperties.growlMessage($rootScope.pullInterNationalization("blueprint.updated")),sharedProperties.fireAnalyticsEvent("Blueprint | Save or Update Information","N/A")):null!==response.error&&(vm.blueprint=angular.copy(vm.saveObject),vm.editModeEnabled=!0,sharedProperties.ajaxError(response.error))})):vm.bluePrintform.submitted=!0}function getMemberList(state,publish){ajaxService.getAjaxResponse({url:vm.config.allUsers}).then(function(response){if("true"===response.Success){if(vm.emailMemberList=response.allMembers,null!==$localStorage.get("loggegdInProfile"))for(var i=0;i<vm.emailMemberList.length;i++)if(vm.emailMemberList[i].email===$localStorage.get("loggegdInProfile").member.email){vm.emailMemberList.splice(i,1);break}void 0!==state&&(void 0!==publish?shareApprovalModal(state):publishShareModal(state))}else sharedProperties.ajaxError(response.error)})}function loadTags(query){var deferred=$q.defer(),result=vm.emailMemberList.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise}function tagAdded(tag){void 0!==tag&&(vm.searchTag.push(tag.email),vm.searchTagEmail.push(tag),vm.inputRequired=!1)}function tagRemoved(tag){vm.searchTag.splice(vm.searchTag.indexOf(tag.email),1),vm.searchTagEmail.splice(vm.searchTagEmail.indexOf(tag),1)}function callshareApproval(state){vm.inputRequired=!1,vm.emailMemberList.length?shareApprovalModal(state):vm.getMemberList(state,"publish")}function shareApprovalModal(state){vm.winHeight=$(window).height()+100+"px";var templateUrl=$(window).width()<768?"/sp/resources/html/blueprint/shareApproval_mobile.html":"/sp/resources/html/blueprint/shareApproval.html";vm.approvalState=state,ngDialog.open({template:templateUrl,scope:$scope,className:$(window).width()<768?"ngdialog-lnd-theme":"ngdialog-theme-default"}).closePromise.then(function(data){vm.searchTag=[],vm.searchTagEmail=[],vm.shareApproval.comment=null})}function shareApprovalFn(){if(vm.shareApproval.submitted=!1,void 0===vm.searchTagEmail[0])return void(vm.inputRequired=!0);if(vm.shareApprovalForm.$valid){var obj={};obj=void 0!==vm.searchTagEmail[0].id?{userIdList:[vm.searchTagEmail[0].id],approvalRequest:vm.approvalState,comment:vm.shareApproval.comment,showProgress:!1}:{externalUserList:[{firstName:vm.searchTagEmail[0].firstName,lastName:vm.searchTagEmail[0].lastName,email:vm.searchTagEmail[0].email}],approvalRequest:vm.approvalState,comment:vm.shareApproval.comment,showProgress:!1},ajaxService.getAjaxResponse({url:vm.config.shareBluePrint,data:obj,headers:{"Content-Type":"application/json"}}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),sharedProperties.growlMessage(vm.approvalState?$rootScope.pullInterNationalization("blueprint.requestforapproval"):$rootScope.pullInterNationalization("blueprint.shareforreview")),vm.approvalState?sharedProperties.fireAnalyticsEvent("Blueprint | Request for Approval","N/A"):sharedProperties.fireAnalyticsEvent("Blueprint | Send for Review Feedback","N/A"),vm.approvalState&&$timeout(function(){window.location.reload()},1e3)):null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})}else vm.shareApproval.submitted=!0}function sendReminder(){ajaxService.getAjaxResponse({url:vm.config.sendReminder}).then(function(response){"true"===response.Success?(sharedProperties.growlMessage($rootScope.pullInterNationalization("blueprint.remindersent")),sharedProperties.fireAnalyticsEvent("Blueprint | Send Reminder","N/A")):null!==response.error&&sharedProperties.ajaxError(response.error)})}function carModal(){vm.winHeight=$(window).height()+100+"px";var templateUrl=$(window).width()<768?"/sp/resources/html/blueprint/car_mobile.html":"/sp/resources/html/blueprint/car.html";ngDialog.open({template:templateUrl,scope:$scope,className:$(window).width()<768?"ngdialog-lnd-theme":"ngdialog-theme-default"}).closePromise.then(function(data){vm.cancelApproval.carComment=null})}function car(comment){vm.cancelApproval.submitted=!1,vm.cancelApprovalForm.$valid?ajaxService.getAjaxResponse({url:vm.config.car,data:$.param({comment:vm.cancelApproval.carComment})}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("blueprint.cancelApprovalMessage")),sharedProperties.fireAnalyticsEvent("Blueprint | Cancel Approval Request","N/A"),$timeout(function(){window.location.reload()},1e3)):null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))}):vm.cancelApproval.submitted=!0}function getShareDetails(){var id=extractIdFromUrl();ajaxService.getAjaxResponse({url:vm.config.shareBlueprint+"?feedbackUserId="+id}).then(function(response){"true"===response.Success?(vm.blueprint=response.blueprint,vm.saveObject=angular.copy(vm.blueprint),vm.blueprintMember=response.member,vm.fullResponse=response,vm.createScreenReady=!0,vm.dataMap=response.blueprintSettings.dataMap):null!==response.error&&sharedProperties.ajaxError(response.error)})}function saveShareResponse(copy,from){angular.copy(from)}function submitComments(approved,feedback){vm.shareCommentList.approved=approved,vm.shareCommentList.feedbackUserId=extractIdFromUrl(),vm.shareCommentList.id=vm.blueprint.id,null!==vm.blueprint.missionStatement.commentsList&&vm.blueprint.missionStatement.commentsList.length&&(vm.shareCommentList.commentsMap[vm.blueprint.missionStatement.uid]=angular.isArray(vm.blueprint.missionStatement.commentsList)?vm.blueprint.missionStatement.commentsList[0].comment:vm.blueprint.missionStatement.commentsList),angular.isArray(vm.blueprint.devStrategyActionCategoryList)&&vm.blueprint.devStrategyActionCategoryList.filter(function(e){null!==e.commentsList&&e.commentsList.length&&(vm.shareCommentList.commentsMap[e.uid]=angular.isArray(e.commentsList)?e.commentsList[0].comment:e.commentsList),angular.isArray(e.actionList)&&e.actionList.filter(function(e1){null!==e1.commentsList&&e1.commentsList.length&&(vm.shareCommentList.commentsMap[e1.uid]=angular.isArray(e1.commentsList)?e1.commentsList[0].comment:e1.commentsList)})}),ajaxService.getAjaxResponse({url:vm.config.shareResponse,data:vm.shareCommentList,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)sharedProperties.fireAnalyticsEvent(approved?"Blueprint | Approved":feedback?"Blueprint | Shared":"Blueprint | Requested to revise","N/A"),window.location.href=approved?"/sp/processToken/blueprint/thankYouApproval":feedback?"/sp/processToken/blueprint/thankYouShare":"/sp/processToken/blueprint/thankYouRevise";else if(null!==response.error){vm.shareCommentList={commentsMap:{}};var errorMessage="";for(var key in response.error)errorMessage=response.error[key];switch(errorMessage){case"User is required.":window.location.href="/?status=404";break;case"Request has already been submitted.":window.location.href="/?status=blueprintRequestSubmitted";break;default:sharedProperties.ajaxError(response.error)}}})}function deleteComment(option,deleteStatement,index){if(""!==$rootScope.noSelf)return!1;ajaxService.getAjaxResponse({url:vm.config.deleteComment,data:$.param({uid:option.uid,by:option.by})}).then(function(response){"true"===response.Success?(sharedProperties.fireAnalyticsEvent("Blueprint | Delete Comment","N/A"),deleteStatement.splice(index,1)):null!==response.error&&(vm.shareCommentList={commentsMap:{}},sharedProperties.ajaxError(response.error))})}function deleleFeedback(uid,deleteStatement,index){ajaxService.getAjaxResponse({url:vm.config.deleteFeedback,data:$.param({uid:uid})}).then(function(response){"true"===response.Success?(sharedProperties.fireAnalyticsEvent("Blueprint | Delete Feedback","N/A"),deleteStatement.splice(index,1)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function viewfeedbackReceived(){vm.blueprint.newFeedbackReceivedCount&&ajaxService.getAjaxResponse({url:vm.config.viewedFeedback}).then(function(response){"true"===response.Success?(vm.blueprint.newFeedbackReceivedCount=0,sharedProperties.fireAnalyticsEvent("Blueprint | Viewed Feedback","N/A")):null!==response.error&&sharedProperties.ajaxError(response.error)})}function publishModal(){ngDialog.open({template:"/sp/resources/html/blueprint/publishModal.html",scope:$scope})}function cancelApprovalModal(){ngDialog.open({template:"/sp/resources/html/blueprint/cancelApprovalModal.html",scope:$scope})}function cancelEditModal(){ngDialog.open({template:"/sp/resources/html/blueprint/cancelEditModal.html",scope:$scope})}function cancelPublishModal(){ngDialog.open({template:"/sp/resources/html/blueprint/cancelPublishModal.html",scope:$scope})}function publish(){ajaxService.getAjaxResponse({url:vm.config.publish}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("blueprint.publishMessage")),sharedProperties.fireAnalyticsEvent("Blueprint | Publish","N/A"),$timeout(function(){window.location.reload()},1e3)):null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})}function cancelEdit(){ajaxService.getAjaxResponse({url:vm.config.cancelEdit}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),sharedProperties.fireAnalyticsEvent("Blueprint | Cancel Reissue","N/A"),$timeout(function(){window.location.reload()},1e3)):null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})}function cancelPublish(){ajaxService.getAjaxResponse({url:vm.config.cancelPublish}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),sharedProperties.fireAnalyticsEvent("Blueprint | Reissue","N/A"),$timeout(function(){window.location.reload()},1e3)):null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})}function cancelApproval(){ajaxService.getAjaxResponse({url:vm.config.cancelApproval}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),$timeout(function(){window.location.reload()},1e3)):null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})}function stateControl(list){return!!list.actionData.filter(function(e){return e.permissions.Completion&&!e.completed}).length}function changeStatus(option,action){if(""!==$rootScope.noSelf)return!1;ajaxService.getAjaxResponse({url:vm.config.completeMeasure,data:$.param({uid:option.uid,isComplete:option.completed})}).then(function(response){"true"===response.Success?(action.completed=option.completed,sharedProperties.fireAnalyticsEvent("Blueprint | Complete a critical success measure",option.completed)):null!==response.error&&(action.completed=!option.completed,sharedProperties.ajaxError(response.error))})}function state(count){vm.currentActive.goalId=vm.blueprint.id,vm.devStrategy={id:"",desc:null},$state.go("publish")}function developmentRedirect(options){vm.devStrategy={id:options.devStrategyId,desc:options.desc},vm.state(options.state)}function updateModel(content){vm.updateNoteObj.submitted=!1,vm.tempModel=content}function deleteActivate(options){ngDialog.closeAll()}function deletePop(options){vm.saveDeleteOptions=options,ngDialog.open({template:vm.config.deleteDialog,scope:$scope}).closePromise.then(function(data){vm.saveDeleteOptions=null})}function viewDetails(group){vm.viewDetailsListIndex=group,vm.viewDetailsList=group in vm.allNotesFeedbackData?vm.allNotesFeedbackData[group]:null;var $enableSCroll=$(".overflow-enable");$enableSCroll.length&&$enableSCroll.scrollTop(0)}function viewDetailsIndexChange(i){i===vm.openTabId?vm.openTabId=-1:vm.openTabId=i}function tagAddedGoal(tag){void 0!==tag.email&&(vm.searchTagGoal.push(tag.email),vm.inputRequired=!1)}function tagRemovedGoal(tag){vm.searchTagGoal.splice(vm.searchTagGoal.indexOf(tag.email),1)}function tagAddedPublish(tag){void 0!==tag.email&&(void 0!==tag.id?vm.searchTagPublishShareInternal.push(tag.id):vm.searchTagPublishShareExternal.push({email:tag.email}),vm.inputPublishRequired=!1)}function tagRemovedPublish(tag){void 0!==tag.id?vm.searchTagPublishShareInternal.splice(vm.searchTagPublishShareInternal.indexOf(tag.id),1):sharedProperties.spilceIndexWithBreak(vm.searchTagPublishShareExternal,"email",tag.email)}function callPublishShareModal(state){vm.emailMemberList.length?publishShareModal(state):vm.getMemberList(state)}function publishShareModal(state){vm.winHeight=$(window).height()+100+"px";var templateUrl=$(window).width()<768?"/sp/resources/html/blueprint/publishshareApproval_mobile.html":"/sp/resources/html/blueprint/publishshareApproval.html";vm.approvalState=state,vm.progress=!1,ngDialog.open({template:templateUrl,scope:$scope,className:$(window).width()<768?"ngdialog-lnd-theme":"ngdialog-theme-default"}).closePromise.then(function(data){vm.approvalState=null,vm.searchTagPublishShareExternal=[],vm.searchTagPublishShareInternal=[],vm.shareApproval.comment=null,vm.inputPublishRequired=!1})}function publishShare(showProgress){if(vm.shareApproval.submitted=!1,0===vm.searchTagPublishShareInternal.length&&0===vm.searchTagPublishShareExternal.length)return void(vm.inputPublishRequired=!0);if(vm.shareApprovalForm.$valid){var obj={};obj={userIdList:vm.searchTagPublishShareInternal,externalUserList:vm.searchTagPublishShareExternal,approvalRequest:vm.approvalState,comment:vm.shareApproval.comment,showProgress:showProgress},ajaxService.getAjaxResponse({url:vm.config.publishShare,data:obj,headers:{"Content-Type":"application/json"}}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),sharedProperties.growlMessage(vm.approvalState?$rootScope.pullInterNationalization("blueprint.requestforapproval"):$rootScope.pullInterNationalization("blueprint.shareforreference")),sharedProperties.fireAnalyticsEvent("Blueprint | Shared","N/A"),vm.approvalState&&$timeout(function(){window.location.reload()},1e3)):null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})}else vm.shareApproval.submitted=!0}function getPublishShareDetails(){var id=extractIdFromUrl();ajaxService.getAjaxResponse({url:vm.config.publishGetShareDetail+"?feedbackUserId="+id}).then(function(response){"true"===response.Success?(vm.blueprint=response.blueprint,vm.saveObject=angular.copy(vm.blueprint),vm.blueprintMember=response.member,vm.fullResponse=response,vm.dataMap=response.blueprintSettings.dataMap):null!==response.error&&sharedProperties.ajaxError(response.error)})}function previewLink(mode,url){if("Video"===mode||"VIDEO"===mode)sharedProperties.videoPopUp(url);else{window.open(url,"_blank").focus()}}var vm=this;vm.config={bluePrintSetting:"/sp/blueprint/getSettings",getBluePrint:"/sp/blueprint/get",createUpdate:"/sp/blueprint/createOrUpdate",shareBluePrint:"/sp/blueprint/share",allUsers:"/sp/allUsers",sendReminder:"/sp/blueprint/sendReminder",car:"/sp/blueprint/cancelApprovalRequest",shareBlueprint:"/sp/blueprint/share/details",shareResponse:"/sp/blueprint/share/response",deleteComment:"/sp/blueprint/deleteComment",viewedFeedback:"/sp/blueprint/viewedFeedbackMessages",publish:"/sp/blueprint/publish",cancelPublish:"/sp/blueprint/cancelPublish",cancelApproval:"/sp/blueprint/cancelApproval",cancelEdit:"/sp/blueprint/cancelEdit",completeMeasure:"/sp/blueprint/completeSuccessMeasure",deleteDialog:"/sp/resources/html/blueprint/deleteNoteDialog.html",publishShare:"/sp/blueprint/publishShare",publishGetShareDetail:"/sp/blueprint/share/getDetails",deleteFeedback:"/sp/blueprint/deleteFeedbackReceived"},vm.bluePrintSetting=null,vm.dataMap=null,vm.showIt=!1,vm.deleteList=[],vm.emailMemberList=[],vm.searchTag=[],vm.editObject={},vm.saveObject={},vm.blueprint={},vm.bluePrintform={submitted:!1},vm.shareApproval={submitted:!1,comment:null},vm.cancelApproval={submitted:!1,carComment:null},vm.shareCommentList={commentsMap:{}},vm.editModeEnabled=!0,vm.saveDeleteOption=null,vm.createScreenReady=!1,vm.inputRequired=!1,vm.inputPublishRequired=!1,vm.approvalState=null,vm.mode="user",vm.switchToMobile=parseInt($(window).width())<768,vm.blueprintMember=[],vm.allNotesFeedbackData=[],vm.masterAllNotesFeedbackData=[],vm.viewDetailsList=null,vm.viewDetailsListIndex=-1,vm.updateModel=updateModel,vm.postANote={submitted:!1},vm.feedRequired=!0,vm.requestFeedback={submitted:!1},vm.btnEnable=!0,vm.updateNoteFlag=!1,vm.devStrategy={id:"",desc:null},vm.updateNoteObj={submitted:!1},vm.btnEnable=!0,vm.searchTagGoal=[],vm.searchTagPublishShareInternal=[],vm.searchTagPublishShareExternal=[],vm.searchTagEmail=[],vm.inputRequired=!1,vm.pageSetting={searchText:"",disabledInfinite:!1,lastPredicate:"name",lastReverse:!1},vm.pageType="blueprint",vm.winWidth=$(window).width(),vm.winHeight=$(window).height()+100+"px",vm.currentActive={name:"",goalId:-1},vm.viewDirect=viewDirect,vm.getBluePrint=getBluePrint,vm.getBluePrintSetting=getBluePrintSetting,vm.saveAndUpdate=saveAndUpdate,vm.previewLink=previewLink,vm.addKeyInitiative=addKeyInitiative,vm.addCriticalSuccessMeasure=addCriticalSuccessMeasure,vm.addObjective=addObjective,vm.revertToPreviousState=revertToPreviousState,vm.assignKeyWord=assignKeyWord,vm.editModeCheck=editModeCheck,vm.deleteObjective=deleteObjective,vm.deleteModel=deleteModel,vm.getMemberList=getMemberList,vm.tagRemoved=tagRemoved,vm.loadTags=loadTags,vm.tagAdded=tagAdded,vm.shareApprovalFn=shareApprovalFn,vm.callshareApproval=callshareApproval,vm.sendReminder=sendReminder,vm.carModal=carModal,vm.car=car,vm.submitComments=submitComments,vm.saveShareResponse=saveShareResponse,vm.publishShare=publishShare,vm.callPublishShareModal=callPublishShareModal,vm.getShareDetails=getShareDetails,vm.deleteComment=deleteComment,vm.deleteFeedback=deleleFeedback,vm.viewfeedbackReceived=viewfeedbackReceived,vm.publish=publish,vm.publishModal=publishModal,vm.cancelApprovalModal=cancelApprovalModal,vm.cancelPublish=cancelPublish,vm.cancelPublishModal=cancelPublishModal,vm.cancelApproval=cancelApproval,vm.cancelEdit=cancelEdit,vm.cancelEditModal=cancelEditModal,vm.stateControl=stateControl,vm.changeStatus=changeStatus,vm.state=state,vm.developmentRedirect=developmentRedirect,vm.deleteActivate=deleteActivate,vm.deletePop=deletePop,vm.viewDetails=viewDetails,vm.tagRemovedGoal=tagRemovedGoal,vm.tagAddedGoal=tagAddedGoal,vm.viewDetailsIndexChange=viewDetailsIndexChange,vm.tagAddedPublish=tagAddedPublish,vm.tagRemovedPublish=tagRemovedPublish,vm.getPublishShareDetails=getPublishShareDetails,vm.deleteEmptyObjective=deleteEmptyObjective,vm.openNgOverlay=openNgOverlay,vm.openTabId,vm.activeToolTipId=-1,vm.openState=openState,vm.pageTempaltes={note:"/sp/resources/html/goals/addNoteResponsive.html",notification:"/sp/resources/html/goals/notesFeedbackOverlayResponsive.html",feedback:"/sp/resources/html/goals/requestFeedbackResponsive.html"},vm.bpNav="create",vm.setContentReference=setContentReference,vm.openFeedbackPanel=openFeedbackPanel;var extractIdFromUrl=function(){var url=window.location.pathname;return url.substring(url.lastIndexOf("/")+1)};$scope.$on("modalClosed",function(){"PUBLISHED"===vm.blueprint.status?vm.setContentReference({title:"Mission Statement",description:vm.blueprint.missionStatement.text},"Blueprint_Published"):vm.setContentReference({title:"Blueprint",description:$rootScope.pullInterNationalization("dashboard.publicchannel.description.blueprint")},"Blueprint_NotPublished")})}angular.module("spApp").controller("bluePrintController",bluePrintController),bluePrintController.$inject=["$scope","ajaxService","$localStorage","$state","sharedProperties","$q","$filter","$rootScope","ngDialog","$timeout"];