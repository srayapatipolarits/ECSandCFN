function profileListController($scope,ajaxService,$filter,$state,ngDialog,$timeout,sharedProperties,$rootScope,$localStorage){function getProfileData(){ajaxService.getAjaxResponse({url:vm.config.getProfileData,data:$.param({name:$localStorage.get("groupname")})}).then(function(response){if("true"===response.Success){var userRoles=null!==$localStorage.get("loggegdInProfile")?$localStorage.get("loggegdInProfile").member.roles:[];vm.hasCompetencyRole=-1!==userRoles.indexOf("CompetencyAdmin"),vm.listingView="ASSESSMENT",vm.profileList=response.groupInfo||[],vm.groupId=response.groupInfo.id,vm.responseRecieved=!0,vm.profileList.memberSummaryList.length&&vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse),vm.loadCompetencyDetails()}else if(null!=response.error){vm.responseRecieved=!0;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function loadCompetencyDetails(){vm.responseAvailableForCompetency=!1,ajaxService.getAjaxResponse({url:vm.config.getCompetencyListing,data:$.param({groupId:vm.groupId})}).then(function(response){if("true"===response.Success){vm.competencyList=response.competencyProfile,vm.competencyEvaluationInProgress=response.evaluationInProgress;for(var competencyUserMap={},competencyNameMap={},i=0;i<response.memberList.length;i++)competencyUserMap[response.memberList[i].userId]=response.memberList[i].competencyProfileId;for(var k=0;k<vm.competencyList.length;k++)competencyNameMap[vm.competencyList[k].id]=vm.competencyList[k].name;for(var j=0;j<vm.profileList.memberSummaryList.length;j++)vm.profileList.memberSummaryList[j].competencyProfileId=competencyUserMap[vm.profileList.memberSummaryList[j].id],vm.profileList.memberSummaryList[j].competencyProfileName=competencyNameMap[vm.profileList.memberSummaryList[j].competencyProfileId];null!==vm.profileList.groupLead&&(vm.profileList.groupLead.competencyProfileId=competencyUserMap[vm.profileList.groupLead.id],vm.profileList.groupLead.competencyProfileName=competencyNameMap[vm.profileList.groupLead.competencyProfileId]),vm.responseAvailableForCompetency=!0}else if(null!=response.error){vm.responseRecieved=!0;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function switchView(type){"status"===type?vm.listingView="ASSESSMENT":"reload"!==type&&"COMPETENCY"===vm.listingView||(vm.loadCompetencyDetails(),vm.listingView="COMPETENCY")}function assignCompetency(){vm.assignClick=!0,""!==vm.selectedCompetency&&ajaxService.getAjaxResponse({url:vm.config.assignCompetency,data:$.param({competencyProfileId:vm.selectedCompetency,memberIdList:vm.selectedUsersList.join()})}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.evaluationAssigned")}),vm.switchView("reload");else if(null!==response.error){ngDialog.close();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage}),vm.switchView("reload")}})}function removeCompetency(){ajaxService.getAjaxResponse({url:vm.config.removeCompetency,data:$.param({memberIdList:vm.selectedUsersList.join()})}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.evaluationRemoved")}),vm.switchView("reload");else if(null!==response.error){ngDialog.close();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage}),vm.switchView("reload")}})}function assignRemoveCompetencyModalSingle(obj,action){vm.assignClick=!1,vm.selectedCompetency="",vm.competencyAssignRemoveOptions=[],vm.selectedUsersList=[],vm.competencyActionType=action,vm.competencyAssignRemoveOptions.push(obj),vm.selectedUsersList.push(obj.userId),ngDialog.open({template:"/sp/resources/html/admin/competency/assign-remove-competency-groups.html",scope:$scope}).closePromise.then(function(data){vm.competencyActionType="MORE"})}function assignRemoveCompetencyModalMultiple(){if("MORE"!==vm.competencyActionType&&"GROUP_REMOVE"!==vm.competencyActionType){vm.assignClick=!1,vm.selectedCompetency="",vm.competencyAssignRemoveOptions=[],vm.selectedUsersList=[];for(var i=0;i<vm.pageSetting.userEmail.email.length;i++)vm.competencyAssignRemoveOptions.push(vm.pageSetting.userEmail.email[i]),vm.selectedUsersList.push(vm.pageSetting.userEmail.email[i].userId);ngDialog.open({template:"/sp/resources/html/admin/competency/assign-remove-competency-groups.html",scope:$scope}).closePromise.then(function(data){vm.competencyActionType="MORE"})}else"GROUP_REMOVE"===vm.competencyActionType&&vm.certainDelete()}function order(predicate,reverse){vm.pageSetting.lastPredicate=predicate,vm.pageSetting.lastReverse=reverse,vm.profileList.memberSummaryList=$filter("orderBy")(vm.profileList.memberSummaryList,vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)}function callGetAllMembers(){vm.pageSetting.oneTime&&(getAllMembers(),vm.pageSetting.oneTime=!1)}function getAllMembers(){ajaxService.getAjaxResponse({url:vm.config.getAllMembers}).then(function(response){if("true"===response.Success){var allMail=response.memberList;angular.forEach(allMail,function(val,index){(""===allMail[index].firstName&&""===allMail[index].lastName||void 0!==vm.profileList.groupLead&&null!==vm.profileList.groupLead&&allMail[index].email===vm.profileList.groupLead.email)&&delete allMail[index]}),allMail=$.grep(allMail,function(n){return n}),vm.fullEmailList=angular.copy(allMail),angular.forEach(vm.profileList.memberSummaryList,function(val,index){for(var i=0;i<allMail.length;i++)val.email===allMail[i].email&&allMail.splice(i,1)}),vm.allEmails=angular.copy(allMail)}})}function active(event,setting){vm.pageSetting.lastPredicate=setting.predicate,vm.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.pageSetting.lastPredicate),vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)}function assignGroupLead(){vm.callGetAllMembers(),vm.errorNotification.selectGroupLead=!1,ngDialog.open({template:vm.config.groupLeadDialog,scope:$scope})}function assignNewGroup(groupname,groupLeadEmailId){if(void 0===groupLeadEmailId||""===groupLeadEmailId)return vm.errorNotification.selectGroupLead=!0,!0;ajaxService.getAjaxResponse({url:vm.config.addMember,data:$.param({name:groupname,memberEmail:groupLeadEmailId,isGroupLead:!0})}).then(function(response){if("true"===response.Success){vm.listingView="ASSESSMENT",vm.profileList.groupLead=response.member;for(var i=0;i<vm.profileList.memberSummaryList.length;i++)if(vm.profileList.memberSummaryList[i].email===response.member.email){vm.profileList.memberSummaryList.splice(i,1);break}sharedProperties.spilceIndexWithBreak(vm.allEmails,"email",response.member.email),!vm.alltoggle&&(vm.negative=!1,vm.pageSetting.userEmail.email=[]),vm.negative&&vm.checkAll(),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.profile.updateMessage")})}else if(null!=response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function removeGroupLead(){ngDialog.open({template:vm.config.removeGroupLeadDialog,scope:$scope})}function removeGL(groupname,groupMemberEmail){var gEmail=groupMemberEmail;ajaxService.getAjaxResponse({url:vm.config.removeGroupLead,data:$.param({name:groupname,groupLeadEmail:gEmail})}).then(function(response){"true"===response.Success?(vm.pageSetting.oneTime=!0,vm.getProfileData(),vm.callGetAllMembers(),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.profile.removeGroupL")})):null!=response.error&&$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.profile.removeGroupLError")})})}function memberTakeAway(email,f){$localStorage.set("memEmail",email),!0===f&&$localStorage.set("spProfileTab",!0),window.location.href="/sp/admin/account/member/details?email="+email}function showFocus(event){var current=$(event.currentTarget).closest(".memprofile").find(".addMemberAnchor");$("html, body").animate({scrollTop:$(current).offset().top-50},"slow")}function actionToClear(){!vm.alltoggle&&(vm.negative=!1,vm.pageSetting.userEmail.email=[]),vm.negative&&vm.checkAll(),$rootScope.$broadcast("handleBroadcast")}function confirmDelete(event,member,groupLead){var email=member.email,eve=angular.element(event.currentTarget);groupLead=groupLead,ajaxService.getAjaxResponse({url:vm.config.removeMember,data:$.param({name:vm.profileList.name,memberEmail:email,isGroupLead:groupLead})}).then(function(response){if("true"===response.Success){if(groupLead)vm.allEmails.push(vm.profileList.groupLead),vm.profileList.groupLead=null;else for(var i=0;i<vm.profileList.memberSummaryList.length;i++)if(vm.profileList.memberSummaryList[i].email===email){vm.allEmails.push(vm.profileList.memberSummaryList[i]),vm.profileList.memberSummaryList.splice(i,1);break}eve.scope().moreadvance=!eve.scope().moreadvance,$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.profile.deleteMessage")}),!vm.alltoggle&&(vm.negative=!1,vm.pageSetting.userEmail.email=[]),vm.negative&&vm.checkAll()}else if(null!=response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function certainDelete(){vm.callGetAllMembers(),ngDialog.open({template:vm.config.certainDeleteDialog,scope:$scope}).closePromise.then(function(data){vm.competencyActionType="MORE"})}function deleteUsers(emails){var emailList=[];$.each(emails,function(i,j){emailList.push(emails[i].email)});var options={url:vm.config.removeMember,data:$.param({memberEmail:emailList.toString(),name:vm.profileList.name})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){if(emails.length){var copyArea=angular.copy(vm.profileList.memberSummaryList);angular.forEach(vm.profileList.memberSummaryList,function(val,index){for(var i=0;i<emails.length;i++)val.email===emails[i].email&&(vm.allEmails.push(vm.profileList.memberSummaryList[index]),delete copyArea[index])}),vm.profileList.memberSummaryList=$.grep(copyArea,function(n){return n}),void 0!==vm.profileList.groupLead&&null!==vm.profileList.groupLead&&-1!==emailList.indexOf(vm.profileList.groupLead.email)&&(vm.allEmails.push(vm.profileList.groupLead),vm.profileList.groupLead=null),ngDialog.close("ngdialog1"),vm.pageSetting.userEmail.email=[],!vm.alltoggle&&(vm.negative=!1,vm.pageSetting.userEmail.email=[]),vm.negative&&vm.checkAll(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.profile.deleteMessage")})}}else if(null!=response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function checkAll(){vm.checkedAll=!vm.checkedAll,vm.negative?(vm.pageSetting.userEmail.email=vm.profileList.memberSummaryList.map(function(item){return{userId:item.id,email:item.email,name:item.name,title:item.title}}),vm.profileList.groupLead&&vm.pageSetting.userEmail.email.push({userId:vm.profileList.groupLead.id,email:vm.profileList.groupLead.email,name:vm.profileList.groupLead.name,title:vm.profileList.groupLead.title})):vm.pageSetting.userEmail.email=[]}function countLead(){return vm.profileList.groupLead?1:0}function renamePopup(){vm.errornewGroup=!1,vm.errornewEmptyGroup=!1,ngDialog.open({template:vm.config.renameGroupDialog,scope:$scope}),vm.newGroupSelector=vm.profileList.name}function renameGroup(savetosave,oldname){return""===savetosave?(vm.errornewEmptyGroup=!0,!0):savetosave===oldname?(ngDialog.close("ngdialog1"),!0):void ajaxService.getAjaxResponse({url:vm.config.updateName,data:$.param({name:savetosave,oldName:oldname})}).then(function(response){"true"===response.Success?(vm.profileList.name=savetosave,$localStorage.set("groupname",savetosave),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.profile.updateGroupNameMessage")})):null!=response.error&&(vm.errornewGroup=!0)})}function deletePopup(){ngDialog.open({template:vm.config.deleteGroupDialog,scope:$scope})}function deleteFullGroup(groupname){ajaxService.getAjaxResponse({url:vm.config.deleteGroup,data:$.param({name:groupname})}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$localStorage.remove("groupname"),$state.go("group");else if(null!=response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function allEmailPop(){var mailtoAll=vm.profileList.memberSummaryList.map(function(item){return{userId:item.id,email:item.email,name:item.name,title:item.title}});vm.profileList.groupLead&&mailtoAll.push({userId:vm.profileList.groupLead.id,email:vm.profileList.groupLead.email,name:vm.profileList.groupLead.name,title:vm.profileList.groupLead.title}),mailtoAll.length&&$rootScope.notificationEmailPoP(mailtoAll)}function checkUncheck(){vm.alltoggle=!1,vm.checkedAll&&(vm.negative=!vm.negative,vm.checkedAll=!vm.checkedAll)}function resetCounter(name,value){vm.pageSetting=angular.copy(vm.originalpageSetting);var curr=$(".profileHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")}var vm=this;vm.profileList=[],vm.fullEmailList=[],vm.allEmails=[],vm.checkedAll=!1,vm.negative=!1,vm.alltoggle=!1,vm.responseRecieved=!1,vm.listingView="ASSESSMENT",vm.competencyList=[],vm.competencyEvaluationInProgress=!1,vm.competencyActionType="MORE",vm.selectedCompetency="",vm.assignClick=!1,vm.competencyAssignRemoveOptions=[],vm.selectedUsersList=[],vm.responseAvailableForCompetency=!1,vm.hasCompetencyRole=!1,vm.groupId="",vm.config={getProfileData:"/sp/admin/group/groupDetails",getAllMembers:"/sp/admin/member",addMember:"/sp/admin/group/addMember",groupLeadDialog:"/sp/admin/group/assignGroupLead",removeGroupLeadDialog:"/sp/admin/group/removeGroupLead",removeGroupLead:"/sp/admin/group/removeGroupLead",removeMember:"/sp/admin/group/removeMember",certainDeleteDialog:"/sp/admin/member/deleteConfirmationGrp",renameGroupDialog:"/sp/admin/group/renameGroup",updateName:"/sp/admin/group/updateName",deleteGroupDialog:"/sp/admin/group/deleteGroup",deleteGroup:"/sp/admin/group/delete",getCompetencyListing:"/sp/admin/competency/getUserCompetency",assignCompetency:"/sp/admin/competency/assignCompetency",removeCompetency:"/sp/resources/html/admin/manage-account/account-admin-deleteSingle.html"},vm.pageSetting={pageSize:10,intialPageSize:10,userEmail:{email:[]},lastPredicate:"user.name",lastReverse:!1,textSearching:"",disabledInfinite:!1,checkedAll:!1,oneTime:!0},vm.originalpageSetting=angular.copy(vm.pageSetting),vm.errorNotification={errornewGroup:!1,errornewEmptyGroup:!1,selectGroupLead:!1},vm.getProfileData=getProfileData,vm.order=order,vm.callGetAllMembers=callGetAllMembers,vm.active=active,vm.assignGroupLead=assignGroupLead,vm.assignNewGroup=assignNewGroup,vm.removeGroupLead=removeGroupLead,vm.removeGL=removeGL,vm.memberTakeAway=memberTakeAway,vm.showFocus=showFocus,vm.confirmDelete=confirmDelete,vm.certainDelete=certainDelete,vm.renamePopup=renamePopup,vm.deletePopup=deletePopup,vm.deleteUsers=deleteUsers,vm.actionToClear=actionToClear,vm.checkAll=checkAll,vm.countLead=countLead,vm.renameGroup=renameGroup,vm.deleteFullGroup=deleteFullGroup,vm.allEmailPop=allEmailPop,vm.checkUncheck=checkUncheck,vm.resetCounter=resetCounter,vm.switchView=switchView,vm.loadCompetencyDetails=loadCompetencyDetails,vm.assignCompetency=assignCompetency,vm.removeCompetency=removeCompetency,vm.assignRemoveCompetencyModalSingle=assignRemoveCompetencyModalSingle,vm.assignRemoveCompetencyModalMultiple=assignRemoveCompetencyModalMultiple,function(){null!==$localStorage.get("spProfileTab")&&$localStorage.remove("spProfileTab")}()}angular.module("spApp").controller("profileListController",profileListController),profileListController.$inject=["$scope","ajaxService","$filter","$state","ngDialog","$timeout","sharedProperties","$rootScope","$localStorage"];