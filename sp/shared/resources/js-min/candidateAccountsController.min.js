function candidateAccountsController($scope,$element,$attrs,$http,ngDialog,$timeout,ajaxService,sharedProperties,$localStorage,$rootScope){function updateRemainingDays(days){var totalMonths=Math.floor(days/30),totalDays=days%30;return totalMonths>=1?totalMonths+" Months "+totalDays+" Days":"0 Months "+totalDays+" Days"}function processCredit(){_this.creditErrors=null,_this.creditFormSubmit=!1,_this.creditSubmitErrors=!1,_this.addCreditForm.$valid?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addCredit",data:$.param({accountId:_this.accountId,chargeAmount:_this.creditInfo.amount,paymentType:_this.creditInfo.cpt,comment:_this.creditInfo.ccomment,spPlanType:_this.currentPlanInfo.planType})}).then(function(response){if("true"===response.Success)_this.getAccountInfo(!0),_this.currentPlanInfo={},ngDialog.close("ngdialog1"),sharedProperties.growlMessage($rootScope.pullInterNationalization("billing.amoutcred"));else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response[key];_this.creditSubmitErrors=!0,_this.creditErrors=errorMessage}}):_this.creditFormSubmit=!0}function showAddCredit(planType){_this.creditFormSubmit=!1,_this.creditInfo={},_this.currentPlanInfo={planType:planType,term:_this.planDetails[planType].agreementTerm,paymentType:_this.planDetails[planType].paymentType,expiry:_this.planDetails[planType].planInfo.expiresTime,balance:_this.planDetails[planType].creditBalance},ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/addCreditsBilling.html",scope:$scope})}function addCreditPop(page){$scope.acPageType=page,$scope.creditInfo={},$scope.creditInfo.cpt=$scope.account.account.paymentInstrument.paymentType,$scope.creditInfo.ccomment=$scope.account.account.paymentInstrument.comment,$scope.serverError=!1,$scope.serverErrorMsg=null,ngDialog.open({template:"/sp/resources/html/admin/account/addcreditspop.html",scope:$scope})}function toggleHiringOverrideField(type){"Candidate"===type?(!1===_this.candidateOverrideCheckbox?(_this.candidateOverrideCheckbox=!0,_this.signup.candidatePrice=_this.editSignup.candidatePrice):(_this.candidateOverrideCheckbox=!1,_this.signup.overrideCandidateAmount=""),_this.updateHiringAccountSummary("Candidate")):"Bundle"===type?(!1===_this.bundleOverrideCheckbox?(_this.bundleOverrideCheckbox=!0,_this.signup.bundlePrice=_this.editSignup.candidatePrice*_this.hiringBundle):(_this.byndleOverrideCheckbox=!1,_this.signup.overrideBundleAmount=""),_this.updateHiringAccountSummary("Bundle")):(!1===_this.hiringAdminOverrideCheckbox?(_this.hiringAdminOverrideCheckbox=!0,_this.signup.hiringAdminPrice=_this.editSignup.hiringAdminPrice):(_this.hiringAdminOverrideCheckbox=!1,_this.signup.overrideHiringAdminAmount=""),_this.updateHiringAccountSummary("Admin"))}function updateHiringAccountSummary(type){"Candidate"===type?_this.candidateOverrideCheckbox?(_this.signup.candidateTotalAmount=_this.signup.overrideCandidateAmount,_this.updateTotalPerMonth()):(_this.signup.candidateTotalAmount=parseInt(_this.signup.candidateCount)*parseFloat(_this.signup.candidatePrice),_this.updateTotalPerMonth()):"Bundle"===type?_this.bundleOverrideCheckbox?(_this.signup.bundleTotalAmount=_this.signup.overrideBundleAmount,_this.updateTotalPerMonth()):(_this.signup.bundleTotalAmount=parseInt(_this.signup.bundleCount)*parseFloat(_this.signup.bundlePrice),_this.updateTotalPerMonth()):_this.hiringAdminOverrideCheckbox?(_this.signup.hiringAdminTotalAmount=_this.signup.overrideHiringAdminAmount,_this.updateTotalPerMonth()):(_this.signup.hiringAdminTotalAmount=parseInt(_this.signup.hiringAdminCount)*parseFloat(_this.signup.hiringAdminPrice),_this.updateTotalPerMonth())}function updateTotalPerMonth(){_this.totalChargesPerMonth=0,_this.totalChargesPerMonth+=null!==_this.signup.hiringAdminTotalAmount&&void 0!==_this.signup.hiringAdminTotalAmount&&_this.signup.hiringAdminTotalAmount>0?_this.signup.hiringAdminTotalAmount:0,_this.proRatedPriceUpdater()}function getAccountInfo(isAddCredit){var option="user"===_this.accType?{url:"/sp/admin/account/businessAccountDetails"}:{url:"/sp/sysAdmin/alternateBilling/account/businessAccountDetails",data:$.param({accountId:sharedProperties.getParam("accountId")})};ajaxService.getAjaxResponse(option).then(function(response){if("true"===response.Success)isAddCredit?(_this.account.account.spPlans.IntelligentHiring.creditBalance=response.account.spPlans.IntelligentHiring.creditBalance,$scope.account.account.spPlans.IntelligentHiring.creditBalance=response.account.spPlans.IntelligentHiring.creditBalance):(_this.account=response,$scope.account=response,_this.accountDetails=response.account,_this.companyDetails=response.company,_this.planDetails=response.account.spPlans,_this.bundleOverrideCheckbox=!0,_this.candidateOverrideCheckbox=!0,_this.hiringAdminOverrideCheckbox=!0,_this.signup={},_this.signup={hiringAdminPrice:_this.account.account.spPlans.IntelligentHiring.unitAdminPrice,candidatePrice:_this.account.account.spPlans.IntelligentHiring.unitMemberPrice,bundlePrice:_this.account.account.spPlans.IntelligentHiring.unitMemberPrice*_this.hiringBundle},_this.cycleMultiplier="Custom"!==_this.account.account.spPlans.IntelligentHiring.planInfo.planBillingCycleType?parseInt(billingMonths[_this.account.account.spPlans.IntelligentHiring.planInfo.planBillingCycleType.toLowerCase().replace("-","")]):parseInt(_this.account.account.spPlans.IntelligentHiring.planInfo.planBillingCycle),_this.editSignup=angular.copy(_this.signup));else{_this.serverError=!0;for(var key in response.error)_this.errorMessage=response.error[key]}})}function validateSendResponse(signup){_this.formSubmitted=!1;var _data=$("#accountsBillingStep2 :not(.serialize-ignore)").serialize();if(signup.$valid)_this.formSubmitted=!1,ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addMemberAccounts",data:_data}).then(function(response){"true"===response.Success?(_this.sfailure=!1,$localStorage.set("addCandidates","Candidate(s) added successfully !"),window.location="/sp/sysAdmin/alternateBilling/viewDetailAccount?accountId="+sharedProperties.getParam("accountId")):null!=response.error&&(_this.failure=response.error,_this.sfailure=!0)});else{_this.formSubmitted=!0;var elem=angular.element($element);$(elem).find("form .ng-invalid:first").length&&$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300)}}function cancelRedirect(){window.location="user"===_this.accType?"/sp/admin/account/business":"/sp/sysAdmin/alternateBilling/viewDetailAccount?accountId="+_this.account.account.id}function initAddMemberAccoutns(mode,type){_this.mode=mode,_this.accType=type,_this.getAccountInfo()}function proRatedPriceUpdater(){_this.proRatedFinalPrice=0;var remainigDays=_this.account.account.spPlans.IntelligentHiring.remainingChargableDays,candidatesTotal=null!==_this.signup.candidateTotalAmount&&void 0!==_this.signup.candidateTotalAmount&&_this.signup.candidateTotalAmount>0?_this.signup.candidateTotalAmount:0,bundlesTotal=null!==_this.signup.bundleTotalAmount&&void 0!==_this.signup.bundleTotalAmount&&_this.signup.bundleTotalAmount>0?_this.signup.bundleTotalAmount:0;_this.proRatedFinalPrice=parseFloat(_this.totalChargesPerMonth/30*remainigDays),_this.proRatedFinalPrice+=candidatesTotal+bundlesTotal,_this.proRatedFinalPrice=Math.round(_this.proRatedFinalPrice)}function hiringPackageChange(type){"Candidates"===_this.hiringPackageType?(_this.candidateOverrideCheckbox=!0,_this.bundleOverrideCheckbox=!0,_this.signup.candidateTotalAmount=0,_this.signup.candidateCount=null,_this.signup.candidatePrice=_this.editSignup.candidatePrice,_this.signup.overrideCandidateAmount=null,_this.updateHiringAccountSummary("Candidate"),_this.updateTotalPerMonth()):(_this.candidateOverrideCheckbox=!0,_this.bundleOverrideCheckbox=!0,_this.signup.bundleTotalAmount=0,_this.signup.bundleCount=null,_this.signup.bundlePrice=_this.editSignup.candidatePrice*_this.hiringBundle,_this.signup.overrideBundleAmount=null,_this.updateHiringAccountSummary("Bundle"),_this.updateTotalPerMonth())}var _this=this,billingMonths={monthly:1,quaterly:3,semiannually:6,anually:12};_this.signup={},_this.account={},_this.editSignup={},$scope.creditInfo={},_this.signup.candidateTotalAmount=0,_this.signup.bundleTotalAmount=0,_this.signup.hiringAdminTotalAmount=0,_this.totalChargesPerMonth=0,_this.hiringBundle=10,_this.proRatedFinalPrice=0,_this.candidateOverrideCheckbox=!1,_this.bundleOverrideCheckbox=!1,_this.hiringAdminOverrideCheckbox=!1,_this.serverError=!1,_this.formSubmitted=!1,_this.signup.intellgentHiring=!0,_this.hiringPackageType="Bundles",_this.addCreditForm={},_this.creditInfo={},_this.creditFormSubmit=!1,_this.currentPlanInfo={},_this.creditErrors=null,_this.step2Errors=null,_this.serverErrors=!1,_this.creditSubmitErrors=!1,_this.accountId=sharedProperties.getParam("accountId"),_this.toggleHiringOverrideField=toggleHiringOverrideField,_this.updateHiringAccountSummary=updateHiringAccountSummary,_this.updateTotalPerMonth=updateTotalPerMonth,_this.cancelRedirect=cancelRedirect,_this.initAddMemberAccoutns=initAddMemberAccoutns,_this.getAccountInfo=getAccountInfo,_this.validateSendResponse=validateSendResponse,_this.proRatedPriceUpdater=proRatedPriceUpdater,_this.hiringPackageChange=hiringPackageChange,_this.addCreditPop=addCreditPop,_this.showAddCredit=showAddCredit,_this.processCredit=processCredit,_this.updateRemainingDays=updateRemainingDays,$scope.addCredit=function(form){$scope.submitted=!1,this.spSubscribe.$valid&&"0"!==this.amount?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addCredit",data:$.param({accountId:$scope.account.account.id,chargeAmount:$scope.creditInfo.amount,paymentType:$scope.creditInfo.cpt,comment:$scope.creditInfo.ccomment})}).then(function(response){if("true"===response.Success)_this.getAccountInfo(!0),!0===_this.sfailure&&(_this.signup.submitted=!1,_this.sfailure=!1,_this.failure=null),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Amount</strong>",message:" Credited"});else{for(var key in response.error)$scope.errorMessage=response.error[key];$scope.serverError=!0,$scope.serverErrorMsg=$scope.errorMessage}}):$scope.submitted=!0}}angular.module("spApp").controller("candidateAccountsController",candidateAccountsController),candidateAccountsController.$inject=["$scope","$element","$attrs","$http","ngDialog","$timeout","ajaxService","sharedProperties","$localStorage","$rootScope"];