function kcService(ajaxService,sharedProperties,$localStorage,$q,spConfig,spValue){var deferSpotlight=!1,deferGeneric=!1;this.getSpotlight=function(id){return deferSpotlight?deferSpotlight.promise:(deferSpotlight=$q.defer(),ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/trainingSpotlight",data:$.param({goalId:void 0!==id?id:""})}).then(function(response){"true"===response.Success?deferSpotlight.resolve(response.trainingSpotLight):null!==response.error&&sharedProperties.ajaxError(response.error)}),deferSpotlight.promise)},this.getTrending=function(){return deferGeneric?deferGeneric.promise:(deferGeneric=$q.defer(),ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/trendingAndTopRated"}).then(function(response){"true"===response.Success?deferGeneric.resolve(response):null!==response.error&&sharedProperties.ajaxError(response.error)}),deferGeneric.promise)},this.resetDefer=function(type,flag){"spotlight"===type?deferSpotlight=flag:deferGeneric=flag}}kcService.$inject=["ajaxService","sharedProperties","$localStorage","$q","spConfig","spValue"],angular.module("spApp").service("kcService",kcService);
function kcIconToolTip(sharedProperties){return{restrict:"A",link:function(scope,$element,$attrs){sharedProperties.is_touch_supported()||Tipped.create($element[0],$attrs.desc,{size:"small"})}}}angular.module("spApp").directive("articleDetail",["ajaxService","sharedProperties","$timeout","$localStorage","ngDialog","$q","$rootScope","newsFeedService","$sce",function(ajaxService,sharedProperties,$timeout,$localStorage,ngDialog,$q,$rootScope,newsFeedService,$sce){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:function(element,attrs){return"/sp/resources/html/knowledge-center/"+attrs.urlSrc},link:function(scope,element,attrs){var _this=scope;_this.paSearch={id:"",name:""},_this.commentBox={},_this.loggedInUser={},_this.commentEditEnabled=!1,_this.comments={},_this.commentBoxes={},_this.videoAvailable=!1,_this.imageAvailable=!1,_this.updateBtnDisabled=!1,_this.newCommentBox={},_this.topBox={},_this.existingKeys=[],_this.searchKeywords={},_this.btn={},_this.commentsReady=!1,_this.newDate={},_this.newDate.currentDay=new Date,_this.newDate={year:_this.newDate.currentDay.getFullYear(),month:_this.newDate.currentDay.getMonth()+1,day:_this.newDate.currentDay.getDate()},_this.dd={},_this.dd.hideDropDown=!1,_this.searchTopic={},_this.showAddToGoalsBtn=!1,_this.articlePageReady=!1,_this.thanks=!1,_this.emailMemberList=[],_this.searchTag=[],_this.inputRequired=!1,_this.shortDescription=null,_this.shareEnable=!1,_this.voiceActive=!1,_this.voiceAction="play",_this.taggedMemberIds=[],_this.contentRef=null,_this.shareType=null,_this.videoType="",_this.videoUrl=null,_this.responseRecieved=!1,_this.bookmarkResponse0=!1,_this.bookmarkResponse1=!1,_this.badgeObj=null,_this.showBadge=!1,_this.disableClick=!1,_this.clickRedirect=null,_this.clickAction=null,_this.searchAction=null,_this.showVoice=!1,_this.setContentReferenceArticle=function(){var authorName=_this.articlePageDetailsAuthors,newsCredSource=void 0!==_this.articlePageDetails.newsCredSource?_this.articlePageDetails.newsCredSource:"",articleSource=_this.articlePageDetails.articleSource,articleData={content:"",name:_this.articlePageDetails.articleLinkLabel,description:authorName+newsCredSource+" - "+articleSource},tempObj={data:articleData,type:"articles"};sharedProperties.setContentReference(tempObj),tempObj=null,articleData=null,$(".article-notes-options").hide(),_this.showNotesMenu=!1,window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},_this.handleNoteOptionsClick=function(tab){$(".article-notes-options").hide(),_this.showNotesMenu=!1,sharedProperties.setSelectedNotesTab(tab)},_this.startVoice=function(){_this.voiceActive?"pause"===_this.voiceAction?(rspkr.ui.getActivePlayer().pause(),_this.voiceAction="play",sharedProperties.fireAnalyticsEvent("Knowledge Center | Text to Voice - Pause Audio",_this.articlePageDetails.articleLinkUrl)):(rspkr.ui.getActivePlayer().play(),_this.voiceAction="pause",sharedProperties.fireAnalyticsEvent("Knowledge Center | Text to Voice - Resume Audio",_this.articlePageDetails.articleLinkUrl)):$rootScope.$broadcast("httpLoaderStart")},_this.winWidth=$(window).width(),_this.winHeight=$(window).height()+100+"px",_this.formatDate=function(d){if(null!==d&&"undefined"!==d){var splitDate=d.split("-");return{"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"}[(parseInt(splitDate[1])<=9?"0"+splitDate[1]:splitDate[1]).toString()]+" "+parseInt(splitDate[2])+", "+parseInt(splitDate[0])}},_this.today=_this.formatDate(_this.newDate.year+"-"+_this.newDate.month+"-"+_this.newDate.day),_this.isArticleBookmarked=!1,_this.recommendBtnDisabled=!0,_this.articleBtnDisabled=!0,_this.comments={add:function(c,id){if(_this.newCommentBox.submitted=!1,null!==c&&""!==c&&void 0!==c){var _o={url:"/sp/trainingLibrary/addComment",data:$.param({comment:c,articleId:id})};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&(_this.topBox.newComment=null,_this.getArticle(),sharedProperties.fireAnalyticsEvent("Knowledge Center | Comment Added",id))})}else _this.newCommentBox.submitted=!0},update:function(i,id){var commentNgModel="commentBox_"+i,errorBox=$("body").find("span.error_msg_"+i),commentTextbox=$("body").find("form[name=commentBoxForm_"+i+"]"),commentbox=$("body").find("p.user-comment[data-comment=cBox_"+i+"]"),editBtns=$("body").find("p.comment-btns[data-btns=cBtns_"+i+"]"),cancelBtns=$("body").find("a[data-cancel=cancelBtn_"+i+"]");if($(errorBox).hasClass("hide")||$(errorBox).addClass("hide"),void 0!==_this.commentBoxes[commentNgModel]){var _o={url:"/sp/trainingLibrary/updateComment",data:$.param({comment:_this.commentBoxes[commentNgModel],articleId:id,candidateEmail:_this.loggedInUser.email,index:i}).replace(/%40/g,"@").replace(/%2C/g,",")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($(editBtns).removeClass("hide"),$(cancelBtns).removeClass("show").addClass("hide"),$(commentTextbox).addClass("hide"),$(commentbox).removeClass("hide"),_this.getArticle(),sharedProperties.fireAnalyticsEvent("Knowledge Center | Comment Updated",id))})}else $(errorBox).removeClass("hide")},delete:function(i,id){var commentNgModel="commentBox_"+i,_o={url:"/sp/trainingLibrary/removeComment",data:$.param({comment:_this.commentBoxes[commentNgModel],articleId:id,commentorEmail:_this.loggedInUser.email,index:i}).replace(/%40/g,"@").replace(/%2C/g,",")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&(_this.getArticle(),sharedProperties.fireAnalyticsEvent("Knowledge Center | Comment Deleted",id))})},edit:function(i){var commentTextbox=$("body").find("form[name=commentBoxForm_"+i+"]"),commentbox=$("body").find("p.user-comment[data-comment=cBox_"+i+"]"),commentNgModel="commentBox_"+i,textBoxComment=$(commentTextbox).find("textarea").attr("data-comments"),editBtns=$("body").find("p.comment-btns[data-btns=cBtns_"+i+"]"),cancelBtns=$("body").find("a[data-cancel=cancelBtn_"+i+"]");$(editBtns).addClass("hide"),$(cancelBtns).addClass("show"),$(commentTextbox).removeClass("hide"),$(commentbox).addClass("hide"),_this.commentBoxes[commentNgModel]=textBoxComment,_this.commentEditEnabled=!0},cancel:function(i){var commentTextbox=$("body").find("form[name=commentBoxForm_"+i+"]"),commentbox=$("body").find("p.user-comment[data-comment=cBox_"+i+"]"),editBtns=$("body").find("p.comment-btns[data-btns=cBtns_"+i+"]"),cancelBtns=$("body").find("a[data-cancel=cancelBtn_"+i+"]");$(editBtns).removeClass("hide"),$(cancelBtns).removeClass("show").addClass("hide"),$(commentTextbox).addClass("hide"),$(commentbox).removeClass("hide"),_this.commentEditEnabled=!1}},_this.formattedAuthor=function(a){if(void 0!==a&&""!==a)return a.join(", ")},_this.searchResultSelected=function(k){_this.searchTopic.searchTopicValue=k,_this.dd.hideDropDown=!0},_this.updateArticleLink=function(l){var link=l.split("/");return"/sp/trainingLibrary/article?"+link[parseInt(link.length-1)]},_this.trackArticle=function(id){var options={url:"/sp/tracking/trackArticles",data:$.param({articleId:id,trackingType:"ARTICLES"})};ajaxService.getAjaxResponse(options)},_this.getArticle=function(){var url=window.location.href,urlParams=url.substring(url.indexOf("?")+1).split("&")[0],options={url:"/sp/trainingLibrary/getArticleDetail/"+urlParams,method:"GET"};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){_this.articlePageDetails=response.article,_this.articlePageDetailsAuthors=response.article.author.join(", "),_this.articleComments=response.article.comments,_this.commentList=[],_this.relatedContent=response.relatedArticles,!0===response.article.canAddToUserGoals?_this.showAddToGoalsBtn=!0:_this.showAddToGoalsBtn=!1,!0!==response.article.articleForUser||"NOT_STARTED"!==response.article.userArticleStatus&&null!==response.article.userArticleStatus?_this.updateBtnDisabled=!0:_this.updateBtnDisabled=!1,"COMPLETED"===response.article.userArticleStatus?_this.articleCompletedBtn=!0:_this.articleCompletedBtn=!1,void 0!==response.article.articleBookmarked&&null!==response.article.articleBookmarked&&(_this.isArticleBookmarked=response.article.articleBookmarked),void 0!==response.article.imageUrl&&null!==response.article.imageUrl?(_this.imageAvailable=!0,_this.articleHeroImage=response.article.imageUrl):_this.imageAvailable=!1,void 0!==response.article.videoUrl&&null!==response.article.videoUrl&&"VIDEO"===response.article.articleType?(_this.articleVideo=response.article.videoUrl,_this.prepareVideo(_this.articleVideo),_this.videoAvailable=!0):_this.videoAvailable=!1,!0===_this.profileReady&&(_this.loggedInUser=$localStorage.get("loggegdInProfile"),_this.loggedInUser.first=_this.loggedInUser.member.firstName,_this.loggedInUser.last=_this.loggedInUser.member.lastName,_this.loggedInUser.email=_this.loggedInUser.member.email,$.each(_this.articleComments,function(i,j){var updatedComment=$.extend({},_this.articleComments[i],{mName:"commentBox_"+i,showOptions:_this.articleComments[i].by.email===_this.loggedInUser.email});_this.commentList.push(updatedComment)}),$timeout(function(){_this.commentsReady=!0},200)),_this.articlePageReady=!0,_this.trackArticle(urlParams);var readabilityData={},readability=response.article.articleReadability,element=document.getElementById("readability");null!==readability&&void 0!==readability&&(readabilityData.FleschKincaidReadingEase=readability.fleschKincaidReadingEase,readabilityData.FleschKincaidGradeLevel=readability.fleschKincaidGradeLevel,readabilityData.GunningFogScore=readability.gunningFogScore,readabilityData.ColemanLiauIndex=readability.colemanLiauIndex,readabilityData.SmogIndex=readability.smogIndex,readabilityData.AutomatedReadabilityIndex=readability.automatedReadabilityIndex,readabilityData.Average=readability.average,element.setAttribute("data-readability-values",JSON.stringify(readabilityData))),$timeout(function(){_this.setContentReferenceArticle()},1e3)}})},_this.prepareVideo=function(videoSrc){if(/youtube/g.test(videoSrc)){_this.videoType="youtube";var youtubeId=parseYouTube(videoSrc);_this.videoUrl=$sce.trustAsResourceUrl("https://www.youtube.com/embed/"+youtubeId+"?autoplay=0&rel=0&autohide=1&showinfo=0&wmode=transparent&modestbranding=1&iv_load_policy=3&vq=large")}else if(/vimeo/g.test(videoSrc)){_this.videoType="vimeo";var vimeoId=parseVimeo(videoSrc),userLocale=sharedProperties.provideVendorSpecificLocale("vimeo"),options={id:vimeoId,width:630,height:354};$timeout(function(){new Vimeo.Player("vimeoPlayer",options).enableTextTrack(userLocale).then(function(track){track.language=userLocale,track.kind="captions"})},500)}else _this.videoType="html5",_this.videoUrl=$sce.trustAsResourceUrl(videoSrc)};var parseYouTube=function(url){var p=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return!!url.match(p)&&RegExp.$1},parseVimeo=function(url){var m=url.match(/^.+vimeo.com\/(.*\/)?([^#\?]*)/);return m?m[2]||m[1]:null};_this.updateDashboard=function(id,source){if(!1===_this.updateBtnDisabled){var options={url:"/sp/trainingLibrary/udpateArticleToProfile",data:$.param({articleId:id})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&(_this.updateBtnDisabled=!0,_this.articleHelpFul=!0,null!==$localStorage.get("dashboardArticle")&&$localStorage.get("dashboardArticle").article.articleLinkUrl===id&&ajaxService.getAjaxResponse({url:"/sp/dashboard/learning/getArticle"}).then(function(response){"true"===response.Success?($localStorage.remove("dashboardArticle"),$localStorage.set("dashboardArticle",response)):null!==response.error&&sharedProperties.ajaxError(response.error)}),"page"===source?sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Completed",id):sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Completed from modal",id))})}},_this.getBadgeInformation=function(graphClass){ajaxService.getAjaxResponse({url:"/sp/badge/badgeProgress",data:$.param({refId:_this.articlePageDetails.goalIds[0]})}).then(function(response){"true"===response.Success?(_this.badgeObj=response.badgeProgress,_this.disableClick&&(_this.disableClick=!1),(5===_this.badgeObj.level&&_this.badgeObj.totalCount===_this.badgeObj.completedCount||1!==_this.badgeObj.level&&0===_this.badgeObj.completedCount)&&(_this.showBadge=!0,_this.badgeObj.completeLevel=5===_this.badgeObj.level&&_this.badgeObj.totalCount===_this.badgeObj.completedCount?_this.badgeObj.level:_this.badgeObj.level-1),$timeout(function(){_this.showBadge||drawProgressGraph(_this.badgeObj.completedCount,_this.badgeObj.totalCount,_this.badgeObj.level,graphClass)},1e3)):null!==response.error&&sharedProperties.ajaxError(response.error)})};var drawProgressGraph=function(completedCount,actionCount,level,graphClass){var percentageVal=parseFloat(completedCount/actionCount),radialProgress=new ProgressBar.Circle(".curriculum-actions-wrapper "+graphClass,{color:sharedProperties.whiteLabelColorCodes("sp-icon-color").color,strokeWidth:sharedProperties.detectIE()?6:9,trailWidth:3,easing:"easeInOut",trailColor:"#ccc",duration:1400,text:{autoStyleContainer:!1},step:function(state,circle){Math.round(100*circle.value());circle.setText("")}});$(".progressbar-text").addClass("icon-icon-badge_level"+level),radialProgress.text.style.fontSize="30px",radialProgress.text.style.color="#999",radialProgress.animate(percentageVal.toFixed(2))};_this.recommendArtice=function(id,doReccomend){_this.recommendBtnDisabled=!1;var options={url:"/sp/trainingLibrary/recommendArticle",data:$.param({articleId:id,doReccomend:!doReccomend})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){_this.recommendBtnDisabled=!0,_this.articlePageDetails.articleRecommendedByUser=!_this.articlePageDetails.articleRecommendedByUser,_this.articlePageDetails.recommendationCount=response.recommendationCount;var message=_this.articlePageDetails.articleRecommendedByUser?$rootScope.pullInterNationalization("growl.articleRecommended"):$rootScope.pullInterNationalization("growl.articleRecommendedRemoved");sharedProperties.growlMessage(message),sharedProperties.fireAnalyticsEvent("Knowledge Center | "+message,id)}else null!=response.error&&(_this.recommendBtnDisabled=!0,sharedProperties.ajaxError(response.error))})},_this.articleBookmark=function(id){!0===_this.isArticleBookmarked&&void 0!==_this.isArticleBookmarked?_this.sendArticleBookmark=!1:_this.sendArticleBookmark=!0,_this.articleBtnDisabled=!1;var options={url:"/sp/tracking/bookMarkArticle",data:$.param({articleId:id,trackingType:"ARTICLES",isBookMarked:_this.sendArticleBookmark})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?(_this.articleBtnDisabled=!0,!0===_this.sendArticleBookmark?(sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.articleBookmarked")),sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Bookmarked",id)):(sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.removeBookmarked")),sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Bookmark removed",id)),_this.isArticleBookmarked=!_this.isArticleBookmarked):_this.articleBtnDisabled=!0})},_this.addtoGoals=function(id,search){ajaxService.getAjaxResponse({url:"/sp/goals/addArticleToUserGoals",method:"post",data:$.param({articleId:id})}).then(function(response){"true"===response.Success&&(_this.showAddToGoalsBtn=!1,_this.updateBtnDisabled=!1,!0===search&&$.each(_this.articleResults,function(i){if(_this.articleResults[i].articleLinkUrl===id)return _this.articleResults[i].canAddToUserGoals=!1,_this.articleResults[i].userArticleStatus="NOT_STARTED",!1}),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.articleAdded")))})},_this.shareArticle=function(articleId,type){_this.shareType=type,_this.inputRequired=!1,_this.shareEnable=!0,_this.shareArticleId=articleId,_this.searchTag=[],!_this.emailMemberList.length&&_this.getMemberList(articleId),_this.placeholderMessage="share"===_this.shareType?$rootScope.pullInterNationalization("trainingLibrary.share.comment"):$rootScope.pullInterNationalization("dashboard.whatonmind"),_this.tagPlaceholder=_this.winWidth>767?$rootScope.pullInterNationalization("dashboard.addTagmember"):$rootScope.pullInterNationalization("dashboard.tagmembername"),null===_this.shortDescription?ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/getShortDescription",data:$.param({articleId:articleId})}).then(function(response){"true"===response.Success&&(_this.winHeight=$(window).height()+100+"px",_this.shortDescription=response.shortDescription,ngDialog.open({template:"/sp/trainingLibrary/share",scope:scope,className:_this.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"}))}):(_this.winHeight=$(window).height()+100+"px",ngDialog.open({template:"/sp/trainingLibrary/share",scope:scope,className:_this.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"})),"newsfeed"===_this.shareType&&null===_this.contentRef&&ajaxService.getAjaxResponse({url:"/sp/utility/og",data:$.param({url:window.location.href})}).then(function(response){void 0!==response.contentRef&&(_this.contentRef=response.contentRef)})},_this.articleShared=function(obj){if(!obj.email.length)return _this.inputRequired=!0,!0;ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/shareArticle",data:$.param({articleId:obj.articleId,comment:obj.comment,toList:obj.email.toString()})}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),_this.shareEnable=!1,sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.articleShared")),sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Shared",obj.articleId)):(ngDialog.close("ngdialog1"),_this.shareEnable=!1,sharedProperties.ajaxError(response.error))})},_this.postToNewsFeed=function(comment){var obj=newsFeedService.postMessageObject();obj.taggedMemberIds=_this.taggedMemberIds,obj.comment=comment,obj.comment.contentReference=_this.contentRef,newsFeedService.postMessage(obj).then(function(response){if(null===response)return!0;ngDialog.close("ngdialog1"),_this.shareEnable=!1,sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.articleShared")),sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Shared in Newsfeed",_this.shareArticleId)})},_this.getMemberList=function(articleId){ajaxService.getAjaxResponse({url:"/sp/allUsers"}).then(function(response){"true"===response.Success?_this.emailMemberList=response.allMembers:sharedProperties.ajaxError(response.error)})},_this.loadTags=function(query){var deferred=$q.defer(),result=_this.emailMemberList.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise},_this.tagAdded=function(tag){_this.searchTag.push(tag.email),_this.inputRequired=!1},_this.tagRemoved=function(tag){_this.searchTag.splice(_this.searchTag.indexOf(tag.email),1)},_this.tagAddedFeed=function(tag){_this.taggedMemberIds.push(tag.id)},_this.tagRemovedFeed=function(tag){_this.taggedMemberIds.splice(_this.taggedMemberIds.indexOf(tag.id),1)},_this.useful=function(obj){ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/usefullArticle",data:$.param({articleId:obj.articleId,isUseFull:obj.isUseFull})}).then(function(response){"true"===response.Success?(_this.thanks=!0,obj.isUseFull?sharedProperties.fireAnalyticsEvent("Knowledge Center | Article helpful",obj.articleId):sharedProperties.fireAnalyticsEvent("Knowledge Center | Article not helpful",obj.articleId),_this.articleHelpFul=!1,_this.articleCompletedBtn=!0):sharedProperties.ajaxError(response.error)})},_this.closeThis=function(){_this.shareEnable=!1,this.closeThisDialog()},_this.closeCompleteModal=function(){if(ngDialog.close(),_this.disableClick=!1,sharedProperties.fireAnalyticsEvent("Knowledge Center | Closed Article Complete Modal",_this.articlePageDetails.articleLinkUrl),null!==_this.clickRedirect&&(window.location.href=_this.clickRedirect),null!==_this.clickAction&&(_this.paSearch={id:$("#pa_dd_form select option:selected").val(),name:$("#pa_dd_form select option:selected").text()}),null!==_this.searchAction){var searchVal=$("#kc_search").val(),url="/sp/trainingLibrary/search?key=true&term="+(void 0!==searchVal&&null!==searchVal?searchVal:"");$timeout(function(){window.location=url},100)}},_this.trainingLibraryControl=[],_this.itemPositioned=[],angular.element(document).ready(function(){var userLocale=sharedProperties.getUserLocale();_this.articleCompletedBtn||startTimer(),ReadSpeaker.q(function(){ReadSpeaker.ui.addClickEvents(),$timeout(function(){ReadSpeaker.ui.addClickEvents()},500),ReadSpeaker.Common.addEvent("onAfterSyncInit",function(){_this.$apply(function(){$rootScope.$broadcast("httpLoaderEnd"),_this.voiceActive=!0,_this.voiceAction="pause",sharedProperties.fireAnalyticsEvent("Knowledge Center | Text to Voice - Play Audio",_this.articlePageDetails.articleLinkUrl)})})}),"es-LA"===userLocale&&_this.articlePageReady?(_this.showVoice=!1,googleTranslateElementInit()):_this.showVoice=!0});var googleTranslateElementInit=function(){new google.translate.TranslateElement({includedLanguages:"en,es",autoDisplay:!1},"google_translate_element")},startTimer=(_this.$on("modalClosed",function(){_this.setContentReferenceArticle()}),function(){function startTicking(){var coutdownTime=(new Date).getTime(),diff=coutdownTime-startTime;0==countDown-Math.floor(diff/1e3)&&(clearInterval(counter),scope.$apply(function(){_this.updateBtnDisabled||(_this.disableClick=!0)}))}var startTime=(new Date).getTime(),countDown=60,counter=setInterval(startTicking,500)});!function(){_this.showNotesMenu=!1,window.rsConf={general:{usePost:!0},settings:{hlicon:"iconoff",hlscroll:"scrollon"},cb:{ui:{stop:function(){scope.$apply(function(){_this.voiceActive=!1,_this.voiceAction="play",sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.listening")),sharedProperties.fireAnalyticsEvent("Knowledge Center | Text to Voice - Audio Ended",_this.articlePageDetails.articleLinkUrl)}),ReadSpeaker.init(),ReadSpeaker.ui.addClickEvents()}}}}}(),$(function($){$("body").on("mousedown touchstart",".available-stories",function(event){_this.showNotesMenu=!1,$("#notesOptions").removeClass("panel-fadeIn"),$(".article-notes-options").hide(),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}),$("body").on("mouseup touchend",".available-stories",function(event){scope.$apply(function(){var selectedText=getSelectedTextForNotes(),authorName=_this.articlePageDetailsAuthors,newsCredSource=void 0!==_this.articlePageDetails.newsCredSource?_this.articlePageDetails.newsCredSource:"",articleSource=_this.articlePageDetails.articleSource,articleData={content:"<q>"+selectedText+"</q>",name:_this.articlePageDetails.articleLinkLabel,description:authorName+newsCredSource+" - "+articleSource};if($("#notesOptions").removeClass("panel-fadeIn"),""===selectedText.trim()||_this.showNotesMenu)_this.showNotesMenu=!1,$("#notesOptions").removeClass("panel-fadeIn"),$(".article-notes-options").hide();else{_this.showNotesMenu=!0,$(".article-notes-options").show();var tempObj={data:articleData,type:"articles"};sharedProperties.setContentReference(tempObj),tempObj=null,articleData=null;var container=document.querySelector("#content-container"),notesOptions=document.querySelector("#notesOptions"),xPosition=event.clientX-container.getBoundingClientRect().left-notesOptions.clientWidth/2,yPosition=event.clientY-container.getBoundingClientRect().top-notesOptions.clientHeight/2;$("#notesOptions").addClass("panel-fadeIn"),$("#notesOptions").css({left:xPosition+"px",top:yPosition+"px"})}})}),$("body").on("click",".flyout-global-nav a.logout-nav",function(event){scope.$apply(function(){_this.disableClick=!1})}),$("body").on("click",".flyout-global-nav a, .header-info-container a, .event-featured-articles a, .event-trending-articles a, .event-top-rated-articles a, .event-spotlight-articles a, .event-related-content-articles a, .bookmarks-count-link a, .book-mark-share-title a",function(e){_this.clickRedirect=$(this).attr("href")?$(this).attr("href"):null,$rootScope.$broadcast("disableNavClick"),scope.$apply(function(){if(_this.disableClick){e.preventDefault(),sharedProperties.fireAnalyticsEvent("Knowledge Center | Stayed in article Page for more than a minute",_this.articlePageDetails.articleLinkUrl);ngDialog.open({template:"/sp/resources/html/library/complete-article.html",scope:scope}).closePromise.then(function(){_this.closeCompleteModal()})}})}),$("body").on("click","#pa_dd_search",function(e){if(_this.clickAction=!0,_this.disableClick){e.preventDefault(),sharedProperties.fireAnalyticsEvent("Knowledge Center | Stayed in article Page for more than a minute",_this.articlePageDetails.articleLinkUrl);ngDialog.open({template:"/sp/resources/html/library/complete-article.html",scope:scope}).closePromise.then(function(){_this.closeCompleteModal()})}}),$("body").on("click","#kc_search_btn",function(e){if(_this.searchAction=!0,_this.disableClick){e.preventDefault(),sharedProperties.fireAnalyticsEvent("Knowledge Center | Stayed in article Page for more than a minute",_this.articlePageDetails.articleLinkUrl);ngDialog.open({template:"/sp/resources/html/library/complete-article.html",scope:scope}).closePromise.then(function(){_this.closeCompleteModal()})}})});_this.setBadgeClass=function(className,levelId){return(className+levelId).toString()};var getSelectedTextForNotes=function(){return window.getSelection?window.getSelection().toString():document.selection?document.selection.createRange().text:void 0};_this.getArticle()}}}]),angular.module("spApp").directive("kcIconToolTip",kcIconToolTip),kcIconToolTip.$inject=["sharedProperties"];
angular.module("spApp").directive("articleResults",["ajaxService","sharedProperties","$rootScope","ngDialog","$filter","$localStorage","$state","$q","$timeout",function(ajaxService,sharedProperties,$rootScope,ngDialog,$filter,$localStorage,$state,$q,$timeout){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/knowledge-center/"+attrs.urlSrc},link:function(scope,element,attrs){var _this=scope;_this.showResponsivePanel=$(window).width()<768,_this.searchParams={category:"",id:"",name:""},_this.searchFilterVal="",_this.tab=0,_this.pageSize=20,_this.responseRecieved=!1,_this.totalArticles=0,_this.disabledInfinite=!1,_this.searchPaDef="",_this.articleResultData=[],_this.articleResultsBackup=[],_this.articleFilters=[],_this.articleResults=[];scope.$on("pramsUpdated",function(){var searchParams=window.location.hash;_this.searchParams={category:searchParams.split("&topicValue=")[0].split("topicCategory=")[1].trim(),id:""!==searchParams.split("&topicValue=")[1]?searchParams.split("&topicValue=")[1].split(":")[0].trim():"",name:""!==searchParams.split("&topicValue=")[1]?window.unescape(searchParams.split("&topicValue=")[1].split(":")[1].trim()):""},_this.getResults(_this.searchParams)});_this.filterResults=function(f,i,e){_this.searchFilterVal=f,_this.tab=i},_this.formattedAuthor=function(a){if(void 0!==a&&""!==a)return a.join(", ")},_this.loadMoreResults=function(){void 0!==typeof _this.articleResultsBackup&&null!==_this.articleResultsBackup&&_this.articleResultsBackup.length>_this.pageSize&&(_this.pageSize+=20,_this.pageSize>_this.articleResultsBackup.length&&(_this.disabledInfinite=!0,_this.pageSize=_this.articleResultsBackup.length))},_this.updateResults=function(paramsObj){window.location.hash="topicCategory=Themes&topicValue="+(null!==paramsObj&&null!==paramsObj.id&&void 0!==paramsObj.id?paramsObj.id+":"+encodeURIComponent(paramsObj.name):""),_this.searchParams={category:paramsObj.category,id:paramsObj.id,name:paramsObj.name},_this.getResults(_this.searchParams)},_this.getResults=function(paramsObj){ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/getResults",data:$.param({topicCategory:paramsObj.category,topicValue:paramsObj.id})}).then(function(response){"true"===response.Success?($rootScope.$broadcast("resultUpdated",paramsObj),_this.searchFilterVal="",_this.searchPaDef="",_this.tab=0,_this.pageSize=20,_this.totalArticles=0,_this.articleResultData=response,_this.articleResults=response.articles.length?response.articles:[],_this.articleResultsBackup=response.articles.length?response.articles:[],_this.totalArticles=response.totalArticlesCount,_this.articleFilters=response.articles.length?response.articles.map(function(e){return e.articleTypeFormatted}).unique():[],_this.searchPaDef=null!==paramsObj.id&&""!==paramsObj.id&&void 0!==paramsObj.id&&response.articles.length?response.articles[0].goals[0].description:"",sharedProperties.fireAnalyticsEvent("Knowledge Center | Search by Practice Area",paramsObj.name),_this.responseRecieved=!0,jQuery("html, body").animate({scrollTop:0})):null!==response.error&&sharedProperties.ajaxError(response.error)})},_this.init=function(){var searchParams=window.location.hash;_this.searchParams={category:searchParams.split("&topicValue=")[0].split("topicCategory=")[1].trim(),id:""!==searchParams.split("&topicValue=")[1]?searchParams.split("&topicValue=")[1].split(":")[0].trim():"",name:""!==searchParams.split("&topicValue=")[1]?window.unescape(searchParams.split("&topicValue=")[1].split(":")[1].trim()):""},_this.getResults(_this.searchParams)},_this.init()}}}]);
angular.module("spApp").directive("articlesHome",["ajaxService","sharedProperties","$rootScope","ngDialog","$filter","$localStorage","$state","$q","$timeout",function(ajaxService,sharedProperties,$rootScope,ngDialog,$filter,$localStorage,$state,$q,$timeout){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/knowledge-center/"+attrs.urlSrc},link:function(scope,element,attrs){var _this=scope;_this.showResponsivePanel=$(window).width()<768,_this.trainingLibraryControl=[],_this.init=function(){if(null===$localStorage.get("trainingLibraryRecord"))ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/homeArticles"}).then(function(response){"true"===response.Success?(_this.trainingLibraryControl=response,$localStorage.set("trainingLibraryRecord",response)):null!==response.error&&sharedProperties.ajaxError(response.error)});else{var response=$localStorage.get("trainingLibraryRecord");_this.trainingLibraryControl=response}},_this.init()}}}]);
angular.module("spApp").directive("practiceAreasWidget",["ajaxService","sharedProperties","$rootScope","ngDialog","$filter","$localStorage","$state","$q","$timeout",function(ajaxService,sharedProperties,$rootScope,ngDialog,$filter,$localStorage,$state,$q,$timeout){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/knowledge-center/"+attrs.urlSrc},require:"?articleDetail",scope:{disableSearch:"=disableSearch"},link:function(scope,element,attrs){var _this=scope;_this.pageType=attrs.type,_this.themeTopic="",_this.searchKeys=[],_this.responseReceived=!1,_this.pullInterNationalization=$rootScope.pullInterNationalization,_this.pauseSearch=!1;scope.$on("resultUpdated",function(e,data){if(null===data)return!0;$timeout(function(){_this.responseReceived&&scope.$apply(function(){_this.themeTopic={id:data.id,name:data.name}})},300)});_this.startSearch=function(paDetails){if(!_this.pauseSearch){var link="/sp/trainingLibrary/results#topicCategory=Themes&topicValue="+(null!==paDetails&&null!==paDetails.id&&void 0!==paDetails.id?paDetails.id+":"+encodeURIComponent(paDetails.name):"");window.location=link,"results"===_this.pageType&&$rootScope.$broadcast("pramsUpdated")}},_this.fetchSearchData=function(){if(_this.responseReceived=!1,null===$localStorage.get("getTopicsThemes")||void 0===$localStorage.get("getTopicsThemes")||""===$localStorage.get("getTopicsThemes"))ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/getAllTopics",data:$.param({topic:"Themes"})}).then(function(response){if("true"===response.Success){$localStorage.set("getTopicsThemes",response),_this.searchKeys=[];var fetchedTopics=response.topics,themesObj=[];for(var i in fetchedTopics)fetchedTopics.hasOwnProperty(i)&&themesObj.push({id:i,name:fetchedTopics[i]});_this.searchKeys=themesObj.sort(function(a,b){var af=a.name,bf=b.name;return af===bf?0:+(af>bf)||-1}),_this.responseReceived=!0}else null!==response.error&&sharedProperties.ajaxError(response.error)});else{_this.searchKeys=[];var response=$localStorage.get("getTopicsThemes"),fetchedTopics=response.topics,themesObj=[];for(var i in fetchedTopics)fetchedTopics.hasOwnProperty(i)&&themesObj.push({id:i,name:fetchedTopics[i]});_this.searchKeys=themesObj.sort(function(a,b){var af=a.name,bf=b.name;return af===bf?0:+(af>bf)||-1}),_this.responseReceived=!0}},_this.fetchSearchData(),scope.$watch("disableSearch",function(oVal,nVal){oVal!==nVal&&(_this.pauseSearch=oVal,_this.pauseSearch||null===scope.$parent.clickAction||_this.startSearch(scope.$parent.paSearch))},!0)}}}]);
angular.module("spApp").directive("searchResults",["ajaxService","sharedProperties","$rootScope","ngDialog","$filter","$localStorage","$state","$q","$timeout",function(ajaxService,sharedProperties,$rootScope,ngDialog,$filter,$localStorage,$state,$q,$timeout){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/knowledge-center/"+attrs.urlSrc},link:function(scope,element,attrs){var _this=scope;_this.searchKey="",_this.pageSize=20,_this.responseRecieved=!1,_this.totalArticles=0,_this.searchPaFilters="",_this.disabledInfinite=!1,_this.articleResultData=[],_this.articleResults=[],_this.articleResultsBackup=[],_this.filterList={media:[],pa:[]},_this.paFilterList=[],_this.closeRest=function(index,noScroll){var val=void 0===noScroll?0:1;$(".accordian-checkbox").each(function(i){i!==$(index.currentTarget.parentNode).index()-val&&$(this).prop("checked",!0)})},_this.updateFilters=function(filterName,val){"pa"===filterName&&(-1===_this.filterList.pa.indexOf(val)?_this.filterList.pa.push(val):_this.filterList.pa.splice(_this.filterList.pa.indexOf(val),1)),"media"===filterName&&(-1===_this.filterList.media.indexOf(val)?_this.filterList.media.push(val):_this.filterList.media.splice(_this.filterList.pa.indexOf(val),1)),_this.updateResultList()},_this.clearFilters=function(filterName,classS){"pa"===filterName&&(_this.filterList.pa=[]),"media"===filterName&&(_this.filterList.media=[]),$(classS).each(function(v,i){$(this).prop("checked",!1)}),_this.updateResultList()},_this.updateResultList=function(){var masterList=angular.copy(_this.articleResultsBackup);_this.articleResults=masterList.filter(function(e){return(_this.filterList.pa.length&&-1!==_this.filterList.pa.indexOf(e.goalIds[0])||!_this.filterList.pa.length&&e)&&(_this.filterList.media.length&&-1!==_this.filterList.media.indexOf(e.articleTypeFormatted)||!_this.filterList.media.length&&e)}),jQuery("html, body").animate({scrollTop:0})},_this.formattedAuthor=function(a){if(void 0!==a&&""!==a)return a.join(", ")},_this.loadMoreResults=function(){void 0!==typeof _this.articleResultsBackup&&null!==_this.articleResultsBackup&&_this.articleResultsBackup.length>_this.pageSize&&(_this.pageSize+=20,_this.pageSize>_this.articleResultsBackup.length&&(_this.disabledInfinite=!0,_this.pageSize=_this.articleResultsBackup.length))},_this.getResults=function(term){ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/getResults",data:$.param({topicCategory:"",topicValue:term})}).then(function(response){if("true"===response.Success){_this.paFilterList=[],_this.articleResultData=response,_this.articleResults=response.articles.length?response.articles:[],_this.articleResultsBackup=response.articles.length?response.articles:[],_this.totalArticles=response.totalArticlesCount;for(var paIdList=[],paList=[],i=0;i<response.articles.length;i++){var article=response.articles[i];-1===paIdList.indexOf(article.goalIds[0])&&(paIdList.push(article.goalIds[0]),paList.push(article.goals[0]))}_this.paFilterList=angular.copy(paList),_this.responseRecieved=!0,jQuery("html, body").animate({scrollTop:0})}else null!==response.error&&sharedProperties.ajaxError(response.error)})},_this.init=function(){_this.searchKey=""!==sharedProperties.getParam("term")&&null!==sharedProperties.getParam("term")&&void 0!==sharedProperties.getParam("term")?sharedProperties.getParam("term"):"",_this.getResults(_this.searchKey)},_this.init()}}}]);
angular.module("spApp").directive("searchWidget",["ajaxService","sharedProperties","$rootScope","ngDialog","$filter","$localStorage","$state","$q","$timeout",function(ajaxService,sharedProperties,$rootScope,ngDialog,$filter,$localStorage,$state,$q,$timeout){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/knowledge-center/"+attrs.urlSrc},require:"?articleDetail",scope:{disableSearch:"=disableSearch"},link:function(scope,element,attrs){var _this=scope;_this.stopRedirect=!1,_this.kcKeywordSearh="",_this.pullInterNationalization=$rootScope.pullInterNationalization,_this.keySearch=function(searchVal){console.log(_this.stopRedirect);var url="/sp/trainingLibrary/search?key=true&term="+(void 0!==searchVal&&null!==searchVal?searchVal:"");_this.stopRedirect||$timeout(function(){window.location=url},100)},scope.$watch("disableSearch",function(oVal,nVal){oVal!==nVal&&(_this.stopRedirect=oVal,console.log(_this.stopRedirect))},!0)}}}]);
angular.module("spApp").directive("spotlightWidget",["ajaxService","sharedProperties","$rootScope","ngDialog","$filter","$localStorage","$state","$q","$timeout","kcService",function(ajaxService,sharedProperties,$rootScope,ngDialog,$filter,$localStorage,$state,$q,$timeout,kcService){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/knowledge-center/"+attrs.urlSrc},link:function(scope,element,attrs){var _this=scope;_this.spotlightResponse=!1,scope.$on("resultUpdated",function(e,data){kcService.resetDefer("spotlight",!1),_this.getDetails(data.id)}),_this.isGoal=attrs.goal,_this.trainingSpotlightContent=[],_this.getDetails=function(id){_this.spotlightResponse=!1,kcService.getSpotlight(id).then(function(response){if(null===response)return!0;_this.trainingSpotlightContent=response,_this.spotlightResponse=!0})},void 0===_this.isGoal&&_this.getDetails()}}}]);
angular.module("spApp").directive("trendingWidget",["ajaxService","sharedProperties","$rootScope","ngDialog","$filter","$localStorage","$state","$q","$timeout","kcService",function(ajaxService,sharedProperties,$rootScope,ngDialog,$filter,$localStorage,$state,$q,$timeout,kcService){return{restrict:"EA",replace:!0,templateUrl:function(element,attrs){return"/sp/resources/html/knowledge-center/"+attrs.urlSrc},link:function(scope,element,attrs){var _this=scope;_this.init=function(){kcService.getTrending().then(function(response){if(null===response)return!0;_this.trendingList=response.trendingArticles,_this.topRatedList=response.topArticles})},_this.init()}}}]);