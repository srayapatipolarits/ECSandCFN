function affiliateCodeDetailsController($scope,$element,$attrs,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage){$scope.affiliateCodeDetailsEdit={},$scope.affiliateCodeDetailsEdit.status=!0,$scope.affliliateCode={},$scope.createAffiliateCode={},$scope.createAffiliateCode.validationError=!1,$scope.createCodeError=!1,$scope.updateAffiliateCode=function(fData){var formattedDate=function(d){if("object"==typeof d){var _dm=void 0!==d?d.getMonth()+1:0,_dd=void 0!==d?d.getDate():0,_dy=void 0!==d?d.getFullYear():0;return(_dm<10?"0"+_dm:_dm)+"/"+(_dd<10?"0"+_dd:_dd)+"/"+_dy}if("string"==typeof d)return d}(fData.endDate);if(fData.endDate=formattedDate,fData.code=$scope.existingPromoDetails.code,fData.promotionId=$scope.existingPromoDetails.id,!1===$scope.productsError){$scope.createAffiliateCode.validationError=!1;var vCount=0;for(var k in fData)"default"!==fData[k]&&"default1"!==fData[k]||vCount++;$scope.createAffiliateCode.$valid&&0===vCount&&fData.unitPrice>0?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/update",data:$.param(fData).replace(/%2F/g,"/")}).then(function(response){if("true"===response.Success)$scope.createCodeError=!1,$scope.affiliateCodeDetailsEdit.status=!0,"undefined"!==$scope.urlPromoId&&!1!==$scope.urlPromoId&&$scope.getPromoDetails($scope.urlPromoId),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Details</strong>",message:" updated successfully"});else{$scope.createCodeError=!0;for(var key in response.error)$scope.createCodeErrorMsg=response.error[key]}}):$scope.createAffiliateCode.validationError=!0}},$scope.productsError=!1,$scope.getAvailableProducts=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/getProducts"}).then(function(response){if("true"===response.Success)$scope.productsError=!1,$scope.productList=response.product;else{$scope.productsError=!0;for(var key in response.error)$scope.productsErrorMsg=response.error[key]}})},$scope.getDetailsError=!1,$scope.existingTags=null,$scope.getPromoDetails=function(pid){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/getDetails",data:$.param({promotionId:pid})}).then(function(response){if("true"===response.Success)$scope.getDetailsError=!1,$scope.existingPromoDetails=response.promotion,$scope.affliliateCode.productList=$scope.existingPromoDetails.productList[0].id,$scope.affliliateCode.promotionType=$scope.existingPromoDetails.promotionType,$scope.affliliateCode.unitPrice=$scope.existingPromoDetails.unitPrice,$scope.affliliateCode.endDate=($scope.existingPromoDetails.endDate.monthValue<10?"0"+$scope.existingPromoDetails.endDate.monthValue:$scope.existingPromoDetails.endDate.monthValue)+"/"+($scope.existingPromoDetails.endDate.dayOfMonth<10?"0"+$scope.existingPromoDetails.endDate.dayOfMonth:$scope.existingPromoDetails.endDate.dayOfMonth)+"/"+$scope.existingPromoDetails.endDate.year,void 0!==$scope.existingPromoDetails.count&&($scope.affliliateCode.count=$scope.existingPromoDetails.count),$scope.existingPromoDetails.tags.length>0?$scope.existingTags=$scope.existingPromoDetails.tags.length>1?$scope.existingPromoDetails.tags.join(","):$scope.existingPromoDetails.tags[0]:$scope.existingTags=null,$scope.affliliateCode.message=$scope.existingPromoDetails.message,$scope.affliliateCode.status=$scope.existingPromoDetails.status;else{$scope.getDetailsError=!0;for(var key in response.error)$scope.getDetailsErrorMsg=response.error[key]}})},$scope.searchInAccounts=null,$scope.clearSearch=function(){$scope.searchInAccounts=null},$scope.enableEdit=function(){$scope.affiliateCodeDetailsEdit.status=!1},$scope.disableEdit=function(){$scope.affiliateCodeDetailsEdit.status=!0,"undefined"!==$scope.urlPromoId&&!1!==$scope.urlPromoId&&$scope.getPromoDetails($scope.urlPromoId)},$scope.getURLPromoId=function(){var url=window.location.href,splitUrl=url.split("?")[1];$scope.urlPromoId=void 0!==splitUrl?splitUrl.split("=")[1]:null},$scope.getAccountsError=!1,$scope.getAccountDetails=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/accounts",data:$.param({promotionId:$scope.urlPromoId})}).then(function(response){if("true"===response.Success)$scope.getAccountsError=!1,$scope.accountsList=response.account;else{$scope.getAccountsError=!0;for(var key in response.error)$scope.getAccountsErrorMsg=response.error[key]}})},function(){$scope.getURLPromoId(),$scope.getAvailableProducts(),"undefined"!==$scope.urlPromoId&&!1!==$scope.urlPromoId&&($scope.getPromoDetails($scope.urlPromoId),$scope.getAccountDetails())}()}angular.module("spApp").controller("affiliateCodeDetailsController",affiliateCodeDetailsController),affiliateCodeDetailsController.$inject=["$scope","$element","$attrs","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage"];