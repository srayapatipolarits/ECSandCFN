function blueprintAdminController($scope,ajaxService,$localStorage,ngDialog,sharedProperties,filterFilter,$filter,$rootScope,$timeout){function getAllCompaniesWithBlueprintSettings(){ajaxService.getAjaxResponse({url:self.serviceApis.getAll,method:"POST"}).then(function(response){"true"===response.Success?(self.responseAvailable=!0,self.masterList=response.blueprintCompanyList,self.companyList=angular.copy(self.masterList)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function openSelectCompanyModal(type,id){self.createBlueprintMode=type,self.clonedCompanyId=id,ngDialog.open({template:self.serviceApis.openCompanyModal,scope:$scope}).closePromise.then(function(data){self.companySearchText=""})}function getAllCompaniesWithBlueprintEnabled(type,id){ajaxService.getAjaxResponse({url:self.serviceApis.getCompanies,method:"POST"}).then(function(response){"true"===response.Success?(self.blueprintCompanies=response.companies,openSelectCompanyModal(type,id),self.responseAvailableForModal=!0):null!==response.error&&sharedProperties.ajaxError(response.error)})}function selectCompany(type,id){self.blueprintCompanies.length?openSelectCompanyModal(type,id):getAllCompaniesWithBlueprintEnabled(type,id)}function toggleContentDisplay(event,mode){var $this=$(event.target);if($this.hasClass("filterCheckBox-label"))return!0;var toggleClass=void 0===mode?"show":"noshow",toggleExpandClass=void 0===mode?"expand-section":"",$html=$this.closest(".category"),$upTarget=$html.find(".header-style-content:eq(0)"),$upTargetHeight=$upTarget.outerHeight();$html.find(".border-faq-content:eq(0)").outerHeight();$upTargetHeight>1?($upTarget.css("height",0),$upTarget.removeClass("expand-section")):($upTarget.css("height","auto"),$upTarget.addClass("expand-section")),$html.toggleClass(toggleClass),$html.toggleClass(toggleExpandClass)}function getBluePrintData(){var param=getParameter("id");null===param&&($localStorage.remove("blueprintClone"),param="default"),self.selectedCompanyId=param,ajaxService.getAjaxResponse({url:self.serviceApis.getDetails,data:$.param({companyId:null!==$localStorage.get("blueprintClone")?$localStorage.get("blueprintClone").id:param}),method:"POST"}).then(function(response){"true"===response.Success?(self.dataMap=response.blueprintSettings.dataMap,self.companyInfo=response.blueprintSettings.companyDTO,null!==$localStorage.get("blueprintClone")?self.companyDisplayName=$localStorage.get("blueprintClone").name:"default"!==param&&(self.companyDisplayName=self.companyInfo.name),$localStorage.remove("blueprintClone")):null!==response.error&&sharedProperties.ajaxError(response.error)})}function updateBlueprintSettings(){self.blueprintForm.submitted=!1,self.blueprintForm.$valid?(self.blueprintData.companyId=self.selectedCompanyId,self.blueprintData.dataMap=self.dataMap,ajaxService.getAjaxResponse({url:self.serviceApis.createOrUpdate,data:self.blueprintData,headers:{"Content-Type":"application/json"}}).then(function(response){"true"===response.Success?(sharedProperties.growlMessage($rootScope.pullInterNationalization("admin.blueprint.update.message")),$timeout(function(){window.location.href="/sp/sysAdmin/blueprint/home"},500)):null!==response.error&&sharedProperties.ajaxError(response.error)})):(self.blueprintForm.submitted=!0,!self.blueprintForm.blueprintOverviewText.$error.required&&self.blueprintForm.blueprintLinkUrl.$valid&&self.blueprintForm.blueprintThumbImageUrl.$valid||(self.isBlueprintDataValid=!1),(self.blueprintForm.missionTitle.$error.required||self.blueprintForm.missionOverviewText.$error.required||!self.blueprintForm.missionLinkUrl.$valid)&&(self.isMissionDataValid=!1),(self.blueprintForm.objectiveTitle.$error.required||self.blueprintForm.objectiveOverviewText.$error.required||!self.blueprintForm.objectiveLinkUrl.$valid)&&(self.isObjectiveDataValid=!1),(self.blueprintForm.initiativesTitle.$error.required||self.blueprintForm.initiativesOverviewText.$error.required||!self.blueprintForm.initiativesLinkUrl.$valid)&&(self.isInitiativesDataValid=!1),(self.blueprintForm.csmTitle.$error.required||self.blueprintForm.csmOverviewText.$error.required||!self.blueprintForm.csmLinkUrl.$valid)&&(self.isCsmDataValid=!1))}function deleteBlueprintModal(deleteId){$scope.deleteId=deleteId,ngDialog.open({template:"/sp/resources/html/sysAdmin/blueprint/delete-blueprint-modal.html",scope:$scope})}function deleteBlueprint(id){ajaxService.getAjaxResponse({url:self.serviceApis.delete,data:$.param({companyId:id})}).then(function(response){"true"===response.Success?location.reload():null!==response.error&&sharedProperties.ajaxError(response.error)})}function resetResults(){self.searchText="",self.companyList=[],self.companyList=angular.copy(self.masterList),sortResults()}function active(event,setting){self.lastPredicate=setting.predicate,self.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.lastPredicate),self.sortResults(self.lastPredicate,self.lastReverse)}function sortResults(predicate,reverse){self.lastPredicate=predicate,self.lastReverse=reverse;var resp=$filter("orderBy")(self.masterList,predicate,reverse);self.companyList=[],self.companyList=resp}function redirectToUpdate(id,name){if("clone"===self.createBlueprintMode){var bluePrintCloneData={};bluePrintCloneData.id=self.clonedCompanyId,bluePrintCloneData.name=name,$localStorage.set("blueprintClone",bluePrintCloneData)}else $localStorage.remove("blueprintClone");window.location.href="/sp/sysAdmin/blueprint/update?id="+id}function optionsChange(type){switch(type){case"blueprint":self.dataMap.blueprint.linkText="",self.dataMap.blueprint.linkUrl="",self.dataMap.blueprint.thumbImageUrl="",self.dataMap.blueprint.imageAltText="";break;case"mission":self.dataMap.mission.linkText="",self.dataMap.mission.linkUrl="";break;case"objectives":self.dataMap.objective.linkText="",self.dataMap.objective.linkUrl="";break;case"initiatives":self.dataMap.initiatives.linkText="",self.dataMap.initiatives.linkUrl="";break;case"csm":self.dataMap.csm.linkText="",self.dataMap.csm.linkUrl=""}}function validateMinAndMax(evt,obj){evt||window.event;(void 0!==obj.minObjectives&&void 0===obj.maxObjectives||obj.minObjectives>=obj.maxObjectives)&&(obj.maxObjectives=obj.minObjectives),(void 0!==obj.minInitiatives&&void 0===obj.maxInitiatives||obj.minInitiatives>=obj.maxInitiatives)&&(obj.maxInitiatives=obj.minInitiatives),(void 0!==obj.minCsm&&void 0===obj.maxCsm||obj.minCsm>=obj.maxCsm)&&(obj.maxCsm=obj.minCsm),void 0===obj.maxObjectives||null===obj.maxObjectives||void 0!==obj.minObjectives&&null!==obj.minObjectives||(obj.minObjectives=1),void 0===obj.maxInitiatives||null===obj.maxInitiatives||void 0!==obj.minInitiatives&&null!==obj.minInitiatives||(obj.minInitiatives=1),void 0===obj.maxCsm||null===obj.maxCsm||void 0!==obj.minCsm&&null!==obj.minCsm||(obj.minCsm=1)}function isNumeric(evt){var theEvent=evt||window.event,key=theEvent.keyCode||theEvent.which,regex=/^\d+$/;return key=String.fromCharCode(key),theEvent.returnValue=!0,regex.test(key)||(theEvent.returnValue=!1,theEvent.preventDefault&&theEvent.preventDefault()),-1!==theEvent.currentTarget.value.search(/^0/)&&(theEvent.returnValue=!1,theEvent.preventDefault&&theEvent.preventDefault()),theEvent.returnValue}var self=this;self.serviceApis={getAll:"/sp/sysAdmin/blueprint/getAll",createOrUpdate:"/sp/sysAdmin/blueprint/createOrUpdate",getDetails:"/sp/sysAdmin/blueprint/getDetails",delete:"/sp/sysAdmin/blueprint/delete",getCompanies:"/sp/sysAdmin/blueprint/getCompanies",openCompanyModal:"/sp/sysAdmin/blueprint/selectCompany"},self.responseAvailable=!1,self.responseAvailableForModal=!1,self.companySearchText="",self.searchText="",self.masterList=[],self.companyList=[],self.blueprintCompanies=[],self.blueprintData={},self.dataMap={},self.selectedCompanyId="default",self.lastPredicate="name",self.lastReverse=!1,self.companyInfo={},self.createBlueprintMode="",self.clonedCompanyId="",self.companyDisplayName="",self.isBlueprintDataValid=!0,self.isMissionDataValid=!0,self.isObjectiveDataValid=!0,self.isInitiativesDataValid=!0,self.isCsmDataValid=!0,self.selectCompany=selectCompany,self.toggleContentDisplay=toggleContentDisplay,self.updateBlueprintSettings=updateBlueprintSettings,self.getAllCompaniesWithBlueprintSettings=getAllCompaniesWithBlueprintSettings,self.getBluePrintData=getBluePrintData,self.active=active,self.sortResults=sortResults,self.resetResults=resetResults,self.deleteBlueprint=deleteBlueprint,self.deleteBlueprintModal=deleteBlueprintModal,self.redirectToUpdate=redirectToUpdate,self.optionsChange=optionsChange,self.validateMinAndMax=validateMinAndMax,self.isNumeric=isNumeric,self.openMediaManager=function(obj){$rootScope.showMediaManager=!0;var destroyRoot=$scope.$on("mediaData",function(e,data){if(destroyRoot(),null===data)return!0;"VIDEO"===obj.linkType?(obj.thumbImageUrl=data.url,obj.imageAltText=data.altText,obj.linkText=data.name):(obj.linkUrl=data.url,obj.linkText=data.name,obj.thumbImageUrl="",obj.imageAltText="")})};var getParameter=function(val){for(var query=window.location.search.substring(1),vars=query.split("&"),pair=[],i=0;i<vars.length;i++)return pair=vars[i].split("="),pair[0]===val?pair[1]:null}}angular.module("spApp").controller("blueprintAdminController",blueprintAdminController),blueprintAdminController.$inject=["$scope","ajaxService","$localStorage","ngDialog","sharedProperties","filterFilter","$filter","$rootScope","$timeout"];