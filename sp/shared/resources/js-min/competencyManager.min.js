function competencyManager($scope,ajaxService,ngDialog,$localStorage,sharedProperties,$filter,$rootScope,$timeout,$q,$sce,filterFilter,eventSourceProvider){function infiniteScroll(pageSize,list){"use strict";self.pageVariables.disabledInfinite||(self.pageVariables.pageSize=pageSize,pageSize>=list.length&&(self.pageVariables.disabledInfinite=!0,self.pageVariables.pageSize=list.length))}function viewByInfiniteScroll(pageSize,list,type){"use strict";switch(type){case"view1":self.viewByPageSize1.disabledInfinite||(self.viewByPageSize1.count=pageSize,pageSize>=list.length&&(self.viewByPageSize1.disabledInfinite=!0,self.viewByPageSize1.count=list.length));break;case"view2":self.viewByPageSize2.disabledInfinite||(self.viewByPageSize2.count=pageSize,pageSize>=list.length&&(self.viewByPageSize2.disabledInfinite=!0,self.viewByPageSize2.count=list.length));break;case"view3":self.viewByPageSize3.disabledInfinite||(self.viewByPageSize3.count=pageSize,pageSize>=list.length&&(self.viewByPageSize3.disabledInfinite=!0,self.viewByPageSize3.count=list.length));break;case"view4":self.viewByPageSize4.disabledInfinite||(self.viewByPageSize4.count=pageSize,pageSize>=list.length&&(self.viewByPageSize4.disabledInfinite=!0,self.viewByPageSize4.count=list.length))}}function togglePeerModalState(type){self.peerViewState=type,self.inputRequired=!1,self.multipleManager=!1,self.existingReviewer=!1,self.assignToSelf=!1,self.repeatedRequests=!1,self.searchTagEmail=[],self.searchTag=[],self.searchTagPeer=[],"ratings"===type&&(self.peerRatingInfo=self.peerEvaluations[0],self.selectedLeftIndex=0)}function checkboxState(){self.evaluationsView.self||self.evaluationsView.manager?self.disableCheckbox.peers=!1:self.disableCheckbox.peers=!0,self.evaluationsView.manager||self.evaluationsView.peers?self.disableCheckbox.self=!1:self.disableCheckbox.self=!0,self.evaluationsView.self||self.evaluationsView.peers?self.disableCheckbox.manager=!1:self.disableCheckbox.manager=!0}function toggleViewBy(){self.pageVariables.searchText=self.originalpageVariables.searchText,"competency"===self.viewByOption?(self.selectedViewByCompetencyId="",self.viewByCompetenciesList.length||getViewByCompetency()):"member"===self.viewByOption&&getViewByMembers()}function getManagerResult(){var param=sharedProperties.getParam("token");ajaxService.getAjaxResponse({url:self.serviceApis.getManagerResults,data:$.param({tokenId:param})}).then(function(response){if("true"===response.Success){self.responseAvailable=!0,self.loggedInUser=$localStorage.get("loggegdInProfile"),self.competencyEvaluation=response.competencyEvaluation,self.competencyProfileMap=response.competencyProfile,self.competencyUsers=response.users,-1!==self.competencyEvaluation.requiredEvaluationList.indexOf("Self")?(self.showSelfRating=!0,self.scoreEvaluationList.push("self"),self.evaluationsView.self=!0):(self.showSelfRating=!1,self.evaluationsView.self=!1),-1!==self.competencyEvaluation.requiredEvaluationList.indexOf("Manager")?(self.showManagerRating=!0,self.scoreEvaluationList.push("manager"),self.evaluationsView.manager=!0):(self.showManagerRating=!1,self.evaluationsView.manager=!1),-1!==self.competencyEvaluation.requiredEvaluationList.indexOf("Peer")?(self.showPeerRating=!0,self.scoreEvaluationList.push("peers"),self.evaluationsView.peers=!0):(self.showPeerRating=!1,self.evaluationsView.peers=!1),self.checkboxState();for(var i=0;i<self.competencyUsers.length;i++)self.competencyUsers[i].competencyName=self.competencyProfileMap[self.competencyUsers[i].competencyProfileId].name,self.competencyUsers[i].selfScore=null!==self.competencyUsers[i].self?self.competencyUsers[i].self.score:0,self.competencyUsers[i].managerScore=null!==self.competencyUsers[i].manager?self.competencyUsers[i].manager.score:0,self.competencyUsers[i].peerScore=null!==self.competencyUsers[i].peers?self.competencyUsers[i].peers.score:0,null!==self.competencyUsers[i].self&&null!==self.competencyUsers[i].self.scoreArray||null!==self.competencyUsers[i].manager&&null!==self.competencyUsers[i].manager.scoreArray||null!==self.competencyUsers[i].peers&&null!==self.competencyUsers[i].peers.scoreArray?self.competencyUsers[i].enableSlider=!0:self.competencyUsers[i].enableSlider=!1;self.competencyUsers=$filter("orderBy")(self.competencyUsers,"lastName",!1),$rootScope.mgrSummaryView=!0}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function peerEvaluationForManager(user){self.peerViewState="manager",self.peerViewUser=user,ajaxService.getAjaxResponse({url:self.serviceApis.peerEvaluationForManager,data:$.param({userId:user.id,competencyEvaluationId:self.competencyEvaluation.id})}).then(function(response){if("true"===response.Success){self.peerEvaluations=response.competencyEvaluation,self.peerEvaluations=$filter("orderBy")(self.peerEvaluations,"score",!0),self.peerRatingInfo=self.peerEvaluations[0],self.selectedLeftIndex=0;ngDialog.open({template:"/sp/resources/html/admin/competency/manager-view-peer-ratings.html",scope:$scope});sharedProperties.fireAnalyticsEvent("Competency Manager | View Peer Modal","Manager View")}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function getViewByCompetencyDetails(){if(""!==self.selectedViewByCompetencyId){var obj={},momentDateTime=null;ajaxService.getAjaxResponse({url:self.serviceApis.getViewByCompetencyProfileDetails,data:$.param({competencyProfileId:self.selectedViewByCompetencyId})}).then(function(response){if("true"===response.Success){self.viewByPageSize1={count:10,disabledInfinite:!1},self.pageVariables.searchText=self.originalpageVariables.searchText,self.viewByOption="competency",self.viewByCompetencyView=!0,self.competencyListingView=!1,self.viewByMembersView=!1,self.viewByCompetencyType="evaluations",self.viewByMembersList=[],self.viewBySelectedMembersList=[],self.evaluationDetails=response.competencyEvaluation;for(var i=0;i<self.evaluationDetails.evaluationResults.length;i++)self.evaluationDetails.evaluationResults[i].selfScore=void 0!==self.evaluationDetails.evaluationResults[i].averageScores.Self?self.evaluationDetails.evaluationResults[i].averageScores.Self.score:0,self.evaluationDetails.evaluationResults[i].managerScore=void 0!==self.evaluationDetails.evaluationResults[i].averageScores.Manager?self.evaluationDetails.evaluationResults[i].averageScores.Manager.score:0,self.evaluationDetails.evaluationResults[i].peerScore=void 0!==self.evaluationDetails.evaluationResults[i].averageScores.Peer?self.evaluationDetails.evaluationResults[i].averageScores.Peer.score:0,obj=self.evaluationDetails.evaluationResults[i],momentDateTime=new Date(obj.startDate[0]+"/"+obj.startDate[1]+"/"+obj.startDate[2]+" "+obj.startDate[3]+":"+obj.startDate[4]+":"+obj.startDate[5]),self.evaluationDetails.evaluationResults[i].startDateTime=momentDateTime.getTime(),void 0!==self.evaluationDetails.evaluationResults[i].averageScores.Self&&null!==self.evaluationDetails.evaluationResults[i].averageScores.Self.competencyScores||void 0!==self.evaluationDetails.evaluationResults[i].averageScores.Manager&&null!==self.evaluationDetails.evaluationResults[i].averageScores.Manager.competencyScores||void 0!==self.evaluationDetails.evaluationResults[i].averageScores.Peer&&null!==self.evaluationDetails.evaluationResults[i].averageScores.Peer.competencyScores?self.evaluationDetails.evaluationResults[i].enableSlider=!0:self.evaluationDetails.evaluationResults[i].enableSlider=!1;self.evaluationDetails.evaluationResults=$filter("orderBy")(self.evaluationDetails.evaluationResults,"startDateTime",!0),sharedProperties.fireAnalyticsEvent("Competency Manager | View By Competency Profile","Evaluations")}else null!==response.error&&sharedProperties.ajaxError(response.error)})}}function getCompetencyEvaluationUsers(id,obj){ajaxService.getAjaxResponse({url:self.serviceApis.getCompetencyEvaluationUsers,data:$.param({competencyProfileId:id,competencyEvaluationId:obj.competencyEvaluationId})}).then(function(response){if("true"===response.Success){self.viewByPageSize2={count:10,disabledInfinite:!1},self.pageVariables.searchText=self.originalpageVariables.searchText,self.viewByCompetencyView=!0,self.competencyListingView=!1,self.viewByMembersView=!1,self.competencyEvaluationUsers=response.competencyEvaluation,self.selectedViewByEvaluation=obj,self.viewByCompetencyType="users",$("html,body").animate({scrollTop:$(".evaluation-right-header").offset().top},1e3);for(var i=0;i<self.competencyEvaluationUsers.length;i++)self.competencyEvaluationUsers[i].selfScore=null!==self.competencyEvaluationUsers[i].self?self.competencyEvaluationUsers[i].self.score:0,self.competencyEvaluationUsers[i].managerScore=null!==self.competencyEvaluationUsers[i].manager?self.competencyEvaluationUsers[i].manager.score:0,self.competencyEvaluationUsers[i].peerScore=null!==self.competencyEvaluationUsers[i].peers?self.competencyEvaluationUsers[i].peers.score:0,null!==self.competencyEvaluationUsers[i].self&&null!==self.competencyEvaluationUsers[i].self.scoreArray||null!==self.competencyEvaluationUsers[i].manager&&null!==self.competencyEvaluationUsers[i].manager.scoreArray||null!==self.competencyEvaluationUsers[i].peers&&null!==self.competencyEvaluationUsers[i].peers.scoreArray?self.competencyEvaluationUsers[i].enableSlider=!0:self.competencyEvaluationUsers[i].enableSlider=!1;self.competencyEvaluationUsers=$filter("orderBy")(self.competencyEvaluationUsers,"lastName",!1),sharedProperties.fireAnalyticsEvent("Competency Manager | View By Competency Profile","Users")}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function addToViewByMemberList(obj){var selectedObj=obj.originalObject,tempList=[],tempUserList=[];self.viewBySelectedMembersList.push(selectedObj);for(var a=0;a<self.viewBySelectedMembersList.length;a++)if("member"===self.viewBySelectedMembersList[a].type)-1===tempUserList.indexOf(self.viewBySelectedMembersList[a].id)&&tempUserList.push(self.viewBySelectedMembersList[a].id);else if(null!==(tempList=self.viewByUserGroupMap[self.viewBySelectedMembersList[a].id])&&void 0!==tempList)for(var b=0;b<tempList.length;b++)-1===tempUserList.indexOf(tempList[b].id)&&tempUserList.push(tempList[b].id);self.viewByMembersType="users",sharedProperties.spilceIndexWithBreak(self.viewByMembersList,"id",obj.originalObject.id),getUserCompetencies(tempUserList),tempList=[],tempUserList=[]}function removeFromViewByMemberList(obj){var tempList=[],tempUserList=[];self.viewByMembersList.push(obj),sharedProperties.spilceIndexWithBreak(self.viewBySelectedMembersList,"id",obj.id);for(var a=0;a<self.viewBySelectedMembersList.length;a++)if("member"===self.viewBySelectedMembersList[a].type)-1===tempUserList.indexOf(self.viewBySelectedMembersList[a].id)&&tempUserList.push(self.viewBySelectedMembersList[a].id);else if(null!==(tempList=self.viewByUserGroupMap[self.viewBySelectedMembersList[a].id])&&void 0!==tempList)for(var b=0;b<tempList.length;b++)-1===tempUserList.indexOf(tempList[b].id)&&tempUserList.push(tempList[b].id);self.viewByMembersType="users",tempUserList.length?(getUserCompetencies(tempUserList),tempList=[],tempUserList=[]):self.userEvaluationDetails=[]}function getUserCompetencies(userIds){self.userEvaluationDetails=[],ajaxService.getAjaxResponse({url:self.serviceApis.getUserCompetencies,data:$.param({userIds:userIds.toString()})}).then(function(response){if("true"===response.Success){self.viewByPageSize3={count:10,disabledInfinite:!1},self.pageVariables.searchText=self.originalpageVariables.searchText,self.viewByCompetencyView=!1,self.competencyListingView=!1,self.viewByMembersView=!0,self.viewByMembersType="users",self.userEvaluationDetails=response.users;for(var i=0;i<response.competencyEvaluation.length;i++)self.userCompetencyEvaluationMap[response.competencyEvaluation[i].id]=response.competencyEvaluation[i];self.userCompetencyProfileMap=response.competencyProfile;for(var j=0;j<self.userEvaluationDetails.length;j++)self.userEvaluationDetails[j].competencyName=self.userCompetencyProfileMap[self.userEvaluationDetails[j].competencyEvaluationId+self.userEvaluationDetails[j].competencyProfileId].name,self.userEvaluationDetails[j].selfScore=null!==self.userEvaluationDetails[j].self?self.userEvaluationDetails[j].self.score:0,self.userEvaluationDetails[j].managerScore=null!==self.userEvaluationDetails[j].manager?self.userEvaluationDetails[j].manager.score:0,self.userEvaluationDetails[j].peerScore=null!==self.userEvaluationDetails[j].peers?self.userEvaluationDetails[j].peers.score:0,null!==self.userEvaluationDetails[j].self&&null!==self.userEvaluationDetails[j].self.scoreArray||null!==self.userEvaluationDetails[j].manager&&null!==self.userEvaluationDetails[j].manager.scoreArray||null!==self.userEvaluationDetails[j].peers&&null!==self.userEvaluationDetails[j].peers.scoreArray?self.userEvaluationDetails[j].enableSlider=!0:self.userEvaluationDetails[j].enableSlider=!1;self.userEvaluationDetails=$filter("orderBy")(self.userEvaluationDetails,"lastName",!1),sharedProperties.fireAnalyticsEvent("Competency Manager | View By Members/Groups","Users")}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function getUserCompetencyEvaluations(user){var obj={},momentDateTime=null;ajaxService.getAjaxResponse({url:self.serviceApis.getUserCompetencyEvaluations,data:$.param({userId:user.id})}).then(function(response){if("true"===response.Success){self.viewByPageSize4={count:10,disabledInfinite:!1},self.pageVariables.searchText=self.originalpageVariables.searchText,self.viewByCompetencyView=!1,self.competencyListingView=!1,self.viewByMembersView=!0,self.userCompetencyEvaluations=response.competencyEvaluation,self.viewByMembersType="evaluations",self.selectedUser=user,$("html,body").animate({scrollTop:$(".evaluation-right-header").offset().top},1e3);for(var j=0;j<self.userCompetencyEvaluations.length;j++)self.userCompetencyEvaluations[j].selfScore=null!==self.userCompetencyEvaluations[j].self?self.userCompetencyEvaluations[j].self.score:0,self.userCompetencyEvaluations[j].managerScore=null!==self.userCompetencyEvaluations[j].manager?self.userCompetencyEvaluations[j].manager.score:0,self.userCompetencyEvaluations[j].peerScore=null!==self.userCompetencyEvaluations[j].peers?self.userCompetencyEvaluations[j].peers.score:0,null!==self.userCompetencyEvaluations[j].self&&null!==self.userCompetencyEvaluations[j].self.scoreArray||null!==self.userCompetencyEvaluations[j].manager&&null!==self.userCompetencyEvaluations[j].manager.scoreArray||null!==self.userCompetencyEvaluations[j].peers&&null!==self.userCompetencyEvaluations[j].peers.scoreArray?self.userCompetencyEvaluations[j].enableSlider=!0:self.userCompetencyEvaluations[j].enableSlider=!1,obj=self.userCompetencyEvaluations[j],momentDateTime=new Date(obj.startDate[0]+"/"+obj.startDate[1]+"/"+obj.startDate[2]+" "+obj.startDate[3]+":"+obj.startDate[4]+":"+obj.startDate[5]),self.userCompetencyEvaluations[j].startDateTime=momentDateTime.getTime();self.userCompetencyEvaluations=$filter("orderBy")(self.userCompetencyEvaluations,"startDate",!0),sharedProperties.fireAnalyticsEvent("Competency Manager | View By Members/Groups","Evaluations")}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function toggleActivateOption(){angular.element($(".autoCompleteCss")).removeClass("disable-autoInput"),angular.element($(".autoCompleteCss")).addClass("enable-autoInput"),self.competencySearchList=[],self.selectedSearchList=[],self.competencyUsersList=[],self.competencyUserIds=[],self.addedUserIds=[],$rootScope.clearAnguCompleteData(),"competency"===self.activateOption?self.competencySearchList=angular.copy(self.activateOptionCompetencyList):"groups"===self.activateOption?self.competencySearchList=angular.copy(self.activateOptionGroupList):self.competencySearchList=angular.copy(self.activateOptionUserList)}function prepareUserListForCompetency(){if(self.selectedSearchList=[],self.competencyUsersList=[],self.competencyUserIds=[],self.addedUserIds=[],self.activateOption="competency",self.evaluationChecks={manager:!1,self:!1,peer:!1},self.activateErrors=!1,self.masterUserList.length)return void(self.activateView=!0);getUsersForActivate("activateFlow")}function addToUserList(obj){var selectedObj=obj.originalObject,tempList=[];switch(selectedObj.type){case"competency":tempList=[],tempList=self.userCompetencyMap[selectedObj.id];for(var a=0;a<tempList.length;a++)-1===self.competencyUserIds.indexOf(tempList[a].id)&&(tempList[a].competencyName=self.competencyObjMap[tempList[a].competencyProfileId].name,self.competencyUsersList.push(tempList[a]),self.competencyUserIds.push(tempList[a].id));self.competencyUserCountMap[selectedObj.id]=tempList.length;break;case"groups":tempList=[],tempList=self.userGroupMap[selectedObj.id];for(var b=0;b<tempList.length;b++)-1===self.competencyUserIds.indexOf(tempList[b].id)&&(tempList[b].competencyName=self.competencyObjMap[tempList[b].competencyProfileId].name,self.competencyUsersList.push(tempList[b]),self.competencyUserIds.push(tempList[b].id));angular.element($(".autoCompleteCss")).removeClass("enable-autoInput"),angular.element($(".autoCompleteCss")).addClass("disable-autoInput");break;case"users":self.competencyUsersList.push(self.individualUserMap[selectedObj.id]),self.competencyUserIds.push(selectedObj.id),angular.element($(".autoCompleteCss")).removeClass("disable-autoInput"),angular.element($(".autoCompleteCss")).addClass("enable-autoInput")}tempList=[],self.selectedSearchList.push(selectedObj),sharedProperties.spilceIndexWithBreak(self.competencySearchList,"id",obj.originalObject.id);for(var user=0;user<self.competencyUsersList.length;user++)-1===self.masterUserIdsList.indexOf(self.competencyUsersList[user].id)&&-1===self.addedUserIds.indexOf(self.competencyUsersList[user].id)&&self.addedUserIds.push(self.competencyUsersList[user].id)}function removeUserFromList(obj,side){var competencySearchObject={},tempCompetencyUserList=[];if("right"===side)if(sharedProperties.spilceIndexWithBreak(self.competencyUsersList,"id",obj.id),self.competencyUserIds.splice(self.competencyUserIds.indexOf(obj.id),1),self.addedUserIds.splice(self.addedUserIds.indexOf(obj.id),1),"competency"===self.activateOption){var userCount=self.competencyUserCountMap[obj.competencyProfileId]-1;self.competencyUserCountMap[obj.competencyProfileId]=userCount,0===userCount&&(sharedProperties.spilceIndexWithBreak(self.selectedSearchList,"id",obj.competencyProfileId),competencySearchObject.id=obj.competencyProfileId,competencySearchObject.name=obj.competencyName,competencySearchObject.type="competency",self.competencySearchList.push(competencySearchObject))}else if("groups"===self.activateOption){if(0===self.competencyUsersList.length){for(var group=0;group<self.selectedSearchList.length;group++)competencySearchObject.id=self.selectedSearchList[group].id,competencySearchObject.name=self.selectedSearchList[group].name,competencySearchObject.type="groups",self.competencySearchList.push(competencySearchObject);self.selectedSearchList=[],angular.element($(".autoCompleteCss")).removeClass("disable-autoInput"),angular.element($(".autoCompleteCss")).addClass("enable-autoInput")}}else sharedProperties.spilceIndexWithBreak(self.selectedSearchList,"id",obj.id),competencySearchObject.id=obj.id,competencySearchObject.name=obj.name,competencySearchObject.type="users",self.competencySearchList.push(competencySearchObject);else{switch(obj.type){case"competency":tempCompetencyUserList=self.userCompetencyMap[obj.id];for(var i=0;i<tempCompetencyUserList.length;i++)sharedProperties.spilceIndexWithBreak(self.competencyUsersList,"id",tempCompetencyUserList[i].id),self.competencyUserIds.splice(self.competencyUserIds.indexOf(tempCompetencyUserList[i].id),1);break;case"groups":self.competencyUsersList=[],self.competencyUserIds=[],self.addedUserIds=[],angular.element($(".autoCompleteCss")).removeClass("disable-autoInput"),angular.element($(".autoCompleteCss")).addClass("enable-autoInput")}sharedProperties.spilceIndexWithBreak(self.selectedSearchList,"id",obj.id),self.competencySearchList.push(obj)}}function toggleRowById(rowId){self.activeRow=rowId===self.activeRow?-1:rowId}function getPastEvaluations(){ajaxService.getAjaxResponse({url:self.serviceApis.getPastEvaluations}).then(function(response){"true"===response.Success?self.pastEvaluationsList=response.competencyEvaluation:null!==response.error&&sharedProperties.ajaxError(response.error)})}function changeCompetencyEvaluation(){sharedProperties.fireAnalyticsEvent("Competency Manager | Change Evaluation Date","N/A"),self.activeToggleId=-1,$('div[id^="section_cont_"]').hide(),getCompetencyProfile(self.selectedCompetencyProfileId)}function addUserToEvaluationModal(){if(angular.element($(".autoCompleteCss")).removeClass("disable-autoInput"),angular.element($(".autoCompleteCss")).addClass("enable-autoInput"),self.competencySearchList=[],self.selectedSearchList=[],self.competencyUsersList=[],self.competencyUserIds=[],self.addedUserIds=[],self.masterUserList.length){self.activateOption="users",self.competencySearchList=angular.copy(self.activateOptionUserList);ngDialog.open({template:"/sp/resources/html/admin/competency/add-member-to-evaluation.html",scope:$scope})}else getUsersForActivate("addMemberFlow")}function addUserToEvaluation(){ajaxService.getAjaxResponse({url:self.serviceApis.addUserToEvaluation,data:$.param({userIds:self.addedUserIds.toString()})}).then(function(response){"true"===response.Success?(sharedProperties.growlMessage($rootScope.pullInterNationalization("competency.admin.addMember.evaluation.success")),sharedProperties.fireAnalyticsEvent("Competency Manager | User Added","N/A"),$timeout(function(){window.location.reload()},1e3)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function removeUserFromEvaluationModal(userId){self.removeUserId=userId;ngDialog.open({template:"/sp/resources/html/admin/competency/remove-user-evaluation.html",scope:$scope})}function removeUserFromEvaluation(){ajaxService.getAjaxResponse({url:self.serviceApis.removeUserFromCompetency,data:$.param({userId:self.removeUserId})}).then(function(response){"true"===response.Success?(sharedProperties.growlMessage($rootScope.pullInterNationalization("competency.admin.user.remove")),sharedProperties.fireAnalyticsEvent("Competency Manager | User Removed","N/A"),$timeout(function(){window.location.reload()},1e3)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function getCompetencyProfile(id){ajaxService.getAjaxResponse({url:self.serviceApis.getCompetencyProfile,data:$.param({evaluationId:void 0!==id?id:""})}).then(function(response){if("true"===response.Success)if(self.scoreEvaluationList=[],void 0===response.competencyEvaluation)response.userCount>0?prepareUserListForCompetency():(self.responseAvailable=!0,self.competencyAdminDefaultView=!0);else{self.responseAvailable=!0,self.masterCompetencyUsers=[],self.competencyAdminDefaultView=!1,self.competencyEvaluationInProgress=!response.competencyEvaluation.completed,self.pastEvaluations=response.evaluationCount,self.competencyEvaluation=response.competencyEvaluation,self.masterCompetencyUsers=self.competencyEvaluation.users,self.competencyUsers=angular.copy(self.masterCompetencyUsers),self.competencyProfileMap=response.competencyEvaluation.competencyProfileMap,self.selectedCompetencyProfileId=self.competencyEvaluation.id,-1!==self.competencyEvaluation.requiredEvaluationList.indexOf("Self")?(self.showSelfRating=!0,self.scoreEvaluationList.push("self"),self.evaluationsView.self=!0):(self.showSelfRating=!1,self.evaluationsView.self=!1),-1!==self.competencyEvaluation.requiredEvaluationList.indexOf("Manager")?(self.showManagerRating=!0,self.scoreEvaluationList.push("manager"),self.evaluationsView.manager=!0):(self.showManagerRating=!1,self.evaluationsView.manager=!1),-1!==self.competencyEvaluation.requiredEvaluationList.indexOf("Peer")?(self.showPeerRating=!0,self.scoreEvaluationList.push("peers"),self.evaluationsView.peers=!0):(self.showPeerRating=!1,self.evaluationsView.peers=!1),self.checkboxState(),self.ratingsCount={self:{completed:0,total:0},manager:{completed:0,total:0},peers:{completed:0,total:0}};for(var i=0;i<self.masterCompetencyUsers.length;i++){if(self.masterUserIdsList.push(self.masterCompetencyUsers[i].id),self.showSelfRating){if(null!==self.masterCompetencyUsers[i].self&&null!==self.masterCompetencyUsers[i].self.scoreArray){!angular.isObject(self.masterCompetencyUsers[i].self.cumulativeAverage)&&(self.masterCompetencyUsers[i].self.cumulativeAverage={});for(var k=0;k<self.masterCompetencyUsers[i].self.scoreArray.length;k++)self.masterCompetencyUsers[i].self.cumulativeAverage[self.competencyProfileMap[self.masterCompetencyUsers[i].competencyProfileId].competencyList[k].name]=self.masterCompetencyUsers[i].self.scoreArray[k]}self.ratingsCount.self.total=self.masterCompetencyUsers.length,null!==self.masterCompetencyUsers[i].self&&(self.ratingsCount.self.completed=self.ratingsCount.self.completed+1)}if(self.showManagerRating){if(null!==self.masterCompetencyUsers[i].manager&&null!==self.masterCompetencyUsers[i].manager.scoreArray){!angular.isObject(self.masterCompetencyUsers[i].manager.cumulativeAverage)&&(self.masterCompetencyUsers[i].manager.cumulativeAverage={});for(var kk=0;kk<self.masterCompetencyUsers[i].manager.scoreArray.length;kk++)self.masterCompetencyUsers[i].manager.cumulativeAverage[self.competencyProfileMap[self.masterCompetencyUsers[i].competencyProfileId].competencyList[kk].name]=self.masterCompetencyUsers[i].manager.scoreArray[kk]}self.ratingsCount.manager.total=self.masterCompetencyUsers.length,null!==self.masterCompetencyUsers[i].manager&&0!==self.masterCompetencyUsers[i].manager.score&&(self.ratingsCount.manager.completed=self.ratingsCount.manager.completed+1)}if(self.showPeerRating){if(null!==self.masterCompetencyUsers[i].peers&&null!==self.masterCompetencyUsers[i].peers.scoreArray){!angular.isObject(self.masterCompetencyUsers[i].peers.cumulativeAverage)&&(self.masterCompetencyUsers[i].peers.cumulativeAverage={});for(var kkk=0;kkk<self.masterCompetencyUsers[i].peers.scoreArray.length;kkk++)self.masterCompetencyUsers[i].peers.cumulativeAverage[self.competencyProfileMap[self.masterCompetencyUsers[i].competencyProfileId].competencyList[kkk].name]=self.masterCompetencyUsers[i].peers.scoreArray[kkk]}null!==self.masterCompetencyUsers[i].peers&&(self.ratingsCount.peers.total=self.ratingsCount.peers.total+self.masterCompetencyUsers[i].peers.count,self.ratingsCount.peers.completed=self.ratingsCount.peers.completed+self.masterCompetencyUsers[i].peers.completedCount)}self.masterCompetencyUsers[i].competencyName=self.competencyProfileMap[self.masterCompetencyUsers[i].competencyProfileId].name,self.masterCompetencyUsers[i].selfScore=null!==self.masterCompetencyUsers[i].self?self.masterCompetencyUsers[i].self.score:0,self.masterCompetencyUsers[i].managerScore=null!==self.masterCompetencyUsers[i].manager?self.masterCompetencyUsers[i].manager.score:0,self.masterCompetencyUsers[i].peerScore=null!==self.masterCompetencyUsers[i].peers?self.masterCompetencyUsers[i].peers.score:0,null!==self.masterCompetencyUsers[i].self&&null!==self.masterCompetencyUsers[i].self.scoreArray||null!==self.masterCompetencyUsers[i].manager&&null!==self.masterCompetencyUsers[i].manager.scoreArray||null!==self.masterCompetencyUsers[i].peers&&null!==self.masterCompetencyUsers[i].peers.scoreArray?self.masterCompetencyUsers[i].enableSlider=!0:self.masterCompetencyUsers[i].enableSlider=!1,self.reviewersList=[],null!==self.masterCompetencyUsers[i].manager&&self.reviewersList.push(self.masterCompetencyUsers[i].manager.reviewer.email),self.addedReviewersMap[self.masterCompetencyUsers[i].id]=self.reviewersList}filterOperation(),self.competencyEvaluationInProgress||void 0!==id||getPastEvaluations();for(var competencyKeys=Object.keys(self.competencyProfileMap),abc=0;abc<competencyKeys.length;abc++)for(var list=0;list<self.competencyProfileMap[competencyKeys[abc]].competencyList.length;list++)self.competencyProfileMap[competencyKeys[abc]].competencyList[list].show=!0;moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker"))}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function filterOperation(){getFilterValue(),self.returnMemberList(self.pageVariables.pageSize)}function getFilterValue(){self.pageVariables=angular.copy(self.originalpageVariables),self.filterOptions={allCompetencyProfiles:[],allCompetencyAttributes:[],allGroupsFilter:[],managersList:[],selfEvaluationStatus:[],managerEvaluationStatus:[]};var competencyKeys=Object.keys(self.competencyEvaluation.competencyProfileMap),groupKeys=Object.keys(self.competencyEvaluation.userGroupMap),managerFilter=[],tempObject={};tempObject.id="",tempObject.name=$rootScope.pullInterNationalization("competency.members.selectCompetency"),self.filterOptions.allCompetencyProfiles.push(tempObject);for(var i=0;i<competencyKeys.length;i++)self.filterOptions.allCompetencyProfiles.push(self.competencyEvaluation.competencyProfileMap[competencyKeys[i]]);for(var j=0;j<groupKeys.length;j++)self.filterOptions.allGroupsFilter.push(self.competencyEvaluation.userGroupMap[groupKeys[j]]);for(var k=0;k<self.masterCompetencyUsers.length;k++)null!==self.masterCompetencyUsers[k].manager&&-1===managerFilter.indexOf(self.masterCompetencyUsers[k].manager.reviewer.email)&&(managerFilter.push(self.masterCompetencyUsers[k].manager.reviewer.email),self.filterOptions.managersList.push(self.masterCompetencyUsers[k].manager.reviewer));self.showSelfRating&&(self.filterOptions.selfEvaluationStatus=[{id:1,name:$rootScope.pullInterNationalization("competency.admin.rating.notInitiated")},{id:2,name:self.competencyEvaluationInProgress?$rootScope.pullInterNationalization("manageAccountContent.pending"):$rootScope.pullInterNationalization("competency.admin.notRated")},{id:3,name:$rootScope.pullInterNationalization("manageAccountContent.completed")}]),self.showManagerRating&&(self.filterOptions.managerEvaluationStatus=[{id:4,name:$rootScope.pullInterNationalization("competency.admin.rating.notInitiated")},{id:5,name:self.competencyEvaluationInProgress?$rootScope.pullInterNationalization("manageAccountContent.pending"):$rootScope.pullInterNationalization("competency.admin.notRated")},{id:6,name:$rootScope.pullInterNationalization("manageAccountContent.completed")}])}function filterByGroups(selectedArray,array){return null!==array&&selectedArray.some(function(obj){return-1!==array.indexOf(obj.id)})}function filterByManager(selectedArray,managerObj){return null!==managerObj&&selectedArray.some(function(obj){return managerObj.reviewer.email===obj.email})}function filterByEvaluationStatus(selectedArray,user){return selectedArray.some(function(obj){if(1===obj.id){if(self.showManagerRating)return null===user.self&&null===user.manager;if(!self.showManagerRating&&self.showPeerRating)return null===user.self&&null===user.peers}else{if(2===obj.id)return self.showManagerRating?null===user.self&&null!==user.manager:!self.showManagerRating&&self.showPeerRating?null===user.self&&null!==user.peers:null===user.self;if(3===obj.id)return null!==user.self;if(4===obj.id)return null===user.manager;if(5===obj.id)return null!==user.manager&&0===user.manager.score;if(6===obj.id)return null!==user.manager&&0!==user.manager.score}})}function getEvaluationRequests(){ajaxService.getAjaxResponse({url:self.serviceApis.getEvaluationRequests}).then(function(response){if("true"===response.Success){self.responseAvailable=!0,self.managerView=!0,self.competencyEvaluationId=response.evaluationId,self.competencyProfileMap=response.competencyProfile,void 0!==response.peerEvaluation&&(self.showPeerRating=response.peerEvaluation),self.competencyEvaluationRequests=response.competencyEvaluation;for(var xyz=0;xyz<self.competencyEvaluationRequests.length;xyz++)self.reviewersList=[],"Manager"===self.competencyEvaluationRequests[xyz].type&&(self.peerOnlyEvaluation=!1),
null!==response.member&&void 0!==response.member&&(self.reviewersList.push(response.member.email),self.addedReviewersMap[self.competencyEvaluationRequests[xyz].user.id]=self.reviewersList),self.competencyEvaluationRequests[xyz].user.competencyProfileId=self.competencyEvaluationRequests[xyz].competencyProfileId;self.competencyEvaluationRequests=$filter("orderBy")(self.competencyEvaluationRequests,"user.lastName",!1)}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function startEvaluation(user){document.documentElement.clientWidth<768&&$timeout(function(){$("body").scrollTop()>0?$("body").scrollTop(0):$("html").scrollTop()>0&&$("html").scrollTop(0)},1e3),self.currentIndexForRating=0,self.ratingScoreArray=[],self.userType=user,ajaxService.getAjaxResponse({url:self.serviceApis.startEvaluation,data:$.param({memberId:"self"!==user?user:""}),method:"POST"}).then(function(response){if("true"===response.Success){self.winHeight=document.documentElement.clientHeight+"px",self.winHeight1=document.documentElement.clientHeight-123+"px";var screenWidth=document.documentElement.clientWidth;self.responseAvailableForModal=!0,self.competencyProfileForRating=response.competencyProfile,self.userToBeAssessed=response.user,self.selectedCompetencyForRating=self.competencyProfileForRating.competencyList[0];ngDialog.open({template:screenWidth>767?"/sp/resources/html/competency/rating-desktop.html":self.serviceApis.startEvaluationModal,scope:$scope,className:screenWidth>767?"ngdialog-theme-default":"new-mobile-theme oHide"});self.competencyRatingScore=1,$rootScope.$on("ngDialog.opened",function(e,$dialog){document.documentElement.clientWidth<768&&($("body").addClass("bodyPosFix"),$timeout(function(){$("body").scrollTop()>0?$("body").scrollTop(0):$("html").scrollTop()>0&&$("html").scrollTop(0)},1e3));var $r=jQuery('input[type="range"]');$r.rangeslider({polyfill:!1,onInit:function(){$timeout(function(){jQuery("#cmrc-desc-cont_"+self.competencyRatingScore).addClass("slideRight")},100)},onSlideEnd:function(position,value){$scope.$apply(function(){jQuery("#cmrc-desc-cont_"+self.competencyRatingScore).removeClass("slideRight"),self.competencyRatingScore=value,self.ratingScoreArray[self.currentIndexForRating]=self.competencyRatingScore,self.prevScores=angular.copy(self.ratingScoreArray),$timeout(function(){jQuery("#cmrc-desc-cont_"+self.competencyRatingScore).addClass("slideRight")},100)})}}),window.setTimeout(function(){$r.rangeslider("update",!0)},1e3)}),$rootScope.$on("ngDialog.closed",function(e){document.documentElement.clientWidth<768&&$("body").removeClass("bodyPosFix")})}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function openRatingDetailsModal(id,memberObj,reviewerRole,ratingChar,ratingScalePercent){ajaxService.getAjaxResponse({url:self.serviceApis.getRatingDetails,data:$.param({scoreDetailsId:id}),method:"POST"}).then(function(response){if("true"===response.Success){self.responseAvailableForModal=!0,self.scoreDetails.competencyScoreList=response.competencyScoreList,self.scoreDetails.score=response.totalScore,self.scoreDetails.reviewer=response.reviewer,$scope.memberDetails=memberObj,$scope.reviewerRole=reviewerRole;var reviewerInfo=(ngDialog.open({template:self.serviceApis.ratingDetailsModal,scope:$scope}),"Viewed Manager Evaluation details");"s"===reviewerRole?reviewerInfo="Viewed Self Evaluation details":"p"===reviewerRole&&(reviewerInfo="Viewed Peer Evaluation details"),null!==ratingChar&&void 0!==ratingChar&&(self.ratingChar=ratingChar,self.ratingScalePercent=ratingScalePercent),sharedProperties.fireAnalyticsEvent("Competency Manager | View Evaluation Details",reviewerInfo)}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function saveEvaluation(){self.ratingScoreArray.length!==self.competencyProfileForRating.competencyList.length&&self.ratingScoreArray.push(1),ngDialog.close(),ajaxService.getAjaxResponse({url:self.serviceApis.saveEvaluation,data:$.param({memberId:"self"!==self.userType?self.userType:"",scoreArray:self.ratingScoreArray.join()}),method:"POST"}).then(function(response){"true"===response.Success?(sharedProperties.growlMessage($rootScope.pullInterNationalization("competency.ajaxSuccess.evaluationCompleted")),sharedProperties.fireAnalyticsEvent("Competency Manager | Manager Evaluation Completed","N/A"),$timeout(function(){window.location.reload()},1e3)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function getMemberList(){ajaxService.getAjaxResponse({url:self.serviceApis.getAllUsers,data:$.param({isAccountAdmin:!self.managerView}),method:"POST"}).then(function(response){"true"===response.Success?self.emailMemberList=response.allMembers:sharedProperties.ajaxError(response.error)})}function previewRating(id,type){self.currentIndex=0,self.winHeight=document.documentElement.clientHeight+"px",self.winHeight1=parseInt(document.documentElement.clientHeight-117,10)+"px",self.competencyRangeSlider=1,self.selectedCompetencyList=self.competencyProfileMap[id].competencyList,self.selectedCompetencyProfileName=self.competencyProfileMap[id].name,self.selectedCompetency=self.selectedCompetencyList[0],sharedProperties.fireAnalyticsEvent("Competency Manager | Preview Competency Profile",self.selectedCompetencyProfileName);ngDialog.open({template:void 0===type?self.serviceApis.previewRating:"/sp/resources/html/admin/competency/rating-preview.html",scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"});$rootScope.$on("ngDialog.opened",function(e,$dialog){var $r=jQuery('input[type="range"]');$r.rangeslider({polyfill:!1,onInit:function(){$timeout(function(){jQuery("#cmrc-desc-cont_"+self.competencyRangeSlider).addClass("slideRight")},100)},onSlideEnd:function(position,value){$scope.$apply(function(){jQuery("#cmrc-desc-cont_"+self.competencyRangeSlider).removeClass("slideRight"),self.competencyRangeSlider=value,$timeout(function(){jQuery("#cmrc-desc-cont_"+self.competencyRangeSlider).addClass("slideRight")},100)})}}),window.setTimeout(function(){$r.rangeslider("update",!0)},1e3)})}function endEvaluationModal(){ngDialog.open({template:"/sp/resources/html/admin/competency/end-evaluation-modal.html",scope:$scope})}function sendReminderModal(obj){self.reminderInfo=obj;ngDialog.open({template:self.serviceApis.sendReminderModal,scope:$scope})}function sendReminder(obj){self.reminderInfo=obj,ajaxService.getAjaxResponse({url:self.serviceApis.sendReminder,data:$.param({userId:self.reminderInfo.userId,isInitiate:self.reminderInfo.isInitiate,isSelf:self.reminderInfo.isSelf,reviewUserId:self.reminderInfo.reviewUserId}),method:"POST"}).then(function(response){if("true"===response.Success){sharedProperties.growlMessage($rootScope.pullInterNationalization("competency.ajaxSuccess.reminderSent"));var reminderDetails="";self.reminderInfo.isInitiate?reminderDetails="Sent Reminder for Member to Initiate Evaluation":self.reminderInfo.isSelf?reminderDetails="Sent Reminder for Member to do Self Evaluation":""!==self.reminderInfo.reviewUserId&&(reminderDetails="Sent Reminder for Reviewer to do the Evaluation"),sharedProperties.fireAnalyticsEvent("Competency Manager | Send Reminder about evaluation",reminderDetails)}else null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})}function initiateEvaluationModal(type,userToProcess,peerState,evaluationId){self.winHeight=document.documentElement.clientHeight+100+"px",self.inputRequired=!1,self.multipleManager=!1,self.existingReviewer=!1,self.assignToSelf=!1,self.repeatedRequests=!1,self.searchTagEmail=[],self.searchTag=[],self.searchTagPeer=[],self.initiateRequestType=type,self.userToProcess=userToProcess,self.managerFirstName=null,self.managerLastName=null;var tempReviewersList=[];if(self.emailMemberList.length||self.getMemberList(),"peerEvaluation"!==type||void 0===peerState){self.managerView||getPeerReviewers(self.userToProcess.id);ngDialog.open({template:self.serviceApis.initiateEvaluationModal,scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"})}else self.peerViewState=peerState,ajaxService.getAjaxResponse({url:void 0!==evaluationId?self.serviceApis.peerEvaluationDetailsExt:self.serviceApis.getPeerEvaluationDetails,data:$.param({userId:userToProcess.id,competencyEvaluationId:void 0!==evaluationId?evaluationId:self.competencyEvaluation.id})}).then(function(response){if("true"===response.Success){self.peerEvaluations=response.competencyEvaluation,tempReviewersList=self.addedReviewersMap[userToProcess.id];for(var peer=0;peer<self.peerEvaluations.length;peer++)tempReviewersList.push(self.peerEvaluations[peer].reviewer.email);self.addedReviewersMap[userToProcess.id]=tempReviewersList,self.peerEvaluations=$filter("orderBy")(self.peerEvaluations,"score",!0),self.peerRatingInfo=self.peerEvaluations[0],self.selectedLeftIndex=0,self.peerReviewersMap[userToProcess.id]=!0,self.winHeight1=$(window).height()-50+"px",self.winHeight2=$(window).height()-175+"px",self.winWidth1=$(window).width();ngDialog.open({template:"/sp/resources/html/admin/competency/competency-evaluations-dialog.html",scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"ngdialog-theme-default no-overflow no-padding"});sharedProperties.fireAnalyticsEvent("Competency Manager | View Peer Modal",void 0!==evaluationId?"External":"Competency Manager")}else null!==response.error&&sharedProperties.ajaxError(response.error)});document.documentElement.clientWidth<768&&$("body").scrollTop(0)}function viewPeerRatingDetails(index){self.selectedLeftIndex=index,self.peerRatingInfo=self.peerEvaluations[index],$("body .cp-user-ratings-right").animate({scrollTop:$("body .cp-ratings-details").position().top},"slow")}function changeManagerModal(userToProcess,reviewer){self.winHeight=document.documentElement.clientHeight+100+"px",self.initiateEvaluation.submitted=!1,self.inputRequired=!1,self.repeatedRequests=!1,self.multipleManager=!1,self.existingReviewer=!1,self.assignToSelf=!1,self.userToProcess=userToProcess,self.currentManager=reviewer,self.searchTagEmail=[],self.searchTag=[],self.searchTagPeer=[],self.managerFirstName=null,self.managerLastName=null,self.emailMemberList.length||self.getMemberList(),getPeerReviewers(self.userToProcess.id);ngDialog.open({template:self.serviceApis.changeManagerModal,scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"})}function validateReviewerInfo(user,type,managerEmail,peerInfo){if(user.email===managerEmail)return void(self.assignToSelf=!0);for(var i=0;i<peerInfo.length;i++)if(user.email===peerInfo[i].email){self.assignToSelf=!0;break}if(!self.assignToSelf){var tempReviewersList=[];if(tempReviewersList=self.addedReviewersMap[user.id],tempReviewersList.length)if("changeManager"===type||"selfAssignCheck"===type){if(-1!==tempReviewersList.indexOf(managerEmail))return void(self.existingReviewer=!0)}else if("peerRequest"===type)for(var j=0;j<peerInfo.length;j++)if(-1!==tempReviewersList.indexOf(peerInfo[j].email)){self.existingReviewer=!0;break}}}function changeManager(){if(self.initiateEvaluation.submitted=!1,self.inputRequired=!1,self.repeatedRequests=!1,self.multipleManager=!1,self.existingReviewer=!1,self.assignToSelf=!1,void 0===self.searchTagEmail[0])return void(self.inputRequired=!0);if("SELF"===self.userToProcess||(validateReviewerInfo(self.userToProcess,"changeManager",self.searchTagEmail[0].email,[]),!self.existingReviewer&&!self.assignToSelf)){var userForEmail="",obj={},manager={},peerUserList=[];self.initiateEvaluationForm.$valid?(manager={firstName:self.managerFirstName,lastName:self.managerLastName,email:self.searchTagEmail[0].email,existingUserEmail:null===self.managerFirstName?self.searchTagEmail[0].email:""},"SELF"!==self.userToProcess&&(userForEmail=self.userToProcess.email),obj={manager:manager,peerList:peerUserList,userForEmail:userForEmail},ajaxService.getAjaxResponse({url:self.serviceApis.initiateEvaluation,data:obj,headers:{"Content-Type":"application/json"}}).then(function(response){"true"===response.Success?(ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("competency.ajaxSuccess.changeManager")),sharedProperties.fireAnalyticsEvent("Competency Manager | Change Manager","N/A"),$timeout(function(){window.location.reload()},500)):null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})):self.initiateEvaluation.submitted=!0}}function initiatePeerEvaluation(){if(self.initiateEvaluation.submitted=!1,self.existingReviewer=!1,self.assignToSelf=!1,void 0===self.searchTagPeer[0])return void(self.inputRequired=!0);if("SELF"===self.userToProcess||(validateReviewerInfo(self.userToProcess,"peerRequest",null,self.searchTagPeer),!self.existingReviewer&&!self.assignToSelf)){var userForEmail="",obj={},peerUser={},peerUserList=[];if(self.initiateEvaluationForm.$valid){if("SELF"!==self.userToProcess&&(userForEmail=self.userToProcess.email),self.searchTagPeer.length)for(var i=0;i<self.searchTagPeer.length;i++)peerUser={firstName:void 0!==self.searchTagPeer[i].firstName?self.searchTagPeer[i].firstName:"",lastName:void 0!==self.searchTagPeer[i].lastName?self.searchTagPeer[i].lastName:"",email:self.searchTagPeer[i].email,existingUserEmail:void 0!==self.searchTagPeer[i].firstName?self.searchTagPeer[i].email:""},peerUserList.push(peerUser);obj={manager:null,peerList:peerUserList,userForEmail:userForEmail},ajaxService.getAjaxResponse({url:self.serviceApis.initiateEvaluation,data:obj,headers:{"Content-Type":"application/json"}}).then(function(response){"true"===response.Success?(ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("competency.ajaxSuccess.peerEvaluationSent")),sharedProperties.fireAnalyticsEvent("Competency Manager | Request Peer Evaluation","N/A"),$timeout(function(){window.location.reload()},500)):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})}else self.initiateEvaluation.submitted=!0}}function initiateEvaluation(){if(self.initiateEvaluation.submitted=!1,self.repeatedRequests=!1,self.multipleManager=!1,self.existingReviewer=!1,self.assignToSelf=!1,void 0===self.searchTagEmail[0])return void(self.inputRequired=!0);if(self.searchTagEmail.length>1)return void(self.multipleManager=!0);if("SELF"===self.userToProcess||(validateReviewerInfo(self.userToProcess,"selfAssignCheck",self.searchTagEmail[0].email,self.searchTagPeer),!self.existingReviewer&&!self.assignToSelf)){var userForEmail="",obj={},manager={},peerUser={},peerUserList=[];if(self.searchTagPeer.length)for(var i=0;i<self.searchTagPeer.length;i++){if(self.searchTagPeer[i].email===self.searchTagEmail[0].email)return void(self.repeatedRequests=!0);peerUser={firstName:void 0!==self.searchTagPeer[i].firstName?self.searchTagPeer[i].firstName:"",lastName:void 0!==self.searchTagPeer[i].lastName?self.searchTagPeer[i].lastName:"",email:self.searchTagPeer[i].email,existingUserEmail:void 0!==self.searchTagPeer[i].firstName?self.searchTagPeer[i].email:""},peerUserList.push(peerUser)}self.initiateEvaluationForm.$valid?(manager={firstName:self.managerFirstName,lastName:self.managerLastName,email:self.searchTagEmail[0].email,existingUserEmail:null===self.managerFirstName?self.searchTagEmail[0].email:""},"SELF"!==self.userToProcess&&(userForEmail=self.userToProcess.email),obj={manager:manager,peerList:peerUserList,userForEmail:userForEmail},ajaxService.getAjaxResponse({url:self.serviceApis.initiateEvaluation,data:obj,headers:{"Content-Type":"application/json"}}).then(function(response){"true"===response.Success?(ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("competency.ajaxSuccess.initiateEvaluation")),sharedProperties.fireAnalyticsEvent("Competency Manager | Initiate Member Evaluation","N/A"),$timeout(function(){window.location.reload()},500)):null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error))})):self.initiateEvaluation.submitted=!0}}function prev(){0!==self.currentIndex&&(self.currentIndex=self.currentIndex-1,self.selectedCompetency=self.selectedCompetencyList[self.currentIndex])}function next(){self.currentIndex+1!==self.selectedCompetencyList.length&&(self.currentIndex=self.currentIndex+1,self.selectedCompetency=self.selectedCompetencyList[self.currentIndex])}function prevEvaluation(){0!==self.currentIndexForRating&&(self.currentIndexForRating=self.currentIndexForRating-1,self.selectedCompetencyForRating=self.competencyProfileForRating.competencyList[self.currentIndexForRating],self.competencyRatingScore=self.prevScores[self.currentIndexForRating],jQuery('input[type="range"]').val(self.competencyRatingScore).change())}function nextEvaluation(){self.currentIndexForRating+1!==self.competencyProfileForRating.competencyList.length&&(self.currentIndexForRating=self.currentIndexForRating+1,self.selectedCompetencyForRating=self.competencyProfileForRating.competencyList[self.currentIndexForRating],void 0===self.ratingScoreArray[self.currentIndexForRating]?(self.competencyRatingScore=1,self.ratingScoreArray.push(parseFloat(self.competencyRatingScore)),self.prevScores=angular.copy(self.ratingScoreArray)):self.competencyRatingScore=self.ratingScoreArray[self.currentIndexForRating],jQuery('input[type="range"]').val(self.competencyRatingScore).change())}function activateEvaluation(){var _params;if(self.evaluationCheckList=[],self.evaluationChecks.manager&&self.evaluationCheckList.push("Manager"),self.evaluationChecks.self&&self.evaluationCheckList.push("Self"),self.evaluationChecks.peer&&self.evaluationCheckList.push("Peer"),!self.evaluationCheckList.length||!self.competencyUserIds.length||1===self.evaluationCheckList.length&&self.evaluationChecks.peer)return self.activateErrors=!0,!0;self.activateErrors=!1,_params={endDate:new Date(self.evaluationEndDate).toISOString(),requiredEvaluationList:self.evaluationCheckList.toString(),userIds:self.competencyUserIds.toString()},ajaxService.getAjaxResponse({url:self.serviceApis.activateEvaluation,data:$.param(_params)}).then(function(response){"true"===response.Success?(sharedProperties.growlMessage($rootScope.pullInterNationalization("competency.ajaxSuccess.activateEvaluation")),sharedProperties.fireAnalyticsEvent("Competency Manager | Activate Evaluation",self.evaluationCheckList.toString()),$timeout(function(){window.location.reload()},1500)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function endEvaluation(){ajaxService.getAjaxResponse({url:self.serviceApis.endEvaluation}).then(function(response){"true"===response.Success?(ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("competency.ajaxSuccess.endEvaluation")),sharedProperties.fireAnalyticsEvent("Competency Manager | End Evaluation","N/A"),$timeout(function(){window.location.reload()},1500)):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})}function loadTags(query){var deferred=$q.defer(),result=self.emailMemberList.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise}function tagAddedManager(tag){void 0!==tag&&(self.searchTag.push(tag.email),self.searchTagEmail.push(tag),self.inputRequired=!1),angular.element($(".tagsManagerInput .input")).css("visibility","hidden")}function tagRemovedManager(tag){self.searchTag.splice(self.searchTag.indexOf(tag.email),1),self.searchTagEmail.splice(self.searchTagEmail.indexOf(tag),1),angular.element($(".tagsManagerInput .input")).css("visibility","visible"),self.repeatedRequests=!1,self.existingReviewer=!1,self.assignToSelf=!1,self.managerFirstName=null,self.managerLastName=null}function tagAddedPeer(tag){void 0!==tag&&(self.searchTag.push(tag.email),self.searchTagPeer.push(tag),self.inputRequired=!1)}function tagRemovedPeer(tag){self.searchTag.splice(self.searchTag.indexOf(tag.email),1),sharedProperties.spilceIndexWithBreak(self.searchTagPeer,"email",tag.email),self.repeatedRequests=!1,self.existingReviewer=!1,self.assignToSelf=!1}function order(predicate,reverse){self.pageVariables.lastPredicate=predicate,self.pageVariables.lastReverse=reverse;for(var i=0;i<self.competencyUsers.length;i++)switch(predicate){case"selfScore":reverse?null!==self.competencyUsers[i].manager&&null===self.competencyUsers[i].self?self.competencyUsers[i].selfScore=0:null===self.competencyUsers[i].manager&&null===self.competencyUsers[i].self&&(self.competencyUsers[i].selfScore=-1):null!==self.competencyUsers[i].manager&&null===self.competencyUsers[i].self?self.competencyUsers[i].selfScore=11:null===self.competencyUsers[i].manager&&null===self.competencyUsers[i].self&&(self.competencyUsers[i].selfScore=12);break;case"managerScore":reverse?null!==self.competencyUsers[i].manager&&0===self.competencyUsers[i].manager.score?self.competencyUsers[i].managerScore=0:null===self.competencyUsers[i].manager&&(self.competencyUsers[i].managerScore=-1):null!==self.competencyUsers[i].manager&&0===self.competencyUsers[i].manager.score?self.competencyUsers[i].managerScore=11:null===self.competencyUsers[i].manager&&(self.competencyUsers[i].managerScore=12);break;case"peerScore":reverse?null!==self.competencyUsers[i].peers&&0===self.competencyUsers[i].peers.score?self.competencyUsers[i].peerScore=0:null===self.competencyUsers[i].peers&&(self.competencyUsers[i].peerScore=-1):null!==self.competencyUsers[i].peers&&0===self.competencyUsers[i].peers.score?self.competencyUsers[i].peerScore=11:null===self.competencyUsers[i].peers&&(self.competencyUsers[i].peerScore=12)}self.competencyUsers=$filter("orderBy")(self.competencyUsers,predicate,reverse)}function searchTextFilter(search){self.pageVariables.textSearching=search,self.returnMemberList()}function active(event,setting){self.pageVariables.lastPredicate=setting.predicate,self.pageVariables.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.pageVariables.lastPredicate),self.order(self.pageVariables.lastPredicate,self.pageVariables.lastReverse)}function sortManagerData(event,setting){self.pageVariables.lastPredicate=setting.predicate,self.pageVariables.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.pageVariables.lastPredicate),self.competencyEvaluationRequests=$filter("orderBy")(self.competencyEvaluationRequests,self.pageVariables.lastPredicate,self.pageVariables.lastReverse)}function resetfilter(){self.pageVariables=angular.copy(self.originalpageVariables),self.returnMemberList();var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")}var self=this;self.serviceApis={getCompetencyProfile:"/sp/competency/manager/get",previewRating:"/sp/admin/competency/rating/preview",activateEvaluation:"/sp/competency/manager/activateEvaluation",endEvaluation:"/sp/competency/manager/endEvaluation",getAllUsers:"/sp/allUsers",initiateEvaluation:"/sp/competency/evaluation/feedback/initiate",initiateEvaluationModal:"/sp/competency/evaluation/feedback/initiateEvaluationModal",getEvaluationRequests:"/sp/competency/evaluation/feedback/requests",startEvaluation:"/sp/competency/evaluation/feedback/start",startEvaluationModal:"/sp/competency/evaluation/feedback/ratingModal",saveEvaluation:"/sp/competency/evaluation/feedback/save",ratingDetailsModal:"/sp/competency/evaluation/feedback/getEvaluationDetailsModal",getRatingDetails:"/sp/competency/evaluation/feedback/getEvaluationDetails",sendReminderModal:"/sp/competency/evaluation/feedback/sendReminder/modal",sendReminder:"/sp/competency/evaluation/feedback/sendReminder",changeManagerModal:"/sp/admin/competency/changeManager/modal",getAllUsersForCompetency:"/sp/competency/manager/getUsers",addUserToEvaluation:"/sp/competency/manager/addUserToEvaluation",removeUserFromCompetency:"/sp/competency/manager/removeUserFromEvaluation",getPastEvaluations:"/sp/competency/manager/getEvaluationList",getViewByCompetencyProfiles:"/sp/competency/manager/getViewByCompetencyProfiles",getViewByCompetencyProfileDetails:"/sp/competency/manager/getCompetencyProfileDetails",getCompetencyEvaluationUsers:"/sp/competency/manager/getCompetencyProfileEvaluationUsers",getViewByMembers:"/sp/competency/manager/getViewByMembers",getUserCompetencies:"/sp/competency/manager/getUserCompetencies",getUserCompetencyEvaluations:"/sp/competency/manager/getUserCompetencyEvaluations",getPeerEvaluationDetails:"/sp/competency/manager/getCompetencyEvaluationPeerRequests",getManagerResults:"/sp/competency/evaluation/manager/get",peerEvaluationForManager:"/sp/competency/evaluation/manager/peerDetails",peerEvaluationDetailsExt:"/sp/competency/evaluation/feedback/peerDetails"},self.pageVariables={pageSize:10,searchText:"",disabledInfinite:!1,lastPredicate:"lastName",lastReverse:!1,userGroupSelected:[],selectedManagers:[],evaluationStatusSelected:[],selectedCompetencyProfileId:"",selectedCompetencyAttribute:[],searchGroupsFilters:"",searchManagersFilters:"",searchCompetencyFilters:"",heightParam:800},self.filterOptions={allCompetencyProfiles:[],allCompetencyAttributes:[],allGroupsFilter:[],managersList:[],selfEvaluationStatus:[],managerEvaluationStatus:[]},self.selectedFilterList=[],self.responseAvailable=!1,self.originalpageVariables=angular.copy(self.pageVariables),self.selectedCompetencyProfileId="",self.selectedCompetencyProfileName="",self.competencyNameMap={},self.competencyEvaluationMap={},self.selectedCompetencyList=[],self.selectedCompetency={},self.currentIndex=0,self.currentIndexForRating=0,self.userEvaluationList=[],self.currentDate=new Date,self.evaluationEndDate=new Date,self.evaluationDisplayDate=new Date,self.competencyEvaluation={},self.competencyMembersView=!1,self.managerView=!1,self.evaluationChecks={manager:!1,self:!1,peer:!1},self.evaluationCheckList=[],self.activateErrors=!1,self.searchTagEmail=[],self.emailMemberList=[],self.searchTag=[],self.searchTagPeer=[],self.initiateEvaluation={submitted:!1},self.inputRequired=!1,self.multipleManager=!1,self.repeatedRequests=!1,self.existingReviewer=!1,self.assignToSelf=!1,self.peerOnlyEvaluation=!0,self.initiateRequestType="",self.userToProcess={},self.competencyEvaluationRequests=[],self.competencyProfileForRating={},self.selectedCompetencyForRating={},self.userToBeAssessed={},self.userType="",self.ratingScoreArray=[],self.competencyRatingScore=1,self.scoreDetails={},self.reminderInfo={},self.currentManager={},self.showSelfRating=!1,self.showPeerRating=!1,self.showManagerRating=!1,self.competencyAdminDefaultView=!1,self.addedReviewersMap={},self.reviewersList=[],self.competencyRangeSlider=1,self.prevScores=[],self.managerFirstName=null,self.managerLastName=null,self.ratingChar=9,self.ratingScalePercent=0,self.masterCompetencyUsers=[],self.competencyUsers=[],self.masterCopy=!0,self.masterUserIdsList=[],self.addedUserIds=[],self.peerViewUser={},self.evaluationsView={manager:!0,self:!0,peers:!0},self.ratingsCount={self:{completed:0,total:0},manager:{completed:0,total:0},peers:{completed:0,total:0}},self.selectedLeftIndex=0,self.getCompetencyProfile=getCompetencyProfile,self.previewRating=previewRating,self.searchTextFilter=searchTextFilter,self.active=active,self.sortManagerData=sortManagerData,self.order=order,self.resetfilter=resetfilter,self.prev=prev,self.next=next,self.prevEvaluation=prevEvaluation,self.nextEvaluation=nextEvaluation,self.activateEvaluation=activateEvaluation,self.endEvaluation=endEvaluation,self.endEvaluationModal=endEvaluationModal,self.initiateEvaluationModal=initiateEvaluationModal,self.tagRemovedManager=tagRemovedManager,self.loadTags=loadTags,self.tagAddedManager=tagAddedManager,self.getMemberList=getMemberList,self.tagRemovedPeer=tagRemovedPeer,self.tagAddedPeer=tagAddedPeer,self.initiateEvaluation=initiateEvaluation,self.getEvaluationRequests=getEvaluationRequests,self.startEvaluation=startEvaluation,self.saveEvaluation=saveEvaluation,self.openRatingDetailsModal=openRatingDetailsModal,self.sendReminderModal=sendReminderModal,self.sendReminder=sendReminder,self.changeManagerModal=changeManagerModal,self.changeManager=changeManager,self.initiatePeerEvaluation=initiatePeerEvaluation,self.validateReviewerInfo=validateReviewerInfo,self.isMobile=!($(window).width()>767),self.toggleRowById=toggleRowById,self.activeRow=-1,self.winHeight=document.documentElement.clientHeight+100+"px",self.winWidth=$(window).width(),self.competencyUsersList=[],self.competencyUserIds=[],self.competencySearchList=[],self.masterUserList=[],self.userGroupMap={},self.userCompetencyMap={},self.individualUserMap={},self.selectedSearchList=[],self.userSearchText="",self.competencyObjMap={},self.competencyEvaluation={},self.competencyEvaluationInProgress=!0,self.pastEvaluations=!1,self.competencyProfileMap={},self.removeUserId=null,self.pastEvaluationsList=[],self.activateView=!1,self.activateOption="competency",self.activateOptionCompetencyList=[],self.activateOptionGroupList=[],self.activateOptionUserList=[],self.competencyUserCountMap={},self.scoreEvaluationList=[],self.viewByOption="",self.viewByCompetenciesList=[],self.viewByMembersList=[],self.viewBySelectedMembersList=[],self.viewByUserGroupMap={},self.competencyListingView=!0,self.viewByCompetencyView=!1,self.viewByMembersView=!1,self.evaluationDetails={},self.competencyEvaluationUsers=[],self.userEvaluationDetails={},self.userCompetencyEvaluationMap={},self.userCompetencyProfileMap={},self.userCompetencyEvaluations=[],self.viewByCompetencyType="evaluations",self.viewByMembersType="users",self.selectedUser={},self.peerViewState="",self.peerEvaluations=[],self.peerRatingInfo={},self.managerResult={},self.disableCheckbox={manager:!1,self:!1,peers:!1},self.selectedViewByEvaluation={},self.peerReviewersMap={},self.viewByPageSize1={count:10,disabledInfinite:!1},self.viewByPageSize2={count:10,disabledInfinite:!1},self.viewByPageSize3={count:10,disabledInfinite:!1},self.viewByPageSize4={count:10,disabledInfinite:!1},self.activeToggleId=-1,self.prepareUserListForCompetency=prepareUserListForCompetency,self.addToUserList=addToUserList,self.removeUserFromList=removeUserFromList,self.removeUserFromEvaluationModal=removeUserFromEvaluationModal,self.removeUserFromEvaluation=removeUserFromEvaluation,self.addUserToEvaluationModal=addUserToEvaluationModal,self.addUserToEvaluation=addUserToEvaluation,self.getPastEvaluations=getPastEvaluations,self.changeCompetencyEvaluation=changeCompetencyEvaluation,self.toggleActivateOption=toggleActivateOption,self.toggleViewBy=toggleViewBy,self.getViewByCompetencyDetails=getViewByCompetencyDetails,self.getCompetencyEvaluationUsers=getCompetencyEvaluationUsers,self.getUserCompetencies=getUserCompetencies,self.getUserCompetencyEvaluations=getUserCompetencyEvaluations,self.addToViewByMemberList=addToViewByMemberList,self.removeFromViewByMemberList=removeFromViewByMemberList,self.viewPeerRatingDetails=viewPeerRatingDetails,self.getManagerResult=getManagerResult,self.peerEvaluationForManager=peerEvaluationForManager,self.checkboxState=checkboxState,self.sharedProperties=sharedProperties,self.infiniteScroll=infiniteScroll,self.togglePeerModalState=togglePeerModalState,self.viewByInfiniteScroll=viewByInfiniteScroll,self.genericPrint=function(type){/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&eventSourceProvider.closeEventSource(),$rootScope.$broadcast("httpLoaderStart"),self.viewByCompetencyView?"evaluations"===self.viewByCompetencyType?(self.viewByPageSize1.disabledInfinite=!0,self.viewByPageSize1.count=self.evaluationDetails.evaluationResults.length,type="viewByProfileEvaluations"):(self.viewByPageSize2.disabledInfinite=!0,self.viewByPageSize2.count=self.competencyEvaluationUsers.length,type="viewByProfileUsers"):self.viewByMembersView?"evaluations"===self.viewByMembersType?(self.viewByPageSize4.disabledInfinite=!0,self.viewByPageSize4.count=self.userCompetencyEvaluations.length,
type="viewByMemberEvaluations"):(self.viewByPageSize3.disabledInfinite=!0,self.viewByPageSize3.count=self.userEvaluationDetails.length,type="viewByMemberUsers"):self.competencyListingView&&(self.pageVariables.disabledInfinite=!0,self.pageVariables.pageSize=self.competencyUsers.length),$timeout(function(){$rootScope.$broadcast("httpLoaderEnd"),window.print(),sharedProperties.fireAnalyticsEvent("Competency Manager | Print Report",type)},1e3)},self.toggleSection=function(ele,id){id!==self.activeToggleId?self.activeToggleId=id:self.activeToggleId=-1,$(ele).slideToggle("normal")},$("body").on("click","#custom-slide-pane",function(){self.selectedViewByCompetencyId="",self.viewByCompetenciesList.length||getViewByCompetency(),$("#custom-slide-1").animate({left:"-=320px"}),$("#custom-slide-2").animate({left:"-=320px"})}),$("body").on("click","#custom-slide-pane-1",function(){$("#custom-slide-2").animate({left:"+=320px"}),$("#custom-slide-1").animate({left:"+=320px"}),$scope.$apply(function(){self.pageVariables.pageSize=self.originalpageVariables.pageSize,self.pageVariables.searchText=self.originalpageVariables.searchText,self.viewByCompetencyView=!1,self.competencyListingView=!0,self.viewByMembersView=!1,self.selectedViewByCompetencyId="",self.viewByMembersList=[],self.viewBySelectedMembersList=[],self.viewByOption=""})}),self.memberSearchFilter=function(obj){var match=new RegExp(self.pageVariables.searchText,"i");return""!==self.pageVariables.searchText&&self.pageVariables.searchText.length>1?match.test(obj.email)||match.test(obj.firstName)||match.test(obj.lastName)||match.test(obj.title)||match.test(obj.competencyName):obj},self.closeViewBy2Section=function(){self.viewByCompetencyType="evaluations",self.viewByPageSize1={count:10,disabledInfinite:!1}},self.closeViewBy4Section=function(){self.viewByMembersType="users",self.viewByPageSize3={count:10,disabledInfinite:!1}},self.closeActivateView=function(){window.location.reload()};var getViewByCompetency=function(){ajaxService.getAjaxResponse({url:self.serviceApis.getViewByCompetencyProfiles}).then(function(response){"true"===response.Success?(self.viewByCompetenciesList=response.competencyEvaluation,self.viewByCompetenciesList=$filter("orderBy")(self.viewByCompetenciesList,"name",!1),self.viewByCompetenciesList.unshift({id:"",name:"Select Competency Profile"})):null!==response.error&&sharedProperties.ajaxError(response.error)})},getViewByMembers=function(){var competencyUserObject={},tempGroupsUserList=[];self.viewByMembersList.length||ajaxService.getAjaxResponse({url:self.serviceApis.getViewByMembers}).then(function(response){if("true"===response.Success){for(var i=0;i<response.user.length;i++)if(competencyUserObject={},competencyUserObject.id=response.user[i].id,competencyUserObject.name=response.user[i].name,competencyUserObject.type="member",self.viewByMembersList.push(competencyUserObject),null!==response.user[i].groupIds&&response.user[i].groupIds.length>0)for(var kk=0;kk<response.user[i].groupIds.length;kk++)void 0===self.viewByUserGroupMap[response.user[i].groupIds[kk]]?(tempGroupsUserList=[],tempGroupsUserList.push(response.user[i]),self.viewByUserGroupMap[response.user[i].groupIds[kk]]=tempGroupsUserList):(tempGroupsUserList=[],tempGroupsUserList=self.viewByUserGroupMap[response.user[i].groupIds[kk]],tempGroupsUserList.push(response.user[i]),self.viewByUserGroupMap[response.user[i].groupIds[kk]]=tempGroupsUserList);for(var k=0;k<response.groups.length;k++)competencyUserObject={},competencyUserObject.id=response.groups[k].id,competencyUserObject.name=response.groups[k].name,competencyUserObject.type="groups",self.viewByMembersList.push(competencyUserObject)}else null!==response.error&&sharedProperties.ajaxError(response.error)})},getUsersForActivate=function(type){var competencySearchObject={},tempCompetencyUserList=[],tempGroupsUserList=[];ajaxService.getAjaxResponse({url:self.serviceApis.getAllUsersForCompetency}).then(function(response){if("true"===response.Success)if(self.masterUserList=angular.copy(response.user),self.masterUserList.length>0){for(var i=0;i<response.user.length;i++)if(self.individualUserMap[response.user[i].id]=response.user[i],competencySearchObject={},competencySearchObject.id=response.user[i].id,competencySearchObject.name=response.user[i].name,competencySearchObject.type="users",self.activateOptionUserList.push(competencySearchObject),void 0===self.userCompetencyMap[response.user[i].competencyProfileId]?(tempCompetencyUserList=[],tempCompetencyUserList.push(response.user[i]),self.userCompetencyMap[response.user[i].competencyProfileId]=tempCompetencyUserList):(tempCompetencyUserList=[],tempCompetencyUserList=self.userCompetencyMap[response.user[i].competencyProfileId],tempCompetencyUserList.push(response.user[i]),self.userCompetencyMap[response.user[i].competencyProfileId]=tempCompetencyUserList),null!==response.user[i].groupIds&&response.user[i].groupIds.length>0)for(var kk=0;kk<response.user[i].groupIds.length;kk++)void 0===self.userGroupMap[response.user[i].groupIds[kk]]?(tempGroupsUserList=[],tempGroupsUserList.push(response.user[i]),self.userGroupMap[response.user[i].groupIds[kk]]=tempGroupsUserList):(tempGroupsUserList=[],tempGroupsUserList=self.userGroupMap[response.user[i].groupIds[kk]],tempGroupsUserList.push(response.user[i]),self.userGroupMap[response.user[i].groupIds[kk]]=tempGroupsUserList);for(var j=0;j<response.competencyProfile.length;j++)competencySearchObject={},competencySearchObject.id=response.competencyProfile[j].id,competencySearchObject.name=response.competencyProfile[j].name,competencySearchObject.type="competency",self.activateOptionCompetencyList.push(competencySearchObject),self.competencyObjMap[response.competencyProfile[j].id]=response.competencyProfile[j];for(var k=0;k<response.groups.length;k++)competencySearchObject={},competencySearchObject.id=response.groups[k].id,competencySearchObject.name=response.groups[k].name,competencySearchObject.type="groups",self.activateOptionGroupList.push(competencySearchObject);if("addMemberFlow"===type){self.activateOption="users",self.competencySearchList=angular.copy(self.activateOptionUserList);ngDialog.open({template:"/sp/resources/html/admin/competency/add-member-to-evaluation.html",scope:$scope})}else"activateFlow"===type&&(self.responseAvailable=!0,self.competencySearchList=angular.copy(self.activateOptionCompetencyList),self.activateView=!0)}else sharedProperties.growlMessage($rootScope.pullInterNationalization("competency.admin.profile.noUsers"),"","glyphicon glyphicon-ban-circle")})};self.prepareDatePicker=function(){var dateTime=moment().add(1,"days").toDate();self.evaluationEndDate=moment(dateTime).format("MM/DD/YYYY"),self.evaluationDisplayDate=moment(dateTime).format("MMM DD, YYYY"),moment.locale(sharedProperties.provideVendorSpecificLocale("datePicker")),$('input[name="endDate"]').daterangepicker({showDropdowns:!1,minDate:moment().add(1,"days").toDate(),startDate:moment().add(1,"days").toDate(),locale:{format:"MM/DD/YYYY"},alwaysShowCalendars:!0,singleDatePicker:!0,opens:"right"},function(start,end,label){$scope.$apply(function(){self.evaluationEndDate=moment.utc(start.format("MM/DD/YYYY"),"MM/DD/YYYY").format(),self.evaluationDisplayDate=start.format("MMM DD, YYYY")})})},self.returnMemberList=function(){if(!self.masterCompetencyUsers.length)return self.competencyUsers=angular.copy(self.masterCompetencyUsers),!0;self.pageVariables.pageSize=self.originalpageVariables.pageSize,self.pageVariables.disabledInfinite=!1;var result=self.masterCopy?self.masterCompetencyUsers:self.competencyUsers;self.competencyUsers=result.filter(function(e){return(self.pageVariables.userGroupSelected.length&&filterByGroups(self.pageVariables.userGroupSelected,e.groupIds)||!self.pageVariables.userGroupSelected.length&&e)&&(self.pageVariables.selectedManagers.length&&filterByManager(self.pageVariables.selectedManagers,e.manager)||!self.pageVariables.selectedManagers.length&&e)&&(self.pageVariables.evaluationStatusSelected.length&&filterByEvaluationStatus(self.pageVariables.evaluationStatusSelected,e)||!self.pageVariables.evaluationStatusSelected.length&&e)&&(""!==self.pageVariables.selectedCompetencyProfileId&&e.competencyProfileId===self.pageVariables.selectedCompetencyProfileId||""===self.pageVariables.selectedCompetencyProfileId&&e)}),self.order(self.pageVariables.lastPredicate,self.pageVariables.lastReverse),""!==self.pageVariables.selectedCompetencyProfileId&&self.competencyAttributeCheck(),""!==self.pageVariables.searchText&&(self.competencyUsers=filterFilter(self.competencyUsers,self.pageVariables.searchText)),self.masterCopy=!0},self.getCompetenciesForFilter=function(){self.pageVariables.selectedCompetencyAttribute=[],self.filterOptions.allCompetencyAttributes=[];for(var i=0;i<self.filterOptions.allCompetencyProfiles.length;i++)if(self.filterOptions.allCompetencyProfiles[i].id===self.pageVariables.selectedCompetencyProfileId){self.filterOptions.allCompetencyAttributes=self.filterOptions.allCompetencyProfiles[i].competencyList;break}self.returnMemberList(self.pageVariables.pageSize)},self.competencyAttributeCheck=function(){var tempList=[],tempUserList=[];if(self.pageVariables.selectedCompetencyAttribute.length){for(var a=0;a<self.pageVariables.selectedCompetencyAttribute.length;a++)tempList.push(self.pageVariables.selectedCompetencyAttribute[a].name);tempUserList=angular.copy(self.competencyUsers);for(var ii=0;ii<tempUserList.length;ii++){var selfAverageScore=0,managerAverageScore=0,peerAverageScore=0;if(self.showSelfRating&&null!==tempUserList[ii].self&&null!==tempUserList[ii].self.scoreArray){for(var aa=0;aa<self.pageVariables.selectedCompetencyAttribute.length;aa++)selfAverageScore+=tempUserList[ii].self.cumulativeAverage[self.pageVariables.selectedCompetencyAttribute[aa].name];tempUserList[ii].self.score=parseFloat((selfAverageScore/self.pageVariables.selectedCompetencyAttribute.length).toFixed(2))}if(self.showManagerRating&&null!==tempUserList[ii].manager&&null!==tempUserList[ii].manager.scoreArray){for(var bb=0;bb<self.pageVariables.selectedCompetencyAttribute.length;bb++)managerAverageScore+=tempUserList[ii].manager.cumulativeAverage[self.pageVariables.selectedCompetencyAttribute[bb].name];tempUserList[ii].manager.score=parseFloat((managerAverageScore/self.pageVariables.selectedCompetencyAttribute.length).toFixed(2))}if(self.showPeerRating&&null!==tempUserList[ii].peers&&null!==tempUserList[ii].peers.scoreArray){for(var cc=0;cc<self.pageVariables.selectedCompetencyAttribute.length;cc++)peerAverageScore+=tempUserList[ii].peers.cumulativeAverage[self.pageVariables.selectedCompetencyAttribute[cc].name];tempUserList[ii].peers.score=parseFloat((peerAverageScore/self.pageVariables.selectedCompetencyAttribute.length).toFixed(2))}}self.competencyUsers=angular.copy(tempUserList);for(var j=0;j<self.competencyProfileMap[self.pageVariables.selectedCompetencyProfileId].competencyList.length;j++)-1!==tempList.indexOf(self.competencyProfileMap[self.pageVariables.selectedCompetencyProfileId].competencyList[j].name)?self.competencyProfileMap[self.pageVariables.selectedCompetencyProfileId].competencyList[j].show=!0:self.competencyProfileMap[self.pageVariables.selectedCompetencyProfileId].competencyList[j].show=!1}else for(var jj=0;jj<self.competencyProfileMap[self.pageVariables.selectedCompetencyProfileId].competencyList.length;jj++)self.competencyProfileMap[self.pageVariables.selectedCompetencyProfileId].competencyList[jj].show=!0},self.includeCheck=function(param,setting,cache){var i=$.inArray(param,self.pageVariables[setting]);i>-1?self.pageVariables[setting].splice(i,1):(self.pageVariables[setting].push(param),self.masterCopy=!cache),self.manageFilterDisplayList(setting),self.returnMemberList(self.pageVariables.pageSize)},self.closeRest=function(index,noScroll){var val=void 0===noScroll?0:1;$(".accordian-checkbox").each(function(i){i!==$(index.currentTarget.parentNode).index()-val&&$(this).prop("checked",!0)})},self.clear=function(classS,property,search){if("selectedCompetencyProfileId"===property){for(var i=0;i<self.competencyProfileMap[self.pageVariables.selectedCompetencyProfileId].competencyList.length;i++)self.competencyProfileMap[self.pageVariables.selectedCompetencyProfileId].competencyList[i].show=!0;self.pageVariables.selectedCompetencyProfileId="",self.pageVariables.selectedCompetencyAttribute=[],self.filterOptions.allCompetencyAttributes=[]}else self.pageVariables[property]=[];self.manageFilterDisplayList(property),void 0!==search&&(self.pageVariables[search]=""),$(classS).each(function(v,i){$(this).prop("checked",!1)}),self.returnMemberList()},self.calculateHeight=function(event){var obj=$("#"+event);obj.height()>self.pageVariables.heightParam&&obj.addClass("scroller")},self.manageFilterDisplayList=function(filterSetting){var existing=$.inArray(filterSetting,self.selectedFilterList),isArray=$.isArray(self.pageVariables[filterSetting]),settingLength=self.pageVariables[filterSetting]?self.pageVariables[filterSetting].length:0,settingFlag=self.pageVariables[filterSetting];isArray&&settingLength>0?-1===existing&&self.selectedFilterList.push(filterSetting):isArray&&0===settingLength?-1!==existing&&self.selectedFilterList.splice(existing,1):isArray||!1===settingFlag||/false/.test(settingFlag)?isArray||!1!==settingFlag&&!/false/.test(settingFlag)||-1!==existing&&self.selectedFilterList.splice(existing,1):-1===existing&&self.selectedFilterList.push(filterSetting)};var getPeerReviewers=function(userId){if(void 0===self.peerReviewersMap[userId]){var tempReviewersList=[];ajaxService.getAjaxResponse({url:self.serviceApis.getPeerEvaluationDetails,data:$.param({userId:userId,competencyEvaluationId:self.competencyEvaluation.id})}).then(function(response){if("true"===response.Success){self.peerEvaluations=response.competencyEvaluation,tempReviewersList=self.addedReviewersMap[userId];for(var peer=0;peer<self.peerEvaluations.length;peer++)tempReviewersList.push(self.peerEvaluations[peer].reviewer.email);self.addedReviewersMap[userId]=tempReviewersList,self.peerReviewersMap[userId]=!0}else null!==response.error&&sharedProperties.ajaxError(response.error)})}};self.sortViewByData1=function(event,setting){self.pageVariables.lastPredicate=setting.predicate,self.pageVariables.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.pageVariables.lastPredicate);for(var i=0;i<self.evaluationDetails.evaluationResults.length;i++)switch(self.pageVariables.lastPredicate){case"selfScore":self.pageVariables.lastReverse?void 0!==self.evaluationDetails.evaluationResults[i].averageScores.Self&&0===self.evaluationDetails.evaluationResults[i].averageScores.Self.score?self.evaluationDetails.evaluationResults[i].selfScore=0:void 0===self.evaluationDetails.evaluationResults[i].averageScores.Self&&(self.evaluationDetails.evaluationResults[i].selfScore=-1):void 0!==self.evaluationDetails.evaluationResults[i].averageScores.Self&&0===self.evaluationDetails.evaluationResults[i].averageScores.Self.score?self.evaluationDetails.evaluationResults[i].selfScore=11:void 0===self.evaluationDetails.evaluationResults[i].averageScores.Self&&(self.evaluationDetails.evaluationResults[i].selfScore=12);break;case"managerScore":self.pageVariables.lastReverse?void 0!==self.evaluationDetails.evaluationResults[i].averageScores.Manager&&0===self.evaluationDetails.evaluationResults[i].averageScores.Manager.score?self.evaluationDetails.evaluationResults[i].managerScore=0:void 0===self.evaluationDetails.evaluationResults[i].averageScores.Manager&&(self.evaluationDetails.evaluationResults[i].managerScore=-1):void 0!==self.evaluationDetails.evaluationResults[i].averageScores.Manager&&0===self.evaluationDetails.evaluationResults[i].averageScores.Manager.score?self.evaluationDetails.evaluationResults[i].managerScore=11:void 0===self.evaluationDetails.evaluationResults[i].averageScores.Manager&&(self.evaluationDetails.evaluationResults[i].managerScore=12);break;case"peerScore":self.pageVariables.lastReverse?void 0!==self.evaluationDetails.evaluationResults[i].averageScores.Peer&&0===self.evaluationDetails.evaluationResults[i].averageScores.Peer.score?self.evaluationDetails.evaluationResults[i].peerScore=0:void 0===self.evaluationDetails.evaluationResults[i].averageScores.Peer&&(self.evaluationDetails.evaluationResults[i].peerScore=-1):void 0!==self.evaluationDetails.evaluationResults[i].averageScores.Peer&&0===self.evaluationDetails.evaluationResults[i].averageScores.Peer.score?self.evaluationDetails.evaluationResults[i].peerScore=11:void 0===self.evaluationDetails.evaluationResults[i].averageScores.Peer&&(self.evaluationDetails.evaluationResults[i].peerScore=12)}self.evaluationDetails.evaluationResults=$filter("orderBy")(self.evaluationDetails.evaluationResults,self.pageVariables.lastPredicate,self.pageVariables.lastReverse)},self.sortViewByData2=function(event,setting){self.pageVariables.lastPredicate=setting.predicate,self.pageVariables.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.pageVariables.lastPredicate);for(var i=0;i<self.competencyEvaluationUsers.length;i++)switch(self.pageVariables.lastPredicate){case"selfScore":self.pageVariables.lastReverse?null!==self.competencyEvaluationUsers[i].manager&&null===self.competencyEvaluationUsers[i].self?self.competencyEvaluationUsers[i].selfScore=0:null===self.competencyEvaluationUsers[i].manager&&null===self.competencyEvaluationUsers[i].self&&(self.competencyEvaluationUsers[i].selfScore=-1):null!==self.competencyEvaluationUsers[i].manager&&null===self.competencyEvaluationUsers[i].self?self.competencyEvaluationUsers[i].selfScore=11:null===self.competencyEvaluationUsers[i].manager&&null===self.competencyEvaluationUsers[i].self&&(self.competencyEvaluationUsers[i].selfScore=12);break;case"managerScore":self.pageVariables.lastReverse?null!==self.competencyEvaluationUsers[i].manager&&0===self.competencyEvaluationUsers[i].manager.score?self.competencyEvaluationUsers[i].managerScore=0:null===self.competencyEvaluationUsers[i].manager&&(self.competencyEvaluationUsers[i].managerScore=-1):null!==self.competencyEvaluationUsers[i].manager&&0===self.competencyEvaluationUsers[i].manager.score?self.competencyEvaluationUsers[i].managerScore=11:null===self.competencyEvaluationUsers[i].manager&&(self.competencyEvaluationUsers[i].managerScore=12);break;case"peerScore":self.pageVariables.lastReverse?null!==self.competencyEvaluationUsers[i].peers&&0===self.competencyEvaluationUsers[i].peers.score?self.competencyEvaluationUsers[i].peerScore=0:null===self.competencyEvaluationUsers[i].peers&&(self.competencyEvaluationUsers[i].peerScore=-1):null!==self.competencyEvaluationUsers[i].peers&&0===self.competencyEvaluationUsers[i].peers.score?self.competencyEvaluationUsers[i].peerScore=11:null===self.competencyEvaluationUsers[i].peers&&(self.competencyEvaluationUsers[i].peerScore=12)}self.competencyEvaluationUsers=$filter("orderBy")(self.competencyEvaluationUsers,self.pageVariables.lastPredicate,self.pageVariables.lastReverse)},self.sortViewByData3=function(event,setting){self.pageVariables.lastPredicate=setting.predicate,self.pageVariables.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.pageVariables.lastPredicate);for(var i=0;i<self.userEvaluationDetails.length;i++)switch(self.pageVariables.lastPredicate){case"selfScore":self.pageVariables.lastReverse?null!==self.userEvaluationDetails[i].manager&&null===self.userEvaluationDetails[i].self?self.userEvaluationDetails[i].selfScore=0:null===self.userEvaluationDetails[i].manager&&null===self.userEvaluationDetails[i].self&&(self.userEvaluationDetails[i].selfScore=-1):null!==self.userEvaluationDetails[i].manager&&null===self.userEvaluationDetails[i].self?self.userEvaluationDetails[i].selfScore=11:null===self.userEvaluationDetails[i].manager&&null===self.userEvaluationDetails[i].self&&(self.userEvaluationDetails[i].selfScore=12);break;case"managerScore":self.pageVariables.lastReverse?null!==self.userEvaluationDetails[i].manager&&0===self.userEvaluationDetails[i].manager.score?self.userEvaluationDetails[i].managerScore=0:null===self.userEvaluationDetails[i].manager&&(self.userEvaluationDetails[i].managerScore=-1):null!==self.userEvaluationDetails[i].manager&&0===self.userEvaluationDetails[i].manager.score?self.userEvaluationDetails[i].managerScore=11:null===self.userEvaluationDetails[i].manager&&(self.userEvaluationDetails[i].managerScore=12);break;case"peerScore":self.pageVariables.lastReverse?null!==self.userEvaluationDetails[i].peers&&0===self.userEvaluationDetails[i].peers.score?self.userEvaluationDetails[i].peerScore=0:null===self.userEvaluationDetails[i].peers&&(self.userEvaluationDetails[i].peerScore=-1):null!==self.userEvaluationDetails[i].peers&&0===self.userEvaluationDetails[i].peers.score?self.userEvaluationDetails[i].peerScore=11:null===self.userEvaluationDetails[i].peers&&(self.userEvaluationDetails[i].peerScore=12)}self.userEvaluationDetails=$filter("orderBy")(self.userEvaluationDetails,self.pageVariables.lastPredicate,self.pageVariables.lastReverse)},self.sortViewByData4=function(event,setting){self.pageVariables.lastPredicate=setting.predicate,self.pageVariables.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.pageVariables.lastPredicate);for(var i=0;i<self.userCompetencyEvaluations.length;i++)switch(self.pageVariables.lastPredicate){case"selfScore":self.pageVariables.lastReverse?null!==self.userCompetencyEvaluations[i].manager&&null===self.userCompetencyEvaluations[i].self?self.userCompetencyEvaluations[i].selfScore=0:null===self.userCompetencyEvaluations[i].manager&&null===self.userCompetencyEvaluations[i].self&&(self.userCompetencyEvaluations[i].selfScore=-1):null!==self.userCompetencyEvaluations[i].manager&&null===self.userCompetencyEvaluations[i].self?self.userCompetencyEvaluations[i].selfScore=11:null===self.userCompetencyEvaluations[i].manager&&null===self.userCompetencyEvaluations[i].self&&(self.userCompetencyEvaluations[i].selfScore=12);break;case"managerScore":self.pageVariables.lastReverse?null!==self.userCompetencyEvaluations[i].manager&&0===self.userCompetencyEvaluations[i].manager.score?self.userCompetencyEvaluations[i].managerScore=0:null===self.userCompetencyEvaluations[i].manager&&(self.userCompetencyEvaluations[i].managerScore=-1):null!==self.userCompetencyEvaluations[i].manager&&0===self.userCompetencyEvaluations[i].manager.score?self.userCompetencyEvaluations[i].managerScore=11:null===self.userCompetencyEvaluations[i].manager&&(self.userCompetencyEvaluations[i].managerScore=12);break;case"peerScore":self.pageVariables.lastReverse?null!==self.userCompetencyEvaluations[i].peers&&0===self.userCompetencyEvaluations[i].peers.score?self.userCompetencyEvaluations[i].peerScore=0:null===self.userCompetencyEvaluations[i].peers&&(self.userCompetencyEvaluations[i].peerScore=-1):null!==self.userCompetencyEvaluations[i].peers&&0===self.userCompetencyEvaluations[i].peers.score?self.userCompetencyEvaluations[i].peerScore=11:null===self.userCompetencyEvaluations[i].peers&&(self.userCompetencyEvaluations[i].peerScore=12)}self.userCompetencyEvaluations=$filter("orderBy")(self.userCompetencyEvaluations,self.pageVariables.lastPredicate,self.pageVariables.lastReverse)},self.sortManagerViewData=function(event,setting){self.pageVariables.lastPredicate=setting.predicate,self.pageVariables.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.pageVariables.lastPredicate);for(var i=0;i<self.competencyUsers.length;i++)switch(self.pageVariables.lastPredicate){case"selfScore":self.pageVariables.lastReverse?null!==self.competencyUsers[i].manager&&null===self.competencyUsers[i].self?self.competencyUsers[i].selfScore=0:null===self.competencyUsers[i].manager&&null===self.competencyUsers[i].self&&(self.competencyUsers[i].selfScore=-1):null!==self.competencyUsers[i].manager&&null===self.competencyUsers[i].self?self.competencyUsers[i].selfScore=11:null===self.competencyUsers[i].manager&&null===self.competencyUsers[i].self&&(self.competencyUsers[i].selfScore=12);break;case"managerScore":self.pageVariables.lastReverse?null!==self.competencyUsers[i].manager&&0===self.competencyUsers[i].manager.score?self.competencyUsers[i].managerScore=0:null===self.competencyUsers[i].manager&&(self.competencyUsers[i].managerScore=-1):null!==self.competencyUsers[i].manager&&0===self.competencyUsers[i].manager.score?self.competencyUsers[i].managerScore=11:null===self.competencyUsers[i].manager&&(self.competencyUsers[i].managerScore=12);break;case"peerScore":self.pageVariables.lastReverse?null!==self.competencyUsers[i].peers&&0===self.competencyUsers[i].peers.score?self.competencyUsers[i].peerScore=0:null===self.competencyUsers[i].peers&&(self.competencyUsers[i].peerScore=-1):null!==self.competencyUsers[i].peers&&0===self.competencyUsers[i].peers.score?self.competencyUsers[i].peerScore=11:null===self.competencyUsers[i].peers&&(self.competencyUsers[i].peerScore=12)}self.competencyUsers=$filter("orderBy")(self.competencyUsers,self.pageVariables.lastPredicate,self.pageVariables.lastReverse)}}angular.module("spApp").controller("competencyManager",competencyManager),competencyManager.$inject=["$scope","ajaxService","ngDialog","$localStorage","sharedProperties","$filter","$rootScope","$timeout","$q","$sce","filterFilter","eventSourceProvider"];