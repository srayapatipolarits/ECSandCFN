function externalFeedbackController($scope,ajaxService,$localStorage,ngDialog,sharedProperties,filterFilter,$filter){function stateControl(list){return!!list.actionData.filter(function(e){return e.permissions.Completion&&!e.completed}).length}function sendFeedbackRequest(options,isExternal){_this.requestFormSubmitted=!1,_this.sendFeedbackForm.$valid?ajaxService.getAjaxResponse({url:_this.serviceApis.sendFeedbackRequest,data:$.param({feedbackId:options.feedbackId,feedbackResponse:options.feedbackResponse})}).then(function(response){if("true"===response.Success)sessionStorage.setItem("tyMsg1",response.heading1),sessionStorage.setItem("tyMsg2",response.heading2),window.location="/sp/goals/feedback/external/complete";else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}}):_this.requestFormSubmitted=!0}function cancelFeedbackRequest(id){ajaxService.getAjaxResponse({url:_this.serviceApis.cancelFeedbackRequest,data:$.param({feedbackId:id,feedbackStatus:"DECLINED"})}).then(function(response){if("true"===response.Success)window.location="/?status=feedbackDecline",console.log(response);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getBluePrintSetting(){ajaxService.getAjaxResponse({url:_this.serviceApis.bluePrintSetting,data:$.param({feedbackId:$("#feedbackId").val()})}).then(function(response){if("true"===response.Success)_this.dataMap=response.blueprintSettings.dataMap;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getBluePrint(){ajaxService.getAjaxResponse({url:_this.serviceApis.blueprintDetails,data:$.param({feedbackId:$("#feedbackId").val()})}).then(function(response){if("true"===response.Success)_this.blueprint=response.blueprint,_this.blueprintReady=!0;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}$localStorage.flush();var _this=this;_this.requestFormSubmitted=!1,_this.blueprintReady=!1,_this.noBlue=!1,_this.blueprint=[],_this.sendFeedbackRequest=sendFeedbackRequest,_this.cancelFeedbackRequest=cancelFeedbackRequest,_this.stateControl=stateControl,_this.serviceApis={sendFeedbackRequest:"/sp/goals/feedback/external/response",cancelFeedbackRequest:"/sp/goals/feedback/external/updateStatus",blueprintDetails:"/sp/goals/token/feedback/blueprint/details",bluePrintSetting:"/sp/blueprint/getSettings"},function(){"Blueprint"===$("#category").val()?(getBluePrint(),getBluePrintSetting()):_this.noBlue=!0}()}function externalUserFlow($scope,$element,ajaxService,$localStorage){$localStorage.flush(),$scope.sfailure=!1,$scope.externalUserInfo=[],$scope.assessment360page=!1,$scope.setOptions=function(){$scope.assessment360page=!0},$scope.initExternalLogin=function(form){if($scope.sfailure=!1,$scope.spExtLogin.submitted=!1,$scope.spExtLogin.$valid)ajaxService.getAjaxResponse({url:!0===$scope.assessment360page?"/sp/feedback/external/confirmProfileDetails":"/sp/growth/external/confirmProfileDetails",data:$("form").serialize()}).then(function(response){"true"===response.Success?$scope.assessment360page?window.location.reload():($localStorage.set("externalRequestInitiated",response),window.location.href="/sp/growth/requestDetailExternal"):($scope.failure=response.error,$scope.sfailure=!0)});else{var elem=angular.element($element);$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300),$scope.spExtLogin.submitted=!0}}}function externalFeedbackThankYouCtrl($scope,$localStorage,$timeout){this.getData={heading1:sessionStorage.getItem("tyMsg1"),heading2:sessionStorage.getItem("tyMsg2")},$timeout(function(){sessionStorage.removeItem("tyMsg1"),sessionStorage.removeItem("tyMsg2")},250)}angular.module("spApp").controller("externalFeedbackController",externalFeedbackController),angular.module("spApp").controller("externalUserFlow",externalUserFlow),externalFeedbackController.$inject=["$scope","ajaxService","$localStorage","ngDialog","sharedProperties","filterFilter","$filter"],externalUserFlow.$inject=["$scope","$element","ajaxService","$localStorage"],angular.module("spApp").controller("externalFeedbackThankYouCtrl",externalFeedbackThankYouCtrl),externalFeedbackThankYouCtrl.$inject=["$scope","$localStorage","$timeout"];