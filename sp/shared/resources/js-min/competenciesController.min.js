function competenciesController($scope,ajaxService,$localStorage,$state,$q,sharedProperties,$filter,$rootScope,ngDialog,$timeout,newsFeedService){function viewRatingsHistory(){ajaxService.getAjaxResponse({url:self.config.viewRatingsHistory}).then(function(response){"true"===response.Success?(self.ratingsHistoryList=response.competencyEvaluation,self.ratingsHistoryList.length?self.ratingsHistoryView=!0:sharedProperties.growlMessage($rootScope.pullInterNationalization("practiceArea.empty.completed"),"","glyphicon glyphicon-ban-circle")):null!==response.error&&sharedProperties.ajaxError(response.error)})}function openFeedbackPanel(){var tempObj={id:self.activeProfileDetails.id,name:self.activeProfile.name,parentId:self.competencyProfileDetails.id,parentName:"Competency",feature:"Competency"};sharedProperties.setFeedbackObjectForPanel(tempObj),tempObj=null}function setContentReference(obj,type){"competencyStrategy"===type&&(obj.competencyName=self.activeProfile.name,obj.competencyId=self.activeProfileDetails.id),obj.parentId=self.competencyProfileDetails.id,obj.pubChannelTitle=self.activeProfile.name,obj.pubChannelDesc=self.competencyProfileDetails.name,obj.overviewText=self.activeProfileDetails.description;var tempObj={data:obj,type:type};sharedProperties.setContentReference(tempObj),tempObj=null}function openTaskModal(competencyObj,displayType){if(null!==competencyObj){$localStorage.get("competencyAlertType");self.competencyTask={endDate:competencyObj.dueBy,type:competencyObj.taskType},self.showPeerRating=competencyObj.showPeerRating,self.showManagerRating=competencyObj.showManagerRating,"CompetencyEvaluationInitiate"===self.competencyTask.type||"CompetencyEvaluationInitiateManagerPeer"===self.competencyTask.type||"CompetencyEvaluationInitiateManagerSelf"===self.competencyTask.type||"CompetencyEvaluationInitiateManager"===self.competencyTask.type||"CompetencyEvaluationInitiateSelfPeer"===self.competencyTask.type?(self.competencyTask.title=$rootScope.pullInterNationalization("taskList.competency.CompetencyEvaluationInitiate.title"),self.competencyTask.description=$rootScope.pullInterNationalization("taskList.competency.CompetencyEvaluationInitiate.description")):"CompetencyEvaluationSelf"===self.competencyTask.type&&(self.competencyTask.title=$rootScope.pullInterNationalization("taskList.competency.CompetencyEvaluationSelf.title"),self.competencyTask.description=$rootScope.pullInterNationalization("taskList.competency.CompetencyEvaluationSelf.description"))}}function handleCompetencyAction(taskType){"CompetencyEvaluationInitiate"===self.competencyTask.type||"CompetencyEvaluationInitiateManagerPeer"===self.competencyTask.type||"CompetencyEvaluationInitiateManagerSelf"===self.competencyTask.type||"CompetencyEvaluationInitiateManager"===self.competencyTask.type||"CompetencyEvaluationInitiateSelfPeer"===self.competencyTask.type?self.initiateEvaluationModal("selfInitiate","SELF"):self.startEvaluation("self")}function startEvaluation(user){self.currentIndexForRating=0,self.ratingScoreArray=[],self.userType=user,ajaxService.getAjaxResponse({url:self.config.startEvaluation,data:$.param({memberId:"self"!==user?user:""}),method:"POST"}).then(function(response){if("true"===response.Success){self.winHeight=document.documentElement.clientHeight+"px",self.winHeight1=parseInt(document.documentElement.clientHeight-47,10)+"px";var screenWidth=document.documentElement.clientWidth;self.responseAvailableForModal=!0,self.competencyProfileForRating=response.competencyProfile,self.userToBeAssessed=response.user,self.selectedCompetencyForRating=self.competencyProfileForRating.competencyList[0],$("body .sticky-bottom").hide();var dialog=ngDialog.open({template:screenWidth>767?"/sp/resources/html/competency/rating-desktop.html":self.config.startEvaluationModal,scope:$scope,className:screenWidth>767?"ngdialog-theme-default":"new-mobile-theme oHide"});screenWidth<768&&$("body").scrollTop(0),dialog.closePromise.then(function(data){$("body .sticky-bottom").show(),$localStorage.remove("competencyAlertType")}),self.competencyRatingScore=1,$rootScope.$on("ngDialog.opened",function(e,$dialog){var $r=jQuery('input[type="range"]');$r.rangeslider({polyfill:!1,onInit:function(){$timeout(function(){jQuery("#cmrc-desc-cont_"+self.competencyRatingScore).addClass("slideRight")},100)},onSlideEnd:function(position,value){$scope.$apply(function(){jQuery("#cmrc-desc-cont_"+self.competencyRatingScore).removeClass("slideRight"),self.competencyRatingScore=value,self.ratingScoreArray[self.currentIndexForRating]=self.competencyRatingScore,self.prevScores=angular.copy(self.ratingScoreArray),$timeout(function(){jQuery("#cmrc-desc-cont_"+self.competencyRatingScore).addClass("slideRight")},100)})}}),window.setTimeout(function(){$r.rangeslider("update",!0)},1e3)})}else null!==response.error&&(sharedProperties.ajaxError(response.error),$timeout(function(){window.location.reload()},1e3))})}function saveEvaluation(){self.ratingScoreArray.length!==self.competencyProfileForRating.competencyList.length&&self.ratingScoreArray.push(1),ngDialog.close(),ajaxService.getAjaxResponse({url:self.config.saveEvaluation,data:$.param({memberId:"self"!==self.userType?self.userType:"",scoreArray:self.ratingScoreArray.join()}),method:"POST"}).then(function(response){"true"===response.Success?(sharedProperties.growlMessage($rootScope.pullInterNationalization("competency.ajaxSuccess.selfEvaluationComplete")),$localStorage.remove("competencyAlertType"),$localStorage.remove("competencyObj"),sharedProperties.fireAnalyticsEvent("Competency | Self Evaluation Completed","N/A"),$timeout(function(){window.location.reload()},500)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function initiateEvaluationModal(type,userToProcess){self.winHeight=document.documentElement.clientHeight+100+"px",self.inputRequired=!1,self.multipleManager=!1,self.repeatedRequests=!1,self.assignToSelf=!1,self.searchTagEmail=[],self.searchTag=[],self.searchTagPeer=[],self.initiateRequestType=type,self.showManagerRating||(self.initiateRequestType="peerEvaluation"),self.userToProcess=userToProcess,self.emailMemberList.length||self.getMemberList(),$("body .sticky-bottom").hide();var dialog=ngDialog.open({template:self.config.initiateEvaluationModal,scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"});self.winWidth<768&&$("body").scrollTop(0),dialog.closePromise.then(function(data){$localStorage.remove("competencyAlertType"),$("body .sticky-bottom").show()})}function validateReviewerInfo(managerEmail,peerInfo){var userEmail=$localStorage.get("loggegdInProfile").member.email;if(null!==managerEmail&&userEmail===managerEmail)return void(self.assignToSelf=!0);for(var i=0;i<peerInfo.length;i++)if(userEmail===peerInfo[i].email){self.assignToSelf=!0;break}}function initiateEvaluation(){if(self.initiateEvaluation.submitted=!1,self.repeatedRequests=!1,self.multipleManager=!1,self.assignToSelf=!1,self.showManagerRating){if(void 0===self.searchTagEmail[0])return void(self.inputRequired=!0);if(self.searchTagEmail.length>1)return void(self.multipleManager=!0);validateReviewerInfo(self.searchTagEmail[0].email,self.searchTagPeer)}else{if(!self.searchTagPeer.length)return void(self.inputRequired=!0);validateReviewerInfo(null,self.searchTagPeer)}if(!self.assignToSelf){var userForEmail="",obj={},manager={},peerUser={},peerUserList=[];if(self.searchTagPeer.length)for(var i=0;i<self.searchTagPeer.length;i++){if(self.showManagerRating&&self.searchTagPeer[i].email===self.searchTagEmail[0].email)return void(self.repeatedRequests=!0);peerUser={firstName:void 0!==self.searchTagPeer[i].firstName?self.searchTagPeer[i].firstName:"",lastName:void 0!==self.searchTagPeer[i].lastName?self.searchTagPeer[i].lastName:"",email:self.searchTagPeer[i].email,existingUserEmail:void 0!==self.searchTagPeer[i].firstName?self.searchTagPeer[i].email:""},peerUserList.push(peerUser)}self.initiateEvaluationForm.$valid?(manager=self.showManagerRating?{firstName:self.managerFirstName,lastName:self.managerLastName,email:self.searchTagEmail[0].email,existingUserEmail:null===self.managerFirstName?self.searchTagEmail[0].email:""}:null,"SELF"!==self.userToProcess&&(userForEmail=self.userToProcess.email),obj={manager:manager,peerList:peerUserList,userForEmail:userForEmail},ajaxService.getAjaxResponse({url:self.config.initiateEvaluation,data:obj,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success){if(ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("competency.ajaxSuccess.selfInitiate")),null!==$localStorage.get("competencyObj")){var competency=$localStorage.get("competencyObj");"CompetencyEvaluationInitiate"===competency.taskType||"CompetencyEvaluationSelf"===competency.taskType||"CompetencyEvaluationInitiateSelfPeer"===competency.taskType||"CompetencyEvaluationInitiateManagerSelf"===competency.taskType?(competency.taskType="CompetencyEvaluationSelf",competency.title=$rootScope.pullInterNationalization("taskList.competency.CompetencyEvaluationSelf.title"),competency.description=$rootScope.pullInterNationalization("taskList.competency.CompetencyEvaluationSelf.description"),$localStorage.set("competencyObj",competency)):$localStorage.remove("competencyObj")}sharedProperties.fireAnalyticsEvent("Competency | Evaluation Initiated","N/A"),$timeout(function(){window.location.reload()},500)}else null!==response.error&&(ngDialog.close("ngdialog1"),sharedProperties.ajaxError(response.error),$timeout(function(){window.location.reload()},1e3))})):self.initiateEvaluation.submitted=!0}}function prevEvaluation(){0!==self.currentIndexForRating&&(self.currentIndexForRating=self.currentIndexForRating-1,self.selectedCompetencyForRating=self.competencyProfileForRating.competencyList[self.currentIndexForRating],self.competencyRatingScore=self.prevScores[self.currentIndexForRating],jQuery('input[type="range"]').val(self.competencyRatingScore).change())}function nextEvaluation(){self.currentIndexForRating+1!==self.competencyProfileForRating.competencyList&&(self.currentIndexForRating=self.currentIndexForRating+1,self.selectedCompetencyForRating=self.competencyProfileForRating.competencyList[self.currentIndexForRating],void 0===self.ratingScoreArray[self.currentIndexForRating]?(self.competencyRatingScore=1,self.ratingScoreArray.push(parseFloat(self.competencyRatingScore)),self.prevScores=angular.copy(self.ratingScoreArray)):self.competencyRatingScore=self.ratingScoreArray[self.currentIndexForRating],jQuery('input[type="range"]').val(self.competencyRatingScore).change())}function developmentRedirect(options){self.devStrategy={id:options.devStrategyId,desc:options.desc},self.state(options.state)}function viewDetails(group){self.viewDetailsListIndex=group,self.viewDetailsList=group in self.allNotesFeedbackData?self.allNotesFeedbackData[group]:null;var $enableSCroll=$(".overflow-enable");$enableSCroll.length&&$enableSCroll.scrollTop(0)}function getNotesFeedbackForGoal(options){ajaxService.getAjaxResponse({url:self.config.getNotesFeedbackForGoal+options.goalId+"&memberEmail="+$rootScope.noSelf,method:"get"}).then(function(response){if("true"===response.Success){var temp={};self.viewDetailsList=null,self.feedRequired=!1,self.masterAllNotesFeedbackData={};for(var i=0;i<response.notesAndFeedbackList.length;i++)response.notesAndFeedbackList[i].type in temp?temp[response.notesAndFeedbackList[i].type].push(response.notesAndFeedbackList[i]):(temp[response.notesAndFeedbackList[i].type]=[],temp[response.notesAndFeedbackList[i].type].push(response.notesAndFeedbackList[i]));Object.keys(temp).sort().reverse().forEach(function(key){self.masterAllNotesFeedbackData[key]=temp[key]}),self.allNotesFeedbackData=angular.copy(self.masterAllNotesFeedbackData),self.allNotesFeedbackLength=Object.keys(self.masterAllNotesFeedbackData),self.selectedGroup=Object.keys(self.allNotesFeedbackData)[0],self.allNotesFeedbackLength.length&&self.viewDetails(void 0===options.indexName?self.selectedGroup:options.indexName),void 0!==options.mode&&(sortList(),self.winWidth>767&&$state.go(options.mode))}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function sortList(){""!==self.devStrategy.id&&null!==self.viewDetailsList&&Object.keys(self.allNotesFeedbackData).length?self.filteredViewDetailsList=self.viewDetailsList.filter(function(e){return null!==e.devStrategy&&e.devStrategy.id===self.devStrategy.id}):self.filteredViewDetailsList=angular.copy(self.viewDetailsList)}function openNgOverlay(page,data){void 0!==data&&(self.devStrategy={id:data.devStrategyId,desc:data.desc}),"note"===page&&(self.noteTextArea="",self.postANote={submitted:!1},self.feedRequired?self.getNotesFeedbackForGoal({goalId:self.activeProfile.id,indexName:"NOTE",mode:"addNoteCompetency"}):(self.allNotesFeedbackData=angular.copy(self.masterAllNotesFeedbackData),self.viewDetails("NOTE"),sortList())),self.winHeight=document.documentElement.clientHeight+100+"px";ngDialog.open({template:self.noteResponsiveModal,className:"ngdialog-lnd-theme",scope:$scope});document.documentElement.clientWidth<768&&$("body").scrollTop(0)}function openState(number,text){self.winWidth>767?(self.devStrategy.id="",self.state(number)):(self.devStrategy.id="",self.openNgOverlay(text))}function showMobileHomePage(){self.showRightCol=!1,self.showMobileDD=!1}function videoPopUp(url,type){"Intro"===type?sharedProperties.fireAnalyticsEvent("Competency | View Competency steps Intro Video",self.activeProfile.name):"Description"===type?sharedProperties.fireAnalyticsEvent("Competency | View Competency Profile description Video",self.activeProfile.name):sharedProperties.fireAnalyticsEvent("Competency | View Competency steps Dev Strategy Video",self.activeProfile.name),sharedProperties.videoPopUp(url)}function getMemberList(){ajaxService.getAjaxResponse({url:"/sp/allUsers"}).then(function(response){if("true"===response.Success){if(self.emailMemberList=response.allMembers,null!==$localStorage.get("loggegdInProfile"))for(var i=0;i<self.emailMemberList.length;i++)if(self.emailMemberList[i].email===$localStorage.get("loggegdInProfile").member.email){self.emailMemberList.splice(i,1);break}}else sharedProperties.ajaxError(response.error)})}function loadTags(query){var deferred=$q.defer(),result=self.emailMemberList.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise}function tagAdded(tag){void 0!==tag.email&&(self.searchTag.push(tag.email),self.inputRequired=!1)}function tagRemoved(tag){self.searchTag.splice(self.searchTag.indexOf(tag.email),1)}function tagAddedManager(tag){void 0!==tag&&(self.searchTag.push(tag.email),self.searchTagEmail.push(tag),self.inputRequired=!1),angular.element($(".tagsManagerInput .input")).css("visibility","hidden")}function tagRemovedManager(tag){self.searchTag.splice(self.searchTag.indexOf(tag.email),1),self.searchTagEmail.splice(self.searchTagEmail.indexOf(tag),1),angular.element($(".tagsManagerInput .input")).css("visibility","visible"),self.repeatedRequests=!1,self.assignToSelf=!1,self.managerFirstName=null,self.managerLastName=null}function tagAddedPeer(tag){void 0!==tag&&(self.searchTag.push(tag.email),self.searchTagPeer.push(tag),self.inputRequired=!1)}function tagRemovedPeer(tag){self.searchTag.splice(self.searchTag.indexOf(tag.email),1),sharedProperties.spilceIndexWithBreak(self.searchTagPeer,"email",tag.email),self.repeatedRequests=!1,self.assignToSelf=!1}function articleBookmark(id,flag){var _flag=!flag,options={url:"/sp/tracking/bookMarkArticle",data:$.param({articleId:id,trackingType:"ARTICLES",isBookMarked:_flag})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){!0===_flag?(sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.articleBookmarked")),sharedProperties.fireAnalyticsEvent("Competency | Article Bookmarked",id)):(sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.removeBookmarked")),sharedProperties.fireAnalyticsEvent("Competency | Article Bookmark removed",id));var tempList=angular.copy(self.allArticlesListings);$.each(tempList,function(i,j){if(tempList[i].articleLinkUrl===id)return tempList[i].articleBookmarked=!tempList[i].articleBookmarked,!1}),self.allArticlesListings=angular.copy(tempList)}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function articleShare(articleId,articleDetails,type){$scope.shareType=type,self.inputRequired=!1,$scope.shareEnable=!0,$scope.shareArticleId=articleId,self.searchTag=$scope.searchTag=[],!self.emailMemberList.length&&self.getMemberList(articleId),$scope.shareComment="",$scope.placeholderMessage="share"===$scope.shareType?$rootScope.pullInterNationalization("trainingLibrary.share.comment"):$rootScope.pullInterNationalization("dashboard.whatonmind"),$scope.tagPlaceholder=$scope.winWidth>767?$rootScope.pullInterNationalization("dashboard.addTagmember"):$rootScope.pullInterNationalization("dashboard.tagmembername"),$scope.articlePageDetails=articleDetails,null===$scope.shortDescription||void 0===$scope.shortDescription?ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/getShortDescription",data:$.param({articleId:articleId})}).then(function(response){"true"===response.Success&&(self.winHeight=document.documentElement.clientHeight+100+"px",$scope.shortDescription=response.shortDescription,ngDialog.open({template:"/sp/resources/html/goals/shareArticle.html",scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"}))}):(self.winHeight=document.documentElement.clientHeight+100+"px",ngDialog.open({template:"/sp/resources/html/goals/shareArticle.html",scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"})),"newsfeed"===$scope.shareType&&null===$scope.contentRef&&ajaxService.getAjaxResponse({url:"/sp/utility/og",data:$.param({url:window.location.protocol+"//"+window.location.host+"/sp/trainingLibrary/article?"+$scope.shareArticleId})}).then(function(response){void 0!==response.contentRef&&($scope.contentRef=response.contentRef)})}function articleLike(id,flag){var _flag=!flag,options={url:"/sp/trainingLibrary/recommendArticle",data:$.param({articleId:id,doReccomend:_flag})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){!0===_flag?(sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.articleRecommended")),sharedProperties.fireAnalyticsEvent("Competency | Article Recommended",id)):(sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.articleRecommendedRemoved")),sharedProperties.fireAnalyticsEvent("Competency | Article Recommend removed",id));var tempList=angular.copy(self.allArticlesListings);$.each(tempList,function(i,j){if(tempList[i].articleLinkUrl===id)return tempList[i].articleRecommendedByUser=!tempList[i].articleRecommendedByUser,tempList[i].recommendationCount=response.recommendationCount,!1}),self.allArticlesListings=angular.copy(tempList)}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function applyArticleFilterMobile(v){switch(self.articlesFilterStatus=!1,self.articleMediaFilters="ALL",v){case"all":self.applyArticleFilter("","",0,"auto","");break;case"mandatoryArticle":self.applyArticleFilter("mandatoryArticle",!0,3,"click","");break;case"articleRecommendedByUser":self.applyArticleFilter("articleRecommendedByUser",!0,4,"click","");break;case"articleBookmarked":self.applyArticleFilter("articleBookmarked",!0,5,"click","");break;case"userArticleStatus":self.applyArticleFilter("userArticleStatus","COMPLETED",6,"click","")}}function applyArticleFilterMedia(v){var existingFilterKey="",existingFilterKeyVal="";self.articlesFilter&&angular.forEach(self.articlesFilter,function(value,key){"articleType"!==key&&void 0!==key&&(existingFilterKey=key,existingFilterKeyVal=self.articlesFilter[key])}),self.articlesFilterStatus=!1,"ALL"===v?self.applyArticleFilter(existingFilterKey,existingFilterKeyVal,self.articlesFilterSelected,"click",""):self.applyArticleFilter(existingFilterKey,existingFilterKeyVal,0===self.articlesFilterSelected?-1:self.articlesFilterSelected,"click",v)}function applyArticleFilter(k,v,i,action,mediaType){self.articlesFilterStatus=!1,self.articleMediaFilters="ALL";var _params=[];self.articlesFilterSelected=i,0!==i?(k&&v&&(_params[k]=v),_params.articleType=mediaType,self.articleMediaFilters=mediaType||"ALL",self.articlesFilter=$filter("filter")(_params),self.articlesFilterStatus=!0):(self.articlesFilter="",self.articlesFilterStatus=!1,self.articleMediaFilters="ALL"),"userArticleStatus"===k?sharedProperties.fireAnalyticsEvent("Competency | Click Article Filters","ArticleCompleted"):"articleType"===k?sharedProperties.fireAnalyticsEvent("Competency | Click Article Filters",k+"- "+v):""!==k&&sharedProperties.fireAnalyticsEvent("Competency | Click Article Filters",k)}function infinteScroll(arg){self.returnArticleListings(arg)}function returnArticleListings(pageSize){if(!self.allArticlesListingsMaster.length)return!0;var result=self.masterCopy?self.allArticlesListingsMaster:self.allArticlesListings;self.allArticlesListings=result,self.pageSetting.pageSize=pageSize,pageSize>=self.allArticlesListingsMaster.length&&(self.pageSetting.disabledInfinite=!0,self.pageSetting.pageSize=self.allArticlesListingsMaster.length),self.masterCopy=!0}function getCompetencyProfiles(){var goalIdParam=sharedProperties.getParam("refId");ajaxService.getAjaxResponse({url:self.config.getCompetencies,data:$.param({memberEmail:$rootScope.noSelf}),method:"POST"}).then(function(response){if("true"===response.Success){if(self.responseAvailable=!0,void 0===response.competencyProfile)self.competencyDefaultView=!0;else{var goalIdFound=!1,goalNameFromParam="",indexOfParam=0;if(self.competencyDefaultView=!1,self.masterCompetencyProfileDetails=response.competencyProfile,self.competencyProfileDetails=response.competencyProfile,self.competencyProfileList=response.competencyProfile.competencyList,self.allArticlesListings=[],self.allArticlesListingsMaster=[],goalIdParam)for(var kk=0;kk<self.competencyProfileList.length;kk++)if(goalIdParam===self.competencyProfileList[kk].id){goalIdFound=!0,goalNameFromParam=self.competencyProfileList[kk].name,indexOfParam=kk;break}goalIdFound?(self.ddSelectedText=goalNameFromParam,self.activeProfile.id=goalIdParam,self.activeProfile.name=goalNameFromParam,self.activeProfileDetails=self.competencyProfileList[indexOfParam],self.devStrategyDetails=self.activeProfileDetails.devStrategyActionCategoryList[0],self.devStrategyList=self.activeProfileDetails.devStrategyActionCategoryList[0].actionList,self.allArticlesListingsMaster=self.competencyProfileList[indexOfParam].articleProgressDetailDTO.userArticlesProgress.length?self.competencyProfileList[indexOfParam].articleProgressDetailDTO.userArticlesProgress:[],self.allArticlesListings=angular.copy(self.allArticlesListingsMaster)):(goalIdParam&&!goalIdFound&&sharedProperties.growlMessage($rootScope.pullInterNationalization("competency.ajaxSuccess.notAvailable"),"","glyphicon glyphicon-ban-circle"),self.ddSelectedText=self.competencyProfileList[0].name,self.activeProfile.id=self.competencyProfileList[0].id,self.activeProfile.name=self.competencyProfileList[0].name,self.activeProfileDetails=self.competencyProfileList[0],self.devStrategyDetails=self.activeProfileDetails.devStrategyActionCategoryList[0],self.devStrategyList=self.activeProfileDetails.devStrategyActionCategoryList[0].actionList,self.allArticlesListingsMaster=self.competencyProfileList[0].articleProgressDetailDTO.userArticlesProgress.length?self.competencyProfileList[0].articleProgressDetailDTO.userArticlesProgress:[],self.allArticlesListings=angular.copy(self.allArticlesListingsMaster)),self.state(),self.fetchActionPlanData()}$timeout(function(){self.setContentReference(self.activeProfileDetails,"competency")},1e3)}else null!==response.error&&sharedProperties.ajaxError(response.error)})}function showCompetencyProfileDetails(profileData){self.allArticlesListings=[],self.allArticlesListingsMaster=[],self.activeProfile.id=profileData.id,self.activeProfile.name=profileData.name;var updatedProfileDetails,_data=angular.copy(self.masterCompetencyProfileDetails);angular.forEach(_data.competencyList,function(i,j){if(_data.competencyList[j].id===profileData.id)return updatedProfileDetails=_data.competencyList[j],!1}),self.activeProfileDetails=updatedProfileDetails,self.devStrategyDetails=self.activeProfileDetails.devStrategyActionCategoryList[0],self.devStrategyList=self.activeProfileDetails.devStrategyActionCategoryList[0].actionList,self.allArticlesListingsMaster=updatedProfileDetails.articleProgressDetailDTO.userArticlesProgress.length?updatedProfileDetails.articleProgressDetailDTO.userArticlesProgress:[],self.allArticlesListings=angular.copy(self.allArticlesListingsMaster),self.ddSelectedText=profileData.name,self.state(),self.winWidth<768&&(self.showRightCol=!0),$timeout(function(){self.setContentReference(self.activeProfileDetails,"competency")},1e3),sharedProperties.fireAnalyticsEvent("Competency | Click competency steps",profileData.name)}function state(count){switch(count){case 1:self.noteTextArea="",self.postANote={submitted:!1},self.feedRequired?self.getNotesFeedbackForGoal({goalId:self.activeProfile.id,indexName:"NOTE",mode:"addNoteCompetency"}):(self.allNotesFeedbackData=angular.copy(self.masterAllNotesFeedbackData),self.viewDetails("NOTE"),sortList(),$state.go("addNoteCompetency")),sharedProperties.fireAnalyticsEvent("Competency | Click Post a Note",self.activeProfile.name);break;default:$state.go("profiles")}}function addNote(options){self.postANote.submitted=!1,self.postANoteForm.$valid?ajaxService.getAjaxResponse({url:self.config.addNote,data:$.param({goalId:options.goalId,devStrategyId:options.devStrategyId,content:options.contents})}).then(function(response){"true"===response.Success?(self.feedRequired=!0,self.state(),self.noteTextArea="",self.feedRequired=!0,ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("practiceArea.notePostedSuccesfully")),sharedProperties.fireAnalyticsEvent("Competency | Save a Note",self.activeProfile.name)):null!==response.error&&sharedProperties.ajaxError(response.error)}):self.postANote.submitted=!0}function updateNote(options){self.updateNoteForm.$valid?ajaxService.getAjaxResponse({url:self.config.updateNote,data:$.param({noteId:options.noteId,desc:options.desc})}).then(function(response){"true"===response.Success?(self.feedRequired=!0,sharedProperties.growlMessage($rootScope.pullInterNationalization("practiceArea.noteUpdatedSuccesfully"))):null!==response.error&&(self.viewDetailsList.content=self.tempModel,sharedProperties.ajaxError(response.error))}):self.updateNoteObj.submitted=!0}function deleteNote(options){ajaxService.getAjaxResponse({url:self.config.deleteNote,data:$.param({noteId:options.noteId})}).then(function(response){"true"===response.Success?(sharedProperties.spilceIndexWithBreak(self.masterAllNotesFeedbackData[self.viewDetailsListIndex],"id",options.noteId),!self.masterAllNotesFeedbackData[self.viewDetailsListIndex].length&&delete self.masterAllNotesFeedbackData[self.viewDetailsListIndex],self.viewDetailsListIndex=Object.keys(self.masterAllNotesFeedbackData).length?Object.keys(self.masterAllNotesFeedbackData)[0]:null,self.allNotesFeedbackData=angular.copy(self.masterAllNotesFeedbackData),self.allNotesFeedbackLength=Object.keys(self.masterAllNotesFeedbackData),self.allNotesFeedbackLength.length?self.viewDetails(self.viewDetailsListIndex):self.viewDetailsList=null,sharedProperties.growlMessage($rootScope.pullInterNationalization("practiceArea.deleteNoteSuccessfull"))):null!==response.error&&sharedProperties.ajaxError(response.error)})}function fetchActionPlanData(){null===$localStorage.get("todoListing")?ajaxService.getAjaxResponse({url:self.config.actionPlanData}).then(function(response){if("true"===response.Success){$localStorage.set("todoListing",response.todoListing);for(var competencyNotification=null,i=0;i<response.todoListing.length;i++)if("CompetencyEvaluation"===response.todoListing[i].type){for(var competencyListing=response.todoListing[i].requests,j=0;j<competencyListing.length;j++)"CompetencyEvaluation"!==competencyListing[j].taskType&&(competencyNotification=angular.copy(competencyListing[j]),competencyNotification.showPeerRating=!1,competencyNotification.showManagerRating=!1,"CompetencyEvaluationInitiateManagerPeer"!==competencyNotification.taskType&&"CompetencyEvaluationInitiate"!==competencyNotification.taskType||(competencyNotification.showPeerRating=!0,competencyNotification.showManagerRating=!0),"CompetencyEvaluationInitiateSelfPeer"===competencyNotification.taskType&&(competencyNotification.showPeerRating=!0),"CompetencyEvaluationInitiateManagerSelf"!==competencyNotification.taskType&&"CompetencyEvaluationInitiateManager"!==competencyNotification.taskType||(competencyNotification.showManagerRating=!0),competencyNotification.title="Initiate Competency Evaluation",competencyNotification.description=$rootScope.pullInterNationalization("taskList.competency.CompetencyEvaluationInitiate.description"),"CompetencyEvaluationSelf"!==competencyNotification.taskType&&"CompetencyEvaluationInitiateSelfPeer"!==competencyNotification.taskType&&"CompetencyEvaluationInitiateManagerSelf"!==competencyNotification.taskType||(competencyNotification.title=$rootScope.pullInterNationalization("taskList.competency.CompetencyEvaluationSelf.title"),competencyNotification.description=$rootScope.pullInterNationalization("taskList.competency.CompetencyEvaluationSelf.description")));competencyListing=[],null!==competencyNotification&&($localStorage.set("competencyObj",competencyNotification),$localStorage.set("competencyAlertType",competencyNotification.taskType),self.openTaskModal($localStorage.get("competencyObj"),"showModal"));break}}}):self.openTaskModal($localStorage.get("competencyObj"),"showModal")}var self=this;self.config={getCompetencies:"/sp/competency/get",getNotesFeedbackForGoal:"/sp/goals/notesfeedback?goalId=",videoPopUpDialog:"/sp/support/videoPopUp",updateNote:"/sp/goals/note/update",deleteNote:"/sp/goals/note/delete",addNote:"/sp/goals/note/add",initiateEvaluation:"/sp/competency/evaluation/feedback/initiate",initiateEvaluationModal:"/sp/competency/evaluation/feedback/initiateEvaluationModal",startEvaluation:"/sp/competency/evaluation/feedback/start",startEvaluationModal:"/sp/competency/evaluation/feedback/ratingModal",saveEvaluation:"/sp/competency/evaluation/feedback/save",actionPlanData:"/sp/todo/getAll",viewRatingsHistory:"/sp/competency/getPreviousEvaluations"},self.activeProfile={name:"",id:-1},self.pageSetting={pageSize:10,intialPageSize:10,disabledInfinite:!1},self.devStrategy={id:"",desc:null},self.masterCompetencyProfileDetails={},self.searchTag=$scope.searchTag=[],self.allArticlesListingsMaster=[],self.competencyProfileDetails={},self.articlesFilterStatus=!1,self.articleMediaFilters="ALL",self.activeProfileDetails={},self.allArticlesListings=[],self.emailMemberList=[],self.feedRequired=!0,self.masterCopy=!0,self.allNotesFeedbackData=[],self.masterAllNotesFeedbackData={},self.viewDetailsList=null,self.pageType="individual",self.competencyTask=null,self.getTasks={},self.currentIndexForRating=0,self.searchTagEmail=[],self.searchTagPeer=[],self.initiateEvaluation={submitted:!1},self.inputRequired=!1,self.multipleManager=!1,self.repeatedRequests=!1,self.assignToSelf=!1,self.ratingScoreArray=[],self.competencyRatingScore=1,self.competencyProfileForRating={},self.selectedCompetencyForRating={},self.userToBeAssessed={},self.initiateRequestType="",self.userToProcess={},self.userType="",self.competencyDefaultView=!1,self.showPeerRating=!1,self.showManagerRating=!1,self.prevScores=[],self.responseAvailableForModal=!1,self.responseAvailable=!1,
self.managerFirstName=null,self.managerLastName=null,self.activeToggleId=-1,self.showCompetencyProfileDetails=showCompetencyProfileDetails,self.applyArticleFilterMobile=applyArticleFilterMobile,self.applyArticleFilterMedia=applyArticleFilterMedia,self.getNotesFeedbackForGoal=getNotesFeedbackForGoal,self.getCompetencyProfiles=getCompetencyProfiles,self.returnArticleListings=returnArticleListings,self.tagRemoved=$scope.tagRemoved=tagRemoved,self.developmentRedirect=developmentRedirect,self.applyArticleFilter=applyArticleFilter,self.loadTags=$scope.loadTags=loadTags,self.tagAdded=$scope.tagAdded=tagAdded,self.articleBookmark=articleBookmark,self.getMemberList=getMemberList,self.infinteScroll=infinteScroll,self.openNgOverlay=openNgOverlay,self.articleShare=articleShare,self.articleLike=articleLike,self.viewDetails=viewDetails,self.videoPopUp=videoPopUp,self.openState=openState,self.updateNote=updateNote,self.deleteNote=deleteNote,self.addNote=addNote,self.state=state,self.initiateEvaluationModal=initiateEvaluationModal,self.tagRemovedManager=tagRemovedManager,self.loadTags=loadTags,self.tagAddedManager=tagAddedManager,self.getMemberList=getMemberList,self.tagRemovedPeer=tagRemovedPeer,self.tagAddedPeer=tagAddedPeer,self.initiateEvaluation=initiateEvaluation,self.startEvaluation=startEvaluation,self.saveEvaluation=saveEvaluation,self.prevEvaluation=prevEvaluation,self.nextEvaluation=nextEvaluation,self.openTaskModal=openTaskModal,self.validateReviewerInfo=validateReviewerInfo,self.fetchActionPlanData=fetchActionPlanData,self.viewRatingsHistory=viewRatingsHistory,self.winHeight=document.documentElement.clientHeight+100+"px",self.showMobileHomePage=showMobileHomePage,self.winWidth=$(window).width(),self.showMobileDD=!1,self.showRightCol=!1,self.ddSelectedText,self.noteResponsiveModal="/sp/resources/html/competency/addNoteResponsive.html",self.setContentReference=setContentReference,self.openFeedbackPanel=openFeedbackPanel,self.handleCompetencyAction=handleCompetencyAction,$scope.taggedMemberIds=[],$scope.contentRef=null,$scope.shareType=null,$scope.shareComment="",self.ratingsHistoryView=!1,self.ratingsHistoryList=[],self.sharedProperties=sharedProperties,self.genericPrint=function(){window.print()},self.toggleSection=function(ele,id){id!==self.activeToggleId?self.activeToggleId=id:self.activeToggleId=-1,$(ele).slideToggle("normal")},self.initiatePeerEvaluation=function(){initiateEvaluation()},$scope.tagAddedFeed=function(tag){$scope.taggedMemberIds.push(tag.id)},$scope.tagRemovedFeed=function(tag){$scope.taggedMemberIds.splice($scope.taggedMemberIds.indexOf(tag.id),1)},$scope.articleShared=function(obj){if(!obj.email.length)return self.inputRequired=!0,!0;ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/shareArticle",data:$.param({articleId:obj.articleId,comment:obj.comment,toList:obj.email.toString()})}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),$scope.shareEnable=!1,sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.articleShared")),sharedProperties.fireAnalyticsEvent("ERT-i | Article Shared",obj.articleId)):(ngDialog.close("ngdialog1"),$scope.shareEnable=!1,sharedProperties.ajaxError(response.error))})},$scope.postToNewsFeed=function(comment){var obj=newsFeedService.postMessageObject();obj.taggedMemberIds=$scope.taggedMemberIds,obj.comment=comment,obj.comment.contentReference=$scope.contentRef,newsFeedService.postMessage(obj).then(function(response){if(null===response)return!0;ngDialog.close("ngdialog1"),$scope.shareEnable=!1,sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.articleShared")),sharedProperties.fireAnalyticsEvent("Competency | Article Shared in Newsfeed",$scope.shareArticleId)})};var processCompetencyObject=function(todo){for(var competencyNotification=null,competencyListing=todo.requests,j=0;j<competencyListing.length;j++)"CompetencyEvaluation"!==competencyListing[j].taskType&&(competencyNotification=angular.copy(competencyListing[j]),competencyNotification.showPeerRating=!1,competencyNotification.showManagerRating=!1,"CompetencyEvaluationInitiateManagerPeer"!==competencyNotification.taskType&&"CompetencyEvaluationInitiate"!==competencyNotification.taskType||(competencyNotification.showPeerRating=!0,competencyNotification.showManagerRating=!0),"CompetencyEvaluationInitiateSelfPeer"===competencyNotification.taskType&&(competencyNotification.showPeerRating=!0),"CompetencyEvaluationInitiateManagerSelf"!==competencyNotification.taskType&&"CompetencyEvaluationInitiateManager"!==competencyNotification.taskType||(competencyNotification.showManagerRating=!0),competencyNotification.title="Initiate Competency Evaluation",competencyNotification.description=$rootScope.pullInterNationalization("taskList.competency.CompetencyEvaluationInitiate.description"),"CompetencyEvaluationSelf"===competencyNotification.taskType&&(competencyNotification.title=$rootScope.pullInterNationalization("taskList.competency.CompetencyEvaluationSelf.title"),competencyNotification.description=$rootScope.pullInterNationalization("taskList.competency.CompetencyEvaluationSelf.description")));competencyListing=[],null!==competencyNotification&&($localStorage.set("competencyObj",competencyNotification),$localStorage.set("competencyAlertType",competencyNotification.taskType),self.openTaskModal($localStorage.get("competencyObj"),"hideModal"))};$scope.$on("actionPlanSSE",function(e,data){if(null===data)return!0;$scope.$apply(function(){"DELETE"===data.op&&"CompetencyEvaluation"===data.type&&(null===$localStorage.get("competencyObj")||$localStorage.get("competencyObj").refId!==data.refId&&$localStorage.get("competencyObj").refId!==data.parentRefId||($localStorage.remove("competencyObj"),$localStorage.remove("competencyAlertType"),self.competencyTask=null)),"ADD"!==data.op&&"UPDATE"!==data.op||"CompetencyEvaluation"!==data.todo.type||processCompetencyObject(data.todo)})}),$scope.$on("modalClosed",function(){self.setContentReference(self.activeProfileDetails,"competency")});!function(){self.getCompetencyProfiles()}(),$(window).on("hashchange",function(){sharedProperties.getParam("refId")&&self.getCompetencyProfiles()}),jQuery(function($){$("body").on("click",".event-competency-article a",function(event){event.preventDefault();var redirectUrl=$(this).attr("href");sharedProperties.fireAnalyticsEvent("Competency | Viewed Article",redirectUrl),window.location.href=redirectUrl})})}angular.module("spApp").controller("competenciesController",competenciesController),competenciesController.$inject=["$scope","ajaxService","$localStorage","$state","$q","sharedProperties","$filter","$rootScope","ngDialog","$timeout","newsFeedService"];