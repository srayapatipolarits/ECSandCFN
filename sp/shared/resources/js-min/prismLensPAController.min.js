function prismLensPAController($scope,ajaxService,$filter,ngDialog,sharedProperties,$rootScope,$timeout,$q,$localStorage,spValue,spConfig,commonService){function getAllFeedbackMembers(){for(var i=0;i<spValue.getAllEmployees.hiring.length;i++)"VALID"===spValue.getAllEmployees.hiring[i].userStatus&&sharedProperties.getParam("email")!==spValue.getAllEmployees.hiring[i].email&&self.getAllMembersToInvite.push(spValue.getAllEmployees.hiring[i])}function toggleView(memberObj){self.featuresSectionSelected!==memberObj.id?self.featuresSectionSelected=memberObj.id:self.featuresSectionSelected=-1,self.swotView?self.swotView=!1:getFeedbackDetails(memberObj)}function getFeedbackDetails(memberObj){var param={id:memberObj.id};ajaxService.getAjaxResponse({url:self.services.getFeedbackDetails,data:$.param(param)}).then(function(response){"true"===response.Success?(self.getInviteMemberDetail=response.hiringLens.lensResponse,self.swotMemId=memberObj.id,self.swotanalysis=response.hiringLens.lensResponse.swotanalysis,"undefined"!=typeof response.hiringLens.lensResponse.swotanalysis&&(self.feedbackEnable=!0,self.swotView=!0)):null!==response.error&&sharedProperties.ajaxError(response.error)})}function getFeedbackTeam(){getAllFeedbackMembers();var param={feedbackFor:self.activeUser.id};ajaxService.getAjaxResponse({url:self.services.getAllRequests,data:$.param(param)}).then(function(response){"true"===response.Success?(self.feedbackDataResponse=!0,self.feedbackTeamList=response.hiringLensListing):null!==response.error&&sharedProperties.ajaxError(response.error)})}function resetErrors(){self.formErrors={emailCheck:!1,firstName:!1,lastName:!1}}function showHideRequestFeedbackForm(){self.showRequestFeedbackForm=!self.showRequestFeedbackForm,resetErrors(),self.showNames=!1,self.selectedUser=null}function loadTags(query){self.showNames=!1,resetErrors();var deferred=$q.defer(),result=self.getAllMembersToInvite.filter(function(e){return e.name.toLowerCase().indexOf(query.toLowerCase())!==-1||e.email.toLowerCase().indexOf(query.toLowerCase())!==-1});return deferred.resolve(result),deferred.promise}function tagAdded(tag){self.showNames=!1,self.searchTag.push(tag.email),self.selectedUser=tag,void 0!==tag.id&&null!==tag.id&&""!==tag.id||(self.showNames=!0)}function tagRemoved(tag){resetErrors(),self.showNames=!1,self.selectedUser=null,self.searchTag.splice(self.searchTag.indexOf(tag.email),1)}function deleteConfirm(info){self.deleteInfo=info,ngDialog.open({template:spConfig.talentAnalytics.memberService.dialog.prismLensDelete,scope:$scope})}function deleteFeedback(id){var param={id:id};ajaxService.getAjaxResponse({url:self.services.deleteRequest,data:$.param(param)}).then(function(response){"true"===response.Success?(sharedProperties.spilceIndexWithBreak(self.feedbackTeamList,"id",id),ngDialog.close(),sharedProperties.growlMessage($rootScope.pullInterNationalization("prismLens.feedbackDeleted"))):null!==response.error&&(ngDialog.close(),sharedProperties.ajaxError(response.error))})}function sendEmailReminders(id){var option={type:"HiringLensReminder"};commonService.sendEmail(option,id)}function sendRequestFeedbackAdmin(fName,lName){if(resetErrors(),void 0===self.selectedUser||null===self.selectedUser||""===self.selectedUser?self.formErrors.emailCheck=!0:(void 0!==self.selectedUser.email&&null!==self.selectedUser.email&&""!==self.selectedUser.email||(self.formErrors.emailCheck=!0),void 0!==self.selectedUser.id&&null!==self.selectedUser.id&&""!==self.selectedUser.id||(void 0===fName||null===fName||""===fName?self.formErrors.firstName=!0:(self.formErrors.firstName=!1,self.selectedUser.firstName=fName),void 0===lName||null===lName||""===lName?self.formErrors.lastName=!0:(self.formErrors.lastName=!1,self.selectedUser.lastName=lName))),self.formErrors.emailCheck===!1&&self.formErrors.firstName===!1&&self.formErrors.lastName===!1){var param={firstName:self.selectedUser.firstName,lastName:self.selectedUser.lastName,email:self.selectedUser.email,feedbackFor:self.activeUser.id,requestNow:!0};ajaxService.getAjaxResponse({url:self.services.submitFeedbackRequest,data:param,headers:{"Content-Type":"application/json"}}).then(function(response){"true"===response.Success?(getFeedbackTeam(),showHideRequestFeedbackForm(),sharedProperties.growlMessage($rootScope.pullInterNationalization("prismLens.memberInvited")),sharedProperties.fireAnalyticsEvent("Manage Account | Request Prism Lens","N/A")):null!==response.error&&sharedProperties.ajaxError(response.error)})}}var self=this;self.services={getAllRequests:spConfig.talentAnalytics.memberService.getAllPrismLensRequests,getFeedbackDetails:spConfig.talentAnalytics.memberService.getPrismLensDetails,submitFeedbackRequest:spConfig.talentAnalytics.memberService.submitPrismLensFeedbackRequest,deleteRequest:spConfig.talentAnalytics.memberService.deletePrismLensRequest},self.getAllFeedbackMembers=getAllFeedbackMembers,self.getFeedbackTeam=getFeedbackTeam,self.getFeedbackDetails=getFeedbackDetails,self.feedbackEnable=!1,self.formErrors={emailCheck:!1,firstName:!1,lastName:!1},self.showHideRequestFeedbackForm=showHideRequestFeedbackForm,self.sendRequestFeedbackAdmin=sendRequestFeedbackAdmin,self.deleteConfirm=deleteConfirm,self.sendEmailReminders=sendEmailReminders,self.deleteFeedback=deleteFeedback,self.toggleView=toggleView,self.loadTags=loadTags,self.tagAdded=tagAdded,self.tagRemoved=tagRemoved,self.showNames=!1,self.searchTag=[],self.selectedUser={},self.showRequestFeedbackForm=!1,self.nameDataForm={},self.feedbackDataResponse=!1,self.featuresSectionSelected=-1,self.getAllMembersToInvite=[],self.swotView=!1,self.activeUser=$localStorage.get("activeEmp")}angular.module("spApp").controller("prismLensPAController",prismLensPAController),prismLensPAController.$inject=["$scope","ajaxService","$filter","ngDialog","sharedProperties","$rootScope","$timeout","$q","$localStorage","spValue","spConfig","commonService"];