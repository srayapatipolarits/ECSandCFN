function LibraryController($scope,ajaxService,sharedProperties,$timeout,$localStorage,ngDialog,$q,$rootScope,newsFeedService,$sce){$scope.searchKeys=[],$scope.search={},$scope.commentBox={},$scope.loggedInUser={},$scope.commentEditEnabled=!1,$scope.comments={},$scope.commentBoxes={},$scope.videoAvailable=!1,$scope.imageAvailable=!1,$scope.updateBtnDisabled=!1,$scope.newCommentBox={},$scope.topBox={},$scope.pageSize=20,$scope.existingKeys=[],$scope.searchKeywords={},$scope.btn={},$scope.searchPlaceHolderValue="e.g. Listening",$scope.commentsReady=!1,$scope.searchWithKeys={},$scope.newDate={},$scope.newDate.currentDay=new Date,$scope.newDate={year:$scope.newDate.currentDay.getFullYear(),month:$scope.newDate.currentDay.getMonth()+1,day:$scope.newDate.currentDay.getDate()},$scope.dd={},$scope.dd.hideDropDown=!1,$scope.searchTopic={},$scope.tab=0,$scope.tab.selected=0,$scope.showAddToGoalsBtn=!1,$scope.articlePageReady=!1,$scope.thanks=!1,$scope.emailMemberList=[],$scope.searchTag=[],$scope.inputRequired=!1,$scope.shortDescription=null,$scope.shareEnable=!1,$scope.voiceActive=!1,$scope.voiceAction="play",$scope.taggedMemberIds=[],$scope.contentRef=null,$scope.shareType=null,$scope.videoType="",$scope.videoUrl=null,$scope.responseRecieved=!1,$scope.articleFilters=[],$scope.filterList={media:[],pa:[]},$scope.paFilterList=[],$scope.keySearch=!1,$scope.bookmarkResponse0=!1,$scope.bookmarkResponse1=!1,$scope.badgeObj=null,$scope.showBadge=!1,$scope.disableClick=!1,$scope.clickRedirect=null,$scope.clickAction=null,$scope.showVoice=!1,$scope.closeRest=function(index,noScroll){var val=void 0===noScroll?0:1;$(".accordian-checkbox").each(function(i){i!==$(index.currentTarget.parentNode).index()-val&&$(this).prop("checked",!0)})},$scope.setContentReferenceArticle=function(){var authorName=$scope.articlePageDetailsAuthors,newsCredSource=void 0!==$scope.articlePageDetails.newsCredSource?$scope.articlePageDetails.newsCredSource:"",articleSource=$scope.articlePageDetails.articleSource,articleData={content:"",name:$scope.articlePageDetails.articleLinkLabel,description:authorName+newsCredSource+" - "+articleSource},tempObj={data:articleData,type:"articles"};sharedProperties.setContentReference(tempObj),tempObj=null,articleData=null,jQuery(".article-notes-options").hide(),$scope.showNotesMenu=!1,window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},$scope.handleNoteOptionsClick=function(tab){jQuery(".article-notes-options").hide(),$scope.showNotesMenu=!1,sharedProperties.setSelectedNotesTab(tab)},$scope.startVoice=function(){$scope.voiceActive?"pause"===$scope.voiceAction?(rspkr.ui.getActivePlayer().pause(),$scope.voiceAction="play",sharedProperties.fireAnalyticsEvent("Knowledge Center | Text to Voice - Pause Audio",$scope.articlePageDetails.articleLinkUrl)):(rspkr.ui.getActivePlayer().play(),$scope.voiceAction="pause",sharedProperties.fireAnalyticsEvent("Knowledge Center | Text to Voice - Resume Audio",$scope.articlePageDetails.articleLinkUrl)):$rootScope.$broadcast("httpLoaderStart")},$scope.winWidth=jQuery(window).width(),$scope.winHeight=$(window).height()+100+"px",$scope.formatDate=function(d){if(null!==d&&"undefined"!==d){var splitDate=d.split("-");return{"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"}[(parseInt(splitDate[1])<=9?"0"+splitDate[1]:splitDate[1]).toString()]+" "+parseInt(splitDate[2])+", "+parseInt(splitDate[0])}},$scope.today=$scope.formatDate($scope.newDate.year+"-"+$scope.newDate.month+"-"+$scope.newDate.day),$scope.isArticleBookmarked=!1,$scope.recommendBtnDisabled=!0,$scope.articleBtnDisabled=!0,$scope.comments={add:function(c,id){if($scope.newCommentBox.submitted=!1,null!==c&&""!==c&&void 0!==c){var _o={url:"/sp/trainingLibrary/addComment",data:$.param({comment:c,articleId:id})};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.topBox.newComment=null,$scope.getArticle(),sharedProperties.fireAnalyticsEvent("Knowledge Center | Comment Added",id))})}else $scope.newCommentBox.submitted=!0},update:function(i,id){var commentNgModel="commentBox_"+i,errorBox=jQuery("body").find("span.error_msg_"+i),commentTextbox=jQuery("body").find("form[name=commentBoxForm_"+i+"]"),commentbox=jQuery("body").find("p.user-comment[data-comment=cBox_"+i+"]"),editBtns=jQuery("body").find("p.comment-btns[data-btns=cBtns_"+i+"]"),cancelBtns=jQuery("body").find("a[data-cancel=cancelBtn_"+i+"]");if(jQuery(errorBox).hasClass("hide")||jQuery(errorBox).addClass("hide"),void 0!==$scope.commentBoxes[commentNgModel]){var _o={url:"/sp/trainingLibrary/updateComment",data:$.param({comment:$scope.commentBoxes[commentNgModel],articleId:id,candidateEmail:$scope.loggedInUser.email,index:i}).replace(/%40/g,"@").replace(/%2C/g,",")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&(jQuery(editBtns).removeClass("hide"),jQuery(cancelBtns).removeClass("show").addClass("hide"),jQuery(commentTextbox).addClass("hide"),jQuery(commentbox).removeClass("hide"),$scope.getArticle(),sharedProperties.fireAnalyticsEvent("Knowledge Center | Comment Updated",id))})}else jQuery(errorBox).removeClass("hide")},delete:function(i,id){var commentNgModel="commentBox_"+i,_o={url:"/sp/trainingLibrary/removeComment",data:$.param({comment:$scope.commentBoxes[commentNgModel],articleId:id,commentorEmail:$scope.loggedInUser.email,index:i}).replace(/%40/g,"@").replace(/%2C/g,",")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.getArticle(),sharedProperties.fireAnalyticsEvent("Knowledge Center | Comment Deleted",id))})},edit:function(i){var commentTextbox=jQuery("body").find("form[name=commentBoxForm_"+i+"]"),commentbox=jQuery("body").find("p.user-comment[data-comment=cBox_"+i+"]"),commentNgModel="commentBox_"+i,textBoxComment=jQuery(commentTextbox).find("textarea").attr("data-comments"),editBtns=jQuery("body").find("p.comment-btns[data-btns=cBtns_"+i+"]"),cancelBtns=jQuery("body").find("a[data-cancel=cancelBtn_"+i+"]");jQuery(editBtns).addClass("hide"),jQuery(cancelBtns).addClass("show"),jQuery(commentTextbox).removeClass("hide"),jQuery(commentbox).addClass("hide"),$scope.commentBoxes[commentNgModel]=textBoxComment,$scope.commentEditEnabled=!0},cancel:function(i){var commentTextbox=jQuery("body").find("form[name=commentBoxForm_"+i+"]"),commentbox=jQuery("body").find("p.user-comment[data-comment=cBox_"+i+"]"),editBtns=jQuery("body").find("p.comment-btns[data-btns=cBtns_"+i+"]"),cancelBtns=jQuery("body").find("a[data-cancel=cancelBtn_"+i+"]");jQuery(editBtns).removeClass("hide"),jQuery(cancelBtns).removeClass("show").addClass("hide"),jQuery(commentTextbox).addClass("hide"),jQuery(commentbox).removeClass("hide"),$scope.commentEditEnabled=!1}},$scope.formattedAuthor=function(a){if(void 0!==a&&""!==a)return a.join(", ")},$scope.fetchSearchData=function(key){if($scope.searchTopic.searchTopicValue=null,$scope.dd.hideDropDown=!0,$scope.searchPlaceHolderValue="Themes"===key?"e.g. Listening":null,-1===$.inArray(key,$scope.existingKeys))if($scope.existingKeys.push(key),$scope.searchKeywords[key]=[],null===$localStorage.get("getTopics"+key)){var options={url:"/sp/trainingLibrary/getAllTopics",data:$.param({topic:key})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){$localStorage.set("getTopics"+key,response),$scope.searchKeys=[],$scope.searchWithKeys[key]=response.topics;var fetchedTopics=response.topics;for(var k in fetchedTopics)fetchedTopics.hasOwnProperty(k)&&$scope.searchKeywords[key].push(fetchedTopics[k]);$scope.searchKeys=$scope.searchKeywords[key].sort()}})}else{var _r=$localStorage.get("getTopics"+key);$scope.searchKeys=[],$scope.searchWithKeys[key]=_r.topics;var fetchedTopics=_r.topics;for(var k in fetchedTopics)fetchedTopics.hasOwnProperty(k)&&$scope.searchKeywords[key].push(fetchedTopics[k]);$scope.searchKeys=$scope.searchKeywords[key].sort()}else $scope.searchKeys=$scope.searchKeywords[key]},$scope.searchResultSelected=function(k){$scope.searchTopic.searchTopicValue=k,$scope.dd.hideDropDown=!0},$scope.startSearch=function(c,ki,generic){var k;if($scope.disableClick)$scope.clickAction={c:c,ki:ki,generic:generic},ngDialog.open({template:"/sp/resources/html/library/complete-article.html",scope:$scope}),sharedProperties.fireAnalyticsEvent("Knowledge Center | Stayed in article Page for more than a minute",$scope.articlePageDetails.articleLinkUrl);else if(generic){var url="/sp/trainingLibrary/search?key=true&term="+(void 0!==ki&&null!==ki?ki:"");$timeout(function(){window.location=url},100)}else{for(var key in $scope.searchWithKeys[$scope.search.topicCategory])$scope.searchWithKeys[$scope.search.topicCategory][key]===ki&&(k=key);if($scope.selectCategoryError=!1,"default"!==c){var link="/sp/trainingLibrary/results#topicCategory="+encodeURIComponent(c)+"&topicValue="+(void 0===k||null===k||""===k?"":encodeURIComponent(k)+":"+encodeURIComponent(ki));window.location=link}else $scope.selectCategoryError=!0}},$scope.refreshSearch=function(c,k,p,pageType){var url,urlParams,options,plural,ki,searchTerm,searchKey;if(searchTerm=sharedProperties.getParam("key"),searchKey=sharedProperties.getParam("term"),$scope.keySearch=null!==searchTerm&&""!==searchTerm&&void 0!==searchTerm,!$scope.keySearch){if(!0===p){url=window.location.href,urlParams=url.substring(url.indexOf("#")+1).replace(/\//g,"");var splitParams=urlParams.split("&topic"),paramCategory=splitParams[0].split("=")[1],paramTopic=splitParams[1].split("=")[1];null!==paramCategory&&""!==paramCategory&&void 0!==paramCategory?(c=paramCategory.toString().replace(/\+/g," ").replace(/%20/g," "),plural="Author"===c||"Source"===c?"s":"",$scope.search.topicCategory=c,$scope.fetchSearchData(c),$scope.dd.hideDropDown=!0,$scope.searchTerm="All "+("Themes"===c?"Practice Areas":c)+plural):($scope.search.topicCategory="Themes",$scope.searchTerm="All Practice Areas",$scope.fetchSearchData("All Themes")),null!==paramTopic&&""!==paramTopic&&void 0!==paramTopic?(k=paramTopic.toString().split(":")[0].replace(/\+/g," ").replace(/%20/g," "),ki=paramTopic.toString().split(":")[1].replace(/\+/g," ").replace(/%20/g," "),$scope.searchTopic.searchTopicValue=ki,$scope.searchTerm=ki,$scope.themeTopicValue=ki):$scope.searchTopic.searchTopicValue=null}else if(null!==c&&""!==c&&void 0!==c?(plural="Author"===c||"Source"===c?"s":"",$scope.search.topicCategory=c,$scope.searchTerm="All "+("Themes"===c?"Practice Areas":c)+plural,"Themes"===c&&$scope.fetchSearchData(c),window.location.hash="topicCategory="+c+"&topicValue="):($scope.search.topicCategory="Themes",$scope.searchTerm="All Themes",$scope.fetchSearchData("All Themes"),window.location.hash="topicCategory=Themes&topicValue="),null!==k&&""!==k&&void 0!==k){for(var key in $scope.searchWithKeys[$scope.search.topicCategory])$scope.searchWithKeys[$scope.search.topicCategory][key]===k&&(ki=k,k=key);"Themes"!==$scope.search.topicCategory?($scope.searchTopic.searchTopicValue=k,$scope.searchTerm=k,window.location.hash="topicCategory="+c+"&topicValue="+k):($scope.searchTopic.searchTopicValue=ki,$scope.searchTerm=ki,window.location.hash="topicCategory="+c+"&topicValue="+k+":"+ki)}else $scope.searchTopic.searchTopicValue=null;if(""!==k&&void 0!==k&&null!==k){var id=$scope.keySearch?searchKey:k,tempList=null!==$localStorage.get("getTopicsThemes")&&void 0!==$localStorage.get("getTopicsThemes")&&""!==$localStorage.get("getTopicsThemes")&&$localStorage.get("getTopicsThemes").topics;void 0!==tempList[id]&&null!==tempList[id]&&""!==tempList[id]&&$timeout(function(){$scope.$apply(function(){$scope.searchTerm=tempList[id]})},50)}}"bookmark"===pageType?window.location.href="/sp/trainingLibrary/results"+window.location.hash:($scope.paFilterList=[],$scope.searchPaDef="",$scope.responseRecieved=!1,options={url:"/sp/trainingLibrary/getResults",data:$.param({topicCategory:$scope.keySearch?"":c,topicValue:$scope.keySearch?searchKey:k})},ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){if($scope.keySearch&&($scope.searchTerm=searchKey.replace(/\+/g," ").replace(/%20/g," ")),$scope.trainingSpotlight(k),$scope.searchFilterVal=null,$scope.tab=0,$scope.tab.selected=0,$scope.pageSize=20,$scope.articleResultData=response,$scope.articleResultsBackup=response.articles,$scope.totalArticles=$scope.articleResultsBackup.length,$scope.articleResultsBackup.length>20?($scope.articleResults=$scope.articleResultsBackup,$scope.btn.hideLoadMore=!1):($scope.articleResults=$scope.articleResultsBackup,$scope.btn.hideLoadMore=!0),$scope.articleResultsBackup.length>0){$scope.articleFilters=[];var searchFilters=[];$.each($scope.articleResultsBackup,function(i,j){searchFilters.push(j.articleTypeFormatted)});var paIdList=[],paList=[];$.each($scope.articleResultsBackup,function(i,j){-1===paIdList.indexOf(j.goalIds[0])&&(paIdList.push(j.goalIds[0]),paList.push(j.goals[0]))}),$scope.paFilterList=paList,$scope.articleFilters=searchFilters.unique(),$scope.keySearch||""===k||void 0===k||null===k||($scope.searchPaDef=$scope.paFilterList[0].description)}jQuery("html, body").animate({scrollTop:0}),sharedProperties.fireAnalyticsEvent("Knowledge Center | Search by Practice Area",$scope.searchTerm),$scope.responseRecieved=!0}}))},$scope.updateFilters=function(filterName,val){"pa"===filterName&&(-1===$scope.filterList.pa.indexOf(val)?$scope.filterList.pa.push(val):$scope.filterList.pa.splice($scope.filterList.pa.indexOf(val),1)),"media"===filterName&&(-1===$scope.filterList.media.indexOf(val)?$scope.filterList.media.push(val):$scope.filterList.media.splice($scope.filterList.pa.indexOf(val),1)),$scope.updateResultList()},$scope.clearFilters=function(filterName,classS){"pa"===filterName&&($scope.filterList.pa=[]),"media"===filterName&&($scope.filterList.media=[]),$(classS).each(function(v,i){$(this).prop("checked",!1)}),$scope.updateResultList()},$scope.updateResultList=function(){var masterList=angular.copy($scope.articleResultsBackup);$scope.articleResults=masterList.filter(function(e){return($scope.filterList.pa.length&&-1!==$scope.filterList.pa.indexOf(e.goalIds[0])||!$scope.filterList.pa.length&&e)&&($scope.filterList.media.length&&-1!==$scope.filterList.media.indexOf(e.articleTypeFormatted)||!$scope.filterList.media.length&&e)})},$scope.loadMoreResults=function(){void 0!==typeof $scope.articleResultsBackup&&null!==$scope.articleResultsBackup&&$scope.articleResultsBackup.length>$scope.pageSize&&($scope.pageSize+=20,$scope.pageSize>$scope.articleResultsBackup.length&&($scope.disabledInfinite=!0,$scope.pageSize=$scope.articleResultsBackup.length))},$scope.updateArticleLink=function(l){var link=l.split("/");return"/sp/trainingLibrary/article?"+link[parseInt(link.length-1)]},$scope.trackArticle=function(id){var options={url:"/sp/tracking/trackArticles",data:$.param({articleId:id,trackingType:"ARTICLES"})};ajaxService.getAjaxResponse(options)},$scope.getArticle=function(){var url=window.location.href,urlParams=url.substring(url.indexOf("?")+1).split("&")[0],options={url:"/sp/trainingLibrary/getArticleDetail/"+urlParams,method:"GET"};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){$scope.articlePageDetails=response.article,$scope.articlePageDetailsAuthors=response.article.author.join(", "),$scope.articleComments=response.article.comments,$scope.commentList=[],$scope.trainingSpotlight($scope.articlePageDetails.goalIds[0]),$scope.relatedContent=response.relatedArticles,!0===response.article.canAddToUserGoals?$scope.showAddToGoalsBtn=!0:$scope.showAddToGoalsBtn=!1,!0!==response.article.articleForUser||"NOT_STARTED"!==response.article.userArticleStatus&&null!==response.article.userArticleStatus?$scope.updateBtnDisabled=!0:$scope.updateBtnDisabled=!1,"COMPLETED"===response.article.userArticleStatus?$scope.articleCompletedBtn=!0:$scope.articleCompletedBtn=!1,void 0!==response.article.articleBookmarked&&null!==response.article.articleBookmarked&&($scope.isArticleBookmarked=response.article.articleBookmarked),void 0!==response.article.imageUrl&&null!==response.article.imageUrl?($scope.imageAvailable=!0,$scope.articleHeroImage=response.article.imageUrl):$scope.imageAvailable=!1,void 0!==response.article.videoUrl&&null!==response.article.videoUrl&&"VIDEO"===response.article.articleType?($scope.articleVideo=response.article.videoUrl,$scope.prepareVideo($scope.articleVideo),$scope.videoAvailable=!0):$scope.videoAvailable=!1,!0===$scope.profileReady&&($scope.loggedInUser=$localStorage.get("loggegdInProfile"),$scope.loggedInUser.first=$scope.loggedInUser.member.firstName,$scope.loggedInUser.last=$scope.loggedInUser.member.lastName,$scope.loggedInUser.email=$scope.loggedInUser.member.email,$.each($scope.articleComments,function(i,j){var updatedComment=jQuery.extend({},$scope.articleComments[i],{mName:"commentBox_"+i,showOptions:$scope.articleComments[i].by.email===$scope.loggedInUser.email});$scope.commentList.push(updatedComment)}),$timeout(function(){$scope.commentsReady=!0},200)),$scope.articlePageReady=!0,$scope.trackArticle(urlParams);var readabilityData={},readability=response.article.articleReadability,element=document.getElementById("readability");null!==readability&&void 0!==readability&&(readabilityData.FleschKincaidReadingEase=readability.fleschKincaidReadingEase,readabilityData.FleschKincaidGradeLevel=readability.fleschKincaidGradeLevel,readabilityData.GunningFogScore=readability.gunningFogScore,readabilityData.ColemanLiauIndex=readability.colemanLiauIndex,readabilityData.SmogIndex=readability.smogIndex,readabilityData.AutomatedReadabilityIndex=readability.automatedReadabilityIndex,readabilityData.Average=readability.average,element.setAttribute("data-readability-values",JSON.stringify(readabilityData))),$timeout(function(){$scope.setContentReferenceArticle()},1e3)}})},$scope.prepareVideo=function(videoSrc){if(/youtube/g.test(videoSrc)){$scope.videoType="youtube";var youtubeId=parseYouTube(videoSrc);$scope.videoUrl=$sce.trustAsResourceUrl("https://www.youtube.com/embed/"+youtubeId+"?autoplay=0&rel=0&autohide=1&showinfo=0&wmode=transparent&modestbranding=1&iv_load_policy=3&vq=large")}else if(/vimeo/g.test(videoSrc)){$scope.videoType="vimeo";var vimeoId=parseVimeo(videoSrc),userLocale=sharedProperties.provideVendorSpecificLocale("vimeo"),options={id:vimeoId,width:630,height:354};$timeout(function(){new Vimeo.Player("vimeoPlayer",options).enableTextTrack(userLocale).then(function(track){track.language=userLocale,track.kind="captions"})},500)}else $scope.videoType="html5",$scope.videoUrl=$sce.trustAsResourceUrl(videoSrc)};var parseYouTube=function(url){var p=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return!!url.match(p)&&RegExp.$1},parseVimeo=function(url){var m=url.match(/^.+vimeo.com\/(.*\/)?([^#\?]*)/);return m?m[2]||m[1]:null};$scope.filterResults=function(f,i,e){e&&e.preventDefault(),$scope.btn.hideLoadMore=!0,void 0!==$scope.currentArticleCount&&null!==$scope.currentArticleCount&&$timeout(function(){$scope.pageSize>$scope.currentArticleCount.length?$scope.btn.hideLoadMore=!0:$scope.btn.hideLoadMore=!1},300),$scope.searchFilterVal=f,$scope.tab=i,$scope.tab.selected=i},$scope.updateDashboard=function(id,source){if(!1===$scope.updateBtnDisabled){var options={url:"/sp/trainingLibrary/udpateArticleToProfile",data:$.param({articleId:id})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&($scope.updateBtnDisabled=!0,$scope.disableClick=!1,$scope.articleHelpFul=!0,null!==$localStorage.get("dashboardArticle")&&$localStorage.get("dashboardArticle").article.articleLinkUrl===id&&ajaxService.getAjaxResponse({url:"/sp/dashboard/learning/getArticle"}).then(function(response){"true"===response.Success?($localStorage.remove("dashboardArticle"),$localStorage.set("dashboardArticle",response)):null!==response.error&&sharedProperties.ajaxError(response.error)}),"page"===source?sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Completed",id):sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Completed from modal",id))})}},$scope.getBadgeInformation=function(graphClass){ajaxService.getAjaxResponse({url:"/sp/badge/badgeProgress",data:$.param({refId:$scope.articlePageDetails.goalIds[0]})}).then(function(response){"true"===response.Success?($scope.badgeObj=response.badgeProgress,(5===$scope.badgeObj.level&&$scope.badgeObj.totalCount===$scope.badgeObj.completedCount||1!==$scope.badgeObj.level&&0===$scope.badgeObj.completedCount)&&($scope.showBadge=!0,$scope.badgeObj.completeLevel=5===$scope.badgeObj.level&&$scope.badgeObj.totalCount===$scope.badgeObj.completedCount?$scope.badgeObj.level:$scope.badgeObj.level-1),$timeout(function(){$scope.showBadge||drawProgressGraph($scope.badgeObj.completedCount,$scope.badgeObj.totalCount,$scope.badgeObj.level,graphClass)},1e3)):null!==response.error&&sharedProperties.ajaxError(response.error)})};var drawProgressGraph=function(completedCount,actionCount,level,graphClass){var percentageVal=parseFloat(completedCount/actionCount),radialProgress=new ProgressBar.Circle(".curriculum-actions-wrapper "+graphClass,{color:sharedProperties.whiteLabelColorCodes("sp-icon-color").color,strokeWidth:sharedProperties.detectIE()?6:9,trailWidth:3,easing:"easeInOut",trailColor:"#ccc",duration:1400,text:{autoStyleContainer:!1},step:function(state,circle){Math.round(100*circle.value());circle.setText("")}});$(".progressbar-text").addClass("icon-icon-badge_level"+level),radialProgress.text.style.fontSize="30px",radialProgress.text.style.color="#999",radialProgress.animate(percentageVal.toFixed(2))};$scope.recommendArtice=function(id,doReccomend){$scope.recommendBtnDisabled=!1;var options={url:"/sp/trainingLibrary/recommendArticle",data:$.param({articleId:id,doReccomend:!doReccomend})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){$scope.recommendBtnDisabled=!0,$scope.articlePageDetails.articleRecommendedByUser=!$scope.articlePageDetails.articleRecommendedByUser,$scope.articlePageDetails.recommendationCount=response.recommendationCount;var message=$scope.articlePageDetails.articleRecommendedByUser?$rootScope.pullInterNationalization("growl.articleRecommended"):$rootScope.pullInterNationalization("growl.articleRecommendedRemoved");sharedProperties.growlMessage(message),sharedProperties.fireAnalyticsEvent("Knowledge Center | "+message,id)}else null!=response.error&&($scope.recommendBtnDisabled=!0,sharedProperties.ajaxError(response.error))})},$scope.articleBookmark=function(id){!0===$scope.isArticleBookmarked&&void 0!==$scope.isArticleBookmarked?$scope.sendArticleBookmark=!1:$scope.sendArticleBookmark=!0,$scope.articleBtnDisabled=!1;var options={url:"/sp/tracking/bookMarkArticle",data:$.param({articleId:id,trackingType:"ARTICLES",isBookMarked:$scope.sendArticleBookmark})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?($scope.articleBtnDisabled=!0,!0===$scope.sendArticleBookmark?(sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.articleBookmarked")),sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Bookmarked",id)):(sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.removeBookmarked")),sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Bookmark removed",id)),$scope.isArticleBookmarked=!$scope.isArticleBookmarked):$scope.articleBtnDisabled=!0})},$scope.getAllBookmarks=function(filters){$scope.bookmarkResponse1=!1,$scope.search.topicCategory="Themes",ajaxService.getAjaxResponse({url:"/sp/tracking/getAllBookMarkedArticles",method:"get"}).then(function(response){if("true"===response.Success){if($scope.recentBookmarkList=response.articles,filters){$scope.articleFilters=[];var searchFilters=[];$.each($scope.recentBookmarkList,function(i,j){searchFilters.push(j.articleTypeFormatted)}),$scope.articleFilters=searchFilters.unique()}$scope.bookmarkResponse1=!0}})},$scope.getAllBookmarksWithTrainingSpotlight=function(filters){$scope.bookmarkResponse0=!1,$scope.search.topicCategory="Themes",ajaxService.getAjaxResponse({url:"/sp/tracking/getAllBookMarkedArticles",method:"get"}).then(function(response){if("true"===response.Success){if($scope.trainingSpotlight(),$scope.recentBookmarkList=response.articles,filters){$scope.articleFilters=[];var searchFilters=[];$.each($scope.recentBookmarkList,function(i,j){searchFilters.push(j.articleTypeFormatted)}),$scope.articleFilters=searchFilters.unique()}$scope.bookmarkResponse0=!1}})},$scope.trendingTopRatedArticles=function(){if(null===$localStorage.get("tntArticles"))ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/trendingAndTopRated"}).then(function(response){"true"===response.Success&&($localStorage.set("tntArticles",response),$scope.trendingList=response.trendingArticles,$scope.topRatedList=response.topArticles)});else{var _r=$localStorage.get("tntArticles");$scope.trendingList=_r.trendingArticles,$scope.topRatedList=_r.topArticles}},$scope.trainingSpotlight=function(id){ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/trainingSpotlight",data:$.param({goalId:void 0!==id?id:""})}).then(function(response){"true"===response.Success&&($scope.trainingSpotlightContent=response.trainingSpotLight)})},$scope.addtoGoals=function(id,search){ajaxService.getAjaxResponse({url:"/sp/goals/addArticleToUserGoals",method:"post",data:$.param({articleId:id})}).then(function(response){"true"===response.Success&&($scope.showAddToGoalsBtn=!1,$scope.updateBtnDisabled=!1,!0===search&&jQuery.each($scope.articleResults,function(i){if($scope.articleResults[i].articleLinkUrl===id)return $scope.articleResults[i].canAddToUserGoals=!1,$scope.articleResults[i].userArticleStatus="NOT_STARTED",!1}),sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.articleAdded")))})},$scope.shareArticle=function(articleId,type){$scope.shareType=type,$scope.inputRequired=!1,$scope.shareEnable=!0,$scope.shareArticleId=articleId,$scope.searchTag=[],!$scope.emailMemberList.length&&$scope.getMemberList(articleId),$scope.placeholderMessage="share"===$scope.shareType?$rootScope.pullInterNationalization("trainingLibrary.share.comment"):$rootScope.pullInterNationalization("dashboard.whatonmind"),$scope.tagPlaceholder=$scope.winWidth>767?$rootScope.pullInterNationalization("dashboard.addTagmember"):$rootScope.pullInterNationalization("dashboard.tagmembername"),null===$scope.shortDescription?ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/getShortDescription",data:$.param({articleId:articleId})}).then(function(response){"true"===response.Success&&($scope.winHeight=$(window).height()+100+"px",$scope.shortDescription=response.shortDescription,ngDialog.open({template:"/sp/trainingLibrary/share",scope:$scope,className:$scope.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"}))}):($scope.winHeight=$(window).height()+100+"px",ngDialog.open({template:"/sp/trainingLibrary/share",scope:$scope,className:$scope.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"})),"newsfeed"===$scope.shareType&&null===$scope.contentRef&&ajaxService.getAjaxResponse({url:"/sp/utility/og",data:$.param({url:window.location.href})}).then(function(response){void 0!==response.contentRef&&($scope.contentRef=response.contentRef)})},$scope.articleShared=function(obj){if(!obj.email.length)return $scope.inputRequired=!0,!0;ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/shareArticle",data:$.param({articleId:obj.articleId,comment:obj.comment,toList:obj.email.toString()})}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),$scope.shareEnable=!1,sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.articleShared")),sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Shared",obj.articleId)):(ngDialog.close("ngdialog1"),$scope.shareEnable=!1,sharedProperties.ajaxError(response.error))})},$scope.postToNewsFeed=function(comment){var obj=newsFeedService.postMessageObject();obj.taggedMemberIds=$scope.taggedMemberIds,obj.comment=comment,obj.comment.contentReference=$scope.contentRef,newsFeedService.postMessage(obj).then(function(response){if(null===response)return!0;ngDialog.close("ngdialog1"),$scope.shareEnable=!1,sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.articleShared")),sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Shared in Newsfeed",$scope.shareArticleId)})},$scope.getMemberList=function(articleId){ajaxService.getAjaxResponse({url:"/sp/allUsers"}).then(function(response){"true"===response.Success?$scope.emailMemberList=response.allMembers:sharedProperties.ajaxError(response.error)})},$scope.loadTags=function(query){var deferred=$q.defer(),result=$scope.emailMemberList.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise},$scope.tagAdded=function(tag){$scope.searchTag.push(tag.email),$scope.inputRequired=!1},$scope.tagRemoved=function(tag){$scope.searchTag.splice($scope.searchTag.indexOf(tag.email),1)},$scope.tagAddedFeed=function(tag){$scope.taggedMemberIds.push(tag.id)},$scope.tagRemovedFeed=function(tag){$scope.taggedMemberIds.splice($scope.taggedMemberIds.indexOf(tag.id),1)},$scope.useful=function(obj){ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/usefullArticle",data:$.param({articleId:obj.articleId,isUseFull:obj.isUseFull})}).then(function(response){"true"===response.Success?($scope.thanks=!0,obj.isUseFull?sharedProperties.fireAnalyticsEvent("Knowledge Center | Article helpful",obj.articleId):sharedProperties.fireAnalyticsEvent("Knowledge Center | Article not helpful",obj.articleId),$scope.articleHelpFul=!1,$scope.articleCompletedBtn=!0):sharedProperties.ajaxError(response.error)})},$scope.closeThis=function(){$scope.shareEnable=!1,this.closeThisDialog()},$scope.closeCompleteModal=function(){ngDialog.close(),$scope.disableClick=!1,sharedProperties.fireAnalyticsEvent("Knowledge Center | Closed Article Complete Modal",$scope.articlePageDetails.articleLinkUrl),null!==$scope.clickRedirect&&(window.location.href=$scope.clickRedirect),null!==$scope.clickAction&&$scope.startSearch($scope.clickAction.c,$scope.clickAction.ki,$scope.clickAction.generic)},$scope.trainingLibraryControl=[],$scope.itemPositioned=[],$scope.fn=function(){var $slidesElem=$(".dragZone"),slidesHeight=$slidesElem.find(".inputBox").outerHeight(),slidesWidth=$slidesElem.find(".inputBox").outerWidth();return this.init=function(drag){this.getTrainingLibraryRecords(drag)},this.getTrainingLibraryRecords=function(drag){var storageCheck=$localStorage.get("trainingLibraryRecord");if(null!=storageCheck&&storageCheck.Content.length)return $scope.trainingLibraryControl=storageCheck,!0;ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/homeArticles"}).then(function(response){"true"===response.Success?($scope.trainingLibraryControl=response,$localStorage.set("trainingLibraryRecord",response)):null!=response.error&&sharedProperties.ajaxError(response.error)})},this.dragIt=function(){$scope.pckry=$slidesElem.packery({handle:".handleMe",rowHeight:slidesHeight,columnWidth:slidesWidth});var itemElems=$scope.pckry.packery("getItemElements");$scope.initialItem=itemElems;for(var i=0,len=itemElems.length;i<len;i++){var draggie=new Draggabilly(itemElems[i],{axis:"y",containment:$slidesElem,handle:".handle",grid:[0,78]});$scope.pckry.packery("bindDraggabillyEvents",draggie)}$scope.pckry.packery("on","dragItemPositioned",this.orderItems),$scope.pckry.packery("on","layoutComplete",this.orderItems)},this.orderItems=function(){for(var $itemElems=$scope.pckry.packery("getItemElements"),i=0;i<$itemElems.length;i++){
var indexToPut=$($itemElems[i]).attr("tabindex");$scope.itemPositioned[i]=indexToPut,$($itemElems[i]).attr("data-module-index",i)}},this.callSaveInLoop=function(form){if(form.$valid)for(var i=0;i<$slidesElem.find(".handleMe").length;i++){var _this=$($slidesElem.find(".handleMe")[i]),_obj={articleId:_this.find(".js_articleId").val(),shortDescription:_this.find(".js_shtDesc").val(),position:_this.attr("data-module-index")};this.saveTheRecord(_obj)}},this.saveTheRecord=function(_obj){ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/admin/add/contentArticles",data:$.param(_obj)}).then(function(response){"true"===response.Success?sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.saved")):null!=response.error&&sharedProperties.ajaxError(response.error)})},this},angular.element(document).ready(function(){var userLocale=sharedProperties.getUserLocale();$scope.articlePageReady&&($scope.articleCompletedBtn||startTimer(),ReadSpeaker.q(function(){ReadSpeaker.ui.addClickEvents(),$timeout(function(){ReadSpeaker.ui.addClickEvents()},500),ReadSpeaker.Common.addEvent("onAfterSyncInit",function(){$scope.$apply(function(){$rootScope.$broadcast("httpLoaderEnd"),$scope.voiceActive=!0,$scope.voiceAction="pause",sharedProperties.fireAnalyticsEvent("Knowledge Center | Text to Voice - Play Audio",$scope.articlePageDetails.articleLinkUrl)})})})),"es-LA"===userLocale&&$scope.articlePageReady?($scope.showVoice=!1,googleTranslateElementInit()):$scope.showVoice=!0});var googleTranslateElementInit=function(){new google.translate.TranslateElement({includedLanguages:"en,es",autoDisplay:!1},"google_translate_element")},startTimer=($scope.$on("modalClosed",function(){$scope.setContentReferenceArticle()}),function(){function startTicking(){var coutdownTime=(new Date).getTime(),diff=coutdownTime-startTime;0==countDown-Math.floor(diff/1e3)&&(clearInterval(counter),$scope.$apply(function(){$scope.updateBtnDisabled||($scope.disableClick=!0)}))}var startTime=(new Date).getTime(),countDown=60,counter=setInterval(startTicking,500)});!function(){$scope.callTraining=new $scope.fn,$scope.showNotesMenu=!1,window.rsConf={general:{usePost:!0},settings:{hlicon:"iconoff",hlscroll:"scrollon"},cb:{ui:{stop:function(){$scope.$apply(function(){$scope.voiceActive=!1,$scope.voiceAction="play",sharedProperties.growlMessage($rootScope.pullInterNationalization("growl.listening")),sharedProperties.fireAnalyticsEvent("Knowledge Center | Text to Voice - Audio Ended",$scope.articlePageDetails.articleLinkUrl)}),ReadSpeaker.init(),ReadSpeaker.ui.addClickEvents()}}}}}(),jQuery(function($){$("body").on("mousedown touchstart",".available-stories",function(event){$scope.showNotesMenu=!1,$("#notesOptions").removeClass("panel-fadeIn"),jQuery(".article-notes-options").hide(),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}),$("body").on("mouseup touchend",".available-stories",function(event){$scope.$apply(function(){var selectedText=getSelectedTextForNotes(),authorName=$scope.articlePageDetailsAuthors,newsCredSource=void 0!==$scope.articlePageDetails&&void 0!==$scope.articlePageDetails.newsCredSource?$scope.articlePageDetails.newsCredSource:"",articleSource=$scope.articlePageDetails.articleSource,articleData={content:"<q>"+selectedText+"</q>",name:$scope.articlePageDetails.articleLinkLabel,description:authorName+newsCredSource+" - "+articleSource};if($("#notesOptions").removeClass("panel-fadeIn"),""===selectedText.trim()||$scope.showNotesMenu)$scope.showNotesMenu=!1,$("#notesOptions").removeClass("panel-fadeIn"),jQuery(".article-notes-options").hide();else{$scope.showNotesMenu=!0,jQuery(".article-notes-options").show();var tempObj={data:articleData,type:"articles"};sharedProperties.setContentReference(tempObj),tempObj=null,articleData=null;var container=document.querySelector("#content-container"),notesOptions=document.querySelector("#notesOptions"),xPosition=event.clientX-container.getBoundingClientRect().left-notesOptions.clientWidth/2,yPosition=event.clientY-container.getBoundingClientRect().top-notesOptions.clientHeight/2;$("#notesOptions").addClass("panel-fadeIn"),$("#notesOptions").css({left:xPosition+"px",top:yPosition+"px"})}})}),$("body").on("click",".flyout-global-nav a.logout-nav",function(event){$scope.$apply(function(){$scope.disableClick=!1})}),$("body").on("click",".flyout-global-nav a, .header-info-container a, .event-featured-articles a, .event-trending-articles a, .event-top-rated-articles a, .event-spotlight-articles a, .event-related-content-articles a, .bookmarks-count-link a",function(e){$scope.clickRedirect=$(this).attr("href"),$rootScope.$broadcast("disableNavClick"),$scope.$apply(function(){if($scope.disableClick){e.preventDefault(),sharedProperties.fireAnalyticsEvent("Knowledge Center | Stayed in article Page for more than a minute",$scope.articlePageDetails.articleLinkUrl);ngDialog.open({template:"/sp/resources/html/library/complete-article.html",scope:$scope}).closePromise.then(function(){$scope.closeCompleteModal()})}})})});$scope.setBadgeClass=function(className,levelId){return(className+levelId).toString()};var getSelectedTextForNotes=function(){return window.getSelection?window.getSelection().toString():document.selection?document.selection.createRange().text:void 0}}function kcIconToolTip(){return{restrict:"A",link:function($scope,$element,$attrs){Tipped.create($element[0],$attrs.desc,{size:"small"})}}}angular.module("spApp").controller("LibraryController",LibraryController),LibraryController.$inject=["$scope","ajaxService","sharedProperties","$timeout","$localStorage","ngDialog","$q","$rootScope","newsFeedService","$sce"],angular.module("spApp").directive("kcIconToolTip",kcIconToolTip);