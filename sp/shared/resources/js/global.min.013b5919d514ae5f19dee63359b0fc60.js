angular.module("spApp",["ui.router","ngSanitize","ngTagsInput","checklist-model","ngDialog","angucomplete","mgcrea.ngStrap","angularFileUpload","ngAnimate","infinite-scroll","notesAndFeedbackFactory","ui.tinymce"]);
angular.module("spApp").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("individual",{url:"/individual",templateUrl:"/sp/resources/html/register/register_step2_individual.html"}).state("business",{url:"/business",templateUrl:"/sp/resources/html/register/register_step2_business.html"}).state("hiring",{url:"/hiring",templateUrl:"subscribe-enterprise-page.html"}).state("login",{url:"/login",templateUrl:"login-page.html"}).state("signup_individual",{url:"/signup_individual",templateUrl:"/sp/resources/html/register/register.html"}).state("thankYou",{url:"/thankYou",templateUrl:"/sp/resources/html/register/thankyou.html"}).state("resetConfirmation",{url:"/resetConfirmation",templateUrl:"/sp/resources/html/reset/reset-confirm.html"}).state("reset",{url:"/reset",templateUrl:"/sp/resources/html/reset/reset.html"}).state("browser",{url:"/browser",templateUrl:"/sp/resources/html/browser/browser.html"}).state("group",{url:"/group",templateUrl:"/sp/resources/html/admin/member/groupHome.html"}).state("member",{url:"/member",templateUrl:"/sp/resources/html/admin/member/membersHome.html"}).state("profile",{url:"/profile",templateUrl:"/sp/resources/html/admin/member/profile.html"}).state("signup_business",{url:"/signup_business",templateUrl:"/sp/resources/html/register/register_business.html"}).state("single",{url:"/add/single",templateUrl:"/sp/resources/html/admin/member/add-single.html"}).state("member-multiple",{url:"/add/multiple",templateUrl:"/sp/resources/html/admin/member/add-multiple.html"})}]);
jQuery(function(){(jQuery("html").hasClass("ie9")||jQuery("html").hasClass("ie10"))&&setTimeout(function(){PointerEventsPolyfill.initialize({})},500)});
angular.module("spApp").run(["$rootScope","$location","ajaxService","sharedProperties","ngDialog","$localStorage","$state",function($rootScope,$location,ajaxService,sharedProperties,ngDialog,$localStorage,$state){"use strict";function hideElement(){$("#loader").find(".spinner").removeClass("selected")}$rootScope.Internationalization=[],$rootScope.inviteReady=!1,$rootScope.formSendNotificationError=!1,$rootScope.messageAreaEmpty=!1,$rootScope.noSelf=null===sharedProperties.getParam("email")?"":sharedProperties.getParam("email"),$rootScope.$watch(function(){return $location.path()},function(a){var pathName=window.location.pathname,additional="";if(("/sp/admin/memberListing/"===pathName||"/sp/admin/memberListing"===pathName)&&(additional="group,member"),("/sp/admin/account/member/details"===pathName||"/sp/dashboardUserAnalysis"===pathName)&&(additional="goals,goalDesc,reviewGoal,feedback,recommendations,bystar,dashboardUserAnalysis,growthListing,feedbackListing,group"),"/sp/admin/member/add/single"===pathName&&(additional="group"),"/sp/admin/member/add/multiple"===pathName&&(additional="group"),"/sp/feedback/themeView"===pathName&&(additional="archiveDetail"),("/sp/feedback"===pathName||"/sp/growth/growthListing"===pathName||"/sp/tools/hiring"===pathName||"/sp/dashboard/groups"===pathName)&&(additional="group"),pathName.match("processToken")&&(additional="growth"),("/sp/resume/resumeDetailsView"===pathName||"/sp/connect/linkedin"===pathName)&&(additional="connect,spResume"),("/sp/profile"===pathName||"/sp/tools/hiring"===pathName||"/sp/sysAdmin/loggedInUser"===pathName||"/sp/sysAdmin/getUserList"===pathName||"/sp/sysAdmin/getCompanyList"===pathName)&&(additional="admin"),$localStorage.isAvailable()&&null!=$localStorage.get("interNationalization"))$rootScope.Internationalization=$localStorage.get("interNationalization"),$rootScope.inviteReady=!0;else{var options={url:"/sp/messages",data:$.param({url:pathName,additionalKeys:additional,localStorage:$localStorage.isAvailable()})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&$localStorage.set("interNationalization",response,function(){$rootScope.Internationalization=response,$rootScope.inviteReady=!0})})}}),$rootScope.pullInterNationalization=function(key,single,mem){return"undefined"!=typeof single&&"custom"===single?mem+"."+key in $rootScope.Internationalization?$rootScope.Internationalization[mem+"."+key]:key:key in $rootScope.Internationalization?$rootScope.Internationalization[key]:key},$rootScope.contains=function(arr,item){if(angular.isArray(arr))for(var i=0;i<arr.length;i++)if(angular.equals(arr[i],item))return!0;return!1},$rootScope.add=function(arr,item){arr=angular.isArray(arr)?arr:[];for(var i=0;i<arr.length;i++)if(angular.equals(arr[i],item))return arr;return arr.push(item),arr},$rootScope.remove=function(arr,item){if(angular.isArray(arr))for(var i=0;i<arr.length;i++)if(angular.equals(arr[i],item)){arr.splice(i,1);break}return arr},$rootScope.callSwitchChange=function(param){sharedProperties.setSwitch(param)},$rootScope.notificationEmailPoP=function(args,type,defaults,params){angular.isArray(args)||(args=args.split(",")),"ASSESSMENT_PENDING"===type||"ASSESSMENT_PROGRESS"===type?type="AssessmentPendingReminder":"PROFILE_INCOMPLETE"===type?(type="ProfileIncompleteReminder",defaults="ProfileIncomplete"):"HiringCandidateReminder"===type?type="HiringCandidateReminder":"HiringCandidateProfileAccess"===type&&(type="HiringCandidateProfileAccess"),$rootScope.formSendNotificationError=!1,$rootScope.messageAreaEmpty=!1,sharedProperties.notification(args,type,defaults,params)},$rootScope.notificatationListName=function(notifyMessage){if($rootScope.formSendNotificationError=!1,$rootScope.messageAreaEmpty=!1,$rootScope.selectedNotification=notifyMessage,"ProfileIncomplete"!==notifyMessage){var comment1=$("<div/>").html($.parseHTML($rootScope.pullInterNationalization("admin.group."+notifyMessage+".notification.text").replace("$companyName",$localStorage.get("loggegdInProfile").company.name)));$("#commentBlock").val($(comment1).html());var headerName=$rootScope.pullInterNationalization("admin.group."+notifyMessage+".notification.brandCopy");$("#headerName").val(headerName);var ctaLabel=$rootScope.pullInterNationalization("admin.group."+notifyMessage+".notification.ctaLabel");ctaLabel==="admin.group."+notifyMessage+".notification.ctaLabel"?$("#ctaLabel").remove():$("#ctaLabel").val(ctaLabel);var ctaUrl=$rootScope.pullInterNationalization("admin.group."+notifyMessage+".notification.ctaUrl");ctaUrl==="admin.group."+notifyMessage+".notification.ctaUrl"?$("#ctaUrl").remove():$("#ctaUrl").val(ctaUrl)}var subBlock=$.parseHTML($rootScope.pullInterNationalization("admin.group."+notifyMessage+".notification.nosubject"))[0],subBlock1=$(subBlock).text();subBlock==="admin.group."+notifyMessage+".notification.nosubject"?$("#subBlock").remove():$("#subBlock").val(subBlock1)},Array.prototype.unique=function(){for(var a=this.concat(),i=0;i<a.length;++i)for(var j=i+1;j<a.length;++j)a[i]===a[j]&&a.splice(j--,1);return a},function(){if(!window.location.hash){var href=window.location.pathname;"/sp/admin/memberListing"===href?$state.go("member"):"/sp/admin/group"===href&&$state.go("group")}}(),$rootScope.nl2br=function(str,is_xhtml){var breakTag=is_xhtml||"undefined"==typeof is_xhtml?"<br />":"<br>";return(str+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+breakTag+"$2")},$rootScope.$on("httpLoaderStart",function(){$("#loader").find(".spinner").addClass("selected")}),$rootScope.$on("httpLoaderEnd",hideElement),$rootScope.setBoxSizes=function(c1,c2,h){$(c1).each(function(){var boxes=$(this).find(c2),maxHeight=0;boxes.attr("style",""),maxHeight=Math.max.apply(Math,boxes.map(function(){return $(this).outerHeight()}).get()),"full"===h?boxes.attr("style","").css({height:maxHeight}):boxes.attr("style","").css({"min-height":maxHeight})})},Array.prototype.chunk=function(chunkSize){var array=this;return[].concat.apply([],array.map(function(elem,i){return i%chunkSize?[]:[array.slice(i,i+chunkSize)]}))},$rootScope.applyEqualHeights=function(group,itemsPerRow){for(var tallest=0,rows=Math.ceil(group.length/itemsPerRow),rowItems="",i=1;rows+1>i;i++)1===i?(tallest=0,rowItems=group.filter(":lt("+i*itemsPerRow+")")):(tallest=0,rowItems=group.filter(":lt("+i*itemsPerRow+")").filter(":gt("+(i*itemsPerRow-(itemsPerRow+1))+")")),rowItems.each(function(){var thisHeight=$(this).height();thisHeight>tallest&&(tallest=thisHeight)}),rowItems.css({"min-height":tallest})},$rootScope.sendNotification=function(form,list,type,mode){function extractEmails(e){var _list=e,emailList=[],counter=0;return $.each(_list,function(i){emailList.push(_list[i].email),counter++}),counter===_list.length?emailList.toString():void 0}if($rootScope.formSendNotificationError=!1,$rootScope.messageAreaEmpty=!1,"undefined"!=typeof mode&&($("#subBlock").val($rootScope.subBlockNotification),$("#commentBlock").val($rootScope.commentNotification)),"default"===$rootScope.selectedNotification)return $rootScope.formSendNotificationError=!0,!0;if($("#commentBlock").is(":visible")&&""===$("#commentBlock").val())return $rootScope.messageAreaEmpty=!0,!0;if(form.$valid){var notifyForm=$(".getNotificationForm").serialize(),mList=extractEmails(list),param="";param=angular.isObject($rootScope.extra)?notifyForm+"&type="+type+"&memberList="+mList+"&"+$rootScope.extra.key+"="+$rootScope.extra.id:notifyForm+"&type="+type+"&memberList="+mList;var options={url:"/sp/notifications/sendNotificationWithParams",data:param};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:" Notification sent successfully "}),"FeedbackReminder"===type&&sharedProperties.fireAnalyticsEvent("Prism Lens | Send Feedback Reminder","N/A");else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:errorMessage})}})}else $rootScope.formSendNotificationError=!0,$rootScope.messageAreaEmpty=!0,console.log("error")};var i,d=new Date,year=d.getFullYear(),ccYears=[];for(i=0;10>i;i++)ccYears.push(year+i);$rootScope.ccYears=ccYears,$rootScope.footerLinks=function(type,e){e.preventDefault(),"privacy"===type?ngDialog.open({template:"/sp/resources/html/footer/privacy.html"}):"agreement"===type?ngDialog.open({template:"/sp/resources/html/footer/agreement.html"}):"cookies"===type&&ngDialog.open({template:"/sp/resources/html/footer/cookies.html"})},setTimeout(function(){jQuery("body").on("click","a.footer_agreement",function(e){e.preventDefault(),ngDialog.open({template:"/sp/resources/html/footer/agreement.html"})}),jQuery("body").on("click","a.footer_privacy",function(e){e.preventDefault(),ngDialog.open({template:"/sp/resources/html/footer/privacy.html"})}),jQuery("body").on("click","a.footer_cookies",function(e){e.preventDefault(),ngDialog.open({template:"/sp/resources/html/footer/cookies.html"})})},1e3),Array.prototype.filter||(Array.prototype.filter=function(fun){if(void 0===this||null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if("function"!=typeof fun)throw new TypeError;for(var res=[],thisArg=arguments.length>=2?arguments[1]:void 0,i=0;len>i;i++)if(i in t){var val=t[i];fun.call(thisArg,val,i,t)&&res.push(val)}return res}),Array.prototype.swapItems=function(a,b){return this[a]=this.splice(b,1,this[a])[0],this},Array.prototype.move=function(old_index,new_index){if(new_index>=this.length)for(var k=new_index-this.length;k--+1;)this.push(void 0);return this.splice(new_index,0,this.splice(old_index,1)[0]),this},$rootScope.emailRegex=/^[a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,10}$/i}]);
!function(){function addEventListener(element,event,cb){element.addEventListener?element.addEventListener(event,cb,!0):element.attachEvent(event,cb)}function setInnerText(element,text){if("undefined"==typeof element)return!1;var textProperty="innerText"in element?"innerText":"textContent";try{element[textProperty]=text}catch(anException){element.setAttribute("innerText",text)}}videojs.Youtube=videojs.MediaTechController.extend({init:function(player,options,ready){if(this.player_=player,this.featuresProgressEvents=!1,this.featuresTimeupdateEvents=!1,this.featuresPlaybackRate=!0,videojs.MediaTechController.call(this,player,options,ready),this.isIos=/(iPad|iPhone|iPod)/g.test(navigator.userAgent),this.isAndroid=/(Android)/g.test(navigator.userAgent),this.playVideoIsAllowed=!(this.isIos||this.isAndroid),(this.isIos||this.isAndroid)&&(this.player_.options().autoplay=!1),"undefined"!=typeof options.source)for(var key in options.source)options.source.hasOwnProperty(key)&&(player.options()[key]=options.source[key]);this.userQuality=videojs.Youtube.convertQualityName(player.options().quality),this.playerEl_=document.getElementById(player.id()),this.playerEl_.className+=" vjs-youtube",this.qualityButton=document.createElement("div"),this.qualityButton.setAttribute("class","vjs-quality-button vjs-menu-button vjs-control"),this.qualityButton.setAttribute("tabindex",0);var qualityContent=document.createElement("div");qualityContent.setAttribute("class","vjs-control-content"),this.qualityButton.appendChild(qualityContent),this.qualityTitle=document.createElement("span"),this.qualityTitle.setAttribute("class","vjs-control-text"),qualityContent.appendChild(this.qualityTitle),"undefined"!==player.options().quality&&setInnerText(this.qualityTitle,player.options().quality||"auto");var qualityMenu=document.createElement("div");if(qualityMenu.setAttribute("class","vjs-menu"),qualityContent.appendChild(qualityMenu),this.qualityMenuContent=document.createElement("ul"),this.qualityMenuContent.setAttribute("class","vjs-menu-content"),qualityMenu.appendChild(this.qualityMenuContent),this.id_=this.player_.id()+"_youtube_api",this.el_=videojs.Component.prototype.createEl("iframe",{id:this.id_,className:"vjs-tech",scrolling:"no",marginWidth:0,marginHeight:0,frameBorder:0}),this.el_.setAttribute("allowFullScreen",""),this.playerEl_.insertBefore(this.el_,this.playerEl_.firstChild),/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var ieVersion=Number(RegExp.$1);this.addIframeBlocker(ieVersion)}else/(iPad|iPhone|iPod|Android)/g.test(navigator.userAgent)||(this.el_.className+=" onDesktop",this.addIframeBlocker());this.parseSrc(player.options().src),this.playOnReady=this.player_.options().autoplay&&this.playVideoIsAllowed,this.forceSSL=!("undefined"!=typeof this.player_.options().forceSSL&&this.player_.options().forceSSL!==!0),this.forceHTML5=!("undefined"!=typeof this.player_.options().forceHTML5&&this.player_.options().forceHTML5!==!0),this.updateIframeSrc();var self=this;player.ready(function(){if(self.player_.options().controls){var controlBar=self.playerEl_.querySelectorAll(".vjs-control-bar")[0];controlBar&&controlBar.appendChild(self.qualityButton)}self.playOnReady&&!self.player_.options().ytcontrols&&("undefined"!=typeof self.player_.loadingSpinner&&self.player_.loadingSpinner.show(),"undefined"!=typeof self.player_.bigPlayButton&&self.player_.bigPlayButton.hide()),player.trigger("loadstart")}),this.on("dispose",function(){this.ytplayer&&this.ytplayer.destroy(),this.player_.options().ytcontrols||this.player_.off("waiting",this.bindedWaiting),this.playerEl_.querySelectorAll(".vjs-poster")[0].style.backgroundImage="none",this.el_.parentNode&&this.el_.parentNode.removeChild(this.el_),this.qualityButton.parentNode&&this.qualityButton.parentNode.removeChild(this.qualityButton),"undefined"!=typeof this.player_.loadingSpinner&&this.player_.loadingSpinner.hide(),"undefined"!=typeof this.player_.bigPlayButton&&this.player_.bigPlayButton.hide(),this.iframeblocker&&this.playerEl_.removeChild(this.iframeblocker)})}}),videojs.Youtube.prototype.updateIframeSrc=function(){var params={enablejsapi:1,iv_load_policy:3,playerapiid:this.id(),disablekb:1,wmode:"transparent",controls:this.player_.options().ytcontrols?1:0,html5:this.player_.options().forceHTML5?1:null,playsinline:this.player_.options().playsInline?1:0,showinfo:0,rel:0,autoplay:this.playOnReady?1:0,loop:this.player_.options().loop?1:0,list:this.playlistId,vq:this.userQuality,origin:window.location.protocol+"//"+window.location.host},isLocalProtocol="file:"===window.location.protocol||"app:"===window.location.protocol;isLocalProtocol&&delete params.origin;for(var prop in params)!params.hasOwnProperty(prop)||"undefined"!=typeof params[prop]&&null!==params[prop]||delete params[prop];var self=this;if(this.videoId){if(this.el_.src=(this.forceSSL||isLocalProtocol?"https:":window.location.protocol)+"//www.youtube.com/embed/"+this.videoId+"?"+videojs.Youtube.makeQueryString(params),this.player_.options().ytcontrols?this.player_.controls(!1):("undefined"==typeof this.player_.poster()||0===this.player_.poster().length)&&setTimeout(function(){self.player_.poster("https://img.youtube.com/vi/"+self.videoId+"/0.jpg")},100),this.bindedWaiting=function(){self.onWaiting()},this.player_.on("waiting",this.bindedWaiting),videojs.Youtube.apiReady)this.loadYoutube();else if(videojs.Youtube.loadingQueue.push(this),!videojs.Youtube.apiLoading){var tag=document.createElement("script");tag.onerror=function(e){self.onError(e)},tag.src=this.forceSSL||isLocalProtocol?"https://www.youtube.com/iframe_api":"//www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag),videojs.Youtube.apiLoading=!0}}else this.el_.src="about:blank",setTimeout(function(){self.triggerReady()},500)},videojs.Youtube.prototype.onWaiting=function(){"undefined"!=typeof this.player_.bigPlayButton&&this.player_.bigPlayButton.hide()},videojs.Youtube.prototype.addIframeBlocker=function(ieVersion){this.iframeblocker=videojs.Component.prototype.createEl("div"),this.iframeblocker.className="iframeblocker",this.iframeblocker.style.position="absolute",this.iframeblocker.style.left=0,this.iframeblocker.style.right=0,this.iframeblocker.style.top=0,this.iframeblocker.style.bottom=0,ieVersion&&9>ieVersion?this.iframeblocker.style.opacity=.01:this.iframeblocker.style.background="rgba(255, 255, 255, 0.01)";var self=this;addEventListener(this.iframeblocker,"mousemove",function(e){self.player_.userActive()||self.player_.userActive(!0),e.stopPropagation(),e.preventDefault()}),addEventListener(this.iframeblocker,"click",function(){self.paused()?self.play():self.pause()}),this.playerEl_.insertBefore(this.iframeblocker,this.el_.nextSibling)},videojs.Youtube.prototype.parseSrc=function(src){if(this.srcVal=src,src){var regId=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,match=src.match(regId);match&&11===match[2].length?this.videoId=match[2]:this.videoId=null;var regPlaylist=/[?&]list=([^#\&\?]+)/;match=src.match(regPlaylist),null!==match&&match.length>1?this.playlistId=match[1]:this.playlistId&&delete this.playlistId;var regVideoQuality=/[?&]vq=([^#\&\?]+)/;match=src.match(regVideoQuality),null!==match&&match.length>1&&(this.userQuality=match[1],setInnerText(this.qualityTitle,videojs.Youtube.parseQualityName(this.userQuality)))}},videojs.Youtube.prototype.src=function(src){if("undefined"!=typeof src){if(this.parseSrc(src),"about:blank"===this.el_.src)return void this.updateIframeSrc();delete this.defaultQuality,null!==this.videoId&&(this.player_.options().autoplay&&this.playVideoIsAllowed?this.ytplayer.loadVideoById({videoId:this.videoId,suggestedQuality:this.userQuality}):this.ytplayer.cueVideoById({videoId:this.videoId,suggestedQuality:this.userQuality}),this.playerEl_.querySelectorAll(".vjs-poster")[0].style.backgroundImage="url(https://img.youtube.com/vi/"+this.videoId+"/0.jpg)",this.player_.poster("https://img.youtube.com/vi/"+this.videoId+"/0.jpg"))}return this.srcVal},videojs.Youtube.prototype.load=function(){},videojs.Youtube.prototype.play=function(){null!==this.videoId&&(this.player_.options().ytcontrols||this.player_.trigger("waiting"),this.isReady_?(this.ytplayer.setVolume(100*this.player_.volume()),this.volumeVal>0?this.ytplayer.unMute():this.ytplayer.mute(),this.playVideoIsAllowed&&this.ytplayer.playVideo()):this.playOnReady=!0)},videojs.Youtube.prototype.pause=function(){this.ytplayer&&this.ytplayer.pauseVideo()},videojs.Youtube.prototype.paused=function(){return this.ytplayer?this.lastState!==YT.PlayerState.PLAYING&&this.lastState!==YT.PlayerState.BUFFERING:!0},videojs.Youtube.prototype.currentTime=function(){return this.ytplayer&&this.ytplayer.getCurrentTime?this.ytplayer.getCurrentTime():0},videojs.Youtube.prototype.setCurrentTime=function(seconds){this.ytplayer.seekTo(seconds,!0),this.player_.trigger("timeupdate"),this.player_.trigger("seeking"),this.isSeeking=!0},videojs.Youtube.prototype.playbackRate=function(){return this.ytplayer&&this.ytplayer.getPlaybackRate?this.ytplayer.getPlaybackRate():1},videojs.Youtube.prototype.setPlaybackRate=function(suggestedRate){this.ytplayer&&this.ytplayer.setPlaybackRate&&(this.ytplayer.setPlaybackRate(suggestedRate),this.player_.trigger("ratechange"))},videojs.Youtube.prototype.duration=function(){return this.ytplayer&&this.ytplayer.getDuration?this.ytplayer.getDuration():0},videojs.Youtube.prototype.currentSrc=function(){return this.srcVal},videojs.Youtube.prototype.ended=function(){return this.ytplayer?this.lastState===YT.PlayerState.ENDED:!1},videojs.Youtube.prototype.volume=function(){return this.ytplayer&&isNaN(this.volumeVal)&&(this.volumeVal=this.ytplayer.getVolume()/100,this.player_.volume(this.volumeVal)),this.volumeVal},videojs.Youtube.prototype.setVolume=function(percentAsDecimal){"undefined"!=typeof percentAsDecimal&&percentAsDecimal!==this.volumeVal&&(this.ytplayer.setVolume(100*percentAsDecimal),this.volumeVal=percentAsDecimal,this.player_.trigger("volumechange"))},videojs.Youtube.prototype.muted=function(){return this.mutedVal},videojs.Youtube.prototype.setMuted=function(muted){muted?(this.storedVolume=this.volumeVal,this.ytplayer.mute(),this.player_.volume(0)):(this.ytplayer.unMute(),this.player_.volume(this.storedVolume)),this.mutedVal=muted,this.player_.trigger("volumechange")},videojs.Youtube.prototype.buffered=function(){if(this.ytplayer&&this.ytplayer.getVideoBytesLoaded){var loadedBytes=this.ytplayer.getVideoBytesLoaded(),totalBytes=this.ytplayer.getVideoBytesTotal();if(!loadedBytes||!totalBytes)return 0;var duration=this.ytplayer.getDuration(),secondsBuffered=loadedBytes/totalBytes*duration,secondsOffset=this.ytplayer.getVideoStartBytes()/totalBytes*duration;return videojs.createTimeRange(secondsOffset,secondsOffset+secondsBuffered)}return videojs.createTimeRange(0,0)},videojs.Youtube.prototype.supportsFullScreen=function(){return"function"!=typeof this.el_.webkitEnterFullScreen||!/Android/.test(videojs.USER_AGENT)&&/Chrome|Mac OS X 10.5/.test(videojs.USER_AGENT)?!1:!0},videojs.Youtube.isSupported=function(){return!0},videojs.Youtube.canPlaySource=function(srcObj){return"video/youtube"===srcObj.type},videojs.Youtube.canControlVolume=function(){return!0},videojs.Youtube.loadingQueue=[],videojs.Youtube.prototype.loadYoutube=function(){this.ytplayer=new YT.Player(this.id_,{events:{onReady:function(e){e.target.vjsTech.onReady()},onStateChange:function(e){e.target.vjsTech.onStateChange(e.data)},onPlaybackQualityChange:function(e){e.target.vjsTech.onPlaybackQualityChange(e.data)},onError:function(e){e.target.vjsTech.onError(e.data)}}}),this.ytplayer.vjsTech=this},videojs.Youtube.makeQueryString=function(args){var array=["modestbranding=1"];for(var key in args)args.hasOwnProperty(key)&&array.push(key+"="+args[key]);return array.join("&")},window.onYouTubeIframeAPIReady=function(){for(var yt;yt=videojs.Youtube.loadingQueue.shift();)yt.loadYoutube();videojs.Youtube.loadingQueue=[],videojs.Youtube.apiReady=!0},videojs.Youtube.prototype.onReady=function(){this.isReady_=!0,this.triggerReady(),this.player_.trigger("loadedmetadata"),this.player_.trigger("durationchange"),this.player_.trigger("timeupdate"),"undefined"==typeof this.player_.loadingSpinner||this.isIos||this.isAndroid||this.player_.loadingSpinner.hide(),this.player_.options().muted&&this.setMuted(!0),this.playOnReady&&(this.playOnReady=!1,this.play())},videojs.Youtube.prototype.updateQualities=function(){function setupEventListener(el){addEventListener(el,"click",function(){var quality=this.getAttribute("data-val");self.ytplayer.setPlaybackQuality(quality),self.userQuality=quality,setInnerText(self.qualityTitle,videojs.Youtube.parseQualityName(quality));var selected=self.qualityMenuContent.querySelector(".vjs-selected");selected&&videojs.Youtube.removeClass(selected,"vjs-selected"),videojs.Youtube.addClass(this,"vjs-selected")})}var qualities=this.ytplayer.getAvailableQualityLevels(),self=this;if(qualities.indexOf(this.userQuality)<0&&setInnerText(self.qualityTitle,videojs.Youtube.parseQualityName(this.defaultQuality)),0===qualities.length)this.qualityButton.style.display="none";else{for(this.qualityButton.style.display="";this.qualityMenuContent.hasChildNodes();)this.qualityMenuContent.removeChild(this.qualityMenuContent.lastChild);for(var i=0;i<qualities.length;++i){var el=document.createElement("li");el.setAttribute("class","vjs-menu-item"),setInnerText(el,videojs.Youtube.parseQualityName(qualities[i])),el.setAttribute("data-val",qualities[i]),qualities[i]===this.quality&&videojs.Youtube.addClass(el,"vjs-selected"),setupEventListener(el),this.qualityMenuContent.appendChild(el)}}},videojs.Youtube.prototype.onStateChange=function(state){if(state!==this.lastState){switch(state){case-1:this.player_.trigger("durationchange");break;case YT.PlayerState.ENDED:fireAnalyticsEvent(this.videoId,"Watch to End"),this.player_.options().ytcontrols||(this.playerEl_.querySelectorAll(".vjs-poster")[0].style.display="block","undefined"!=typeof this.player_.bigPlayButton&&this.player_.bigPlayButton.show()),this.player_.trigger("ended");break;case YT.PlayerState.PLAYING:(void 0===this.isSeeking||this.isSeeking===!1||2===this.lastState)&&fireAnalyticsEvent(this.videoId,"Play"),this.playerEl_.querySelectorAll(".vjs-poster")[0].style.display="none",this.playVideoIsAllowed=!0,this.updateQualities(),this.player_.trigger("timeupdate"),this.player_.trigger("durationchange"),this.player_.trigger("playing"),this.player_.trigger("play"),this.isSeeking&&(this.player_.trigger("seeked"),this.isSeeking=!1);break;case YT.PlayerState.PAUSED:fireAnalyticsEvent(this.videoId,"Pause"),this.player_.trigger("pause");break;case YT.PlayerState.BUFFERING:this.player_.trigger("timeupdate"),this.player_.options().ytcontrols||this.player_.trigger("waiting");break;case YT.PlayerState.CUED:}this.lastState=state}};var fireAnalyticsEvent=function(videoId,state){var dataLayerName="dataLayer",videoUrl="https://www.youtube.com/watch?v="+videoId,_ga=window.GoogleAnalyticsObject;"undefined"!=typeof window[dataLayerName]?window[dataLayerName].push({event:"youTubeTrack",attributes:{videoUrl:videoUrl,videoAction:state}}):"function"==typeof window[_ga]&&"function"==typeof window[_ga].getAll?window[_ga]("send","event","Videos",state,videoUrl):"undefined"!=typeof window._gaq&&window._gaq.push(["_trackEvent","Videos",state,videoUrl])};videojs.Youtube.convertQualityName=function(name){switch(name){case"144p":return"tiny";case"240p":return"small";case"360p":return"medium";case"480p":return"large";case"720p":return"hd720";case"1080p":return"hd1080"}return"auto"},videojs.Youtube.parseQualityName=function(name){switch(name){case"tiny":return"144p";case"small":return"240p";case"medium":return"360p";case"large":return"480p";case"hd720":return"720p";case"hd1080":return"1080p"}return"auto"},videojs.Youtube.prototype.onPlaybackQualityChange=function(quality){if("undefined"!=typeof this.defaultQuality||(this.defaultQuality=quality,"undefined"==typeof this.userQuality)){switch(this.quality=quality,setInnerText(this.qualityTitle,videojs.Youtube.parseQualityName(quality)),quality){case"medium":this.player_.videoWidth=480,this.player_.videoHeight=360;break;case"large":this.player_.videoWidth=640,this.player_.videoHeight=480;break;case"hd720":this.player_.videoWidth=960,this.player_.videoHeight=720;break;case"hd1080":this.player_.videoWidth=1440,this.player_.videoHeight=1080;break;case"highres":this.player_.videoWidth=1920,this.player_.videoHeight=1080;break;case"small":this.player_.videoWidth=320,this.player_.videoHeight=240;break;case"tiny":this.player_.videoWidth=144,this.player_.videoHeight=108;break;default:this.player_.videoWidth=0,this.player_.videoHeight=0}this.player_.trigger("ratechange")}},videojs.Youtube.prototype.onError=function(error){this.player_.error(error),(100===error||101===error||150===error)&&(this.player_.bigPlayButton.hide(),this.player_.loadingSpinner.hide(),this.player_.posterImage.hide())},videojs.Youtube.addClass=function(element,classToAdd){-1===(" "+element.className+" ").indexOf(" "+classToAdd+" ")&&(element.className=""===element.className?classToAdd:element.className+" "+classToAdd)},videojs.Youtube.removeClass=function(element,classToRemove){var classNames,i;if(-1!==element.className.indexOf(classToRemove)){for(classNames=element.className.split(" "),i=classNames.length-1;i>=0;i--)classNames[i]===classToRemove&&classNames.splice(i,1);element.className=classNames.join(" ")}};var style=document.createElement("style"),def=" .vjs-youtube .vjs-poster { background-size: 100%!important; }.vjs-youtube .vjs-poster, .vjs-youtube .vjs-loading-spinner, .vjs-youtube .vjs-big-play-button, .vjs-youtube .vjs-text-track-display{ pointer-events: none !important; }.vjs-youtube.vjs-user-active .iframeblocker { display: none; }.vjs-youtube.vjs-user-inactive .vjs-tech.onDesktop { pointer-events: none; }.vjs-quality-button > div:first-child > span:first-child { position:relative;top:7px }";style.setAttribute("type","text/css"),document.getElementsByTagName("head")[0].appendChild(style),style.styleSheet?style.styleSheet.cssText=def:style.appendChild(document.createTextNode(def)),Array.prototype.indexOf||(Array.prototype.indexOf=function(elt){var len=this.length>>>0,from=Number(arguments[1])||0;for(from=0>from?Math.ceil(from):Math.floor(from),0>from&&(from+=len);len>from;from++)if(from in this&&this[from]===elt)return from;return-1})}();
function LibraryController($scope,ajaxService,sharedProperties,$timeout,userDataService,$localStorage,ngDialog,$q){$scope.searchKeys=[],$scope.search={},$scope.commentBox={},$scope.loggedInUser={},$scope.commentEditEnabled=!1,$scope.comments={},$scope.commentBoxes={},$scope.videoAvailable=!1,$scope.imageAvailable=!1,$scope.updateBtnDisabled=!1,$scope.newCommentBox={},$scope.topBox={},$scope.pageSize=20,$scope.existingKeys=[],$scope.searchKeywords={},$scope.btn={},$scope.searchPlaceHolderValue="e.g. Listening",$scope.commentsReady=!1,$scope.searchWithKeys={},$scope.newDate={},$scope.newDate.currentDay=new Date,$scope.newDate={year:$scope.newDate.currentDay.getFullYear(),month:$scope.newDate.currentDay.getMonth()+1,day:$scope.newDate.currentDay.getDate()},$scope.dd={},$scope.dd.hideDropDown=!1,$scope.searchTopic={},$scope.tab=0,$scope.showAddToGoalsBtn=!1,$scope.articlePageReady=!1,$scope.thanks=!1,$scope.emailMemberList=[],$scope.searchTag=[],$scope.inputRequired=!1,$scope.shortDescription=null,$scope.shareEnable=!1,$scope.winWidth=jQuery(window).width(),$scope.winHeight=$(window).height()+100+"px",$scope.formatDate=function(d){if(null!==d&&"undefined"!==d){var splitDate=d.split("-"),monthData={"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"},month=parseInt(splitDate[1])<=9?"0"+splitDate[1]:splitDate[1],formattedDate=monthData[month.toString()]+" "+parseInt(splitDate[2])+", "+parseInt(splitDate[0]);return formattedDate}},$scope.today=$scope.formatDate($scope.newDate.year+"-"+$scope.newDate.month+"-"+$scope.newDate.day),$scope.isArticleBookmarked=!1,$scope.recommendBtnDisabled=!0,$scope.articleBtnDisabled=!0,$scope.comments={add:function(c,id){if($scope.newCommentBox.submitted=!1,null!==c&&""!==c&&"undefined"!=typeof c){var _o={url:"/sp/trainingLibrary/addComment",data:$.param({comment:c,articleId:id})};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.topBox.newComment=null,$scope.getArticle(),sharedProperties.fireAnalyticsEvent("Knowledge Center | Comment Added",id))})}else $scope.newCommentBox.submitted=!0},update:function(i,id){var commentNgModel="commentBox_"+i,errorBox=jQuery("body").find("span.error_msg_"+i),commentTextbox=jQuery("body").find("form[name=commentBoxForm_"+i+"]"),commentbox=jQuery("body").find("p.user-comment[data-comment=cBox_"+i+"]"),editBtns=jQuery("body").find("p.comment-btns[data-btns=cBtns_"+i+"]"),cancelBtns=jQuery("body").find("a[data-cancel=cancelBtn_"+i+"]");if(jQuery(errorBox).hasClass("hide")||jQuery(errorBox).addClass("hide"),"undefined"!=typeof $scope.commentBoxes[commentNgModel]){var _o={url:"/sp/trainingLibrary/updateComment",data:$.param({comment:$scope.commentBoxes[commentNgModel],articleId:id,candidateEmail:$scope.loggedInUser.email,index:i}).replace(/%40/g,"@").replace(/%2C/g,",")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&(jQuery(editBtns).removeClass("hide"),jQuery(cancelBtns).removeClass("show").addClass("hide"),jQuery(commentTextbox).addClass("hide"),jQuery(commentbox).removeClass("hide"),$scope.getArticle(),sharedProperties.fireAnalyticsEvent("Knowledge Center | Comment Updated",id))})}else jQuery(errorBox).removeClass("hide")},"delete":function(i,id){var commentNgModel="commentBox_"+i,_o={url:"/sp/trainingLibrary/removeComment",data:$.param({comment:$scope.commentBoxes[commentNgModel],articleId:id,commentorEmail:$scope.loggedInUser.email,index:i}).replace(/%40/g,"@").replace(/%2C/g,",")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.getArticle(),sharedProperties.fireAnalyticsEvent("Knowledge Center | Comment Deleted",id))})},edit:function(i){var commentTextbox=jQuery("body").find("form[name=commentBoxForm_"+i+"]"),commentbox=jQuery("body").find("p.user-comment[data-comment=cBox_"+i+"]"),commentNgModel="commentBox_"+i,textBoxComment=jQuery(commentTextbox).find("textarea").attr("data-comments"),editBtns=jQuery("body").find("p.comment-btns[data-btns=cBtns_"+i+"]"),cancelBtns=jQuery("body").find("a[data-cancel=cancelBtn_"+i+"]");jQuery(editBtns).addClass("hide"),jQuery(cancelBtns).addClass("show"),jQuery(commentTextbox).removeClass("hide"),jQuery(commentbox).addClass("hide"),$scope.commentBoxes[commentNgModel]=textBoxComment,$scope.commentEditEnabled=!0},cancel:function(i){var commentTextbox=jQuery("body").find("form[name=commentBoxForm_"+i+"]"),commentbox=jQuery("body").find("p.user-comment[data-comment=cBox_"+i+"]"),editBtns=jQuery("body").find("p.comment-btns[data-btns=cBtns_"+i+"]"),cancelBtns=jQuery("body").find("a[data-cancel=cancelBtn_"+i+"]");jQuery(editBtns).removeClass("hide"),jQuery(cancelBtns).removeClass("show").addClass("hide"),jQuery(commentTextbox).addClass("hide"),jQuery(commentbox).removeClass("hide"),$scope.commentEditEnabled=!1}},$scope.formattedAuthor=function(a){return"undefined"!=typeof a&&""!==a?a.join(", "):void 0},$scope.fetchSearchData=function(key){if($scope.searchTopic.searchTopicValue=null,$scope.dd.hideDropDown=!0,"Themes"===key?$scope.searchPlaceHolderValue="e.g. Listening":$scope.searchPlaceHolderValue=null,-1===$.inArray(key,$scope.existingKeys))if($scope.existingKeys.push(key),$scope.searchKeywords[key]=[],null===$localStorage.get("getTopics"+key)){var options={url:"/sp/trainingLibrary/getAllTopics",data:$.param({topic:key})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){$localStorage.set("getTopics"+key,response),$scope.searchKeys=[],$scope.searchWithKeys[key]=response.topics;var fetchedTopics=response.topics;for(var k in fetchedTopics)fetchedTopics.hasOwnProperty(k)&&$scope.searchKeywords[key].push(fetchedTopics[k]);$scope.searchKeys=$scope.searchKeywords[key].sort()}})}else{var _r=$localStorage.get("getTopics"+key);$scope.searchKeys=[],$scope.searchWithKeys[key]=_r.topics;var fetchedTopics=_r.topics;for(var k in fetchedTopics)fetchedTopics.hasOwnProperty(k)&&$scope.searchKeywords[key].push(fetchedTopics[k]);$scope.searchKeys=$scope.searchKeywords[key].sort()}else $scope.searchKeys=$scope.searchKeywords[key]},$scope.searchResultSelected=function(k){$scope.searchTopic.searchTopicValue=k,$scope.dd.hideDropDown=!0},$scope.startSearch=function(c,ki){var k;for(var key in $scope.searchWithKeys[$scope.search.topicCategory])$scope.searchWithKeys[$scope.search.topicCategory][key]===ki&&(k=key);if($scope.selectCategoryError=!1,"default"!==c){var url="/sp/trainingLibrary/results#topicCategory="+encodeURIComponent(c)+"&topicValue="+("undefined"==typeof k||null===k||""===k?"":encodeURIComponent(k)+":"+encodeURIComponent(ki));window.location=url}else $scope.selectCategoryError=!0},$scope.refreshSearch=function(c,k,p,pageType){var url,urlParams,options,plural,ki;if(p===!0){url=window.location.href,urlParams=url.substring(url.indexOf("#")+1).replace(/\//g,"");var splitParams=urlParams.split("&"),paramCategory=splitParams[0].split("=")[1],paramTopic=splitParams[1].split("=")[1];null!==paramCategory&&""!==paramCategory&&"undefined"!=typeof paramCategory?(c=paramCategory.toString().replace(/\+/g," ").replace(/%20/g," "),plural="Author"===c||"Source"===c?"s":"",$scope.search.topicCategory=c,$scope.fetchSearchData(c),$scope.dd.hideDropDown=!0,$scope.searchTerm="All "+("Themes"===c?"Practice Areas":c)+plural):($scope.search.topicCategory="Themes",$scope.searchTerm="All Practice Areas",$scope.fetchSearchData("All Themes")),null!==paramTopic&&""!==paramTopic&&"undefined"!=typeof paramTopic?(k=paramTopic.toString().split(":")[0].replace(/\+/g," ").replace(/%20/g," "),ki=paramTopic.toString().split(":")[1].replace(/\+/g," ").replace(/%20/g," "),$scope.searchTopic.searchTopicValue=ki,$scope.searchTerm=ki):$scope.searchTopic.searchTopicValue=null}else if(null!==c&&""!==c&&"undefined"!=typeof c?(plural="Author"===c||"Source"===c?"s":"",$scope.search.topicCategory=c,$scope.searchTerm="All "+("Themes"===c?"Practice Areas":c)+plural,"Themes"===c&&$scope.fetchSearchData(c),window.location.hash="topicCategory="+c+"&topicValue="):($scope.search.topicCategory="Themes",$scope.searchTerm="All Themes",$scope.fetchSearchData("All Themes"),window.location.hash="topicCategory=Themes&topicValue="),null!==k&&""!==k&&"undefined"!=typeof k){for(var key in $scope.searchWithKeys[$scope.search.topicCategory])$scope.searchWithKeys[$scope.search.topicCategory][key]===k&&(ki=k,k=key);"Themes"!==$scope.search.topicCategory?($scope.searchTopic.searchTopicValue=k,$scope.searchTerm=k,window.location.hash="topicCategory="+c+"&topicValue="+k):($scope.searchTopic.searchTopicValue=ki,$scope.searchTerm=ki,window.location.hash="topicCategory="+c+"&topicValue="+k+":"+ki)}else $scope.searchTopic.searchTopicValue=null;"bookmark"===pageType?window.location.href="/sp/trainingLibrary/results"+window.location.hash:(options={url:"/sp/trainingLibrary/getResults",data:$.param({topicCategory:c,topicValue:k})},ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){$scope.trainingSpotlight(k),$scope.searchFilterVal=null,$scope.tab=0,$scope.pageSize=20,$scope.articleResultData=response,$scope.articleResultsBackup=response.articles,$scope.totalArticles=$scope.articleResultsBackup.length,$scope.articleResultsBackup.length>20?($scope.articleResults=$scope.articleResultsBackup,$scope.btn.hideLoadMore=!1):($scope.articleResults=$scope.articleResultsBackup,$scope.btn.hideLoadMore=!0),$scope.articleFilters=[];var searchFilters=[];$.each($scope.articleResultsBackup,function(i,j){searchFilters.push(j.articleTypeFormatted)}),$scope.articleFilters=searchFilters.unique(),jQuery("html, body").animate({scrollTop:0}),sharedProperties.fireAnalyticsEvent("Knowledge Center | Search by Practice Area",$scope.searchTerm)}}))},$scope.loadMoreResults=function(){$scope.articleResultsBackup.length>$scope.pageSize&&($scope.pageSize+=20,$scope.pageSize>$scope.articleResultsBackup.length&&($scope.disabledInfinite=!0,$scope.pageSize=$scope.articleResultsBackup.length))},$scope.updateArticleLink=function(l){var link=l.split("/"),linkID=link[parseInt(link.length-1)],formattedLink="/sp/trainingLibrary/article?"+linkID;return formattedLink},$scope.trackArticle=function(id){var options={url:"/sp/tracking/trackArticles",data:$.param({articleId:id,trackingType:"ARTICLES"})};ajaxService.getAjaxResponse(options)},$scope.getArticle=function(){var url=window.location.href,urlParams=url.substring(url.indexOf("?")+1).split("&")[0],options={url:"/sp/trainingLibrary/getArticleDetail/"+urlParams,method:"GET"};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){if($scope.articlePageDetails=response.article,$scope.articlePageDetailsAuthors=response.article.author.join(", "),$scope.articleComments=response.article.comments,$scope.commentList=[],$scope.trainingSpotlight($scope.articlePageDetails.goalIds[0]),$scope.relatedContent=response.relatedArticles,response.article.canAddToUserGoals===!0?$scope.showAddToGoalsBtn=!0:$scope.showAddToGoalsBtn=!1,response.article.articleForUser!==!0||"NOT_STARTED"!==response.article.userArticleStatus&&null!==response.article.userArticleStatus?$scope.updateBtnDisabled=!0:$scope.updateBtnDisabled=!1,"COMPLETED"===response.article.userArticleStatus?$scope.articleCompletedBtn=!0:$scope.articleCompletedBtn=!1,"undefined"!=typeof response.article.articleBookmarked&&null!==response.article.articleBookmarked&&($scope.isArticleBookmarked=response.article.articleBookmarked),"undefined"!=typeof response.article.imageUrl&&null!==response.article.imageUrl?($scope.imageAvailable=!0,$scope.articleHeroImage=response.article.imageUrl):$scope.imageAvailable=!1,"undefined"!=typeof response.article.videoUrl&&null!==response.article.videoUrl){$scope.videoAvailable=!0,$scope.articleVideo=response.article.videoUrl;var videoType;if(/youtube/g.test(response.article.videoUrl))videoType="youtube";else if(/vimeo/g.test(response.article.videoUrl)){videoType="vimeo";var link=$scope.articleVideo.split("?")[0].split("/");$scope.articleVideo="https://vimeo.com/"+link[parseInt(link.length-1)]}else videoType="html5";setTimeout(function(){videojs(document.getElementById("vid1"),{autoplay:!1,techOrder:[videoType],src:$scope.articleVideo},function(){})},500)}else $scope.videoAvailable=!1;$scope.profileReady===!0&&($scope.loggedInUser=userDataService.retrive(),$scope.loggedInUser.first=$scope.loggedInUser.member.firstName,$scope.loggedInUser.last=$scope.loggedInUser.member.lastName,$scope.loggedInUser.email=$scope.loggedInUser.member.email,$.each($scope.articleComments,function(i,j){var updatedComment=jQuery.extend({},$scope.articleComments[i],{mName:"commentBox_"+i,showOptions:$scope.articleComments[i].by.email===$scope.loggedInUser.email?!0:!1});$scope.commentList.push(updatedComment)}),$timeout(function(){$scope.commentsReady=!0},200)),$scope.articlePageReady=!0,$scope.trackArticle(urlParams);var readabilityData={},readability=response.article.articleReadability,element=document.getElementById("readability");null!==readability&&"undefined"!=typeof readability&&(readabilityData.FleschKincaidReadingEase=readability.fleschKincaidReadingEase,readabilityData.FleschKincaidGradeLevel=readability.fleschKincaidGradeLevel,readabilityData.GunningFogScore=readability.gunningFogScore,readabilityData.ColemanLiauIndex=readability.colemanLiauIndex,readabilityData.SmogIndex=readability.smogIndex,readabilityData.AutomatedReadabilityIndex=readability.automatedReadabilityIndex,readabilityData.Average=readability.average,element.setAttribute("data-readability-values",JSON.stringify(readabilityData)))}})},$scope.filterResults=function(f,i,e){e.preventDefault(),$scope.btn.hideLoadMore=!0,$timeout(function(){$scope.pageSize>$scope.currentArticleCount.length?$scope.btn.hideLoadMore=!0:$scope.btn.hideLoadMore=!1},300),$scope.searchFilterVal=f,$scope.tab=i},$scope.updateDashboard=function(id){if($scope.updateBtnDisabled===!1){var options={url:"/sp/trainingLibrary/udpateArticleToProfile",data:$.param({articleId:id})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&($scope.updateBtnDisabled=!0,$scope.articleHelpFul=!0,$.growl({icon:"glyphicon glyphicon-ok",message:" Dashboard updated successfully"}),sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Completed",id))})}},$scope.recommendArtice=function(id,doReccomend){$scope.recommendBtnDisabled=!1;var options={url:"/sp/trainingLibrary/recommendArticle",data:$.param({articleId:id,doReccomend:!doReccomend})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){$scope.recommendBtnDisabled=!0,$scope.articlePageDetails.articleRecommendedByUser=!$scope.articlePageDetails.articleRecommendedByUser,$scope.articlePageDetails.recommendationCount=response.recommendationCount;var message=$scope.articlePageDetails.articleRecommendedByUser?"Article recommended":" Article recommendation removed";$.growl({icon:"glyphicon glyphicon-ok",message:message}),sharedProperties.fireAnalyticsEvent("Knowledge Center | "+message,id)}else if(null!=response.error){$scope.recommendBtnDisabled=!0;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$scope.articleBookmark=function(id){$scope.isArticleBookmarked===!0&&"undefined"!=typeof $scope.isArticleBookmarked?$scope.sendArticleBookmark=!1:$scope.sendArticleBookmark=!0,$scope.articleBtnDisabled=!1;var options={url:"/sp/tracking/bookMarkArticle",data:$.param({articleId:id,trackingType:"ARTICLES",isBookMarked:$scope.sendArticleBookmark})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?($scope.articleBtnDisabled=!0,$scope.sendArticleBookmark===!0?($.growl({icon:"glyphicon glyphicon-ok",message:" Article bookmarked"}),sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Bookmarked",id)):($.growl({icon:"glyphicon glyphicon-ok",message:" Bookmark removed"}),sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Bookmark removed",id)),$scope.isArticleBookmarked=!$scope.isArticleBookmarked):$scope.articleBtnDisabled=!0})},$scope.getAllBookmarks=function(){$scope.search.topicCategory="Themes",ajaxService.getAjaxResponse({url:"/sp/tracking/getAllBookMarkedArticles",method:"get"}).then(function(response){if("true"===response.Success){$scope.recentBookmarkList=response.articles,$scope.articleFilters=[];var searchFilters=[];$.each($scope.recentBookmarkList,function(i,j){searchFilters.push(j.articleTypeFormatted)}),$scope.articleFilters=searchFilters.unique()}})},$scope.getAllBookmarksWithTrainingSpotlight=function(){$scope.search.topicCategory="Themes",ajaxService.getAjaxResponse({url:"/sp/tracking/getAllBookMarkedArticles",method:"get"}).then(function(response){if("true"===response.Success){$scope.trainingSpotlight(),$scope.recentBookmarkList=response.articles,$scope.articleFilters=[];var searchFilters=[];$.each($scope.recentBookmarkList,function(i,j){searchFilters.push(j.articleTypeFormatted)}),$scope.articleFilters=searchFilters.unique()}})},$scope.trendingTopRatedArticles=function(){if(null===$localStorage.get("tntArticles"))ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/trendingAndTopRated"}).then(function(response){"true"===response.Success&&($localStorage.set("tntArticles",response),$scope.trendingList=response.trendingArticles,$scope.topRatedList=response.topArticles)});else{var _r=$localStorage.get("tntArticles");$scope.trendingList=_r.trendingArticles,$scope.topRatedList=_r.topArticles}},$scope.trainingSpotlight=function(id){ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/trainingSpotlight",data:$.param({goalId:"undefined"!=typeof id?id:""})}).then(function(response){"true"===response.Success&&($scope.trainingSpotlightContent=response.trainingSpotLight)})},$scope.addtoGoals=function(id,search){ajaxService.getAjaxResponse({url:"/sp/goals/addArticleToUserGoals",method:"post",data:$.param({articleId:id})}).then(function(response){"true"===response.Success&&($scope.showAddToGoalsBtn=!1,$scope.updateBtnDisabled=!1,search===!0&&jQuery.each($scope.articleResults,function(i){return $scope.articleResults[i].articleLinkUrl===id?($scope.articleResults[i].canAddToUserGoals=!1,$scope.articleResults[i].userArticleStatus="NOT_STARTED",!1):void 0}),$.growl({icon:"glyphicon glyphicon-ok",message:" Article added successfully"}))})},$scope.shareArticle=function(articleId){$scope.inputRequired=!1,$scope.shareEnable=!0,$scope.shareArticleId=articleId,$scope.searchTag=[],!$scope.emailMemberList.length&&$scope.getMemberList(articleId),null===$scope.shortDescription?ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/getShortDescription",data:$.param({articleId:articleId})}).then(function(response){"true"===response.Success&&($scope.winHeight=$(window).height()+100+"px",$scope.shortDescription=response.shortDescription,ngDialog.open({template:"/sp/trainingLibrary/share",scope:$scope,className:$scope.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"}))}):($scope.winHeight=$(window).height()+100+"px",ngDialog.open({template:"/sp/trainingLibrary/share",scope:$scope,className:$scope.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"}))},$scope.articleShared=function(obj){return obj.email.length?void ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/shareArticle",data:$.param({articleId:obj.articleId,comment:obj.comment,toList:obj.email.toString()})}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$scope.shareEnable=!1,$.growl({icon:"glyphicon glyphicon-ok",message:" Article shared successfully"}),sharedProperties.fireAnalyticsEvent("Knowledge Center | Article Shared",obj.articleId);else{ngDialog.close("ngdialog1"),$scope.shareEnable=!1;for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}}):($scope.inputRequired=!0,!0)},$scope.getMemberList=function(articleId){ajaxService.getAjaxResponse({url:"/sp/allUsers"}).then(function(response){if("true"===response.Success)$scope.emailMemberList=response.allMembers;else{for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})},$scope.loadTags=function(query){var deferred=$q.defer(),result=$scope.emailMemberList.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise},$scope.tagAdded=function(tag){$scope.searchTag.push(tag.email),$scope.inputRequired=!1},$scope.tagRemoved=function(tag){$scope.searchTag.splice($scope.searchTag.indexOf(tag.email),1)},$scope.useful=function(obj){ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/usefullArticle",data:$.param({articleId:obj.articleId,isUseFull:obj.isUseFull})}).then(function(response){if("true"===response.Success)$scope.thanks=!0,obj.isUseFull?sharedProperties.fireAnalyticsEvent("Knowledge Center | Article helpful",obj.articleId):sharedProperties.fireAnalyticsEvent("Knowledge Center | Article not helpful",obj.articleId),$timeout(function(){$scope.articleHelpFul=!1,$scope.articleCompletedBtn=!0},3e3);else{for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})},$scope.closeThis=function(){$scope.shareEnable=!1,this.closeThisDialog()},$scope.trainingLibraryControl=[],$scope.itemPositioned=[],$scope.fn=function(){var $slidesElem=$(".dragZone"),slidesHeight=$slidesElem.find(".inputBox").outerHeight(),slidesWidth=$slidesElem.find(".inputBox").outerWidth();return this.init=function(drag){this.getTrainingLibraryRecords(drag)},this.getTrainingLibraryRecords=function(drag){var storageCheck=$localStorage.get("trainingLibraryRecord");return null!=storageCheck&&storageCheck.Content.length?($scope.trainingLibraryControl=storageCheck,!0):void ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/homeArticles"}).then(function(response){if("true"===response.Success)$scope.trainingLibraryControl=response,$localStorage.set("trainingLibraryRecord",response);else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})},this.dragIt=function(){$scope.pckry=$slidesElem.packery({handle:".handleMe",rowHeight:slidesHeight,columnWidth:slidesWidth});var itemElems=$scope.pckry.packery("getItemElements");$scope.initialItem=itemElems;for(var i=0,len=itemElems.length;len>i;i++){var draggie=new Draggabilly(itemElems[i],{axis:"y",containment:$slidesElem,handle:".handle",grid:[0,78]});$scope.pckry.packery("bindDraggabillyEvents",draggie)}$scope.pckry.packery("on","dragItemPositioned",this.orderItems),$scope.pckry.packery("on","layoutComplete",this.orderItems)},this.orderItems=function(){for(var $itemElems=$scope.pckry.packery("getItemElements"),i=0;i<$itemElems.length;i++){var indexToPut=$($itemElems[i]).attr("tabindex");$scope.itemPositioned[i]=indexToPut,$($itemElems[i]).attr("data-module-index",i)}},this.callSaveInLoop=function(form){if(form.$valid)for(var i=0;i<$slidesElem.find(".handleMe").length;i++){var _this=$($slidesElem.find(".handleMe")[i]),_obj={articleId:_this.find(".js_articleId").val(),shortDescription:_this.find(".js_shtDesc").val(),position:_this.attr("data-module-index")};this.saveTheRecord(_obj)}},this.saveTheRecord=function(_obj){ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/admin/add/contentArticles",data:$.param(_obj)}).then(function(response){if("true"===response.Success)$.growl({icon:"glyphicon glyphicon-ok",message:"SAVED"});else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})},this},function(){$scope.callTraining=new $scope.fn}(),jQuery(function($){fireAnalyticsCall()});var fireAnalyticsCall=function(){$("body").on("click",".event-featured-articles a",function(event){event.preventDefault();var redirectUrl=$(this).attr("href");sharedProperties.fireAnalyticsEvent("Knowledge Center | Viewed Featured Article",redirectUrl),window.location.href=redirectUrl}),$("body").on("click",".event-trending-articles a",function(event){event.preventDefault();var redirectUrl=$(this).attr("href");sharedProperties.fireAnalyticsEvent("Knowledge Center | Viewed Top Trending Article",redirectUrl),window.location.href=redirectUrl}),$("body").on("click",".event-top-rated-articles a",function(event){event.preventDefault();var redirectUrl=$(this).attr("href");sharedProperties.fireAnalyticsEvent("Knowledge Center | Viewed Top Rated Article",redirectUrl),window.location.href=redirectUrl}),$("body").on("click",".event-spotlight-articles a",function(event){event.preventDefault();var redirectUrl=$(this).attr("href");sharedProperties.fireAnalyticsEvent("Knowledge Center | Viewed Spotlight Article",redirectUrl),window.location.href=redirectUrl}),$("body").on("click",".event-related-content-articles a",function(event){event.preventDefault();var redirectUrl=$(this).attr("href");sharedProperties.fireAnalyticsEvent("Knowledge Center | Viewed Related Content Article",redirectUrl),window.location.href=redirectUrl}),$("body").on("click",".event-next-article a",function(event){event.preventDefault();var redirectUrl=$(this).attr("href");sharedProperties.fireAnalyticsEvent("Knowledge Center | Viewed Next  Article",redirectUrl),window.location.href=redirectUrl})}}angular.module("spApp").controller("LibraryController",LibraryController),LibraryController.$inject=["$scope","ajaxService","sharedProperties","$timeout","userDataService","$localStorage","ngDialog","$q"];
function accountDashboardController($scope,userDataService,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage,$filter){$scope.stateCheck={},$scope.settings={},$scope.companyDetails={},$scope.disableCompanyEditing=!0,$scope.disableProfileEditing=!0,$scope.disableLinkedinEditing=!0,$scope.disableIndividualEditing=!0,$scope.disableUserProfileEditing=!0,$scope.formStatus={},$scope.accountInfo={},$scope.profile={},$scope.userGroupList=[],$scope.userTagList=[],$scope.groupDataSet={},$scope.dataWithFlags=[],$scope.allGroupListCounter=0,$scope.linkeDInFormStatus=!1,$scope.profilePic="",$scope.userInitials="",$scope.assessmentDetails={},$scope.feedbackDetails={},$scope.goalsDetails={},$scope.growthTeamDetails={},$scope.userPermissions={},$scope.profileSetings={},$scope.userPermissions.isAccountAdministrator=!1,$scope.userPermissions.isAdministrator=!1,$scope.userPermissions.isHiringToolAllowed=!1,$scope.userPermissions.isWorkspacePulseAllowed=!1,$scope.userPermissions.isSpectrumAllowed=!1,$scope.userPermissions.isCompetencyAllowed=!1,$scope.profileSetings.is360ProfileAllowed=!1,$scope.profileSetings.isHiringAccessAllowed=!1,$scope.showPulsePermission=!1,$scope.showSpectrumPermission=!1,$scope.showCompetencyPermission=!1,$scope.showRelationshipAdvisor=!1,$scope.showThemeManager=!1,$scope.showEmailManager=!1,$scope.profileToken={},$scope.userGroupListBusiness=[],$scope.dataWithFlagsBusiness=[],$scope.groupDataSetBusiness={},$scope.allGroupListCounterBusiness=0,$scope.updatedEmail="",$scope.dialogStatus={},$scope.accountPermissionOptions={show:!0},$scope.openView=!0,$scope.enableBtns=!1,$scope.serverError=!1,$scope.serverError1=!1,$scope.currentUser={},$scope.currentUser.groupList="default",$scope.glStatusUpdate=!1,$scope.serverError1=!1,$scope.imageEditBox=!1,$scope.addAccounts={},$scope.addAccountsForm={},$scope.addAccountsForm.submitted=!1,$scope.adminsList=[],$scope.hiringAdminsList=[],$scope.priceFormatter=function(p){if("undefined"!=typeof p&&""!==p&&null!==p){var formattedPrice="$"+p.toFixed(2);return formattedPrice}},null!==$localStorage.get("spProfileTab")&&($scope.setTab=!0,$rootScope.callSwitchChange("spProfile")),$scope.apiConfig={urls:{company:{saveUpdate:"/sp/admin/account/updateCompany"},adminView:{saveUpdate:"/sp/admin/user/update/profile"},individual:{saveUpdate:"/sp/updateProfile"},userView:{saveUpdate:"/sp/updateProfile"},businessAccountDetails:"/sp/admin/account/businessAccountDetails",getCompanyDetails:"/sp/admin/account/getCompanyDetails",blockAllMembers:"/sp/admin/account/blockAllMembers",updateCompany:"/sp/admin/account/updateCompany",cancelAccount:"/sp/admin/account/cancel",updateLinkedIn:"/sp/admin/updateLinkedIn",restrictRelationshipAdvisor:"/sp/admin/account/restrictRelationshipAdvisor"}},$scope.setOptions=function(page){$scope.settings.currentPage=page,$localStorage.set("account_type",page)},$scope.enableEdit=function(f){"company"===f&&($scope.disableCompanyEditing=!1),"profile"===f&&($scope.disableProfileEditing=!1),"linkedin"===f&&($scope.disableLinkedinEditing=!1),"individual"===f&&($scope.disableIndividualEditing=!1),"userProfile"===f&&($scope.disableUserProfileEditing=!1)},$scope.disableEdit=function(f){"company"===f&&($scope.disableCompanyEditing=!0,$scope.getCompanyDetails()),"profile"===f&&($scope.disableProfileEditing=!0,$scope.getUserDetails()),"linkedin"===f&&($scope.disableLinkedinEditing=!0),"individual"===f&&($scope.disableIndividualEditing=!0,$scope.getIndividualUserDetails()),"userProfile"===f&&($scope.disableUserProfileEditing=!0,$scope.getUserDetailsBusiness()),$scope.formStatus.sumbit=!1,$scope.linkeDInFormStatus=!1},$scope.saveAndUpdate=function(formData,formName){var empCountErr;empCountErr="undefined"!=typeof formData.numberOfEmployees&&formData.numberOfEmployees<1?!1:!0;var URL=$scope.apiConfig.urls[$scope.settings.currentPage].saveUpdate,vCount=0;$scope.formStatus.sumbit=!1;for(var k in formData)if("object"==typeof formData[k])for(var l in formData[k])("default"===formData[k][l]||"default1"===formData[k][l])&&vCount++;else("default"===formData[k]||"default1"===formData[k])&&vCount++;this[formName].$valid&&0===vCount&&empCountErr?($scope.disableCompanyEditing=!0,$scope.disableProfileEditing=!0,$scope.disableIndividualEditing=!0,$scope.disableUserProfileEditing=!0,ajaxService.getAjaxResponse({url:URL,data:$.param(formData).replace(/address%5B/g,"").replace(/%5D/g,"").replace(/%2C/g,",")}).then(function(response){"true"===response.Success&&("company"===$scope.settings.currentPage&&$scope.getCompanyDetails(),"adminView"===$scope.settings.currentPage&&$scope.getUserDetails(),"individual"===$scope.settings.currentPage&&($localStorage.remove("loggegdInProfile"),window.location.reload()),"userView"===$scope.settings.currentPage&&($localStorage.remove("loggegdInProfile"),window.location.reload()))})):$scope.formStatus.sumbit=!0},$scope.getCompanyDetails=function(){ajaxService.getAjaxResponse({url:$scope.apiConfig.urls.getCompanyDetails}).then(function(response){"true"===response.Success&&($scope.companyDetail=response.company,$scope.companyDetail.address1=response.company.address.addressLine1,$scope.companyDetail.address2=response.company.address.addressLine2,$scope.companyDetail.zip=response.company.address.zipCode,$scope.stateCheck.forSelectedCountry=response.company.address.country,null!==response.company&&-1!==response.company.featureList.indexOf("RelationShipAdvisor")&&($scope.showRelationshipAdvisor=!0),null!==response.company&&-1!==response.company.featureList.indexOf("CompanyTheme")&&($scope.showThemeManager=!0),null!==response.company&&-1!==response.company.featureList.indexOf("EmailManagement")&&($scope.showEmailManager=!0))})},$scope.getAccountInfo=function(){var storedUser=$localStorage.get("loggegdInProfile");$scope.selfEmail=storedUser.member.email,ajaxService.getAjaxResponse({url:$scope.apiConfig.urls.businessAccountDetails}).then(function(response){"true"===response.Success?($scope.accountDetailsServerException=!1,$scope.accountDetailsServerException.message="",$scope.accountInfo=response,$scope.adminsList=response.planAdminUsers.Primary,$scope.hiringAdminsList=response.planAdminUsers.IntelligentHiring):($scope.accountDetailsServerException=!0,"undefined"!=typeof response.error.InvalidRequestException?$scope.accountDetailsExceptionMessage=response.error.InvalidRequestException:$scope.accountDetailsExceptionMessage="Error occured on server.")})},$scope.restrictAdvisor=function(status,e){var restrictStatus,dataParam={};restrictStatus=status===!1?!0:!1,dataParam.restrictAdvisor=restrictStatus,ajaxService.getAjaxResponse({url:$scope.apiConfig.urls.restrictRelationshipAdvisor,data:$.param(dataParam)}).then(function(response){if("true"===response.Success)$.growl({icon:"glyphicon glyphicon-ok",message:"Status Updated Successfully"});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$scope.blockAllMembers=function(status,e){var blockStatus,dataParam={};blockStatus=status===!1?!0:!1,dataParam.isBlockAllUsers=blockStatus,ajaxService.getAjaxResponse({url:$scope.apiConfig.urls.blockAllMembers,data:$.param(dataParam)}).then(function(response){if("true"===response.Success)$.growl({icon:"glyphicon glyphicon-ok",message:"Status Updated Successfully"});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$scope.showCancelDialog=function(i){"undefined"!=typeof i&&""!==i&&null!==i&&"individual"===i?$scope.individualCancel=!0:$scope.individualCancel=!1,$scope.dialogStatus.title="Cancel Subscription",$scope.dialogStatus.content="Subscription cancelled successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/cancel-subscription-dialog.html",scope:$scope})},$scope.showDetailsDialog=function(t){"members"===t?($scope.showDetails={title:"Member account details",total:'Total member accounts purchased : <span class="b-700">'+parseInt($scope.accountInfo.account.spPlans.Primary.numActive+$scope.accountInfo.account.spPlans.Primary.availalbeMemberSubscriptions+$scope.accountInfo.account.spPlans.Primary.numDeleted)+"</span>",active:$scope.accountInfo.account.spPlans.Primary.numActive,deleted:$scope.accountInfo.account.spPlans.Primary.numDeleted,available:$scope.accountInfo.account.spPlans.Primary.availalbeMemberSubscriptions},ngDialog.open({template:"/sp/resources/html/admin/account/show-details-dialog.html",scope:$scope})):($scope.showDetails={title:"Candidate account details",total:'Total candidate accounts purchased : <span class="b-700">'+parseInt($scope.accountInfo.account.hiringProduct.availableHiringSubscripitons+$scope.accountInfo.account.hiringProduct.usedHiringSubscriptions)+"</span>",active:$scope.accountInfo.account.hiringProduct.usedHiringSubscriptions,deleted:$scope.accountInfo.account.hiringProduct.availableHiringSubscripitons+$scope.accountInfo.account.hiringProduct.usedHiringSubscriptions-$scope.accountInfo.account.hiringProduct.availableHiringSubscripitons-$scope.accountInfo.account.hiringProduct.usedHiringSubscriptions,available:$scope.accountInfo.account.hiringProduct.availableHiringSubscripitons},ngDialog.open({template:"/sp/resources/html/admin/account/show-details-dialog.html",scope:$scope}))},$scope.cancelSubscription=function(){ajaxService.getAjaxResponse({url:$scope.apiConfig.urls.cancelAccount}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:" Subscription cancelled successfully "}),$timeout(function(){$scope.individualCancel===!0?$scope.getIndividualAccountInfo():$scope.getAccountInfo()},300)):(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Server </strong> ",message:Error}),$timeout(function(){$scope.individualCancel===!0?$scope.getIndividualAccountInfo():$scope.getAccountInfo()},300))})},$scope.showReactivateDialog=function(i){"undefined"!=typeof i&&""!==i&&null!==i&&"individual"===i?$scope.individualReactivate=!0:$scope.individualReactivate=!1,ajaxService.getAjaxResponse({url:"/sp/admin/account/reActivate"}).then(function(response){if("true"===response.Success)$scope.individualReactivate===!0?$scope.getIndividualAccountInfo():$scope.getAccountInfo(),$.growl({icon:"glyphicon glyphicon-ok",message:" Subscription renewal activated successfully"});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$scope.cancelRedirect=function(){"company"===$scope.settings.currentPage&&(window.location="/sp/admin/account/business"),"individual"===$scope.settings.currentPage&&(window.location="/sp/admin/account/individual")},$scope.initBusinessDashboard=function(){$scope.getCompanyDetails(),$scope.getAccountInfo(),null!==$localStorage.get("addAccounts")&&"undefined"!=typeof $localStorage.get("addAccounts")&&$timeout(function(){ngDialog.open({template:"/sp/resources/html/admin/account/request-success.html",scope:$scope}),$localStorage.remove("addAccounts")},300)},$scope.goBack=function(param){window.location.href=param},$scope.getUserDetails=function(){$scope.signedInUser=userDataService.retrive();var _params={userEmail:null!==$localStorage.get("memEmail")?$localStorage.get("memEmail"):$scope.signedInUser.member.email};$scope.updatedEmail=null!==$localStorage.get("memEmail")?$localStorage.get("memEmail"):$scope.signedInUser.member.email,$scope.userGroupList=[],ajaxService.getAjaxResponse({url:"/sp/admin/user",data:$.param(_params).replace(/%40/g,"@")}).then(function(response){if("true"===response.Success){$scope.profile=response.profileForm,$scope.userGroupList=response.groupList,$scope.profilePic=response.userSummary.smallProfileImage,$scope.userInitials=response.userSummary.userInitials,$scope.profile.name=response.userSummary.name;var _features=response.features;$scope.companyFeatures={isPrismLens:-1!==_features.indexOf("PrismLens")?!0:!1,isOrganizationPlan:-1!==_features.indexOf("OrganizationPlan")?!0:!1,isPrism:-1!==_features.indexOf("Prism")?!0:!1,isBluePrint:-1!==_features.indexOf("Blueprint")?!0:!1,isCompetency:-1!==_features.indexOf("Competency")?!0:!1},null!==response.tagList&&($scope.userTagList=response.tagList,$scope.existingTags=$scope.userTagList.join()),-1!==response.features.indexOf("Spectrum")&&($scope.showSpectrumPermission=!0),-1!==response.features.indexOf("Pulse")&&($scope.showPulsePermission=!0),-1!==response.features.indexOf("Competency")&&($scope.showCompetencyPermission=!0),null!==response.address?($scope.profile.country="USA"===response.address.country?"United States":response.address.country,$scope.stateCheck.forSelectedCountry=response.address.country,$scope.profile.address1=response.address.addressLine1,$scope.profile.address2=response.address.addressLine2,$scope.profile.city=response.address.city,$scope.profile.state=response.address.state,$scope.profile.zip=response.address.zipCode,$timeout(function(){$scope.profile.state=response.address.state},200)):($scope.profile.country="default",$scope.stateCheck.forSelectedCountry="default",$scope.profile.address1=null,$scope.profile.address2=null,$scope.profile.city=null,$scope.profile.state=null,$scope.profile.zip=null),null===$scope.profile.gender&&($scope.profile.gender="default"),0===$scope.profile.year&&($scope.profile.year="default"),0===$scope.profile.month&&($scope.profile.month="default"),0===$scope.profile.day&&($scope.profile.day="default"),null===$scope.profile.linkedInUrl||"undefined"==typeof $scope.profile.linkedInUrl?$scope.disableLinkedinEditing=!1:$scope.disableLinkedinEditing=!0,$scope.goalsDetails.percentage=0,$scope.growthTeamDetails.percentage=0,$scope.permissions=response.roles.sort(),$scope.userPermissions.isAccountAdministrator=!1,$scope.userPermissions.isAdministrator=!1,$scope.userPermissions.isHiringToolAllowed=!1,$scope.userPermissions.isWorkspacePulseAllowed=!1,$scope.userPermissions.isSpectrumAllowed=!1,$scope.userPermissions.isCompetencyAllowed=!1,jQuery.each($scope.permissions,function(i,j){"AccountAdministrator"===$scope.permissions[i]&&($scope.userPermissions.isAccountAdministrator=!0),"Administrator"===$scope.permissions[i]&&($scope.userPermissions.isAdministrator=!0),"Hiring"===$scope.permissions[i]&&($scope.userPermissions.isHiringToolAllowed=!0),"Pulse"===$scope.permissions[i]&&($scope.userPermissions.isWorkspacePulseAllowed=!0),"Spectrum"===$scope.permissions[i]&&($scope.userPermissions.isSpectrumAllowed=!0),"CompetencyAdmin"===$scope.permissions[i]&&($scope.userPermissions.isCompetencyAllowed=!0)}),$timeout(function(){$scope.setupAccountAccess($scope.signedInUser.member.email,$scope.signedInUser.member.roles,$scope.profile.email,response.roles)},300),$scope.assessmentStatus=response.userSummary.userStatus}})},$scope.setupAccountAccess=function(lEmail,lRoles,mEmail,mRoles){var currentUserRole,currentMemberRole,loggedEmail=lEmail,memberEmail=mEmail,loggedRoles=lRoles.sort(),memberRoles=mRoles.sort();$.each(loggedRoles,function(i){return"AccountAdministrator"===loggedRoles[i]?(currentUserRole="AccountAdministrator",!1):"Administrator"===loggedRoles[i]?(currentUserRole="Administrator",!1):void 0}),$.each(memberRoles,function(i){return"AccountAdministrator"===memberRoles[i]?(currentMemberRole="AccountAdministrator",!1):"Administrator"===memberRoles[i]?(currentMemberRole="Administrator",!1):"GroupLead"===memberRoles[i]?(currentMemberRole="GroupLead",!1):"User"===memberRoles[i]?(currentMemberRole="User",!1):(currentMemberRole="None",!1)}),"AccountAdministrator"===currentUserRole||"Hiring"===currentUserRole?loggedEmail!==memberEmail?($scope.accountPermissionOptions.adminAccess=!0,$scope.accountPermissionOptions.show=!0):$scope.accountPermissionOptions.show=!1:"Administrator"===currentUserRole?($scope.accountPermissionOptions.adminAccess=!1,loggedEmail!==memberEmail&&"AccountAdministrator"!==currentMemberRole&&"Administrator"!==currentMemberRole?$scope.accountPermissionOptions.show=!0:$scope.accountPermissionOptions.show=!1):"GroupLead"===currentUserRole?($scope.accountPermissionOptions.adminAccess=!1,$scope.accountPermissionOptions.show=!1):($scope.accountPermissionOptions.adminAccess=!1,$scope.accountPermissionOptions.show=!1)},$scope.getGroupList=function(){$scope.groupsDataReady=!1,ajaxService.getAjaxResponse({url:"/sp/admin/group/all",delay:100,maximum:1500}).then(function(response){if("true"===response.Success){$scope.dataWithFlags=[];var counter=0;$scope.groupDataSet=response.groupInfoList,jQuery.each($scope.groupDataSet,function(i,j){$scope.dataWithFlags.push(jQuery.extend({},$scope.groupDataSet[i],{selectedGroup:!1,selectedGroupLead:!1,alreadyGroupLead:!1}))}),$scope.allGroupListCounter=$scope.dataWithFlags.length,jQuery.each($scope.dataWithFlags,function(i,j){jQuery.each($scope.userGroupList,function(k,l){$scope.dataWithFlags[i].name===$scope.userGroupList[k].name&&($scope.dataWithFlags[i].selectedGroup=!0,$scope.allGroupListCounter-=1,$scope.userGroupList[k].groupLead===!0&&($scope.dataWithFlags[i].alreadyGroupLead=!0,$scope.dataWithFlags[i].selectedGroupLead=!0))}),counter++}),$scope.currentUser.groupList="default",counter===$scope.dataWithFlags.length&&(jQuery("html").hasClass("ie")?$timeout(function(){$scope.groupsDataReady=!0},500):$scope.groupsDataReady=!0)}})},$scope.changeGroup=function(selectedOption){if("default"!==selectedOption)if("createGroupCall_custom"===selectedOption)$scope.errornewEmptyGroup=!1,$scope.errornewGroup=!1,ngDialog.open({template:"/sp/admin/group/createGroup",scope:$scope}),$scope.currentUser.groupList="default";else{var _params={name:$scope.dataWithFlags[selectedOption].name,memberEmail:$scope.profile.email,isGroupLead:$scope.dataWithFlags[selectedOption].alreadyGroupLead};ajaxService.getAjaxResponse({url:"/sp/admin/group/addMember",data:$.param(_params).replace(/%40/g,"@"),delay:100,maximum:1500}).then(function(response){if("true"===response.Success)$scope.serverError=!1,$scope.serverError1=!1,$scope.dataWithFlags[selectedOption].selectedGroup=!0,$scope.allGroupListCounter-=1,$scope.currentUser.groupList="default";else{$scope.currentUser.groupList="default",$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})}},$scope.processRemoveGroup=function(selectedOption){var _params={name:$scope.dataWithFlags[selectedOption].name,memberEmail:$scope.profile.email,isGroupLead:!1};ajaxService.getAjaxResponse({url:"/sp/admin/group/removeMember",data:$.param(_params).replace(/%40/g,"@"),delay:10,maximum:1500}).then(function(response){if("true"===response.Success)$scope.serverError1=!1,$timeout(function(){$scope.dataWithFlags[selectedOption].selectedGroup=!1,$scope.flagCounter+=1},300);else{$scope.serverError1=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.removeGroup=function(selectedOption){"default"!==selectedOption&&($scope.dataWithFlags[selectedOption].alreadyGroupLead===!0?($scope.updateGroupLeadStatus(selectedOption,!1),$scope.glStatusUpdate===!0&&(jQuery("html").hasClass("ie")?$timeout(function(){$scope.processRemoveGroup(selectedOption)},500):$scope.processRemoveGroup(selectedOption))):$scope.processRemoveGroup(selectedOption))},$scope.updateGroupLeadStatus=function(i,status){var _params={name:$scope.dataWithFlags[i].name,memberEmail:$scope.profile.email,isGroupLead:status===!1?!1:!0};ajaxService.getAjaxResponse({url:"/sp/admin/group/addMember",data:$.param(_params).replace(/%40/g,"@"),delay:100,maximum:1500}).then(function(response){if("true"===response.Success)$scope.serverError=!1,$scope.serverError1=!1,$scope.dataWithFlags[i].alreadyGroupLead=!$scope.dataWithFlags[i].alreadyGroupLead,$scope.dataWithFlags[i].alreadyGroupLead===!1&&null!==$scope.dataWithFlags[i].groupLEad&&($scope.dataWithFlags[i].groupLead=null),$scope.glStatusUpdate=!0;else{$scope.serverError=!0,$scope.glStatusUpdate=!1;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.saveNewGroup=function(groupname,groupLeadEmailId){if($scope.errornewEmptyGroup=!1,$scope.errornewGroup=!1,""===groupname||"undefined"==typeof groupname)return $scope.errornewEmptyGroup=!0,!1;var obj={name:groupname},options={url:"/sp/admin/group/create",data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){ngDialog.close("ngdialog1");var _params={name:groupname,memberEmail:$scope.profile.email,isGroupLead:!1};ajaxService.getAjaxResponse({url:"/sp/admin/group/addMember",data:$.param(_params).replace(/%40/g,"@"),delay:100,maximum:1500}).then(function(response){if("true"===response.Success)$scope.serverError=!1,$scope.serverError1=!1,$scope.dataWithFlags.push({name:groupname,groupLead:null,numOfMembers:1,memberSummaryList:null,selectedGroup:!0,selectedGroupLead:!1,alreadyGroupLead:!1}),$scope.currentUser.groupList="default";else{$scope.currentUser.groupList="default",$scope.errornewGroup=!0,$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})}else null!=response.error&&($scope.errornewGroup=!0)})},$scope.closeGroup=function(){$scope.currentUser.groupList="default",ngDialog.close("ngdialog1")},$scope.updateLinkedURL=function(l,type){var updatedUrl="";if(updatedUrl="individual"===type||"bindividual"===type?"/sp/updateLinkedIn":$scope.apiConfig.urls.updateLinkedIn,this.linkedinUpdate.$valid){$scope.disableLinkedinEditing=!0;var _params=$.extend({},{userEmail:$scope.updatedEmail},l);ajaxService.getAjaxResponse({url:updatedUrl,data:$.param(_params)}).then(function(response){"true"===response.Success&&("individual"===type?$scope.getIndividualUserDetails():"bindividual"===type?$scope.getUserDetailsBusiness():$scope.getUserDetails())})}else $scope.linkeDInFormStatus=!0},$scope.updatePermissions=function(val,type){var _params={userEmail:$scope.profile.email};"admin"===type&&(val===!0?$.extend(_params,{isAdministrator:!1,isAccountAdministrator:!1,isHiringToolAllowed:$scope.userPermissions.isHiringToolAllowed,isWorkspacePulseAllowed:$scope.userPermissions.isWorkspacePulseAllowed,isSpectrumAllowed:$scope.userPermissions.isSpectrumAllowed,isCompetencyAllowed:$scope.userPermissions.isCompetencyAllowed}):$.extend(_params,{isAdministrator:!0,isAccountAdministrator:$scope.userPermissions.isAccountAdministrator,isHiringToolAllowed:$scope.userPermissions.isHiringToolAllowed,isWorkspacePulseAllowed:$scope.userPermissions.isWorkspacePulseAllowed,isSpectrumAllowed:$scope.userPermissions.isSpectrumAllowed,isCompetencyAllowed:$scope.userPermissions.isCompetencyAllowed})),"account"===type&&(val===!0?$.extend(_params,{isAdministrator:$scope.userPermissions.isAdministrator,isAccountAdministrator:!1,isHiringToolAllowed:$scope.userPermissions.isHiringToolAllowed,isWorkspacePulseAllowed:$scope.userPermissions.isWorkspacePulseAllowed,isSpectrumAllowed:$scope.userPermissions.isSpectrumAllowed,isCompetencyAllowed:$scope.userPermissions.isCompetencyAllowed}):$.extend(_params,{isAdministrator:$scope.userPermissions.isAdministrator,isAccountAdministrator:!0,isHiringToolAllowed:!0,isWorkspacePulseAllowed:!0,isSpectrumAllowed:!0,isCompetencyAllowed:!0})),"hiring"===type&&$.extend(_params,{isAdministrator:$scope.userPermissions.isAdministrator,isAccountAdministrator:$scope.userPermissions.isAccountAdministrator,isHiringToolAllowed:$scope.userPermissions.isHiringToolAllowed,isWorkspacePulseAllowed:$scope.userPermissions.isWorkspacePulseAllowed,isSpectrumAllowed:$scope.userPermissions.isSpectrumAllowed,isCompetencyAllowed:$scope.userPermissions.isCompetencyAllowed}),"pulse"===type&&$.extend(_params,{isAdministrator:$scope.userPermissions.isAdministrator,isAccountAdministrator:$scope.userPermissions.isAccountAdministrator,isHiringToolAllowed:$scope.userPermissions.isHiringToolAllowed,isWorkspacePulseAllowed:$scope.userPermissions.isWorkspacePulseAllowed,isSpectrumAllowed:$scope.userPermissions.isSpectrumAllowed,isCompetencyAllowed:$scope.userPermissions.isCompetencyAllowed}),"spectrum"===type&&$.extend(_params,{isAdministrator:$scope.userPermissions.isAdministrator,isAccountAdministrator:$scope.userPermissions.isAccountAdministrator,isHiringToolAllowed:$scope.userPermissions.isHiringToolAllowed,isWorkspacePulseAllowed:$scope.userPermissions.isWorkspacePulseAllowed,isSpectrumAllowed:$scope.userPermissions.isSpectrumAllowed,isCompetencyAllowed:$scope.userPermissions.isCompetencyAllowed}),"competency"===type&&$.extend(_params,{isAdministrator:$scope.userPermissions.isAdministrator,isAccountAdministrator:$scope.userPermissions.isAccountAdministrator,isHiringToolAllowed:$scope.userPermissions.isHiringToolAllowed,isWorkspacePulseAllowed:$scope.userPermissions.isWorkspacePulseAllowed,isSpectrumAllowed:$scope.userPermissions.isSpectrumAllowed,isCompetencyAllowed:$scope.userPermissions.isCompetencyAllowed}),ajaxService.getAjaxResponse({url:"/sp/admin/user/updatePermissions",data:$.param(_params)}).then(function(response){"true"===response.Success&&($.growl({icon:"glyphicon glyphicon-ok",message:"Status Updated Successfully"}),$scope.getUserDetails())})},$scope.initAdminViewDashboard=function(){$scope.getUserDetails(),$timeout(function(){$scope.getGroupList()},200)},$scope.initGroupLeadViewDashboard=function(){$scope.getUserDetails()},window.location.origin?$scope.siteName=window.location.origin+"/sp/":$scope.siteName=window.location.protocol+"//"+window.location.hostname+"/sp/",$scope.getIndividualUserDetails=function(){ajaxService.getAjaxResponse({url:"/sp/admin/user"}).then(function(response){"true"===response.Success&&($scope.profile=response.profileForm,$scope.certificate=response.userCertificate,$scope.certificateNo=parseInt(response.userCertificate.split("SP")[1]),$scope.certificateIssue=response.createdOn,$scope.profilePic=response.userSummary.smallProfileImage,$scope.userInitials=response.userSummary.userInitials,$scope.assessmentStatus=response.userSummary.userStatus,null!==response.address?($scope.profile.country="USA"===response.address.country?"United States":response.address.country,$scope.stateCheck.forSelectedCountry=response.address.country,$scope.profile.address1=response.address.addressLine1,$scope.profile.address2=response.address.addressLine2,$scope.profile.city=response.address.city,$scope.profile.state=response.address.state,$scope.profile.zip=response.address.zipCode):($scope.profile.country="default",$scope.stateCheck.forSelectedCountry="default",$scope.profile.address1=null,$scope.profile.address2=null,$scope.profile.city=null,$scope.profile.state=null,$scope.profile.zip=null),null===$scope.profile.gender&&($scope.profile.gender="default"),0===$scope.profile.year&&($scope.profile.year="default"),0===$scope.profile.month&&($scope.profile.month="default"),0===$scope.profile.day&&($scope.profile.day="default"),null===$scope.profile.linkedInUrl||"undefined"==typeof $scope.profile.linkedInUrl?$scope.disableLinkedinEditing=!1:$scope.disableLinkedinEditing=!0)})},$scope.getIndividualAccountInfo=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/individualAccountDetails"}).then(function(response){"true"===response.Success&&($scope.accountInfo=response,$scope.profileSetings.is360ProfileAllowed=response.profileSettings.is360ProfileAccessAllowed,$scope.profileSetings.isHiringAccessAllowed=response.profileSettings.hiringAccessAllowed,$scope.profileSetings.isCertificateProfilePublicViewAllowed=response.profileSettings.certificateProfilePublicView,$scope.profileToken=response.profileSettings.token)})},$scope.updateProfileSettings=function(val,type){var _params={isHiringAccessAllowed:$scope.profileSetings.isHiringAccessAllowed,is360ProfileAllowed:$scope.profileSetings.is360ProfileAllowed};ajaxService.getAjaxResponse({url:"/sp/admin/account/updateIndividualProfile",data:$.param(_params)}).then(function(response){"true"===response.Success&&$scope.getIndividualUserDetails()})},$scope.spcDate=function(d){if("undefined"!=typeof d){var monthData={January:"01",February:"02",March:"03",April:"04",May:"05",June:"06",July:"07",August:"08",September:"09",October:"10",November:"11",December:"12"},m=monthData[d.split(",")[0].split(" ")[0]],y=d.split(",")[1].split(" ")[1];return y+m}},$scope.updateCertificateAccess=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/updateIndividualProfile/spCertificate",method:"post",data:$.param({isCertificateProfilePublicViewAllowed:$scope.profileSetings.isCertificateProfilePublicViewAllowed})})},$scope.generateProfileToken=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/individualGenerateToken"}).then(function(response){"true"===response.Success&&($scope.getIndividualAccountInfo(),$.growl({icon:"glyphicon glyphicon-ok",message:"New link is generated successfully"}))})},$scope.initIndividualDashboard=function(){$scope.getIndividualUserDetails(),$scope.getIndividualAccountInfo()},$scope.getUserDetailsBusiness=function(){$scope.userGroupListBusiness=[];var storedUser=$localStorage.get("loggegdInProfile"),storedEmail=storedUser.member.email;ajaxService.getAjaxResponse({url:"/sp/admin/user",data:$.param({userEmail:storedEmail})}).then(function(response){"true"===response.Success&&($scope.profile=response.profileForm,$scope.userGroupListBusiness=response.groupList,$scope.profilePic=response.userSummary.smallProfileImage,$scope.userInitials=response.userSummary.userInitials,$scope.profile.name=response.userSummary.name,null!==response.address?($scope.profile.country="USA"===response.address.country?"United States":response.address.country,$scope.stateCheck.forSelectedCountry=response.address.country,$scope.profile.address1=response.address.addressLine1,$scope.profile.address2=response.address.addressLine2,$scope.profile.city=response.address.city,$scope.profile.state=response.address.state,$scope.profile.zip=response.address.zipCode,$timeout(function(){$scope.profile.state=response.address.state},200)):($scope.profile.country="default",$scope.stateCheck.forSelectedCountry="default",$scope.profile.address1=null,$scope.profile.address2=null,$scope.profile.city=null,$scope.profile.state=null,$scope.profile.zip=null),null===$scope.profile.gender&&($scope.profile.gender="default"),0===$scope.profile.year&&($scope.profile.year="default"),0===$scope.profile.month&&($scope.profile.month="default"),0===$scope.profile.day&&($scope.profile.day="default"),null===$scope.profile.linkedInUrl||"undefined"==typeof $scope.profile.linkedInUrl?$scope.disableLinkedinEditing=!1:$scope.disableLinkedinEditing=!0)})},$scope.initUserViewDashboard=function(){$scope.getUserDetailsBusiness()},"undefined"!=typeof $scope.settings.currentPage?"company"===$scope.settings.currentPage?$scope.initBusinessDashboard():"adminView"===$scope.settings.currentPage?$scope.initAdminViewDashboard():"individual"===$scope.settings.currentPage?$scope.initIndividualDashboard():"userView"===$scope.settings.currentPage?$scope.initUserViewDashboard():"groupLeadView"===$scope.settings.currentPage&&$scope.initGroupLeadViewDashboard():$timeout(function(){"company"===$scope.settings.currentPage?$scope.initBusinessDashboard():"adminView"===$scope.settings.currentPage?$scope.initAdminViewDashboard():"individual"===$scope.settings.currentPage?$scope.initIndividualDashboard():"userView"===$scope.settings.currentPage?$scope.initUserViewDashboard():"groupLeadView"===$scope.settings.currentPage&&$scope.initGroupLeadViewDashboard()},250),$scope.addressFormReset=function(t){"business"===t&&($scope.companyDetail.address1=null,$scope.companyDetail.address2=null,$scope.companyDetail.zip=null,$scope.companyDetail.address.city=null,"United States"!==$scope.stateCheck.forSelectedCountry?$scope.companyDetail.address.state=null:$scope.companyDetail.address.state="default"),("individual"===t||"buser"===t||"member"===t)&&($scope.profile.address1=null,
$scope.profile.address2=null,$scope.profile.city=null,$scope.profile.zip=null,"United States"===$scope.stateCheck.forSelectedCountry?$scope.profile.state="default":$scope.profile.state=null)},$scope.uploadPicture=function(){$scope.imageEditBox=!1,$scope.imageType="user",ngDialog.open({template:"/sp/resources/html/admin/account/upload-pic.html",scope:$scope})},$scope.uploadCompanyLogo=function(){$scope.imageEditBox=!1,$scope.imageType="company",ngDialog.open({template:"/sp/resources/html/admin/account/upload-company-pic.html",scope:$scope})},$scope.deleteImageModal=function(imageType){$scope.imageEditBox=!1,$scope.imageType=imageType,ngDialog.open({template:"/sp/resources/html/admin/account/delete-image-modal.html",scope:$scope})},$(document).on("imageSaved",function(e,data){$scope.$apply(function(){$scope.companyDetail.logoURL=data.imageData})}),$scope.deleteImage=function(){ajaxService.getAjaxResponse({url:"company"===$scope.imageType?"/sp/admin/company/deleteImage":"/sp/admin/user/deleteImage"}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:" Image Deleted Successfully"}),$timeout(function(){$localStorage.remove("loggegdInProfile"),window.location.reload()},1e3)):$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Image upload failed."})})},$scope.showImageEdit=function(type){$scope.imageEditBox=!$scope.imageEditBox,"company"!==type||$scope.companyDetail.logoURL?"user"!==type||$scope.profilePic||($scope.uploadPicture(),$scope.imageEditBox=!1):($scope.uploadCompanyLogo(),$scope.imageEditBox=!1)},$scope.closeImageEdit=function(){$scope.imageEditBox=!1},$scope.openList=function(e,bool){bool?$(e.currentTarget).closest(".profile-cont").find(".js_desk").removeClass("desktopShow"):$(e.currentTarget).closest(".profile-cont").find(".js_desk").addClass("desktopShow")},$scope.resetFlags=function(){$scope.disableEdit("profile")},$scope.resetPwdError=!1,$scope.resetPwdForm={},$scope.resetPwdForm.validationErrors=!1,$scope.resetPwd={},$scope.resetPasswordForm=function(){ngDialog.open({template:"/sp/resources/html/admin/account/resetPassword.html",scope:$scope}),$rootScope.$on("ngDialog.opened",function(e,$dialog){$timeout(function(){$scope.resetPwdError=!1,$scope.resetPwdForm.validationErrors=!1,jQuery("body").find('form[name="resetPwdForm"]')[0].reset()},100)})},$scope.processPasswordReset=function(fData){this.resetPwdForm.validationErrors=!1,$scope.resetPwdError=!1,this.resetPwdForm.$valid?ajaxService.getAjaxResponse({url:"/sp/changePassword",data:$.param({oldPassword:fData.oldPassword,newPassword:fData.newPassword})}).then(function(response){if("true"===response.Success)$scope.resetPwdError=!1,jQuery("body").find('form[name="resetPwdForm"]')[0].reset(),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:" Password changed successfully"});else{$scope.resetPwdForm.validationErrors=!1,$scope.resetPwdError=!0;for(var key in response.error)$scope.resetPwdErrorMsg=response.error[key]}}):($scope.resetPwdError=!1,this.resetPwdForm.validationErrors=!0)},$scope.currentPageUrl=window.location.href,$scope.requestAddon=function(addon){ngDialog.open({template:"/sp/resources/html/admin/account/addonRequest.html",scope:$scope})},$scope.addonSubmitted=function(flag){flag&&$localStorage.set("addonRequest","Request submitted successfully!")},$scope.addAccountsModal=function(addType){$localStorage.remove("addAccounts"),$scope.addAccountsForm.submitted=!1,$scope.addAccounts={};var processAddAccounts=function(data,e){$scope.addAccountsForm.submitted=!1,this.addAccountsForm.$valid?($localStorage.set("addAccounts",!0),$scope.addAccountsForm.submitted=!1):($scope.addAccountsForm.submitted=!0,e.preventDefault())};$scope.processAddAccounts=processAddAccounts,$scope.addType=addType;var storedUser=$localStorage.get("loggegdInProfile");$scope.storedEmail=storedUser.member.email,ngDialog.open({template:"/sp/resources/html/admin/account/addAccountsModal.html",scope:$scope})},$scope.addAdmin=function(email,userObj){ajaxService.getAjaxResponse({url:"/sp/admin/addAdminMember",data:$.param({planType:$scope.addAdminType,userEmail:email})}).then(function(response){if("true"===response.Success)"Primary"===$scope.addAdminType?$scope.adminsList.push(userObj):$scope.hiringAdminsList.push(userObj),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:"Admin added successfully "});else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$scope.removeAdmin=function(email,userObj){ajaxService.getAjaxResponse({url:"/sp/admin/removeAdminMember",data:$.param({planType:$scope.updatedPlanType,userEmail:email})}).then(function(response){if("true"===response.Success){var dupeList="Primary"===$scope.updatedPlanType?angular.copy($scope.adminsList):angular.copy($scope.hiringAdminsList);jQuery.each(dupeList,function(i,j){return dupeList[i].email===email?(dupeList.splice(i,1),"Primary"===$scope.updatedPlanType?$scope.adminsList=angular.copy(dupeList):$scope.hiringAdminsList=angular.copy(dupeList),!1):void 0}),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:"Admin removed successfully "})}else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$scope.removeAdminAccess=function(type,userObj){$scope.updatedPlanType=type,$scope.removeAdminMember=userObj,ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/removeAdminModal.html",scope:$scope})},$scope.addAdminAccess=function(type){$scope.addAdminType=type,ajaxService.getAjaxResponse({url:"/sp/admin/getMembersForAdmins/",data:$.param({planType:$scope.addAdminType})}).then(function(response){if("true"===response.Success)$scope.masterMemberList=response.memberList.length?response.memberList:[],$scope.selectMemberList=angular.copy($scope.masterMemberList),$scope.responseRecieved=!0,$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.order=function(predicate,reverse){$scope.lastPredicate=predicate,$scope.lastReverse=reverse,$scope.selectMemberList=$filter("orderBy")($scope.selectMemberList,predicate,reverse)},ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/selectAdminModal.html",scope:$scope});else if(null!=response.error){$scope.responseRecieved=!0;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$("body").click(function(e){$(".image-edit-box").is(e.target)||0!==$(".image-edit-box").has(e.target).length||$(".upload-icon").is(e.target)||$scope.imageEditBox&&$scope.$apply(function(){$scope.imageEditBox=!1})})}angular.module("spApp").controller("accountDashboardController",accountDashboardController),accountDashboardController.$inject=["$scope","userDataService","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage"];
function memberListController($scope,$q,ajaxService,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage,$state){function getMembersData(){var userRoles=null!==$localStorage.get("loggegdInProfile")?$localStorage.get("loggegdInProfile").member.roles:[];vm.iamaccountadmin=-1!==userRoles.indexOf("AccountAdministrator")?!0:!1,vm.hasCompetencyRole=-1!==userRoles.indexOf("CompetencyAdmin")?!0:!1,ajaxService.getAjaxResponse({url:vm.config.getMembersData}).then(function(response){if("true"===response.Success){vm.masterMemberList=response.memberList.length?response.memberList:[],vm.memberList=angular.copy(vm.masterMemberList),vm.responseRecieved=!0,vm.returnMemberList(vm.pageSetting.pageSize);var mokroles=[];angular.forEach(vm.masterMemberList,function(val,index){vm.allMembersEmailId.push({email:val.email}),null!==val.tagList&&(vm.tagListArray=val.tagList.concat(vm.tagListArray).unique()),null!==val.userStatus&&mokroles.push(val.userStatus)}),vm.tagListArray=vm.autoCompleteType(vm.tagListArray),vm.userStatus=mokroles.unique(),vm.getHiringCandidateList(),vm.loadCompetencyDetails()}else if(null!=response.error){vm.responseRecieved=!0;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function loadCompetencyDetails(){vm.responseAvailableForCompetency=!1,ajaxService.getAjaxResponse({url:vm.config.getCompetencyListing}).then(function(response){if("true"===response.Success){vm.competencyList=response.competencyProfile,vm.competencyEvaluationInProgress=response.evaluationInProgress;for(var competencyUserMap={},competencyNameMap={},i=0;i<response.memberList.length;i++)competencyUserMap[response.memberList[i].userId]=response.memberList[i].competencyProfileId;for(var k=0;k<vm.competencyList.length;k++)competencyNameMap[vm.competencyList[k].id]=vm.competencyList[k].name;for(var j=0;j<vm.masterMemberList.length;j++)vm.masterMemberList[j].competencyProfileId=competencyUserMap[vm.masterMemberList[j].id],vm.masterMemberList[j].competencyProfileName=competencyNameMap[vm.masterMemberList[j].competencyProfileId];vm.responseAvailableForCompetency=!0}else if(null!=response.error){vm.responseRecieved=!0;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function switchView(type){"status"===type?vm.listingView="ASSESSMENT":("reload"===type||"COMPETENCY"!==vm.listingView)&&(vm.loadCompetencyDetails(),vm.listingView="COMPETENCY")}function assignCompetency(){vm.assignClick=!0,""!==vm.selectedCompetency&&ajaxService.getAjaxResponse({url:vm.config.assignCompetency,data:$.param({competencyProfileId:vm.selectedCompetency,memberIdList:vm.selectedUsersList.join()})}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.evaluationAssigned")}),vm.switchView("reload");else if(null!==response.error){ngDialog.close();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage}),vm.switchView("reload")}})}function removeCompetency(){ajaxService.getAjaxResponse({url:vm.config.removeCompetency,data:$.param({memberIdList:vm.selectedUsersList.join()})}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.evaluationRemoved")}),vm.switchView("reload");else if(null!==response.error){ngDialog.close();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage}),vm.switchView("reload")}})}function assignRemoveCompetencyModalSingle(obj,action){vm.assignClick=!1,vm.selectedCompetency="",vm.competencyAssignRemoveOptions=[],vm.selectedUsersList=[],vm.competencyActionType=action,vm.competencyAssignRemoveOptions.push(obj),vm.selectedUsersList.push(obj.userId);var dialog=ngDialog.open({template:vm.config.assignRemoveCompetencyModal,scope:$scope});dialog.closePromise.then(function(data){vm.competencyActionType="MORE"})}function assignRemoveCompetencyModalMultiple(){if("MORE"!==vm.competencyActionType){vm.selectedCompetency="",vm.assignClick=!1,vm.competencyAssignRemoveOptions=[],vm.selectedUsersList=[];for(var i=0;i<vm.pageSetting.userEmail.email.length;i++)vm.competencyAssignRemoveOptions.push(vm.pageSetting.userEmail.email[i]),vm.selectedUsersList.push(vm.pageSetting.userEmail.email[i].userId);var dialog=ngDialog.open({template:vm.config.assignRemoveCompetencyModal,scope:$scope});dialog.closePromise.then(function(data){vm.competencyActionType="MORE"})}}function autoCompleteType(arr){for(var customarray=[],i=0;i<arr.length;i++)customarray.push({text:arr[i]});return customarray}function getHiringCandidateList(){ajaxService.getAjaxResponse({url:vm.config.getHiringCandidateList}).then(function(response){"true"===response.Success&&(vm.newHiresList=response.hiring,vm.newHiresList.length&&(vm.showAddHireList=!0))})}function getGroupsData(){var options={url:"/sp/admin/group/all"};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success&&(vm.mainGroupInfoList=response.groupInfoList,!vm.groupModule.length))for(var i=0;i<response.groupInfoList.length;i++)vm.groupModule.push(response.groupInfoList[i].name)})}function infinteScroll(arg){vm.returnMemberList(arg)}function displayRole(userObj){var userRoles=userObj.roles,admin=-1!==userRoles.indexOf("AccountAdministrator")?"A":"",hiring=-1!==userRoles.indexOf("Hiring")?"HA":"";return"A"===admin||"HA"===hiring?'<span class="groupLead thin">('+admin+("A"===admin&&"HA"===hiring?", "+hiring:hiring)+")</span>":""}function returnMemberList(pageSize){if(!vm.masterMemberList.length)return!0;var result=vm.masterCopy?vm.masterMemberList:vm.memberList;vm.memberList=result.filter(function(e){return(null!==vm.pageSetting.userStatusSelected&&e.userStatus===vm.pageSetting.userStatusSelected||null===vm.pageSetting.userStatusSelected&&e)&&(vm.pageSetting.statusInclude.length&&intersection(null===e.roles?[]:e.roles,vm.pageSetting.statusInclude).length===vm.pageSetting.statusInclude.length||!vm.pageSetting.statusInclude.length&&e)&&(vm.pageSetting.searchTag.length&&intersection(null===e.tagList?[]:e.tagList,vm.pageSetting.searchTag).length===vm.pageSetting.searchTag.length||!vm.pageSetting.searchTag.length&&e)&&sharedProperties.singleElementSearch(vm.pageSetting.textSearching,e,2)}),vm.pageSetting.pageSize=pageSize,pageSize>=vm.masterMemberList.length&&(vm.pageSetting.disabledInfinite=!0,vm.pageSetting.pageSize=vm.masterMemberList.length),vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse),!vm.alltoggle&&(vm.negative=!1,vm.pageSetting.userEmail.email=[]),vm.negative&&vm.checkAll(),vm.masterCopy=!0}function includeCheck(status){var i=$.inArray(status,vm.pageSetting.statusInclude);i>-1?vm.pageSetting.statusInclude.splice(i,1):(vm.pageSetting.statusInclude.push(status),vm.masterCopy=!1),vm.returnMemberList(vm.pageSetting.pageSize)}function userStatusSelected(status){vm.pageSetting.userStatusSelected=status,vm.returnMemberList(vm.pageSetting.pageSize)}function loadTags(query){var deferred=$q.defer(),result=vm.tagListArray.filter(function(e){return-1!==e.text.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise}function tagAdded(tag){vm.pageSetting.searchTag.push(tag.text),vm.masterCopy=!1,vm.returnMemberList(vm.pageSetting.pageSize)}function tagRemoved(tag){vm.pageSetting.searchTag.splice(vm.pageSetting.searchTag.indexOf(tag.text),1),vm.returnMemberList(vm.pageSetting.pageSize)}function intersection(a,b){var result=[],ai=0,bi=0;for(a.sort(),b.sort();a.length>ai&&b.length>bi;)a[ai]<b[bi]?ai++:a[ai]>b[bi]?bi++:(result.push(a[ai]),ai++,bi++);return result}function order(predicate,reverse){vm.pageSetting.lastPredicate=predicate,vm.pageSetting.lastReverse=reverse,vm.memberList=$filter("orderBy")(vm.memberList,vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)}function searchTextFilter(search){vm.masterCopy=search.length<vm.pageSetting.textSearching.length,vm.pageSetting.textSearching=search,vm.returnMemberList(vm.pageSetting.pageSize)}function clearSearch(){vm.pageSetting.textSearching.length&&(vm.pageSetting.textSearching="",vm.pageSetting.searchText="",vm.returnMemberList(vm.pageSetting.pageSize))}function active(event,setting){vm.pageSetting.lastPredicate=setting.predicate,vm.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.pageSetting.lastPredicate),vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)}function resetfilter(allmembers){vm.pageSetting=angular.copy(vm.originalpageSetting),vm.checkUncheck(),$(".tags").find("input").val("").end().find("input").css("width","100%"),$rootScope.$broadcast("$scrollStart"),vm.returnMemberList(vm.pageSetting.pageSize);var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")}function checkAll(){vm.checkedAll=!vm.checkedAll,vm.negative?vm.pageSetting.userEmail.email=vm.memberList.map(function(item){return{userId:item.id,email:item.email,name:item.name,title:item.title}}):vm.pageSetting.userEmail.email=[]}function checkUncheck(){vm.alltoggle=!1,vm.checkedAll&&(vm.negative=!vm.negative,vm.checkedAll=!vm.checkedAll)}function createGroupCall(ChangeCall){if("createGroupCall_custom"===ChangeCall){$scope.errornewGroup=!1,$scope.errornewEmptyGroup=!1,$scope.savenewGroup=!1;var dialog=ngDialog.open({template:"/sp/admin/group/createGroup",scope:$scope});dialog.closePromise.then(function(data){vm.groupModuleSelected=""})}}function memberTakeAway(email,f){$localStorage.set("memEmail",email),f===!0&&$localStorage.set("spProfileTab",!0),window.location.href="/sp/admin/account/member/details?email="+email}function editGroupSection(email,index){vm.oneTime&&(vm.getGroupsData(),vm.oneTime=!1),vm.setEditMode=!0,vm.EditGroupEmail=email,vm.indexToChange=index,vm.groupEditSection=angular.copy(vm.memberList[index]),vm.groupSelectOption=[];for(var j=0;j<vm.groupEditSection.groupAssociationList.length;j++)vm.groupSelectOption.push(vm.groupEditSection.groupAssociationList[j].name);ngDialog.open({template:"/sp/admin/member/editGroup",scope:$scope})}function isItEnabled(groupName,id){vm.classActivate=[];for(var i=0;i<vm.mainGroupInfoList.length;i++)if(groupName===vm.mainGroupInfoList[i].name&&null!==vm.mainGroupInfoList[i].groupLead&&vm.mainGroupInfoList[i].groupLead.email!==vm.EditGroupEmail){$timeout(function(){$("#mode_"+id).addClass("disabled"),$("#modeprop_"+id).addClass("disabled")},0);break}}function enableLeadDialog(leadValue,index,groupName){for(var i=0;i<vm.mainGroupInfoList.length;i++)if(groupName===vm.mainGroupInfoList[i].name){if(null!==vm.mainGroupInfoList[i].groupLead&&vm.mainGroupInfoList[i].groupLead.email!==vm.EditGroupEmail)return!1;vm.groupEditSection.groupAssociationList[index].groupLead=!leadValue}}function createSelect(modal){if(vm.setEditMode){var returnStatement=!0;return-1!==vm.groupSelectOption.indexOf(modal)&&(returnStatement=!1),returnStatement}return!1}function addGroupToModule(groupName,lead){return vm.selectedGroup=groupName,"default"===groupName?!1:(vm.groupEditSection.groupAssociationList.length&&""===vm.groupEditSection.groupAssociationList[0].name&&vm.groupEditSection.groupAssociationList.splice(0,1),vm.groupEditSection.groupAssociationList.push({name:groupName,groupLead:!1}),vm.groupSelectOption.push(groupName),void(vm.memberGroup="default"))}function saveGroupToModule(groupName){for(var newArr="",i=0;i<vm.groupEditSection.groupAssociationList.length;i++)if(newArr.length)newArr=newArr+","+vm.groupEditSection.groupAssociationList[i].name+":"+vm.groupEditSection.groupAssociationList[i].groupLead;else{if(""===vm.groupEditSection.groupAssociationList[i].name)return ngDialog.close("ngdialog1"),!1;newArr=vm.groupEditSection.groupAssociationList[i].name+":"+vm.groupEditSection.groupAssociationList[i].groupLead}var options={url:vm.config.saveGroupToModule,data:$.param({groupAssociationList:newArr,memberEmail:vm.groupEditSection.email})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){vm.groupEditSection.groupAssociationList.length?vm.memberList[vm.indexToChange]=vm.groupEditSection:(vm.groupEditSection.groupAssociationList.push({name:"",groupLead:!1}),vm.memberList[vm.indexToChange]=vm.groupEditSection);for(var i=0;i<vm.masterMemberList.length;i++)vm.masterMemberList[i].email===vm.memberList[vm.indexToChange].email&&(vm.masterMemberList[i]=vm.groupEditSection);vm.getGroupsData(),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:" Group status updated successfully"})}else if(null!=response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:errorMessage})}})}function removeGroupDialog(event,groupName){for(var _this=event.target,current=($(_this).closest(".blockGroup").remove(),""),i=0;i<vm.groupEditSection.groupAssociationList.length;i++)vm.groupEditSection.groupAssociationList[i].name===groupName.name&&(vm.groupEditSection.groupAssociationList.splice(i,1),current=i);vm.groupSelectOption.splice(current,1)}function confirmDelete(event,email){email=email;var options=(angular.element(event.currentTarget),{url:vm.config.confirmDelete,data:$.param({memberEmail:email})});ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success)sharedProperties.spilceIndexWithBreak(vm.masterMemberList,"email",email),sharedProperties.spilceIndexWithBreak(vm.memberList,"email",email),!vm.alltoggle&&(vm.negative=!1,vm.pageSetting.userEmail.email=[]),vm.negative&&vm.checkAll(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.member.deleteMessage")});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function converToMember(f,l,e,c){vm.showHiringList=!1;var newHireDetails={firstName:f,lastName:l,email:e,candidateId:c};$localStorage.set("newHireDetails",newHireDetails).set("newHireCheck",!0),$timeout(function(){window.location.href=vm.config.addSingle},100)}function removeFromList(id){ajaxService.getAjaxResponse({url:vm.config.updateHiredAndMovedToMember,data:$.param({candidateId:vm.hiringCandidateId})}).then(function(response){"true"===response.Success&&(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:"Candidate Removed"}),vm.showHiringList=!1,$timeout(function(){vm.getHiringCandidateList()},0))})}function showRemoveDialog(id){vm.hiringCandidateId=id,ngDialog.open({template:"/sp/resources/html/admin/member/deleteHiringConfirmation.html",scope:$scope})}function toggleAddNewHiresList(){vm.showHiringList=!vm.showHiringList}var vm=this;vm.memberList=[],vm.masterMemberList=[],vm.filterationRequired=!1,vm.showHiringList=!1,vm.tagListArray=[],vm.userStatus=[],vm.allMembersEmailId=[],vm.newHiresList=[],vm.checkedAll=!1,vm.negative=!1,vm.oneTime=!0,vm.updateGroup=!1,vm.groupModule=[],vm.mainGroupInfoList=[],vm.EditGroupEmail="",vm.setEditMode=!1,vm.showAddHireList=!1,vm.iamaccountadmin=!1,vm.hasCompetencyRole=!1,vm.masterCopy=!0,vm.responseRecieved=!1,vm.listingView="ASSESSMENT",vm.competencyList=[],vm.competencyEvaluationInProgress=!1,vm.competencyActionType="MORE",vm.selectedCompetency="",vm.assignClick=!1,vm.competencyAssignRemoveOptions=[],vm.selectedUsersList=[],vm.responseAvailableForCompetency=!1,vm.config={getMembersData:"/sp/admin/member",getHiringCandidateList:"/sp/admin/membersWithHired",getGroupsData:"/sp/admin/group/all",saveNewGroup:"/sp/admin/group/create",saveGroupToModule:"/sp/admin/group/memberGroupUpdate",confirmDelete:"/sp/admin/member/delete",updateHiredAndMovedToMember:"/sp/admin/member/updateHiredAndMovedToMember",addSingle:"/sp/admin/member/add/single",getCompetencyListing:"/sp/admin/competency/getUserCompetency",assignCompetency:"/sp/admin/competency/assignCompetency",removeCompetency:"/sp/admin/competency/removeCompetency",assignRemoveCompetencyModal:"/sp/admin/competency/assignRemoveModal"},vm.pageSetting={pageSize:10,intialPageSize:10,searchTag:[],filter:{},tags:[],userEmail:{email:[]},checkBox:[],statusInclude:[],userStatusSelected:null,lastPredicate:"name",lastReverse:!1,textSearching:"",disabledInfinite:!1,adminc:!1,adminH:!1,leadC:!1},vm.originalpageSetting=angular.copy(vm.pageSetting),vm.getMembersData=getMembersData,vm.returnMemberList=returnMemberList,vm.autoCompleteType=autoCompleteType,vm.getHiringCandidateList=getHiringCandidateList,vm.getGroupsData=getGroupsData,vm.loadTags=loadTags,vm.tagAdded=tagAdded,vm.tagRemoved=tagRemoved,vm.includeCheck=includeCheck,vm.userStatusSelected=userStatusSelected,vm.infinteScroll=infinteScroll,vm.order=order,vm.searchTextFilter=searchTextFilter,vm.clearSearch=clearSearch,vm.active=active,vm.resetfilter=resetfilter,vm.checkAll=checkAll,vm.checkUncheck=checkUncheck,vm.createGroupCall=createGroupCall,vm.memberTakeAway=memberTakeAway,vm.editGroupSection=editGroupSection,vm.isItEnabled=isItEnabled,vm.enableLeadDialog=enableLeadDialog,vm.createSelect=createSelect,vm.addGroupToModule=addGroupToModule,vm.saveGroupToModule=saveGroupToModule,vm.removeGroupDialog=removeGroupDialog,vm.confirmDelete=confirmDelete,vm.converToMember=converToMember,vm.showRemoveDialog=showRemoveDialog,vm.removeFromList=removeFromList,vm.toggleAddNewHiresList=toggleAddNewHiresList,vm.displayRole=displayRole,vm.switchView=switchView,vm.loadCompetencyDetails=loadCompetencyDetails,vm.assignCompetency=assignCompetency,vm.removeCompetency=removeCompetency,vm.assignRemoveCompetencyModalSingle=assignRemoveCompetencyModalSingle,vm.assignRemoveCompetencyModalMultiple=assignRemoveCompetencyModalMultiple,function(){var growlNotification=$localStorage.get("gNotify");null!==growlNotification&&$.growl({icon:"glyphicon glyphicon-ok",title:"single"===growlNotification?"<strong> Member</strong>":"<strong> Members</strong>",message:" added successfully"}),$localStorage.remove("newHireDetails","newHireCheck","gNotify","spProfileTab")}(),$scope.saveNewGroup=function(groupname,groupLeadEmailId){return $scope.errornewGroup=!1,$scope.errornewEmptyGroup=!1,$scope.savenewGroup=!1,""===groupname||"undefined"==typeof groupname?($scope.errornewEmptyGroup=!0,!1):void ajaxService.getAjaxResponse({url:vm.config.saveNewGroup,data:$.param({name:groupname})}).then(function(response){"true"===response.Success?(vm.mainGroupInfoList.push(response.groupInfo),vm.groupModule.push(response.groupInfo.name),$timeout(function(){vm.groupModuleSelected=response.groupInfo.name},0),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.saveMessage")})):null!==response.error&&($scope.errornewGroup=!0,$timeout(function(){vm.groupModuleSelected=""},0))})},$scope.closeGroup=function(){ngDialog.close("ngdialog1")}}angular.module("spApp").controller("memberListController",memberListController),memberListController.$inject=["$scope","$q","ajaxService","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage","$state"];
function addMemberController($scope,$http,$element,$attrs,ngDialog,ajaxService,$timeout,$localStorage){$scope.subscriptionStatus=0,$scope.subscriptionStatus.error=!1,$scope.groupDataSet={},$scope.groupDataSetBackup={},$scope.previousGroup=[],$scope.dataWithFlags=[],$scope.dataWithOrder=[],$scope.tagList=[],$scope.flagCounter=0,$scope.addMemberStatus={},$scope.addMemberStatus.serverError=!1,$scope.subscriptionStatus.error=!1,$scope.addMemberStatus.existingEmailError=!1,$scope.addMemberStatus.exceedEmailError=!1,$scope.addMemberEmailCount=0,$scope.emailCountError=!1,$scope.newOrderFlag=0,$scope.failedEmailList=[],$scope.failedEmailFlag=!1,$scope.addMemberStatus.inValidEmailError=!1,$scope.addMemberStatus.requiredError=!1,$scope.member={},$scope.newHireCheck=!1,$scope.errornewGroup=!1;var storedProfile=$localStorage.get("loggegdInProfile"),userRoles=storedProfile.member.roles.sort();if($scope.isAccountAdmin=0===jQuery.inArray("AccountAdministrator",userRoles)?!0:!1,null!==$localStorage.get("addAccounts")&&"undefined"!=typeof $localStorage.get("addAccounts")&&$timeout(function(){ngDialog.open({template:"/sp/resources/html/admin/account/request-success.html",scope:$scope}),$localStorage.remove("addAccounts")},300),null!==$localStorage.get("newHireDetails")){var newHireDetails=$localStorage.get("newHireDetails");$scope.member.firstName=newHireDetails.firstName,$scope.member.lastName=newHireDetails.lastName,$scope.cId=newHireDetails.candidateId}null!==$localStorage.get("newHireCheck")?$scope.newHireCheck=!0:$scope.newHireCheck=!1,$scope.getSubscriptionStatus=function(){ajaxService.getAjaxResponse({url:"/sp/admin/member/availalbeMemberSubscriptions"}).then(function(response){if("true"===response.Success)$scope.subscriptionStatus=response.availalbeMemberSubscriptions,0===$scope.subscriptionStatus&&($scope.subscriptionStatusError=!0);else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getSubscriptionStatus(),$scope.getGroupList=function(){ajaxService.getAjaxResponse({url:"/sp/admin/group/all"}).then(function(response){if("true"===response.Success)$scope.groupDataSet=response.groupInfoList,$scope.groupDataSetBackup=response.groupInfoList,jQuery.each($scope.groupDataSet,function(i,j){$scope.dataWithFlags.push(jQuery.extend({},$scope.groupDataSet[i],{selectedFlag:!1,isGroupLead:!1}))}),$scope.flagCounter=$scope.dataWithFlags.length;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getGroupList(),$scope.callCancel=function(){window.location="/sp/admin/memberListing#/member"},$scope.callRedirect=function(go){go===!0&&(window.location="/sp/admin/memberListing#/member")},$scope.updateTagList=function(single,multiple){$scope.member.groupAssociationList=null,$scope.tagList=[],jQuery.each($scope.dataWithFlags,function(i,j){$scope.dataWithFlags[i].selectedFlag===!0&&multiple===!0?$scope.tagList.push($scope.dataWithFlags[i].name):$scope.dataWithFlags[i].selectedFlag===!0&&single===!0&&($scope.dataWithFlags[i].isGroupLead===!0?$scope.tagList.push($scope.dataWithFlags[i].name+":true"):$scope.tagList.push($scope.dataWithFlags[i].name+":false")),$scope.member.groupAssociationList=$scope.tagList.join()})},$scope.updateGroupLeadStatus=function(i,email,single,multiple){"undefined"!=typeof $scope.dataWithFlags[i]&&null===email&&($scope.dataWithFlags[i].isGroupLead===!0?$scope.dataWithFlags[i].isGroupLead=!1:$scope.dataWithFlags[i].isGroupLead=!0,$scope.updateTagList(single,multiple))},$scope.changeGroup=function(flag,single,multiple){"default"!==flag&&("createGroupCall_custom"===flag?($scope.params={p1:single,p2:multiple},$scope.errornewEmptyGroup=!1,$scope.errornewGroup=!1,ngDialog.open({template:"/sp/admin/group/createGroup",scope:$scope}),$scope.member.gList="default"):($scope.dataWithFlags[flag].selectedFlag=!0,$scope.flagCounter-=1,$scope.updateTagList(single,multiple),$scope.member.gList="default",$scope.dataWithFlags[flag].newOrder=$scope.newOrderFlag++,$scope.dataWithFlags[flag].originalIndex=flag))},$scope.removeGroup=function(flag,single,multiple){"default"!==flag&&($scope.dataWithFlags[flag].selectedFlag=!1,$scope.dataWithFlags[flag].isGroupLead=!1,$scope.flagCounter+=1,$scope.updateTagList(single,multiple))},$scope.addSingleMember=function(fData){var _data=$scope.newHireCheck?$.extend(fData,{candidateId:$scope.cId}):fData;$scope.addMember.submitted=!1,$scope.addMemberStatus={},$scope.addMember.$valid?ajaxService.getAjaxResponse({url:"/sp/admin/member/addSingle",data:$.param(_data).replace(/%2C/g,",")}).then(function(response){"true"===response.Success?($scope.addMemberStatus=response,$scope.addMemberStatus.title="Add Member",$localStorage.remove("newHireDetails","newHireCheck"),$localStorage.set("gNotify","single"),setTimeout(function(){window.location="/sp/admin/memberListing#/member"},150)):($scope.addMemberStatus.serverError=!0,$scope.addMemberStatus.content=response.error)}):$scope.addMember.submitted=!0},$scope.highlightTags=function(list){var tagContainer=jQuery("body").find(".add-member").find("p.emailTags").find(".tagsinput"),emailList=list;jQuery.each(jQuery(tagContainer).find("span.tag"),function(i,j){var tagEmail=jQuery(this).find("span").attr("data-email"),existingEmail=jQuery.inArray(tagEmail,emailList);-1!==existingEmail&&jQuery(j).addClass("error-email")})},$scope.searchExistingEmailList=function(fData){$scope.addMemberStatus.requiredError=!1;var updatedEmailList=fData.memberList.split(",").unique(),_param={memberList:updatedEmailList.toString()};"undefined"!=typeof fData.memberList?ajaxService.getAjaxResponse({url:"/sp/signup/validateEmails",data:$.param(_param).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){if("true"===response.Success&&0===response.failureList.length)$scope.failedEmailList=[],$scope.failedEmailFlag=!1,$scope.addMemberStatus.existingEmailError=!1,$scope.addMultipleMembers(fData);else if("true"===response.Success&&response.failureList.length>0)$scope.addMemberStatus.existingEmailError=!0,$scope.failedEmailList=response.failureList,$scope.failedEmailFlag=!0,$scope.highlightTags($scope.failedEmailList);else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}}):$scope.addMemberStatus.requiredError=!0},$scope.addMultipleMembers=function(fData){var updatedEmailList=fData.memberList.split(",").unique();fData.memberList=updatedEmailList.toString(),$scope.addMember.submitted=!1,$scope.emailCountError=!1,$scope.getSubscriptionStatus(),$scope.addMemberEmailCount>$scope.subscriptionStatus?$scope.emailCountError=!0:$scope.addMember.$valid?ajaxService.getAjaxResponse({url:"/sp/admin/member/addMultiple",data:$.param(fData).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){if($scope.addMemberStatus=response,$scope.addMemberStatus.title="Add members","true"===response.Success&&0===response.failureList.length)$localStorage.set("gNotify","multiple"),setTimeout(function(){window.location="/sp/admin/memberListing#/member"},100);else if("true"===response.Success&&response.failureList.length>0)$scope.serverError=!0,$scope.errorMessage="Server exception: Failed to add "+response.failureList.join(", ");else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}}):$scope.addMember.submitted=!0},$scope.saveNewGroup=function(groupname,groupLeadEmailId){if($scope.errornewEmptyGroup=!1,$scope.errornewGroup=!1,""===groupname||"undefined"==typeof groupname)return $scope.errornewEmptyGroup=!0,!1;var obj={name:groupname},options={url:"/sp/admin/group/create",data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),$scope.dataWithFlags.push({name:groupname,groupLead:null,numOfMembers:0,memberSummaryList:null,selectedFlag:!0,originalIndex:$scope.dataWithFlags.length,newOrder:$scope.newOrderFlag}),$scope.flagCounter-=1,$scope.member.gList="default",$scope.newOrderFlag+=1,$scope.updateTagList($scope.params.p1,$scope.params.p2)):null!=response.error&&($scope.member.gList="default",$scope.errornewGroup=!0)})},$scope.closeGroup=function(){$scope.member.gList="default",ngDialog.close("ngdialog1")},$scope.currentPageUrl=window.location.href,$scope.addAccountsModal=function(addType){$localStorage.remove("addAccounts"),$scope.addAccountsForm={},$scope.addAccountsForm.submitted=!1,$scope.addAccounts={};var processAddAccounts=function(data,e){"members"===addType?$scope.noZeros=parseInt($scope.addAccounts.memberAccounts+$scope.addAccounts.memberAdminAccounts):$scope.noZeros=parseInt($scope.addAccounts.candidateBundles+$scope.addAccounts.hiringAdminAccounts),$scope.addAccountsForm.submitted=!1,this.addAccountsForm.$valid&&0!==$scope.noZeros?($localStorage.set("addAccounts",!0),$scope.addAccountsForm.submitted=!1):($scope.addAccountsForm.submitted=!0,e.preventDefault())};$scope.processAddAccounts=processAddAccounts,$scope.addType=addType,ngDialog.open({template:"/sp/resources/html/admin/account/addAccountsModal.html",scope:$scope})}}angular.module("spApp").controller("addMemberController",addMemberController),addMemberController.$inject=["$scope","$http","$element","$attrs","ngDialog","ajaxService","$timeout","$localStorage"];
function adminLibraryHomeController($scope,$q,$element,$attrs,ajaxService,$location,$http,$state,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage){$scope.libraryHomeList=[],$scope.getAllError=!1,$scope.searchTag=[],$scope.pageSize=10,$scope.statusInclude=[],$scope.textSearching="",$scope.intialPageSize=10,$scope.load=!0,$scope.getLibraryHomeList=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/library/getAll"}).then(function(response){if("true"===response.Success)$scope.getAllError=!1,$scope.libraryHomeList=response.company,$scope.returnMemberList($scope.pageSize),$localStorage.set("companyLibraryHomeList",$scope.libraryHomeList);else{$scope.getAllError=!0;for(var err in response.error)$scope.getAllErrorMsg=response.error[err]}})},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.returnMemberList($scope.pageSize)},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize))},$scope.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},$scope.returnMemberList=function(pageSize){if($scope.searchTag.length&&!$scope.statusInclude.length&&($scope.libraryHomeList=angular.copy($scope.newArr)),$scope.searchTag.length&&$scope.statusInclude.length){$scope.combineArray=[];for(var i=0;i<$scope.newArr.length;i++)for(var j=0;j<$scope.checkBox.length;j++)$scope.newArr[i].email===$scope.checkBox[j].email&&$scope.combineArray.push($scope.newArr[i]);$scope.libraryHomeList=angular.copy($scope.combineArray)}!$scope.searchTag.length&&$scope.statusInclude.length&&($scope.libraryHomeList=angular.copy($scope.checkBox)),$scope.searchTag.length||$scope.statusInclude.length||($scope.libraryHomeList=angular.copy($scope.libraryHomeList)),$scope.pageSize=pageSize,pageSize>=$scope.libraryHomeList.length&&($scope.disabledInfinite=!0,$scope.pageSize=$scope.libraryHomeList.length),$scope.load&&($scope.lastPredicate="name",$scope.lastReverse=!1,$scope.loadBtnCLicked=!1,$scope.load=!1),$scope.loadBtnCLicked&&($scope.loadBtnCLicked=!1),$scope.order($scope.lastPredicate,$scope.lastReverse),$scope.libraryHomeList=$scope.libraryHomeList},$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.order=function(predicate,reverse){$scope.lastPredicate=predicate,$scope.lastReverse=reverse,$scope.libraryHomeList=$filter("orderBy")($scope.libraryHomeList,predicate,reverse)},$scope.resetfilter=function(allmembers){$scope.pageSize=$scope.intialPageSize,$scope.newArr=[],$scope.searchTag=[],$scope.tags=[],$scope.filter={},$scope.statusInclude=[],$scope.adminc=!1,$scope.leadC=!1,$scope.textSearching="",$scope.searchText="","undefined"!=typeof this.selectedSearch&&(this.selectedSearch.userStatusFormatted="",this.selectedSearch.hiringRoles=""),$scope.libraryHomeList=angular.copy($scope.libraryHomeList),"undefined"!=typeof allmembers&&($scope.pageSize=$scope.libraryHomeList.length),angular.element($(".tags").find("input")).scope().newTag.text="",$scope.load=!0,$scope.disabledInfinite=!1,$rootScope.$broadcast("$scrollStart"),$scope.returnMemberList($scope.pageSize);var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")},$scope.updateStatusError=!1,$scope.deleteCompanyLibraryInfo=function(compId){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/library/delete",data:$.param({companyId:compId})}).then(function(response){if("true"===response.Success)$scope.updateStatusError=!1,ngDialog.close("ngdialog1"),$scope.getLibraryHomeList(),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Record</strong>",message:" deleted successfully"});else{$scope.updateStatusError=!0;for(var err in response.error)$scope.updateStatusErrorMsg=response.error[err];ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.updateStatusErrorMsg})}}),window.location.reload()},$scope.deleteConfirm=function(deleteId,name){$scope.compId=deleteId,$scope.compName=name,ngDialog.open({template:"/sp/resources/html/sysAdmin/curriculam/deleteCompanyHome.html",scope:$scope})},$scope.createLibraryHomeLink=function(type){null!=type&&"business"===type?window.location="/sp/sysAdmin/curriculam/libraryHomeDetails?cid=business":null!=type&&"individual"===type&&(window.location="/sp/sysAdmin/curriculam/libraryHomeDetails?cid=individual")},$scope.articleWorkFlow=function(reqUrl,key){ajaxService.getAjaxResponse({url:reqUrl,method:"get"}).then(function(response){if("true"===response.Success)"articleReload"!==key&&$.growl({icon:"glyphicon glyphicon-ok",message:"Request Processed"});else if(null!=response.error){for(var err in response.error)$scope.errorMessage=response.error[err];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}}),"articleReload"===key&&$.growl({icon:"glyphicon glyphicon-ok",message:"Request Submitted to Server"})},$scope.getReadabilityScore=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/readability",method:"get"}).then(function(response){"true"===response.Success?($scope.score=response.readability.currentScore.toFixed(2),ngDialog.open({template:"/sp/resources/html/sysAdmin/curriculam/readabilityScore.html",scope:$scope})):$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"There was some error in processing your request."})})},function(){$scope.getLibraryHomeList()}()}angular.module("spApp").controller("adminLibraryHomeController",adminLibraryHomeController),adminLibraryHomeController.$inject=["$scope","$q","$element","$attrs","ajaxService","$location","$http","$state","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage"];
function adminMediaController($scope,ajaxService,$localStorage,ngDialog,sharedProperties,filterFilter,$filter,$rootScope,$timeout){function uploadMediaFile(){if(self.uploadFormSubmitted=!1,self.uploadMediaForm.$valid&&void 0!==self.media.file){var formObj=new FormData(document.getElementById("mediaForm"));"IMAGE"===self.media.mediaType&&(formObj.append("width",self.media.width),formObj.append("height",self.media.height)),formObj.append("file",self.media.file,self.media.file.name),"upload"===$rootScope.mediaView&&formObj.append("status","Active");var multiPartRequest=$.ajax({url:self.serviceApis.uploadMedia,type:"POST",data:formObj,processData:!1,contentType:!1,beforeSend:function(){$rootScope.$broadcast("httpLoaderStart")}});multiPartRequest.done(function(response){"true"===response.success.Success?($.growl({icon:"glyphicon glyphicon-ok",message:" Media updated Successfully"}),$rootScope.$broadcast("httpLoaderEnd"),"upload"===$rootScope.mediaView?($localStorage.set("mediaData",response.success.mediaInfo),delete $rootScope.mediaView,ngDialog.close()):$timeout(function(){window.location.href="/sp/media/listPage"},500)):($.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Media Upload Failed."}),$rootScope.$broadcast("httpLoaderEnd"))}),multiPartRequest.fail(function(jqXHR,textStatus){$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Media Upload Failed."}),$rootScope.$broadcast("httpLoaderEnd")})}else self.uploadFormSubmitted=!0}function cancelRedirect(){window.location.href="/sp/media/listPage"}function switchView(type){$rootScope.mediaView=type}function changeMediaAcceptType(){switch(self.media.mediaType){case"IMAGE":self.acceptedFileType="image/gif, image/jpg, image/jpeg, image/png";break;case"PDF":self.acceptedFileType="application/pdf";break;case"PPT":self.acceptedFileType="application/vnd.ms-powerpoint, application/vnd.openxmlformats-officedocument.presentationml.presentation";break;case"MSDOC":self.acceptedFileType="application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document"}}var self=this;self.serviceApis={uploadMedia:"/sp/media/save"},self.media={},self.hasValidationErrors=!1,self.uploadFormSubmitted=!1,self.imageData=null,self.media.mediaType="IMAGE",self.tags="",self.acceptedFileType="image/gif, image/jpg, image/jpeg, image/png",self.cancelRedirect=cancelRedirect,self.uploadMediaFile=uploadMediaFile,self.switchView=switchView,self.changeMediaAcceptType=changeMediaAcceptType,jQuery(".select-image-btn").on("click",function(e){e.preventDefault();var fileInput=jQuery("input:file");fileInput.click(),$scope.$apply()}),jQuery("input:file").change(function(){var preview=document.querySelector("img.image-preview");if(self.media.file=this.files[0],"IMAGE"===self.media.mediaType){var fr=new FileReader;fr.onload=function(){var img=new Image;img.onload=function(){self.media.width=img.width,self.media.height=img.height},img.src=fr.result,preview.src=fr.result},fr.readAsDataURL(self.media.file)}})}function adminMediaUpdateController($scope,ajaxService,$localStorage,ngDialog,sharedProperties,filterFilter,$filter,$rootScope,$timeout){function cancelRedirect(){window.location.href="/sp/media/listPage"}function updateImage(formData){formData.tags=self.tags;var _params={};if(self.uploadFormSubmitted=!1,self.uploadMediaForm.$valid){_params=formData;var options={url:self.serviceApis.updateImage,data:$.param(_params)};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?($.growl({icon:"glyphicon glyphicon-ok",message:" Media updated Successfully"}),$timeout(function(){window.location.href="/sp/media/listPage"},500)):$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Image update failed."})})}else self.uploadFormSubmitted=!0}var self=this;self.serviceApis={getImage:"/sp/media/get",updateImage:"/sp/media/update"},self.media={},self.hasValidationErrors=!1,self.uploadFormSubmitted=!1,self.updateImage=updateImage,self.cancelRedirect=cancelRedirect,self.tags="";var getParameter=function(val){for(var query=window.location.search.substring(1),vars=query.split("&"),pair=[],i=0;i<vars.length;i++)return pair=vars[i].split("="),pair[0]===val?pair[1]:null},getImage=function(id){ajaxService.getAjaxResponse({url:self.serviceApis.getImage,data:$.param({id:id}),method:"POST"}).then(function(response){if("true"===response.Success)self.media=response.mediaInfo,0===self.media.tags.length?self.tags="":self.tags=self.media.tags.length>1?self.media.tags.join(","):self.media.tags[0];else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})};!function(){var param=getParameter("id");null!==param?getImage(param):window.location.href="/sp/media/uploadPage"}()}angular.module("spApp").controller("adminMediaController",adminMediaController),angular.module("spApp").controller("adminMediaUpdateController",adminMediaUpdateController),adminMediaController.$inject=["$scope","ajaxService","$localStorage","ngDialog","sharedProperties","filterFilter","$filter","$rootScope","$timeout"],adminMediaUpdateController.$inject=["$scope","ajaxService","$localStorage","ngDialog","sharedProperties","filterFilter","$filter","$rootScope","$timeout"];
function adminMediaListingController($scope,ajaxService,$localStorage,ngDialog,sharedProperties,filterFilter,$filter,$rootScope){function deleteImageModal(deleteId,imagePath){$scope.deleteId=deleteId,$scope.imagePath=imagePath,ngDialog.open({template:"/sp/resources/html/sysAdmin/media/delete-modal.html",scope:$scope})}function deleteImage(id,path){ajaxService.getAjaxResponse({url:self.serviceApis.deleteImage,data:$.param({imageId:id,imagePath:path})}).then(function(response){if("true"===response.Success)sharedProperties.spilceIndexWithBreak(self.masterImageList,"id",id),self.imageList=angular.copy(self.masterImageList),ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:"Media Deleted Successfully"});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function previewImage(imageUrl,name){$scope.mediaUrl=imageUrl,$scope.mediaName=name,ngDialog.open({template:"/sp/resources/html/sysAdmin/media/view-modal.html",scope:$scope})}function filterResults(type){""!==self.searchText?self.showClearSearchIcon=!0:self.showClearSearchIcon=!1;var resp=$filter("mediaManagerFilter")(self.masterImageList,self.mediaTypes,self.searchText,filterFilter);self.dataSorted&&(resp=$filter("orderBy")(resp,self.lastPredicate,self.lastReverse)),self.imageList=[],self.imageList=resp}function clearSearch(){""!==self.searchText&&(self.showClearSearchIcon=!1,self.searchText=""),self.filterResults()}function resetResults(){self.mediaTypes={image:!1,pdf:!1,ppt:!1,msdoc:!1},self.searchText="",self.showClearSearchIcon=!1,self.imageList=[],self.imageList=angular.copy(self.masterImageList),self.dataSorted=!1}function active(event,setting){self.lastPredicate=setting.predicate,self.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.lastPredicate),self.sortResults(self.lastPredicate,self.lastReverse)}function sortResults(predicate,reverse){self.lastPredicate=predicate,self.lastReverse=reverse;var resp=$filter("orderBy")(self.masterImageList,predicate,reverse);resp=$filter("mediaManagerFilter")(resp,self.mediaTypes,self.searchText,filterFilter),self.imageList=[],self.imageList=resp,self.dataSorted=!0}function setMediaData(obj){$localStorage.set("mediaData",obj),ngDialog.close()}function switchView(type){$rootScope.mediaView=type}var self=this;self.serviceApis={getAllImages:"/sp/media/getAll",deleteImage:"/sp/media/delete"},self.media={},self.masterImageList=[],self.imageList=[],self.responseAvailable=!1,self.imageId="",self.showClearSearchIcon=!1,self.searchText="",self.lastPredicate="name",self.lastReverse=!1,self.viewType="Grid",self.mediaTypes={image:!1,pdf:!1,ppt:!1,msdoc:!1},self.dataSorted=!1,self.getAllImages=getAllImages,self.deleteImage=deleteImage,self.deleteImageModal=deleteImageModal,self.previewImage=previewImage,self.filterResults=filterResults,self.active=active,self.sortResults=sortResults,self.clearSearch=clearSearch,self.resetResults=resetResults,self.setMediaData=setMediaData,self.switchView=switchView;var getAllImages=function(){ajaxService.getAjaxResponse({url:self.serviceApis.getAllImages,method:"GET"}).then(function(response){if("true"===response.Success)self.responseAvailable=!0,self.masterImageList=response.mediaList,self.imageList=angular.copy(self.masterImageList);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})};!function(){getAllImages()}()}angular.module("spApp").controller("adminMediaListingController",adminMediaListingController),angular.module("spApp").filter("mediaManagerFilter",function(){return function(items,types,searchText,filterFilter){var filtered=[];return angular.forEach(items,function(item){types.image===!1&&types.pdf===!1&&types.ppt===!1&&types.msdoc===!1?filtered.push(item):types.image===!0&&"IMAGE"===item.mediaType?filtered.push(item):types.pdf===!0&&"PDF"===item.mediaType?filtered.push(item):types.ppt===!0&&"PPT"===item.mediaType?filtered.push(item):types.msdoc===!0&&"MSDOC"===item.mediaType&&filtered.push(item),""!==searchText&&(filtered=filterFilter(filtered,searchText))}),filtered}}),adminMediaListingController.$inject=["$scope","ajaxService","$localStorage","ngDialog","sharedProperties","filterFilter","$filter","$rootScope"];
function affiliateCodeDetailsController($scope,$element,$attrs,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage){$scope.affiliateCodeDetailsEdit={},$scope.affiliateCodeDetailsEdit.status=!0,$scope.affliliateCode={},$scope.createAffiliateCode={},$scope.createAffiliateCode.validationError=!1,$scope.createCodeError=!1,$scope.updateAffiliateCode=function(fData){var formattedDate=function(d){if("object"==typeof d){var _dm="undefined"!=typeof d?d.getMonth()+1:0,_dd="undefined"!=typeof d?d.getDate():0,_dy="undefined"!=typeof d?d.getFullYear():0,_dDate=(10>_dm?"0"+_dm:_dm)+"/"+(10>_dd?"0"+_dd:_dd)+"/"+_dy;return _dDate}return"string"==typeof d?d:void 0}(fData.endDate);if(fData.endDate=formattedDate,fData.code=$scope.existingPromoDetails.code,fData.promotionId=$scope.existingPromoDetails.id,$scope.productsError===!1){$scope.createAffiliateCode.validationError=!1;var vCount=0;for(var k in fData)("default"===fData[k]||"default1"===fData[k])&&vCount++;$scope.createAffiliateCode.$valid&&0===vCount&&fData.unitPrice>0?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/update",data:$.param(fData).replace(/%2F/g,"/")}).then(function(response){if("true"===response.Success)$scope.createCodeError=!1,$scope.affiliateCodeDetailsEdit.status=!0,"undefined"!==$scope.urlPromoId&&$scope.urlPromoId!==!1&&$scope.getPromoDetails($scope.urlPromoId),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Details</strong>",message:" updated successfully"});else{$scope.createCodeError=!0;for(var key in response.error)$scope.createCodeErrorMsg=response.error[key]}}):$scope.createAffiliateCode.validationError=!0}},$scope.productsError=!1,$scope.getAvailableProducts=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/getProducts"}).then(function(response){if("true"===response.Success)$scope.productsError=!1,$scope.productList=response.product;else{$scope.productsError=!0;for(var key in response.error)$scope.productsErrorMsg=response.error[key]}})},$scope.getDetailsError=!1,$scope.existingTags=null,$scope.getPromoDetails=function(pid){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/getDetails",data:$.param({promotionId:pid})}).then(function(response){if("true"===response.Success)$scope.getDetailsError=!1,$scope.existingPromoDetails=response.promotion,$scope.affliliateCode.productList=$scope.existingPromoDetails.productList[0].id,$scope.affliliateCode.promotionType=$scope.existingPromoDetails.promotionType,$scope.affliliateCode.unitPrice=$scope.existingPromoDetails.unitPrice,$scope.affliliateCode.endDate=($scope.existingPromoDetails.endDate.monthValue<10?"0"+$scope.existingPromoDetails.endDate.monthValue:$scope.existingPromoDetails.endDate.monthValue)+"/"+($scope.existingPromoDetails.endDate.dayOfMonth<10?"0"+$scope.existingPromoDetails.endDate.dayOfMonth:$scope.existingPromoDetails.endDate.dayOfMonth)+"/"+$scope.existingPromoDetails.endDate.year,"undefined"!=typeof $scope.existingPromoDetails.count&&($scope.affliliateCode.count=$scope.existingPromoDetails.count),$scope.existingPromoDetails.tags.length>0?$scope.existingTags=$scope.existingPromoDetails.tags.length>1?$scope.existingPromoDetails.tags.join(","):$scope.existingPromoDetails.tags[0]:$scope.existingTags=null,$scope.affliliateCode.message=$scope.existingPromoDetails.message,$scope.affliliateCode.status=$scope.existingPromoDetails.status;else{$scope.getDetailsError=!0;for(var key in response.error)$scope.getDetailsErrorMsg=response.error[key]}})},$scope.searchInAccounts=null,$scope.clearSearch=function(){$scope.searchInAccounts=null},$scope.enableEdit=function(){$scope.affiliateCodeDetailsEdit.status=!1},$scope.disableEdit=function(){$scope.affiliateCodeDetailsEdit.status=!0,"undefined"!==$scope.urlPromoId&&$scope.urlPromoId!==!1&&$scope.getPromoDetails($scope.urlPromoId)},$scope.getURLPromoId=function(){var url=window.location.href,splitUrl=url.split("?")[1];"undefined"!=typeof splitUrl?$scope.urlPromoId=splitUrl.split("=")[1]:$scope.urlPromoId=null},$scope.getAccountsError=!1,$scope.getAccountDetails=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/accounts",data:$.param({promotionId:$scope.urlPromoId})}).then(function(response){if("true"===response.Success)$scope.getAccountsError=!1,$scope.accountsList=response.account;else{$scope.getAccountsError=!0;for(var key in response.error)$scope.getAccountsErrorMsg=response.error[key]}})},function(){$scope.getURLPromoId(),$scope.getAvailableProducts(),"undefined"!==$scope.urlPromoId&&$scope.urlPromoId!==!1&&($scope.getPromoDetails($scope.urlPromoId),$scope.getAccountDetails())}()}angular.module("spApp").controller("affiliateCodeDetailsController",affiliateCodeDetailsController),affiliateCodeDetailsController.$inject=["$scope","$element","$attrs","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage"];
function affiliateCodeListingController($scope,$q,$element,$attrs,ajaxService,$location,$http,$state,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage){$scope.affiliateCodeListMaster=[],$scope.getAllError=!1,$scope.searchTag=[],$scope.pageSize=10,$scope.statusInclude=[],$scope.textSearching="",$scope.intialPageSize=10,$scope.load=!0,$scope.formatMonth=function(d){if(null!==d&&"undefined"!=typeof d){var splitDate=d.split(" "),formatMonth=splitDate[0].substr(0,3).toUpperCase(),formattedDate=formatMonth+" "+splitDate[1]+" "+splitDate[2];return formattedDate}},$scope.getAllAffiliateCodes=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/getAll"}).then(function(response){if("true"===response.Success)$scope.getAllError=!1,$scope.affiliateCodeListMaster=response.promotion,$scope.returnMemberList($scope.pageSize);else{$scope.getAllError=!0;for(var key in response.error)$scope.getAllErrorMsg=response.error[key]}})},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.returnMemberList($scope.pageSize)},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize))},$scope.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},$scope.returnMemberList=function(pageSize){if(!$scope.affiliateCodeListMaster.length)return!0;if($scope.searchTag.length&&!$scope.statusInclude.length&&($scope.affiliateCodeList=angular.copy($scope.newArr)),$scope.searchTag.length&&$scope.statusInclude.length){$scope.combineArray=[];for(var i=0;i<$scope.newArr.length;i++)for(var j=0;j<$scope.checkBox.length;j++)$scope.newArr[i].email===$scope.checkBox[j].email&&$scope.combineArray.push($scope.newArr[i]);$scope.affiliateCodeList=angular.copy($scope.combineArray)}!$scope.searchTag.length&&$scope.statusInclude.length&&($scope.affiliateCodeList=angular.copy($scope.checkBox)),$scope.searchTag.length||$scope.statusInclude.length||($scope.affiliateCodeList=angular.copy($scope.affiliateCodeListMaster)),$scope.pageSize=pageSize,pageSize>=$scope.affiliateCodeListMaster.length&&($scope.disabledInfinite=!0,$scope.pageSize=$scope.affiliateCodeListMaster.length),$scope.load&&($scope.lastPredicate="code",$scope.lastReverse=!0,$scope.loadBtnCLicked=!1,$scope.load=!1),$scope.loadBtnCLicked&&($scope.loadBtnCLicked=!1),$scope.order($scope.lastPredicate,$scope.lastReverse),$scope.affiliateCodeList=$scope.affiliateCodeList},$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.order=function(predicate,reverse){$scope.lastPredicate=predicate,$scope.lastReverse=reverse,$scope.affiliateCodeList=$filter("orderBy")($scope.affiliateCodeList,predicate,reverse)},$scope.resetfilter=function(allmembers){$scope.pageSize=$scope.intialPageSize,$scope.newArr=[],$scope.searchTag=[],$scope.tags=[],$scope.filter={},$scope.statusInclude=[],$scope.adminc=!1,$scope.leadC=!1,$scope.textSearching="",$scope.searchText="","undefined"!=typeof this.selectedSearch&&(this.selectedSearch.userStatusFormatted="",this.selectedSearch.hiringRoles=""),$scope.affiliateCodeList=angular.copy($scope.affiliateCodeListMaster),"undefined"!=typeof allmembers&&($scope.pageSize=$scope.affiliateCodeListMaster.length),angular.element($(".tags").find("input")).scope().newTag.text="",$scope.load=!0,$scope.disabledInfinite=!1,$rootScope.$broadcast("$scrollStart"),$scope.returnMemberList($scope.pageSize);var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")},$scope.updateStatusError=!1,$scope.updateAffiliateCodeStatus=function(status,pid){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/updateStatus",data:$.param({promotionId:pid,promotionStatus:status})}).then(function(response){if("true"===response.Success)$scope.updateStatusError=!1,ngDialog.close("ngdialog1"),$scope.getAllAffiliateCodes(),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Status</strong>",message:" updated successfully"});else{$scope.updateStatusError=!0;for(var key in response.error)$scope.updateStatusErrorMsg=response.error[key];ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.updateStatusErrorMsg})}})},$scope.deleteConfirm=function(d){$scope.afid=d,ngDialog.open({template:"/sp/resources/html/sysAdmin/affiliateCode/deleteConfirmation.html",scope:$scope})},function(){var growlNotification=$localStorage.get("gNotify");null!==growlNotification&&"undefined"!=typeof growlNotification&&("AddCode"===growlNotification&&$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Code</strong>",message:" generated successfully"}),setTimeout(function(){$localStorage.remove("gNotify")},1e3)),$scope.getAllAffiliateCodes()}()}angular.module("spApp").controller("affiliateCodeListingController",affiliateCodeListingController),affiliateCodeListingController.$inject=["$scope","$q","$element","$attrs","ajaxService","$location","$http","$state","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage"];
function alternateBilling($scope,$element,ajaxService,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage){$scope.abMasterList=[],$scope.getAllError=!1,$scope.searchTag=[],$scope.pageSize=10,$scope.statusInclude=[],$scope.textSearching="",$scope.intialPageSize=10,$scope.load=!0,$scope.updateStatusError=!1,$scope.accountDetails=null,$scope.submitted=!1,$scope.accountList={},$scope.currentId=null,$scope.signup={},$scope.imports={},$timeout(function(){$scope.imports.cpt=-1,$scope.signup.paymentAgreement=-1,$scope.signup.paymentType=-1},0),$scope.imports.camount=null,$scope.ptype=!1,$scope.errorMessage=!1;var config={getAllAccount:"/sp/sysAdmin/alternateBilling/getAllAccounts",fetchAccountDetails:"/sp/sysAdmin/alternateBilling/account/businessAccountDetails",fetchAccountDetailsIndividual:"/sp/sysAdmin/alternateBilling/account/individualAccountDetails"};$scope.masterMemberList=[],$scope.selectMemberList=[],$scope.allArchived=[],$scope.responseRecieved=!1,$scope.formatMonth=function(d){if(null!==d&&"undefined"!=typeof d){var splitDate=d.split(" "),formatMonth=splitDate[0].substr(0,3).toUpperCase(),formattedDate=formatMonth+" "+splitDate[1]+" "+splitDate[2];return formattedDate}},$scope.getResponse=function(type,existingAccount){var growlNotification=$localStorage.get("createAccount");null!==growlNotification&&"undefined"!=typeof growlNotification&&($.growl({icon:"glyphicon glyphicon-ok",message:growlNotification}),$timeout(function(){$localStorage.remove("createAccount")},300)),$scope.mode=type,ajaxService.getAjaxResponse({url:config.getAllAccount,data:$.param({accountType:type,isExistingAccount:existingAccount})}).then(function(response){if("true"===response.Success)$scope.getAllError=!1,$scope.abMasterList=response.accountDetails,$scope.abMasterList.length&&!existingAccount&&$scope.returnMemberList($scope.pageSize);else{$scope.getAllError=!0;for(var key in response.error)$scope.getAllErrorMsg=response.error[key]}})},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.returnMemberList($scope.pageSize)},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize))},$scope.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},$scope.returnMemberList=function(pageSize){return $scope.abMasterList.length?($scope.pageSize=pageSize,pageSize>=$scope.abMasterList.length&&($scope.disabledInfinite=!0,$scope.pageSize=$scope.abMasterList.length),$scope.load&&($scope.lastPredicate="Individual"===$scope.mode?"memberName":"companyName",$scope.lastReverse=!1,$scope.load=!1),$scope.abList=$scope.abMasterList,void $scope.order($scope.lastPredicate,$scope.lastReverse)):!0},$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.order=function(predicate,reverse){$scope.lastPredicate=predicate,$scope.lastReverse=reverse,$scope.abList=$filter("orderBy")($scope.abList,predicate,reverse)},$scope.resetfilter=function(allmembers){$scope.pageSize=$scope.intialPageSize,$scope.newArr=[],$scope.searchTag=[],$scope.tags=[],$scope.filter={},$scope.statusInclude=[],$scope.adminc=!1,$scope.leadC=!1,$scope.textSearching="",$scope.searchText="","undefined"!=typeof $scope.selectedSearch&&($scope.selectedSearch.userStatusFormatted="",$scope.selectedSearch.hiringRoles=""),$scope.abList=angular.copy($scope.abMasterList),"undefined"!=typeof allmembers&&($scope.pageSize=$scope.abMasterList.length),$scope.load=!0,$scope.disabledInfinite=!1,$rootScope.$broadcast("$scrollStart"),$scope.returnMemberList($scope.pageSize);var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")},$scope.activateAccount=function(pid,status){var url="/sp/sysAdmin/alternateBilling/account/reActivateAccount",mode=!1;"INACTIVE"===status&&(url="/sp/sysAdmin/alternateBilling/account/deactivateAccount",mode=!0),ajaxService.getAjaxResponse({url:url,data:$.param({accountId:pid})}).then(function(response){if("true"===response.Success){for(var i=0;i<$scope.abMasterList.length;i++)if($scope.abMasterList[i].id===pid){$scope.abMasterList[i].deactivated=mode;break}$scope.returnMemberList($scope.pageSize),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Status</strong>",message:" updated successfully"})}else{ngDialog.close("ngdialog1"),$scope.updateStatusError=!0;for(var key in response.error)$scope.updateStatusErrorMsg=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.updateStatusErrorMsg})}})},$scope.archiveAccount=function(options){$scope.saveArchiveOptions=options,ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/archivedConfirmation.html",scope:$scope})},$scope.archiveAccountService=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/archive/archiveAccount",data:$.param({accountId:$scope.saveArchiveOptions.id})}).then(function(response){if("true"===response.Success){for(var i=0;i<$scope.abMasterList.length;i++)if($scope.abMasterList[i].id===$scope.saveArchiveOptions.id){$scope.abMasterList.splice(i,1);break}for(var j=0;j<$scope.abList.length;j++)if($scope.abList[j].id===$scope.saveArchiveOptions.id){$scope.abList.splice(j,1);break}ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:" Archived successfully"})}else{ngDialog.close("ngdialog1");for(var key in response.error)$scope.updateStatusErrorMsg=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.updateStatusErrorMsg})}})},$scope.getAllArchived=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/archive/getAllArchiveAccounts",data:$.param({accountType:sharedProperties.getParam("type")})}).then(function(response){if("true"===response.Success)$scope.abMasterList=response.account,$scope.returnMemberList($scope.pageSize);else{for(var key in response.error)$scope.updateStatusErrorMsg=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.updateStatusErrorMsg})}})},$scope.deleteConfirm=function(d){$scope.afid=d,ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/deleteConfirmation.html",scope:$scope})},$scope.fetchAccountDetails=function(accountId,accountDetails){return $scope.currentId===accountId?!0:($scope.currentId=accountId,$scope.submitted=!1,$scope.detailModule=accountDetails,void ajaxService.getAjaxResponse({url:"b"===accountDetails.mode?config.fetchAccountDetails:config.fetchAccountDetailsIndividual,data:$.param({accountId:accountId})}).then(function(response){if("true"===response.Success)$scope.accountDetails=null,$scope.accountDetails=response,$scope.errorMessage=!1,$scope.signup.paymentAgreement=response.account.agreementterm||1,$scope.signup.paymentType=0,$timeout(function(){$scope.imports.cpt=-1},0),$scope.imports.camount=null,$scope.imports.ccomment=null;else{for(var key in response.error)$scope.updateStatusErrorMsg=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.updateStatusErrorMsg})}}))},$scope.validateSendResponse=function(){if($scope.submitted=!1,$scope.errorMessage=!1,$scope.ptype=!1,null===$scope.accountDetails)return $scope.errorMessage=!0,!0;if(this.importAccount.$valid&&-1!==parseInt(this.imports.cpt)){var obj={chargeAmount:this.imports.camount,isTrial:"TRIAL"===this.imports.cpt?!0:!1,paymentType:this.imports.cpt,comment:this.imports.ccomment,accountId:this.accountDetails.account.id},options={url:"/sp/sysAdmin/alternateBilling/account/importExisting",data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){$.growl({icon:"glyphicon glyphicon-ok",message:" Account imported successfully"});for(var i=0;i<$scope.abMasterList.length;i++)if($scope.abMasterList[i].id===$scope.accountDetails.account.id){$scope.abMasterList.splice(i,1),$("html,body").animate({scrollTop:$(".bgWhiteBord").offset().top-20},300);break}$scope.accountDetails=null,$scope.accountList.search=null,$scope.currentId=null,$timeout(function(){$scope.imports.cpt=-1,$scope.signup.paymentAgreement=-1,$scope.signup.paymentType=-1},0),$scope.imports.camount=null,$scope.imports.ccomment=null}else null!==response.error&&($scope.failure=response.error,$scope.sfailure=!0)})}else{$scope.submitted=!0,-1===parseInt(this.imports.cpt)&&($scope.ptype=!0);var elem=angular.element($element);$(elem).find("form .ng-invalid:first").length&&$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300)}},$scope.backToDefault=function(){$scope.accountDetails=null,$scope.accountList.search=null,$scope.currentId=null,$timeout(function(){$scope.imports.cpt=-1,$scope.signup.paymentAgreement=-1,$scope.signup.paymentType=-1},0),$scope.imports.camount=null,$scope.imports.ccomment=null,$scope.errorMessage=!1,$scope.ptype=!1,$scope.submitted=!1,$("html,body").animate({scrollTop:$(".bgWhiteBord").offset().top-20},300)},$scope.removeError=function(val){-1!==val&&($scope.ptype=!1)}}function accountViewDetail($scope,ajaxService,$localStorage,sharedProperties,ngDialog,$timeout,$filter){$scope.disableCompanyEditing=!0,$scope.disableIndividualEditing=!0,$scope.formStatus={},$scope.dialogStatus={},$scope.adminsList=[],$scope.hiringAdminsList=[],$scope.creditInfo={},$scope.serverError=!1;var localStore=$localStorage.get("creditted");localStore===!0&&($localStorage.remove("creditted"),$.growl({icon:"glyphicon glyphicon-ok",message:"Amount Creditted"}));var growlNotification=$localStorage.get("addMembers");null!==growlNotification&&"undefined"!=typeof growlNotification&&($.growl({icon:"glyphicon glyphicon-ok",message:growlNotification}),$timeout(function(){$localStorage.remove("addMembers")},300));var growlNotification1=$localStorage.get("addCandidates");null!==growlNotification1&&"undefined"!=typeof growlNotification1&&($.growl({icon:"glyphicon glyphicon-ok",message:growlNotification1}),$timeout(function(){$localStorage.remove("addCandidates")},300));var growlNotification2=$localStorage.get("updateAccount");null!==growlNotification2&&"undefined"!=typeof growlNotification2&&($.growl({icon:"glyphicon glyphicon-ok",message:growlNotification2}),$timeout(function(){$localStorage.remove("updateAccount")},300));var config={getAllAccountDetails:"/sp/sysAdmin/alternateBilling/account/businessAccountDetails",getAllAccountIndividualDetails:"/sp/sysAdmin/alternateBilling/account/individualAccountDetails",updateCompany:"/sp/sysAdmin/alternateBilling/account/updateCompany",updateIndividualProfile:"/sp/sysAdmin/alternateBilling/account/updateIndividualProfile",deactivateRenewal:"/sp/sysAdmin/alternateBilling/account/cancel",deactivateAccount:"/sp/sysAdmin/alternateBilling/account/deactivateAccount"};$scope.getAccountValue=function(type){ajaxService.getAjaxResponse({url:"undefined"==typeof type?config.getAllAccountDetails:config.getAllAccountIndividualDetails,data:$.param({accountId:sharedProperties.getParam("accountId")})}).then(function(response){if("true"===response.Success)"undefined"==typeof type?($scope.accountInfo=response,$scope.account=response,$scope.companyDetail=response.company,$scope.companyDetail.companyId=response.company.id,$scope.companyDetail.address.address1=response.company.address.addressLine1,$scope.companyDetail.address.address2=response.company.address.addressLine2,$scope.companyDetail.address.zip=response.company.address.zipCode,$scope.stateCheck.forSelectedCountry=response.company.address.country,$scope.accountDetails=response.account,$scope.memberList=response.accountUsers,$scope.masterCompanyDetail=angular.copy($scope.companyDetail),$scope.adminsList=response.planAdminUsers.Primary,$scope.hiringAdminsList=response.planAdminUsers.IntelligentHiring):($scope.account=response,$scope.accountInfo=response,$scope.accountDetails=response.account,$scope.userDetail=response.profileForm,$scope.userDetail.userId=response.userSummary.id,$scope.userDetail.address1=response.address.addressLine1,$scope.userDetail.address2=response.address.addressLine2,$scope.userDetail.zip=response.address.zipCode,$scope.userDetail.city=response.address.city,$scope.userDetail.state=response.address.state,$scope.userDetail.country=response.address.country,$scope.masterUserDetail=angular.copy($scope.userDetail));else{$scope.getAllError=!0;for(var key in response.error)$scope.getAllErrorMsg=response.error[key]}})},$scope.saveAndUpdate=function(formData,formName){$scope.formStatus.sumbit=!1;var empCountErr;empCountErr="undefined"!=typeof formData.numberOfEmployees&&formData.numberOfEmployees<1?!1:!0;var URL="companyDetails"===formName?config.updateCompany:config.updateIndividualProfile,vCount=0;for(var k in formData)if("object"==typeof formData[k])for(var l in formData[k])("default"===formData[k][l]||"default1"===formData[k][l])&&vCount++;else("default"===formData[k]||"default1"===formData[k])&&vCount++;this[formName].$valid&&0===vCount&&empCountErr?ajaxService.getAjaxResponse({url:URL,data:$.param(formData).replace(/address%5B/g,"").replace(/%5D/g,"").replace(/%2C/g,",")}).then(function(response){if("true"===response.Success)$scope.masterCompanyDetail=angular.copy($scope.companyDetail),$scope.disableCompanyEditing=!0,$scope.masterUserDetail=angular.copy($scope.userDetail),$scope.disableIndividualEditing=!0;else if(null!==response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}}):$scope.formStatus.sumbit=!0},$scope.disableEdit=function(){$scope.formStatus.sumbit=!1,$scope.disableCompanyEditing=!0,$scope.companyDetail=angular.copy($scope.masterCompanyDetail),$scope.disableIndividualEditing=!0,$scope.userDetail=angular.copy($scope.masterUserDetail)},$scope.showDetailsDialog=function(t){"members"===t?($scope.showDetails={title:"Member account details",total:'Total member accounts purchased : <span class="b-700">'+parseInt($scope.accountDetails.spPlans.Primary.numActive+$scope.accountDetails.spPlans.Primary.availalbeMemberSubscriptions+$scope.accountDetails.spPlans.Primary.numDeleted)+"</span>",active:$scope.accountDetails.spPlans.Primary.numActive,deleted:$scope.accountDetails.spPlans.Primary.numDeleted,available:$scope.accountDetails.spPlans.Primary.numberOfMembers},ngDialog.open({template:"/sp/resources/html/admin/account/show-details-dialog.html",scope:$scope})):($scope.accountDetails.spPlans.IntelligentHiring.availalbeMemberSubscriptions,$scope.showDetails={title:"Candidate account details",total:'Total candidate accounts purchased : <span class="b-700">'+parseInt($scope.accountDetails.spPlans.IntelligentHiring.availalbeMemberSubscriptions+$scope.accountDetails.spPlans.IntelligentHiring.usedHiringSubscriptions)+"</span>",active:$scope.accountDetails.hiringProduct.usedHiringSubscriptions,deleted:$scope.accountDetails.spPlans.IntelligentHiring.availalbeMemberSubscriptions+$scope.accountDetails.spPlans.IntelligentHiring.usedHiringSubscriptions-$scope.accountDetails.spPlans.IntelligentHiring.availalbeMemberSubscriptions-$scope.accountDetails.spPlans.IntelligentHiring.usedHiringSubscriptions,available:$scope.accountDetails.spPlans.IntelligentHiring.availalbeMemberSubscriptions},ngDialog.open({template:"/sp/resources/html/admin/account/show-details-dialog.html",scope:$scope}))},$scope.showReactivateDialog=function(i){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/reActivate",data:$.param({accountId:sharedProperties.getParam("accountId"),planType:"Primary"})}).then(function(response){"true"===response.Success&&($scope.getAccountValue("Individual"),$.growl({icon:"glyphicon glyphicon-ok",message:" Subscription renewal activated successfully"}))})},$scope.showReactivateAccount=function(i){var _data;_data="Primary"===i||"IntelligentHiring"===i?{url:"/sp/sysAdmin/alternateBilling/account/reActivate",data:$.param({accountId:sharedProperties.getParam("accountId"),planType:i})}:{url:"/sp/sysAdmin/alternateBilling/account/reActivate",data:$.param({accountId:sharedProperties.getParam("accountId"),planType:"Primary"})},ajaxService.getAjaxResponse(_data).then(function(response){if("true"===response.Success)"Primary"===i?($.growl({icon:"glyphicon glyphicon-ok",message:" Account renewal activated successfully"}),$scope.getAccountValue()):"IntelligentHiring"===i?($.growl({icon:"glyphicon glyphicon-ok",message:" Hiring addon renewal activated successfully"}),$scope.getAccountValue()):($scope.getAccountValue(i),$.growl({icon:"glyphicon glyphicon-ok",message:" Account activated successfully"}));else{var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$scope.showCancelDialog=function(i){$scope.showCancelType=i,$scope.dialogStatus.title="Cancel Subscription",$scope.dialogStatus.content="Subscription cancelled successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/cancel-subscription-dialog.html",scope:$scope})},$scope.showCancelAccountDialog=function(i){$scope.showCancelType=i,$scope.dialogStatus.title="Cancel Subscription",$scope.dialogStatus.content="Account deactivated successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/cancel-subscription-account-dialog.html",scope:$scope})},$scope.showDetailsDialog=function(t){"members"===t?($scope.showDetails={title:"Member account details",total:'Total member accounts purchased : <span class="b-700">'+parseInt($scope.accountDetails.spPlans.Primary.numActive+$scope.accountDetails.spPlans.Primary.availalbeMemberSubscriptions+$scope.accountDetails.spPlans.Primary.numDeleted)+"</span>",active:$scope.accountDetails.spPlans.Primary.numActive,deleted:$scope.accountDetails.spPlans.Primary.numDeleted,available:$scope.accountDetails.spPlans.Primary.availalbeMemberSubscriptions},ngDialog.open({template:"/sp/resources/html/admin/account/show-details-dialog.html",scope:$scope})):($scope.accountInfo.account.hiringProduct.availableHiringSubscripitons,$scope.showDetails={title:"Candidate account details",total:'Total candidate accounts purchased : <span class="b-700">'+parseInt($scope.accountInfo.account.hiringProduct.availableHiringSubscripitons+$scope.accountInfo.account.hiringProduct.usedHiringSubscriptions)+"</span>",active:$scope.accountInfo.account.hiringProduct.usedHiringSubscriptions,deleted:$scope.accountInfo.account.hiringProduct.availableHiringSubscripitons+$scope.accountInfo.account.hiringProduct.usedHiringSubscriptions-$scope.accountInfo.account.hiringProduct.availableHiringSubscripitons-$scope.accountInfo.account.hiringProduct.usedHiringSubscriptions,available:$scope.accountInfo.account.hiringProduct.availableHiringSubscripitons},ngDialog.open({template:"/sp/resources/html/admin/account/show-details-dialog.html",scope:$scope}))},$scope.cancelSubscription=function(mode){ajaxService.getAjaxResponse({url:config.deactivateRenewal,data:$.param({accountId:sharedProperties.getParam("accountId"),planType:"Primary"})}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:" Subscription cancelled successfully "}),$timeout(function(){$scope.getAccountValue("Individual")},300)):(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Server </strong> ",message:Error}),$timeout(function(){$scope.getAccountValue("Individual")},300))})},$scope.cancelAccountSubscription=function(mode){var _data;_data="Primary"===mode||"IntelligentHiring"===mode?{url:"/sp/sysAdmin/alternateBilling/account/cancel",data:$.param({accountId:sharedProperties.getParam("accountId"),planType:mode})}:{url:"/sp/sysAdmin/alternateBilling/account/cancel",data:$.param({accountId:sharedProperties.getParam("accountId"),planType:"Primary"})},ajaxService.getAjaxResponse(_data).then(function(response){if("true"===response.Success){var m;m="Primary"===mode?"Account renewal deactivated":"IntelligentHiring"===mode?"Hiring Addon renewal deactivated":"Account deactivated successfully",ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:m}),$timeout(function(){"Primary"===mode||"IntelligentHiring"===mode?$scope.getAccountValue():$scope.getAccountValue(mode)},300)}else ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Server </strong> ",message:Error}),$timeout(function(){$scope.getAccountValue()},300)})},$scope.addAdmin=function(email,userObj){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/addAdminMember",data:$.param({companyId:$scope.accountInfo.company.id,planType:$scope.addAdminType,userEmail:email})}).then(function(response){if("true"===response.Success)"Primary"===$scope.addAdminType?$scope.adminsList.push(userObj):$scope.hiringAdminsList.push(userObj),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:"Admin added successfully "});else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$scope.removeAdmin=function(email,userObj){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/removeAdminMember",data:$.param({companyId:$scope.accountInfo.company.id,planType:$scope.updatedPlanType,userEmail:email})}).then(function(response){if("true"===response.Success){var dupeList="Primary"===$scope.updatedPlanType?angular.copy($scope.adminsList):angular.copy($scope.hiringAdminsList);jQuery.each(dupeList,function(i,j){return dupeList[i].email===email?(dupeList.splice(i,1),"Primary"===$scope.updatedPlanType?$scope.adminsList=angular.copy(dupeList):$scope.hiringAdminsList=angular.copy(dupeList),!1):void 0}),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:"Admin removed successfully "})}else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$scope.removeAdminAccess=function(type,userObj){$scope.updatedPlanType=type,$scope.removeAdminMember=userObj,ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/removeAdminModal.html",scope:$scope})},$scope.addAdminAccess=function(type){$scope.addAdminType=type,ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/members",data:$.param({companyId:$scope.accountInfo.company.id,planType:$scope.addAdminType})}).then(function(response){if("true"===response.Success)$scope.masterMemberList=response.memberList.length?response.memberList:[],$scope.selectMemberList=angular.copy($scope.masterMemberList),$scope.responseRecieved=!0,$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.order=function(predicate,reverse){$scope.lastPredicate=predicate,$scope.lastReverse=reverse,$scope.selectMemberList=$filter("orderBy")($scope.selectMemberList,predicate,reverse)},ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/selectAdminModal.html",scope:$scope});else if(null!=response.error){$scope.responseRecieved=!0;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$scope.addCreditPop=function(page){$scope.acPageType=page,$scope.creditInfo={},$scope.creditInfo.cpt=$scope.account.account.paymentInstrument.paymentType,$scope.creditInfo.ccomment=$scope.account.account.paymentInstrument.comment,$scope.serverError=!1,$scope.serverErrorMsg=null,ngDialog.open({template:"/sp/resources/html/admin/account/addcreditspop.html",scope:$scope})},$scope.addCredit=function(form){$scope.submitted=!1,this.spSubscribe.$valid&&"0"!==this.amount?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addCredit",data:$.param({accountId:$scope.account.account.id,chargeAmount:$scope.creditInfo.amount,paymentType:$scope.creditInfo.cpt,comment:$scope.creditInfo.ccomment})}).then(function(response){if("true"===response.Success)"individual"===$scope.acPageType?$scope.getAccountValue($scope.acPageType):$scope.getAccountValue(),$scope.sfailure===!0&&($scope.signup.submitted=!1,$scope.sfailure=!1,$scope.failure=null),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Amount</strong>",message:" Credited"});else{for(var key in response.error)$scope.errorMessage=response.error[key];$scope.serverError=!0,$scope.serverErrorMsg=$scope.errorMessage}}):$scope.submitted=!0},$scope.deleteConfirm=function(d,page){$scope.afid=d,$scope.afPage=page,ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/deleteConfirmationView.html",scope:$scope})},$scope.activateAccount=function(pid,status,page){var url="/sp/sysAdmin/alternateBilling/account/reActivateAccount",mode=!1;"INACTIVE"===status&&(url="/sp/sysAdmin/alternateBilling/account/deactivateAccount",mode=!0),ajaxService.getAjaxResponse({url:url,data:$.param({accountId:pid})}).then(function(response){if("true"===response.Success)"individual"===page?$scope.getAccountValue(page):$scope.getAccountValue(),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Account</strong>",message:" status updated successfully"});else{ngDialog.close("ngdialog1"),$scope.updateStatusError=!0;for(var key in response.error)$scope.updateStatusErrorMsg=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.updateStatusErrorMsg})}})}}angular.module("spApp").controller("alternateBilling",alternateBilling),alternateBilling.$inject=["$scope","$element","ajaxService","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage"],angular.module("spApp").controller("accountViewDetail",accountViewDetail),accountViewDetail.$inject=["$scope","ajaxService","$localStorage","sharedProperties","ngDialog","$timeout","$filter"];
function archiveListingController($scope,$q,$element,$attrs,ajaxService,$location,$state,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage){$scope.memberList=[],$scope.masterMemberList=[],$scope.showfilter=!1,$scope.pageSize=20,$scope.intialPageSize=20,$scope.searchTag=[],$scope.hiringRoles=[],$scope.alldisplay=!1,$scope.filter={},$scope.tags=[],$scope.userEmail={email:[]},$scope.checkBox=[],$scope.allMembersEmailId=[],$scope.statusInclude=[],$scope.setEditMode=!1,$scope.userStatus=[],$scope.groupModule=[],$scope.masterGroupModule=[],$scope.textSearching="",$scope.mainGroupInfoList=[],$scope.checkedAll=!1,$scope.deleteUser=!1,$scope.deleteUserError=!1,$scope.updateGroup=!1,$scope.updateGroupError=!1,$scope.updateError="",$scope.EditGroupEmail="",$scope.archiveDialog={},$scope.archiveDialog.addHiring=!1,$scope.load=!0,$scope.formatDate=function(d){if(null!==d&&"undefined"!=typeof d){var splitDate=d.split("-"),monthData={"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"},formattedDate=monthData[splitDate[1].toString()]+" "+parseInt(splitDate[2])+", "+parseInt(splitDate[0]);return formattedDate}},$scope.getMembersData=function(){var options={url:"/sp/hiring/getAllArchivedCandidates"};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&($localStorage.remove("isCandidateArchived","archiveCandidateId","candidateEmail","candidateID"),$scope.masterMemberList=response["hiring-archived"].length?response["hiring-archived"]:[],$scope.returnMemberList($scope.pageSize),$scope.tagListArray=[],$scope.mokroles=[],$scope.userRoles=[],angular.forEach(response["hiring-archived"],function(val,index){$scope.allMembersEmailId.push(val.email),null!=val.tagList&&($scope.tagListArray=val.tagList.concat($scope.tagListArray).unique()),null!=val.userStatusFormatted&&$scope.mokroles.push(val.userStatusFormatted),null!==val.hiringRoles&&($scope.userRoles=val.hiringRoles.concat($scope.userRoles).unique())}),$scope.tagListArray=$scope.autoCompleteType($scope.tagListArray),$scope.userStatus=$scope.mokroles.unique().sort(),$scope.hiringRoles=$scope.userRoles.unique(),$scope.alistLoaded=!0)})},$scope.intersection=function(a,b){var result=[],ai=0,bi=0;for(a.sort(),b.sort();a.length>ai&&b.length>bi;)a[ai]<b[bi]?ai++:a[ai]>b[bi]?bi++:(result.push(a[ai]),ai++,bi++);return result},$scope.enableAdvanceSection=function(event){$(event.currentTarget).closest(".complete-profile").find(".editable-section").show()},$scope.autoCompleteType=function(arr){for(var customarray=[],i=0;i<arr.length;i++)customarray.push({text:arr[i]});return customarray},$scope.order=function(predicate,reverse){$scope.memberList=$filter("orderBy")($scope.memberList,predicate,reverse)},$scope.loadTags=function(query){var deferred=$q.defer();return deferred.resolve($scope.getLoadSuggestion(query)),deferred.promise},$scope.getLoadSuggestion=function(query){for(var copyArray=[],i=0;i<$scope.tagListArray.length;i++)angular.lowercase($scope.tagListArray[i].text).indexOf(angular.lowercase(query))>-1&&copyArray.push($scope.tagListArray[i]);return copyArray.slice(0,5)},$scope.tagAdded=function(tag){$scope.searchTag.push(tag.text),$scope.refineSearch($scope.searchTag)},$scope.tagRemoved=function(tag){$scope.searchTag.splice($scope.searchTag.indexOf(tag.text),1),$scope.refineSearch($scope.searchTag)},$scope.refineSearch=function(list){$scope.newArr=[],angular.forEach($scope.masterMemberList,function(val,key){null!=val.tagList&&$scope.intersection(val.tagList,list).length===list.length&&$scope.newArr.push(val)}),$scope.checkboxFilter()},$scope.includeCheck=function(status){var i=$.inArray(status,$scope.statusInclude);i>-1?$scope.statusInclude.splice(i,1):$scope.statusInclude.push(status),$scope.checkboxFilter()},$scope.checkboxFilter=function(status){$scope.statusInclude.length>0&&($scope.checkBox=[],angular.forEach($scope.masterMemberList,function(val,index){for(var i=0;i<$scope.statusInclude.length;i++)for(var j=0;j<val.roles[i].length;j++)val.roles[j]===$scope.statusInclude[i]&&$scope.checkBox.push(val)})),$scope.returnMemberList($scope.pageSize)},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.returnMemberList($scope.pageSize)},$scope.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize))},$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.returnMemberList=function(pageSize){if($scope.searchTag.length&&!$scope.statusInclude.length&&($scope.memberList=angular.copy($scope.newArr)),$scope.searchTag.length&&$scope.statusInclude.length){$scope.combineArray=[];for(var i=0;i<$scope.newArr.length;i++)for(var j=0;j<$scope.checkBox.length;j++)$scope.newArr[i].email===$scope.checkBox[j].email&&$scope.combineArray.push($scope.newArr[i]);$scope.memberList=angular.copy($scope.combineArray)}!$scope.searchTag.length&&$scope.statusInclude.length&&($scope.memberList=angular.copy($scope.checkBox)),$scope.searchTag.length||$scope.statusInclude.length||($scope.memberList=angular.copy($scope.masterMemberList)),$scope.memberList=sharedProperties.searchModule($scope.textSearching,$scope.memberList,2),pageSize>=$scope.memberList.length?$scope.alldisplay=!0:$scope.alldisplay=!1,$scope.pageSize=pageSize,$scope.memberList=$scope.memberList.slice(0,pageSize),$scope.load&&($scope.order("name","false"),$scope.load=!1)},$scope.checkAll=function(){$scope.checkedAll=!$scope.checkedAll,$scope.negative?$scope.userEmail.email=$scope.masterMemberList.map(function(item){return{email:item.email,name:item.name}}):$scope.userEmail.email=[]},$scope.resetfilter=function(allmembers){$scope.pageSize=$scope.intialPageSize,$scope.newArr=[],$scope.searchTag=[],$scope.tags=[],$scope.filter={},$scope.userEmail.email=[],$scope.statusInclude=[],$scope.adminc=!1,$scope.leadC=!1,$scope.textSearching="",$scope.searchText="","undefined"!=typeof $scope.selectedSearch&&($scope.selectedSearch.userStatusFormatted="",$scope.selectedSearch.hiringRoles=""),$scope.memberList=angular.copy($scope.masterMemberList),"undefined"!=typeof allmembers&&($scope.pageSize=$scope.masterMemberList.length),$scope.returnMemberList($scope.pageSize),$scope.order("name","false");var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")},$scope.certainDelete=function(){ngDialog.open({template:"/sp/resources/html/tools/hiring/deleteConfirmation.html",scope:$scope})},$scope.deleteButton=function(){},$scope.confirmDelete=function(event){var email=$(event.target).closest(".complete-profile").find(".email").html(),options=(angular.element(event.currentTarget),{url:"/sp/hiring/deleteArchiveCandidate",data:$.param({candidateEmail:email})});ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?($scope.getMembersData(),$.growl({icon:"glyphicon glyphicon-ok",message:"Candidate(s) deleted successfully"})):$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Server Error"})})},$scope.deleteUsers=function(emails){var emailList=[];jQuery.each(emails,function(i,j){emailList.push(emails[i].email)});var options={url:"/sp/hiring/deleteArchiveCandidate",data:$.param({candidateEmail:emailList.toString()})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&($scope.userEmail.email=[],$scope.alltoggle=!1,$scope.checkedAll&&($scope.negative=!$scope.negative),ngDialog.close("ngdialog1"),$scope.getMembersData(),$.growl({icon:"glyphicon glyphicon-ok",message:"Candidate(s) deleted successfully"}))})},$scope.addClassActive=function(){$scope.dropUp=!$scope.dropUp},$scope.notificationEmail=function(emails){emails.length&&(sharedProperties.setEmail(emails),sharedProperties.setObject($scope.memberList),ngDialog.open({template:"return-visitor.html"}))},$scope.profileRoute=function(event){var groupname=$(event.currentTarget).data("routeparam");$localStorage.set("groupname",groupname),window.location.href="/sp/admin/group/#profile"},$scope.showFullList=function(){$scope.resetfilter("full")},$scope.editGroupSection=function(index){$scope.EditGroupEmail=this.memberList.email;for(var currentEmail=this.memberList.email,i=0;i<$scope.memberList.length;i++)currentEmail===$scope.memberList[i].email&&(index=i);$scope.setEditMode=!0,$scope.indexToChange=index,$scope.groupEditSection=angular.copy($scope.memberList[index]),$scope.groupSelectOption=[];for(var j=0;j<$scope.groupEditSection.groupAssociationList.length;j++)$scope.groupSelectOption.push($scope.groupEditSection.groupAssociationList[j].name);ngDialog.open({template:"/sp/admin/member/editGroup",scope:$scope})},$scope.enableLeadDialog=function(leadValue,index,groupName){for(var i=0;i<$scope.mainGroupInfoList.length;i++)if(groupName===$scope.mainGroupInfoList[i].name){if(null!==$scope.mainGroupInfoList[i].groupLead&&$scope.mainGroupInfoList[i].groupLead.email!==$scope.EditGroupEmail)return!1;$scope.groupEditSection.groupAssociationList[index].groupLead=!leadValue}},$scope.setStyle=function(lead){return $scope.viewMode(),lead===!0?!0:!1},$scope.isItEnabled=function(groupName,id){$scope.classActivate=[];for(var i=0;i<$scope.mainGroupInfoList.length;i++)groupName===$scope.mainGroupInfoList[i].name&&null!==$scope.mainGroupInfoList[i].groupLead&&$scope.mainGroupInfoList[i].groupLead.email!==$scope.EditGroupEmail&&($scope.classActivate.push("#mode_"+id),$scope.classActivate.push("#modeprop_"+id))},$scope.viewMode=function(){if($scope.classActivate.length)for(var i=0;i<$scope.classActivate.length;i++)$($scope.classActivate[i]).addClass("disabled")},$scope.addGroupToModule=function(groupName,lead){return $scope.selectedGroup=groupName,"default"===groupName?!1:(""===$scope.groupEditSection.groupAssociationList[0].name&&$scope.groupEditSection.groupAssociationList.splice(0,1),$scope.groupEditSection.groupAssociationList.push({name:groupName,groupLead:!1}),void $scope.groupSelectOption.push(groupName))},$scope.addGroupMember=function(names){return""===names?!1:!0},$scope.removeGroupDialog=function(event,groupName){for(var _this=event.target,current=($(_this).closest(".blockGroup").remove(),""),i=0;i<$scope.groupEditSection.groupAssociationList.length;i++)$scope.groupEditSection.groupAssociationList[i].name===groupName.name&&($scope.groupEditSection.groupAssociationList.splice(i,1),current=i);$scope.groupSelectOption.splice(current,1)},$scope.saveGroupToModule=function(groupName){for(var newArr="",i=0;i<$scope.groupEditSection.groupAssociationList.length;i++)newArr=newArr.length?newArr+","+$scope.groupEditSection.groupAssociationList[i].name+":"+$scope.groupEditSection.groupAssociationList[i].groupLead:$scope.groupEditSection.groupAssociationList[i].name+":"+$scope.groupEditSection.groupAssociationList[i].groupLead;var options={url:"/sp/admin/group/memberGroupUpdate",data:$.param({groupAssociationList:newArr,memberEmail:$scope.groupEditSection.email})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){$scope.groupEditSection.groupAssociationList.length?$scope.memberList[$scope.indexToChange]=$scope.groupEditSection:($scope.groupEditSection.groupAssociationList.push({name:"",groupLead:!1}),$scope.memberList[$scope.indexToChange]=$scope.groupEditSection);for(var i=0;i<$scope.masterMemberList.length;i++)$scope.masterMemberList[i].email===$scope.memberList[$scope.indexToChange].email&&($scope.masterMemberList[i]=$scope.groupEditSection);ngDialog.close("ngdialog1"),ngDialog.open({template:"/sp/admin/member/confirmation"})}else ngDialog.close("ngdialog1"),ngDialog.open({template:"/sp/admin/member/errorGroup"})})},$scope.memberTakeAway=function(email,id){$localStorage.set("archiveCandidateId",id).set("isCandidateArchived",!0),window.location.href="/sp/tools/hiring/profile?cemail="+email},$scope.calltoAction=function(select){return""===select?!1:void(window.location.href=select)},$scope.archiveDialog=function(e,n,r){$scope.archiveCandidate={name:n,email:e,roles:r},ngDialog.open({template:"/sp/resources/html/tools/hiring/archive-candidate.html",scope:$scope})},$scope.moveAllCandidate=function(cEmail){var emailList=[];jQuery.each(cEmail,function(i,j){emailList.push(cEmail[i].email)});var options={url:"/sp/hiring/moveToCandidate",data:$.param({candidateEmail:emailList.toString()})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Candidate</strong>",message:" archived successfully"}),$scope.getMembersData())})},$scope.moveToCandidateList=function(email){var options={url:"/sp/hiring/moveToCandidate",data:$.param({candidateEmail:email})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&($.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Candidate</strong>",message:" added to list successfully"}),$scope.getMembersData())})},$scope.formatName=function(n){if(null!==n||"undefined"!==n){var slpitName=n.split(", "),formatName=slpitName[1]+" "+slpitName[0];return formatName}},$scope.moveAllDialog=function(emails){$scope.archiveCandidateAll={emails:emails},ngDialog.open({template:"/sp/resources/html/tools/hiring/move-candidate-list.html",scope:$scope})},$scope.sendViewProfileRequest=function(e,n){$scope.profileRequest={email:e,name:n,heading:"Request Access"},ngDialog.open({template:"/sp/resources/html/tools/hiring/send-profile-invite.html",scope:$scope}),$scope.sendRequest=function(e){var options={url:"/sp/notifications/sendNotification",data:$.param({memberEmail:e,type:""}).replace(/%40/g,"@")};ajaxService.getAjaxResponse(options).then(function(response){"true"!==response.Success&&$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:"Not able to send invite"})})}},$scope.sendReminder=function(e,n){$scope.profileRequest={email:e,name:n,heading:"Reminder"},ngDialog.open({template:"/sp/resources/html/tools/hiring/send-profile-invite.html",scope:$scope}),$scope.sendRequest=function(e){var options={url:"/sp/notifications/sendNotification",data:$.param({memberEmail:e,type:""}).replace(/%40/g,"@")};ajaxService.getAjaxResponse(options).then(function(response){"true"!==response.Success&&$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:"Not able to send invite"})})}}}function notification($scope,sharedProperties){$scope.name=[];var memberList=sharedProperties.getObject(),emails=sharedProperties.getEmail();$scope.emailId=emails,angular.forEach(memberList,function(val,index){for(var i=0;i<emails.length;i++)emails[i]===val.email&&$scope.name.push(val.name)})}angular.module("spApp").controller("archiveListingController",archiveListingController),angular.module("spApp").controller("notification",notification),archiveListingController.$inject=["$scope","$q","$element","$attrs","ajaxService","$location","$state","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage"],notification.$inject=["$scope","sharedProperties"];
function assessmentCompleted($scope,$q,$element,$attrs,ajaxService,$location,$state,$filter,ngDialog,sharedProperties,$timeout,$rootScope,userDataService,$localStorage){$scope.isProfileLoaded=!1,$scope.getUserRole=function(){ajaxService.getAjaxResponse({url:"/sp/signedIn/getProfile"}).then(function(response){if("true"===response.Success){var roles=response.member.roles.sort();$scope.isProfileLoaded=!0,$scope.isIndividualUser=-1===jQuery.inArray("IndividualAccountAdministrator",roles)?!1:!0}})},$scope.getUserRole()}angular.module("spApp").controller("assessmentCompleted",assessmentCompleted),assessmentCompleted.$inject=["$scope","$q","$element","$attrs","ajaxService","$location","$state","$filter","ngDialog","sharedProperties","$timeout","$rootScope","userDataService","$localStorage"];
function assessmentController($scope,ajaxService,$timeout,$rootScope,$localStorage,sharedProperties){function configServices(page){if("assessment360"===page){_this.analyticsPageView="PrismLens";var getLink=window.location.href.split("/"),id=getLink[getLink.length-1];_this.page="assessment360",_this.services={start:"/sp/assessment360/start/"+id,next:"/sp/assessment360/process/"+id,previous:"/sp/assessment360/previous/"+id,redirect:"/sp/external/thankyou"},_this.startAssessment()}else"hiringUser"===page?(_this.analyticsPageView="HiringAssessment",_this.services={start:"/sp/assessment/start",next:"/sp/assessment/process",previous:"/sp/assessment/previous",redirect:"/sp/candidateThankYou"},_this.startAssessment()):(_this.analyticsPageView="MemberAssessment",_this.services={start:"/sp/assessment/start",next:"/sp/assessment/process",previous:"/sp/assessment/previous",redirect:"/sp/assessment/completed"},_this.startAssessment())}function resetBtnFlags(){$scope.nextBtn={enable:!1,isClickable:!1},$scope.prevBtn={enable:!0,isClickable:!1,visible:!0}}function generateRandomOrder(ans,type,action){var answerSet=[],count=0,randomNo=null,tempArray=[],ansLen=ans.length,count1=0;if(angular.forEach(ans,function(value,index){answerSet.push({aNo:index,aDesc:value,aDef:"assessment360"===_this.page?$rootScope.pullInterNationalization("assessmentDefinitions."+value.replace(/ /g,"").replace(/-/g,"")):null}),count++}),count===ansLen){if(count1=answerSet.length,"next"!==action&&"start"!==action){if("MultipleChoice"===type&&4===ansLen)return answerSet;if("MultipleChoice"===type&&4>ansLen){var key="S"+_this.sectionDetails.number+"Q"+_this.questionDetails.number;return _this.trackAnswers[key]?_this.trackAnswers[key]:answerSet}return answerSet}if("MultipleChoice"===type&&4===ansLen)return answerSet;if("MultipleChoice"===type&&4>ansLen){if(angular.forEach(answerSet,function(v,i){randomNo=Math.floor(Math.random()*count1),count1--,tempArray=answerSet[count1],answerSet[count1]=answerSet[randomNo],answerSet[randomNo]=tempArray}),0===count1)return answerSet}else if(angular.forEach(answerSet,function(v,i){randomNo=Math.floor(Math.random()*count1),count1--,tempArray=answerSet[count1],answerSet[count1]=answerSet[randomNo],answerSet[randomNo]=tempArray}),0===count1)return answerSet}}function progress(sectionNo,questionNo){for(var currentSection=sectionNo,currentQuestion=questionNo,totalQuestions=(_this.totalCategories,_this.totalQuestions),categoriesList=_this.categoriesList,completedQuestions=0,precentageCompleted=0,j=0;currentSection>j;j++)completedQuestions+=categoriesList[j].totalQuestions;completedQuestions+=currentQuestion,precentageCompleted=Math.floor(completedQuestions/totalQuestions*100),$scope.nextBtnText=1===parseInt(totalQuestions-completedQuestions)?"Finish":"Next",_this.isLastQuestion=1===parseInt(totalQuestions-completedQuestions)?!0:!1,_this.progressDetails=precentageCompleted.toFixed(),sharedProperties.fireAnalyticsEvent("Assessment | In Progress",_this.analyticsPageView+" - User answered Section "+parseInt(currentSection+1)+". Question "+currentQuestion+". Completed "+_this.progressDetails+" %")}function startAssessment(){$localStorage.flush(),_this.assessmentLoaded=!1,resetBtnFlags(),ajaxService.getAjaxResponse({url:_this.services.start,delay:600,maximum:1200}).then(function(response){if("true"===response.Success)if(_this.serverError=!1,"undefined"!=typeof response.question){var _r=response;if(_this.assessmentData=response,_this.sectionDetails={number:_r.question.categoryNumber,total:_r.categories.totalCategories,instruction:_r.categories.categoriesList[_r.question.categoryNumber].instruction,totalQuestions:_r.categories.categoriesList[_r.question.categoryNumber].totalQuestions,currentNo:_r.question.categoryNumber+1,nextNo:_r.question.categoryNumber+2},_this.questionDetails={number:_r.question.number,type:_r.question.type,description:_r.question.description,optionList:_r.question.optionsList},_this.randomAnswers=_this.generateRandomOrder(_this.questionDetails.optionList,_r.question.type,"start"),"MultipleChoice"===_r.question.type&&_r.question.optionsList.length<4){var key="S"+_r.question.categoryNumber+"Q"+_r.question.number;_this.trackAnswers[key]=_this.randomAnswers}$scope.userParams={c:_r.question.categoryNumber,q:_r.question.number},_this.totalCategories=_r.categories.totalCategories;for(var i=0;i<_this.totalCategories;i++)_this.totalQuestions+=_r.categories.categoriesList[i].totalQuestions;_this.categoriesList=_r.categories.categoriesList,progress(_r.question.categoryNumber,_r.question.number),"MultipleChoice"===_r.question.type?$timeout(function(){0===_r.question.number&&0===_r.question.categoryNumber?($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!1):($scope.prevBtn.enable=!0,$scope.prevBtn.visible=!0),$scope.disableOptionSelection=!1},100):$timeout(function(){0===_r.question.number&&0===_r.question.categoryNumber?($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!1):($scope.prevBtn.enable=!0,$scope.prevBtn.visible=!0),$scope.isDragTemplateLoaded=loadDragTemplate(_r,_this.randomAnswers,"next",_this.page)},100),$timeout(function(){_this.assessmentLoaded=!0},100)}else window.location=_this.services.redirect;else _this.serverError=!0,_this.errorMessage=$rootScope.pullInterNationalization("assessment.refreshError")})}function nextQuestion(){$scope.nextBtn.isClickable===!0&&($scope.isDragTemplateLoaded=!1,"undefined"!=typeof sortable&&null!==sortable.el&&sortable.destroy(),_this.prevAnswer=-1,resetBtnFlags(),$scope.disableOptionSelection===!1&&($scope.disableOptionSelection=!0),ajaxService.getAjaxResponse({url:_this.services.next,delay:600,maximum:1200,data:$.param($scope.userParams).replace(/%2C/g,",")}).then(function(response){if("true"===response.Success)if("undefined"!=typeof response.question){var _r=response;if(_this.questionDetails={number:_r.question.number,type:_r.question.type,description:_r.question.description,optionList:_r.question.optionsList},_this.randomAnswers=_this.generateRandomOrder(_this.questionDetails.optionList,_r.question.type,"next"),"MultipleChoice"===_r.question.type&&_r.question.optionsList.length<4){var key="S"+_r.question.categoryNumber+"Q"+_r.question.number;_this.trackAnswers[key]=_this.randomAnswers}_this.sectionDetails={number:_r.question.categoryNumber,instruction:_this.assessmentData.categories.categoriesList[_r.question.categoryNumber].instruction},_r.question.categoryNumber+1<=_this.totalCategories&&(_this.sectionDetails.currentNo=_r.question.categoryNumber+1,9===_this.sectionDetails.currentNo?_this.sectionDetails.nextNo="":_this.sectionDetails.nextNo=_r.question.categoryNumber+2),progress(_r.question.categoryNumber,_r.question.number),$scope.userParams={c:_r.question.categoryNumber,q:_r.question.number},"MultipleChoice"===_r.question.type?$timeout(function(){0===_r.question.number&&0===_r.question.categoryNumber?($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!1):($scope.prevBtn.enable=!0,$scope.prevBtn.visible=!0),$scope.disableOptionSelection=!1},100):$timeout(function(){0===_r.question.number&&0===_r.question.categoryNumber?($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!1):($scope.prevBtn.enable=!0,$scope.prevBtn.visible=!0),$scope.isDragTemplateLoaded=loadDragTemplate(_r,_this.randomAnswers,"next",_this.page)},100)}else sharedProperties.fireAnalyticsEvent("Assessment | Completed",_this.analyticsPageView),window.location=_this.services.redirect;else _this.serverError=!0,_this.errorMessage=$rootScope.pullInterNationalization("assessment.refreshError")}))}function previousQuestion(){$scope.prevBtn.isClickable===!1&&($scope.isDragTemplateLoaded=!1,"undefined"!=typeof sortable&&null!==sortable.el&&sortable.destroy(),resetBtnFlags(),$scope.prevBtn.enable=!1,$scope.prevBtn.isClickable=!0,$scope.disableOptionSelection===!1&&($scope.disableOptionSelection=!0),ajaxService.getAjaxResponse({url:_this.services.previous,delay:600,maximum:1200}).then(function(response){if("true"===response.Success)if("undefined"!=typeof response.question){var _r=response;"MultipleChoice"===_r.question.type?_this.prevAnswer=_r.lastAnswer[0]:_this.prevAnswer=_r.lastAnswer,_this.questionDetails={number:_r.question.number,type:_r.question.type,description:_r.question.description,optionList:_r.question.optionsList},_this.randomAnswers=_this.generateRandomOrder(_this.questionDetails.optionList,_r.question.type,"previous"),_this.sectionDetails={number:_r.question.categoryNumber,instruction:_this.assessmentData.categories.categoriesList[_r.question.categoryNumber].instruction},_r.question.categoryNumber+1<=_this.totalCategories&&(_this.sectionDetails.currentNo=_r.question.categoryNumber+1,9===_this.sectionDetails.currentNo?_this.sectionDetails.nextNo="":_this.sectionDetails.nextNo=_r.question.categoryNumber+2),progress(_r.question.categoryNumber,_r.question.number),$scope.userParams={c:_r.question.categoryNumber,q:_r.question.number,a:_r.lastAnswer},"MultipleChoice"===_r.question.type?$timeout(function(){0===_r.question.number&&0===_r.question.categoryNumber?($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!1):($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!0),$scope.disableOptionSelection=!1},100):$timeout(function(){0===_r.question.number&&0===_r.question.categoryNumber?($scope.prevBtn.enable=!1,$scope.prevBtn.visible=!1):($scope.prevBtn.enable=!0,$scope.prevBtn.visible=!0),$scope.isDragTemplateLoaded=loadDragTemplate(_r,_this.randomAnswers,"previous",_this.page)},100)}else window.location=_this.services.redirect;else _this.serverError=!0,_this.errorMessage=$rootScope.pullInterNationalization("assessment.refreshError")}))}var _this=this;_this.assessmentLoaded=!1,_this.serverError=!1,_this.totalCategories=0,_this.totalQuestions=0,_this.prevAnswer=-1,_this.page="",_this.isLastQuestion=!1,_this.configServices=configServices,_this.startAssessment=startAssessment,_this.nextQuestion=nextQuestion,_this.previousQuestion=previousQuestion,_this.generateRandomOrder=generateRandomOrder,_this.services={},_this.sectionDetails={},_this.progressDetails={},_this.questionDetails={},_this.assessmentData={},_this.randomAnswers={},_this.trackAnswers=[],_this.analyticsPageView="",$scope.nextBtn={enable:!1,isClickable:!1},$scope.prevBtn={enable:!1,isClickable:!1,visible:!0},$scope.userParams={},$scope.nextBtnText="Next",$scope.disableOptionSelection=!1,$scope.isDragTemplateLoaded=!1}function loadDragTemplate(r,rAns,d,pageCheck){$("#drag-list").html("");var counter,previousAns,oList=rAns,type=(r.question.number,r.question.type),oListLength=r.question.optionsList.length,isTemplateLoaded=!1,isAssessment360="assessment360"===pageCheck?!0:!1;if("next"===d)counter=0,$.each(oList,function(i){isAssessment360?$("#drag-list").append('<div data-opt="option-'+oList[i].aNo+'" class="draggable-wrapper"><p class="definitions-wrapper active"><span>'+oList[i].aDesc+'<span class="definitions">'+oList[i].aDef+"</span></span></p></div>"):$("#drag-list").append('<div data-opt="option-'+oList[i].aNo+'" class="draggable-wrapper"><p><span>'+oList[i].aDesc+"</span></p></div>"),counter++});else if("previous"===d)if(previousAns=r.lastAnswer,"PersonalityRating"!==type)counter=0,$.each(previousAns,function(i){var _index=previousAns[i];isAssessment360?$("#drag-list").append('<div data-opt="option-'+oList[parseInt(_index)].aNo+'" class="draggable-wrapper"><p class="definitions-wrapper active"><span>'+oList[parseInt(_index)].aDesc+'<span class="definitions">'+oList[parseInt(_index)].aDef+"</span></span></p></div>"):$("#drag-list").append('<div data-opt="option-'+oList[parseInt(_index)].aNo+'" class="draggable-wrapper"><p><span>'+oList[parseInt(_index)].aDesc+"</span></p></div>"),counter++});else{var indexArray=[0,1,2,3],missingAns=[];$.each(indexArray,function(i,j){var ansIndex=$.inArray(indexArray[i],previousAns);0>ansIndex&&missingAns.push(i)}),isAssessment360?($("#drag-list").append('<div data-opt="option-'+oList[parseInt(previousAns[0])].aNo+'" class="draggable-wrapper"><p class="definitions-wrapper active"><span>'+oList[parseInt(previousAns[0])].aDesc+'<span class="definitions">'+oList[parseInt(previousAns[0])].aDef+"</span></span></p></div>"),$("#drag-list").append('<div data-opt="option-'+oList[parseInt(missingAns[0])].aNo+'" class="draggable-wrapper"><p class="definitions-wrapper active"><span>'+oList[parseInt(missingAns[0])].aDesc+'<span class="definitions">'+oList[parseInt(missingAns[0])].aDef+"</span></span></p></div>"),$("#drag-list").append('<div data-opt="option-'+oList[parseInt(missingAns[1])].aNo+'" class="draggable-wrapper"><p class="definitions-wrapper active"><span>'+oList[parseInt(missingAns[1])].aDesc+'<span class="definitions">'+oList[parseInt(missingAns[1])].aDef+"</span></span></p></div>"),$("#drag-list").append('<div data-opt="option-'+oList[parseInt(previousAns[1])].aNo+'" class="draggable-wrapper"><p class="definitions-wrapper active"><span>'+oList[parseInt(previousAns[1])].aDesc+'<span class="definitions">'+oList[parseInt(previousAns[1])].aDef+"</span></span></p></div>")):($("#drag-list").append('<div data-opt="option-'+oList[parseInt(previousAns[0])].aNo+'" class="draggable-wrapper"><p><span>'+oList[parseInt(previousAns[0])].aDesc+"</span></p></div>"),$("#drag-list").append('<div data-opt="option-'+oList[parseInt(missingAns[0])].aNo+'" class="draggable-wrapper"><p><span>'+oList[parseInt(missingAns[0])].aDesc+"</span></p></div>"),$("#drag-list").append('<div data-opt="option-'+oList[parseInt(missingAns[1])].aNo+'" class="draggable-wrapper"><p><span>'+oList[parseInt(missingAns[1])].aDesc+"</span></p></div>"),$("#drag-list").append('<div data-opt="option-'+oList[parseInt(previousAns[1])].aNo+'" class="draggable-wrapper"><p><span>'+oList[parseInt(previousAns[1])].aDesc+"</span></p></div>")),counter=4}return counter===oListLength?isTemplateLoaded=!0:void 0}function optionSelection($rootScope,$timeout){return{restrict:"A",link:function($scope,$element,$attrs){var optionSelectionEvent=function(){$("#assessmentTemplate1").find(".assessment-opts").removeClass("red-shadow"),$("#assessmentTemplate1").off("click").on("click",".answer-options",function(){if($scope.disableOptionSelection!==!1)return!1;var i=$(this).attr("data-option");$("#assessmentTemplate1").find(".assessment-opts").removeClass("red-shadow"),$(this).find(".assessment-opts").addClass("red-shadow"),$scope.userParams.a=i,$scope.$apply(function(){$scope.nextBtn.enable=!1,$scope.nextBtn.isClickable=!0}),$scope.prevBtn.isClickable||$scope.$parent.ctrl.isLastQuestion?$scope.$apply(function(){$scope.nextBtn.enable=!0}):($scope.nextBtn.enable=!1,$timeout(function(){$scope.$parent.ctrl.nextQuestion()},200))}),-1!==parseInt($("#assessmentTemplate1").attr("data-prev"))&&$timeout(function(){var i=parseInt($("#assessmentTemplate1").attr("data-prev"));$("#assessmentTemplate1").find('.answer-options[data-option="'+i+'"]').trigger("click")},100)};$scope.$last===!0&&optionSelectionEvent(),$scope.$watch(function(){return $attrs.question},function(){$scope.$last===!0&&optionSelectionEvent()})}}}function setupLayout(){var maxHeight,maxWidth,dragSlidesHeights=[],dragSlidesWidths=[],labelCont=$("#drag-list").prev(),draggableCont=$("#drag-list"),backLabels=$("#drag-list").next();$.each(draggableCont.find("div"),function(i,j){dragSlidesHeights.push($(this).outerHeight()),dragSlidesWidths.push($(this).outerWidth()),$(this).attr("style","").removeClass("active")}),maxHeight=Math.max.apply(Math,dragSlidesHeights),maxWidth=Math.max.apply(Math,dragSlidesWidths),$.each(draggableCont.find("div"),function(i,j){$(this).find("p").css({height:maxHeight})}),$.each(labelCont.find("div"),function(i,j){$(this).attr("style","").removeClass("active"),$(this).css({height:maxHeight}),$(this).find("p").css({height:maxHeight})}),$.each(backLabels.find("div.assessment-opts"),function(i,j){$(this).attr("style",""),$(this).css({height:maxHeight})})}function dragEnabledTemplate($rootScope,$timeout){return{restrict:"A",link:function($scope,$element,$attrs){var trackListOrder=function(){var updatedListOrder=[],list=$("#drag-list").find("div"),counter=0;$scope.nextBtn.enable=!1,$scope.nextBtn.isClickable=!1,$scope.prevBtn.enable=!1,$scope.prevBtn.isClickable=!0,$scope.$apply(),$.each(list,function(i,j){"undefined"!=typeof $(this).attr("data-opt").split("-")[1]&&(updatedListOrder.push($(this).attr("data-opt").split("-")[1]),counter++)}),counter===list.length&&("personalityrating"===$("#drag-list").attr("data-type").toLowerCase()?$scope.userParams.a=updatedListOrder[0]+","+updatedListOrder[3]:$scope.userParams.a=updatedListOrder.join(),$timeout(function(){-1===parseInt($("#drag-list").attr("data-prev"))?($scope.prevBtn.enable=!0,$scope.prevBtn.isClickable=!1):($scope.prevBtn.enable=!1,$scope.prevBtn.isClickable=!0),$scope.nextBtn.enable=!0,$scope.nextBtn.isClickable=!0,$scope.$apply()},300))},initSortable=function(){var el=document.getElementById("drag-list");sortable=Sortable.create(el,{ghostClass:"is-dragging",onStart:function(){$scope.nextBtn.enable=!1,$scope.nextBtn.isClickable=!1,$scope.prevBtn.enable=!1,$scope.prevBtn.isClickable=!0,$scope.$apply()},onEnd:function(evt){$timeout(function(){trackListOrder()},300)}})};$scope.isDragTemplateLoaded&&($timeout.cancel(),$timeout(function(){trackListOrder(),setupLayout(),initSortable()},300)),$scope.$watch(function(){return $attrs.tmpl},function(){$timeout.cancel(),$scope.isDragTemplateLoaded&&$timeout(function(){trackListOrder(),setupLayout(),initSortable()},300)})}}}function assessmentVideoCtrl($scope,$timeout,$rootScope,ngDialog,sharedProperties){function videoPopUp(url){sharedProperties.fireAnalyticsEvent("Assessment | Watch Intro Video","N/A"),sharedProperties.videoPopUp(url)}var _this=this;_this.videoPopUp=videoPopUp}angular.module("spApp").controller("assessmentController",assessmentController);var sortable;assessmentController.$inject=["$scope","ajaxService","$timeout","$rootScope","$localStorage","sharedProperties"],angular.module("spApp").directive("optionSelection",optionSelection),optionSelection.$inject=["$rootScope","$timeout"],angular.module("spApp").directive("dragEnabledTemplate",dragEnabledTemplate),dragEnabledTemplate.$inject=["$rootScope","$timeout"],angular.module("spApp").controller("assessmentVideoCtrl",assessmentVideoCtrl),assessmentVideoCtrl.$inject=["$scope","$timeout","$rootScope","ngDialog","sharedProperties"];
function auditLogController($scope,$q,ajaxService,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage){var self=this;self.auditFilteredList=[],self.masterAuditList=[],self.urls={getAuditHome:"/sp/sysAdmin/audit/getAuditHome",getAllServices:"/sp/sysAdmin/audit/getAllServices"};var d=new Date;self.filterDialog=null,self.allServices=[],self.pageSetting={pageSize:10,intialPageSize:10,filter:{},userEmail:{email:[]},checkBox:[],statusInclude:["online","offline"],userTypeSelected:"",userServiceSelected:"",lastPredicate:"name",lastReverse:!1,loadBtnCLicked:!1,load:!0,textSearching:"",disabledInfinite:!1,onlineC:!0,offlineC:!0,selectedActivity:"",time:"WEEK",maxDate:d.setMonth(d.getMonth()-3)},self.originalpageSetting=angular.copy(self.pageSetting),self.inviteError=!1,self.auditLog={},self.advanceOn=!1,self.getAuditHomeData=function(){ajaxService.getAjaxResponse({url:self.urls.getAuditHome}).then(function(response){self.masterAuditList=response.auditLogHome,self.auditFilteredList=angular.copy(self.masterAuditList),self.getAuditFilteredList(self.pageSetting.pageSize)})},self.advancedFilterDialog=function(){self.filterDialog=ngDialog.open({template:"/sp/sysAdmin/audit/advancedFilterPopup",scope:$scope})},self.advanceSearch=function(fromDate,endDate){if(self.inviteError=!1,self.auditLog.$valid){var month=(1+fromDate.getMonth()).toString();month=month.length>1?month:"0"+month;var day=(1+fromDate.getDate()).toString();day=day.length>1?day:"0"+day;var fromDateFormatted=month+"/"+day+"/"+fromDate.getUTCFullYear(),endmonth=(1+endDate.getMonth()).toString(),endday=(1+endDate.getDate()).toString();endday=endday.length>1?endday:"0"+endday,endmonth=endmonth.length>1?endmonth:"0"+endmonth;var endDateFormatted=endmonth+"/"+endday+"/"+endDate.getUTCFullYear();ajaxService.getAjaxResponse({url:self.urls.getAuditHome,data:$.param({fromDate:fromDateFormatted,endDate:endDateFormatted})}).then(function(response){self.advanceOn=!0,self.masterAuditList=response.auditLogHome,self.auditFilteredList=angular.copy(self.masterAuditList),self.getAuditFilteredList(self.pageSetting.pageSize),self.filterDialog.close()})}else self.inviteError=!0},self.getAllServices=function(){ajaxService.getAjaxResponse({url:self.urls.getAllServices}).then(function(response){self.allServices=response.services})},self.resetfilter=function(){self.pageSetting=angular.copy(self.originalpageSetting),self.searchText="",self.advanceOn?self.getAuditHomeData():self.getAuditFilteredList(self.pageSetting.pageSize),self.advanceOn=!1},self.filterByService=function(status){self.getAuditFilteredList(self.pageSetting.pageSize)},self.includeCheck=function(status){self.getAuditFilteredList(self.pageSetting.pageSize)},self.infiniteScroll=function(arg){self.pageSetting.loadBtnCLicked=!0,self.getAuditFilteredList(arg)},self.searchTextFilter=function(search){self.pageSetting.textSearching=search},self.clearSearch=function(){self.pageSetting.textSearching.length&&(self.pageSetting.textSearching="",self.searchText="")},self.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},self.getAuditFilteredList=function(pageSize){if(!self.masterAuditList.length)return!0;var result=self.masterAuditList;self.auditFilteredList=result.filter(function(e){var userTypeFlag=null!=self.pageSetting.userTypeSelected&&self.pageSetting.userTypeSelected===e.accountType||""===self.pageSetting.userTypeSelected&&e.accountType,activityFlag=null!=self.pageSetting.selectedActivity&&self.pageSetting.selectedActivity===e.activityType||""===self.pageSetting.selectedActivity&&e.activityType,serviceFlag=null!=self.pageSetting.userServiceSelected&&$.inArray(self.pageSetting.userServiceSelected,e.serviceType)>-1||""===self.pageSetting.userServiceSelected&&e.serviceType,onlineFlag=self.pageSetting.onlineC===e.online,offlineFlag=self.pageSetting.offlineC===e.offline,timeFilterFlag=!1;return $.inArray(self.pageSetting.time,e.timeFilters)>-1&&(timeFilterFlag=!0),userTypeFlag&&activityFlag&&serviceFlag&&(onlineFlag||offlineFlag)&&timeFilterFlag}),console.log("Search "+self.auditFilteredList.length),self.pageSetting.pageSize=pageSize,pageSize>=self.masterAuditList.length&&(self.pageSetting.disabledInfinite=!0,self.pageSetting.pageSize=self.masterAuditList.length),self.pageSetting.load&&(self.pageSetting.lastPredicate="name",self.pageSetting.lastReverse=!1,self.pageSetting.loadBtnCLicked=!1,self.pageSetting.load=!1)}}function auditLogDetailController($scope,$q,ajaxService,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage){var self=this;self.auditFilteredList=[],self.masterAuditList=[],self.userDetail=null,self.urls={getAuditDetail:"/sp/sysAdmin/audit/getAuditDetail",getAllServices:"/sp/sysAdmin/audit/getAllServices"};var d=new Date;self.allServices=[],self.pageSetting={pageSize:10,intialPageSize:10,filter:{},userEmail:{email:[]},checkBox:[],statusInclude:["online","offline"],userTypeSelected:"",userServiceSelected:"",lastPredicate:"name",lastReverse:!1,loadBtnCLicked:!1,load:!0,textSearching:"",disabledInfinite:!1,onlineC:!0,offlineC:!0,time:"WEEK",maxDate:d.setMonth(d.getMonth()-3)},self.originalpageSetting=angular.copy(self.pageSetting),self.getAuditDetailData=function(){ajaxService.getAjaxResponse({url:self.urls.getAuditDetail,data:$.param({email:sharedProperties.getParam("email")})}).then(function(response){self.masterAuditList=response.auditDetails,self.userDetail=response.userDetails,self.auditFilteredList=angular.copy(self.masterAuditList)})},self.resetfilter=function(){self.pageSetting=angular.copy(self.originalpageSetting),self.getAuditFilteredList(self.pageSetting.pageSize)},self.getAllServices=function(){ajaxService.getAjaxResponse({url:self.urls.getAllServices}).then(function(response){self.allServices=response.services})},self.advancedFilterDialog=function(){self.filterDialog=ngDialog.open({template:"/sp/sysAdmin/audit/advancedFilterPopup",scope:$scope})},self.advanceSearch=function(fromDate,endDate){var month=(1+fromDate.getMonth()).toString();month=month.length>1?month:"0"+month;var day=(1+fromDate.getDate()).toString();day=day.length>1?day:"0"+day;var fromDateFormatted=month+"/"+day+"/"+fromDate.getUTCFullYear(),endmonth=(1+endDate.getMonth()).toString(),endday=(1+endDate.getDate()).toString();endday=endday.length>1?endday:"0"+endday,endmonth=endmonth.length>1?endmonth:"0"+endmonth;var endDateFormatted=endmonth+"/"+endday+"/"+endDate.getUTCFullYear();ajaxService.getAjaxResponse({url:self.urls.getAuditDetail,data:$.param({email:sharedProperties.getParam("email"),fromDate:fromDateFormatted,endDate:endDateFormatted})}).then(function(response){self.masterAuditList=response.auditDetails,self.userDetail=response.userDetails,self.auditFilteredList=angular.copy(self.masterAuditList),self.filterDialog.close()})},self.searchTextFilter=function(search){self.pageSetting.textSearching=search},self.clearSearch=function(){self.pageSetting.textSearching.length&&(self.pageSetting.textSearching="",self.searchText="")},self.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},self.filterByService=function(status){self.getAuditFilteredList(self.pageSetting.pageSize)},self.includeCheck=function(status){self.getAuditFilteredList(self.pageSetting.pageSize)},self.infiniteScroll=function(arg){self.pageSetting.loadBtnCLicked=!0,self.getAuditFilteredList(arg)},self.getAuditFilteredList=function(pageSize){if(!self.masterAuditList.length)return!0;var result=self.masterAuditList;self.auditFilteredList=result.filter(function(e){var serviceFlag=null!=self.pageSetting.userServiceSelected&&self.pageSetting.userServiceSelected===e.serviceType||""===self.pageSetting.userServiceSelected&&e.serviceType,timeFilterFlag=!1;return $.inArray(self.pageSetting.time,e.timeFilter)>-1&&(timeFilterFlag=!0),serviceFlag&&timeFilterFlag}),console.log("Search "+self.auditFilteredList.length),self.pageSetting.pageSize=pageSize,pageSize>=self.masterAuditList.length&&(self.pageSetting.disabledInfinite=!0,self.pageSetting.pageSize=self.masterAuditList.length),self.pageSetting.load&&(self.pageSetting.lastPredicate="name",self.pageSetting.lastReverse=!1,self.pageSetting.loadBtnCLicked=!1,self.pageSetting.load=!1)}}angular.module("spApp").controller("auditLogListController",auditLogController),angular.module("spApp").controller("auditLogDetailController",auditLogDetailController),auditLogController.$inject=["$scope","$q","ajaxService","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage"],auditLogDetailController.$inject=["$scope","$q","ajaxService","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage"];
function blueprintAdminController($scope,ajaxService,$localStorage,ngDialog,sharedProperties,filterFilter,$filter,$rootScope,$timeout){function getAllCompaniesWithBlueprintSettings(){ajaxService.getAjaxResponse({url:self.serviceApis.getAll,method:"POST"}).then(function(response){if("true"===response.Success)self.responseAvailable=!0,self.masterList=response.blueprintCompanyList,self.companyList=angular.copy(self.masterList);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function openSelectCompanyModal(type,id){self.createBlueprintMode=type,self.clonedCompanyId=id;var dialog=ngDialog.open({template:self.serviceApis.openCompanyModal,scope:$scope});dialog.closePromise.then(function(data){self.companySearchText=""})}function getAllCompaniesWithBlueprintEnabled(type,id){ajaxService.getAjaxResponse({url:self.serviceApis.getCompanies,method:"POST"}).then(function(response){if("true"===response.Success)self.blueprintCompanies=response.companies,openSelectCompanyModal(type,id),self.responseAvailableForModal=!0;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function selectCompany(type,id){self.blueprintCompanies.length?openSelectCompanyModal(type,id):getAllCompaniesWithBlueprintEnabled(type,id)}function toggleContentDisplay(event,mode){var $this=$(event.target);if($this.hasClass("filterCheckBox-label"))return!0;var toggleClass=void 0===mode?"show":"noshow",toggleExpandClass=void 0===mode?"expand-section":"",$html=$this.closest(".category"),$upTarget=$html.find(".header-style-content:eq(0)"),$upTargetHeight=$upTarget.outerHeight();$html.find(".border-faq-content:eq(0)").outerHeight();$upTargetHeight>1?($upTarget.css("height",0),$upTarget.removeClass("expand-section")):($upTarget.css("height","auto"),$upTarget.addClass("expand-section")),$html.toggleClass(toggleClass),$html.toggleClass(toggleExpandClass)}function getBluePrintData(){var param=getParameter("id");null===param&&($localStorage.remove("blueprintClone"),param="default"),self.selectedCompanyId=param,ajaxService.getAjaxResponse({url:self.serviceApis.getDetails,data:$.param({companyId:null!==$localStorage.get("blueprintClone")?$localStorage.get("blueprintClone").id:param}),method:"POST"}).then(function(response){if("true"===response.Success)self.dataMap=response.blueprintSettings.dataMap,self.companyInfo=response.blueprintSettings.companyDTO,null!==$localStorage.get("blueprintClone")?self.companyDisplayName=$localStorage.get("blueprintClone").name:"default"!==param&&(self.companyDisplayName=self.companyInfo.name),$localStorage.remove("blueprintClone");else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function updateBlueprintSettings(){self.blueprintForm.submitted=!1,self.blueprintForm.$valid?(self.blueprintData.companyId=self.selectedCompanyId,self.blueprintData.dataMap=self.dataMap,ajaxService.getAjaxResponse({url:self.serviceApis.createOrUpdate,data:self.blueprintData,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.blueprint.update.message")}),$timeout(function(){window.location.href="/sp/sysAdmin/blueprint/home"},500);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})):(self.blueprintForm.submitted=!0,!self.blueprintForm.blueprintOverviewText.$error.required&&self.blueprintForm.blueprintLinkUrl.$valid&&self.blueprintForm.blueprintThumbImageUrl.$valid||(self.isBlueprintDataValid=!1),(self.blueprintForm.missionTitle.$error.required||self.blueprintForm.missionOverviewText.$error.required||!self.blueprintForm.missionLinkUrl.$valid)&&(self.isMissionDataValid=!1),(self.blueprintForm.objectiveTitle.$error.required||self.blueprintForm.objectiveOverviewText.$error.required||!self.blueprintForm.objectiveLinkUrl.$valid)&&(self.isObjectiveDataValid=!1),(self.blueprintForm.initiativesTitle.$error.required||self.blueprintForm.initiativesOverviewText.$error.required||!self.blueprintForm.initiativesLinkUrl.$valid)&&(self.isInitiativesDataValid=!1),(self.blueprintForm.csmTitle.$error.required||self.blueprintForm.csmOverviewText.$error.required||!self.blueprintForm.csmLinkUrl.$valid)&&(self.isCsmDataValid=!1))}function deleteBlueprintModal(deleteId){$scope.deleteId=deleteId,ngDialog.open({template:"/sp/resources/html/sysAdmin/blueprint/delete-blueprint-modal.html",scope:$scope})}function deleteBlueprint(id){ajaxService.getAjaxResponse({url:self.serviceApis["delete"],data:$.param({companyId:id})}).then(function(response){if("true"===response.Success)location.reload();else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function resetResults(){self.searchText="",self.companyList=[],self.companyList=angular.copy(self.masterList),sortResults()}function active(event,setting){self.lastPredicate=setting.predicate,self.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.lastPredicate),self.sortResults(self.lastPredicate,self.lastReverse)}function sortResults(predicate,reverse){self.lastPredicate=predicate,self.lastReverse=reverse;var resp=$filter("orderBy")(self.masterList,predicate,reverse);self.companyList=[],self.companyList=resp}function redirectToUpdate(id,name){if("clone"===self.createBlueprintMode){var bluePrintCloneData={};bluePrintCloneData.id=self.clonedCompanyId,bluePrintCloneData.name=name,$localStorage.set("blueprintClone",bluePrintCloneData)}else $localStorage.remove("blueprintClone");window.location.href="/sp/sysAdmin/blueprint/update?id="+id}function optionsChange(type){switch(type){case"blueprint":self.dataMap.blueprint.linkText="",self.dataMap.blueprint.linkUrl="",self.dataMap.blueprint.thumbImageUrl="",self.dataMap.blueprint.imageAltText="";break;case"mission":self.dataMap.mission.linkText="",self.dataMap.mission.linkUrl="";break;case"objectives":self.dataMap.objective.linkText="",self.dataMap.objective.linkUrl="";break;case"initiatives":self.dataMap.initiatives.linkText="",self.dataMap.initiatives.linkUrl="";break;case"csm":self.dataMap.csm.linkText="",self.dataMap.csm.linkUrl=""}}function validateMinAndMax(evt,obj){evt||window.event;(void 0!==obj.minObjectives&&void 0===obj.maxObjectives||obj.minObjectives>=obj.maxObjectives)&&(obj.maxObjectives=obj.minObjectives),(void 0!==obj.minInitiatives&&void 0===obj.maxInitiatives||obj.minInitiatives>=obj.maxInitiatives)&&(obj.maxInitiatives=obj.minInitiatives),(void 0!==obj.minCsm&&void 0===obj.maxCsm||obj.minCsm>=obj.maxCsm)&&(obj.maxCsm=obj.minCsm),void 0===obj.maxObjectives||null===obj.maxObjectives||void 0!==obj.minObjectives&&null!==obj.minObjectives||(obj.minObjectives=1),void 0===obj.maxInitiatives||null===obj.maxInitiatives||void 0!==obj.minInitiatives&&null!==obj.minInitiatives||(obj.minInitiatives=1),void 0===obj.maxCsm||null===obj.maxCsm||void 0!==obj.minCsm&&null!==obj.minCsm||(obj.minCsm=1)}function isNumeric(evt){var theEvent=evt||window.event,key=theEvent.keyCode||theEvent.which,regex=/^\d+$/;key=String.fromCharCode(key),theEvent.returnValue=!0,regex.test(key)||(theEvent.returnValue=!1,theEvent.preventDefault&&theEvent.preventDefault());var input=theEvent.currentTarget.value;return-1!==input.search(/^0/)&&(theEvent.returnValue=!1,theEvent.preventDefault&&theEvent.preventDefault()),theEvent.returnValue}var self=this;self.serviceApis={getAll:"/sp/sysAdmin/blueprint/getAll",createOrUpdate:"/sp/sysAdmin/blueprint/createOrUpdate",getDetails:"/sp/sysAdmin/blueprint/getDetails","delete":"/sp/sysAdmin/blueprint/delete",getCompanies:"/sp/sysAdmin/blueprint/getCompanies",openCompanyModal:"/sp/sysAdmin/blueprint/selectCompany"},self.responseAvailable=!1,self.responseAvailableForModal=!1,self.companySearchText="",self.searchText="",self.masterList=[],self.companyList=[],self.blueprintCompanies=[],self.blueprintData={},self.dataMap={},self.selectedCompanyId="default",self.lastPredicate="name",self.lastReverse=!1,self.companyInfo={},self.createBlueprintMode="",self.clonedCompanyId="",self.companyDisplayName="",self.isBlueprintDataValid=!0,self.isMissionDataValid=!0,self.isObjectiveDataValid=!0,self.isInitiativesDataValid=!0,self.isCsmDataValid=!0,self.selectCompany=selectCompany,self.toggleContentDisplay=toggleContentDisplay,self.updateBlueprintSettings=updateBlueprintSettings,self.getAllCompaniesWithBlueprintSettings=getAllCompaniesWithBlueprintSettings,self.getBluePrintData=getBluePrintData,self.active=active,self.sortResults=sortResults,self.resetResults=resetResults,self.deleteBlueprint=deleteBlueprint,self.deleteBlueprintModal=deleteBlueprintModal,self.redirectToUpdate=redirectToUpdate,self.optionsChange=optionsChange,self.validateMinAndMax=validateMinAndMax,self.isNumeric=isNumeric,self.openMediaManager=function(obj){sharedProperties.openMediaModal();var destroyRoot=$scope.$on("mediaData",function(e,data){return destroyRoot(),null===data?!0:void("VIDEO"===obj.linkType?(obj.thumbImageUrl=data.url,obj.imageAltText=data.altText,obj.linkText=data.name):(obj.linkUrl=data.url,obj.linkText=data.name,obj.thumbImageUrl="",obj.imageAltText=""))})};var getParameter=function(val){for(var query=window.location.search.substring(1),vars=query.split("&"),pair=[],i=0;i<vars.length;i++)return pair=vars[i].split("="),pair[0]===val?pair[1]:null}}angular.module("spApp").controller("blueprintAdminController",blueprintAdminController),blueprintAdminController.$inject=["$scope","ajaxService","$localStorage","ngDialog","sharedProperties","filterFilter","$filter","$rootScope","$timeout"];
function bluePrintController($scope,ajaxService,$localStorage,$state,sharedProperties,$q,$filter,$rootScope,ngDialog,$timeout,notesAndFeedbackMethod){function openState(number,text){vm.winWidth>767?(vm.devStrategy.id="",vm.state(number)):(vm.devStrategy.id="",vm.openNgOverlay(text))}function openNgOverlay(page,data){"undefined"!=typeof data&&(vm.devStrategy={id:"",desc:data.desc}),vm.currentActive.goalId=vm.blueprint.id,"notification"===page&&(vm.openTabId=-1,vm.searchText="",vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails(Object.keys(vm.allNotesFeedbackData)[0]))),"note"===page&&(vm.noteTextArea="",vm.postANote={submitted:!1},vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId,indexName:"NOTE",mode:"addNote"},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails("NOTE"),vm.factories.sortList(vm))),"feedback"===page&&(!vm.emailMemberList.length&&vm.getMemberList(),vm.requestFeedbackArea="",vm.inputRequired=!1,vm.searchTag=[],vm.searchTagEmail=[],vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.blueprint.id,indexName:"FEEDBACK",mode:"requestFeedback"},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails("FEEDBACK"),vm.factories.sortList(vm))),vm.winHeight=$(window).height()+100+"px";ngDialog.open({template:vm.pageTempaltes[page],className:"ngdialog-lnd-theme",scope:$scope})}function editModeCheck(obj,togglekey,index,scrollToOpt){vm.editModeEnabled&&(void 0===index?obj[togglekey]=!obj[togglekey]:obj[togglekey][index].value=!obj[togglekey][index].value,vm.editModeEnabled=!1),void 0!==scrollToOpt&&$timeout(function(){$("html,body").animate({scrollTop:$("#"+scrollToOpt.id+"_"+scrollToOpt.index+"_"+scrollToOpt.child).offset().top-80},300)},200)}function viewDirect(count){switch(count=void 0===count?"EDIT":count){case"EDIT":"user"===vm.mode?$state.go("create"):$state.go("createAdmin");break;case"UNDER_APPROVAL":case"APPROVED":$state.go("approvalRequest");break;case"PUBLISHED":$state.go("publish")}vm.createScreenReady=!0}function getBluePrint(mode){vm.mode=mode,ajaxService.getAjaxResponse({url:vm.config.getBluePrint,data:$.param({memberEmail:$rootScope.noSelf})}).then(function(response){if("true"===response.Success)void 0!==response.blueprintSettings?(vm.bluePrintSetting=response.blueprintSettings,vm.dataMap=vm.bluePrintSetting.dataMap,$localStorage.set("bluePrintSetting",vm.bluePrintSetting),vm.viewDirect(vm.blueprint.status)):createDevloop(response),$(".lnd-left-sec").stick_in_parent();else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function createDevloop(response){vm.blueprint=response.blueprint,vm.saveObject=angular.copy(vm.blueprint),vm.getBluePrintSetting()}function addObjective(devStrategy,scrollToOpt){return!angular.isArray(devStrategy.devStrategyActionCategoryList)&&(devStrategy.devStrategyActionCategoryList=[]),vm.bluePrintSetting.maxObjectives<=devStrategy.devStrategyActionCategoryList.length||!vm.editModeEnabled?!1:(devStrategy.devStrategyActionCategoryList.push({title:null}),void 0!==scrollToOpt&&$timeout(function(){$("html,body").animate({scrollTop:$("#"+scrollToOpt.id+"_"+scrollToOpt.index).offset().top-80},300),$(".lnd-left-sec").stick_in_parent()},200),void(vm.editModeEnabled=!1))}function addKeyInitiative(devStrategy,scrollToOpt,toggle){return!angular.isArray(devStrategy.actionList)&&(devStrategy.actionList=[]),vm.bluePrintSetting.maxInitiatives<=devStrategy.actionList.length?!1:(devStrategy.actionList.push({title:null,actionData:[{title:null}]}),vm.editModeEnabled=!1,void 0!==toggle&&(toggle.value=!toggle.value),void(void 0!==scrollToOpt&&$timeout(function(){$("html,body").animate({scrollTop:$("#"+scrollToOpt.id+"_"+scrollToOpt.index+"_"+scrollToOpt.child).offset().top-80},300),$(".lnd-left-sec").stick_in_parent()},200)))}function addCriticalSuccessMeasure(actionList,scrollToOpt,toggle){return!angular.isArray(actionList.actionData)&&(actionList.actionData=[]),vm.bluePrintSetting.maxSuccessMeasures<=actionList.actionData.length?!1:(actionList.actionData.push({title:null}),vm.editModeEnabled=!1,void 0!==toggle&&(toggle.value=!toggle.value),void(void 0!==scrollToOpt&&$timeout(function(){$("html,body").animate({scrollTop:$("#"+scrollToOpt.id+"_"+scrollToOpt.parent+"_"+scrollToOpt.index+"_"+scrollToOpt.child).offset().top-80},300),$(".lnd-left-sec").stick_in_parent()},200)))}function getBluePrintSetting(){var settings=$localStorage.get("bluePrintSetting");null!==settings?(vm.bluePrintSetting=settings,vm.dataMap=vm.bluePrintSetting.dataMap,vm.viewDirect(vm.blueprint.status)):ajaxService.getAjaxResponse({url:vm.config.bluePrintSetting}).then(function(response){if("true"===response.Success)vm.bluePrintSetting=response.blueprintSettings,vm.dataMap=vm.bluePrintSetting.dataMap,$localStorage.set("bluePrintSetting",vm.bluePrintSetting),vm.viewDirect(vm.blueprint.status);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function revertToPreviousState(){vm.blueprint=angular.copy(vm.saveObject),vm.bluePrintform.submitted=!1,$("html,body").animate({scrollTop:$(".lnd-right-sec").offset().top-20},300)}function assignKeyWord(option1){option1.key1 in option1.obj1?option1.obj1[option1.key1][option1.index1]={value:option1.value}:(option1.obj1[option1.key1]=[],option1.obj1[option1.key1][option1.index1]={value:option1.value})}function deleteModel(){switch(vm.deleteList.push(vm.saveDeleteOption["delete"][vm.saveDeleteOption.index].uid),vm.saveDeleteOption.key){case"objective":vm.saveDeleteOption.obj[vm.saveDeleteOption.key].splice(vm.saveDeleteOption.index,1),vm.saveDeleteOption["delete"].splice(vm.saveDeleteOption.index,1),null!==vm.saveObject.devStrategyActionCategoryList&&vm.saveAndUpdate();break;case"initiative":vm.saveDeleteOption.obj[vm.saveDeleteOption.key].splice(vm.saveDeleteOption.index,1),vm.saveDeleteOption["delete"].splice(vm.saveDeleteOption.index,1);break;case"csm":vm.saveDeleteOption["delete"].splice(vm.saveDeleteOption.index,1)}vm.editModeEnabled=!0,vm.saveDeleteOption=null,ngDialog.close("ngdialog1")}function deleteEmptyObjective(options){vm.saveDeleteOption=options,vm.bluePrintform.submitted=!1,vm.deleteModel()}function deleteObjective(options){vm.saveDeleteOption=options;var dialog=ngDialog.open({template:"/sp/resources/html/blueprint/delete-modal.html",scope:$scope});dialog.closePromise.then(function(data){vm.saveDeleteOption=null,vm.editModeEnabled=!0})}function saveAndUpdate(toggle,togglekey,index){vm.bluePrintform.submitted=!1,vm.bluePrintform.$valid?(vm.blueprintRequest={},vm.blueprintRequest.missionStatement=vm.blueprint.missionStatement,void 0!==vm.blueprintRequest.missionStatement.commentsList&&delete vm.blueprintRequest.missionStatement.commentsList,vm.blueprintRequest.devStrategyActionCategoryList=vm.blueprint.devStrategyActionCategoryList,angular.isArray(vm.blueprintRequest.devStrategyActionCategoryList)&&vm.blueprintRequest.devStrategyActionCategoryList.filter(function(e){void 0!==e.commentsList&&delete e.commentsList,angular.isArray(e.actionList)&&e.actionList.filter(function(e1){void 0!==e1.commentsList&&delete e1.commentsList})}),vm.blueprintRequest.deleteList=vm.deleteList,ajaxService.getAjaxResponse({url:vm.config.createUpdate,data:vm.blueprintRequest,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)void 0!==toggle&&(void 0===index?toggle[togglekey]=!0:toggle[togglekey][index].value=!0),vm.editModeEnabled=!0,vm.blueprint=response.blueprint,vm.saveObject=angular.copy(vm.blueprint),vm.deleteList=[],$("html,body").animate({scrollTop:$(".lnd-right-sec").offset().top-20},300),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("blueprint.updated")}),sharedProperties.fireAnalyticsEvent("Blueprint | Save or Update Information","N/A");else if(null!==response.error){vm.blueprint=angular.copy(vm.saveObject),vm.editModeEnabled=!0;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})):vm.bluePrintform.submitted=!0}function getMemberList(state,publish){ajaxService.getAjaxResponse({url:vm.config.allUsers}).then(function(response){if("true"===response.Success){if(vm.emailMemberList=response.allMembers,null!==$localStorage.get("loggegdInProfile"))for(var i=0;i<vm.emailMemberList.length;i++)if(vm.emailMemberList[i].email===$localStorage.get("loggegdInProfile").member.email){vm.emailMemberList.splice(i,1);break}void 0!==state&&(void 0!==publish?shareApprovalModal(state):publishShareModal(state))}else{var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function loadTags(query){var deferred=$q.defer(),result=vm.emailMemberList.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise}function tagAdded(tag){void 0!==tag&&(vm.searchTag.push(tag.email),vm.searchTagEmail.push(tag),vm.inputRequired=!1)}function tagRemoved(tag){vm.searchTag.splice(vm.searchTag.indexOf(tag.email),1),vm.searchTagEmail.splice(vm.searchTagEmail.indexOf(tag),1)}function callshareApproval(state){vm.inputRequired=!1,vm.emailMemberList.length?shareApprovalModal(state):vm.getMemberList(state,"publish")}function shareApprovalModal(state){vm.winHeight=$(window).height()+100+"px";var templateUrl=$(window).width()<768?"/sp/resources/html/blueprint/shareApproval_mobile.html":"/sp/resources/html/blueprint/shareApproval.html";vm.approvalState=state;var shareDialog=ngDialog.open({template:templateUrl,scope:$scope,className:$(window).width()<768?"ngdialog-lnd-theme":"ngdialog-theme-default"});shareDialog.closePromise.then(function(data){vm.searchTag=[],vm.searchTagEmail=[],vm.shareApproval.comment=null})}function shareApprovalFn(){if(vm.shareApproval.submitted=!1,void 0===vm.searchTagEmail[0])return void(vm.inputRequired=!0);if(vm.shareApprovalForm.$valid){var obj={};obj=void 0!==vm.searchTagEmail[0].id?{userIdList:[vm.searchTagEmail[0].id],approvalRequest:vm.approvalState,comment:vm.shareApproval.comment,showProgress:!1}:{externalUserList:[{firstName:vm.searchTagEmail[0].firstName,lastName:vm.searchTagEmail[0].lastName,email:vm.searchTagEmail[0].email}],approvalRequest:vm.approvalState,comment:vm.shareApproval.comment,showProgress:!1},ajaxService.getAjaxResponse({url:vm.config.shareBluePrint,data:obj,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:vm.approvalState?$rootScope.pullInterNationalization("blueprint.requestforapproval"):$rootScope.pullInterNationalization("blueprint.shareforreview")}),vm.approvalState?sharedProperties.fireAnalyticsEvent("Blueprint | Request for Approval","N/A"):sharedProperties.fireAnalyticsEvent("Blueprint | Send for Review Feedback","N/A"),vm.approvalState&&$timeout(function(){window.location.reload()},1e3);else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}else vm.shareApproval.submitted=!0}function sendReminder(){ajaxService.getAjaxResponse({url:vm.config.sendReminder}).then(function(response){if("true"===response.Success)$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("blueprint.remindersent")}),sharedProperties.fireAnalyticsEvent("Blueprint | Send Reminder","N/A");else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function carModal(){vm.winHeight=$(window).height()+100+"px";var templateUrl=$(window).width()<768?"/sp/resources/html/blueprint/car_mobile.html":"/sp/resources/html/blueprint/car.html",carDialog=ngDialog.open({template:templateUrl,scope:$scope,className:$(window).width()<768?"ngdialog-lnd-theme":"ngdialog-theme-default"});carDialog.closePromise.then(function(data){vm.cancelApproval.carComment=null})}function car(comment){vm.cancelApproval.submitted=!1,vm.cancelApprovalForm.$valid?ajaxService.getAjaxResponse({url:vm.config.car,data:$.param({comment:vm.cancelApproval.carComment})}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("blueprint.cancelApprovalMessage")}),sharedProperties.fireAnalyticsEvent("Blueprint | Cancel Approval Request","N/A"),$timeout(function(){window.location.reload()},1e3);else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}}):vm.cancelApproval.submitted=!0}function getShareDetails(){ajaxService.getAjaxResponse({url:vm.config.shareBlueprint}).then(function(response){if("true"===response.Success)vm.blueprint=response.blueprint,vm.saveObject=angular.copy(vm.blueprint),vm.blueprintMember=response.member,vm.fullResponse=response,vm.createScreenReady=!0,vm.dataMap=response.blueprintSettings.dataMap;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function saveShareResponse(copy,from){copy=angular.copy(from)}function submitComments(approved,feedback){vm.shareCommentList.approved=approved,vm.shareCommentList.feedbackUserId=vm.fullResponse.feedbackUserId,vm.shareCommentList.id=vm.blueprint.id,null!==vm.blueprint.missionStatement.commentsList&&vm.blueprint.missionStatement.commentsList.length&&(vm.shareCommentList.commentsMap[vm.blueprint.missionStatement.uid]=angular.isArray(vm.blueprint.missionStatement.commentsList)?vm.blueprint.missionStatement.commentsList[0].comment:vm.blueprint.missionStatement.commentsList),angular.isArray(vm.blueprint.devStrategyActionCategoryList)&&vm.blueprint.devStrategyActionCategoryList.filter(function(e){null!==e.commentsList&&e.commentsList.length&&(vm.shareCommentList.commentsMap[e.uid]=angular.isArray(e.commentsList)?e.commentsList[0].comment:e.commentsList),angular.isArray(e.actionList)&&e.actionList.filter(function(e1){null!==e1.commentsList&&e1.commentsList.length&&(vm.shareCommentList.commentsMap[e1.uid]=angular.isArray(e1.commentsList)?e1.commentsList[0].comment:e1.commentsList)})}),ajaxService.getAjaxResponse({url:vm.config.shareResponse,data:vm.shareCommentList,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)sharedProperties.fireAnalyticsEvent(approved?"Blueprint | Approved":feedback?"Blueprint | Shared":"Blueprint | Requested to revise","N/A"),window.location.href=approved?"/sp/processToken/blueprint/thankYouApproval":feedback?"/sp/processToken/blueprint/thankYouShare":"/sp/processToken/blueprint/thankYouRevise";else if(null!==response.error){vm.shareCommentList={commentsMap:{}};var errorMessage="";for(var key in response.error)errorMessage=response.error[key];switch(errorMessage){case"User is required.":window.location.href="/?status=404";break;case"Request has already been submitted.":window.location.href="/?status=blueprintRequestSubmitted";break;default:$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}}})}function deleteComment(option,deleteStatement,index){return""!==$rootScope.noSelf?!1:void ajaxService.getAjaxResponse({url:vm.config.deleteComment,data:$.param({uid:option.uid,by:option.by})}).then(function(response){if("true"===response.Success)sharedProperties.fireAnalyticsEvent("Blueprint | Delete Comment","N/A"),deleteStatement.splice(index,1);else if(null!==response.error){vm.shareCommentList={commentsMap:{}};var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function deleleFeedback(uid,deleteStatement,index){ajaxService.getAjaxResponse({url:vm.config.deleteFeedback,data:$.param({uid:uid})}).then(function(response){if("true"===response.Success)sharedProperties.fireAnalyticsEvent("Blueprint | Delete Feedback","N/A"),deleteStatement.splice(index,1);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function viewfeedbackReceived(){vm.blueprint.newFeedbackReceivedCount&&ajaxService.getAjaxResponse({url:vm.config.viewedFeedback}).then(function(response){if("true"===response.Success)vm.blueprint.newFeedbackReceivedCount=0,sharedProperties.fireAnalyticsEvent("Blueprint | Viewed Feedback","N/A");else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function publishModal(){ngDialog.open({template:"/sp/resources/html/blueprint/publishModal.html",scope:$scope})}function cancelApprovalModal(){ngDialog.open({template:"/sp/resources/html/blueprint/cancelApprovalModal.html",scope:$scope})}function cancelEditModal(){ngDialog.open({template:"/sp/resources/html/blueprint/cancelEditModal.html",scope:$scope})}function cancelPublishModal(){ngDialog.open({template:"/sp/resources/html/blueprint/cancelPublishModal.html",scope:$scope})}function publish(){ajaxService.getAjaxResponse({url:vm.config.publish}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("blueprint.publishMessage")}),sharedProperties.fireAnalyticsEvent("Blueprint | Publish","N/A"),$timeout(function(){window.location.reload()},1e3);else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function cancelEdit(){ajaxService.getAjaxResponse({url:vm.config.cancelEdit}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),sharedProperties.fireAnalyticsEvent("Blueprint | Cancel Reissue","N/A"),$timeout(function(){window.location.reload()},1e3);else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function cancelPublish(){ajaxService.getAjaxResponse({url:vm.config.cancelPublish}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),sharedProperties.fireAnalyticsEvent("Blueprint | Reissue","N/A"),$timeout(function(){window.location.reload()},1e3);else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function cancelApproval(){ajaxService.getAjaxResponse({url:vm.config.cancelApproval}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$timeout(function(){window.location.reload()},1e3);else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function stateControl(list){var result=list.actionData.filter(function(e){return e.permissions.Completion&&!e.completed});return result.length?!0:!1}function changeStatus(option,action){return""!==$rootScope.noSelf?!1:void ajaxService.getAjaxResponse({url:vm.config.completeMeasure,data:$.param({uid:option.uid,isComplete:option.completed})}).then(function(response){if("true"===response.Success)action.completed=option.completed,sharedProperties.fireAnalyticsEvent("Blueprint | Complete a critical success measure",option.completed);else if(null!==response.error){action.completed=!option.completed;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function state(count){switch(vm.currentActive.goalId=vm.blueprint.id,count){case 1:vm.noteTextArea="",vm.postANote.submitted=!1,vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId,indexName:"NOTE",mode:"addNote"},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails("NOTE"),vm.factories.sortList(vm),$state.go("addNote")),sharedProperties.fireAnalyticsEvent("Blueprint | Click Post Note","N/A");break;case 2:!vm.emailMemberList.length&&vm.getMemberList(),vm.requestFeedbackArea="",vm.inputRequired=!1,vm.searchTag=[],vm.requestFeedback.submitted=!1,vm.searchTagGoal=[],vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId,indexName:"FEEDBACK",mode:"requestFeedback"},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails("FEEDBACK"),vm.factories.sortList(vm),$state.go("requestFeedback")),sharedProperties.fireAnalyticsEvent("Blueprint | Click Request Feedback","N/A");break;case 3:vm.searchText="",vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails(Object.keys(vm.allNotesFeedbackData)[0])),$state.go("notesAndFeedback");break;default:vm.devStrategy={id:"",desc:null},$state.go("publish")}}function developmentRedirect(options){vm.devStrategy={id:options.devStrategyId,desc:options.desc},vm.state(options.state)}function updateModel(content){vm.updateNoteObj.submitted=!1,vm.tempModel=content}function deleteActivate(options){ngDialog.closeAll(),"FEEDBACK"===options.type?vm.factories.deleteFeedback(options,vm):"NOTE"===options.type?vm.factories.deleteNote(options,vm):vm.factories.deleteAll(vm)}function deletePop(options){vm.saveDeleteOptions=options;var dialogDeletePop=ngDialog.open({template:vm.config.deleteDialog,scope:$scope});dialogDeletePop.closePromise.then(function(data){vm.saveDeleteOptions=null})}function viewDetails(group){vm.viewDetailsListIndex=group,vm.viewDetailsList=group in vm.allNotesFeedbackData?vm.allNotesFeedbackData[group]:null;var $enableSCroll=$(".overflow-enable");$enableSCroll.length&&$enableSCroll.scrollTop(0)}function viewDetailsIndexChange(i){i===vm.openTabId?vm.openTabId=-1:vm.openTabId=i}function tagAddedGoal(tag){void 0!==tag.email&&(vm.searchTagGoal.push(tag.email),vm.inputRequired=!1)}function tagRemovedGoal(tag){vm.searchTagGoal.splice(vm.searchTagGoal.indexOf(tag.email),1)}function tagAddedPublish(tag){void 0!==tag.email&&(void 0!==tag.id?vm.searchTagPublishShareInternal.push(tag.id):vm.searchTagPublishShareExternal.push({email:tag.email}),vm.inputPublishRequired=!1)}function tagRemovedPublish(tag){void 0!==tag.id?vm.searchTagPublishShareInternal.splice(vm.searchTagPublishShareInternal.indexOf(tag.id),1):sharedProperties.spilceIndexWithBreak(vm.searchTagPublishShareExternal,"email",tag.email)}function callPublishShareModal(state){vm.emailMemberList.length?publishShareModal(state):vm.getMemberList(state)}function publishShareModal(state){vm.winHeight=$(window).height()+100+"px";var templateUrl=$(window).width()<768?"/sp/resources/html/blueprint/publishshareApproval_mobile.html":"/sp/resources/html/blueprint/publishshareApproval.html";vm.approvalState=state,vm.progress=!1;var publishshareDialog=ngDialog.open({template:templateUrl,scope:$scope,className:$(window).width()<768?"ngdialog-lnd-theme":"ngdialog-theme-default"});publishshareDialog.closePromise.then(function(data){vm.approvalState=null,vm.searchTagPublishShareExternal=[],vm.searchTagPublishShareInternal=[],vm.shareApproval.comment=null,vm.inputPublishRequired=!1})}function publishShare(showProgress){if(vm.shareApproval.submitted=!1,0===vm.searchTagPublishShareInternal.length&&0===vm.searchTagPublishShareExternal.length)return void(vm.inputPublishRequired=!0);if(vm.shareApprovalForm.$valid){var obj={};obj={userIdList:vm.searchTagPublishShareInternal,externalUserList:vm.searchTagPublishShareExternal,approvalRequest:vm.approvalState,comment:vm.shareApproval.comment,showProgress:showProgress},ajaxService.getAjaxResponse({url:vm.config.publishShare,data:obj,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:vm.approvalState?$rootScope.pullInterNationalization("blueprint.requestforapproval"):$rootScope.pullInterNationalization("blueprint.shareforreference")}),sharedProperties.fireAnalyticsEvent("Blueprint | Shared","N/A"),vm.approvalState&&$timeout(function(){window.location.reload()},1e3);else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}else vm.shareApproval.submitted=!0}function getPublishShareDetails(){ajaxService.getAjaxResponse({url:vm.config.publishGetShareDetail}).then(function(response){if("true"===response.Success)vm.blueprint=response.blueprint,vm.saveObject=angular.copy(vm.blueprint),vm.blueprintMember=response.member,vm.fullResponse=response,vm.dataMap=response.blueprintSettings.dataMap;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function previewLink(mode,url){if("Video"===mode)sharedProperties.videoPopUp(url);else{var win=window.open(url,"_blank");win.focus()}}var vm=this;vm.config={bluePrintSetting:"/sp/blueprint/getSettings",getBluePrint:"/sp/blueprint/get",createUpdate:"/sp/blueprint/createOrUpdate",shareBluePrint:"/sp/blueprint/share",allUsers:"/sp/allUsers",sendReminder:"/sp/blueprint/sendReminder",car:"/sp/blueprint/cancelApprovalRequest",shareBlueprint:"/sp/blueprint/share/details",shareResponse:"/sp/blueprint/share/response",deleteComment:"/sp/blueprint/deleteComment",viewedFeedback:"/sp/blueprint/viewedFeedbackMessages",publish:"/sp/blueprint/publish",cancelPublish:"/sp/blueprint/cancelPublish",cancelApproval:"/sp/blueprint/cancelApproval",cancelEdit:"/sp/blueprint/cancelEdit",completeMeasure:"/sp/blueprint/completeSuccessMeasure",deleteDialog:"/sp/resources/html/blueprint/deleteNoteDialog.html",publishShare:"/sp/blueprint/publishShare",publishGetShareDetail:"/sp/blueprint/share/getDetails",deleteFeedback:"/sp/blueprint/deleteFeedbackReceived"},vm.bluePrintSetting=null,vm.dataMap=null,vm.deleteList=[],vm.emailMemberList=[],vm.searchTag=[],vm.editObject={},vm.saveObject={},vm.blueprint={},vm.bluePrintform={submitted:!1},vm.shareApproval={submitted:!1,comment:null},vm.cancelApproval={submitted:!1,carComment:null},vm.shareCommentList={commentsMap:{}},vm.editModeEnabled=!0,vm.saveDeleteOption=null,vm.createScreenReady=!1,vm.inputRequired=!1,vm.inputPublishRequired=!1,vm.approvalState=null,vm.mode="user",vm.switchToMobile=parseInt($(window).width())<768?!0:!1,vm.blueprintMember=[],vm.allNotesFeedbackData=[],vm.masterAllNotesFeedbackData=[],vm.viewDetailsList=null,vm.viewDetailsListIndex=-1,vm.updateModel=updateModel,vm.postANote={submitted:!1},vm.feedRequired=!0,vm.requestFeedback={submitted:!1},vm.btnEnable=!0,vm.updateNoteFlag=!1,vm.devStrategy={id:"",desc:null},vm.updateNoteObj={submitted:!1},vm.btnEnable=!0,vm.searchTagGoal=[],vm.searchTagPublishShareInternal=[],vm.searchTagPublishShareExternal=[],vm.searchTagEmail=[],vm.inputRequired=!1,vm.pageSetting={searchText:"",disabledInfinite:!1,lastPredicate:"name",lastReverse:!1},vm.pageType="blueprint",vm.winWidth=$(window).width(),vm.winHeight=$(window).height()+100+"px",vm.currentActive={name:"",goalId:-1},vm.viewDirect=viewDirect,vm.getBluePrint=getBluePrint,vm.getBluePrintSetting=getBluePrintSetting,vm.saveAndUpdate=saveAndUpdate,vm.previewLink=previewLink,vm.addKeyInitiative=addKeyInitiative,vm.addCriticalSuccessMeasure=addCriticalSuccessMeasure,vm.addObjective=addObjective,vm.revertToPreviousState=revertToPreviousState,vm.assignKeyWord=assignKeyWord,vm.editModeCheck=editModeCheck,vm.deleteObjective=deleteObjective,vm.deleteModel=deleteModel,vm.getMemberList=getMemberList,vm.tagRemoved=tagRemoved,vm.loadTags=loadTags,vm.tagAdded=tagAdded,vm.shareApprovalFn=shareApprovalFn,vm.callshareApproval=callshareApproval,vm.sendReminder=sendReminder,vm.carModal=carModal,vm.car=car,vm.submitComments=submitComments,vm.saveShareResponse=saveShareResponse,vm.publishShare=publishShare,vm.callPublishShareModal=callPublishShareModal,vm.getShareDetails=getShareDetails,vm.deleteComment=deleteComment,vm.deleteFeedback=deleleFeedback,vm.viewfeedbackReceived=viewfeedbackReceived,vm.publish=publish,vm.publishModal=publishModal,vm.cancelApprovalModal=cancelApprovalModal,vm.cancelPublish=cancelPublish,vm.cancelPublishModal=cancelPublishModal,vm.cancelApproval=cancelApproval,vm.cancelEdit=cancelEdit,vm.cancelEditModal=cancelEditModal,vm.stateControl=stateControl,vm.changeStatus=changeStatus,vm.state=state,vm.developmentRedirect=developmentRedirect,vm.deleteActivate=deleteActivate,vm.deletePop=deletePop,vm.viewDetails=viewDetails,vm.tagRemovedGoal=tagRemovedGoal,vm.tagAddedGoal=tagAddedGoal,vm.viewDetailsIndexChange=viewDetailsIndexChange,vm.tagAddedPublish=tagAddedPublish,vm.tagRemovedPublish=tagRemovedPublish,vm.getPublishShareDetails=getPublishShareDetails,vm.deleteEmptyObjective=deleteEmptyObjective,vm.factories=notesAndFeedbackMethod,vm.openNgOverlay=openNgOverlay,vm.openTabId,vm.activeToolTipId=-1,vm.openState=openState,vm.pageTempaltes={note:"/sp/resources/html/goals/addNoteResponsive.html",notification:"/sp/resources/html/goals/notesFeedbackOverlayResponsive.html",feedback:"/sp/resources/html/goals/requestFeedbackResponsive.html"}}angular.module("spApp").controller("bluePrintController",bluePrintController),bluePrintController.$inject=["$scope","ajaxService","$localStorage","$state","sharedProperties","$q","$filter","$rootScope","ngDialog","$timeout","notesAndFeedbackMethod"];
function candidateAccountsController($scope,$element,$attrs,$http,ngDialog,$timeout,ajaxService,sharedProperties,$localStorage){function addCreditPop(page){$scope.acPageType=page,$scope.creditInfo={},$scope.creditInfo.cpt=$scope.account.account.paymentInstrument.paymentType,$scope.creditInfo.ccomment=$scope.account.account.paymentInstrument.comment,$scope.serverError=!1,$scope.serverErrorMsg=null,ngDialog.open({template:"/sp/resources/html/admin/account/addcreditspop.html",scope:$scope})}function toggleHiringOverrideField(type){"Candidate"===type?(_this.candidateOverrideCheckbox===!1?(_this.candidateOverrideCheckbox=!0,_this.signup.candidatePrice=_this.editSignup.candidatePrice):(_this.candidateOverrideCheckbox=!1,_this.signup.overrideCandidateAmount=""),_this.updateHiringAccountSummary("Candidate")):"Bundle"===type?(_this.bundleOverrideCheckbox===!1?(_this.bundleOverrideCheckbox=!0,_this.signup.bundlePrice=_this.editSignup.candidatePrice*_this.hiringBundle):(_this.byndleOverrideCheckbox=!1,_this.signup.overrideBundleAmount=""),_this.updateHiringAccountSummary("Bundle")):(_this.hiringAdminOverrideCheckbox===!1?(_this.hiringAdminOverrideCheckbox=!0,_this.signup.hiringAdminPrice=_this.editSignup.hiringAdminPrice):(_this.hiringAdminOverrideCheckbox=!1,_this.signup.overrideHiringAdminAmount=""),_this.updateHiringAccountSummary("Admin"))}function updateHiringAccountSummary(type){"Candidate"===type?_this.candidateOverrideCheckbox?(_this.signup.candidateTotalAmount=_this.signup.overrideCandidateAmount,_this.updateTotalPerMonth()):(_this.signup.candidateTotalAmount=parseInt(_this.signup.candidateCount)*parseFloat(_this.signup.candidatePrice),_this.updateTotalPerMonth()):"Bundle"===type?_this.bundleOverrideCheckbox?(_this.signup.bundleTotalAmount=_this.signup.overrideBundleAmount,_this.updateTotalPerMonth()):(_this.signup.bundleTotalAmount=parseInt(_this.signup.bundleCount)*parseFloat(_this.signup.bundlePrice),_this.updateTotalPerMonth()):_this.hiringAdminOverrideCheckbox?(_this.signup.hiringAdminTotalAmount=_this.signup.overrideHiringAdminAmount,_this.updateTotalPerMonth()):(_this.signup.hiringAdminTotalAmount=parseInt(_this.signup.hiringAdminCount)*parseFloat(_this.signup.hiringAdminPrice),_this.updateTotalPerMonth())}function updateTotalPerMonth(){_this.totalChargesPerMonth=0,_this.totalChargesPerMonth+=null!==_this.signup.hiringAdminTotalAmount&&void 0!==_this.signup.hiringAdminTotalAmount&&_this.signup.hiringAdminTotalAmount>0?_this.signup.hiringAdminTotalAmount:0,_this.proRatedPriceUpdater()}function getAccountInfo(isAddCredit){var option="user"===_this.accType?{url:"/sp/admin/account/businessAccountDetails"}:{url:"/sp/sysAdmin/alternateBilling/account/businessAccountDetails",data:$.param({accountId:sharedProperties.getParam("accountId")})};ajaxService.getAjaxResponse(option).then(function(response){if("true"===response.Success)isAddCredit?_this.account.account.creditBalance=response.account.creditBalance:(_this.account=response,$scope.account=response,$scope.creditInfo.cpt=response.account.paymentInstrument.paymentType,$scope.creditInfo.ccomment=response.account.paymentInstrument.comment,_this.bundleOverrideCheckbox=!0,_this.candidateOverrideCheckbox=!0,_this.hiringAdminOverrideCheckbox=!0,_this.signup={},_this.signup={hiringAdminPrice:_this.account.account.spPlans.IntelligentHiring.unitAdminPrice,candidatePrice:_this.account.account.spPlans.IntelligentHiring.unitMemberPrice,bundlePrice:_this.account.account.spPlans.IntelligentHiring.unitMemberPrice*_this.hiringBundle},_this.cycleMultiplier="Custom"!==_this.account.account.accountInfo.planBillingCycleType?parseInt(billingMonths[_this.account.account.accountInfo.planBillingCycleType.toLowerCase().replace("-","")]):parseInt(_this.account.account.accountInfo.planBillingCycle),_this.editSignup=angular.copy(_this.signup));else{_this.serverError=!0;for(var key in response.error)_this.errorMessage=response.error[key]}})}function validateSendResponse(signup){_this.formSubmitted=!1;var _data=$("#accountsBillingStep2 :not(.serialize-ignore)").serialize();if(signup.$valid)_this.formSubmitted=!1,ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addMemberAccounts",data:_data}).then(function(response){"true"===response.Success?(_this.sfailure=!1,$localStorage.set("addCandidates","Candidate(s) added successfully !"),window.location="/sp/sysAdmin/alternateBilling/viewDetailAccount?accountId="+sharedProperties.getParam("accountId")):null!=response.error&&(_this.failure=response.error,_this.sfailure=!0)});else{_this.formSubmitted=!0;var elem=angular.element($element);$(elem).find("form .ng-invalid:first").length&&$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300)}}function cancelRedirect(){window.location="user"===_this.accType?"/sp/admin/account/business":"/sp/sysAdmin/alternateBilling/viewDetailAccount?accountId="+_this.account.account.id}function initAddMemberAccoutns(mode,type){_this.mode=mode,_this.accType=type,_this.getAccountInfo()}function proRatedPriceUpdater(){_this.proRatedFinalPrice=0;var remainigDays=_this.account.account.remainingChargableDays,candidatesTotal=null!==_this.signup.candidateTotalAmount&&void 0!==_this.signup.candidateTotalAmount&&_this.signup.candidateTotalAmount>0?_this.signup.candidateTotalAmount:0,bundlesTotal=null!==_this.signup.bundleTotalAmount&&void 0!==_this.signup.bundleTotalAmount&&_this.signup.bundleTotalAmount>0?_this.signup.bundleTotalAmount:0;_this.proRatedFinalPrice=parseFloat(_this.totalChargesPerMonth/30*remainigDays),_this.proRatedFinalPrice+=candidatesTotal+bundlesTotal,_this.proRatedFinalPrice=Math.round(_this.proRatedFinalPrice)}function hiringPackageChange(type){"Candidates"===_this.hiringPackageType?(_this.candidateOverrideCheckbox=!0,_this.bundleOverrideCheckbox=!0,_this.signup.candidateTotalAmount=0,_this.signup.candidateCount=null,_this.signup.candidatePrice=_this.editSignup.candidatePrice,_this.signup.overrideCandidateAmount=null,_this.updateHiringAccountSummary("Candidate"),_this.updateTotalPerMonth()):(_this.candidateOverrideCheckbox=!0,_this.bundleOverrideCheckbox=!0,_this.signup.bundleTotalAmount=0,_this.signup.bundleCount=null,_this.signup.bundlePrice=_this.editSignup.candidatePrice*_this.hiringBundle,_this.signup.overrideBundleAmount=null,_this.updateHiringAccountSummary("Bundle"),_this.updateTotalPerMonth())}var _this=this,billingMonths={monthly:1,quaterly:3,semiannually:6,anually:12};_this.signup={},_this.account={},_this.editSignup={},$scope.creditInfo={},_this.signup.candidateTotalAmount=0,_this.signup.bundleTotalAmount=0,_this.signup.hiringAdminTotalAmount=0,_this.totalChargesPerMonth=0,_this.hiringBundle=10,_this.proRatedFinalPrice=0,_this.candidateOverrideCheckbox=!1,_this.bundleOverrideCheckbox=!1,_this.hiringAdminOverrideCheckbox=!1,_this.serverError=!1,_this.formSubmitted=!1,_this.signup.intellgentHiring=!0,_this.hiringPackageType="Bundles",_this.toggleHiringOverrideField=toggleHiringOverrideField,_this.updateHiringAccountSummary=updateHiringAccountSummary,_this.updateTotalPerMonth=updateTotalPerMonth,_this.cancelRedirect=cancelRedirect,_this.initAddMemberAccoutns=initAddMemberAccoutns,_this.getAccountInfo=getAccountInfo,_this.validateSendResponse=validateSendResponse,_this.proRatedPriceUpdater=proRatedPriceUpdater,_this.hiringPackageChange=hiringPackageChange,_this.addCreditPop=addCreditPop,$scope.addCredit=function(form){$scope.submitted=!1,this.spSubscribe.$valid&&"0"!==this.amount?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addCredit",data:$.param({accountId:$scope.account.account.id,chargeAmount:$scope.creditInfo.amount,paymentType:$scope.creditInfo.cpt,comment:$scope.creditInfo.ccomment})}).then(function(response){if("true"===response.Success)_this.getAccountInfo(!0),_this.sfailure===!0&&(_this.signup.submitted=!1,_this.sfailure=!1,_this.failure=null),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Amount</strong>",message:" Credited"});else{for(var key in response.error)$scope.errorMessage=response.error[key];$scope.serverError=!0,$scope.serverErrorMsg=$scope.errorMessage}}):$scope.submitted=!0}}angular.module("spApp").controller("candidateAccountsController",candidateAccountsController),candidateAccountsController.$inject=["$scope","$element","$attrs","$http","ngDialog","$timeout","ajaxService","sharedProperties","$localStorage"];
function candidateAdvisorController($scope,$element,$attrs,$http,$timeout,ajaxService,$rootScope,$localStorage,sharedProperties,ngDialog){$scope.selectedCandidate={},$scope.memberMasterList={},$scope.validMemberList=[],$scope.candidateMasterList={},$scope.validCandidateList=[],$scope.selectedMemberDetails={},$scope.candidateProfileDetails={},$scope.memberProfileDetails={},$scope.candidateAdvise={},$scope.memberAdvise={},$scope.candidateAvoidFormatted=[],$scope.resultTabs={},$scope.personalityFlags=[],$scope.cachedAdvisorData=[],$scope.showMemberListingWidget=!1,$scope.memberSelected=!1,$scope.showContent=!1,$scope.resultTabs.leftSelected=0,$scope.resultTabs.rightSelected=0,$scope.mobileControls={},$scope.mobileControls.display=!1,$scope.viewMode={list:!0,chart:!1},$scope.switchToUser1=!0,$scope.cachedUSerEmails=null,$scope.winWidth=jQuery(window).width(),$scope.sResizeFlag=0,$scope.lResizeFlag=0,$scope.prismLabelContent=!1,$scope.prismLabelContent1=!1,$scope.label="",jQuery(window).resize(function(){$scope.winWidth=jQuery(window).width()}),$scope.returnBack=function(){window.history.back()},$scope.labelsReset=function(){jQuery(".outer-labels").find("p").removeClass("active"),$scope.prismLabelContent=!1,$scope.prismLabelContent1=!1,$scope.label=""},$scope.getSelectedCandidateDetails=function(){$scope.selectedCandidateEmailAddress=sharedProperties.getParam("c");var _o={url:"/sp/hiring/getProfileDetails",data:$.param({candidateEmail:$scope.selectedCandidateEmailAddress}).replace(/%40/g,"@")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.selectedCandidate=response.userProfileForm,$scope.selectedCandidate.hiringRoles=response.hiring.hiringRoles,$scope.selectedCandidate.profilePic=response.hiring.smallProfileImage,$scope.selectedCandidate.userInitials=response.hiring.userInitials,$scope.candidateSelected=!0,$scope.winWidth<768&&$timeout(function(){$rootScope.setBoxSizes("#dd-wrap",".dd","full")},300))})},$scope.getAllCandidateDetails=function(){var _o={url:"/sp/hiring/getAllCandidates"};ajaxService.getAjaxResponse(_o).then(function(response){if("true"===response.Success){var counter=0,newList=[];$scope.candidateMasterList=response.hiring,jQuery.each($scope.candidateMasterList,function(i,j){"VALID"===$scope.candidateMasterList[i].userStatus&&(null===$scope.candidateMasterList[i].spUserId?(newList=jQuery.extend({},$scope.candidateMasterList[i],{selectedCandidateFromList:!1}),$scope.validCandidateList.push(newList)):$scope.candidateMasterList[i].profileSettings.hiringAccessAllowed===!0&&(newList=jQuery.extend({},$scope.candidateMasterList[i],{selectedCandidateFromList:!1}),$scope.validCandidateList.push(newList))),counter++}),counter===$scope.candidateMasterList.length&&$.each($scope.validCandidateList,function(i){$scope.validCandidateList[i].email===sharedProperties.getParam("c")&&($scope.validCandidateList[i].selectedCandidateFromList=!0)})}})},$scope.getAllMemberDetails=function(){var _o={url:"/sp/hiring/relationship/getMembers",data:$.param({candidateEmail:sharedProperties.getParam("c")}).replace(/%40/g,"@")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.memberMasterList=response.memberList,jQuery.each($scope.memberMasterList,function(i,j){var newList=jQuery.extend({},$scope.memberMasterList[i],{selectedMember:!1});$scope.validMemberList.push(newList)}))})},$scope.showDropdownWidget=function(side){"right"===side?($scope.showMemberListingWidget=!$scope.showMemberListingWidget,$scope.showCandidateListingWidget=!1):($scope.showCandidateListingWidget=!$scope.showCandidateListingWidget,$scope.showMemberListingWidget=!1)},$scope.compareToolReset=function(){$scope.cachedUSerEmails=null,$scope.resultTabs={},$scope.personalityFlags=[],$scope.cachedAdvisorData=[],$scope.resultTabs.leftSelected=0,$scope.resultTabs.rightSelected=0,$scope.showContent=!1,$scope.showMemberListingWidget=!1,$scope.memberSelected=!1,$scope.showCandidateListingWidget=!1,$scope.candidateSelected=!1,$scope.selectedCandidateEmailAddress=null,$scope.selectedMemberEmailAddress=null,jQuery.each($scope.validMemberList,function(j){$scope.validMemberList[j].selectedMember=!1}),jQuery.each($scope.validCandidateList,function(j){$scope.validCandidateList[j].selectedCandidateFromList=!1}),$scope.mobileControls.display=!1,$scope.viewMode={list:!0,chart:!1},$scope.switchToUser1=!0},$scope.updateCompareMember=function(i){$scope.labelsReset(),$scope.cachedUSerEmails=null,$scope.showMemberListingWidget=!1,$scope.personalityFlags=[],$scope.cachedAdvisorData=[],$scope.resultTabs.leftSelected=0,$scope.resultTabs.rightSelected=0,jQuery.each($scope.validMemberList,function(j){$scope.validMemberList[j].selectedMember=!1}),jQuery.each($scope.validMemberList,function(j){return $scope.validMemberList[j].email===i?($scope.validMemberList[j].selectedMember=!0,$scope.memberSelected=!0,$scope.selectedMemberDetails=$scope.validMemberList[parseInt(j)],$scope.selectedMemberEmailAddress=$scope.validMemberList[parseInt(j)].email,void($scope.viewMode.list===!0?$scope.compareCandidate($scope.selectedCandidateEmailAddress,$scope.selectedMemberEmailAddress,{candidatePersonalityType:"Primary",memberPersonalityType:"Primary"}):$scope.getCompareCharts($scope.selectedCandidateEmailAddress,$scope.selectedMemberEmailAddress))):void 0})},$scope.updateCompareCandidate=function(i){$scope.labelsReset(),$scope.cachedUSerEmails=null,$scope.showCandidateListingWidget=!1,$scope.personalityFlags=[],$scope.cachedAdvisorData=[],$scope.resultTabs.leftSelected=0,$scope.resultTabs.rightSelected=0,jQuery.each($scope.validCandidateList,function(j){$scope.validCandidateList[j].selectedCandidateFromList=!1}),jQuery.each($scope.validCandidateList,function(j){$scope.validCandidateList[j].email===i&&($scope.validCandidateList[parseInt(j)].selectedCandidateFromList=!0,$scope.candidateSelected=!0,$scope.selectedCandidate=$scope.validCandidateList[parseInt(j)],$scope.selectedCandidateEmailAddress=$scope.validCandidateList[parseInt(j)].email,$scope.viewMode.list===!0?$scope.compareCandidate($scope.selectedCandidateEmailAddress,$scope.selectedMemberEmailAddress,{candidatePersonalityType:"Primary",memberPersonalityType:"Primary"}):$scope.getCompareCharts($scope.selectedCandidateEmailAddress,$scope.selectedMemberEmailAddress))}),$scope.winWidth<768&&$timeout(function(){$rootScope.setBoxSizes("#dd-wrap",".dd","full")},300)},$scope.getCompareCharts=function(c,m){if($scope.candidateSelected&&$scope.memberSelected&&null===$scope.cachedUSerEmails){var _o={url:"/sp/hiring/compareProfile",data:$.param({candidateEmail:c,memberEmail:m}).replace(/%40/g,"@")};$scope.cachedUSerEmails=c+m,ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.compareProfileData=response,$scope.candidateProfileDetails=response.candidateAnalysis,$scope.memberProfileDetails=response.memberAnalysis,$scope.cacheCompareResponse=response,$scope.winWidth>767?($scope.showContent=!0,$scope.mobileControls.display=!1,$scope.cachedUSerEmails=null):($scope.showContent=!1,$scope.mobileControls.display=!0,$scope.switchToUser1=!0,setTimeout(function(){$rootScope.setBoxSizes(".mobile-tabs",".mtabs")},200)),$scope.personalityFormatted={candidate:{primary:$rootScope.pullInterNationalization("profileKeys."+$scope.candidateProfileDetails.personality.Primary.personalityType.trim()),pressure:$rootScope.pullInterNationalization("profileKeys."+$scope.candidateProfileDetails.personality.UnderPressure.personalityType.trim())},member:{primary:$rootScope.pullInterNationalization("profileKeys."+$scope.memberProfileDetails.personality.Primary.personalityType.trim()),pressure:$rootScope.pullInterNationalization("profileKeys."+$scope.memberProfileDetails.personality.UnderPressure.personalityType.trim())}},$timeout(function(){$scope.dataAvailablity=!0},300))})}},$scope.changeViewMode=function(v){$scope.labelsReset(),$scope.showMemberListingWidget=!1,$scope.showCandidateListingWidget=!1,"list"===v?($scope.viewMode.list=!0,$scope.viewMode.chart=!1,$scope.compareCandidate($scope.selectedCandidateEmailAddress,$scope.selectedMemberEmailAddress,{candidatePersonalityType:"Primary",memberPersonalityType:"Primary"})):($scope.viewMode.list=!1,$scope.viewMode.chart=!0,$scope.getCompareCharts($scope.selectedCandidateEmailAddress,$scope.selectedMemberEmailAddress))},$scope.compareCandidate=function(c,m,pTypes){if($scope.candidateSelected&&$scope.memberSelected){var data=$.extend({},{candidateEmail:c,memberEmail:m},pTypes),_o={url:"/sp/hiring/compareRelation",data:$.param(data).replace(/%40/g,"@")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.cacheResults(data,response),$scope.winWidth>767?($scope.showContent=!0,$scope.mobileControls.display=!1,$scope.cachedUSerEmails=null):($scope.showContent=!1,$scope.mobileControls.display=!0,$scope.switchToUser1=!0,setTimeout(function(){$rootScope.setBoxSizes(".mobile-tabs",".mtabs")},200)),setTimeout(function(){$rootScope.setBoxSizes(".results-wrapper",".results-content")},500))})}},$scope.cacheResults=function(p,r){var pType=p.candidatePersonalityType.charAt(0)+p.memberPersonalityType.charAt(0),existingFlag=$.inArray(pType,$scope.personalityFlags);-1===existingFlag&&($scope.personalityFlags.push(pType),$scope.cachedAdvisorData[pType]=r,$scope.candidateAdvise=$scope.cachedAdvisorData[pType].primary,$scope.memberAdvise=$scope.cachedAdvisorData[pType].secondary)},$scope.formatList=function(list){if("undefined"!=typeof list){var rawList=list.split("</p>"),listHTML="",counter=0;if(jQuery.each(rawList,function(i){"undefined"!=typeof rawList[i].split("<p>")[1]&&(listHTML+="<li>"+rawList[i].split("<p>")[1]+"</li>"),counter++}),counter===rawList.length)return listHTML}},$scope.changeContentTabs=function(s,i){"left"===s?$scope.resultTabs.leftSelected=parseInt(i):$scope.resultTabs.rightSelected=parseInt(i);var u1PType=0===$scope.resultTabs.leftSelected?"Primary":"UnderPressure",u2PType=0===$scope.resultTabs.rightSelected?"Primary":"UnderPressure",pFlag=u1PType.charAt(0)+u2PType.charAt(0),existingFlag=$.inArray(pFlag,$scope.personalityFlags);-1===existingFlag?$timeout(function(){$scope.compareCandidate($scope.selectedCandidateEmailAddress,$scope.selectedMemberEmailAddress,{candidatePersonalityType:u1PType,memberPersonalityType:u2PType})},100):($scope.candidateAdvise=$scope.cachedAdvisorData[pFlag].primary,$scope.memberAdvise=$scope.cachedAdvisorData[pFlag].secondary)},$scope.initCandiateCompare=function(){$scope.getSelectedCandidateDetails(),$scope.getAllMemberDetails(),$scope.getAllCandidateDetails()},$scope.printPage=function(f){f===!0&&setTimeout(function(){window.print()},500)},$scope.getMobileReport=function(v){$scope.winScreenHeight=jQuery(window).height()+"px",v===!0?ngDialog.open({template:"/sp/resources/html/tools/hiring/mobile-report.html",scope:$scope}):ngDialog.open({template:"/sp/resources/html/tools/hiring/mobile-charts.html",scope:$scope})},jQuery(window).resize(function(){$scope.winWidth<768?($scope.candidateSelected&&$scope.memberSelected&&0===$scope.sResizeFlag&&$scope.mobileControls.display===!1&&($scope.showContent=!1,$timeout(function(){$scope.mobileControls.display=!0},500),$scope.sResizeFlag=1,$scope.lResizeFlag=0),$rootScope.setBoxSizes("#dd-wrap",".dd","full")):($scope.candidateSelected&&$scope.memberSelected&&0===$scope.lResizeFlag&&($timeout(function(){$scope.mobileControls.display=!1,$scope.showContent=!0},500),$scope.sResizeFlag=0,$scope.lResizeFlag=1),ngDialog.close("ngdialog1"),jQuery("body").find("#dd-wrap").find(".dd").removeAttr("style"))}),$scope.initCandiateCompare()}angular.module("spApp").controller("candidateAdvisorController",candidateAdvisorController),candidateAdvisorController.$inject=["$scope","$element","$attrs","$http","$timeout","ajaxService","$rootScope","$localStorage","sharedProperties","ngDialog"];
function candidateCompareController($scope,$element,$attrs,$http,$timeout,ajaxService,$rootScope,ProfileDataService,$localStorage){$scope.selectedCandidate={},$scope.memberMasterList={},$scope.validMemberList=[],$scope.candidateMasterList={},$scope.validCandidateList=[],$scope.selectedMemberDetails={},$scope.candidateProfileDetails={},$scope.memberProfileDetails={},$scope.showMemberListingWidget=!1,$scope.memberSelected=!1,$scope.returnBack=function(){window.history.back()},$scope.getSelectedCandidateDetails=function(){$scope.selectedCandidateEmailAddress=$localStorage.get("candidateEmail");var _o={url:"/sp/hiring/getProfileDetails",data:$.param({candidateEmail:$scope.selectedCandidateEmailAddress}).replace(/%40/g,"@")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.selectedCandidate=response.userProfileForm,$scope.selectedCandidate.hiringRoles=response.hiring.hiringRoles,$scope.selectedCandidate.profilePic=response.hiring.smallProfileImage,$scope.selectedCandidate.userInitials=response.hiring.userInitials,$scope.candidateSelected=!0)})},$scope.getAllMemberDetails=function(){var _o={url:"/sp/relationship/getMembers",data:$.param({candidateEmail:$localStorage.get("candidateEmail")}).replace(/%40/g,"@")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.memberMasterList=response.memberList,jQuery.each($scope.memberMasterList,function(i,j){var newList=jQuery.extend({},$scope.memberMasterList[i],{selectedMember:!1});$scope.validMemberList.push(newList)}))})},$scope.getAllCandidateDetails=function(){var _o={url:"/sp/hiring/getAllCandidates"};ajaxService.getAjaxResponse(_o).then(function(response){if("true"===response.Success){var counter=0;$scope.candidateMasterList=response.hiring,jQuery.each($scope.candidateMasterList,function(i,j){var newList;"VALID"===$scope.candidateMasterList[i].userStatus&&(null===$scope.candidateMasterList[i].spUserId?(newList=jQuery.extend({},$scope.candidateMasterList[i],{selectedCandidateFromList:!1}),$scope.validCandidateList.push(newList)):$scope.candidateMasterList[i].profileSettings.hiringAccessAllowed===!0&&(newList=jQuery.extend({},$scope.candidateMasterList[i],{selectedCandidateFromList:!1}),$scope.validCandidateList.push(newList))),counter++}),counter===$scope.candidateMasterList.length&&$.each($scope.validCandidateList,function(i){$scope.validCandidateList[i].email===$localStorage.get("candidateEmail")&&($scope.validCandidateList[i].selectedCandidateFromList=!0)})}})},$scope.showDropdownWidget=function(side){"right"===side?($scope.showMemberListingWidget=!$scope.showMemberListingWidget,$scope.showCandidateListingWidget=!1):($scope.showCandidateListingWidget=!$scope.showCandidateListingWidget,$scope.showMemberListingWidget=!1)},$scope.compareToolReset=function(){$scope.showContent=!1,$scope.showMemberListingWidget=!1,$scope.memberSelected=!1,$scope.showCandidateListingWidget=!1,$scope.candidateSelected=!1,$scope.selectedCandidateEmailAddress=null,$scope.selectedMemberEmailAddress=null,jQuery.each($scope.validMemberList,function(j){$scope.validMemberList[j].selectedMember=!1}),jQuery.each($scope.validCandidateList,function(j){$scope.validCandidateList[j].selectedCandidateFromList=!1})},$scope.updateCompareMember=function(i){$scope.showMemberListingWidget=!1,jQuery.each($scope.validMemberList,function(j){$scope.validMemberList[j].selectedMember=!1}),jQuery.each($scope.validMemberList,function(j){return $scope.validMemberList[j].email===i?($scope.validMemberList[j].selectedMember=!0,$scope.memberSelected=!0,$scope.selectedMemberDetails=$scope.validMemberList[parseInt(j)],$scope.selectedMemberEmailAddress=$scope.validMemberList[parseInt(j)].email,void $scope.compareCandidate($scope.selectedCandidateEmailAddress,$scope.selectedMemberEmailAddress)):void 0})},$scope.updateCompareCandidate=function(i){$scope.showCandidateListingWidget=!1,jQuery.each($scope.validCandidateList,function(j){$scope.validCandidateList[j].selectedCandidateFromList=!1}),jQuery.each($scope.validCandidateList,function(j){$scope.validCandidateList[j].email===i&&($scope.validCandidateList[parseInt(j)].selectedCandidateFromList=!0,$scope.candidateSelected=!0,$scope.selectedCandidate=$scope.validCandidateList[parseInt(j)],$scope.selectedCandidateEmailAddress=$scope.validCandidateList[parseInt(j)].email,$scope.compareCandidate($scope.selectedCandidateEmailAddress,$scope.selectedMemberEmailAddress))})},$scope.compareCandidate=function(c,m){if($scope.candidateSelected&&$scope.memberSelected){var _o={url:"/sp/hiring/compareProfile",data:$.param({candidateEmail:c,memberEmail:m}).replace(/%40/g,"@")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.compareProfileData=response,$scope.candidateProfileDetails=response.candidateAnalysis,$scope.memberProfileDetails=response.memberAnalysis,$scope.personalityFormatted={candidate:{primary:$rootScope.pullInterNationalization("profileKeys."+$scope.candidateProfileDetails.personality.Primary.personalityType.trim()),pressure:$rootScope.pullInterNationalization("profileKeys."+$scope.candidateProfileDetails.personality.UnderPressure.personalityType.trim())},member:{primary:$rootScope.pullInterNationalization("profileKeys."+$scope.memberProfileDetails.personality.Primary.personalityType.trim()),pressure:$rootScope.pullInterNationalization("profileKeys."+$scope.memberProfileDetails.personality.UnderPressure.personalityType.trim())}},ProfileDataService.saveCandidate(response),ProfileDataService.saveMember(response),$timeout(function(){$scope.dataAvailablity=!0},300))})}},$scope.initCandiateCompare=function(){$scope.getSelectedCandidateDetails(),$scope.getAllMemberDetails(),$scope.getAllCandidateDetails()},$scope.printPage=function(f){f===!0&&setTimeout(function(){window.print()},500)},$scope.initCandiateCompare()}angular.module("spApp").controller("candidateCompareController",candidateCompareController),candidateCompareController.$inject=["$scope","$element","$attrs","$http","$timeout","ajaxService","$rootScope","ProfileDataService","$localStorage"];
function candidateIncompleteProfile($scope,$http,$element,$attrs,ajaxService,$localStorage){$scope.candidateProfile={},$scope.candidateProfileDetails={},$scope.processCandidateProfile=function(fData){if($scope.candidateProfileDetails.submitted=!1,$scope.candidateProfileDetails.$valid){var _o={url:"/sp/hiring/updateProfile",data:$.param(fData).replace(/%40/g,"@").replace(/%2C/g,",")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&window.location.reload()})}else $scope.candidateProfileDetails.submitted=!0},$scope.initCandidateProfile=function(){var _o={url:"/sp/hiring/getProfileDetails",data:$.param({candidateEmail:$localStorage.get("candidateEmail")}).replace(/%40/g,"@")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.candidateProfile=response.userProfileForm,0===$scope.candidateProfile.month&&($scope.candidateProfile.month="default"),0===$scope.candidateProfile.day&&($scope.candidateProfile.day="default"),0===$scope.candidateProfile.year&&($scope.candidateProfile.year="default"),("undefined"==typeof $scope.candidateProfile.address||null===$scope.candidateProfile.address)&&($scope.candidateProfile.country="default",$scope.candidateProfile.state=null))})},$scope.initCandidateProfile()}angular.module("spApp").controller("candidateIncompleteProfile",candidateIncompleteProfile),candidateIncompleteProfile.$inject=["$scope","$http","$element","$attrs","ajaxService","$localStorage"];
function candidateListingController($scope,$q,$element,$attrs,ajaxService,$location,$http,$state,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage){$scope.memberList=[],$scope.masterMemberList=[],$scope.backupMasterMemberList=[],$scope.showfilter=!1,$scope.pageSize=10,$scope.intialPageSize=10,$scope.searchTag=[],$scope.hiringRoles=[],$scope.alldisplay=!1,$scope.filter={},$scope.tags=[],$scope.userEmail={email:[]},$scope.checkBox=[],$scope.allMembersEmailId=[],$scope.statusInclude=[],$scope.setEditMode=!1,$scope.userStatus=[],$scope.groupModule=[],$scope.masterGroupModule=[],$scope.textSearching="",$scope.mainGroupInfoList=[],$scope.checkedAll=!1,$scope.deleteUser=!1,$scope.deleteUserError=!1,$scope.updateGroup=!1,$scope.updateGroupError=!1,$scope.updateError="",$scope.EditGroupEmail="",$scope.archiveDialog={},$scope.archiveDialog.addHiring=!1,$scope.showArchive=!1,$scope.load=!0,$scope.showIntro=!1,$scope.member={},$scope.dataWithFlags=[],$scope.memCountCheck=!1,$scope.newOrderFlag=0,$scope.addNewMember={},$scope.addNewMember.submitted=!1;var storedProfile=$localStorage.get("loggegdInProfile"),userRoles=storedProfile.member.roles.sort();$scope.isAccountAdmin=0===jQuery.inArray("AccountAdministrator",userRoles)?!0:!1,$scope.isAdmin=0===jQuery.inArray("Administrator",userRoles)?!0:!1,$localStorage.remove("showProfileTab"),$scope.formatDate=function(d){if(null!==d&&"undefined"!=typeof d){var splitDate=d.split("-"),monthData={"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"},formattedDate=monthData[splitDate[1].toString()]+" "+parseInt(splitDate[2])+", "+parseInt(splitDate[0]);return formattedDate}},$scope.formatName=function(n){if(null!==n||"undefined"!==n){var slpitName=n.split(", "),formatName=slpitName[1]+" "+slpitName[0];return formatName}},$scope.getMembersData=function(){var growlNotification=$localStorage.get("gNotify");null!==growlNotification&&"undefined"!=typeof growlNotification&&("AddSingle"===growlNotification&&$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Candidate</strong>",message:" added successfully"}),"AddHire"===growlNotification&&$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Member</strong>",message:" added successfully"}),"import"===growlNotification&&$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Candidate(s)</strong>",message:" imported successfully"}),"moved"===growlNotification&&$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Candidate</strong>",message:" added to list successfully"}),"deleted"===growlNotification&&$.growl({icon:"glyphicon glyphicon-ok",message:"Candidate deleted successfully"}),"profileError"===growlNotification&&$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$localStorage.get("profileError")}),setTimeout(function(){$localStorage.remove("gNotify"),$localStorage.remove("profileError")},300));var options={url:"/sp/hiring/getAllCandidates"};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){$scope.getArchiveCandidateList(),$localStorage.remove("isCandidateArchived","archiveCandidateId","candidateEmail","candidateID");var btnFlags,counter=0;$scope.backupMasterMemberList=response.hiring.length?response.hiring:[],$scope.newList=[],$scope.backupMasterMemberList.length>0?$scope.showIntro=!1:$scope.showIntro=!0,$.each($scope.backupMasterMemberList,function(i){"VALID"===$scope.backupMasterMemberList[i].userStatus?null===$scope.backupMasterMemberList[i].spUserId?(btnFlags=$.extend({},$scope.backupMasterMemberList[i],{btnFlags:{sendReminder:!1,archiveBtn:!0,SendInvite:!1,viewProfile:!0,viewCompare:!0,viewAdvisor:!0,requestAccess:!1}}),$scope.newList.push(btnFlags)):$scope.backupMasterMemberList[i].profileSettings.hiringAccessAllowed===!0?(btnFlags=$.extend({},$scope.backupMasterMemberList[i],{btnFlags:{sendReminder:!1,archiveBtn:!0,SendInvite:!1,viewProfile:!0,viewCompare:!0,viewAdvisor:!0,requestAccess:!1}}),$scope.newList.push(btnFlags)):(btnFlags=$.extend({},$scope.backupMasterMemberList[i],{btnFlags:{sendReminder:!1,archiveBtn:!0,SendInvite:!1,viewProfile:!1,viewCompare:!1,viewAdvisor:!1,requestAccess:!0}}),$scope.newList.push(btnFlags)):"INVITATION_SENT"===$scope.backupMasterMemberList[i].userStatus||"ASSESSMENT_PROGRESS"===$scope.backupMasterMemberList[i].userStatus||"ASSESSMENT_PENDING"===$scope.backupMasterMemberList[i].userStatus||"ADD_REFERENCES"===$scope.backupMasterMemberList[i].userStatus||"PROFILE_INCOMPLETE"===$scope.backupMasterMemberList[i].userStatus?(btnFlags=$.extend({},$scope.backupMasterMemberList[i],{btnFlags:{sendReminder:!0,archiveBtn:!1,SendInvite:!1,viewProfile:!1,viewCompare:!1,viewAdvisor:!1,requestAccess:!1}}),$scope.newList.push(btnFlags)):("INVITATION_NOT_SENT"===$scope.backupMasterMemberList[i].userStatus||"INVITATION_EXPIRED"===$scope.backupMasterMemberList[i].userStatus)&&(btnFlags=$.extend({},$scope.backupMasterMemberList[i],{btnFlags:{sendReminder:!1,archiveBtn:!1,SendInvite:!0,viewProfile:!1,viewCompare:!1,viewAdvisor:!1,requestAccess:!1}}),$scope.newList.push(btnFlags)),counter++}),counter===$scope.backupMasterMemberList.length&&($scope.masterMemberList=$scope.newList,$scope.returnMemberList($scope.pageSize),$scope.tagListArray=[],$scope.mokroles=[],$scope.userRoles=[],angular.forEach($scope.backupMasterMemberList,function(val,index){$scope.allMembersEmailId.push(val.email),null!=val.tagList&&($scope.tagListArray=val.tagList.concat($scope.tagListArray).unique()),null!=val.userStatusFormatted&&$scope.mokroles.push(val.userStatusFormatted),null!==val.hiringRoles&&($scope.userRoles=val.hiringRoles.concat($scope.userRoles).unique())}),$scope.tagListArray=$scope.autoCompleteType($scope.tagListArray),$scope.userStatus=$scope.mokroles.unique().sort(),$scope.hiringRoles=$scope.userRoles.unique(),$scope.listLoaded=!0)}})},$scope.intersection=function(a,b){var result=[],ai=0,bi=0;for(a.sort(),b.sort();a.length>ai&&b.length>bi;)a[ai]<b[bi]?ai++:a[ai]>b[bi]?bi++:(result.push(a[ai]),ai++,bi++);return result},$scope.enableAdvanceSection=function(event){$(event.currentTarget).closest(".complete-profile").find(".editable-section").show()},$scope.autoCompleteType=function(arr){for(var customarray=[],i=0;i<arr.length;i++)customarray.push({text:arr[i]});return customarray},$scope.order=function(predicate,reverse){$scope.lastPredicate=predicate,$scope.lastReverse=reverse,$scope.memberList=$filter("orderBy")($scope.memberList,predicate,reverse)},$scope.loadTags=function(query){var deferred=$q.defer();return deferred.resolve($scope.getLoadSuggestion(query)),deferred.promise},$scope.getLoadSuggestion=function(query){for(var copyArray=[],i=0;i<$scope.tagListArray.length;i++)angular.lowercase($scope.tagListArray[i].text).indexOf(angular.lowercase(query))>-1&&copyArray.push($scope.tagListArray[i]);return copyArray.slice(0,5)},$scope.tagAdded=function(tag){$scope.searchTag.push(tag.text),$scope.refineSearch($scope.searchTag)},$scope.tagRemoved=function(tag){$scope.searchTag.splice($scope.searchTag.indexOf(tag.text),1),$scope.refineSearch($scope.searchTag)},$scope.refineSearch=function(list){$scope.newArr=[],angular.forEach($scope.masterMemberList,function(val,key){null!=val.tagList&&$scope.intersection(val.tagList,list).length===list.length&&$scope.newArr.push(val)}),$scope.checkboxFilter()},$scope.includeCheck=function(status){var i=$.inArray(status,$scope.statusInclude);i>-1?$scope.statusInclude.splice(i,1):$scope.statusInclude.push(status),$scope.checkboxFilter()},$scope.checkboxFilter=function(status){$scope.statusInclude.length>0&&($scope.checkBox=[],angular.forEach($scope.masterMemberList,function(val,index){for(var i=0;i<$scope.statusInclude.length;i++)for(var j=0;j<val.roles[i].length;j++)val.roles[j]===$scope.statusInclude[i]&&$scope.checkBox.push(val)})),$scope.returnMemberList($scope.pageSize)},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.returnMemberList($scope.pageSize)},$scope.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize))},$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.returnMemberList=function(pageSize){if($scope.searchTag.length&&!$scope.statusInclude.length&&($scope.memberList=angular.copy($scope.newArr)),$scope.searchTag.length&&$scope.statusInclude.length){$scope.combineArray=[];for(var i=0;i<$scope.newArr.length;i++)for(var j=0;j<$scope.checkBox.length;j++)$scope.newArr[i].email===$scope.checkBox[j].email&&$scope.combineArray.push($scope.newArr[i]);$scope.memberList=angular.copy($scope.combineArray)}!$scope.searchTag.length&&$scope.statusInclude.length&&($scope.memberList=angular.copy($scope.checkBox)),$scope.searchTag.length||$scope.statusInclude.length||($scope.memberList=angular.copy($scope.masterMemberList)),$scope.memberList=sharedProperties.searchModule($scope.textSearching,$scope.memberList,2),$scope.pageSize=pageSize,pageSize>=$scope.masterMemberList.length&&($scope.disabledInfinite=!0,$scope.pageSize=$scope.masterMemberList.length),$scope.load&&($scope.lastPredicate="name",$scope.lastReverse=!1,$scope.loadBtnCLicked=!1,$scope.load=!1),$scope.loadBtnCLicked&&($scope.loadBtnCLicked=!1),$scope.order($scope.lastPredicate,$scope.lastReverse),$scope.memberList=$scope.memberList},$scope.checkAll=function(){$scope.checkedAll=!$scope.checkedAll,this.negative?$scope.userEmail.email=$scope.masterMemberList.map(function(item){return{email:item.email,name:item.name}}):$scope.userEmail.email=[]},$scope.checkUncheck=function(){$scope.alltoggle=!1,$scope.checkedAll&&($scope.negative=!$scope.negative,$scope.checkedAll=!$scope.checkedAll)},$scope.resetfilter=function(allmembers){$scope.pageSize=$scope.intialPageSize,$scope.newArr=[],$scope.searchTag=[],$scope.tags=[],$scope.filter={},$scope.userEmail.email=[],$scope.statusInclude=[],$scope.adminc=!1,$scope.leadC=!1,$scope.textSearching="",$scope.searchText="","undefined"!=typeof this.selectedSearch&&(this.selectedSearch.userStatusFormatted="",this.selectedSearch.hiringRoles=""),$scope.memberList=angular.copy($scope.masterMemberList),"undefined"!=typeof allmembers&&($scope.pageSize=$scope.masterMemberList.length),$scope.checkUncheck(),angular.element($(".tags").find("input")).scope().newTag.text="",$scope.load=!0,$scope.disabledInfinite=!1,$rootScope.$broadcast("$scrollStart"),$scope.returnMemberList($scope.pageSize);var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")},$scope.confirmDelete=function(event){var email=$(event.target).closest(".complete-profile").find(".email").html(),options=(angular.element(event.currentTarget),{url:"/sp/hiring/deleteCandidate",data:$.param({candidateEmail:email})});ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?($scope.getMembersData(),$scope.userEmail.email=[],$scope.alltoggle=!1,$scope.checkedAll&&($scope.negative=!$scope.negative),$.growl({icon:"glyphicon glyphicon-ok",message:"Candidate(s) deleted successfully"})):$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Server Error"})})},$scope.certainDelete=function(){ngDialog.open({template:"/sp/resources/html/tools/hiring/deleteConfirmation.html",scope:$scope})},$scope.deleteUsers=function(emails){var emailList=[];jQuery.each(emails,function(i,j){emailList.push(emails[i].email)});var options={url:"/sp/hiring/deleteCandidate",data:$.param({candidateEmail:emailList.toString()})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&($scope.getMembersData(),$scope.userEmail.email=[],$scope.alltoggle=!1,$scope.checkedAll&&($scope.negative=!$scope.negative),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:"Candidate(s) deleted successfully"}))})},$scope.addClassActive=function(){$scope.dropUp=!$scope.dropUp},$scope.notificationEmail=function(emails){emails.length&&(sharedProperties.setEmail(emails),sharedProperties.setObject($scope.memberList),ngDialog.open({template:"return-visitor.html"}))},$scope.profileRoute=function(event){var groupname=$(event.currentTarget).data("routeparam");$localStorage.set("groupname",groupname),window.location.href="/sp/admin/group/#profile"},$scope.showFullList=function(){$scope.resetfilter("full")},$scope.editGroupSection=function(index){$scope.EditGroupEmail=this.memberList.email;for(var currentEmail=this.memberList.email,i=0;i<$scope.memberList.length;i++)currentEmail===$scope.memberList[i].email&&(index=i);$scope.setEditMode=!0,$scope.indexToChange=index,$scope.groupEditSection=angular.copy($scope.memberList[index]),$scope.groupSelectOption=[];for(var j=0;j<$scope.groupEditSection.groupAssociationList.length;j++)$scope.groupSelectOption.push($scope.groupEditSection.groupAssociationList[j].name);ngDialog.open({template:"/sp/admin/member/editGroup",scope:$scope})},$scope.enableLeadDialog=function(leadValue,index,groupName){for(var i=0;i<$scope.mainGroupInfoList.length;i++)if(groupName===$scope.mainGroupInfoList[i].name){if(null!==$scope.mainGroupInfoList[i].groupLead&&$scope.mainGroupInfoList[i].groupLead.email!==$scope.EditGroupEmail)return!1;$scope.groupEditSection.groupAssociationList[index].groupLead=!leadValue}},$scope.setStyle=function(lead){return $scope.viewMode(),lead===!0?!0:!1},$scope.isItEnabled=function(groupName,id){$scope.classActivate=[];for(var i=0;i<$scope.mainGroupInfoList.length;i++)groupName===$scope.mainGroupInfoList[i].name&&null!==$scope.mainGroupInfoList[i].groupLead&&$scope.mainGroupInfoList[i].groupLead.email!==$scope.EditGroupEmail&&($scope.classActivate.push("#mode_"+id),$scope.classActivate.push("#modeprop_"+id))},$scope.viewMode=function(){if($scope.classActivate.length)for(var i=0;i<$scope.classActivate.length;i++)$($scope.classActivate[i]).addClass("disabled")},$scope.addGroupToModule=function(groupName,lead){return $scope.selectedGroup=groupName,"default"===groupName?!1:(""===$scope.groupEditSection.groupAssociationList[0].name&&$scope.groupEditSection.groupAssociationList.splice(0,1),$scope.groupEditSection.groupAssociationList.push({name:groupName,groupLead:!1}),void $scope.groupSelectOption.push(groupName))},$scope.addGroupMember=function(names){return""===names?!1:!0},$scope.removeGroupDialog=function(event,groupName){for(var _this=event.target,current=($(_this).closest(".blockGroup").remove(),""),i=0;i<$scope.groupEditSection.groupAssociationList.length;i++)$scope.groupEditSection.groupAssociationList[i].name===groupName.name&&($scope.groupEditSection.groupAssociationList.splice(i,1),current=i);$scope.groupSelectOption.splice(current,1)},$scope.saveGroupToModule=function(groupName){for(var newArr="",i=0;i<$scope.groupEditSection.groupAssociationList.length;i++)newArr=newArr.length?newArr+","+$scope.groupEditSection.groupAssociationList[i].name+":"+$scope.groupEditSection.groupAssociationList[i].groupLead:$scope.groupEditSection.groupAssociationList[i].name+":"+$scope.groupEditSection.groupAssociationList[i].groupLead;var options={url:"/sp/admin/group/memberGroupUpdate",data:$.param({groupAssociationList:newArr,memberEmail:$scope.groupEditSection.email})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){$scope.groupEditSection.groupAssociationList.length?$scope.memberList[$scope.indexToChange]=$scope.groupEditSection:($scope.groupEditSection.groupAssociationList.push({name:"",groupLead:!1}),$scope.memberList[$scope.indexToChange]=$scope.groupEditSection);for(var i=0;i<$scope.masterMemberList.length;i++)$scope.masterMemberList[i].email===$scope.memberList[$scope.indexToChange].email&&($scope.masterMemberList[i]=$scope.groupEditSection);ngDialog.close("ngdialog1"),ngDialog.open({template:"/sp/admin/member/confirmation"})}else ngDialog.close("ngdialog1"),ngDialog.open({template:"/sp/admin/member/errorGroup"})})},$scope.memberTakeAway=function(email,id,spProfile){$localStorage.set("candidateEmail",email).set("candidateID",id),spProfile===!0&&$localStorage.set("showProfileTab",!0),window.location.href="/sp/tools/hiring/profile?cemail="+email},$scope.candidateCompare=function(email,id){$localStorage.set("candidateEmail",email).set("candidateID",id),window.location.href="/sp/tools/hiring/compare"},$scope.candidateAdvisor=function(email,id){$localStorage.set("candidateEmail",email).set("candidateID",id),window.location.href="/sp/tools/hiring/advisor?c="+email},$scope.calltoAction=function(select){return""===select?!1:void(window.location.href=select)},$scope.archiveDialog=function(e,n,r){$scope.archiveCandidate={name:n,email:e,roles:r},ngDialog.open({template:"/sp/resources/html/tools/hiring/archive-candidate.html",scope:$scope})},$scope.archiveAllCandidate=function(cEmail,isHired,single){var emailList=[];single!==!0?jQuery.each(cEmail,function(i,j){emailList.push(cEmail[i].email)}):emailList=cEmail;var options={url:"/sp/hiring/archiveCandidate",data:$.param({candidateEmail:emailList.toString(),isHired:!1})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Candidate(s)</strong>",message:" archived successfully"}),$scope.getMembersData(),$scope.negative=!$scope.negative,$scope.archiveDialog.addHiring=!1)})},$scope.archiveAllDialog=function(emails){emails.length>0&&($scope.archiveCandidateAll={emails:emails},ngDialog.open({template:"/sp/resources/html/tools/hiring/archive-candidate-list.html",scope:$scope}),$scope.userEmail.email=[],$scope.alltoggle=!1,$scope.checkedAll&&($scope.negative=!$scope.negative))},$scope.sendViewProfileRequest=function(e,n){$scope.profileRequest={email:e,name:n,heading:"Request Access"},ngDialog.open({template:"/sp/resources/html/tools/hiring/send-profile-invite.html",scope:$scope}),$scope.sendRequest=function(e){var options={url:"/sp/notifications/sendNotification",data:$.param({memberEmail:e,type:""}).replace(/%40/g,"@")};ajaxService.getAjaxResponse(options).then(function(response){"true"!==response.Success&&$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:"Not able to send invite"})})}},$scope.getArchiveCandidateList=function(){var options={url:"/sp/hiring/getAllArchivedCandidates"};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&(response["hiring-archived"].length>0?$scope.showArchive=!0:$scope.showArchive=!1)})},$scope.sendReminder=function(e,n){$scope.profileRequest={email:e,name:n,heading:"Reminder"},ngDialog.open({template:"/sp/resources/html/tools/hiring/send-profile-invite.html",scope:$scope}),$scope.sendRequest=function(e){var options={url:"/sp/notifications/sendNotification",data:$.param({memberEmail:e,type:""}).replace(/%40/g,"@")};ajaxService.getAjaxResponse(options).then(function(response){"true"!==response.Success&&$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:"Not able to send invite"})})}},$scope.hireCandidate=function(e,n,r,id){$scope.hireCandidateDetails={name:n,email:e,roles:r,cId:id},$scope.member={},$scope.member.firstName=$scope.hireCandidateDetails.name.split(" ")[0],$scope.member.lastName=$scope.hireCandidateDetails.name.split(" ")[1],$scope.isAdmin||$scope.isAccountAdmin?ajaxService.getAjaxResponse({url:"/sp/admin/member/availalbeMemberSubscriptions"}).then(function(response){"true"===response.Success&&($scope.memberAccountsCount=response.availalbeMemberSubscriptions,$scope.memberAccountsCount>0?($scope.getGroupList(),ngDialog.open({template:"/sp/resources/html/tools/hiring/hire-candidate.html",scope:$scope})):ngDialog.open({template:"/sp/resources/html/tools/hiring/hire-candidate-no-members.html",scope:$scope}))}):ngDialog.open({template:"/sp/resources/html/tools/hiring/hire-candidate-not-admin.html",scope:$scope}),$scope.hireCandidateArchive=function(){ajaxService.getAjaxResponse({url:"/sp/hiring/archiveCandidate",data:$.param({candidateEmail:$scope.hireCandidateDetails.email,isHired:!0})}).then(function(response){if("true"===response.Success)$scope.getMembersData(),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Candidate</strong>",message:" status changed to 'Hired' and archived successfully"});else{for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})},$scope.addMember=function(fData){this.addNewMember.submitted=!1;var _data=$.extend(fData,{candidateId:$scope.hireCandidateDetails.cId});this.addNewMember.$valid?ajaxService.getAjaxResponse({url:"/sp/hiring/archiveCandidate",data:$.param({candidateEmail:$scope.hireCandidateDetails.email,isHired:!0})}).then(function(response){if("true"===response.Success)ajaxService.getAjaxResponse({url:"/sp/admin/member/addSingle",data:$.param(_data).replace(/%2C/g,",")}).then(function(response){if("true"===response.Success)$scope.getMembersData(),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Member</strong>",message:" added successfully"});else{ngDialog.close("ngdialog1");for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}});else{ngDialog.close("ngdialog1");for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}}):this.addNewMember.submitted=!0}},$scope.getGroupList=function(){$scope.groupDataSet=[],$scope.groupDataSetBackup=[],$scope.dataWithFlags=[],ajaxService.getAjaxResponse({url:"/sp/admin/group/all"}).then(function(response){if("true"===response.Success)$scope.groupDataSet=response.groupInfoList,$scope.groupDataSetBackup=response.groupInfoList,jQuery.each($scope.groupDataSet,function(i,j){$scope.dataWithFlags.push(jQuery.extend({},$scope.groupDataSet[i],{selectedFlag:!1,isGroupLead:!1}))}),$scope.flagCounter=$scope.dataWithFlags.length;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.updateTagList=function(single,multiple){$scope.member.groupAssociationList=null,$scope.tagList=[],jQuery.each($scope.dataWithFlags,function(i,j){$scope.dataWithFlags[i].selectedFlag===!0&&multiple===!0?$scope.tagList.push($scope.dataWithFlags[i].name):$scope.dataWithFlags[i].selectedFlag===!0&&single===!0&&($scope.dataWithFlags[i].isGroupLead===!0?$scope.tagList.push($scope.dataWithFlags[i].name+":true"):$scope.tagList.push($scope.dataWithFlags[i].name+":false")),$scope.member.groupAssociationList=$scope.tagList.join()})},$scope.updateGroupLeadStatus=function(i,email,single,multiple,j){var _a=jQuery("body").find("a#gl_"+j);"undefined"!=typeof $scope.dataWithFlags[i]&&null===email&&($scope.dataWithFlags[i].isGroupLead===!0?($scope.dataWithFlags[i].isGroupLead=!1,_a.removeClass("on")):($scope.dataWithFlags[i].isGroupLead=!0,_a.addClass("on")),$scope.updateTagList(single,multiple))},$scope.changeGroup=function(flag,single,multiple){"default"!==flag&&("createGroupCall_custom"===flag?($scope.params={p1:single,p2:multiple},$scope.errornewEmptyGroup=!1,$scope.errornewGroup=!1,ngDialog.open({template:"/sp/admin/group/createGroup",scope:$scope}),$scope.member.gList="default"):($scope.dataWithFlags[flag].selectedFlag=!0,$scope.flagCounter-=1,$scope.updateTagList(single,multiple),$scope.member.gList="default",$scope.dataWithFlags[flag].newOrder=$scope.newOrderFlag++,$scope.dataWithFlags[flag].originalIndex=flag))},$scope.removeGroup=function(flag,single,multiple){"default"!==flag&&($scope.dataWithFlags[flag].selectedFlag=!1,$scope.dataWithFlags[flag].isGroupLead=!1,$scope.flagCounter+=1,$scope.updateTagList(single,multiple))},$scope.saveNewGroup=function(groupname,groupLeadEmailId){var $this=this;if($scope.errornewEmptyGroup=!1,$scope.errornewGroup=!1,""===groupname||"undefined"==typeof groupname)return $scope.errornewEmptyGroup=!0,!1;var obj={name:groupname},options={url:"/sp/admin/group/create",data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?($this.closeThisDialog(),$scope.dataWithFlags.push({name:groupname,groupLead:null,numOfMembers:0,memberSummaryList:null,selectedFlag:!0,originalIndex:$scope.dataWithFlags.length,newOrder:$scope.newOrderFlag}),$scope.flagCounter-=1,$scope.member.gList="default",$scope.newOrderFlag+=1,$scope.updateTagList($scope.params.p1,$scope.params.p2)):null!=response.error&&($scope.member.gList="default",$scope.errornewGroup=!0)})},$scope.closeGroup=function(){$scope.member.gList="default",this.closeThisDialog()}}function notification($scope,sharedProperties){$scope.name=[];var memberList=sharedProperties.getObject(),emails=sharedProperties.getEmail();$scope.emailId=emails,angular.forEach(memberList,function(val,index){for(var i=0;i<emails.length;i++)emails[i]===val.email&&$scope.name.push(val.name)})}angular.module("spApp").controller("candidateListingController",candidateListingController),angular.module("spApp").controller("notification",notification),candidateListingController.$inject=["$scope","$q","$element","$attrs","ajaxService","$location","$http","$state","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage"],notification.$inject=["$scope","sharedProperties"];
function candidateProfileDetails($scope,$element,$attrs,$http,userDataService,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage){$scope.formStatus={},$scope.profile={},$scope.linkedinUpdate={},$scope.profileCommentswithFlags=[],$scope.commentBoxes={},$scope.newDate={},$scope.loggedInUser={},$scope.disableLinkedinEditing=!0,$scope.disableUserProfileEditing=!0,$scope.linkeDInFormStatus=!1,$scope.commentEditEnabled=!1,$scope.loggedInUser.first="",$scope.loggedInUser.last="",$scope.url={},$scope.userProfile={},$scope.comments={},$scope.stateCheck={},$scope.member={},$scope.dataWithFlags=[],$scope.memCountCheck=!1,$scope.newOrderFlag=0,$scope.addNewMember={},$scope.addNewMember.submitted=!1,$scope.emailFromParam=sharedProperties.getParam("cemail"),$scope.commentSection={};var storedProfile=$localStorage.get("loggegdInProfile"),userRoles=storedProfile.member.roles.sort();$scope.isAccountAdmin=0===jQuery.inArray("AccountAdministrator",userRoles)?!0:!1,$scope.isAdmin=0===jQuery.inArray("Administrator",userRoles)?!0:!1;var t=$localStorage.get("showProfileTab");"undefined"!=typeof t&&null!==t?($scope.defaultTab=!1,$timeout(function(){$rootScope.callSwitchChange("spProfile1")},100)):$scope.defaultTab=!0,$scope.newDate.currentDay=new Date,null!==$localStorage.get("isCandidateArchived")&&$localStorage.get("isCandidateArchived")!==!1&&($scope.isCandidateArchived=!0,ajaxService.getAjaxResponse({url:"/sp/hiring/getArchivedUserProfileDetails",data:$.param({candidateId:$localStorage.get("archiveCandidateId")})}).then(function(response){if("true"===response.Success){$scope.profile=response.hiring,$scope.hiringInfo=response.hiring,"VALID"===$scope.hiringInfo.userStatus?null===$scope.hiringInfo.spUserId?$scope.hiringInfo=$.extend({},$scope.hiringInfo,{btnFlags:{viewProfile:!1,viewCompare:!1,viewAdvisor:!1,requestAccess:!1,deleteBtn:!0,moveBtn:!0}}):$scope.hiringInfo.profileSettings.hiringAccessAllowed===!0?$scope.hiringInfo=$.extend({},$scope.hiringInfo,{btnFlags:{viewProfile:!1,viewCompare:!1,viewAdvisor:!1,requestAccess:!1,deleteBtn:!0,moveBtn:!0}}):$scope.hiringInfo=$.extend({},$scope.hiringInfo,{btnFlags:{viewProfile:!1,viewCompare:!1,viewAdvisor:!1,requestAccess:!0,deleteBtn:!0,moveBtn:!0}}):"INVITATION_SENT"===$scope.hiringInfo.userStatus||"ASSESSMENT_PROGRESS"===$scope.hiringInfo.userStatus||"ASSESSMENT_PENDING"===$scope.hiringInfo.userStatus||"ADD_REFERENCES"===$scope.hiringInfo.userStatus?$scope.hiringInfo=$.extend({},$scope.hiringInfo,{btnFlags:{viewProfile:!1,viewCompare:!1,viewAdvisor:!1,requestAccess:!1,deleteBtn:!0,moveBtn:!0}}):("INVITATION_NOT_SENT"===$scope.hiringInfo.userStatus||"INVITATION_EXPIRED"===$scope.hiringInfo.userStatus)&&($scope.hiringInfo=$.extend({},$scope.hiringInfo,{btnFlags:{viewProfile:!1,viewCompare:!1,viewAdvisor:!1,requestAccess:!1,deleteBtn:!0,moveBtn:!0}})),null!==response.address?($scope.profile.address1=response.address.addressLine1,$scope.profile.address2=response.address.addressLine2,$scope.profile.city=response.address.city,$scope.profile.state=response.address.state,$scope.profile.country=response.address.country,$scope.profile.zip=response.address.zipCode):($scope.profile.address1=null,$scope.profile.address2=null,$scope.profile.city=null,$scope.profile.state="default",$scope.profile.country="default",$scope.profile.zip=null),null===$scope.profile.gender&&($scope.profile.gender="default"),0===$scope.profile.dob.monthValue?$scope.profile.month="default":$scope.profile.month=$scope.profile.dob.monthValue,0===$scope.profile.dob.dayOfMonth?$scope.profile.day="default":$scope.profile.day=$scope.profile.dob.dayOfMonth,0===$scope.profile.dob.year?$scope.profile.year="default":$scope.profile.year=$scope.profile.dob.year,$scope.profile.phone=$scope.profile.phoneNumber,$scope.profilePic=response.hiring.smallProfileImage,$scope.userInitials=response.hiring.userInitials,$scope.profilePicSmall=response.hiring.smallProfileImage,"undefined"!=typeof response.hiring.tagList&&null!==response.hiring.tagList?$scope.existingCandidateTags=response.hiring.tagList.join():$scope.existingCandidateTags="","undefined"!=typeof response.hiring.hiringRoles||null!==response.hiring.hiringRoles?$scope.existingCandidateRoles=response.hiring.hiringRoles.join(", "):$scope.existingCandidateRoles="",$scope.totalComments=response.hiring.comments.length,$scope.userStatus=response.hiring.userStatusFormatted,$scope.assessmentStatus=response.hiring.userStatus,$scope.profileCommentswithFlags=[];var getComments=response.hiring.comments;jQuery.each(getComments,function(i,j){var updatedComment=jQuery.extend({},getComments[i],{mName:"commentBox_"+i,showOptions:!1});$scope.profileCommentswithFlags.push(updatedComment)}),$scope.referencesDetails=response.hiring.referencesDetails,null!==$scope.hiringInfo.linkedInUrl&&"undefined"!=typeof $scope.hiringInfo.linkedInUrl?$scope.url.linkedInUrl=$scope.hiringInfo.linkedInUrl:null!==$scope.hiringInfo.url&&"undefined"!=typeof $scope.hiringInfo.url&&($scope.url.linkedInUrl=$scope.hiringInfo.url)}})),$scope.newDate={year:$scope.newDate.currentDay.getFullYear(),month:$scope.newDate.currentDay.getMonth()+1,day:$scope.newDate.currentDay.getDate()},$scope.addressFormReset=function(t){$scope.profile.address1=null,$scope.profile.address2=null,$scope.profile.city=null,$scope.profile.zip=null,"United States"===$scope.stateCheck.forSelectedCountry?$scope.profile.state="default":$scope.profile.state=null},$scope.enableEdit=function(f){"linkedin"===f&&($scope.disableLinkedinEditing=!1),"userProfile"===f&&($scope.disableUserProfileEditing=!1)},$scope.disableEdit=function(f){"linkedin"===f&&($scope.disableLinkedinEditing=!0),"userProfile"===f&&($scope.disableUserProfileEditing=!0,$scope.getProfileDetails()),$scope.formStatus.sumbit=!1,$scope.linkeDInFormStatus=!1},$scope.formatDate=function(d){if(null!==d&&"undefined"!=typeof d){var splitDate=d.split("-"),monthData={"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"},month=parseInt(splitDate[1])<9?"0"+splitDate[1]:splitDate[1],formattedDate=monthData[month.toString()]+" "+parseInt(splitDate[2])+", "+parseInt(splitDate[0]);return formattedDate}},$scope.today=$scope.formatDate($scope.newDate.year+"-"+$scope.newDate.month+"-"+$scope.newDate.day),$scope.getProfileDetails=function(){var _o={url:"/sp/hiring/getProfileDetails",data:$.param({candidateEmail:$scope.emailFromParam}).replace(/%40/g,"@")};ajaxService.getAjaxResponse(_o).then(function(response){if("true"===response.Success){$scope.profile=response.userProfileForm,$scope.hiringInfo=response.hiring,$localStorage.set("candidateEmail",$scope.emailFromParam).set("candidateID",response.hiring.id),"VALID"===$scope.hiringInfo.userStatus?null===$scope.hiringInfo.spUserId?$scope.hiringInfo=$.extend({},$scope.hiringInfo,{btnFlags:{viewProfile:!0,viewCompare:!0,viewAdvisor:!0,requestAccess:!1,archiveBtn:!0}}):$scope.hiringInfo.profileSettings.hiringAccessAllowed===!0?$scope.hiringInfo=$.extend({},$scope.hiringInfo,{btnFlags:{viewProfile:!0,viewCompare:!0,viewAdvisor:!0,requestAccess:!1,archiveBtn:!0}}):$scope.hiringInfo=$.extend({},$scope.hiringInfo,{btnFlags:{viewProfile:!1,viewCompare:!1,viewAdvisor:!1,requestAccess:!0,archiveBtn:!0}}):"INVITATION_SENT"===$scope.hiringInfo.userStatus||"ASSESSMENT_PROGRESS"===$scope.hiringInfo.userStatus||"ASSESSMENT_PENDING"===$scope.hiringInfo.userStatus||"ADD_REFERENCES"===$scope.hiringInfo.userStatus?$scope.hiringInfo=$.extend({},$scope.hiringInfo,{btnFlags:{viewProfile:!1,viewCompare:!1,viewAdvisor:!1,requestAccess:!1,archiveBtn:!1}}):("INVITATION_NOT_SENT"===$scope.hiringInfo.userStatus||"INVITATION_EXPIRED"===$scope.hiringInfo.userStatus)&&($scope.hiringInfo=$.extend({},$scope.hiringInfo,{btnFlags:{viewProfile:!1,viewCompare:!1,viewAdvisor:!1,requestAccess:!1,archiveBtn:!1}})),null!==response.address?($scope.profile.address1=response.address.addressLine1,$scope.profile.address2=response.address.addressLine2,$scope.profile.city=response.address.city,$scope.profile.state=response.address.state,$scope.profile.country=response.address.country,$scope.profile.zip=response.address.zipCode):($scope.profile.address1=null,$scope.profile.address2=null,$scope.profile.city=null,$scope.profile.state="default",$scope.profile.country="default",$scope.profile.zip=null),null===$scope.profile.gender&&($scope.profile.gender="default"),0===$scope.profile.month&&($scope.profile.month="default"),0===$scope.profile.day&&($scope.profile.day="default"),0===$scope.profile.year&&($scope.profile.year="default"),$scope.profilePic=response.hiring.smallProfileImage,$scope.userInitials=response.hiring.userInitials,$scope.profilePicSmall=response.hiring.smallProfileImage,"undefined"!=typeof response.hiring.tagList&&null!==response.hiring.tagList?$scope.existingCandidateTags=response.hiring.tagList.join():$scope.existingCandidateTags="","undefined"!=typeof response.hiring.hiringRoles||null!==response.hiring.hiringRoles?$scope.existingCandidateRoles=response.hiring.hiringRoles.join(", "):$scope.existingCandidateRoles="",$scope.totalComments=response.hiring.comments.length,$scope.userStatus=response.hiring.userStatusFormatted,$scope.assessmentStatus=response.hiring.userStatus,$scope.profileCommentswithFlags=[];var getComments=response.hiring.comments;jQuery.each(getComments,function(i,j){var updatedComment=jQuery.extend({},getComments[i],{mName:"commentBox_"+i,showOptions:getComments[i].by.email===$scope.loggedInUser.email?!0:!1});$scope.profileCommentswithFlags.push(updatedComment)}),$scope.referencesDetails=response.hiring.referencesDetails,null!==$scope.hiringInfo.linkedInUrl&&"undefined"!=typeof $scope.hiringInfo.linkedInUrl?($scope.url.linkedInUrl=$scope.hiringInfo.linkedInUrl,$scope.disableLinkedinEditing=!0,$scope.linkedinIcon=!0):null!==$scope.hiringInfo.url&&"undefined"!=typeof $scope.hiringInfo.url?($scope.hiringInfo.linkedInUrl=$scope.hiringInfo.url,$scope.url.linkedInUrl=$scope.hiringInfo.url,$scope.disableLinkedinEditing=!0,$scope.linkedinIcon=!1):$scope.disableLinkedinEditing=!1}else{$localStorage.remove("candidateEmail","candidateID");for(var key in response.error)$scope.errorMessage=response.error[key];$localStorage.set("gNotify","profileError"),$localStorage.set("profileError",$scope.errorMessage),setTimeout(function(){window.location="/sp/tools/hiring/"},100)}})},"undefined"==typeof userDataService.retrive()?$timeout(function(){$scope.loggedInUser=userDataService.retrive(),$scope.loggedInUser.first=$scope.loggedInUser.member.firstName,$scope.loggedInUser.last=$scope.loggedInUser.member.lastName,$scope.loggedInUser.email=$scope.loggedInUser.member.email},500):($scope.loggedInUser=userDataService.retrive(),$scope.loggedInUser.first=$scope.loggedInUser.member.firstName,$scope.loggedInUser.last=$scope.loggedInUser.member.lastName,$scope.loggedInUser.email=$scope.loggedInUser.member.email),$scope.saveAndUpdate=function(formData,formName){var _o={url:"/sp/hiring/updateProfile",data:$.param({firstName:formData.firstName,lastName:formData.lastName,title:formData.title,email:formData.email,gender:formData.gender,day:formData.day,month:formData.month,year:formData.year,phone:formData.phone,address1:formData.address1,address2:formData.address2,city:formData.city,state:formData.state,country:formData.country,zip:formData.zip}).replace(/%2C/g,",").replace(/%40/g,"@")},vCount=0;$scope.formStatus.sumbit=!1;for(var k in formData)("default"===formData[k]||"default1"===formData[k])&&vCount++;this.userProfile.$valid&&0===vCount?($scope.disableUserProfileEditing=!0,ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&$scope.getProfileDetails()})):$scope.formStatus.sumbit=!0},$scope.comments={add:function(c,fName){if($scope.commentSection.submitted=!1,""!==c&&null!==c&&"undefined"!=typeof c){var _o={url:"/sp/hiring/addComment",data:$.param({candidateEmail:$scope.emailFromParam,comment:c}).replace(/%40/g,"@").replace(/%2C/g,",")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.commentSection.comment=null,jQuery('textarea[name="comment"]').val(null),$scope.getProfileDetails())})}else $scope.commentSection.submitted=!0},update:function(i){var commentNgModel="commentBox_"+i,errorBox=jQuery("body").find("span.error_msg_"+i);if($scope.commentEditEnabled=!1,jQuery(errorBox).hasClass("hide")||jQuery(errorBox).addClass("hide"),"undefined"!=typeof $scope.commentBoxes[commentNgModel]){var _o={url:"/sp/hiring/updateComment",data:$.param({candidateEmail:$scope.emailFromParam,comment:$scope.commentBoxes[commentNgModel],index:i}).replace(/%40/g,"@").replace(/%2C/g,",")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.comment=null,$scope.getProfileDetails())})}else jQuery(errorBox).removeClass("hide")},"delete":function(i){var _o={url:"/sp/hiring/removeComment",data:$.param({candidateEmail:$scope.emailFromParam,index:i}).replace(/%40/g,"@").replace(/%2C/g,",")};ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&($scope.comment=null,$scope.getProfileDetails())})},edit:function(i){var commentTextbox=jQuery("body").find("form[name=commentBoxForm_"+i+"]"),commentbox=jQuery("body").find("p.user-comment[data-comment=cBox_"+i+"]"),commentNgModel="commentBox_"+i,textBoxComment=jQuery(commentTextbox).find("textarea").attr("data-comments"),editBtns=jQuery("body").find("p.comment-btns[data-btns=cBtns_"+i+"]"),cancelBtns=jQuery("body").find("a[data-cancel=cancelBtn_"+i+"]");jQuery(editBtns).addClass("hide"),jQuery(cancelBtns).addClass("show"),jQuery(commentTextbox).removeClass("hide"),jQuery(commentbox).addClass("hide"),$scope.commentBoxes[commentNgModel]=textBoxComment,$scope.commentEditEnabled=!0},cancel:function(i){var commentTextbox=jQuery("body").find("form[name=commentBoxForm_"+i+"]"),commentbox=jQuery("body").find("p.user-comment[data-comment=cBox_"+i+"]"),editBtns=jQuery("body").find("p.comment-btns[data-btns=cBtns_"+i+"]"),cancelBtns=jQuery("body").find("a[data-cancel=cancelBtn_"+i+"]");jQuery(editBtns).removeClass("hide"),jQuery(cancelBtns).removeClass("show").addClass("hide"),jQuery(commentTextbox).addClass("hide"),jQuery(commentbox).removeClass("hide"),$scope.commentEditEnabled=!1}},$scope.archiveDialog=function(e,n,r){$scope.archiveCandidate={name:n,email:e,roles:r},ngDialog.open({template:"/sp/resources/html/tools/hiring/archive-candidate.html",scope:$scope})},$scope.archiveAllCandidate=function(cEmail,isHired,single){var emailList=[];single!==!0?jQuery.each(cEmail,function(i,j){emailList.push(cEmail[i].email)}):emailList=cEmail;var options={url:"/sp/hiring/archiveCandidate",data:$.param({candidateEmail:emailList.toString(),isHired:isHired})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Candidate</strong>",message:" archived successfully"}),$scope.getProfileDetails(),$scope.negative=!$scope.negative,setTimeout(function(){window.location.href="/sp/tools/hiring"},1e3))})},$scope.moveToCandidateList=function(email){var options={url:"/sp/hiring/moveToCandidate",data:$.param({candidateEmail:email})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&($localStorage.set("gNotify","moved"),setTimeout(function(){window.location="/sp/tools/hiring/"},100))})},$scope.confirmDelete=function(email){var options={url:"/sp/hiring/deleteArchiveCandidate",data:$.param({candidateEmail:email})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?($localStorage.set("gNotify","deleted"),setTimeout(function(){window.location="/sp/tools/hiring/"},100)):$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Server Error"})})},$scope.updateLinkedURL=function(l){if($scope.linkeDInFormStatus=!1,this.linkedinUpdate.$valid){var _o={url:"/sp/hiring/updateWebUrl",data:$.param({candidateEmail:$scope.emailFromParam,webUrl:l.linkedInUrl}).replace(/%40/g,"@").replace(/%2C/g,",")};$scope.disableLinkedinEditing=!0,ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&$scope.getProfileDetails()})}else $scope.linkeDInFormStatus=!0},$scope.hireCandidate=function(e,n,r){$scope.hireCandidateDetails={name:n,email:e,roles:r},$scope.member.firstName=$scope.hireCandidateDetails.name.split(" ")[0],$scope.member.lastName=$scope.hireCandidateDetails.name.split(" ")[1],$scope.isAdmin||$scope.isAccountAdmin?ajaxService.getAjaxResponse({url:"/sp/admin/member/availalbeMemberSubscriptions"}).then(function(response){"true"===response.Success&&($scope.memberAccountsCount=response.availalbeMemberSubscriptions,$scope.memberAccountsCount>0?($scope.getGroupList(),ngDialog.open({template:"/sp/resources/html/tools/hiring/hire-candidate.html",scope:$scope})):ngDialog.open({template:"/sp/resources/html/tools/hiring/hire-candidate-no-members.html",scope:$scope}))}):ngDialog.open({template:"/sp/resources/html/tools/hiring/hire-candidate-not-admin.html",scope:$scope}),$scope.hireCandidateArchive=function(){ajaxService.getAjaxResponse({url:"/sp/hiring/archiveCandidate",data:$.param({candidateEmail:$scope.hireCandidateDetails.email,isHired:!0})}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$localStorage.set("gNotify","AddHire"),setTimeout(function(){window.location="/sp/tools/hiring/"},500);else{for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})},$scope.addMember=function(fData){this.addNewMember.submitted=!1,this.addNewMember.$valid?ajaxService.getAjaxResponse({url:"/sp/admin/member/addSingle",data:$.param(fData).replace(/%2C/g,",")}).then(function(response){if("true"===response.Success)ajaxService.getAjaxResponse({url:"/sp/hiring/archiveCandidate",data:$.param({candidateEmail:$scope.hireCandidateDetails.email,isHired:!0})}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$localStorage.set("gNotify","AddHire"),setTimeout(function(){window.location="/sp/tools/hiring/"},500);else{ngDialog.close("ngdialog1");for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}});else{ngDialog.close("ngdialog1");for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}}):this.addNewMember.submitted=!0}},$scope.getGroupList=function(){ajaxService.getAjaxResponse({url:"/sp/admin/group/all"}).then(function(response){if("true"===response.Success)$scope.groupDataSet=response.groupInfoList,$scope.groupDataSetBackup=response.groupInfoList,jQuery.each($scope.groupDataSet,function(i,j){$scope.dataWithFlags.push(jQuery.extend({},$scope.groupDataSet[i],{selectedFlag:!1,isGroupLead:!1}))}),$scope.flagCounter=$scope.dataWithFlags.length;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.updateTagList=function(single,multiple){$scope.member.groupAssociationList=null,$scope.tagList=[],jQuery.each($scope.dataWithFlags,function(i,j){$scope.dataWithFlags[i].selectedFlag===!0&&multiple===!0?$scope.tagList.push($scope.dataWithFlags[i].name):$scope.dataWithFlags[i].selectedFlag===!0&&single===!0&&($scope.dataWithFlags[i].isGroupLead===!0?$scope.tagList.push($scope.dataWithFlags[i].name+":true"):$scope.tagList.push($scope.dataWithFlags[i].name+":false")),$scope.member.groupAssociationList=$scope.tagList.join()})},$scope.updateGroupLeadStatus=function(i,email,single,multiple,j){var _a=jQuery("body").find("a#gl_"+j);"undefined"!=typeof $scope.dataWithFlags[i]&&null===email&&($scope.dataWithFlags[i].isGroupLead===!0?($scope.dataWithFlags[i].isGroupLead=!1,_a.removeClass("on")):($scope.dataWithFlags[i].isGroupLead=!0,_a.addClass("on")),$scope.updateTagList(single,multiple))},$scope.changeGroup=function(flag,single,multiple){"default"!==flag&&("createGroupCall_custom"===flag?($scope.params={p1:single,p2:multiple},ngDialog.open({template:"/sp/admin/group/createGroup",scope:$scope})):($scope.dataWithFlags[flag].selectedFlag=!0,$scope.flagCounter-=1,$scope.updateTagList(single,multiple),$scope.member.gList="default",$scope.dataWithFlags[flag].newOrder=$scope.newOrderFlag++,$scope.dataWithFlags[flag].originalIndex=flag))},$scope.removeGroup=function(flag,single,multiple){"default"!==flag&&($scope.dataWithFlags[flag].selectedFlag=!1,$scope.dataWithFlags[flag].isGroupLead=!1,$scope.flagCounter+=1,$scope.updateTagList(single,multiple))},$scope.saveNewGroup=function(groupname,groupLeadEmailId){if(""===groupname||"undefined"==typeof groupname)return!1;var obj={name:groupname},options={url:"/sp/admin/group/create",data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&(ngDialog.close("ngdialog1"),$scope.dataWithFlags.push({name:groupname,groupLead:null,numOfMembers:0,memberSummaryList:null,selectedFlag:!0,originalIndex:$scope.dataWithFlags.length,newOrder:$scope.newOrderFlag}),$scope.flagCounter-=1,$scope.member.gList="default",$scope.newOrderFlag+=1,$scope.updateTagList($scope.params.p1,$scope.params.p2))})},$scope.initCandidateProfile=function(){$scope.isCandidateArchived!==!0&&$scope.getProfileDetails()},$scope.initCandidateProfile()}angular.module("spApp").controller("candidateProfileDetails",candidateProfileDetails),candidateProfileDetails.$inject=["$scope","$element","$attrs","$http","userDataService","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage"];
function candidateReferenceController($scope,$http,$element,$attrs,ajaxService){$scope.candidateRefList={},$scope.candidateRef={},$scope.uniqueEmailError=!1,$scope.processRefList=function(fData){if($scope.candidateRefList.submitted=!1,$scope.uniqueEmailError=!1,$scope.candidateRefList.$valid){var emails=[],uniqueEmails=[];if(emails[0]=fData.ref0.email,emails[1]=fData.ref1.email,emails[2]=fData.ref2.email,jQuery.each(emails,function(i,j){-1===jQuery.inArray(j,uniqueEmails)&&uniqueEmails.push(j)}),3===uniqueEmails.length){var _o,newData=[];newData[0]=fData.ref0,newData[1]=fData.ref1,newData[2]=fData.ref2,_o={url:"/sp/hiringCandidate/inviteReferences",data:newData,headers:{"Content-Type":"application/json"}},ajaxService.getAjaxResponse(_o).then(function(response){"true"===response.Success&&window.location.reload()})}else $scope.uniqueEmailError=uniqueEmails.length<3?!0:!1,jQuery("html, body").animate({scrollTop:0})}else $scope.candidateRefList.submitted=!0,jQuery("html, body").animate({scrollTop:0})}}angular.module("spApp").controller("candidateReferenceController",candidateReferenceController),candidateReferenceController.$inject=["$scope","$http","$element","$attrs","ajaxService"];
function ccUpdateController($scope,$element,$attrs,$http,ngDialog,ajaxService,sharedProperties){$scope.updateCC={},$scope.updateCC.submitted=!1,$scope.dialogStatus={},$scope.updateCcDetails=function(fData){$scope.updateCC.submitted=!1,$scope.updateCC.$valid?ajaxService.getAjaxResponse({url:"/sp/admin/account/updatePaymentInstrument",data:$.param(fData)}).then(function(response){if("true"===response.Success)$scope.dialogStatus.title="Update Credit Card Details",$scope.dialogStatus.content="Details updated successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/success-dialog.html",scope:$scope});else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}}):$scope.updateCC.submitted=!0},$scope.cancelRedirect=function(){var url=window.location.href,isIndividual=url.substring(url.indexOf("#")+1).replace(/\//g,"").split("?")[1];"i"===isIndividual?window.location="/sp/admin/account/individual":window.location="/sp/admin/account/business"}}angular.module("spApp").controller("ccUpdateController",ccUpdateController),ccUpdateController.$inject=["$scope","$element","$attrs","$http","ngDialog","ajaxService"];
function changeSubscriptionController($scope,$element,$attrs,$http,ngDialog,$timeout,ajaxService){$scope.priceFormatter=function(p){if("undefined"!=typeof p&&""!==p&&null!==p){var formattedPrice="$"+p.toFixed(2);return formattedPrice}},$scope.product={},$scope.promoApplied=!1,$scope.finalAmount=0,$scope.promo={},$scope.updatedPromoDetails={},$scope.updateCC={},$scope.activeMembers=0,$scope.renewBusiness={},$scope.account={},$scope.promoFormSubmitted=!1,$scope.promoError={},$scope.promoError.error=!1,$scope.dialogStatus={},$scope.timeout=0,$scope.submitDisabled=!1,$scope.getMemberCount=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/getActiveMemberCount"}).then(function(response){if("true"===response.Success)$scope.activeMembers=response.activeMembers,$scope.account.numAccounts=response.activeMembers;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getAcccountInfo=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/businessAccountDetails"}).then(function(response){if("true"===response.Success)$scope.accountDetails=response,$scope.renewalDate=response.account.productInfo.renewalDate;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getPlanInfo=function(){ajaxService.getAjaxResponse({url:"/sp/signup/getProducts",data:$.param({productType:"BUSINESS"})}).then(function(response){if("true"===response.Success)$scope.products=response.products,$.each($scope.products,function(i){"YEARLY"===$scope.products[i].validityType&&($scope.annualProduct=$scope.products[i],$scope.annulUnitPrice=$scope.products[i].unitPrice)});else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getProductInfo=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/getCurrentBusinessProductInfo"}).then(function(response){if("true"===response.Success){$scope.productInfoError=!1,$scope.submitDisabled=!1,$scope.product=response.product;var multiplier=12;"undefined"!=typeof response.promotion&&"undefined"!=typeof response.promotion.unitPrice?($scope.product.updatedUnitPrice=parseFloat(response.promotion.unitPrice).toFixed(2),$scope.promoApplied=!0,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.activeMembers*multiplier).toFixed(2)):($scope.product.updatedUnitPrice=parseFloat(response.product.unitPrice).toFixed(2),$scope.promoApplied=!1,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.activeMembers*multiplier).toFixed(2))}else $scope.productInfoError=!0,$scope.submitDisabled=!0,jQuery("html, body").animate({scrollTop:0})})},$scope.paymentCalculator=function(empNo,action,type,event){var currentEmpNo=parseInt(empNo),updatedEmpNo=0,multiplier="YEARLY"===type?12:1;"undefined"==typeof event?currentEmpNo>=20&&"add"===action?(updatedEmpNo=parseInt(currentEmpNo+1),$scope.account.numAccounts=updatedEmpNo,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*updatedEmpNo*multiplier).toFixed(2)):currentEmpNo>20&&"remove"===action?(updatedEmpNo=parseInt(currentEmpNo-1),$scope.account.numAccounts=updatedEmpNo,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*updatedEmpNo*multiplier).toFixed(2)):($scope.account.numAccounts=parseInt($scope.account.minEmployee),$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.account.numAccounts*multiplier).toFixed(2)):/^[0-9\b]+$/g.test(empNo)&&empNo>=20?($scope.account.numAccounts=empNo,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.account.numAccounts*multiplier).toFixed(2),$timeout.cancel($scope.timeout)):($timeout.cancel($scope.timeout),$scope.timeout=$timeout(function(){$scope.account.numAccounts=20,$scope.finalAmount=parseFloat(20*$scope.product.updatedUnitPrice*multiplier).toFixed(2)},1500))},$scope.activatePromo=function(promoCode){if("undefined"!=typeof promoCode){var _params={code:promoCode,productId:$scope.product.id};ajaxService.getAjaxResponse({url:"/sp/signup/promotion",data:$.param(_params)}).then(function(response){"true"===response.Success?($scope.updatedPromoDetails=response.promotion,$scope.product.updatedUnitPrice=parseFloat(response.promotion.unitPrice).toFixed(2),$scope.promoApplied=!0,$scope.finalAmount=parseFloat(12*$scope.product.updatedUnitPrice).toFixed(2)):($scope.promoError.error=!0,$scope.promoError.msg=response.error,$scope.promo.code=null,$timeout(function(){$scope.promoError.error=!1},1500))})}else $scope.promoFormSubmitted=!0,$scope.promo.code=null},$scope.renewIndividualSubscription=function(fData){var _paramsUpdated,_params={};_params=$scope.promoApplied===!1?{productId:$scope.product.id}:{productId:$scope.product.id,promotionId:$scope.updatedPromoDetails.id},$scope.updateCC.$valid?(_paramsUpdated=$.extend({},_params,fData),ajaxService.getAjaxResponse({url:"/sp/admin/account/renewAccount",data:$.param(_paramsUpdated)}).then(function(response){if("true"===response.Success)$scope.dialogStatus.title="Subscription Renewal",$scope.dialogStatus.content="Subscription renewed successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/success-dialog.html",scope:$scope});else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})):$scope.updateCC.submitted=!0},$scope.deactivatePromo=function(){$scope.product.updatedUnitPrice=parseFloat($scope.product.unitPrice).toFixed(2),$scope.finalAmount=parseFloat(12*$scope.product.updatedUnitPrice).toFixed(2),$scope.promoApplied=!1,$scope.promo.code=null},$scope.cancelRedirect=function(){window.location="/sp/admin/account/business"},$scope.renewBusinessSubscription=function(fData){var _paramsUpdated,_params={};_params=$scope.promoApplied===!1?{numAccounts:$scope.account.numAccounts,productId:$scope.product.id}:{numAccounts:$scope.account.numAccounts,productId:$scope.product.id,promotionId:$scope.updatedPromoDetails.id},$scope.submitDisabled===!1&&($scope.renewBusiness.$valid?(_paramsUpdated=$.extend({},_params,fData),ajaxService.getAjaxResponse({url:"/sp/admin/account/renewAccount",data:$.param(_paramsUpdated)}).then(function(response){"true"===response.Success?console.log("Success"):($scope.submitException=!0,$scope.submitExceptionMsg="undefined"!=typeof response.error.InvalidRequestException?response.error.InvalidRequestException:"Error occured on server.",jQuery("html, body").animate({scrollTop:0}))})):($scope.renewBusiness.submitted=!0,jQuery("html, body").animate({scrollTop:0})))},$scope.initRenewBusiness=function(){$scope.getMemberCount(),$scope.getProductInfo(),$scope.getAcccountInfo()},$scope.initRenewBusiness()}angular.module("spApp").controller("changeSubscriptionController",changeSubscriptionController),changeSubscriptionController.$inject=["$scope","$element","$attrs","$http","ngDialog","$timeout","ajaxService"];
function companyThemingController($scope,ajaxService,$localStorage,ngDialog,sharedProperties,filterFilter,$filter,$rootScope,$timeout){function switchThemeView(){"normal"===self.themeViewMode?(self.themeViewMode="preview",jQuery(".theme-normal").fadeOut(),jQuery(".theme-preview").fadeIn()):(self.themeViewMode="normal",jQuery(".theme-preview").fadeOut(),jQuery(".theme-normal").fadeIn())}function cloneOrCreateNewSettings(obj){"new"===obj.mode?window.location.href="/sp/sysAdmin/company/theming/update?id="+obj.id:(self.selectedCompanyId=obj.id,self.selectedCompanyName=obj.name,self.selectedCompanyAdminAccess=obj.hasThemeAccess,self.selectedCompanyLogo=obj.logo),ngDialog.close()}function filterResults(){var resp=$filter("companyThemingFilter")(self.masterCompanyList,self.filterType,self.searchText,filterFilter);self.dataSorted&&(resp=$filter("orderBy")(resp,self.lastPredicate,self.lastReverse)),self.companyList=[],self.companyList=resp}function clearSearch(){""!==self.searchText&&(self.searchText=""),self.filterResults()}function getAllCustomizedCompanies(){ajaxService.getAjaxResponse({url:self.serviceApis.getAllCustomizedCompanies,method:"POST"}).then(function(response){if("true"===response.Success)self.responseAvailable=!0,self.masterCompanyList=response.companyList,self.companyList=angular.copy(self.masterCompanyList);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getAllNonCustomizedCompanies(type){ajaxService.getAjaxResponse({url:self.serviceApis.getAllNonCustomizedCompanies,method:"POST"}).then(function(response){if("true"===response.Success)self.masterCompanyNonCustomizedList=response.companyList,self.companyNonCustomizedList=angular.copy(self.masterCompanyNonCustomizedList),self.responseAvailableForModal=!0,openSelectCompanyModal(type);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function updateThemeAccess(status){ajaxService.getAjaxResponse({url:status===!0?self.serviceApis.activateThemeAccess:self.serviceApis.deactivateThemeAccess,data:$.param({companyId:self.selectedCompanyId})}).then(function(response){if("true"===response.Success)$.growl({icon:"glyphicon glyphicon-ok",message:"Status Updated Successfully"});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function updateThemeData(type){prepareColorMap();var companyThemeForm={companyId:"superAdmin"===type?self.selectedCompanyId:"",stylesMap:self.themeFormMap};ajaxService.getAjaxResponse({url:"superAdmin"===type?self.serviceApis.updateThemeData:self.serviceApis.updateThemeDataForAccountAdmin,data:companyThemeForm,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)$.growl({icon:"glyphicon glyphicon-ok",message:"The theme has been saved successfully."}),$timeout(function(){jQuery(".theme-preview").fadeOut(),jQuery(".theme-normal").fadeIn()},500);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function resetThemeModal(type,id){$scope.resetThemeRequest=type,$scope.resetCompanyId=id,ngDialog.open({template:"/sp/resources/html/sysAdmin/theming/reset-theme-modal.html",scope:$scope})}function resetToOriginalTheme(){ajaxService.getAjaxResponse({url:self.serviceApis.resetToOriginalTheme,data:$.param({companyId:"default"})}).then(function(response){if(ngDialog.close(),"true"===response.Success)$.growl({icon:"glyphicon glyphicon-ok",message:"Theme has been reset to Original State"}),$timeout(function(){window.location.reload()},500);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function resetToDefaultTheme(type,id){ajaxService.getAjaxResponse({url:"superAdmin"===type?self.serviceApis.resetToDefaults:self.serviceApis.resetToDefaultsForAccountAdmin,data:"superAdmin"===type?$.param({companyId:id}):""}).then(function(response){if(ngDialog.close(),"true"===response.Success)$.growl({icon:"glyphicon glyphicon-ok",message:"Theme has been reset to Default State"}),$timeout(function(){window.location.reload()},500);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function openSelectCompanyModal(type){self.createMode=type;var dialog=ngDialog.open({template:self.serviceApis.openCompanyModal,scope:$scope});dialog.closePromise.then(function(data){self.companySearchText=""})}function selectCompany(type){self.masterCompanyNonCustomizedList.length?openSelectCompanyModal(type):getAllNonCustomizedCompanies(type)}function resetResults(){self.searchText="",self.dataSorted=!1,self.filterType="all",self.companyList=[],self.companyList=angular.copy(self.masterCompanyList)}function active(event,setting){self.lastPredicate=setting.predicate,self.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.lastPredicate),self.sortResults(self.lastPredicate,self.lastReverse)}function sortResults(predicate,reverse){self.lastPredicate=predicate,self.lastReverse=reverse;var resp=$filter("orderBy")(self.masterCompanyList,predicate,reverse);resp=$filter("companyThemingFilter")(resp,self.filterType,self.searchText,filterFilter),self.companyList=[],self.companyList=resp,self.dataSorted=!0}function getThemeData(type){var param=getParameter("id");null===param&&(param="default"),self.selectedCompanyId=param,ajaxService.getAjaxResponse({url:"superAdmin"===type?self.serviceApis.getDetails:self.serviceApis.getDetailsForAccountAdmin,data:"superAdmin"===type?$.param({companyId:param}):"",method:"POST"}).then(function(response){if("true"===response.Success)self.themeData=response.compThemeDetail,self.selectedCompanyName=self.themeData.name,self.selectedCompanyAdminAccess=self.themeData.hasThemeAccess,self.selectedCompanyLogo=self.themeData.logoURL,$("#showMainNavBgColor").spectrum("set",self.themeData.companyTheme.stylesMap.spMainNavBackgroundColor),$("#showMainNavHoverColor").spectrum("set",self.themeData.companyTheme.stylesMap.spMainNavColor),$("#showSubNavBgColor").spectrum("set",self.themeData.companyTheme.stylesMap.spSubNavBackgroundColor),$("#showSubNavLinkColor").spectrum("set",self.themeData.companyTheme.stylesMap.spSubNavLinkColor),$("#showButtonColor").spectrum("set",self.themeData.companyTheme.stylesMap.spButtonColor),$("#showIconColor").spectrum("set",self.themeData.companyTheme.stylesMap.spIconColor),$("#showLinkColor").spectrum("set",self.themeData.companyTheme.stylesMap.spLinkColor),$("#showLinkHoverColor").spectrum("set",self.themeData.companyTheme.stylesMap.spLinkHoverColor),self.buttonHoverColor=self.themeData.companyTheme.stylesMap.spButtonHoverColor,$("#showPanelAccent").spectrum("set",self.themeData.companyTheme.stylesMap.spPanelAccentbarColor),$("#showHeaderAccent").spectrum("set",self.themeData.companyTheme.stylesMap.spHeaderAccentbarColor),$("#showSignInAccent").spectrum("set",self.themeData.companyTheme.stylesMap.spSigninAccentbarColor),$("#showHeaderTitleColor").spectrum("set",self.themeData.companyTheme.stylesMap.spHeaderTitleColor),$("#showFooterBackgroundColor").spectrum("set",self.themeData.companyTheme.stylesMap.spFooterBackgroundColor),$("#showFooterNavTextColor").spectrum("set",self.themeData.companyTheme.stylesMap.spFooterNavigationTextColor),$("#showFooterNavHoverColor").spectrum("set",self.themeData.companyTheme.stylesMap.spFooterNavigationHoverColor),$(".section-preview-content .nav-main-app").css("background-color",$("#showMainNavBgColor").val()),$(".section-preview-content .nav-dashboard h2 span").css("color","#fff"),$(".section-preview-content .nav-dashboard h2.active span").css("color",$("#showMainNavHoverColor").val()),$(".section-preview-content .nav-dashboard h2 span").mouseover(function(){$(this).css("color",$("#showMainNavHoverColor").val())}).mouseout(function(){$(this).css("color","#fff")}),$(".section-preview-content .container.blueBar+.bg-sub-nav").css({"background-color":$("#showSubNavBgColor").val(),"background-image":"none"}),$(".section-preview-content .bg-sub-nav").css({"background-color":$("#showSubNavBgColor").val(),"background-image":"none"}),$("body").append("<style>.section-preview-content .nav-main-app-toc h2::after{border-bottom:5px solid "+$("#showSubNavBgColor").val()+"}</style>"),$(".section-preview-content .nav-main-app-toc li.active a span").css("color",$("#showSubNavLinkColor").val()),$(".section-preview-content .nav-main-app-toc li a, .section-preview-content .nav-main-app-toc li.active a").mouseover(function(){$(this).find("span").css({color:$("#showSubNavLinkColor").val(),"border-color":$("#showSubNavLinkColor").val()})}).mouseout(function(){$(this).find("span").css({color:"#fff","border-color":"none"})}),$(".section-preview-content .sp-btn-color").css({"border-bottom":"none",background:$("#showButtonColor").val(),"box-shadow":"0px 4px 0px -2px "+self.buttonHoverColor}),$(".section-preview-content .sp-btn-color").hover(function(){$(this).css("background-color",self.buttonHoverColor)}).mouseout(function(){$(this).css("background-color",$("#showButtonColor").val())}),$(".section-preview-content .sp-icon-color").css("color",$("#showIconColor").val()),$(".section-preview-content a").css("color",$("#showLinkColor").val()),$(".section-preview-content .sp-link-color").css("color",$("#showLinkColor").val()),$(".section-preview-content a").mouseover(function(){$(this).css("color",$("#showLinkHoverColor").val())}).mouseout(function(){$(this).css("color",$("#showLinkColor").val())}),$(".section-preview-content .sp-panel-accent").css("border-top","4px solid "+$("#showPanelAccent").val()),$(".section-preview-content .sp-header-accent").css("background-color",$("#showHeaderAccent").val()),$(".section-preview-content #header.signInBorder+#content, #header.signInBorder+#content-container").css("border-top","solid 7px "+$("#showSignInAccent").val()),$(".section-preview-content .sp-header-title-color").css("color",$("#showHeaderTitleColor").val()),$(".section-preview-content .footer-wrapper").css("background",$("#showFooterBackgroundColor").val()),$(".section-preview-content .sp-footer-text-color").css("color",$("#showFooterNavTextColor").val()),$(".section-preview-content footer a").mouseover(function(){$(this).css("color",$("#showFooterNavHoverColor").val())}).mouseout(function(){$(this).css("color",$("#showFooterNavTextColor").val())});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function uploadCompanyLogo(){self.imageEditBox=!1,$scope.themeCompanyId=self.selectedCompanyId,ngDialog.open({template:"/sp/resources/html/admin/account/upload-company-pic.html",scope:$scope})}function deleteImageModal(){self.imageEditBox=!1,$scope.imageType="company",ngDialog.open({template:"/sp/resources/html/admin/account/delete-image-modal.html",scope:$scope})}function showImageEdit(){self.imageEditBox=!self.imageEditBox,null===self.selectedCompanyLogo&&(self.uploadCompanyLogo(),self.imageEditBox=!1)}var self=this;self.serviceApis={updateTheme:"/sp/sysAdmin/company/createTheme",getDetails:"/sp/sysAdmin/company/getThemeDetail",getAllCustomizedCompanies:"/sp/sysAdmin/company/getAllCustomizedCompany",getAllNonCustomizedCompanies:"/sp/sysAdmin/company/getAllNotCustomizedCompany",openCompanyModal:"/sp/sysAdmin/company/theming/selectCompany",resetToDefaults:"/sp/sysAdmin/company/removeThemeSettings",activateThemeAccess:"/sp/sysAdmin/company/activate",deactivateThemeAccess:"/sp/sysAdmin/company/deactivate",updateThemeData:"/sp/sysAdmin/company/createTheme",getDetailsForAccountAdmin:"/sp/admin/company/getThemeDetail",updateThemeDataForAccountAdmin:"/sp/admin/company/saveTheme",resetToDefaultsForAccountAdmin:"/sp/admin/company/resetTheme",resetToOriginalTheme:"/sp/sysAdmin/company/resetTheme"},self.responseAvailable=!1,self.responseAvailableForModal=!1,self.companySearchText="",self.searchText="",self.masterCompanyList=[],self.companyList=[],self.masterCompanyNonCustomizedList=[],self.companyNonCustomizedList=[],self.themeData={},self.selectedCompanyId="default",self.selectedCompanyName="default",self.selectedCompanyAdminAccess=!1,self.selectedCompanyLogo="",self.lastPredicate="name",self.lastReverse=!1,self.companyInfo={},self.filterType="all",self.themeFormMap={},self.dataSorted=!1,self.imageEditBox=!1,self.createMode="",self.buttonHoverColor="",self.themeViewMode="normal",self.selectCompany=selectCompany,self.getAllCustomizedCompanies=getAllCustomizedCompanies,self.active=active,self.sortResults=sortResults,self.resetResults=resetResults,self.getThemeData=getThemeData,self.updateThemeAccess=updateThemeAccess,self.resetToDefaultTheme=resetToDefaultTheme,self.resetThemeModal=resetThemeModal,self.updateThemeData=updateThemeData,self.cloneOrCreateNewSettings=cloneOrCreateNewSettings,self.filterResults=filterResults,self.clearSearch=clearSearch,self.uploadCompanyLogo=uploadCompanyLogo,self.deleteImageModal=deleteImageModal,self.showImageEdit=showImageEdit,self.getAllNonCustomizedCompanies=getAllNonCustomizedCompanies,self.switchThemeView=switchThemeView,self.resetToOriginalTheme=resetToOriginalTheme;var prepareColorMap=function(){self.themeFormMap.spMainNavBackgroundColor=$("#showMainNavBgColor").val(),self.themeFormMap.spMainNavColor=$("#showMainNavHoverColor").val(),self.themeFormMap.spSubNavBackgroundColor=$("#showSubNavBgColor").val(),self.themeFormMap.spSubNavLinkColor=$("#showSubNavLinkColor").val(),self.themeFormMap.spButtonColor=$("#showButtonColor").val(),self.themeFormMap.spButtonHoverColor=self.buttonHoverColor,self.themeFormMap.spIconColor=$("#showIconColor").val(),self.themeFormMap.spLinkColor=$("#showLinkColor").val(),self.themeFormMap.spLinkHoverColor=$("#showLinkHoverColor").val(),self.themeFormMap.spPanelAccentbarColor=$("#showPanelAccent").val(),self.themeFormMap.spHeaderAccentbarColor=$("#showHeaderAccent").val(),self.themeFormMap.spSigninAccentbarColor=$("#showSignInAccent").val(),self.themeFormMap.spHeaderTitleColor=$("#showHeaderTitleColor").val(),self.themeFormMap.spFooterBackgroundColor=$("#showFooterBackgroundColor").val(),self.themeFormMap.spFooterNavigationTextColor=$("#showFooterNavTextColor").val(),self.themeFormMap.spFooterNavigationHoverColor=$("#showFooterNavHoverColor").val()},getParameter=function(val){for(var query=window.location.search.substring(1),vars=query.split("&"),pair=[],i=0;i<vars.length;i++)return pair=vars[i].split("="),pair[0]===val?pair[1]:null},darkerButtonColor=function(buttonColor){function hex(x){return("0"+parseInt(x).toString(16)).slice(-2)}var buttonHoverColor="",splitRGB=buttonColor.substring(buttonColor.indexOf("(")+1,buttonColor.lastIndexOf(")")).split(/,\s*/),red=parseInt(splitRGB[0])-51,green=parseInt(splitRGB[1])-51,blue=parseInt(splitRGB[2])-51;return red=red>0?red:0,green=green>0?green:0,blue=blue>0?blue:0,buttonHoverColor="#"+hex(red)+hex(green)+hex(blue)};jQuery(function($){if(jQuery(".theme-preview").hide(),$(".admin-theming-section").length){var $list=$(".nav-support-link-list"),$contentArea=$(".main-support-content");$list.find("li a").on("click",function(){var _this=$(this),listId=_this.attr("data-list");_this.text();toggleHideShow(listId,_this)});var toggleHideShow=function(listId,_this){$list.find("li a").removeClass("active"),_this.addClass("active"),$contentArea.find(".support-customer").removeClass("local-show"),$contentArea.find(".support-customer[data-tab='"+listId+"']").addClass("local-show")};$("#showMainNavBgColor").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showMainNavHoverColor").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showSubNavBgColor").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showSubNavLinkColor").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showButtonColor").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showIconColor").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showLinkColor").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showLinkHoverColor").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showPanelAccent").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showHeaderAccent").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showSignInAccent").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showHeaderTitleColor").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showFooterBackgroundColor").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showFooterNavTextColor").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showFooterNavHoverColor").spectrum({showPalette:!0,showSelectionPalette:!0,palette:[],maxSelectionSize:21,preferredFormat:"hex3",showInput:!0,localStorageKey:"sp.colors"}),$("#showMainNavBgColor").on("change.spectrum",function(e,color){$(".section-preview-content .nav-main-app").css("background-color",color.toHexString())}),$("#showMainNavHoverColor").on("change.spectrum",function(e,color){$(".section-preview-content .nav-dashboard h2 span").css("color","#fff"),$(".section-preview-content .nav-dashboard h2.active span").css("color",color.toHexString()),$(".section-preview-content .nav-dashboard h2 span").mouseover(function(){$(this).css("color",color.toHexString())}).mouseout(function(){$(this).css("color","#fff")})}),$("#showSubNavBgColor").on("change.spectrum",function(e,color){$(".section-preview-content .container.blueBar+.bg-sub-nav").css({"background-color":color.toHexString(),"background-image":"none"}),$(".section-preview-content .bg-sub-nav").css({"background-color":color.toHexString(),"background-image":"none"}),$("body").append("<style>.section-preview-content .nav-main-app-toc h2::after{border-bottom:5px solid "+color.toHexString()+"}</style>")}),$("#showSubNavLinkColor").on("change.spectrum",function(e,color){$(".section-preview-content .nav-main-app-toc li.active a span").css("color",color.toHexString()),$(".section-preview-content .nav-main-app-toc li a, .section-preview-content .nav-main-app-toc li.active a").mouseover(function(){$(this).find("span").css({color:color.toHexString(),"border-color":color.toHexString()})}).mouseout(function(){$(this).find("span").css({color:"#fff","border-color":"none"})})}),$("#showButtonColor").on("change.spectrum",function(e,color){self.buttonHoverColor=darkerButtonColor(color.toRgbString()),$(".section-preview-content .sp-btn-color").css({"border-bottom":"none",background:color.toHexString(),"box-shadow":"0px 4px 0px -2px "+self.buttonHoverColor}),$(".section-preview-content .sp-btn-color").hover(function(){$(this).css("background-color",self.buttonHoverColor)}).mouseout(function(){$(this).css("background-color",color.toHexString())})}),$("#showIconColor").on("change.spectrum",function(e,color){$(".section-preview-content .sp-icon-color").css("color",color.toHexString())}),$("#showLinkColor").on("change.spectrum",function(e,color){$(".section-preview-content a").css("color",color.toHexString()),$(".section-preview-content .sp-link-color").css("color",color.toHexString())}),$("#showLinkHoverColor").on("change.spectrum",function(e,color){$(".section-preview-content a").mouseover(function(){$(this).css("color",color.toHexString())}).mouseout(function(){$(this).css("color",$("#showLinkColor").val())})}),$("#showPanelAccent").on("change.spectrum",function(e,color){$(".section-preview-content .sp-panel-accent").css("border-top","4px solid "+color.toHexString())}),$("#showHeaderAccent").on("change.spectrum",function(e,color){$(".section-preview-content .sp-header-accent").css("background-color",color.toHexString())}),$("#showSignInAccent").on("change.spectrum",function(e,color){$(".section-preview-content #header.signInBorder+#content, #header.signInBorder+#content-container").css("border-top","solid 7px "+color.toHexString())}),$("#showHeaderTitleColor").on("change.spectrum",function(e,color){$(".section-preview-content .sp-header-title-color").css("color",color.toHexString())}),$("#showFooterBackgroundColor").on("change.spectrum",function(e,color){$(".section-preview-content .footer-wrapper").css("background",color.toHexString())}),$("#showFooterNavTextColor").on("change.spectrum",function(e,color){$(".section-preview-content .sp-footer-text-color").css("color",color.toHexString())}),$("#showFooterNavHoverColor").on("change.spectrum",function(e,color){$(".section-preview-content footer a").mouseover(function(){$(this).css("color",color.toHexString())}).mouseout(function(){$(this).css("color",$("#showFooterNavTextColor").val())})})}}),$scope.deleteImage=function(){ajaxService.getAjaxResponse({url:"/sp/admin/company/deleteImage",data:$.param({companyId:self.selectedCompanyId})}).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:" Image Deleted Successfully"}),self.selectedCompanyLogo=null,$localStorage.remove("loggegdInProfile")):$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Image delete process failed."})})},$(document).on("imageSaved",function(e,data){$scope.$apply(function(){self.selectedCompanyLogo=data.imageData})}),$("body").click(function(e){$(".image-edit-box").is(e.target)||0!==$(".image-edit-box").has(e.target).length||$(".upload-icon").is(e.target)||self.imageEditBox&&$scope.$apply(function(){self.imageEditBox=!1})})}angular.module("spApp").controller("companyThemingController",companyThemingController),angular.module("spApp").filter("companyThemingFilter",function(){return function(items,filterType,searchText,filterFilter){var filtered=[];return angular.forEach(items,function(item){"all"===filterType?filtered.push(item):"adminAccess"===filterType&&item.hasThemeAccess?filtered.push(item):"customization"===filterType&&item.companyThemeActive&&filtered.push(item),""!==searchText&&(filtered=filterFilter(filtered,searchText))}),filtered}}),companyThemingController.$inject=["$scope","ajaxService","$localStorage","ngDialog","sharedProperties","filterFilter","$filter","$rootScope","$timeout"];
function competenciesController($scope,ajaxService,$localStorage,$state,$q,sharedProperties,$filter,$rootScope,ngDialog,$timeout){function openTaskModal(type){"CompetencyEvaluationInitiate"===type?self.initiateEvaluationModal("selfInitiate","SELF"):"CompetencyEvaluationSelf"===type&&self.startEvaluation("self"),null!==localStorage.getItem("competencyAlertType")&&localStorage.removeItem("competencyAlertType")}function startEvaluation(user){self.currentIndexForRating=0,self.ratingScoreArray=[],self.userType=user,ajaxService.getAjaxResponse({url:self.config.startEvaluation,data:$.param({memberId:"self"!==user?user:""}),method:"POST"}).then(function(response){if("true"===response.Success){self.winHeight=$(window).height()+100+"px";var screenWidth=document.documentElement.clientWidth;self.responseAvailableForModal=!0,self.competencyProfileForRating=response.competencyProfile,self.userToBeAssessed=response.user,self.selectedCompetencyForRating=self.competencyProfileForRating.competencyList[0];ngDialog.open({template:screenWidth>768?"/sp/resources/html/competency/rating-desktop.html":self.config.startEvaluationModal,scope:$scope,className:screenWidth>767?"ngdialog-theme-default":"new-mobile-theme"});self.competencyRatingScore=3,$rootScope.$on("ngDialog.opened",function(e,$dialog){var $r=jQuery('input[type="range"]');$r.rangeslider({polyfill:!1,onInit:function(){$timeout(function(){jQuery("#cmrc-desc-cont_"+self.competencyRatingScore).addClass("slideRight")},100)},onSlideEnd:function(position,value){$scope.$apply(function(){jQuery("#cmrc-desc-cont_"+self.competencyRatingScore).removeClass("slideRight"),self.competencyRatingScore=value,self.ratingScoreArray[self.currentIndexForRating]=self.competencyRatingScore,self.prevScores=angular.copy(self.ratingScoreArray),$timeout(function(){jQuery("#cmrc-desc-cont_"+self.competencyRatingScore).addClass("slideRight")},100)})}})})}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage}),$timeout(function(){window.location.reload()},1e3)}})}function saveEvaluation(){self.ratingScoreArray.length!==self.competencyProfileForRating.competencyList.length&&self.ratingScoreArray.push(3),ajaxService.getAjaxResponse({url:self.config.saveEvaluation,data:$.param({memberId:"self"!==self.userType?self.userType:"",scoreArray:self.ratingScoreArray.join()}),method:"POST"}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.selfEvaluationComplete")}),sharedProperties.fireAnalyticsEvent("Competency | Self Evaluation Completed","N/A"),$timeout(function(){window.location.reload()},1e3);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function initiateEvaluationModal(type,userToProcess){self.winHeight=$(window).height()+100+"px",self.inputRequired=!1,self.multipleManager=!1,self.repeatedRequests=!1,self.assignToSelf=!1,self.searchTagEmail=[],self.searchTag=[],self.searchTagPeer=[],self.initiateRequestType=type,self.userToProcess=userToProcess,self.emailMemberList.length||self.getMemberList();ngDialog.open({template:self.config.initiateEvaluationModal,scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"})}function validateReviewerInfo(managerEmail,peerInfo){var userEmail=$localStorage.get("loggegdInProfile").member.email;if(userEmail===managerEmail)return void(self.assignToSelf=!0);for(var i=0;i<peerInfo.length;i++)if(userEmail===peerInfo[i].email){self.assignToSelf=!0;break}}function initiateEvaluation(){if(self.initiateEvaluation.submitted=!1,self.repeatedRequests=!1,self.multipleManager=!1,self.assignToSelf=!1,void 0===self.searchTagEmail[0])return void(self.inputRequired=!0);if(self.searchTagEmail.length>1)return void(self.multipleManager=!0);if(validateReviewerInfo(self.searchTagEmail[0].email,self.searchTagPeer),!self.assignToSelf){var userForEmail="",obj={},manager={},peerUser={},peerUserList=[];if(self.searchTagPeer.length)for(var i=0;i<self.searchTagPeer.length;i++){if(self.searchTagPeer[i].email===self.searchTagEmail[0].email)return void(self.repeatedRequests=!0);peerUser={firstName:void 0!==self.searchTagPeer[i].firstName?self.searchTagPeer[i].firstName:"",lastName:void 0!==self.searchTagPeer[i].lastName?self.searchTagPeer[i].lastName:"",email:self.searchTagPeer[i].email,existingUserEmail:void 0!==self.searchTagPeer[i].firstName?self.searchTagPeer[i].email:""},peerUserList.push(peerUser)}self.initiateEvaluationForm.$valid?(manager={firstName:self.searchTagEmail[0].firstName,lastName:self.searchTagEmail[0].lastName,email:self.searchTagEmail[0].email},"SELF"!==self.userToProcess&&(userForEmail=self.userToProcess.email),obj={manager:manager,peerList:peerUserList,userForEmail:userForEmail},ajaxService.getAjaxResponse({url:self.config.initiateEvaluation,data:obj,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.selfInitiate")}),sharedProperties.fireAnalyticsEvent("Competency | Evaluation Initiated","N/A"),$timeout(function(){window.location.reload()},500);else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage}),$timeout(function(){window.location.reload()},1e3)}})):self.initiateEvaluation.submitted=!0}}function prevEvaluation(){0!==self.currentIndexForRating&&(self.currentIndexForRating=self.currentIndexForRating-1,self.selectedCompetencyForRating=self.competencyProfileForRating.competencyList[self.currentIndexForRating],self.competencyRatingScore=self.prevScores[self.currentIndexForRating],jQuery('input[type="range"]').val(self.competencyRatingScore).change())}function nextEvaluation(){self.currentIndexForRating+1!==self.competencyProfileForRating.competencyList&&(self.currentIndexForRating=self.currentIndexForRating+1,self.selectedCompetencyForRating=self.competencyProfileForRating.competencyList[self.currentIndexForRating],void 0===self.ratingScoreArray[self.currentIndexForRating]?(self.competencyRatingScore=3,self.ratingScoreArray.push(parseFloat(self.competencyRatingScore)),self.prevScores=angular.copy(self.ratingScoreArray)):self.competencyRatingScore=self.ratingScoreArray[self.currentIndexForRating],jQuery('input[type="range"]').val(self.competencyRatingScore).change())}function developmentRedirect(options){self.devStrategy={id:options.devStrategyId,desc:options.desc},self.state(options.state)}function viewDetails(group){self.viewDetailsListIndex=group,self.viewDetailsList=group in self.allNotesFeedbackData?self.allNotesFeedbackData[group]:null;var $enableSCroll=$(".overflow-enable");$enableSCroll.length&&$enableSCroll.scrollTop(0)}function getNotesFeedbackForGoal(options){ajaxService.getAjaxResponse({url:self.config.getNotesFeedbackForGoal+options.goalId+"&memberEmail="+$rootScope.noSelf,method:"get"}).then(function(response){if("true"===response.Success){var temp={};self.viewDetailsList=null,self.feedRequired=!1,self.masterAllNotesFeedbackData={};for(var i=0;i<response.notesAndFeedbackList.length;i++)response.notesAndFeedbackList[i].type in temp?temp[response.notesAndFeedbackList[i].type].push(response.notesAndFeedbackList[i]):(temp[response.notesAndFeedbackList[i].type]=[],temp[response.notesAndFeedbackList[i].type].push(response.notesAndFeedbackList[i]));Object.keys(temp).sort().reverse().forEach(function(key){self.masterAllNotesFeedbackData[key]=temp[key]}),self.allNotesFeedbackData=angular.copy(self.masterAllNotesFeedbackData),self.allNotesFeedbackLength=Object.keys(self.masterAllNotesFeedbackData),self.selectedGroup=Object.keys(self.allNotesFeedbackData)[0],self.allNotesFeedbackLength.length&&self.viewDetails(void 0===options.indexName?self.selectedGroup:options.indexName),void 0!==options.mode&&(sortList(),self.winWidth>767&&$state.go(options.mode))}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function sortList(){""!==self.devStrategy.id&&null!==self.viewDetailsList&&Object.keys(self.allNotesFeedbackData).length?self.filteredViewDetailsList=self.viewDetailsList.filter(function(e){return null!==e.devStrategy&&e.devStrategy.id===self.devStrategy.id}):self.filteredViewDetailsList=angular.copy(self.viewDetailsList)}function openNgOverlay(page,data){"undefined"!=typeof data&&(self.devStrategy={id:data.devStrategyId,desc:data.desc}),"note"===page&&(self.noteTextArea="",self.postANote={submitted:!1},self.feedRequired?self.getNotesFeedbackForGoal({goalId:self.activeProfile.id,indexName:"NOTE",mode:"addNoteCompetency"}):(self.allNotesFeedbackData=angular.copy(self.masterAllNotesFeedbackData),self.viewDetails("NOTE"),sortList())),self.winHeight=$(window).height()+100+"px";ngDialog.open({template:self.noteResponsiveModal,className:"ngdialog-lnd-theme",scope:$scope})}function openState(number,text){self.winWidth>767?(self.devStrategy.id="",self.state(number)):(self.devStrategy.id="",self.openNgOverlay(text))}function showMobileHomePage(){self.showRightCol=!1,self.showMobileDD=!1}function videoPopUp(url,type){if("Intro"===type?sharedProperties.fireAnalyticsEvent("Competency | View Competency steps Intro Video",self.activeProfile.name):"Description"===type?sharedProperties.fireAnalyticsEvent("Competency | View Competency Profile description Video",self.activeProfile.name):sharedProperties.fireAnalyticsEvent("Competency | View Competency steps Dev Strategy Video",self.activeProfile.name),/youtu\.be/.test(url)){var youtubeId=url.split("/");$scope.videoUrl="https://www.youtube.com/watch?v="+youtubeId[youtubeId.length-1]}else $scope.videoUrl=url;ngDialog.open({template:self.config.videoPopUpDialog,scope:$scope})}function getMemberList(){ajaxService.getAjaxResponse({url:"/sp/allUsers"}).then(function(response){if("true"===response.Success){if(self.emailMemberList=response.allMembers,null!==$localStorage.get("loggegdInProfile"))for(var i=0;i<self.emailMemberList.length;i++)if(self.emailMemberList[i].email===$localStorage.get("loggegdInProfile").member.email){self.emailMemberList.splice(i,1);break}}else{var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function loadTags(query){var deferred=$q.defer(),result=self.emailMemberList.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise}function tagAdded(tag){void 0!==tag.email&&(self.searchTag.push(tag.email),self.inputRequired=!1)}function tagRemoved(tag){self.searchTag.splice(self.searchTag.indexOf(tag.email),1)}function tagAddedManager(tag){void 0!==tag&&(self.searchTag.push(tag.email),self.searchTagEmail.push(tag),self.inputRequired=!1),angular.element($(".tagsManagerInput .input")).css("visibility","hidden")}function tagRemovedManager(tag){self.searchTag.splice(self.searchTag.indexOf(tag.email),1),self.searchTagEmail.splice(self.searchTagEmail.indexOf(tag),1),angular.element($(".tagsManagerInput .input")).css("visibility","visible"),self.repeatedRequests=!1,self.assignToSelf=!1}function tagAddedPeer(tag){void 0!==tag&&(self.searchTag.push(tag.email),self.searchTagPeer.push(tag),self.inputRequired=!1)}function tagRemovedPeer(tag){self.searchTag.splice(self.searchTag.indexOf(tag.email),1),self.searchTagPeer.splice(self.searchTagPeer.indexOf(tag.email),1),self.repeatedRequests=!1,self.assignToSelf=!1}function articleBookmark(id,flag){var _flag=!flag,options={url:"/sp/tracking/bookMarkArticle",data:$.param({articleId:id,trackingType:"ARTICLES",isBookMarked:_flag})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){_flag===!0?($.growl({icon:"glyphicon glyphicon-ok",message:" Article bookmarked"}),sharedProperties.fireAnalyticsEvent("Competency | Article Bookmarked",id)):($.growl({icon:"glyphicon glyphicon-ok",message:" Bookmark removed"}),sharedProperties.fireAnalyticsEvent("Competency | Article Bookmark removed",id));var tempList=angular.copy(self.allArticlesListings);$.each(tempList,function(i,j){return tempList[i].articleLinkUrl===id?(tempList[i].articleBookmarked=!tempList[i].articleBookmarked,!1):void 0}),self.allArticlesListings=angular.copy(tempList)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function articleShare(articleId,articleDetails){self.inputRequired=!1,$scope.shareEnable=!0,$scope.shareArticleId=articleId,self.searchTag=$scope.searchTag=[],!self.emailMemberList.length&&self.getMemberList(articleId),$scope.articlePageDetails=articleDetails,null===$scope.shortDescription||"undefined"==typeof $scope.shortDescription?ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/getShortDescription",data:$.param({articleId:articleId})}).then(function(response){"true"===response.Success&&(self.winHeight=$(window).height()+100+"px",$scope.shortDescription=response.shortDescription,ngDialog.open({template:"/sp/resources/html/goals/shareArticle.html",scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"}))}):(self.winHeight=$(window).height()+100+"px",ngDialog.open({template:"/sp/resources/html/goals/shareArticle.html",scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"}))}function articleLike(id,flag){var _flag=!flag,options={url:"/sp/trainingLibrary/recommendArticle",data:$.param({articleId:id,doReccomend:_flag})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){_flag===!0?($.growl({icon:"glyphicon glyphicon-ok",message:"Article recommended"}),sharedProperties.fireAnalyticsEvent("Competency | Article Recommended",id)):($.growl({icon:"glyphicon glyphicon-ok",message:"Article recommendation removed"}),sharedProperties.fireAnalyticsEvent("Competency | Article Recommend removed",id));var tempList=angular.copy(self.allArticlesListings);$.each(tempList,function(i,j){return tempList[i].articleLinkUrl===id?(tempList[i].articleRecommendedByUser=!tempList[i].articleRecommendedByUser,tempList[i].recommendationCount=response.recommendationCount,!1):void 0}),self.allArticlesListings=angular.copy(tempList)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function applyArticleFilterMobile(v){switch(self.articlesFilterStatus=!1,self.articleMediaFilters="ALL",v){case"all":self.applyArticleFilter("","",0,"auto","");break;case"mandatoryArticle":self.applyArticleFilter("mandatoryArticle",!0,3,"click","");break;case"articleRecommendedByUser":self.applyArticleFilter("articleRecommendedByUser",!0,4,"click","");break;case"articleBookmarked":self.applyArticleFilter("articleBookmarked",!0,5,"click","");break;case"userArticleStatus":self.applyArticleFilter("userArticleStatus","COMPLETED",6,"click","")}}function applyArticleFilterMedia(v){var existingFilterKey="",existingFilterKeyVal="";self.articlesFilter&&angular.forEach(self.articlesFilter,function(value,key){"articleType"!==key&&"undefined"!=typeof key&&(existingFilterKey=key,existingFilterKeyVal=self.articlesFilter[key])}),self.articlesFilterStatus=!1,"ALL"===v?self.applyArticleFilter(existingFilterKey,existingFilterKeyVal,self.articlesFilterSelected,"click",""):self.applyArticleFilter(existingFilterKey,existingFilterKeyVal,0===self.articlesFilterSelected?-1:self.articlesFilterSelected,"click",v)}function applyArticleFilter(k,v,i,action,mediaType){self.articlesFilterStatus=!1,self.articleMediaFilters="ALL";var _params=[];self.articlesFilterSelected=i,0!==i?(k&&v&&(_params[k]=v),_params.articleType=mediaType,self.articleMediaFilters=mediaType?mediaType:"ALL",self.articlesFilter=$filter("filter")(_params),self.articlesFilterStatus=!0):(self.articlesFilter="",self.articlesFilterStatus=!1,self.articleMediaFilters="ALL"),"userArticleStatus"===k?sharedProperties.fireAnalyticsEvent("Competency | Click Article Filters","ArticleCompleted"):"articleType"===k?sharedProperties.fireAnalyticsEvent("Competency | Click Article Filters",k+"- "+v):""!==k&&sharedProperties.fireAnalyticsEvent("Competency | Click Article Filters",k)}function infinteScroll(arg){self.returnArticleListings(arg)}function returnArticleListings(pageSize){if(!self.allArticlesListingsMaster.length)return!0;var result=self.masterCopy?self.allArticlesListingsMaster:self.allArticlesListings;self.allArticlesListings=result,self.pageSetting.pageSize=pageSize,pageSize>=self.allArticlesListingsMaster.length&&(self.pageSetting.disabledInfinite=!0,self.pageSetting.pageSize=self.allArticlesListingsMaster.length),self.masterCopy=!0}function getCompetencyProfiles(){ajaxService.getAjaxResponse({url:self.config.getCompetencies,data:$.param({memberEmail:$rootScope.noSelf}),method:"POST"}).then(function(response){if("true"===response.Success)self.responseAvailable=!0,void 0===response.competencyProfile?self.competencyDefaultView=!0:(self.competencyDefaultView=!1,self.masterCompetencyProfileDetails=response.competencyProfile,self.competencyProfileDetails=response.competencyProfile,self.competencyProfileList=response.competencyProfile.competencyList,self.getTasks="undefined"!=typeof response.tasks?response.tasks:{},createTask(self.getTasks),self.allArticlesListings=[],self.allArticlesListingsMaster=[],self.ddSelectedText=self.competencyProfileList[0].name,self.activeProfile.id=self.competencyProfileList[0].id,self.activeProfile.name=self.competencyProfileList[0].name,self.activeProfileDetails=self.competencyProfileList[0],self.devStrategyDetails=self.activeProfileDetails.devStrategyActionCategoryList[0],self.devStrategyList=self.activeProfileDetails.devStrategyActionCategoryList[0].actionList,self.allArticlesListingsMaster=self.competencyProfileList[0].articleProgressDetailDTO.userArticlesProgress.length?self.competencyProfileList[0].articleProgressDetailDTO.userArticlesProgress:[],self.allArticlesListings=angular.copy(self.allArticlesListingsMaster),self.state());else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function createTask(task){("CompetencyEvaluationInitiate"===task.type||"CompetencyEvaluationSelf"===task.type)&&(self.competencyTask={endDate:task.endDate,description:task.params.description,linkText:task.params.linkText,title:task.params.title,type:task.type},self.showPeerRating=task.params.peerEvaluation)}function showCompetencyProfileDetails(profileData){self.allArticlesListings=[],self.allArticlesListingsMaster=[],self.activeProfile.id=profileData.id,self.activeProfile.name=profileData.name;var updatedProfileDetails,_data=angular.copy(self.masterCompetencyProfileDetails);angular.forEach(_data.competencyList,function(i,j){return _data.competencyList[j].id===profileData.id?(updatedProfileDetails=_data.competencyList[j],!1):void 0}),self.activeProfileDetails=updatedProfileDetails,self.devStrategyDetails=self.activeProfileDetails.devStrategyActionCategoryList[0],self.devStrategyList=self.activeProfileDetails.devStrategyActionCategoryList[0].actionList,self.allArticlesListingsMaster=updatedProfileDetails.articleProgressDetailDTO.userArticlesProgress.length?updatedProfileDetails.articleProgressDetailDTO.userArticlesProgress:[],self.allArticlesListings=angular.copy(self.allArticlesListingsMaster),self.ddSelectedText=profileData.name,self.state(),self.winWidth<768&&(self.showRightCol=!0),sharedProperties.fireAnalyticsEvent("Competency | Click competency steps",profileData.name)}function state(count){switch(count){case 1:self.noteTextArea="",self.postANote={submitted:!1},self.feedRequired?self.getNotesFeedbackForGoal({goalId:self.activeProfile.id,indexName:"NOTE",mode:"addNoteCompetency"}):(self.allNotesFeedbackData=angular.copy(self.masterAllNotesFeedbackData),self.viewDetails("NOTE"),sortList(),$state.go("addNoteCompetency")),sharedProperties.fireAnalyticsEvent("Competency | Click Post a Note",self.activeProfile.name);break;default:$state.go("profiles")}}function addNote(options){self.postANote.submitted=!1,self.postANoteForm.$valid?ajaxService.getAjaxResponse({url:self.config.addNote,data:$.param({goalId:options.goalId,devStrategyId:options.devStrategyId,content:options.contents})}).then(function(response){if("true"===response.Success)self.feedRequired=!0,self.state(),self.noteTextArea="",self.feedRequired=!0,ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("practiceArea.notePostedSuccesfully")}),sharedProperties.fireAnalyticsEvent("Competency | Save a Note",self.activeProfile.name);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}}):self.postANote.submitted=!0}function updateNote(options){self.updateNoteForm.$valid?ajaxService.getAjaxResponse({url:self.config.updateNote,data:$.param({noteId:options.noteId,desc:options.desc})}).then(function(response){if("true"===response.Success)self.feedRequired=!0,$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("practiceArea.noteUpdatedSuccesfully")});else if(null!==response.error){self.viewDetailsList.content=self.tempModel;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}}):self.updateNoteObj.submitted=!0}function deleteNote(options){ajaxService.getAjaxResponse({url:self.config.deleteNote,data:$.param({noteId:options.noteId})}).then(function(response){if("true"===response.Success)sharedProperties.spilceIndexWithBreak(self.masterAllNotesFeedbackData[self.viewDetailsListIndex],"id",options.noteId),!self.masterAllNotesFeedbackData[self.viewDetailsListIndex].length&&delete self.masterAllNotesFeedbackData[self.viewDetailsListIndex],self.viewDetailsListIndex=Object.keys(self.masterAllNotesFeedbackData).length?Object.keys(self.masterAllNotesFeedbackData)[0]:null,self.allNotesFeedbackData=angular.copy(self.masterAllNotesFeedbackData),self.allNotesFeedbackLength=Object.keys(self.masterAllNotesFeedbackData),self.allNotesFeedbackLength.length?self.viewDetails(self.viewDetailsListIndex):self.viewDetailsList=null,$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("practiceArea.deleteNoteSuccessfull")});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}var self=this;self.config={getCompetencies:"/sp/competency/get",getNotesFeedbackForGoal:"/sp/goals/notesfeedback?goalId=",videoPopUpDialog:"/sp/support/videoPopUp",updateNote:"/sp/goals/note/update",deleteNote:"/sp/goals/note/delete",addNote:"/sp/goals/note/add",initiateEvaluation:"/sp/competency/evaluation/feedback/initiate",initiateEvaluationModal:"/sp/competency/evaluation/feedback/initiateEvaluationModal",startEvaluation:"/sp/competency/evaluation/feedback/start",startEvaluationModal:"/sp/competency/evaluation/feedback/ratingModal",saveEvaluation:"/sp/competency/evaluation/feedback/save"},self.activeProfile={name:"",id:-1},self.pageSetting={pageSize:10,intialPageSize:10,disabledInfinite:!1},self.devStrategy={id:"",desc:null},self.masterCompetencyProfileDetails={},self.searchTag=$scope.searchTag=[],self.allArticlesListingsMaster=[],self.competencyProfileDetails={},self.articlesFilterStatus=!1,self.articleMediaFilters="ALL",self.activeProfileDetails={},self.allArticlesListings=[],self.emailMemberList=[],self.feedRequired=!0,self.masterCopy=!0,self.allNotesFeedbackData=[],self.masterAllNotesFeedbackData={},self.viewDetailsList=null,self.pageType="individual",self.competencyTask=null,self.getTasks={},self.currentIndexForRating=0,self.searchTagEmail=[],self.searchTagPeer=[],self.initiateEvaluation={submitted:!1},self.inputRequired=!1,self.multipleManager=!1,self.repeatedRequests=!1,self.assignToSelf=!1,self.ratingScoreArray=[],self.competencyRatingScore=3,self.competencyProfileForRating={},self.selectedCompetencyForRating={},self.userToBeAssessed={},self.initiateRequestType="",self.userToProcess={},self.userType="",self.competencyDefaultView=!1,self.showPeerRating=!1,self.prevScores=[],self.responseAvailableForModal=!1,self.responseAvailable=!1,self.showCompetencyProfileDetails=showCompetencyProfileDetails,self.applyArticleFilterMobile=applyArticleFilterMobile,self.applyArticleFilterMedia=applyArticleFilterMedia,self.getNotesFeedbackForGoal=getNotesFeedbackForGoal,self.getCompetencyProfiles=getCompetencyProfiles,self.returnArticleListings=returnArticleListings,self.tagRemoved=$scope.tagRemoved=tagRemoved,self.developmentRedirect=developmentRedirect,self.applyArticleFilter=applyArticleFilter,self.loadTags=$scope.loadTags=loadTags,self.tagAdded=$scope.tagAdded=tagAdded,self.articleBookmark=articleBookmark,self.getMemberList=getMemberList,self.infinteScroll=infinteScroll,self.openNgOverlay=openNgOverlay,self.articleShare=articleShare,self.articleLike=articleLike,self.viewDetails=viewDetails,self.videoPopUp=videoPopUp,self.openState=openState,self.updateNote=updateNote,self.deleteNote=deleteNote,self.addNote=addNote,self.state=state,self.initiateEvaluationModal=initiateEvaluationModal,self.tagRemovedManager=tagRemovedManager,self.loadTags=loadTags,self.tagAddedManager=tagAddedManager,self.getMemberList=getMemberList,self.tagRemovedPeer=tagRemovedPeer,self.tagAddedPeer=tagAddedPeer,self.initiateEvaluation=initiateEvaluation,self.startEvaluation=startEvaluation,self.saveEvaluation=saveEvaluation,self.prevEvaluation=prevEvaluation,self.nextEvaluation=nextEvaluation,self.openTaskModal=openTaskModal,self.validateReviewerInfo=validateReviewerInfo,self.winHeight=$(window).height()+100+"px",self.showMobileHomePage=showMobileHomePage,self.winWidth=$(window).width(),self.showMobileDD=!1,self.showRightCol=!1,self.ddSelectedText,self.noteResponsiveModal="/sp/resources/html/competency/addNoteResponsive.html",$scope.videoCall=function(){$scope.videoSrc=$scope.videoUrl;var videoType;if(/youtube/g.test($scope.videoSrc))videoType="youtube";else if(/vimeo/g.test($scope.videoSrc)){videoType="vimeo";var link=$scope.videoSrc.split("?")[0].split("/");$scope.videoSrc="https://vimeo.com/"+link[parseInt(link.length-1)]}else videoType="html5";setTimeout(function(){videojs(document.getElementById("vid1"),{autoplay:!0,techOrder:[videoType],src:$scope.videoSrc},function(){$scope.videoReady=!0,this.on("ended",function(){var vid=this;vid.trigger("loadstart"),$timeout(function(){vid.posterImage.show()},500)}),this.on("timeupdate",function(){var ct=this.currentTime(),timeLeft=this.remainingTime();ct>0&&this.bigPlayButton.hide(),0===timeLeft&&this.bigPlayButton.show()})})},500)},$scope.articleShared=function(obj){return obj.email.length?void ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/shareArticle",data:$.param({articleId:obj.articleId,comment:obj.comment,toList:obj.email.toString()})}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$scope.shareEnable=!1,$.growl({icon:"glyphicon glyphicon-ok",message:" Article shared successfully"}),sharedProperties.fireAnalyticsEvent("Competency | Article Shared",obj.articleId);else{ngDialog.close("ngdialog1"),$scope.shareEnable=!1;for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}}):(self.inputRequired=!0,!0)},function(){self.getCompetencyProfiles(),self.openTaskModal($localStorage.get("competencyAlertType"))}(),jQuery(function($){$("body").on("click",".event-competency-article a",function(event){event.preventDefault();var redirectUrl=$(this).attr("href");sharedProperties.fireAnalyticsEvent("Competency | Viewed Article",redirectUrl),window.location.href=redirectUrl})})}angular.module("spApp").controller("competenciesController",competenciesController),competenciesController.$inject=["$scope","ajaxService","$localStorage","$state","$q","sharedProperties","$filter","$rootScope","ngDialog","$timeout"];
function competencyListingController($scope,ajaxService,ngDialog,$localStorage,sharedProperties,$filter,$rootScope){function getAllCompetencyProfiles(){ajaxService.getAjaxResponse({url:self.serviceApis.getAllCompetencyProfiles}).then(function(response){if("true"===response.Success)self.responseAvailable=!0,self.masterCompetenciesList=response.companyCompetencyList,self.returnMemberList(),self.competenciesList=angular.copy(self.masterCompetenciesList);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function selectCompany(){self.competencyCompanies.length?openCompanyModal():getCompaniesWithCompetencyFeature()}function getCompaniesWithCompetencyFeature(){ajaxService.getAjaxResponse({url:self.serviceApis.getCompaniesWithCompetencyFeature,method:"POST"}).then(function(response){if("true"===response.Success)self.responseAvailableForModal=!0,self.competencyCompanies=response.companyList,self.competencyCompanies.length?openCompanyModal():$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"No Companies found with Competency Feature Enabled."});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function openCompanyModal(){var dialog=ngDialog.open({template:self.serviceApis.selectCompanyModal,scope:$scope});dialog.closePromise.then(function(data){self.pageVariables.companySearchText=""})}function returnMemberList(pageSize){return self.masterCompetenciesList.length?void self.order(self.pageVariables.lastPredicate,self.pageVariables.lastReverse):!0}function order(predicate,reverse){self.pageVariables.lastPredicate=predicate,self.pageVariables.lastReverse=reverse,self.competenciesList=$filter("orderBy")(self.competenciesList,predicate,reverse)}function searchTextFilter(search){self.pageVariables.textSearching=search,self.returnMemberList()}function active(event,setting){self.pageVariables.lastPredicate=setting.predicate,self.pageVariables.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.pageVariables.lastPredicate),self.order(self.pageVariables.lastPredicate,self.pageVariables.lastReverse)}function resetfilter(){self.pageVariables=angular.copy(self.originalpageVariables),self.returnMemberList();var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")}function createCompetency(obj){$localStorage.set("competency",obj),window.location.href="/sp/sysAdmin/competency/create"}function updateCompetency(obj){$localStorage.set("competency",obj),window.location.href="/sp/sysAdmin/competency/update"}var self=this;self.masterCompetenciesList=[],self.competenciesList=[],self.competencyCompanies=[],self.serviceApis={getAllCompetencyProfiles:"/sp/sysAdmin/competency/getAll",getCompaniesWithCompetencyFeature:"/sp/sysAdmin/competency/getCompanies",selectCompanyModal:"/sp/sysAdmin/competency/selectCompany"},self.pageVariables={searchText:"",disabledInfinite:!1,lastPredicate:"name",lastReverse:!1,companySearchText:""},self.responseAvailable=!1,self.responseAvailableForModal=!1,self.originalpageVariables=angular.copy(self.pageVariables),self.getAllCompetencyProfiles=getAllCompetencyProfiles,self.getCompaniesWithCompetencyFeature=getCompaniesWithCompetencyFeature,self.searchTextFilter=searchTextFilter,self.returnMemberList=returnMemberList,self.active=active,self.order=order,self.selectCompany=selectCompany,self.createCompetency=createCompetency,self.updateCompetency=updateCompetency,self.resetfilter=resetfilter,function(){null!==$localStorage.get("competencyStatus")&&($.growl({icon:"glyphicon glyphicon-ok",message:$localStorage.get("competencyStatus")}),$localStorage.remove("competencyStatus"))}()}function competencyAdminController($scope,ajaxService,$localStorage,ngDialog,spJsonFetchAdminComp,$rootScope,$timeout,sharedProperties,$state,$filter,filterFilter){function deleteCompetencyModal(){self.actionPlan.evaluationInProgress?$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Competency Evaluation in Progress.."}):ngDialog.open({template:"/sp/resources/html/sysAdmin/competency/delete-competency.html",scope:$scope})}function deleteGenericModal(options){"update"===self.mode&&self.actionPlan.evaluationInProgress?$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Competency Evaluation in Progress.."}):(self.competencyDeleteOptions=options,ngDialog.open({template:"/sp/resources/html/sysAdmin/competency/delete-generic-modal.html",scope:$scope}))}function deleteActionList(){"competency"===self.competencyDeleteOptions.type?(self.actionPlan.competencyList.splice(self.currentCompetencyListIndex,1),moveIndexToFirstItem(0),void 0!==self.competencyDeleteOptions.id&&self.actionPlan.deletedCompetencyList.push(self.competencyDeleteOptions.id)):self.competencyDeleteOptions.list.splice(self.competencyDeleteOptions.index,1),ngDialog.close()}function deleteCompetencyProfile(){ajaxService.getAjaxResponse({url:self.config.deleteCompetencyProfile,data:$.param({competencyProfileId:self.actionPlan.id})}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:"Competency Profile Deleted Successfully"}),$timeout(function(){window.location.href="/sp/sysAdmin/competency/home"},500);else if(null!==response.error){ngDialog.close();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function removeArticleFromCompetency(id){sharedProperties.spilceIndexWithBreak(self.addedArticles,"articleLinkUrl",id);var filteredArray=self.actionPlan.competencyList[self.currentActionPlan].mandatoryArticles.filter(function(e){return e!==id});self.actionPlan.competencyList[self.currentActionPlan].mandatoryArticles=angular.copy(filteredArray);for(var i=0;i<self.masterArticlesList.length;i++)if(self.masterArticlesList[i].articleLinkUrl===id){self.masterArticlesList[i].added=!1;break}}function addArticleToCompetency(obj){if(-1===self.actionPlan.competencyList[self.currentActionPlan].mandatoryArticles.indexOf(obj.articleLinkUrl)){self.addedArticles.push(obj),self.actionPlan.competencyList[self.currentActionPlan].mandatoryArticles.push(obj.articleLinkUrl);for(var i=0;i<self.masterArticlesList.length;i++)if(self.masterArticlesList[i].articleLinkUrl===obj.articleLinkUrl){self.masterArticlesList[i].added=!0;break}self.articlesList=filterFilter(self.masterArticlesList,self.articleSearchText)}else $.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Article already added."})}function competencySort(length){if(!self.actionBool&&length>1){new Sortable(document.getElementById("sort-competency"),{animation:150,ghostClass:"ghost",handle:".practiceHandle",yAxisOnly:!0,onEnd:function(evt){self.actionPlan.competencyList.move(evt.oldIndex,evt.newIndex),self.currentActionPlan=evt.newIndex}});self.actionBool=!0}}function articlesSortable(length){if(!self.initializeBool&&length>1){new Sortable(document.getElementById("sort-me"),{animation:150,ghostClass:"ghost",handle:".dHandle",yAxisOnly:!0,onEnd:function(evt){self.addedArticles.move(evt.oldIndex,evt.newIndex),self.actionPlan.competencyList[self.currentActionPlan].mandatoryArticles.move(evt.oldIndex,evt.newIndex)}});self.initializeBool=!0}}function initializeCompetency(param){null===$localStorage.get("competency")?redirectToListing():self.company=$localStorage.get("competency"),"update"===param?(self.mode=param,getDetail("onLoad")):(self.mode=param,self.actionPlan=spJsonFetchAdminComp.spCompJson(),self.copYactionPlan=self.actionPlan.competencyList[self.currentActionPlan].devStrategyActionCategoryList),$state.go("competencyView"),"create"===param&&(self.currentCompetencyId=void 0,self.currentCompetencyListIndex=0)}function getDetail(type){ajaxService.getAjaxResponse({url:self.config.getDetail,data:$.param({competencyProfileId:self.company.competencyProfileId})}).then(function(response){if("true"===response.Success)self.actionPlan=response.competencyProfile,self.actionPlan.deletedCompetencyList=[],"onSave"===type?(self.currentCompetencyId=self.actionPlan.competencyList[self.currentActionPlan].id,self.currentCompetencyListIndex=self.currentActionPlan,self.addedArticles=angular.copy(self.actionPlan.competencyList[self.currentActionPlan].articlesDTOList)):(self.currentCompetencyId=self.actionPlan.competencyList[0].id,self.currentCompetencyListIndex=0,self.addedArticles=angular.copy(self.actionPlan.competencyList[0].articlesDTOList)),self.copYactionPlan=self.actionPlan.competencyList[self.currentActionPlan].devStrategyActionCategoryList,scrollPosition();else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function clonePlan(){self.clonecompanies.length?openCompanyModal():getCompanies()}function getCompanies(){ajaxService.getAjaxResponse({url:self.config.getCompaniesWithCompetencyFeature,method:"POST"}).then(function(response){if("true"===response.Success){self.responseAvailableForCloning=!0,self.clonecompanies=[],openCompanyModal();var clonedCompany={};response.companyList.filter(function(obj){obj.id===self.company.id?clonedCompany=obj:self.clonecompanies.push(obj)});self.clonecompanies.sort(function(a,b){var nameA=a.name.toLowerCase(),nameB=b.name.toLowerCase();return nameB>nameA?-1:nameA>nameB?1:0}),self.clonecompanies.unshift(clonedCompany)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function openCompanyModal(){self.clonePlanName=self.actionPlan.name;var dialog=ngDialog.open({template:"/sp/resources/html/sysAdmin/competency/clone.html",scope:$scope});dialog.closePromise.then(function(data){self.pageSetting.companyText=""})}function selectArticleModal(){var dialog=ngDialog.open({template:"/sp/resources/html/sysAdmin/competency/select-article.html",scope:$scope});dialog.closePromise.then(function(data){self.articleSearchText="",self.articlesList=[]})}function loadAndFilterArticles(){!self.masterArticlesList.length&&self.articleSearchText.length>2?($rootScope.$broadcast("httpLoaderStart"),ajaxService.getAjaxResponse({url:self.config.getAllArticles,data:$.param({companyId:self.company.id}),method:"POST"}).then(function(response){if("true"===response.Success){self.responseAvailableForModal=!0,self.masterArticlesList=response.articles;for(var i=0;i<self.masterArticlesList.length;i++){self.masterArticlesList[i].added=!1;for(var j=0;j<self.addedArticles.length;j++)self.masterArticlesList[i].articleLinkUrl===self.addedArticles[j].articleLinkUrl&&(self.masterArticlesList[i].added=!0)}self.articlesList=filterFilter(self.masterArticlesList,self.articleSearchText)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}}),$rootScope.$broadcast("httpLoaderEnd")):self.articleSearchText.length>2?self.articlesList=filterFilter(self.masterArticlesList,self.articleSearchText):self.articlesList=[]}function clearArticleSearch(){self.articlesList=[],self.articleSearchText=""}function openCloseSiblingContent(event,mode){var $this=$(event.target);if($this.hasClass("filterCheckBox-label"))return!0;var toggleClass=void 0===mode?"show":"noshow",$html=$this.closest(".category"),$upTarget=$html.find(".header-style-content:eq(0)"),$upTargetHeight=$upTarget.outerHeight();$html.find(".border-faq-content:eq(0)").outerHeight();$upTargetHeight>1?$upTarget.css("height",0):$upTarget.css("height","auto"),$html.toggleClass(toggleClass)}function addLink(){"update"===self.mode&&self.actionPlan.evaluationInProgress?$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Competency Evaluation in Progress.."}):self.actionPlan.mediaList.push({type:null,linkText:null,url:null,imageLink:null,altText:null})}function singleAction(actionList){"update"===self.mode&&self.actionPlan.evaluationInProgress?$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Competency Evaluation in Progress.."}):(actionList.push({title:"New Strategy",description:null,type:"Single",active:!0,actionData:[{type:null,linkText:null,url:null,imageLink:null,altText:null}]}),self.pageSetting.actions=!0)}function scrollPosition(){$(".parent-cat").each(function(){$(this).removeClass("show").find(".header-style-content:eq(0)").css("height",0)}),$("html,body").animate({scrollTop:$(".lnd-right-sec").offset().top-80},300)}function changeCompetency(index){return self.currentActionPlan===index?!0:(self.actionPlanForm.submitted=!1,null!==self.actionPlan.description&&void 0!==self.actionPlan.description&&jQuery(".description-toggle").css("background-color","#666 !important"),void(self.actionPlanForm.$valid?(self.currentActionPlan=index,self.currentCompetencyId=self.actionPlan.competencyList[index].id,self.currentCompetencyListIndex=index,self.addedArticles=[],self.addedArticles=angular.copy(self.actionPlan.competencyList[self.currentCompetencyListIndex].articlesDTOList),scrollPosition()):errorHighlighter()))}function startCloning(companyDetail){null!==self.clonePlanName&&(self.actionPlan.name=self.clonePlanName),self.actionPlan.id=null,self.actionPlan.active=!1,self.company.id=companyDetail.id,self.company.name=companyDetail.name,self.mode="clone",self.actionPlan.competencyList.filter(function(e){e.id=null,e.devStrategyActionCategoryList.filter(function(e1){e1.uid=null,e1.actionList.filter(function(e2){e2.uid=null,e2.actionData.filter(function(e3){e3.uid=null})})})}),self.actionPlan.evaluationInProgress=!1,$.growl({icon:"glyphicon glyphicon-ok",message:"The Competency Profile has been cloned successfully."})}function createNewSection(index){self.actionPlan.evaluationInProgress?$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Competency Evaluation in Progress.."}):(self.actionPlanForm.submitted=!1,self.currentCompetencyId=void 0,null!==self.actionPlan.description&&void 0!==self.actionPlan.description&&jQuery(".description-toggle").css("background-color","#666 !important"),self.actionPlanForm.$valid?(self.actionPlan.competencyList.push({name:null,description:null,status:"ACTIVE",introVideo:{status:"INACTIVE",type:"VIDEO"},rating:{defaultIndex:0,ratingList:[{title:"Developing",description:"Test Description",score:1},{title:null,description:null,score:2},{title:"Proficient",description:"Test Description",score:3},{title:null,description:null,score:4},{title:"Mastery",description:"Test Description",score:5}]},devStrategyActionCategoryList:[{title:"Development Strategy",helpText:"",status:"ACTIVE",actionList:[{title:"New Strategy",description:null,type:"Single",active:!0,actionData:[{type:null,linkText:null,url:null,imageLink:null,altText:null}]}]}],mandatoryArticles:[]}),self.currentActionPlan=index,self.addedArticles=[],self.currentCompetencyListIndex=index,self.viewMode={preview:!1,editCreate:!0},scrollPosition()):errorHighlighter())}function errorHighlighter(){var $category=$(".category");$category.each(function(){$(this).find(".ng-invalid-required").length?$(this).addClass("error-category"):$(this).removeClass("error-category")}),($("body").find(".ng-invalid-required").length||!self.actionPlanForm.$valid)&&(self.actionPlanForm.submitted=!0,self.viewMode={preview:!1,editCreate:!0}),"ACTIVE"===self.actionPlan.competencyList[self.currentActionPlan].status&&!self.result.length&&(self.errorCat=!0,self.viewMode={preview:!1,editCreate:!0})}function redirectToListing(){window.location.href="/sp/sysAdmin/competency/home"}function trueCheck(){return self.result=[],self.emptyCheck=[],"ACTIVE"!==self.actionPlan.competencyList[self.currentActionPlan].status?!0:(self.actionPlan.competencyList[self.currentActionPlan].devStrategyActionCategoryList.filter(function(e,i){"ACTIVE"===e.status&&e.actionList.length&&self.emptyCheck.push(e),"ACTIVE"===e.status&&self.result.push(e)}),self.result.length)}function submitObject(){if(self.disabled)return!0;if("update"===self.mode&&self.actionPlan.evaluationInProgress)return $.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Competency Evaluation in Progress.."}),!1;if(self.actionPlanForm.submitted=!1,self.errorCat=!1,self.disabled=!0,trueCheck()&&self.actionPlanForm.$valid&&null!==self.actionPlan.description&&void 0!==self.actionPlan.description){self.noActiveCompetency=!0;for(var k=0;k<self.actionPlan.competencyList.length;k++)if(jQuery(".description-toggle").css("background-color","#666 !important"),"ACTIVE"===self.actionPlan.competencyList[k].status){self.noActiveCompetency=!1;break}if(self.noActiveCompetency)return self.disabled=!1,!1;if(self.actionPlan.companyId=self.company.id,self.noActiveCompetency=!1,"update"===self.mode||"clone"===self.mode){delete self.actionPlan.company,delete self.actionPlan.evaluationInProgress;for(var i=0;i<self.actionPlan.competencyList.length;i++)delete self.actionPlan.competencyList[i].articleProgressDetailDTO,delete self.actionPlan.competencyList[i].keyOutcomes,delete self.actionPlan.competencyList[i].articlesDTOList}ajaxService.getAjaxResponse({url:self.config.createOrUpdate,data:self.actionPlan,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success){var redirectUrl="/sp/sysAdmin/competency/update",message="update"===self.mode?"Competency Profile Updated":"Competency Profile Saved";$localStorage.set("competencyStatus",message),"update"!==self.mode?($localStorage.set("competency",{id:self.company.id,name:self.company.name,competencyProfileId:response.competencyProfile.id}),window.location.href=redirectUrl):getDetail("onSave"),competencyStatus(),self.disabled=!1,errorHighlighter()}else if(null!==response.error){errorHighlighter(),self.disabled=!1;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}else self.disabled=!1,errorHighlighter()}function previewVideo(mode,url){if("Video"===mode)videoPopUp(url);else{var win=window.open(url,"_blank");win.focus()}}function previewIntroVideo(url){videoPopUp(url)}function videoPopUp(url,openId){if(/youtu\.be/.test(url)){var youtubeId=url.split("/");$scope.videoUrl="https://www.youtube.com/watch?v="+youtubeId[youtubeId.length-1]}else $scope.videoUrl=url;ngDialog.open({template:"/sp/resources/html/sysAdmin/competency/video-preview.html",scope:$scope});$rootScope.$on("ngDialog.opened",function(e,$dialog){"html5"===$scope.videoType&&$("#mp4_src").attr("src",$scope.videoSrc)})}function competencyStatus(){null!==$localStorage.get("competencyStatus")&&($.growl({icon:"glyphicon glyphicon-ok",message:$localStorage.get("competencyStatus")}),$localStorage.remove("competencyStatus"))}var self=this;self.config={createOrUpdate:"/sp/sysAdmin/competency/createUpdate",getDetail:"/sp/sysAdmin/competency/get",videoPopUpDialog:"/sp/admin/videoPop",cloneCompetencyProfile:"/sp/sysAdmin/competency/clone",deleteCompetencyProfile:"/sp/sysAdmin/competency/delete",getAllArticles:"/sp/sysAdmin/competency/getArticles",getCompaniesWithCompetencyFeature:"/sp/sysAdmin/competency/getCompanies"},self.currentActionPlan=0,self.companiesAjax=!1,self.competencyProfile={},self.linkType=[{name:"VIDEO IN DIALOG",value:"Video"},{name:"VIDEO IN NEW TAB",value:"VideoTab"},{name:"PPT",value:"PPT"},{name:"PDF",value:"PDF"},{name:"WEB",value:"Web"}],self.devStrategyLinkType=[{name:"VIDEO IN DIALOG",value:"Video"},{name:"VIDEO IN NEW TAB",value:"VideoTab"}],self.result=[],self.emptyCheck=[],self.clonecompanies=[],self.pageSetting={disabledInfinite:!1,lastPredicate:"name",lastReverse:!1,companyText:"",addedCategory:!1,actions:!1},self.clonePlanName=null,self.articleSearchText="",self.actionPlanForm={submitted:!1},self.originalPageSetting=angular.copy(self.pageSetting),self.initializeBool=!1,self.actionBool=!1,self.disabled=!1,self.masterArticlesList=[],self.articlesList=[],self.addedArticles=[],self.competencyDeleteOptions={},self.noActiveCompetency=!1,self.viewMode={preview:!1,editCreate:!0},self.currentCompetencyId=void 0,self.currentCompetencyListIndex=0,self.responseAvailableForModal=!1,self.responseAvailableForCloning=!1,$scope.competencyRangeSlider=3,self.openCloseSiblingContent=openCloseSiblingContent,self.addLink=addLink,self.singleAction=singleAction,self.deleteActionList=deleteActionList,self.changeCompetency=changeCompetency,self.createNewSection=createNewSection,self.redirectToListing=redirectToListing,self.submitObject=submitObject,self.trueCheck=trueCheck,self.initializeCompetency=initializeCompetency,self.articlesSortable=articlesSortable,self.competencySort=competencySort,self.previewVideo=previewVideo,self.previewIntroVideo=previewIntroVideo,self.clonePlan=clonePlan,self.startCloning=startCloning,self.deleteCompetencyModal=deleteCompetencyModal,self.deleteGenericModal=deleteGenericModal,self.deleteCompetencyProfile=deleteCompetencyProfile,self.selectArticleModal=selectArticleModal,self.loadAndFilterArticles=loadAndFilterArticles,self.clearArticleSearch=clearArticleSearch,self.addArticleToCompetency=addArticleToCompetency,self.removeArticleFromCompetency=removeArticleFromCompetency;var moveIndexToFirstItem=function(index){self.currentActionPlan=index,self.currentCompetencyId=self.actionPlan.competencyList[index].id,self.currentCompetencyListIndex=index};$scope.videoCall=function(){if($scope.videoSrc=$scope.videoUrl,$scope.videoType="",/youtube/g.test($scope.videoSrc))$scope.videoType="youtube";else if(/vimeo/g.test($scope.videoSrc)){$scope.videoType="vimeo";var link=$scope.videoSrc.split("?")[0].split("/");$scope.videoSrc="https://vimeo.com/"+link[parseInt(link.length-1)]}else $scope.videoType="html5";"html5"!==$scope.videoType&&setTimeout(function(){videojs(document.getElementById("vid1"),{autoplay:!0,techOrder:[$scope.videoType],src:$scope.videoSrc},function(){$scope.videoReady=!0,this.on("ended",function(){var vid=this;vid.trigger("loadstart"),$timeout(function(){vid.posterImage.show()},500)}),this.on("timeupdate",function(){var ct=this.currentTime(),timeLeft=this.remainingTime();ct>0&&this.bigPlayButton.hide(),0===timeLeft&&this.bigPlayButton.show()})})},500)},self.selectThumbImage=function(videoObj,type){sharedProperties.openMediaModal();var destroyRoot=$scope.$on("mediaData",function(e,data){if(destroyRoot(),null===data)return!0;switch(type){case"imageUrl":videoObj.thumbnailURL=data.url,videoObj.title=data.name;break;case"linkAction":"Video"===videoObj.type||"VideoTab"===videoObj.type?(videoObj.imageLink=data.url,videoObj.altText=data.altText,videoObj.linkText=data.name):(videoObj.url=data.url,videoObj.linkText=data.name,videoObj.imageLink="",videoObj.altText="");break;default:videoObj.thumbnailURL=data.url}})},$("body").click(function(e){$(".image-edit-box").is(e.target)||0!==$(".image-edit-box").has(e.target).length||$(".upload-icon").is(e.target)||self.imageEditBox&&$scope.$apply(function(){self.imageEditBox=!1})})}function spJsonFetchAdminComp(){function spCompJson(){return{companyId:null,active:!0,name:null,description:null,deletedCompetencyList:[],mediaList:[{type:null,imageLink:null,url:null,altText:null,linkText:null}],competencyList:[{name:null,description:null,status:"ACTIVE",introVideo:{status:"INACTIVE",type:"VIDEO"},rating:{defaultIndex:0,ratingList:[{title:"Developing",description:"Test Description",score:1},{title:null,description:null,score:2},{title:"Proficient",description:"Test Description",score:3},{title:null,description:null,score:4},{title:"Mastery",description:"Test Description",score:5}]},devStrategyActionCategoryList:[{title:"Development Strategy",helpText:"",status:"ACTIVE",actionList:[{title:"New Strategy",description:null,type:"Single",active:!0,actionData:[{type:null,linkText:null,url:null,imageLink:null,altText:null}]}]}],mandatoryArticles:[]}]}}return{spCompJson:spCompJson}}angular.module("spApp").controller("competencyListingController",competencyListingController),angular.module("spApp").controller("competencyAdminController",competencyAdminController),angular.module("spApp").service("spJsonFetchAdminComp",spJsonFetchAdminComp),competencyListingController.$inject=["$scope","ajaxService","ngDialog","$localStorage","sharedProperties","$filter","$rootScope"],angular.module("spApp").filter("selectArticleFilter",function(){return function(items,searchText,filterFilter){var filtered=[];return angular.forEach(items,function(item){""!==searchText&&(filtered=filterFilter(filtered,searchText))}),filtered}}),competencyAdminController.$inject=["$scope","ajaxService","$localStorage","ngDialog","spJsonFetchAdminComp","$rootScope","$timeout","sharedProperties","$state","$filter","filterFilter"];
function competencyManager($scope,ajaxService,ngDialog,$localStorage,sharedProperties,$filter,$rootScope,$timeout,$q){function toggleRowById(rowId){self.activeRow=rowId===self.activeRow?-1:rowId}function getAllCompetencyProfiles(){ajaxService.getAjaxResponse({url:self.serviceApis.getAllCompetencyProfiles}).then(function(response){if("true"===response.Success){if(self.responseAvailable=!0,void 0===response.competencyEvaluationUsers||0===response.competencyEvaluationUsers.length)self.competencyAdminDefaultView=!0;else if(self.competencyAdminDefaultView=!1,self.masterCompetenciesList=response.competencyEvaluationUsers,self.returnMemberList(),self.masterCompetenciesList.length){self.competenciesList=angular.copy(self.masterCompetenciesList),self.competenciesList=$filter("orderBy")(self.competenciesList,"competencyProfile.name",!1),self.competencyEvaluationInProgress=response.evaluationInProgress;for(var i=0;i<self.competenciesList.length;i++)self.competencyEvaluationMap[self.competenciesList[i].competencyProfile.id]=self.competenciesList[i].userEvaluationMap,self.competencyProfileMap[self.competenciesList[i].competencyProfile.id]=self.competenciesList[i].competencyProfile.competencyList,self.competencyNameMap[self.competenciesList[i].competencyProfile.id]=self.competenciesList[i].competencyProfile.name;if(null!==$localStorage.get("competencyProfileId")){var tempValue=$localStorage.get("competencyProfileId");self.selectedCompetencyProfileId=tempValue,self.selectedCompetencyProfileName=self.competencyNameMap[tempValue];for(var keys1=Object.keys(self.competencyEvaluationMap[tempValue]),k=0;k<keys1.length;k++){var val1=self.competencyEvaluationMap[tempValue][keys1[k]];self.userEvaluationList.push(val1)}}else{self.selectedCompetencyProfileId=self.competenciesList[0].competencyProfile.id,self.selectedCompetencyProfileName=self.competenciesList[0].competencyProfile.name;for(var keys=Object.keys(self.competencyEvaluationMap[self.competenciesList[0].competencyProfile.id]),j=0;j<keys.length;j++){var val=self.competencyEvaluationMap[self.competenciesList[0].competencyProfile.id][keys[j]];self.userEvaluationList.push(val)}}for(var xyz=0;xyz<self.userEvaluationList.length;xyz++){if(self.reviewersList=[],null!==self.userEvaluationList[xyz].managerEvaluation&&self.reviewersList.push(self.userEvaluationList[xyz].managerEvaluation.reviewer.email),null!==self.userEvaluationList[xyz].peerEvaluation)for(var peer=0;peer<self.userEvaluationList[xyz].peerEvaluation.length;peer++)self.reviewersList.push(self.userEvaluationList[xyz].peerEvaluation[peer].reviewer.email);self.addedReviewersMap[self.userEvaluationList[xyz].member.id]=self.reviewersList}void 0!==response.competencyEvaluation&&null!==response.competencyEvaluation?(self.competencyMembersView=!1,self.competencyEvaluation=response.competencyEvaluation,-1!==self.competencyEvaluation.requiredEvaluationList.indexOf("Self")&&(self.showSelfRating=!0),-1!==self.competencyEvaluation.requiredEvaluationList.indexOf("Peer")&&(self.showPeerRating=!0)):self.competencyMembersView=!0}}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getEvaluationRequests(){ajaxService.getAjaxResponse({url:self.serviceApis.getEvaluationRequests}).then(function(response){if("true"===response.Success){self.responseAvailable=!0,self.managerView=!0,void 0!==response.peerEvaluation&&(self.showPeerRating=response.peerEvaluation),self.competencyEvaluationRequests=response.competencyEvaluation;for(var i=0;i<self.competencyEvaluationRequests.length;i++)if("Manager"===self.competencyEvaluationRequests[i].type){self.peerOnlyEvaluation=!1;break}for(var xyz=0;xyz<self.competencyEvaluationRequests.length;xyz++){if(self.reviewersList=[],null!==self.competencyEvaluationRequests[xyz].peerEvaluation&&"Manager"===self.competencyEvaluationRequests[xyz].type){for(var peer=0;peer<self.competencyEvaluationRequests[xyz].peerEvaluation.length;peer++)self.reviewersList.push(self.competencyEvaluationRequests[xyz].peerEvaluation[peer].reviewer.email);self.addedReviewersMap[self.competencyEvaluationRequests[xyz].user.id]=self.reviewersList}null!==response.member&&void 0!==response.member&&(self.reviewersList.push(response.member.email),self.addedReviewersMap[self.competencyEvaluationRequests[xyz].user.id]=self.reviewersList)}}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function startEvaluation(user){self.currentIndexForRating=0,self.ratingScoreArray=[],self.userType=user,ajaxService.getAjaxResponse({url:self.serviceApis.startEvaluation,data:$.param({memberId:"self"!==user?user:""}),method:"POST"}).then(function(response){if("true"===response.Success){self.winHeight=$(window).height()+100+"px";var screenWidth=document.documentElement.clientWidth;self.responseAvailableForModal=!0,self.competencyProfileForRating=response.competencyProfile,self.userToBeAssessed=response.user,self.selectedCompetencyForRating=self.competencyProfileForRating.competencyList[0];ngDialog.open({template:screenWidth>768?"/sp/resources/html/competency/rating-desktop.html":self.serviceApis.startEvaluationModal,scope:$scope,className:screenWidth>767?"ngdialog-theme-default":"new-mobile-theme"});self.competencyRatingScore=3,$rootScope.$on("ngDialog.opened",function(e,$dialog){var $r=jQuery('input[type="range"]');$r.rangeslider({polyfill:!1,onInit:function(){$timeout(function(){jQuery("#cmrc-desc-cont_"+self.competencyRatingScore).addClass("slideRight")},100)},onSlideEnd:function(position,value){$scope.$apply(function(){jQuery("#cmrc-desc-cont_"+self.competencyRatingScore).removeClass("slideRight"),self.competencyRatingScore=value,self.ratingScoreArray[self.currentIndexForRating]=self.competencyRatingScore,self.prevScores=angular.copy(self.ratingScoreArray),$timeout(function(){jQuery("#cmrc-desc-cont_"+self.competencyRatingScore).addClass("slideRight")},100)})}})})}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function openRatingDetailsModal(id,memberObj,reviewerRole){ajaxService.getAjaxResponse({url:self.serviceApis.getRatingDetails,data:$.param({scoreDetailsId:id}),method:"POST"}).then(function(response){if("true"===response.Success){self.responseAvailableForModal=!0,self.scoreDetails.competencyScoreList=response.competencyScoreList,self.scoreDetails.score=response.totalScore,self.scoreDetails.reviewer=response.reviewer,$scope.memberDetails=memberObj,$scope.reviewerRole=reviewerRole;var reviewerInfo=(ngDialog.open({template:self.serviceApis.ratingDetailsModal,scope:$scope}),"Viewed Manager Evaluation details");"s"===reviewerRole?reviewerInfo="Viewed Self Evaluation details":"p"===reviewerRole&&(reviewerInfo="Viewed Peer Evaluation details"),sharedProperties.fireAnalyticsEvent("Competency Manager | View Evaluation Details",reviewerInfo)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function saveEvaluation(){self.ratingScoreArray.length!==self.competencyProfileForRating.competencyList.length&&self.ratingScoreArray.push(3),ajaxService.getAjaxResponse({url:self.serviceApis.saveEvaluation,data:$.param({memberId:"self"!==self.userType?self.userType:"",scoreArray:self.ratingScoreArray.join()}),method:"POST"}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.evaluationCompleted")}),sharedProperties.fireAnalyticsEvent("Competency Manager | Manager Evaluation Completed","N/A"),$timeout(function(){window.location.reload()},1e3);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getMemberList(){ajaxService.getAjaxResponse({url:self.serviceApis.getAllUsers,data:$.param({isAccountAdmin:self.managerView?!1:!0}),method:"POST"}).then(function(response){if("true"===response.Success)self.emailMemberList=response.allMembers;else{var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function previewRating(){self.currentIndex=0,self.winHeight=$(window).height()+100+"px",self.competencyRangeSlider=3,self.selectedCompetencyList=self.competencyProfileMap[self.selectedCompetencyProfileId],self.selectedCompetencyProfileName=self.competencyNameMap[self.selectedCompetencyProfileId],self.selectedCompetency=self.selectedCompetencyList[0],sharedProperties.fireAnalyticsEvent("Competency Manager | Preview Competency Profile",self.selectedCompetencyProfileName);ngDialog.open({template:self.serviceApis.previewRating,scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"});$rootScope.$on("ngDialog.opened",function(e,$dialog){var $r=jQuery('input[type="range"]');$r.rangeslider({polyfill:!1,onInit:function(){$timeout(function(){jQuery("#cmrc-desc-cont_"+self.competencyRangeSlider).addClass("slideRight")},100)},onSlideEnd:function(position,value){$scope.$apply(function(){jQuery("#cmrc-desc-cont_"+self.competencyRangeSlider).removeClass("slideRight"),self.competencyRangeSlider=value,$timeout(function(){jQuery("#cmrc-desc-cont_"+self.competencyRangeSlider).addClass("slideRight")},100)})}})})}function activateEvaluationModal(){self.winHeight=$(window).height()+100+"px",self.evaluationChecks={manager:!0,self:!1,peer:!1},self.evaluationEndDate=new Date,self.evaluationEndDate.setDate(self.currentDate.getDate()+1);ngDialog.open({template:self.serviceApis.activateEvaluationModal,scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"})}function endEvaluationModal(){ngDialog.open({template:"/sp/resources/html/admin/competency/end-evaluation-modal.html",scope:$scope})}function sendReminderModal(obj){self.reminderInfo=obj;ngDialog.open({template:self.serviceApis.sendReminderModal,scope:$scope})}function sendReminder(obj){self.reminderInfo=obj,ajaxService.getAjaxResponse({url:self.serviceApis.sendReminder,data:$.param({userId:self.reminderInfo.userId,isInitiate:self.reminderInfo.isInitiate,isSelf:self.reminderInfo.isSelf,reviewUserId:self.reminderInfo.reviewUserId}),method:"POST"}).then(function(response){if("true"===response.Success){ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.reminderSent")});var reminderDetails="";self.reminderInfo.isInitiate?reminderDetails="Sent Reminder for Member to Initiate Evaluation":self.reminderInfo.isSelf?reminderDetails="Sent Reminder for Member to do Self Evaluation":""!==self.reminderInfo.reviewUserId&&(reminderDetails="Sent Reminder for Reviewer to do the Evaluation"),sharedProperties.fireAnalyticsEvent("Competency Manager | Send Reminder about evaluation",reminderDetails)}else if(null!==response.error){ngDialog.close();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function initiateEvaluationModal(type,userToProcess){self.winHeight=$(window).height()+100+"px",self.inputRequired=!1,self.multipleManager=!1,self.existingReviewer=!1,self.assignToSelf=!1,self.repeatedRequests=!1,self.searchTagEmail=[],self.searchTag=[],self.searchTagPeer=[],self.initiateRequestType=type,self.userToProcess=userToProcess,self.emailMemberList.length||self.getMemberList();ngDialog.open({template:self.serviceApis.initiateEvaluationModal,scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"})}function changeManagerModal(userToProcess,reviewer){self.winHeight=$(window).height()+100+"px",self.initiateEvaluation.submitted=!1,self.inputRequired=!1,self.repeatedRequests=!1,self.multipleManager=!1,self.existingReviewer=!1,self.assignToSelf=!1,self.userToProcess=userToProcess,self.currentManager=reviewer,self.emailMemberList.length||self.getMemberList();ngDialog.open({template:self.serviceApis.changeManagerModal,scope:$scope,className:self.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"})}function validateReviewerInfo(user,type,managerEmail,peerInfo){if(user.email===managerEmail)return void(self.assignToSelf=!0);for(var i=0;i<peerInfo.length;i++)if(user.email===peerInfo[i].email){self.assignToSelf=!0;break}if(!self.assignToSelf){var tempReviewersList=[];if(tempReviewersList=self.addedReviewersMap[user.id],tempReviewersList.length)if("changeManager"===type){if(-1!==tempReviewersList.indexOf(managerEmail))return void(self.existingReviewer=!0)}else if("peerRequest"===type)for(var j=0;j<peerInfo.length;j++)if(-1!==tempReviewersList.indexOf(peerInfo[j].email)){self.existingReviewer=!0;break}}}function changeManager(){if(self.initiateEvaluation.submitted=!1,self.inputRequired=!1,self.repeatedRequests=!1,self.multipleManager=!1,self.existingReviewer=!1,self.assignToSelf=!1,void 0===self.searchTagEmail[0])return void(self.inputRequired=!0);if("SELF"===self.userToProcess||(validateReviewerInfo(self.userToProcess,"changeManager",self.searchTagEmail[0].email,[]),!self.existingReviewer&&!self.assignToSelf)){var userForEmail="",obj={},manager={},peerUserList=[];self.initiateEvaluationForm.$valid?(manager={firstName:self.searchTagEmail[0].firstName,lastName:self.searchTagEmail[0].lastName,email:self.searchTagEmail[0].email},"SELF"!==self.userToProcess&&(userForEmail=self.userToProcess.email),obj={manager:manager,peerList:peerUserList,userForEmail:userForEmail},ajaxService.getAjaxResponse({url:self.serviceApis.initiateEvaluation,data:obj,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.changeManager")}),sharedProperties.fireAnalyticsEvent("Competency Manager | Change Manager","N/A"),$timeout(function(){window.location.reload()},500);else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})):self.initiateEvaluation.submitted=!0}}function initiatePeerEvaluation(){if(self.initiateEvaluation.submitted=!1,self.existingReviewer=!1,self.assignToSelf=!1,void 0===self.searchTagPeer[0])return void(self.inputRequired=!0);if("SELF"===self.userToProcess||(validateReviewerInfo(self.userToProcess,"peerRequest",null,self.searchTagPeer),!self.existingReviewer&&!self.assignToSelf)){var userForEmail="",obj={},peerUser={},peerUserList=[];if(self.initiateEvaluationForm.$valid){if("SELF"!==self.userToProcess&&(userForEmail=self.userToProcess.email),self.searchTagPeer.length)for(var i=0;i<self.searchTagPeer.length;i++)peerUser={firstName:void 0!==self.searchTagPeer[i].firstName?self.searchTagPeer[i].firstName:"",lastName:void 0!==self.searchTagPeer[i].lastName?self.searchTagPeer[i].lastName:"",email:self.searchTagPeer[i].email,existingUserEmail:void 0!==self.searchTagPeer[i].firstName?self.searchTagPeer[i].email:""},peerUserList.push(peerUser);obj={manager:null,peerList:peerUserList,userForEmail:userForEmail},ajaxService.getAjaxResponse({url:self.serviceApis.initiateEvaluation,data:obj,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.peerEvaluationSent")}),sharedProperties.fireAnalyticsEvent("Competency Manager | Request Peer Evaluation","N/A"),$timeout(function(){window.location.reload()},500);else if(null!==response.error){ngDialog.close();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}else self.initiateEvaluation.submitted=!0}}function initiateEvaluation(){if(self.initiateEvaluation.submitted=!1,self.repeatedRequests=!1,self.multipleManager=!1,self.existingReviewer=!1,self.assignToSelf=!1,void 0===self.searchTagEmail[0])return void(self.inputRequired=!0);if(self.searchTagEmail.length>1)return void(self.multipleManager=!0);if("SELF"===self.userToProcess||(validateReviewerInfo(self.userToProcess,"selfAssignCheck",self.searchTagEmail[0].email,self.searchTagPeer),!self.existingReviewer&&!self.assignToSelf)){var userForEmail="",obj={},manager={},peerUser={},peerUserList=[];if(self.searchTagPeer.length)for(var i=0;i<self.searchTagPeer.length;i++){if(self.searchTagPeer[i].email===self.searchTagEmail[0].email)return void(self.repeatedRequests=!0);peerUser={firstName:void 0!==self.searchTagPeer[i].firstName?self.searchTagPeer[i].firstName:"",lastName:void 0!==self.searchTagPeer[i].lastName?self.searchTagPeer[i].lastName:"",email:self.searchTagPeer[i].email,existingUserEmail:void 0!==self.searchTagPeer[i].firstName?self.searchTagPeer[i].email:""},peerUserList.push(peerUser)}self.initiateEvaluationForm.$valid?(manager={firstName:self.searchTagEmail[0].firstName,lastName:self.searchTagEmail[0].lastName,email:self.searchTagEmail[0].email},"SELF"!==self.userToProcess&&(userForEmail=self.userToProcess.email),obj={manager:manager,peerList:peerUserList,userForEmail:userForEmail},ajaxService.getAjaxResponse({url:self.serviceApis.initiateEvaluation,data:obj,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.initiateEvaluation")}),sharedProperties.fireAnalyticsEvent("Competency Manager | Initiate Member Evaluation","N/A"),$timeout(function(){window.location.reload()},500);else if(null!==response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})):self.initiateEvaluation.submitted=!0}}function prev(){0!==self.currentIndex&&(self.currentIndex=self.currentIndex-1,self.selectedCompetency=self.selectedCompetencyList[self.currentIndex])}function next(){self.currentIndex+1!==self.selectedCompetencyList.length&&(self.currentIndex=self.currentIndex+1,self.selectedCompetency=self.selectedCompetencyList[self.currentIndex])}function prevEvaluation(){0!==self.currentIndexForRating&&(self.currentIndexForRating=self.currentIndexForRating-1,self.selectedCompetencyForRating=self.competencyProfileForRating.competencyList[self.currentIndexForRating],self.competencyRatingScore=self.prevScores[self.currentIndexForRating],jQuery('input[type="range"]').val(self.competencyRatingScore).change())}function nextEvaluation(){self.currentIndexForRating+1!==self.competencyProfileForRating.competencyList&&(self.currentIndexForRating=self.currentIndexForRating+1,self.selectedCompetencyForRating=self.competencyProfileForRating.competencyList[self.currentIndexForRating],void 0===self.ratingScoreArray[self.currentIndexForRating]?(self.competencyRatingScore=3,self.ratingScoreArray.push(parseFloat(self.competencyRatingScore)),self.prevScores=angular.copy(self.ratingScoreArray)):self.competencyRatingScore=self.ratingScoreArray[self.currentIndexForRating],jQuery('input[type="range"]').val(self.competencyRatingScore).change())}function changeCompetencyProfile(){self.userEvaluationList=[],self.addedReviewersMap={};for(var keys=Object.keys(self.competencyEvaluationMap[self.selectedCompetencyProfileId]),j=0;j<keys.length;j++){var val=self.competencyEvaluationMap[self.selectedCompetencyProfileId][keys[j]];self.userEvaluationList.push(val)}for(var xyz=0;xyz<self.userEvaluationList.length;xyz++){if(self.reviewersList=[],null!==self.userEvaluationList[xyz].managerEvaluation&&self.reviewersList.push(self.userEvaluationList[xyz].managerEvaluation.reviewer.email),null!==self.userEvaluationList[xyz].peerEvaluation)for(var peer=0;peer<self.userEvaluationList[xyz].peerEvaluation.length;peer++)self.reviewersList.push(self.userEvaluationList[xyz].peerEvaluation[peer].reviewer.email);self.addedReviewersMap[self.userEvaluationList[xyz].member.id]=self.reviewersList}self.selectedCompetencyProfileName=self.competencyNameMap[self.selectedCompetencyProfileId],$localStorage.set("competencyProfileId",self.selectedCompetencyProfileId)}function activateEvaluation(){var _params,requiredEvaluationList=["Manager"];self.evaluationChecks.self&&requiredEvaluationList.push("Self"),self.evaluationChecks.peer&&requiredEvaluationList.push("Peer"),_params={endDate:new Date(self.evaluationEndDate).toISOString(),requiredEvaluationList:requiredEvaluationList.toString()},ajaxService.getAjaxResponse({url:self.serviceApis.activateEvaluation,data:$.param(_params)}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.activateEvaluation")}),sharedProperties.fireAnalyticsEvent("Competency Manager | Activate Evaluation",requiredEvaluationList.toString()),$timeout(function(){window.location.reload()},1500);else if(null!==response.error){ngDialog.close();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function endEvaluation(){ajaxService.getAjaxResponse({url:self.serviceApis.endEvaluation}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.endEvaluation")}),sharedProperties.fireAnalyticsEvent("Competency Manager | End Evaluation","N/A"),$timeout(function(){window.location.reload()},1500);else if(null!==response.error){ngDialog.close();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function loadTags(query){var deferred=$q.defer(),result=self.emailMemberList.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise}function tagAddedManager(tag){void 0!==tag&&(self.searchTag.push(tag.email),self.searchTagEmail.push(tag),self.inputRequired=!1),angular.element($(".tagsManagerInput .input")).css("visibility","hidden")}function tagRemovedManager(tag){self.searchTag.splice(self.searchTag.indexOf(tag.email),1),self.searchTagEmail.splice(self.searchTagEmail.indexOf(tag),1),angular.element($(".tagsManagerInput .input")).css("visibility","visible"),self.repeatedRequests=!1,self.existingReviewer=!1,self.assignToSelf=!1}function tagAddedPeer(tag){void 0!==tag&&(self.searchTag.push(tag.email),self.searchTagPeer.push(tag),self.inputRequired=!1)}function tagRemovedPeer(tag){self.searchTag.splice(self.searchTag.indexOf(tag.email),1),self.searchTagPeer.splice(self.searchTagPeer.indexOf(tag.email),1),self.repeatedRequests=!1,self.existingReviewer=!1,self.assignToSelf=!1}function returnMemberList(pageSize){return self.masterCompetenciesList.length?void self.order(self.pageVariables.lastPredicate,self.pageVariables.lastReverse):!0}function order(predicate,reverse){self.pageVariables.lastPredicate=predicate,self.pageVariables.lastReverse=reverse,self.userEvaluationList=$filter("orderBy")(self.userEvaluationList,predicate,reverse)}function searchTextFilter(search){self.pageVariables.textSearching=search,self.returnMemberList()}function active(event,setting){self.pageVariables.lastPredicate=setting.predicate,self.pageVariables.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.pageVariables.lastPredicate),self.order(self.pageVariables.lastPredicate,self.pageVariables.lastReverse)}function sortManagerData(event,setting){self.pageVariables.lastPredicate=setting.predicate,self.pageVariables.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.pageVariables.lastPredicate),self.competencyEvaluationRequests=$filter("orderBy")(self.competencyEvaluationRequests,self.pageVariables.lastPredicate,self.pageVariables.lastReverse)}function resetfilter(){self.pageVariables=angular.copy(self.originalpageVariables),self.returnMemberList();var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")}var self=this;self.masterCompetenciesList=[],self.competenciesList=[],self.serviceApis={getAllCompetencyProfiles:"/sp/admin/competency/getAll",previewRating:"/sp/admin/competency/rating/preview",activateEvaluationModal:"/sp/admin/competency/activateEvaluation/modal",activateEvaluation:"/sp/admin/competency/activateEvaluation",endEvaluation:"/sp/admin/competency/endEvaluation",getAllUsers:"/sp/allUsers",initiateEvaluation:"/sp/competency/evaluation/feedback/initiate",initiateEvaluationModal:"/sp/competency/evaluation/feedback/initiateEvaluationModal",getEvaluationRequests:"/sp/competency/evaluation/feedback/requests",startEvaluation:"/sp/competency/evaluation/feedback/start",startEvaluationModal:"/sp/competency/evaluation/feedback/ratingModal",saveEvaluation:"/sp/competency/evaluation/feedback/save",ratingDetailsModal:"/sp/competency/evaluation/feedback/getEvaluationDetailsModal",getRatingDetails:"/sp/competency/evaluation/feedback/getEvaluationDetails",sendReminderModal:"/sp/competency/evaluation/feedback/sendReminder/modal",sendReminder:"/sp/competency/evaluation/feedback/sendReminder",changeManagerModal:"/sp/admin/competency/changeManager/modal"},self.pageVariables={searchText:"",disabledInfinite:!1,lastPredicate:"name",lastReverse:!1},self.responseAvailable=!1,self.originalpageVariables=angular.copy(self.pageVariables),self.selectedCompetencyProfileId="",self.selectedCompetencyProfileName="",self.competencyEvaluationInProgress=!1,self.competencyProfileMap={},self.competencyNameMap={},self.competencyEvaluationMap={},self.selectedCompetencyList=[],self.selectedCompetency={},self.currentIndex=0,self.currentIndexForRating=0,self.userEvaluationList=[],self.currentDate=new Date,self.evaluationEndDate=new Date,self.competencyEvaluation={},self.competencyMembersView=!1,self.managerView=!1,self.evaluationChecks={manager:!0,self:!1,peer:!1},self.searchTagEmail=[],self.emailMemberList=[],self.searchTag=[],self.searchTagPeer=[],self.initiateEvaluation={submitted:!1},self.inputRequired=!1,self.multipleManager=!1,self.repeatedRequests=!1,self.existingReviewer=!1,self.assignToSelf=!1,self.peerOnlyEvaluation=!0,self.initiateRequestType="",self.userToProcess={},self.competencyEvaluationRequests=[],self.competencyProfileForRating={},self.selectedCompetencyForRating={},self.userToBeAssessed={},self.userType="",self.ratingScoreArray=[],self.competencyRatingScore=3,self.scoreDetails={},self.reminderInfo={},self.currentManager={},self.showSelfRating=!1,self.showPeerRating=!1,self.competencyAdminDefaultView=!1,self.addedReviewersMap={},self.reviewersList=[],self.competencyRangeSlider=3,self.prevScores=[],self.getAllCompetencyProfiles=getAllCompetencyProfiles,self.previewRating=previewRating,self.activateEvaluationModal=activateEvaluationModal,self.searchTextFilter=searchTextFilter,self.returnMemberList=returnMemberList,self.active=active,self.sortManagerData=sortManagerData,self.order=order,self.resetfilter=resetfilter,self.prev=prev,self.next=next,self.prevEvaluation=prevEvaluation,self.nextEvaluation=nextEvaluation,self.changeCompetencyProfile=changeCompetencyProfile,self.activateEvaluation=activateEvaluation,self.endEvaluation=endEvaluation,self.endEvaluationModal=endEvaluationModal,self.initiateEvaluationModal=initiateEvaluationModal,self.tagRemovedManager=tagRemovedManager,self.loadTags=loadTags,self.tagAddedManager=tagAddedManager,self.getMemberList=getMemberList,self.tagRemovedPeer=tagRemovedPeer,self.tagAddedPeer=tagAddedPeer,self.initiateEvaluation=initiateEvaluation,self.getEvaluationRequests=getEvaluationRequests,self.startEvaluation=startEvaluation,self.saveEvaluation=saveEvaluation,self.openRatingDetailsModal=openRatingDetailsModal,self.sendReminderModal=sendReminderModal,self.sendReminder=sendReminder,self.changeManagerModal=changeManagerModal,self.changeManager=changeManager,self.initiatePeerEvaluation=initiatePeerEvaluation,self.validateReviewerInfo=validateReviewerInfo,self.isMobile=$(window).width()>767?!1:!0,self.toggleRowById=toggleRowById,self.activeRow=-1,self.winHeight=$(window).height()+100+"px",self.winWidth=$(window).width()}angular.module("spApp").controller("competencyManager",competencyManager),competencyManager.$inject=["$scope","ajaxService","ngDialog","$localStorage","sharedProperties","$filter","$rootScope","$timeout","$q"];
function createAffiliateCodeController($scope,$element,$attrs,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage){$scope.getCodeError=!1,$scope.generateAffiliateCode=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/getCode"}).then(function(response){if("true"===response.Success)$scope.getCodeError=!1,$scope.newAffiliateCode=response.promotion;else{$scope.getCodeError=!0;for(var key in response.error)$scope.getCodeErrorMsg=response.error[key]}})},$scope.productsError=!1,$scope.getAvailableProducts=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/getProducts"}).then(function(response){if("true"===response.Success)$scope.productsError=!1,$scope.productList=response.product;else{$scope.productsError=!0;for(var key in response.error)$scope.productsErrorMsg=response.error[key]}})},$scope.affliliateCode={},$scope.createAffiliateCode={},$scope.createAffiliateCode.validationError=!1,$scope.createCodeError=!1,$scope.setupAffiliateCode=function(fData){if(function(d){if("object"==typeof d){var _dm="undefined"!=typeof d?d.getMonth()+1:0,_dd="undefined"!=typeof d?d.getDate():0,_dy="undefined"!=typeof d?d.getFullYear():0,_dDate=(10>_dm?"0"+_dm:_dm)+"/"+(10>_dd?"0"+_dd:_dd)+"/"+_dy;fData.endDate=_dDate}else fData.endDate=d}(fData.endDate),fData.code=$scope.newAffiliateCode,$scope.productsError===!1&&$scope.getCodeError===!1){$scope.createAffiliateCode.validationError=!1;var vCount=0;for(var k in fData)("default"===fData[k]||"default1"===fData[k])&&vCount++;"COUNT_BASED"!==fData.promotionType?$scope.createAffiliateCode.$valid&&0===vCount&&fData.unitPrice>0?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/create",data:$.param(fData).replace(/%2F/g,"/")}).then(function(response){if("true"===response.Success)$scope.createCodeError=!1,$localStorage.set("gNotify","AddCode"),setTimeout(function(){window.location="/sp/sysAdmin/promotions/affiliateCodesListing"},100);else{$scope.createCodeError=!0;for(var key in response.error)$scope.createCodeErrorMsg=response.error[key]}}):$scope.createAffiliateCode.validationError=!0:"COUNT_BASED"===fData.promotionType&&(fData.count>0?($scope.createAffiliateCode.validationError=!1,$scope.createAffiliateCode.$valid&&0===vCount&&fData.unitPrice>0?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/create",data:$.param(fData).replace(/%2F/g,"/")}).then(function(response){if("true"===response.Success)$scope.createCodeError=!1,$localStorage.set("gNotify","AddCode"),setTimeout(function(){window.location="/sp/sysAdmin/promotions/affiliateCodesListing"},100);else{$scope.createCodeError=!0;for(var key in response.error)$scope.createCodeErrorMsg=response.error[key]}}):$scope.createAffiliateCode.validationError=!0):$scope.createAffiliateCode.validationError=!0)}},$scope.getDetailsError=!1,$scope.existingTags=null,$scope.getPromoDetails=function(pid){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/getDetails",data:$.param({promotionId:pid})}).then(function(response){if("true"===response.Success)$scope.getDetailsError=!1,$scope.existingPromoDetails=response.promotion,$scope.affliliateCode.productList=$scope.existingPromoDetails.productList[0].id,$scope.affliliateCode.promotionType=$scope.existingPromoDetails.promotionType,$scope.affliliateCode.unitPrice=$scope.existingPromoDetails.unitPrice,$scope.affliliateCode.endDate=($scope.existingPromoDetails.endDate.monthValue<10?"0"+$scope.existingPromoDetails.endDate.monthValue:$scope.existingPromoDetails.endDate.monthValue)+"/"+($scope.existingPromoDetails.endDate.dayOfMonth<10?"0"+$scope.existingPromoDetails.endDate.dayOfMonth:$scope.existingPromoDetails.endDate.dayOfMonth)+"/"+$scope.existingPromoDetails.endDate.year,$scope.existingPromoDetails.count>0&&($scope.affliliateCode.count=$scope.existingPromoDetails.count),$scope.existingPromoDetails.tags.length>0?$scope.existingTags=$scope.existingPromoDetails.tags.length>1?$scope.existingPromoDetails.tags.join(","):$scope.existingPromoDetails.tags[0]:$scope.existingTags=null,$scope.affliliateCode.message=$scope.existingPromoDetails.message,$scope.affliliateCode.status=$scope.existingPromoDetails.status;else{$scope.getDetailsError=!0;for(var key in response.error)$scope.getDetailsErrorMsg=response.error[key]}})},$scope.cancelRedirect=function(){window.location="/sp/sysAdmin/promotions/affiliateCodesListing"},function(){$scope.generateAffiliateCode(),$scope.getAvailableProducts(),$scope.affliliateCode.status="Active";var url=window.location.href,splitUrl=url.split("?")[1];"undefined"!=typeof splitUrl&&$scope.getPromoDetails(splitUrl.split("=")[1])}()}angular.module("spApp").controller("createAffiliateCodeController",createAffiliateCodeController),createAffiliateCodeController.$inject=["$scope","$element","$attrs","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage"];
function createLibraryHomeController($scope,$element,$attrs,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage,$filter){$scope.createNewLibraryHome={},$scope.createNewLibraryHome.validationErrors=!1,$scope.accountsListException=!1,$scope.updatedAccountListing=[],$scope.selectedAccountsCount=0,$scope.updatedListingIndex=0,$scope.accountList={},$scope.selectedCompanyIdList=[],$scope.allAccountsIdList=[],$scope.createNewLibraryHomeException=!1,$scope.filteredAccountListing={},$scope.cid="",$scope.newLibraryHome={},$scope.selectedAccountsDisplayList=[],$scope.showAccountsDisplayList=!1,$scope.cid="",$scope.searchKeywords=[],$scope.searchTag=[],$scope.pageSize=100,$scope.statusInclude=[],$scope.textSearching="",$scope.intialPageSize=100,$scope.load=!0,$scope.selectArticlesList=[];var companyFilterListIds=[],localStorageCompanyList=$localStorage.get("companyLibraryHomeList"),defaultImage="/sp/resources/images/image_not_available.jpg";$scope.newLibraryHome.articleImage0=defaultImage,$scope.newLibraryHome.articleImage1=defaultImage,$scope.newLibraryHome.articleImage2=defaultImage,$scope.newLibraryHome.articleImage3=defaultImage,$scope.getAccountList=function(){for(var i=0;i<localStorageCompanyList.length;i++)companyFilterListIds.push(localStorageCompanyList[i].id);ajaxService.getAjaxResponse({url:"/sp/sysAdmin/hk/getCompanyList",method:"GET"}).then(function(response){if("true"===response.Success)$scope.accountsListException=!1,$scope.accountListing=response.companies,jQuery.each($scope.accountListing,function(i,j){-1===jQuery.inArray($scope.accountListing[i].id,companyFilterListIds)&&($scope.updatedAccountListing.push(jQuery.extend({},$scope.accountListing[i],{accountSelectedStatus:!1})),$scope.allAccountsIdList.push($scope.accountListing[i].id))});else{$scope.accountsListException=!0;for(var key in response.error)$scope.accountsListExceptionMsg=response.error[key]}})},$scope.getCompanyId=function(){var url=window.location.href,splitUrl=url.split("?")[1];"undefined"!=typeof splitUrl?$scope.cid=splitUrl.split("=")[1]:$scope.cid=null},$scope.getLibraryHomeDetails=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/library/articles",data:$.param({companyId:$scope.cid})}).then(function(response){if("true"===response.Success)$scope.getDetailsException=!1,$scope.newLibraryHome.articleId0=response.Content[0].articleId,$scope.newLibraryHome.articleDescription0=response.Content[0].shortDescription,$scope.newLibraryHome.articleName0=response.Content[0].articleLinkLabel,null!==response.Content[0].imageUrl&&void 0!==response.Content[0].imageUrl&&($scope.newLibraryHome.articleImage0=response.Content[0].imageUrl+"?width=150"),$scope.newLibraryHome.articleId1=response.Content[1].articleId,$scope.newLibraryHome.articleDescription1=response.Content[1].shortDescription,$scope.newLibraryHome.articleName1=response.Content[1].articleLinkLabel,null!==response.Content[1].imageUrl&&void 0!==response.Content[1].imageUrl&&($scope.newLibraryHome.articleImage1=response.Content[1].imageUrl+"?width=150"),$scope.newLibraryHome.articleId2=response.Content[2].articleId,$scope.newLibraryHome.articleDescription2=response.Content[2].shortDescription,$scope.newLibraryHome.articleName2=response.Content[2].articleLinkLabel,null!==response.Content[2].imageUrl&&void 0!==response.Content[2].imageUrl&&($scope.newLibraryHome.articleImage2=response.Content[2].imageUrl+"?width=150"),$scope.newLibraryHome.articleId3=response.Content[3].articleId,$scope.newLibraryHome.articleDescription3=response.Content[3].shortDescription,$scope.newLibraryHome.articleName3=response.Content[3].articleLinkLabel,null!==response.Content[3].imageUrl&&void 0!==response.Content[3].imageUrl&&($scope.newLibraryHome.articleImage3=response.Content[3].imageUrl+"?width=150");else{$scope.company.name=null,$scope.getDetailsException=!0;for(var key in response.error)$scope.getDetailsExceptionMsg=response.error[key]}})},$scope.addtoSelectedAccounts=function(id){jQuery.each($scope.updatedAccountListing,function(i){return $scope.updatedAccountListing[i].id===id?($scope.updatedAccountListing[i].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[i].id),$scope.updatedAccountListing[i].updatedListingIndex=$scope.updatedListingIndex++,!1):void 0})},$scope.removeFromSelectedAccounts=function(id){jQuery.each($scope.updatedAccountListing,function(i){return $scope.updatedAccountListing[i].id===id?($scope.updatedAccountListing[i].accountSelectedStatus=!1,$scope.selectedAccountsCount-=1,$scope.selectedCompanyIdList.splice($scope.selectedCompanyIdList.indexOf(id),1),!1):void 0})},$scope.addFilteredAccounts=function(){var selectedList=$filter("filter")($scope.updatedAccountListing,$scope.accountList.search);jQuery.each(selectedList,function(i){jQuery.each($scope.updatedAccountListing,function(j){selectedList[i].id===$scope.updatedAccountListing[j].id&&($scope.updatedAccountListing[j].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[j].id),$scope.updatedAccountListing[j].updatedListingIndex=$scope.updatedListingIndex++)})}),$scope.accountList.search=null},$scope.accList=$scope.selectedCompanyIdList,$scope.selectArticleViaModal=function(articleId,articleName,position,articleImage){null===articleImage||void 0===articleImage?articleImage=defaultImage:articleImage+="?width=150",0===position?($scope.newLibraryHome.articleId0=articleId,$scope.newLibraryHome.articleName0=unescape(articleName),$scope.newLibraryHome.articleImage0=articleImage):1===position?($scope.newLibraryHome.articleId1=articleId,$scope.newLibraryHome.articleName1=unescape(articleName),$scope.newLibraryHome.articleImage1=articleImage):2===position?($scope.newLibraryHome.articleId2=articleId,$scope.newLibraryHome.articleName2=unescape(articleName),$scope.newLibraryHome.articleImage2=articleImage):3===position&&($scope.newLibraryHome.articleId3=articleId,$scope.newLibraryHome.articleName3=unescape(articleName),$scope.newLibraryHome.articleImage3=articleImage),ngDialog.close("ngdialog1")},$scope.createLibraryHome=function(fData){var _params=[],companyId=$scope.accList[0];if($scope.createNewLibraryHome.validationErrors=!1,$scope.createNewLibraryHomeException=!1,_params=[{articleId:$scope.newLibraryHome.articleId0,position:0,shortDescription:fData.articleDescription0,companyId:companyId},{articleId:$scope.newLibraryHome.articleId1,position:1,shortDescription:fData.articleDescription1,companyId:companyId},{articleId:$scope.newLibraryHome.articleId2,position:2,shortDescription:fData.articleDescription2,companyId:companyId},{articleId:$scope.newLibraryHome.articleId3,position:3,shortDescription:fData.articleDescription3,companyId:companyId}],void 0!==$scope.newLibraryHome.articleId0&&void 0!==$scope.newLibraryHome.articleId1&&void 0!==$scope.newLibraryHome.articleId2&&void 0!==$scope.newLibraryHome.articleId3&&void 0!==$scope.newLibraryHome.articleDescription0&&void 0!==$scope.newLibraryHome.articleDescription1&&void 0!==$scope.newLibraryHome.articleDescription2&&void 0!==$scope.newLibraryHome.articleDescription3&&""!==$scope.newLibraryHome.articleDescription0&&""!==$scope.newLibraryHome.articleDescription1&&""!==$scope.newLibraryHome.articleDescription2&&""!==$scope.newLibraryHome.articleDescription3&&$scope.accList.length>0){for(var i=0;4>i;i++)ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/admin/add/contentArticles",data:$.param(_params[i])}).then(function(response){if("true"===response.Success)$scope.createNewLibraryHome=!1,$localStorage.set("gNotify","AddNewLibraryHome");else{$scope.createNewLibraryHomeException=!0;for(var key in response.error)$scope.createNewLibraryHomeExceptionMsg=response.error[key]}});$.growl({icon:"glyphicon glyphicon-ok",message:" Articles Added Successfully"}),setTimeout(function(){window.location="/sp/sysAdmin/curriculam/libraryHome"},1e3)}else $.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Please fill all the required Fields"}),$scope.createNewLibraryHome.validationErrors=!0},$scope.selectArticle=function(position){$scope.fetchedTopics=[],$scope.selectArticlesList=[],ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/getAllTopics",method:"POST",data:$.param({topic:"Themes"})}).then(function(response){response&&($scope.fetchedTopics=response.topics,$scope.position=position,$scope.getArticlesList=function(themeValue){$scope.selectArticlesList=[],ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/getResults",method:"POST",data:$.param({topicValue:themeValue,topicCategory:"Themes"})}).then(function(response){if("true"===response.Success)response.articles.length>0&&($scope.getAllError=!1,$scope.selectArticlesList=response.articles,$scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize));else{$scope.getAllError=!0;for(var key in response.error)$scope.getAllErrorMsg=response.error[key]}})},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.returnMemberList($scope.pageSize)},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize))},$scope.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},$scope.returnMemberList=function(pageSize){if($scope.searchTag.length&&!$scope.statusInclude.length&&($scope.selectArticlesList=angular.copy($scope.newArr)),$scope.searchTag.length&&$scope.statusInclude.length){$scope.combineArray=[];for(var i=0;i<$scope.newArr.length;i++)for(var j=0;j<$scope.checkBox.length;j++)$scope.newArr[i].email===$scope.checkBox[j].email&&$scope.combineArray.push($scope.newArr[i]);$scope.selectArticlesList=angular.copy($scope.combineArray)}!$scope.searchTag.length&&$scope.statusInclude.length&&($scope.selectArticlesList=angular.copy($scope.checkBox)),$scope.searchTag.length||$scope.statusInclude.length||($scope.selectArticlesList=angular.copy($scope.selectArticlesList)),$scope.pageSize=pageSize,pageSize>=$scope.selectArticlesList.length&&($scope.pageSize=$scope.selectArticlesList.length),$scope.load&&($scope.lastPredicate="name",$scope.lastReverse=!1,$scope.loadBtnCLicked=!1,$scope.load=!1),$scope.loadBtnCLicked&&($scope.loadBtnCLicked=!1),$scope.order($scope.lastPredicate,$scope.lastReverse),$scope.selectArticlesList=$scope.selectArticlesList},$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.order=function(predicate,reverse){$scope.lastPredicate=predicate,$scope.lastReverse=reverse,$scope.selectArticlesList=$filter("orderBy")($scope.selectArticlesList,predicate,reverse)},ngDialog.open({template:"/sp/resources/html/sysAdmin/curriculam/selectArticleModal.html",scope:$scope}))})},$scope.cancelRedirect=function(){setTimeout(function(){window.location="/sp/sysAdmin/curriculam/libraryHome"},100)},function(){$scope.getAccountList(),-1!==window.location.href.indexOf("?")&&($scope.getCompanyId(),$scope.getLibraryHomeDetails())}()}angular.module("spApp").controller("createLibraryHomeController",createLibraryHomeController),createLibraryHomeController.$inject=["$scope","$element","$attrs","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage","$filter"];
function createPulseController($scope,$element,$attrs,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage,FileUploader,$filter){$scope.createNewPulse={},$scope.newPulse={},$scope.createNewPulse.validationErrors=!1,$scope.fileUploadException=!1,$scope.newPulse.status="Active",$scope.accountsListException=!1,$scope.updatedAccountListing=[],$scope.selectedAccountsCount=0,$scope.updatedListingIndex=0,$scope.accountList={},$scope.selectedCompanyIdList=[],$scope.pulseFileUploadStatus=!1,$scope.allAccountsIdList=[],$scope.createNewPulseException=!1,$scope.filteredAccountListing={},$scope.mapQuestionObject=[],$scope.triggerOpenFile=function(){var fileInput=jQuery("body").find("#selectFile");fileInput.click()},$scope.uploader=new FileUploader({url:"/sp/sysAdmin/pulse/createPulseFile",autoUpload:!0,alias:"pulseQuestionSet",onSuccessItem:function(item,response){if($scope.fileUploadException=!1,$scope.pulseFileUploadStatus=!1,null===response.error)$scope.fileUploadException=!1,$scope.pulseFileUploadStatus=!0,$scope.pulseFileName=item._file.name,$scope.questionList=response.success.pulseQuestion,$scope.questionSet(),$scope.pulseDrop=$scope.questionList.categoryKeys,$timeout(function(){$scope.defaultPulseName=0},0),$scope.noChart($scope.pulseDrop,0);else{$scope.pulseFileName=null,$scope.fileUploadException=!0,$scope.pulseFileUploadStatus=!1;for(var key in response.error)$scope.fileUploadExceptionMessage=response.error[key]}}}),$scope.defaultPulse=function(_this){$scope.noChart($scope.pulseDrop,$scope.defaultPulseName)},$scope.increment=function(){return $scope.defaultPulseName++,!0},$scope.decrement=function(){return $scope.defaultPulseName--,!0},$scope.questionSet=function(){"questions"in $scope.questionList&&($scope.mapQuestionObject=$scope.questionList.questions[$scope.activePulse])},$scope.noChart=function(arrayList,index){arrayList.length&&$scope.noChartPulse(arrayList[index])},$scope.noChartPulse=function(keyName){$scope.activePulse=keyName,$scope.mapQuestionObject=$scope.questionList.questions[keyName]},$scope.getAccountList=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/hk/getCompanyList",method:"GET"}).then(function(response){if("true"===response.Success)$scope.accountsListException=!1,$scope.accountListing=response.companies,jQuery.each($scope.accountListing,function(i,j){$scope.updatedAccountListing.push(jQuery.extend({},$scope.accountListing[i],{accountSelectedStatus:!1})),$scope.allAccountsIdList.push($scope.accountListing[i].id)});else{$scope.accountsListException=!0;for(var key in response.error)$scope.accountsListExceptionMsg=response.error[key]}})},$scope.addtoSelectedAccounts=function(id){jQuery.each($scope.updatedAccountListing,function(i){return $scope.updatedAccountListing[i].id===id?($scope.updatedAccountListing[i].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[i].id),$scope.updatedAccountListing[i].updatedListingIndex=$scope.updatedListingIndex++,!1):void 0})},$scope.removeFromSelectedAccounts=function(id){jQuery.each($scope.updatedAccountListing,function(i){return $scope.updatedAccountListing[i].id===id?($scope.updatedAccountListing[i].accountSelectedStatus=!1,$scope.selectedAccountsCount-=1,$scope.selectedCompanyIdList.splice($scope.selectedCompanyIdList.indexOf(id),1),!1):void 0})},$scope.removeAllSelectedAccounts=function(){jQuery.each($scope.updatedAccountListing,function(i){$scope.updatedAccountListing[i].accountSelectedStatus=!1,$scope.updatedAccountListing[i].updatedListingIndex=null}),$scope.selectedAccountsCount=0,$scope.selectedCompanyIdList=[]},$scope.addFilteredAccounts=function(){var selectedList=$filter("filter")($scope.updatedAccountListing,$scope.accountList.search);jQuery.each(selectedList,function(i){jQuery.each($scope.updatedAccountListing,function(j){selectedList[i].id===$scope.updatedAccountListing[j].id&&($scope.updatedAccountListing[j].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[j].id),$scope.updatedAccountListing[j].updatedListingIndex=$scope.updatedListingIndex++)})}),$scope.accountList.search=null},$scope.generateNewPulse=function(fData){var _params;$scope.createNewPulse.validationErrors=!1,$scope.createNewPulseException=!1,"All"===fData.assignAccounts?($scope.accList=$scope.allAccountsIdList,_params={name:fData.name,questionSetType:fData.questionSetType,status:$scope.newPulse.status,forAll:!0}):($scope.accList=$scope.selectedCompanyIdList,_params={name:fData.name,questionSetType:fData.questionSetType,status:$scope.newPulse.status,companyId:$scope.accList.join(),forAll:!1}),this.createNewPulse.$valid&&$scope.pulseFileUploadStatus===!0&&$scope.accList.length>0?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/pulse/createPulse",data:$.param(_params)}).then(function(response){if("true"===response.Success)$scope.createNewPulseException=!1,$localStorage.set("gNotify","AddPulse"),setTimeout(function(){window.location="/sp/sysAdmin/pulse/pulseListings"},100);else{$scope.createNewPulseException=!0;for(var key in response.error)$scope.createNewPulseExceptionMsg=response.error[key]}}):$scope.createNewPulse.validationErrors=!0},$scope.pulsePreview=function(){ngDialog.open({template:"/sp/resources/html/sysAdmin/pulse/pulse-preview.html",scope:$scope})},$scope.cancelRedirect=function(){setTimeout(function(){window.location="/sp/sysAdmin/pulse/pulseListings"},100)},$scope.clearFileStatus=function(){$scope.pulseFileUploadStatus=!1,$scope.pulseFileName=null},function(){$scope.getAccountList()}()}angular.module("spApp").controller("createPulseController",createPulseController),createPulseController.$inject=["$scope","$element","$attrs","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage","FileUploader","$filter"];
function createThemeController($scope,$element,$attrs,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage,$filter){$scope.accountsListException=!1,$scope.updatedAccountListing=[],$scope.selectedAccountsCount=0,$scope.updatedListingIndex=0,$scope.accountList={},$scope.selectedCompanyIdList=[],$scope.allAccountsIdList=[],$scope.accountList.search=null,$scope.filteredAccountListing={},$scope.newTheme={},$scope.newTheme.validationErrors=!1,$scope.newThemeDetails={},$scope.newThemeDetails.category="Business",$scope.newThemeDetails.isMandatory="true",$scope.newThemeDetails.status="ACTIVE",$scope.newThemeDetails.assignAccounts="All",$scope.createNewThemeException=!1,$scope.getAccountList=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/hk/getCompanyList",method:"GET"}).then(function(response){if("true"===response.Success)$scope.accountsListException=!1,$scope.accountListing=response.companies,jQuery.each($scope.accountListing,function(i,j){$scope.updatedAccountListing.push(jQuery.extend({},$scope.accountListing[i],{accountSelectedStatus:!1})),$scope.allAccountsIdList.push($scope.accountListing[i].id)});else{$scope.accountsListException=!0;for(var key in response.error)$scope.accountsListExceptionMsg=response.error[key]}})},$scope.addtoSelectedAccounts=function(id){jQuery.each($scope.updatedAccountListing,function(i){return $scope.updatedAccountListing[i].id===id?($scope.updatedAccountListing[i].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[i].id),$scope.updatedAccountListing[i].updatedListingIndex=$scope.updatedListingIndex++,!1):void 0})},$scope.removeFromSelectedAccounts=function(id){jQuery.each($scope.updatedAccountListing,function(i){return $scope.updatedAccountListing[i].id===id?($scope.updatedAccountListing[i].accountSelectedStatus=!1,$scope.selectedAccountsCount-=1,$scope.selectedCompanyIdList.splice($scope.selectedCompanyIdList.indexOf(id),1),!1):void 0})},$scope.removeAllSelectedAccounts=function(){jQuery.each($scope.updatedAccountListing,function(i){$scope.updatedAccountListing[i].accountSelectedStatus=!1,$scope.updatedAccountListing[i].updatedListingIndex=null}),$scope.selectedAccountsCount=0,$scope.selectedCompanyIdList=[]},$scope.addFilteredAccounts=function(){var selectedList=$filter("filter")($scope.updatedAccountListing,$scope.accountList.search);jQuery.each(selectedList,function(i){jQuery.each($scope.updatedAccountListing,function(j){selectedList[i].id===$scope.updatedAccountListing[j].id&&($scope.updatedAccountListing[j].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[j].id),$scope.updatedAccountListing[j].updatedListingIndex=$scope.updatedListingIndex++)})}),$scope.accountList.search=null},$scope.cancelRedirect=function(){setTimeout(function(){window.location="/sp/sysAdmin/goals/themeListings"},100)},$scope.createNewTheme=function(fData){var _params;$scope.newTheme.validationErrors=!1,$scope.createNewThemeException=!1,"All"===fData.assignAccounts?($scope.accList=$scope.allAccountsIdList,_params={name:fData.name,description:fData.description,status:fData.status,category:fData.category,isMandatory:fData.isMandatory,allAccounts:!0}):($scope.accList=$scope.selectedCompanyIdList,_params={name:fData.name,description:fData.description,status:fData.status,category:fData.category,isMandatory:fData.isMandatory,accounts:$scope.accList.join(),allAccounts:!1}),this.newTheme.$valid&&$scope.accList.length>0?($scope.newTheme.validationErrors=!1,ajaxService.getAjaxResponse({url:"/sp/sysAdmin/goals/createGoal",data:$.param(_params)}).then(function(response){if("true"===response.Success)$scope.createNewThemeException=!1,$localStorage.set("gNotify","AddTheme"),setTimeout(function(){window.location="/sp/sysAdmin/goals/themeListings"},100);else{$scope.createNewThemeException=!0;for(var key in response.error)$scope.createNewThemeExceptionMsg=response.error[key]}})):$scope.newTheme.validationErrors=!0},function(){$scope.getAccountList()}()}angular.module("spApp").controller("createThemeController",createThemeController),createThemeController.$inject=["$scope","$element","$attrs","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage","$filter"];
function dashBoardController($scope,ajaxService,sharedProperties,$localStorage,$rootScope){function localStorageTaskCheck(){"true"===$localStorage.get("pulseDone")&&$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("dashboard.pulse.completion")})&&$localStorage.remove("pulseDone")}function getTasks(){ajaxService.getAjaxResponse({url:vm.config.getTasks}).then(function(response){if("true"===response.Success)vm.getTasks="undefined"!=typeof response.tasks?response.tasks:[],createTaskArray(vm.getTasks);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function createTaskArray(task){for(var i=0;i<task.length;i++)"WorkspacePulse"===task[i].type&&(vm.pulseTask={pulseRequestId:task[i].params.pulseRequestId,endDate:task[i].params.endDate,type:task[i].type}),("CompetencyEvaluationInitiate"===task[i].type||"CompetencyEvaluationSelf"===task[i].type)&&(vm.competencyTask={endDate:task[i].endDate,description:task[i].params.description,linkText:task[i].params.linkText,title:task[i].params.title,type:task[i].type})}function redirectToCompetency(type){$localStorage.set("competencyAlertType",type),window.location.href="/sp/competency/home"}function getFeedBack(){ajaxService.getAjaxResponse({url:vm.config.getFeedBack,method:"get"}).then(function(response){if("true"===response.Success)vm.feedBackResult=response.feedbackTeam;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getGrowth(){ajaxService.getAjaxResponse({url:vm.config.getGrowth}).then(function(response){if("true"===response.Success)vm.growthResult=response.growthTeam,vm.pageSetting.growthAjaxDone=!0;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getTopNotesAndFeedback(){ajaxService.getAjaxResponse({url:vm.config.getTopNotesAndFeedback}).then(function(response){if("true"===response.Success)vm.notesAndFeedbackList=response.allNotesFeedback,vm.pageSetting.notesAndFeedbackDone=!0;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getNotification(){ajaxService.getAjaxResponse({url:vm.config.getNotification}).then(function(response){if("true"===response.Success)vm.logTypes=response.logType,vm.notifcationMessages=response.notifications,vm.pageSetting.notifcationAjaxDone=!0;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getActivites(){ajaxService.getAjaxResponse({url:vm.config.getActivites}).then(function(response){if("true"===response.Success)vm.activitiesMessages=response.activityMessages,vm.pageSetting.activityAjaxDone=!0;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getRecentlyVisited(){ajaxService.getAjaxResponse({url:vm.config.getRecentlyVisited,method:"get"}).then(function(response){if("true"===response.Success)vm.recentlyVisited=response.trackingResponse,vm.recentlyVisited.length||(vm.getGoals(),vm.pageSetting.pullRight=!0,$scope.tabSet0=1);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getGoals(){ajaxService.getAjaxResponse({url:vm.config.getGoals,method:"get"}).then(function(response){if("true"===response.Success){vm.logName=[],vm.goalResult=response.userGoal;for(var i=0;i<vm.goalResult.length;i++)vm.logName.push(vm.goalResult[i].goal.name);vm.pageSetting.goalAjaxDone=!0,vm.selectSearch(vm.logName[0])}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function selectSearch(searchKey){for(var i=0;i<vm.goalResult.length;i++)if(vm.goalResult[i].goal.name===searchKey){vm.goalResultModified=vm.goalResult[i];break}}function startPulseLink(){window.location.href="/sp/pulseUser/pulseStartAssessment?pulseRequestId="+vm.pulseTask.pulseRequestId}function moreNotification(type,size){switch(type){case"notification":vm.pageSetting.pageSize=size;break;case"activity":vm.pageSetting.activeSize=size}}function callAjax(check,fn){check||fn()}var vm=this,userRoles=$localStorage.get("loggegdInProfile").member.roles;vm.isPrismLensAvailable=-1!==userRoles.indexOf("PrismLens")?!0:!1,vm.collaborativeTask={},vm.competencyTask=null,vm.pulseTask=null,vm.pageSetting={pageSize:10,activeSize:10,activityAjaxDone:!1,growthAjaxDone:!1,goalAjaxDone:!1,pullRight:!1,pulseInactive:!1,notifcationAjaxDone:!1,notesAndFeedbackDone:!1},vm.config={getTasks:"/sp/dashboard/getTasks",getFeedBack:"/sp/dashboard/feedback/myrequests",getGrowth:"/sp/dashboard/growth/myrequests",getNotification:"/sp/logs/getDashboardNotificationLogs",getActivites:"/sp/logs/getDashboardActivityLogs",getRecentlyVisited:"/sp/tracking/recentVistedArticles",getGoals:"/sp/dashboard/getUserGoals",getTopNotesAndFeedback:"/sp/dashboard/getNotesAndFeedback"},vm.feedBackResult=[],vm.growthResult=[],vm.activitiesMessages=[],vm.logTypes=[],vm.notifcationMessages=[],vm.recentlyVisited=[],vm.goalResult=[],vm.notesAndFeedbackList=[],vm.getTasks=getTasks,vm.getFeedBack=getFeedBack,vm.getGrowth=getGrowth,vm.getNotification=getNotification,vm.getActivites=getActivites,vm.getRecentlyVisited=getRecentlyVisited,vm.getGoals=getGoals,vm.selectSearch=selectSearch,vm.startPulseLink=startPulseLink,vm.moreNotification=moreNotification,vm.getTopNotesAndFeedback=getTopNotesAndFeedback,vm.callAjax=callAjax,vm.redirectToCompetency=redirectToCompetency,function(){localStorageTaskCheck()}()}function dashBoardListing($scope,ajaxService,sharedProperties,ngDialog,$filter,$localStorage){function getMembersData(){var options={url:vm.config.getMembersData};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success)vm.masterMemberList=response.memberList.length?response.memberList:[],vm.groupList=response.groupList,vm.responseRecieved=!0,vm.groupBasedResult(""),angular.forEach(response.memberList,function(val,index){vm.allMembersEmailId.push({email:val.email})});else if(null!==response.error){var errorMessage="";vm.responseRecieved=!0;for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function groupBasedResult(selectedSearch){""===selectedSearch||null===selectedSearch?vm.memberList=angular.copy(vm.masterMemberList):vm.memberList=vm.masterMemberList.filter(function(e){return-1!==e.groups.indexOf(selectedSearch)}),!vm.pageSetting.alltoggle&&(vm.pageSetting.negative=!1,vm.pageSetting.userEmail.email=[]),vm.pageSetting.negative&&vm.checkAll(),vm.returnMemberList(vm.pageSetting.pageSize)}function returnMemberList(pageSize){return vm.masterMemberList.length?(vm.pageSetting.pageSize=pageSize,pageSize>=vm.masterMemberList.length&&(vm.pageSetting.disabledInfinite=!0,vm.pageSetting.pageSize=vm.masterMemberList.length),void vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)):!0}function order(predicate,reverse){vm.pageSetting.lastPredicate=predicate,vm.pageSetting.lastReverse=reverse,vm.memberList=$filter("orderBy")(vm.memberList,vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)}function active(event,setting){vm.pageSetting.lastPredicate=setting.predicate,vm.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.pageSetting.lastPredicate),vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)}function checkAll(){vm.pageSetting.checkedAll=!vm.pageSetting.checkedAll,vm.pageSetting.negative?vm.pageSetting.userEmail.email=vm.memberList.map(function(item){return{email:item.email,name:item.name,title:item.title}}):vm.pageSetting.userEmail.email=[]}function checkUncheck(){vm.pageSetting.alltoggle=!1,vm.pageSetting.checkedAll&&(vm.pageSetting.negative=!vm.pageSetting.negative,vm.pageSetting.checkedAll=!vm.pageSetting.checkedAll)}function searchTextFilter(search){vm.pageSetting.textSearching=search}function clearSearch(){vm.pageSetting.textSearching.length&&(vm.pageSetting.textSearching="",vm.pageSetting.searchText="")}function memberTakeAway(email){$localStorage.set("memEmail",email),window.location.href="/sp/dashboardUserAnalysis?email="+email}function resetfilter(){vm.pageSetting=angular.copy(vm.originalpageSetting),vm.groupBasedResult(vm.pageSetting.selectedSearch)}var vm=this;vm.memberList=[],vm.masterMemberList=[],vm.groupList=[],vm.responseRecieved=!1,vm.config={getMembersData:"/sp/groupLead/getMembersAndGroups"},vm.pageSetting={pageSize:10,userEmail:{email:[]},lastPredicate:"name",lastReverse:!1,textSearching:"",disabledInfinite:!1,selectedSearch:"",negative:!1,alltoggle:!1},vm.originalpageSetting=angular.copy(vm.pageSetting),vm.allMembersEmailId=[],vm.getMembersData=getMembersData,vm.groupBasedResult=groupBasedResult,vm.returnMemberList=returnMemberList,vm.order=order,vm.active=active,vm.checkAll=checkAll,vm.searchTextFilter=searchTextFilter,vm.clearSearch=clearSearch,vm.memberTakeAway=memberTakeAway,vm.resetfilter=resetfilter,vm.checkUncheck=checkUncheck}angular.module("spApp").controller("dashBoardController",dashBoardController),angular.module("spApp").controller("dashBoardListing",dashBoardListing),dashBoardController.$inject=["$scope","ajaxService","sharedProperties","$localStorage","$rootScope"],dashBoardListing.$inject=["$scope","ajaxService","sharedProperties","ngDialog","$filter","$localStorage"];
function emailManagerController($scope,ajaxService,$localStorage,ngDialog,sharedProperties,filterFilter,$filter,$rootScope,$timeout){function switchView(){"normal"===self.viewMode?(self.emailForm.submitted=!1,self.emailForm.$valid?self.viewMode="preview":self.emailForm.submitted=!0):self.viewMode="normal"}function getAllCompaniesWithEmailSettings(){ajaxService.getAjaxResponse({url:self.serviceApis.getAllCompaniesWithEmailSettings,method:"POST"}).then(function(response){if("true"===response.Success)self.responseAvailable=!0,self.masterList=response.emailManagement,self.companiesWithEmailCustomization=angular.copy(self.masterList);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getAllCompaniesWithoutEmailSettings(){ajaxService.getAjaxResponse({url:self.serviceApis.getAllNonCustomizedCompanies,method:"POST"}).then(function(response){if("true"===response.Success)self.companyList=response.companies,openSelectCompanyModal(),self.responseAvailableForModal=!0;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getAllEmailTemplates(){ajaxService.getAjaxResponse({url:self.serviceApis.getAllEmailTemplates,method:"POST"}).then(function(response){if("true"===response.Success)self.emailList=response.notificationList,openSelectEmailModal(),self.responseAvailableForModal=!0,null===self.emailData.notificationTypeMap&&(self.emailData.notificationTypeMap={}),self.emailList=self.emailList.filter(function(obj){return void 0===self.emailData.notificationTypeMap[obj.type]});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function openSelectCompanyModal(){var dialog=ngDialog.open({template:self.serviceApis.openCompanyModal,scope:$scope});dialog.closePromise.then(function(data){self.companySearchText=""})}function openSelectEmailModal(){null===self.emailData.notificationTypeMap&&(self.emailData.notificationTypeMap={}),self.emailList=self.emailList.filter(function(obj){return void 0===self.emailData.notificationTypeMap[obj.type]});var dialog=ngDialog.open({template:self.serviceApis.openEmailsModal,scope:$scope});dialog.closePromise.then(function(data){self.emailSearchText=""})}function selectCompany(){self.companyList.length?openSelectCompanyModal():getAllCompaniesWithoutEmailSettings()}function selectEmailTemplate(){self.emailList.length?openSelectEmailModal():getAllEmailTemplates()}function displayEmailInfo(obj){obj.type!==self.selectedEmailKey&&(self.emailForm.submitted=!1,self.selectedEmailContent={},self.selectedEmailKey=obj.type,self.selectedEmailDisplayName=obj.name,self.selectedEmailContent=angular.copy(self.emailData.content[obj.type]))}function addToEmailDataMap(obj){null===self.emailData.content&&(self.emailData.content={}),self.selectedEmailKeyNamesList.push(obj),self.selectedEmailKey=obj.type,self.selectedEmailContent={},self.selectedEmailDisplayName=obj.name,self.emailData.notificationTypeMap[obj.type]=obj.name,ngDialog.close()}function getEmailData(type){var param=getParameter("id");null===param&&(param="default"),self.selectedCompanyId=param,ajaxService.getAjaxResponse({url:self.serviceApis.getDetails,data:$.param({companyId:"SuperAdmin"===type?self.selectedCompanyId:""}),method:"POST"}).then(function(response){if("true"===response.Success){if(self.emailData=response.emailManagement,null!==response.emailManagement.content){for(var keyname in self.emailData.notificationTypeMap)self.selectedEmailObj={},self.selectedEmailObj.type=keyname,self.selectedEmailObj.name=self.emailData.notificationTypeMap[keyname],self.selectedEmailKeyNamesList.push(self.selectedEmailObj);self.selectedEmailKeyNamesList.length>0&&(self.selectedEmailKeyNamesList=$filter("orderBy")(self.selectedEmailKeyNamesList,"name")),self.selectedEmailKey=self.selectedEmailKeyNamesList[0].type,self.selectedEmailDisplayName=self.selectedEmailKeyNamesList[0].name,self.selectedEmailContent=angular.copy(self.emailData.content[self.selectedEmailKeyNamesList[0].type])}self.selectedCompanyAdminAccess=self.emailData.companyAllowed,null!==self.emailData.company&&(self.selectedCompanyName=self.emailData.company.name)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function updateEmailCustomization(type){self.emailFormData={},"AccountAdmin"===type?self.emailFormData.companyId="":self.emailFormData.companyId=self.selectedCompanyId,self.emailFormData.type=self.selectedEmailKey,self.emailFormData.content=self.selectedEmailContent,ajaxService.getAjaxResponse({url:self.serviceApis.createOrUpdate,data:self.emailFormData,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)$.growl({icon:"glyphicon glyphicon-ok",message:"Email Template Updated"}),self.emailData.content[self.selectedEmailKey]=angular.copy(self.emailFormData.content),$timeout(function(){self.viewMode="normal"},500);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function deleteEmailsModal(options){self.emailDeleteOptions=options,ngDialog.open({template:"/sp/resources/html/sysAdmin/emails/delete-emails-modal.html",scope:$scope})}function deleteEmailCustomization(){self.emailFormData={},self.emailFormData.companyId=self.emailDeleteOptions.id,self.emailFormData.deleteAll=self.emailDeleteOptions.deleteAll,self.emailFormData.type=self.emailDeleteOptions.emailTemplate,ajaxService.getAjaxResponse({url:self.serviceApis["delete"],data:self.emailFormData,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)location.reload();else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function updateAdminAccess(status){self.emailFormData={},self.emailFormData.companyId=self.selectedCompanyId,self.emailFormData.companyAllowed=status,ajaxService.getAjaxResponse({url:self.serviceApis.updateAdminAccess,data:self.emailFormData,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)$.growl({icon:"glyphicon glyphicon-ok",message:"Status Updated Successfully"});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function resetResults(){self.searchText="",self.companiesWithEmailCustomization=[],self.companiesWithEmailCustomization=angular.copy(self.masterList),sortResults()}function active(event,setting){self.lastPredicate=setting.predicate,self.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,self.lastPredicate),self.sortResults(self.lastPredicate,self.lastReverse)}function sortResults(predicate,reverse){self.lastPredicate=predicate,self.lastReverse=reverse;var resp=$filter("orderBy")(self.masterList,predicate,reverse);self.companiesWithEmailCustomization=[],self.companiesWithEmailCustomization=resp}var self=this;self.serviceApis={getAllCompaniesWithEmailSettings:"/sp/sysAdmin/emailManagement/getAll",createOrUpdate:"/sp/emailManagement/createUpdate",getDetails:"/sp/emailManagement/get","delete":"/sp/emailManagement/delete",getCompanies:"/sp/sysAdmin/blueprint/getCompanies",openCompanyModal:"/sp/sysAdmin/emails/selectCompany",getAllNonCustomizedCompanies:"/sp/sysAdmin/emailManagement/getCompanies",getAllEmailTemplates:"/sp/emailManagement/getNotifications",openEmailsModal:"/sp/admin/emails/selectEmails",updateAdminAccess:"/sp/sysAdmin/emailManagement/companyPermission"},self.responseAvailable=!1,self.responseAvailableForModal=!1,self.companySearchText="",self.emailSearchText="",self.searchText="",self.masterList=[],self.companyList=[],self.companiesWithEmailCustomization=[],self.emailList=[],self.selectedEmailKeyNamesList=[],self.selectedEmailObj={},self.selectedEmailContent={},self.selectedEmailKey="",self.selectedEmailDisplayName="",self.emailData={},self.selectedCompanyId="default",self.selectedCompanyName="default",self.selectedCompanyAdminAccess=!1,self.lastPredicate="name",self.lastReverse=!1,self.companyInfo={},self.companyDisplayName="",self.viewMode="normal",self.emailDeleteOptions={},self.selectCompany=selectCompany,self.selectEmailTemplate=selectEmailTemplate,self.getAllCompaniesWithEmailSettings=getAllCompaniesWithEmailSettings,self.getEmailData=getEmailData,self.active=active,self.sortResults=sortResults,self.resetResults=resetResults,self.deleteEmailsModal=deleteEmailsModal,self.deleteEmailCustomization=deleteEmailCustomization,self.updateEmailCustomization=updateEmailCustomization,self.getAllEmailTemplates=getAllEmailTemplates,self.displayEmailInfo=displayEmailInfo,self.addToEmailDataMap=addToEmailDataMap,self.switchView=switchView,self.updateAdminAccess=updateAdminAccess;var getParameter=function(val){for(var query=window.location.search.substring(1),vars=query.split("&"),pair=[],i=0;i<vars.length;i++)return pair=vars[i].split("="),pair[0]===val?pair[1]:null}}angular.module("spApp").controller("emailManagerController",emailManagerController),emailManagerController.$inject=["$scope","ajaxService","$localStorage","ngDialog","sharedProperties","filterFilter","$filter","$rootScope","$timeout"];
function externalFeedbackController($scope,ajaxService,$localStorage,ngDialog,sharedProperties,filterFilter,$filter){function stateControl(list){var result=list.actionData.filter(function(e){return e.permissions.Completion&&!e.completed});return result.length?!0:!1}function sendFeedbackRequest(options,isExternal){_this.requestFormSubmitted=!1,_this.sendFeedbackForm.$valid?ajaxService.getAjaxResponse({url:_this.serviceApis.sendFeedbackRequest,data:$.param({feedbackId:options.feedbackId,feedbackResponse:options.feedbackResponse})}).then(function(response){if("true"===response.Success)sessionStorage.setItem("tyMsg1",response.heading1),sessionStorage.setItem("tyMsg2",response.heading2),window.location="/sp/goals/feedback/external/complete";else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}}):_this.requestFormSubmitted=!0}function cancelFeedbackRequest(id){ajaxService.getAjaxResponse({url:_this.serviceApis.cancelFeedbackRequest,data:$.param({feedbackId:id,feedbackStatus:"DECLINED"})}).then(function(response){if("true"===response.Success)window.location="/?status=feedbackDecline",console.log(response);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getBluePrintSetting(){ajaxService.getAjaxResponse({url:_this.serviceApis.bluePrintSetting,data:$.param({feedbackId:$("#feedbackId").val()})}).then(function(response){if("true"===response.Success)_this.dataMap=response.blueprintSettings.dataMap;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getBluePrint(){ajaxService.getAjaxResponse({url:_this.serviceApis.blueprintDetails,data:$.param({feedbackId:$("#feedbackId").val()})}).then(function(response){if("true"===response.Success)_this.blueprint=response.blueprint,_this.blueprintReady=!0;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}$localStorage.flush();var _this=this;_this.requestFormSubmitted=!1,_this.blueprintReady=!1,_this.noBlue=!1,_this.blueprint=[],_this.sendFeedbackRequest=sendFeedbackRequest,_this.cancelFeedbackRequest=cancelFeedbackRequest,_this.stateControl=stateControl,_this.serviceApis={sendFeedbackRequest:"/sp/goals/feedback/external/response",cancelFeedbackRequest:"/sp/goals/feedback/external/updateStatus",blueprintDetails:"/sp/goals/token/feedback/blueprint/details",bluePrintSetting:"/sp/blueprint/getSettings"},function(){"Blueprint"===$("#category").val()?(getBluePrint(),getBluePrintSetting()):_this.noBlue=!0}()}function externalUserFlow($scope,$element,ajaxService,$localStorage){$scope.sfailure=!1,$scope.externalUserInfo=[],$scope.assessment360page=!1,$scope.setOptions=function(){$scope.assessment360page=!0},$scope.initExternalLogin=function(form){if($scope.sfailure=!1,$scope.spExtLogin.submitted=!1,$scope.spExtLogin.$valid)ajaxService.getAjaxResponse({url:$scope.assessment360page===!0?"/sp/feedback/external/confirmProfileDetails":"/sp/growth/external/confirmProfileDetails",data:$("form").serialize()}).then(function(response){"true"===response.Success?$scope.assessment360page?window.location.reload():($localStorage.set("externalRequestInitiated",response),window.location.href="/sp/growth/requestDetailExternal"):($scope.failure=response.error,$scope.sfailure=!0)});else{var elem=angular.element($element);$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300),$scope.spExtLogin.submitted=!0}}}function externalFeedbackThankYouCtrl($scope,$localStorage,$timeout){var _this=this;_this.getData={heading1:sessionStorage.getItem("tyMsg1"),heading2:sessionStorage.getItem("tyMsg2")},$timeout(function(){sessionStorage.removeItem("tyMsg1"),sessionStorage.removeItem("tyMsg2")},250)}angular.module("spApp").controller("externalFeedbackController",externalFeedbackController),angular.module("spApp").controller("externalUserFlow",externalUserFlow),externalFeedbackController.$inject=["$scope","ajaxService","$localStorage","ngDialog","sharedProperties","filterFilter","$filter"],externalUserFlow.$inject=["$scope","$element","ajaxService","$localStorage"],angular.module("spApp").controller("externalFeedbackThankYouCtrl",externalFeedbackThankYouCtrl),externalFeedbackThankYouCtrl.$inject=["$scope","$localStorage","$timeout"];
function feedbackController($scope,ajaxService,$filter,ngDialog,sharedProperties,$rootScope,$timeout){$scope.feedbackTeam=!1,$scope.feedbackGrowth=[],$scope.current=5,$scope.allowAdd=!0,$scope.responseRecieved=!1,$scope.getAllMembersToInvite=[],$scope.masterGetAllMembersToInvite=[],$scope.viewMember=!1,$scope.oldView="",$scope.textSearching="",$scope.listCreaator=[],$scope.getInviteMemberDetail=[],$scope.errorMessage="",$scope.showError=!1,$scope.initSet=!1,$scope.goalUser="",$scope.goals={selected:[]},$scope.inviteError=!1,$scope.dateError=!1,$scope.inviteMemNonMember=!0,$scope.inviteMember=!0,$scope.inviteNonMember=!1,$scope.howDoYouKnow=["Friend","Family","Work Colleague"],$scope.goalUserNon="",$scope.growthName="",$scope.growthTitle="",$scope.hideIt=!0,$scope.id="";var d=new Date;$scope.maxDate=d.setMonth(d.getMonth()+3),$scope.feedback={user:[]},$scope.viewDrop=!1,$scope.nootherequest=!1,$scope.showTheme=!1,$scope.matchCase=[],$scope.sendGrowthdetail=function(name,description){$scope.growthName=name,$scope.growthTitle=description,ngDialog.open({template:"/sp/growth/growthPop",scope:$scope})},$scope.redirectTo=function(change){"default"!==change&&(""===$rootScope.noSelf?window.location.href=change:$rootScope.callSwitchChange("feedArchiveDetail"))},$scope.pageSetup=function(){$scope.getfeedbackTeam()},$scope.getfeedbackTeam=function(){$scope.getAllMembersToInvitefn(),ajaxService.getAjaxResponse({url:"/sp/getFeedbackTeam?groupMemberEmail="+$rootScope.noSelf,method:"get"}).then(function(response){"true"===response.Success?($scope.getfeedbackTeam=response,"undefined"!=typeof response.feedbackTeam?(angular.forEach(response.feedbackTeam,function(value,index){null!=value.email&&$rootScope.add($scope.feedback.user,value.email)}),$scope.showTheme=response.themesPresent,$scope.feedbackGrowth=response.feedbackTeam,$scope.listCreaator=angular.copy($scope.feedbackGrowth),$scope.currentActive=$scope.feedbackGrowth.length,$scope.viewDrop=!0,$scope.formatList("active")):($scope.currentActive=$scope.feedbackGrowth.length,$scope.formatList(),$scope.feedbackTeam=!0)):null!=response.error&&(window.location.href="/sp")})},$scope.nonMemberGrowthCall=function(){ajaxService.getAjaxResponse({url:"/sp/getUserGrowthAreas",data:$.param({groupMemberEmail:$rootScope.noSelf})}).then(function(response){if("true"===response.Success)$scope.goalUserNon=response.goals;else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})},$scope.formatList=function(newAdd){if($scope.currentActive<$scope.current)for(var push=$scope.current-$scope.listCreaator.length,i=0;push>i;i++)$scope.incrementList();else if($scope.feedbackTeam=!1,$scope.viewMember=!0,$scope.inviteMemberView=!1,"undefined"!=typeof newAdd&&"first"===newAdd){var _this=$("ul.listSection").find("li:eq(0)");$scope.invitedMemberView(_this,_this.find("div").attr("data-email")),$scope.addUserFull=!1,$("ul.listSection").find("div").removeClass("selected"),$("ul.listSection").find("li:eq(0)").find("div").addClass("selected")}if("undefined"!=typeof newAdd&&"first"!==newAdd){$scope.oldView="";var len=$scope.feedbackGrowth.length;$("ul.listSection").find("div").removeClass("selected"),$("ul.listSection").find("li:eq("+len+")").find("div").addClass("selected")}},$scope.callSendArchivePopup=function(getInviteMemberDetail){$scope.archiveMember=getInviteMemberDetail,ngDialog.open({template:"/sp/feedback/archiveMemberScreen",scope:$scope})},$scope.sendToArchive=function(id,email,grouplead){$scope.showError=!1,ajaxService.getAjaxResponse({url:"/sp/archiveFeedback",data:$.param({feedbackUserId:id})}).then(function(response){if("true"===response.Success)sharedProperties.spliceIndex($scope.listCreaator,"id",id),sharedProperties.spliceIndex($scope.feedbackGrowth,"id",id),$rootScope.remove($scope.feedback.user,email),$scope.currentActive=$scope.feedbackGrowth.length,$scope.formatList("active"),$scope.getAllMembersToInvitefn(),$scope.inviteMemberView=!1,"undefined"!=typeof $scope.getAllMembersToInvite.userType?($scope.viewMember=!0,$scope.inviteNonMember=$scope.inviteMember=$scope.hideIt=!1):$scope.viewMember=$scope.inviteNonMember=$scope.inviteMember=!0,ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Member</strong>",message:" archived successfully"}),sharedProperties.fireAnalyticsEvent("Prism Lens | Feedback Archived","N/A");else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage}),ngDialog.close("ngdialog1")}})},$scope.incrementList=function(){$scope.listCreaator.push({email:"invite"})},$scope.isActive=function(index){return index===$scope.currentActive?!0:!1},$scope.filteredFeedback=function(id){return $rootScope.contains($scope.feedback.user,id)?!0:!1},$scope.invitationSended=function(form,email){$scope.inviteError=!1,$scope.dateError=!1,form.$valid?$scope.invitationDirtyCheckClear(email):$scope.inviteError=!0},$scope.invitationDirtyCheckClear=function(email){if(!$scope.allowAdd)return!0;$scope.allowAdd=!1;var form=$("form.imonly").serialize()+"&groupMemberEmail="+$rootScope.noSelf;ajaxService.getAjaxResponse({url:"/sp/submitFeedbackRequest",data:form}).then(function(response){if("true"===response.Success)$scope.feedbackGrowth.push(response.inviteCreated),$scope.listCreaator=angular.copy($scope.feedbackGrowth),$scope.currentActive=$scope.feedbackGrowth.length,sharedProperties.spliceIndex($scope.getAllMembersToInvite.feedbackUsers,"email",email),sharedProperties.spliceIndex($scope.masterGetAllMembersToInvite.feedbackUsers,"email",email),$scope.currentActive>=$scope.current?$scope.formatList("first"):$scope.formatList("active"),window.scrollTo($(".listSection").offset().top,0),$scope.goals.selected=[],ngDialog.close("ngdialog1"),$timeout(function(){$scope.allowAdd=!0},500),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Member </strong> ",message:"invited successfully"}),sharedProperties.fireAnalyticsEvent("Prism Lens | Send Feedback Request to member","N/A");else if(null!=response.error){$scope.allowAdd=!0;for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:$scope.errorMessage})}})},$scope.getAllMembersToInvitefn=function(){ajaxService.getAjaxResponse({url:"/sp/getAllFeedbackMembers",data:$.param({groupMemberEmail:$rootScope.noSelf})}).then(function(response){if("true"===response.Success)$scope.getAllMembersToInvite=response,$scope.responseRecieved=!0,$scope.masterGetAllMembersToInvite=angular.copy($scope.getAllMembersToInvite);else if(null!=response.error)for(var key in response.error)$scope.errorMessage=response.error[key]})},$scope.callInitMember=function(id,event,email){var _this="";if(!$scope.initSet){_this=$("ul.listSection").find("li:eq("+id+")");var catchEmailed=sharedProperties.getParam("feeddbackMemberId");$scope.matchCase.length||($scope.matchCase=$scope.listCreaator.filter(function(entry){return entry.id===catchEmailed}),null===catchEmailed||$scope.matchCase.length||$.growl({icon:"glyphicon glyphicon-ban-circle",message:$rootScope.pullInterNationalization("feedback.feedbackListing.noUserFound")})),null!==catchEmailed&&$scope.matchCase.length?catchEmailed===email&&($scope.invitedMemberView(_this,email),$scope.initSet=!0,_this.find("div").addClass("selected")):($scope.invitedMemberView(_this,email),$scope.initSet=!0,_this.find("div").addClass("selected"))}},$scope.callViewMember=function(id,event,email){var _this=$(event.currentTarget);if(_this.find("a").data("invite")){if(sharedProperties.fireAnalyticsEvent("Prism Lens | Request Prism Lens","N/A"),id!==$scope.currentActive&&!_this.hasClass("active"))return!1;$scope.id="",$scope.feedbackTeam=$scope.inviteMemberView=!1,$scope.viewMember=!0,"undefined"!=typeof $scope.getAllMembersToInvite.userType?$scope.inviteNonMember=$scope.inviteMember=$scope.hideIt=!1:$scope.inviteNonMember=$scope.inviteMember=!0,$scope.inviteMemNonMember&&(_this.hasClass("selected")||(_this.closest(".listSection").find("div").removeClass("selected"),_this.addClass("selected")),$scope.getAllMembersToInvite=angular.copy($scope.masterGetAllMembersToInvite),$scope.searchText="",$scope.oldView=id),$scope.viewDrop=!0}else sharedProperties.fireAnalyticsEvent("Prism Lens | View Lens Summary","N/A"),$scope.invitedMemberView(_this,email)},$scope.invitedMemberView=function(eve,email){return eve.hasClass("selected")||(eve.closest(".listSection").find("div").removeClass("selected"),eve.addClass("selected")),email="undefined"==typeof eve.data("email")?email:eve.attr("data-email"),""!==$scope.id&&$scope.id===email?!1:($scope.id=email,$scope.viewDrop=!0,$scope.feedbackTeam=$scope.inviteMemberView=$scope.viewMember=!1,$scope.oldView="",void ajaxService.getAjaxResponse({url:"/sp/getFeedbackDetails",data:$.param({feadbackUserId:email,groupMemberEmail:$rootScope.noSelf})}).then(function(response){if("true"===response.Success)$scope.getInviteMemberDetail=response,$scope.feedbackEnable=!1,$scope.sendreminderEnable=!1,$scope.swotMemId=email,$scope.swotanalysis=response.swotanalysis,"undefined"!=typeof response.swotanalysis?$scope.feedbackEnable=!0:$scope.sendreminderEnable=!0,$scope.inviteMemberView=!0;else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:$scope.errorMessage})}}))},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.getAllMembersToInvite.feedbackUsers=sharedProperties.searchModule($scope.textSearching,$scope.masterGetAllMembersToInvite.feedbackUsers,2)},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",$scope.searchText="",$scope.getAllMembersToInvite.feedbackUsers=angular.copy($scope.masterGetAllMembersToInvite.feedbackUsers))},$scope.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},$scope.order=function(predicate,reverse){$scope.getAllMembersToInvite.feedbackUsers=$filter("orderBy")($scope.getAllMembersToInvite.feedbackUsers,predicate,reverse)},$scope.callSelect=function(profile,event){return $scope.inviteError=!1,$(event.currentTarget).hasClass("notActive")?!1:($scope.addProfile=profile,void ngDialog.open({template:"/sp/feedback/submitRequest",scope:$scope}))},$scope.invitationSendedNon=function(form){$scope.inviteNonMemberErr=!1,form.$valid?$scope.invitationDirtyCheckClearNon():$scope.inviteNonMemberErr=!0},$scope.invitationDirtyCheckClearNon=function(){var form=$(".inviteNonMember").find("form").serialize()+"&groupMemberEmail="+$rootScope.noSelf;return $scope.nootherequest?!1:($scope.nootherequest=!0,void ajaxService.getAjaxResponse({url:"/sp/submitFeedbackRequest",data:form}).then(function(response){if("true"===response.Success)$scope.nootherequest=!1,$scope.feedbackGrowth.push(response.inviteCreated),$scope.listCreaator=angular.copy($scope.feedbackGrowth),$scope.currentActive=$scope.feedbackGrowth.length,$scope.nonMemFirstName=$scope.nonMemLastName=$scope.nonMemMemberEmail=$scope.selectedDateAsNumber="",$scope.hdu="Friend",$scope.currentActive>=$scope.current?$scope.formatList("first"):$scope.formatList("active"),$(".externalText").val($rootScope.pullInterNationalization("feedback.feedbackListing.growth.comment")),window.scrollTo($(".listSection").offset().top,0),$scope.getAllMembersToInvitefn(),$(".inviteNonMember").find(".squareBox").removeClass("active"),$scope.goals.selected=[],ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Member </strong> ",message:"invited successfully"}),sharedProperties.fireAnalyticsEvent("Prism Lens | Send Feedback Request to non member","N/A");else if(null!=response.error){$scope.nootherequest=!1;for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:$scope.errorMessage})}}))},$scope.clearStuff=function(){$scope.nonMemFirstName=$scope.nonMemLastName=$scope.nonMemMemberEmail=$scope.selectedDateAsNumber="",$scope.hdu="Friend",$scope.inviteNonMemberErr=!1,$scope.dateNonError=!1,$scope.goals.selected=[]},$scope.disableCheck=function(value){var curr=this.$index,_this=$(".growthAreas").find(".style:eq("+curr+")");_this.find("input").attr("disabled",!0)},$scope.active=function(event){sharedProperties.toggleFilterClick(event,$scope.currentPredicate)},$scope.sendReminder=function(member){$scope.reminderDetails=member,ngDialog.open({template:"/sp/reminder/feedsendReminder",scope:$scope})},$scope.sendReminderMailed=function(fulldetail){var form=$("form.sendReminder").serialize()+"&memberList="+fulldetail.email+"&feedbackUserId="+fulldetail.id+"&memberFirstName="+fulldetail.firstName+"&memberLastName="+fulldetail.lastName+"&type=FeedbackReminder";ajaxService.getAjaxResponse({url:"/sp/notifications/sendNotificationWithParams",data:form}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:" Reminder sent successfully "});else if(null!=response.error){ngDialog.close("ngdialog1");for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:$scope.errorMessage})}})},$scope.goalRemove=function(id,index){ajaxService.getAjaxResponse({url:"/sp/goals/removeUserGoals",data:$.param({goalId:id})}).then(function(response){if("true"===response.Success)$scope.getInviteMemberDetail.feedbackGoals.GrowthAreas[index].goal.alreadyInvited=!1,$.growl({icon:"glyphicon glyphicon-ok",message:" Goal removed successfully "});else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:$scope.errorMessage})}})},$scope.goalAdd=function(id,index){ajaxService.getAjaxResponse({url:"/sp/goals/addToUserGoals",data:$.param({goalId:id})}).then(function(response){if("true"===response.Success)$scope.getInviteMemberDetail.feedbackGoals.GrowthAreas[index].selected=!0,$.growl({icon:"glyphicon glyphicon-ok",message:" Goal added successfully "});else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:$scope.errorMessage})}})}}function feedBackarchiveController($scope,ajaxService,$filter,ngDialog,sharedProperties,$rootScope,$localStorage){$scope.archiveMembers=[],$scope.masterarchiveMembers=[],$scope.pageSize=10,$scope.initPageSize=10,$scope.viewArchive=!1,$scope.currentPredicate="name",$scope.lastReverse=!1,$scope.textSearching="",$scope.responseRecieved=!1,$scope.getAllArchiveRequests=function(){ajaxService.getAjaxResponse({url:"/sp/getAllArchiveFeedbacks",method:"get"}).then(function(response){if("true"===response.Success)$scope.masterarchiveMembers=response.feedbackRequest,$scope.archiveFilter=response.feedbackRequestFilter,$scope.loadMore($scope.pageSize),$scope.viewArchive=!0,$scope.responseRecieved=!0;else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:$scope.errorMessage})}})},$scope.loadMore=function(pageSize){$scope.order($scope.currentPredicate,$scope.lastReverse),$scope.pageSize=pageSize,pageSize>=$scope.masterarchiveMembers.length&&($scope.disabledInfinite=!0,$scope.pageSize=$scope.masterarchiveMembers.length),""!==$scope.textSearching?$scope.searchTextFilter($scope.textSearching):$scope.archiveMembers=angular.copy($scope.masterarchiveMembers)},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",this.searchText="",$scope.pageSize=$scope.pageStateSearch,$scope.archiveMembers=angular.copy($scope.masterarchiveMembers))},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.pageStateSearch=$scope.pageSize,$scope.archiveMembers=sharedProperties.searchModule($scope.textSearching,$scope.masterarchiveMembers,2,"feedbackUser")},$scope.order=function(predicate,reverse){$scope.currentPredicate=predicate,$scope.lastReverse=reverse,$scope.archiveMembers=$filter("orderBy")($scope.archiveMembers,predicate,reverse)},$scope.active=function(event){sharedProperties.toggleFilterClick(event,$scope.currentPredicate)},$scope.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},$scope.viewDetail=function(id,self){$localStorage.set("feedbackarchiveId",id),""===$rootScope.noSelf?(sharedProperties.fireAnalyticsEvent("Prism Lens | View Archived Feedback","N/A"),window.location.href="/sp/feedback/archiveDetail"):$rootScope.callSwitchChange("feedArchiveDetail")}}function feedbackArchiveDetailController($scope,ajaxService,sharedProperties,$rootScope,$timeout,$localStorage){$scope.memberList=[],$scope.scopeName=window.location.pathname.substring(window.location.pathname.lastIndexOf("/")+1),$scope.myGoals={},$scope.myGoals.addToGoalsFlag=[],$scope.cancelBtnHide=!0,$scope.requestDetailsLoaded=!1,$scope.getArchivedMemberDetail=function(){var ur="",obj="",archiveId="",method="post";if("/sp/feedback/themeView"===window.location.pathname||"/sp/goals/themeView"===window.location.pathname||"feedThemeView"===$rootScope.switchType||"goalThemeView"===$rootScope.switchType){$scope.viewArchive=!1;var optional="false";ur="/sp/goals/getAllGoals",method="get",("/sp/feedback/themeView"===window.location.pathname||"feedThemeView"===$rootScope.switchType)&&(optional="true",ur="/sp/getThemeView?goalTool="+optional+"&groupMemberEmail="+$rootScope.noSelf)}else{if($scope.viewArchive=!0,ur="/sp/feedbackArchive/getRequestDetails",archiveId=$localStorage.get("feedbackarchiveId"),null===archiveId)return window.location.href="/sp/feedback/archive",!0;obj=$.param({feedbackUserArchiveId:archiveId,groupMemberEmail:$rootScope.noSelf})}ajaxService.getAjaxResponse({url:ur,data:obj,method:method}).then(function(response){if("true"===response.Success)$scope.memberList=response,$scope.swotanalysis=$scope.memberList.swotanalysis,$timeout(function(){jQuery("body").find(".equalsSize").find(".squareBox.active").length>0?($scope.cancelBtnHide=!1,$scope.btnText=$rootScope.pullInterNationalization("goals.themeView.update")):($scope.cancelBtnHide=!0,$scope.btnText=$rootScope.pullInterNationalization("goals.themeView.create")),$scope.requestDetailsLoaded=!0},200);else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:$scope.errorMessage})}})},$scope.validateAndAddToMyGoals=function(){$scope.goalsCountError=!1;var checkBoxes=jQuery("body").find(".equalsSize").find(".squareBox.active"),goalsList=[];checkBoxes.length>=3?($scope.goalsCountError=!1,$.each(checkBoxes,function(i){goalsList.push(jQuery(checkBoxes[i]).attr("data-id"))}),ajaxService.getAjaxResponse({url:"/sp/goals/updateUserGoalsSelection",data:$.param({goalId:goalsList.toString()})}).then(function(response){if("true"===response.Success)$localStorage.set("goalsNotify","goalsReview"),$timeout(function(){window.location.href="/sp/goals"},200);else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:$scope.errorMessage})}})):$scope.goalsCountError=!0},$scope.goBack=function(){""===$rootScope.noSelf?window.location.href="/sp/feedback/archive":$rootScope.callSwitchChange("feedArchive")},$scope.goBackGoal=function(){""===$rootScope.noSelf?window.location.href="/sp/goals":$rootScope.callSwitchChange("spGoals")},$scope.goalRemove=function(id,index,area){ajaxService.getAjaxResponse({url:"/sp/goals/removeUserGoals",data:$.param({goalId:id})}).then(function(response){if("true"===response.Success)"undefined"==typeof area?$scope.getInviteMemberDetail.feedbackGoals.GrowthAreas[index].goal.alreadyInvited=!1:$scope.memberList.userGoal.splice(index,1),$.growl({icon:"glyphicon glyphicon-ok",message:" Goal removed successfully "});else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:$scope.errorMessage})}})},$scope.goalAdd=function(id,index,area){ajaxService.getAjaxResponse({url:"/sp/goals/addToUserGoals",data:$.param({goalId:id})}).then(function(response){if("true"===response.Success)"undefined"==typeof area?$scope.getInviteMemberDetail.feedbackGoals.GrowthAreas[index].selected=!0:$scope.memberList.userGoal[index].selected=!0,$.growl({icon:"glyphicon glyphicon-ok",message:" Goal added successfully "});else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:$scope.errorMessage})}})},$scope.redirectTo=function(change){"default"!==change&&(""===$rootScope.noSelf?window.location.href=change:$rootScope.callSwitchChange(change))},$scope.allUnhide=function(_this){var toggle=$(_this.currentTarget).siblings("div.hideUnhide");toggle.is(":visible")?toggle.hide(500):($(".hideUnhide").each(function(index,value){$(this).hide(500)}),toggle.show(500))},$scope.closeIt=function(_this){$(_this.currentTarget).closest("div.hideUnhide").hide(500)}}function labelAdjust($timeout){return{restrict:"A",scope:{sid:"@swotMid"},link:function($scope,$element,$attrs){var tdHeight,tdClass=(jQuery($element[0]),jQuery($element[0]).parent().hasClass("swot-left-label")),isArchive=jQuery($element[0]).parent().hasClass("in-archives"),winWidth=jQuery(window).width(),updatePos=function(h){tdHeight=h,tdClass?jQuery($element[0]).css({top:isArchive&&winWidth>769?parseInt(tdHeight/2+35):parseInt(tdHeight/2-5)}):jQuery($element[0]).css({top:winWidth>769?parseInt(tdHeight/2-100):parseInt(tdHeight/2-5)})};jQuery($element[0]).hasClass("arc")&&$timeout(function(){updatePos(parseInt(jQuery(".swot-data").height()))},600),$scope.$watch("sid",function(newValue,oldValue){$timeout(function(){updatePos(parseInt(jQuery(".swot-data").height()))},300)})}}}angular.module("spApp").controller("feedbackController",feedbackController),angular.module("spApp").controller("feedBackarchiveController",feedBackarchiveController),angular.module("spApp").controller("feedbackArchiveDetailController",feedbackArchiveDetailController),feedbackController.$inject=["$scope","ajaxService","$filter","ngDialog","sharedProperties","$rootScope","$timeout"],feedBackarchiveController.$inject=["$scope","ajaxService","$filter","ngDialog","sharedProperties","$rootScope","$localStorage"],feedbackArchiveDetailController.$inject=["$scope","ajaxService","sharedProperties","$rootScope","$timeout","$localStorage"],angular.module("spApp").directive("labelAdjust",labelAdjust),labelAdjust.$inject=["$timeout"];
function goalsPersonalityMapping($scope,ajaxService,$timeout,$rootScope,$localStorage,$filter){function getPersonalityMap(){ajaxService.getAjaxResponse({url:useServices.pmGetAll}).then(function(response){if("true"===response.Success)self.storedPersonalityMap=$filter("orderBy")(response.pratcieAreas,"mappedPersonality",!1),self.mappingUpdated?self.showPersonalityMapping(self.selectedId,self.selectedProfileIndex):self.showPersonalityMapping(self.storedPersonalityMap[0].id,0),self.pMapLoaded=!0;else if(null!==response.error){var errorMessage="";self.pMapLoaded=!1;for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getPracticeAreas(){ajaxService.getAjaxResponse({url:useServices.paGetAll}).then(function(response){if("true"===response.Success)self.storedPracticeAreas=response.pratcieAreas;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function showPersonalityMapping(id,index){self.showMapping=!1,self.editMapping=!1,self.isSortable=!1,self.updatedPracticeAreas=[],self.activePersonality={},self.updatedGoalIdList=[],angular.forEach(self.storedPersonalityMap,function(i,j){return i.id===id?(self.selectedProfileIndex=index,self.selectedId=id,self.activePersonality=angular.copy(self.storedPersonalityMap[j]),self.activePersonalityCopy=angular.copy(self.storedPersonalityMap[j]),self.showMapping=!0,self.strengthInputField=angular.copy(self.activePersonality.swotProfileMap.Strengths),self.weaknessInputField=angular.copy(self.activePersonality.swotProfileMap.Weakness),self.oppurtunityInputField=angular.copy(self.activePersonality.swotProfileMap.Opportunities),self.threatInputField=angular.copy(self.activePersonality.swotProfileMap.Threats),!1):void 0})}function generatePaList(){self.isPaListUpdated=!1,self.updatedPracticeAreas=[];var count1=0,count2=0,activeGoalIds=[];jQuery.each(self.activePersonalityCopy.goals,function(i){activeGoalIds.push(self.activePersonalityCopy.goals[i].id),count1++}),count1===self.activePersonalityCopy.goals.length&&jQuery.each(self.storedPracticeAreas,function(i){var id=self.storedPracticeAreas[i].id,isExisting=jQuery.inArray(id,activeGoalIds);-1===isExisting&&self.updatedPracticeAreas.push(self.storedPracticeAreas[i]),count2++}),count2===self.storedPracticeAreas.length&&(self.activePersonality=angular.copy(self.activePersonalityCopy),self.isPaListUpdated=!0,self.selectedPa="")}function removePracticeArea(id){jQuery.each(self.activePersonalityCopy.goals,function(i,j){return self.activePersonalityCopy.goals[i].id===id?(self.activePersonalityCopy.goals.splice(i,1),self.generatePaList(),self.selectedPa="",!1):void 0})}function addPracticeArea(id){var goalInfo="";jQuery.each(self.storedPracticeAreas,function(i){return id===self.storedPracticeAreas[i].id?(goalInfo=angular.copy(self.storedPracticeAreas[i]),!1):void 0}),"undefined"!=typeof goalInfo&&null!==goalInfo&&(self.activePersonalityCopy.goals.push({id:goalInfo.id,name:goalInfo.name}),self.generatePaList(),self.selectedPa="")}function updatePersonalityMap(){var counter=0;self.updatedGoalIdList=[],$("#pa-sort-list").find("li").each(function(value,index){self.updatedGoalIdList.push($(this).attr("data-id")),counter++}),counter===$("#pa-sort-list").find("li").length&&ajaxService.getAjaxResponse({url:useServices.pmUpdate,data:$.param({personalityType:self.activePersonality.personalityType,goalIds:self.updatedGoalIdList.join()})}).then(function(response){if("true"===response.Success)$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("personality.mapping.updated")}),self.updatedGoalIdList=[],self.mappingUpdated=!0,self.getPersonalityMap();else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function initSortable(){var _el=document.getElementById("pa-sort-list");self.isSortable===!1&&("undefined"==typeof self.sortable?self.sortable=new Sortable(_el,{group:"name",animation:150,onEnd:function(e){self.activePersonalityCopy.goals.move(e.oldIndex,e.newIndex)}}):(self.sortable.destroy(),$timeout(function(){self.sortable=new Sortable(_el,{group:"name",animation:150,onEnd:function(e){self.activePersonalityCopy.goals.move(e.oldIndex,e.newIndex)}})},100)),self.isSortable=!0)}function displayPracticeAreas(){self.mappingType="PA",self.editMapping=!1}function displaySwot(){self.mappingType="SWOT",self.editMapping=!1}function editAction(){"PA"===self.mappingType&&self.generatePaList()}function updateAction(){"PA"===self.mappingType?self.updatePersonalityMap():self.updateSwotMapping()}function cancelUpdate(){self.editMapping=!1,self.showPersonalityMapping(self.selectedId,self.selectedProfileIndex)}function addInputField(param,type){switch(type){case"S":self.strengthInputField.push(self.strengthInputField.length);break;case"W":self.weaknessInputField.push(self.weaknessInputField.length);break;case"O":self.oppurtunityInputField.push(self.oppurtunityInputField.length);break;case"T":self.threatInputField.push(self.threatInputField.length)}}function removeInputField(index,type){switch(type){case"S":self.strengthInputField.splice(index,1),self.activePersonality.swotProfileMap.Strengths.splice(index,1);break;case"W":self.weaknessInputField.splice(index,1),self.activePersonality.swotProfileMap.Weakness.splice(index,1);break;case"O":self.oppurtunityInputField.splice(index,1),self.activePersonality.swotProfileMap.Opportunities.splice(index,1);break;case"T":self.threatInputField.splice(index,1),self.activePersonality.swotProfileMap.Threats.splice(index,1)}}function updateSwotMapping(){if("VALID"!==isValidData())self.editMapping=!0,$.growl({icon:"glyphicon glyphicon-ban-circle",message:"<strong> "+$rootScope.pullInterNationalization("personality.mapping.error")+" "+isValidData()+"</strong>"});else{var swotForm={personalityType:self.activePersonality.personalityType,swotProfileMap:self.activePersonality.swotProfileMap};ajaxService.getAjaxResponse({url:useServices.updateSwot,data:swotForm,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("personality.mapping.updated")}),self.mappingUpdated=!0,self.getPersonalityMap();else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}}var self=this,useServices={pmGetAll:"/sp/sysAdmin/personalityMapping/getAll",paGetAll:"/sp/sysAdmin/practiceArea/getAll",pmUpdate:"/sp/sysAdmin/personalityMapping/update",updateSwot:"/sp/sysAdmin/personalityMapping/swot/update"};self.pMapLoaded=!1,self.showMapping=!1,self.editMapping=!1,self.isPaListUpdated=!1,self.selectedPa="",self.selectedProfileIndex=-1,self.selectedId=-1,self.showGoalsList=!1,self.isSortable=!1,self.mappingType="PA",self.mappingUpdated=!1,self.strengthInputField=[0],self.weaknessInputField=[0],self.oppurtunityInputField=[0],self.threatInputField=[0],self.storedPersonalityMap={},self.storedPracticeAreas={},self.activePersonality={},self.activePersonalityCopy=[],self.updatedPracticeAreas=[],self.updatedGoalIdList=[],self.mappingSwotList=[],self.getPersonalityMap=getPersonalityMap,self.getPracticeAreas=getPracticeAreas,self.updatePersonalityMap=updatePersonalityMap,self.showPersonalityMapping=showPersonalityMapping,self.removePracticeArea=removePracticeArea,self.addPracticeArea=addPracticeArea,self.generatePaList=generatePaList,self.initSortable=initSortable,self.displayPracticeAreas=displayPracticeAreas,self.displaySwot=displaySwot,self.editAction=editAction,self.updateAction=updateAction,self.cancelUpdate=cancelUpdate,self.addInputField=addInputField,self.removeInputField=removeInputField,self.updateSwotMapping=updateSwotMapping;var isValidData=function(){for(var j=0;j<self.strengthInputField.length;j++)if(void 0===self.activePersonality.swotProfileMap.Strengths[j]||void 0!==self.activePersonality.swotProfileMap.Strengths[j]&&""===self.activePersonality.swotProfileMap.Strengths[j].trim())return"Strengths";for(var k=0;k<self.weaknessInputField.length;k++)if(void 0===self.activePersonality.swotProfileMap.Weakness[k]||void 0!==self.activePersonality.swotProfileMap.Weakness[k]&&""===self.activePersonality.swotProfileMap.Weakness[k].trim())return"Weakness";for(var l=0;l<self.oppurtunityInputField.length;l++)if(void 0===self.activePersonality.swotProfileMap.Opportunities[l]||void 0!==self.activePersonality.swotProfileMap.Opportunities[l]&&""===self.activePersonality.swotProfileMap.Opportunities[l].trim())return"Opportunities";for(var i=0;i<self.threatInputField.length;i++)if(void 0===self.activePersonality.swotProfileMap.Threats[i]||void 0!==self.activePersonality.swotProfileMap.Threats[i]&&""===self.activePersonality.swotProfileMap.Threats[i].trim())return"Threats";return"VALID"};!function(){self.getPracticeAreas(),self.getPersonalityMap()}()}angular.module("spApp").controller("goalsPersonalityMapping",goalsPersonalityMapping),goalsPersonalityMapping.$inject=["$scope","ajaxService","$timeout","$rootScope","$localStorage","$filter"];
function groupListController($scope,ajaxService,$filter,$state,ngDialog,$timeout,sharedProperties,$rootScope,$localStorage){function getGroupData(){ajaxService.getAjaxResponse({url:vm.config.getGroupData}).then(function(response){if("true"===response.Success)vm.groupList=response.groupInfoList.length?response.groupInfoList:[],vm.responseRecieved=!0,vm.pageCounter(vm.pageSetting.pageSize);else if(null!=response.error){vm.responseRecieved=!0;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function pageCounter(pageSize,nosorting){"undefined"==typeof nosorting&&vm.order(vm.pageSetting.currentPredicate,vm.pageSetting.lastReverse),vm.pageSetting.pageSize=pageSize,pageSize>=vm.groupList.length&&(vm.pageSetting.disabledInfinite=!0,vm.pageSetting.pageSize=pageSize)}function order(predicate,reverse){vm.pageSetting.currentPredicate=predicate,vm.pageSetting.lastReverse=reverse,vm.groupList=$filter("orderBy")(vm.groupList,vm.pageSetting.currentPredicate,vm.pageSetting.lastReverse)}function resetCounter(){vm.pageSetting=angular.copy(vm.originalPageSetting),vm.order(vm.pageSetting.currentPredicate,vm.pageSetting.lastReverse);var curr=$(".groupsHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")}function profileRoute(groupname){$localStorage.set("groupname",groupname),$state.go("profile")}function getListMember(){vm.pageSetting.oneTime&&(vm.getAllMembers(),vm.pageSetting.oneTime=!1)}function getAllMembers(){ajaxService.getAjaxResponse({url:vm.config.getAllMembers}).then(function(response){if("true"===response.Success){var allMail=response.memberList;angular.forEach(allMail,function(val,index){""===allMail[index].firstName&&""===allMail[index].lastName&&delete allMail[index]}),allMail=$.grep(allMail,function(n){return n}),vm.allEmails=allMail}})}function actionToClear(){$rootScope.$broadcast("handleBroadcast")}function createNewGroup(){getListMember(),$scope.errornewGroup=!1,$scope.errornewEmptyGroup=!1,$scope.savenewGroup=!1,ngDialog.open({template:vm.config.createGroup,scope:$scope})}function confirmDelete(groupname){ajaxService.getAjaxResponse({url:vm.config.deleteGroup,data:$.param({name:groupname})}).then(function(response){if("true"===response.Success)sharedProperties.spliceIndex(vm.groupList,"name",groupname),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.deleteFullMessage")});else if(null!=response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function removeGroupLead(groupname,groupMemberEmail){ajaxService.getAjaxResponse({url:vm.config.removeMember,data:$.param({name:groupname,memberEmail:groupMemberEmail,isGroupLead:!0})}).then(function(response){if("true"===response.Success){for(var i=0;i<vm.groupList.length;i++)if(vm.groupList[i].name===groupname){vm.groupList[i].groupLead=null,vm.groupList[i].numOfMembers=parseInt(vm.groupList[i].numOfMembers)-parseInt(1);break}$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.deleteMessage")})}else if(null!=response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function active(event,setting){vm.pageSetting.currentPredicate=setting.predicate,vm.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.pageSetting.currentPredicate),vm.order(vm.pageSetting.currentPredicate,vm.pageSetting.lastReverse)}function callreload(){window.location.reload()}function saveGroupName(savetosave,oldname,index){vm.errorNotification.updateGroupNameError=!1,vm.errorNotification.updateGroupEmptyError=!1,vm.errorNotification.saved=!1;var idToGo=index;return""===savetosave||"undefined"==typeof savetosave?(vm.errorNotification.updateGroupEmptyError=!0,!1):savetosave===oldname?(vm.groupList[idToGo].editenabled=!1,!1):void ajaxService.getAjaxResponse({url:vm.config.updateName,data:$.param({name:savetosave,oldName:oldname})}).then(function(response){"true"===response.Success?(vm.errorNotification.saved=!0,vm.errorNotification.updateGroupName=!0,vm.groupList[idToGo].name=response.groupInfoList[0].name,vm.groupList[idToGo].editenabled=!1,$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.updateGroupName")})):null!=response.error&&(vm.errorNotification.updateGroupNameError=!0)})}function groupNameResult(){vm.errorNotification.updateGroupNameError=!1,vm.errorNotification.updateGroupEmptyError=!1}var vm=this;vm.groupList=[],vm.responseRecieved=!1,vm.pageSetting={pageSize:10,intialVal:10,lastReverse:!1,saved:!1,oneTime:!0,groupPage:!0,currentPredicate:"name",disabledInfinite:!1},vm.originalPageSetting=angular.copy(vm.pageSetting),vm.errorNotification={updateGroupName:!1,updateGroupNameError:!1,updateGroupEmptyError:!1,errornewGroup:!1,errornewEmptyGroup:!1,savenewGroup:!1},vm.config={getGroupData:"/sp/admin/group/all",getAllMembers:"/sp/admin/member",createGroup:"/sp/admin/group/createGroup",deleteGroup:"/sp/admin/group/delete",removeMember:"/sp/admin/group/removeMember",updateName:"/sp/admin/group/updateName",saveGroup:"/sp/admin/group/create"},vm.allEmails=null,vm.getGroupData=getGroupData,vm.pageCounter=pageCounter,vm.order=order,vm.resetCounter=resetCounter,vm.getListMember=getListMember,vm.confirmDelete=confirmDelete,vm.removeGroupLead=removeGroupLead,vm.active=active,vm.createNewGroup=createNewGroup,vm.profileRoute=profileRoute,vm.saveGroupName=saveGroupName,vm.callreload=callreload,vm.groupNameResult=groupNameResult,vm.getAllMembers=getAllMembers,vm.actionToClear=actionToClear,function(){$localStorage.remove("spProfileTab")}(),$scope.saveNewGroup=function(groupname,groupLeadEmailId){return $scope.errornewGroup=!1,$scope.errornewEmptyGroup=!1,$scope.savenewGroup=!1,""===groupname||"undefined"==typeof groupname?($scope.errornewEmptyGroup=!0,!1):void ajaxService.getAjaxResponse({url:vm.config.saveGroup,data:$.param({name:groupname,groupLead:groupLeadEmailId})}).then(function(response){"true"===response.Success?($scope.savenewGroup=!0,$scope.errornewGroup=!1,$scope.errornewEmptyGroup=!1,vm.groupList.unshift(response.groupInfo),vm.pageCounter(vm.groupList.length,"nosorting"),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.saveMessage")}),ngDialog.close("ngdialog1")):null!=response.error&&($scope.errornewGroup=!0)})},$scope.closeGroup=function(){ngDialog.close("ngdialog1")}}angular.module("spApp").controller("groupListController",groupListController),groupListController.$inject=["$scope","ajaxService","$filter","$state","ngDialog","$timeout","sharedProperties","$rootScope","$localStorage"];
function hiringAddSingleController($scope,$element,$attrs,$http,userDataService,ngDialog,$timeout,ajaxService,$localStorage){$scope.addCandidate={},$scope.candidate={},$scope.dialogStatus={},$scope.serverExceptionContent="",$scope.zeroAvailabilityError=!1,$scope.existingSPMember=!1,$scope.showDate=!1,$scope.candidate.sendInvite=!1,$scope.submitDisabled=!1,$scope.addCandidate.submitted=!1,$scope.existingHiring=!1,$scope.existingHiringArchive=!1,$scope.currentCompanyEmp=!1,$scope.memberPublicProfile=!1,$scope.serverException=!1,$scope.emailCheckFlag=!1,$scope.isEmailValidated=!1;var storedProfile=$localStorage.get("loggegdInProfile"),userRoles=storedProfile.member.roles.sort();$scope.isAccountAdmin=0===jQuery.inArray("AccountAdministrator",userRoles)?!0:!1;var d=new Date;$scope.endDate=d.setDate(d.getDate()),$scope.getCandidateAvailability=function(){ajaxService.getAjaxResponse({url:"/sp/hiring/getAvailableSubscriptions"}).then(function(response){if("true"===response.Success)$scope.availableSubscriptions=response.availableHiringSubscripitons,0===$scope.availableSubscriptions?($scope.zeroAvailabilityError=!0,$scope.submitDisabled=!0):($scope.zeroAvailabilityError=!1,$scope.submitDisabled=!1);else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.existingUserCheck=function(email){if($scope.zeroAvailabilityError===!1){$scope.existingSPMember=!1,$scope.existingHiring=!1,$scope.serverException=!1,$scope.existingHiringArchive=!1,$scope.submitDisabled=!1,$scope.candidate.sendInvite=!1,$scope.currentCompanyEmp=!1;var emailPattern=/^[a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,4}$/i;emailPattern.test(email)?ajaxService.getAjaxResponse({url:"/sp/hiring/checkCandidate",data:$.param({candidateEmail:email}).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){var archivedCandidate=response["hiring-archived"].length,hiringCandidate=response.hiring.length,companyCandidate=response.company.length,memberCandidate=response.memberList.length;"true"===response.Success?($scope.serverException=!1,$scope.submitDisabled=!1,$scope.serverExceptionContent="",0===archivedCandidate&&0===hiringCandidate&&0===companyCandidate&&0===memberCandidate?($scope.candidate.sendInvite=!0,$scope.existingSPMember=!1,$scope.existingHiring=!1,$scope.existingHiringArchive=!1,$scope.currentCompanyEmp=!1):($scope.existingSPMember=!1,$scope.existingHiring=!1,$scope.existingHiringArchive=!1,$scope.currentCompanyEmp=!1,archivedCandidate>0?($scope.existingHiringArchive=!0,$scope.submitDisabled=!0):hiringCandidate>0?($scope.existingHiring=!0,$scope.submitDisabled=!0):companyCandidate>0?($scope.currentCompanyEmp=!0,$scope.submitDisabled=!0):memberCandidate>0&&($scope.existingSPMember=!0,$scope.submitDisabled=!1,"VALID"===response.memberList[0].userStatus&&response.memberList[0].profileSettings.hiringAccessAllowed===!0?$scope.memberPublicProfile=!0:$scope.memberPublicProfile=!1),$scope.candidate.sendInvite=!1)):($scope.existingSPMember=!1,$scope.existingHiring=!1,$scope.existingHiringArchive=!1,$scope.currentCompanyEmp=!1,$scope.serverException=!0,$scope.submitDisabled=!0,void 0!==typeof response.error.InvalidRequestException&&($scope.serverExceptionContent=response.error.InvalidRequestException),jQuery("html, body").animate({scrollTop:0})),$scope.isEmailValidated=!0}):($scope.isEmailValidated=!0,$scope.addCandidate.submitted=!1)}},$scope.addHiringCandidate=function(fData){if($scope.isEmailValidated===!1&&($scope.existingUserCheck(fData.email),$timeout(function(){$scope.addHiringCandidate(fData)},300)),$scope.addCandidate.submitted=!1,$scope.serverException=!1,$scope.zeroAvailabilityError===!1&&$scope.submitDisabled===!1&&$scope.isEmailValidated===!0)if($scope.addCandidate.$valid){var _params={firstName:fData.firstName,lastName:fData.lastName,email:fData.email,phoneNumber:fData.phoneNumber,webURL:fData.webURL,day:"undefined"!=typeof fData.dueDate?fData.dueDate.getDate():0,month:"undefined"!=typeof fData.dueDate?fData.dueDate.getMonth()+1:0,year:"undefined"!=typeof fData.dueDate?fData.dueDate.getFullYear():0,roles:fData.roles,tags:fData.tags,sendInvite:$scope.candidate.sendInvite};_params.month<10&&(_params.month="0"+_params.month),_params.day<10&&(_params.day="0"+_params.day),ajaxService.getAjaxResponse({url:"/sp/hiring/addCandidate",data:$.param(_params).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){"true"===response.Success?($localStorage.set("gNotify","AddSingle"),setTimeout(function(){window.location="/sp/tools/hiring/"},100)):($scope.serverException=!0,$scope.submitDisabled=!0,void 0!==typeof response.error.InvalidRequestException&&($scope.serverExceptionContent=response.error.InvalidRequestException),jQuery("html, body").animate({scrollTop:0}))})}else $scope.addCandidate.submitted=!0,jQuery("html, body").animate({scrollTop:0})},$scope.cancelRedirect=function(){window.location="/sp/tools/hiring/"},$scope.initHiringAddSingle=function(){$scope.getCandidateAvailability(),null!==$localStorage.get("addAccounts")&&"undefined"!=typeof $localStorage.get("addAccounts")&&$timeout(function(){ngDialog.open({template:"/sp/resources/html/admin/account/request-success.html",scope:$scope}),$localStorage.remove("addAccounts")},300)},$scope.initHiringAddSingle(),$scope.currentPageUrl=window.location.href,$scope.addAccountsModal=function(addType){$localStorage.remove("addAccounts"),$scope.addAccountsForm={},$scope.addAccountsForm.submitted=!1,$scope.addAccounts={};var processAddAccounts=function(data,e){"members"===addType?$scope.noZeros=parseInt($scope.addAccounts.memberAccounts+$scope.addAccounts.memberAdminAccounts):$scope.noZeros=parseInt($scope.addAccounts.candidateBundles+$scope.addAccounts.hiringAdminAccounts),$scope.addAccountsForm.submitted=!1,this.addAccountsForm.$valid&&0!==$scope.noZeros?($localStorage.set("addAccounts",!0),$scope.addAccountsForm.submitted=!1):($scope.addAccountsForm.submitted=!0,e.preventDefault())};$scope.processAddAccounts=processAddAccounts,$scope.addType=addType,ngDialog.open({template:"/sp/resources/html/admin/account/addAccountsModal.html",scope:$scope})}}angular.module("spApp").controller("hiringAddSingleController",hiringAddSingleController),hiringAddSingleController.$inject=["$scope","$element","$attrs","$http","userDataService","ngDialog","$timeout","ajaxService","$localStorage"];
function importCandidatesController($scope,FileUploader,$element,$attrs,$http,userDataService,ngDialog,$timeout,ajaxService,$localStorage){$scope.zeroAvailabilityError=!1,$scope.submitDisabled=!1,$scope.fileNameList=[],$scope.serverException=!1,$scope.serverExceptionMessage="",$scope.noFilesError=!1,$scope.fileFormatError=!1;var storedProfile=$localStorage.get("loggegdInProfile"),userRoles=storedProfile.member.roles.sort();$scope.isAccountAdmin=0===jQuery.inArray("AccountAdministrator",userRoles)?!0:!1,$scope.openFileUploadModal=function(){var fileInput=jQuery("body").find("#selectFile");$scope.zeroAvailabilityError===!1&&(fileInput.click(),$scope.fileFormatError===!0&&($scope.fileFormatError=!1),$scope.noFilesError===!0&&($scope.noFilesError=!1))},$scope.clearFileInput=function(){if($scope.fileFormatError===!0&&($scope.fileFormatError=!1),$scope.noFilesError===!0&&($scope.noFilesError=!1),jQuery("html").hasClass("ie")){var fileInput=jQuery("body").find('form[name="importCandidates"]');fileInput[0].reset(),$scope.fileFormatError===!0&&($scope.fileFormatError=!1),$scope.noFilesError===!0&&($scope.noFilesError=!1)}};var uploader=$scope.uploader=new FileUploader({url:"/sp/hiring/multiInviteAddFile",alias:"hiringCandidateFile",onAfterAddingFile:function(){$scope.fileFormatError===!0&&($scope.fileFormatError=!1),$scope.noFilesError===!0&&($scope.noFilesError=!1)}});$scope.uploader.filters.push({name:"csvFilter",fn:function(item,options){var type="|"+item.name.slice(item.name.lastIndexOf(".")+1)+"|",x=-1!=="|csv|".indexOf(type);return x?$scope.fileFormatError===!0&&($scope.fileFormatError=!1):($scope.noFilesError===!0&&($scope.noFilesError=!1),$scope.clearFileInput(),$scope.fileFormatError=!0),x}}),$scope.clearCache=function(){ajaxService.getAjaxResponse({url:"/sp/hiring/multi/reset"})},$scope.getCandidateAvailability=function(){ajaxService.getAjaxResponse({url:"/sp/hiring/getAvailableSubscriptions"}).then(function(response){if("true"===response.Success)$scope.availableSubscriptions=response.availableHiringSubscripitons,0===$scope.availableSubscriptions?($scope.zeroAvailabilityError=!0,$scope.submitDisabled=!0):($scope.zeroAvailabilityError=!1,$scope.submitDisabled=!1);else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.validateImportedContacts=function(){if($scope.fileFormatError===!0&&($scope.fileFormatError=!1),$scope.submitDisabled===!1&&$scope.zeroAvailabilityError===!1)if(uploader.queue.length>0){$scope.importFailed=!1,$scope.noFilesError=!1,$scope.serverError=!1;var failedFailList=[],fileCounter=0,successFileList=[];uploader.uploadAll(),uploader.onCompleteItem=function(fileItem,response,status,headers){if(fileCounter+=1,null===response.error)successFileList.push(fileItem._file.name);else for(var key in response.error)failedFailList.push(response.error[key])},uploader.onCompleteAll=function(){fileCounter===uploader.queue.length&&(0===failedFailList.length?($scope.importFailed=!1,$localStorage.set("files",successFileList.join(",")),$timeout(function(){window.location="/sp/tools/hiring/validateList"},200)):(uploader.clearQueue(),$scope.clearCache(),$scope.importFailed=!0,$scope.importFailedMsg=failedFailList.join(", ")))}}else $scope.noFilesError=!0},$scope.cancelRedirect=function(){window.location="/sp/tools/hiring/"},$scope.initImportCandidates=function(){$scope.getCandidateAvailability();var growlNotification=$localStorage.get("addAccounts");null!==growlNotification&&"undefined"!=typeof growlNotification&&($.growl({icon:"glyphicon glyphicon-ok",message:growlNotification}),$timeout(function(){$localStorage.remove("addAccounts")},300))},$scope.initImportCandidates(),$scope.currentPageUrl=window.location.href,$scope.addAccountsModal=function(addType){$localStorage.remove("addAccounts"),$scope.addAccountsForm={},$scope.addAccountsForm.submitted=!1,$scope.addAccounts={};var processAddAccounts=function(data,e){$scope.addAccountsForm.submitted=!1,this.addAccountsForm.$valid?($localStorage.set("addAccounts","Request submitted successfully!"),$scope.addAccountsForm.submitted=!1):($scope.addAccountsForm.submitted=!0,e.preventDefault())};$scope.processAddAccounts=processAddAccounts,$scope.addType=addType,ngDialog.open({template:"/sp/resources/html/admin/account/addAccountsModal.html",scope:$scope})}}angular.module("spApp").controller("importCandidatesController",importCandidatesController),importCandidatesController.$inject=["$scope","FileUploader","$element","$attrs","$http","userDataService","ngDialog","$timeout","ajaxService","$localStorage"];
function libraryHomeDetailsController($scope,$q,$element,$attrs,ajaxService,$location,$http,$state,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage){$scope.accountsListException=!1,$scope.updatedAccountListing=[],$scope.selectedAccountsCount=0,$scope.updatedListingIndex=0,$scope.accountList={},$scope.selectedCompanyIdList=[],$scope.allAccountsIdList=[],$scope.getDetailsException=!1,$scope.createNewLibraryHome={},$scope.newLibraryHome={},$scope.libraryHomeEditing={},$scope.libraryHomeEditing.status=!0,$scope.libraryHomeIdStatus=!1,$scope.selectedAccountsDisplayList=[],$scope.showAccountsDisplayList=!1,$scope.cid="",$scope.searchKeywords=[],$scope.searchTag=[],$scope.pageSize=100,$scope.statusInclude=[],$scope.textSearching="",$scope.intialPageSize=100,$scope.load=!0,$scope.selectArticlesList=[];var defaultImage="/sp/resources/images/image_not_available.jpg";$scope.newLibraryHome.articleImage0=defaultImage,$scope.newLibraryHome.articleImage1=defaultImage,$scope.newLibraryHome.articleImage2=defaultImage,$scope.newLibraryHome.articleImage3=defaultImage,$scope.libraryHomeEnableEdit=function(s){"enable"===s?$scope.libraryHomeEditing.status=!0:($scope.libraryHomeEditing.status=!1,$scope.getLibraryHomeDetails()),$scope.accountList.search=null},$scope.goLibraryHome=function(){window.location="/sp/sysAdmin/curriculam/libraryHome"},$scope.getCompanyId=function(){var url=window.location.href,splitUrl=url.split("?")[1];"undefined"!=typeof splitUrl?$scope.cid=splitUrl.split("=")[1]:$scope.cid=null},$scope.getLibraryHomeDetails=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/library/articles",data:$.param({companyId:$scope.cid})}).then(function(response){if("true"===response.Success)$scope.getDetailsException=!1,$scope.company=response.company,null===response.company&&"business"===$scope.cid?$scope.globalName="Global Home - Business":null===response.company&&"individual"===$scope.cid&&($scope.globalName="Global Home - Individual"),$scope.newLibraryHome.articleId0=response.Content[0].articleId,$scope.newLibraryHome.articleDescription0=response.Content[0].shortDescription,$scope.newLibraryHome.articleName0=response.Content[0].articleLinkLabel,null!==response.Content[0].imageUrl&&void 0!==response.Content[0].imageUrl&&($scope.newLibraryHome.articleImage0=response.Content[0].imageUrl+"?width=150"),$scope.newLibraryHome.articleId1=response.Content[1].articleId,$scope.newLibraryHome.articleDescription1=response.Content[1].shortDescription,$scope.newLibraryHome.articleName1=response.Content[1].articleLinkLabel,null!==response.Content[1].imageUrl&&void 0!==response.Content[1].imageUrl&&($scope.newLibraryHome.articleImage1=response.Content[1].imageUrl+"?width=150"),$scope.newLibraryHome.articleId2=response.Content[2].articleId,$scope.newLibraryHome.articleDescription2=response.Content[2].shortDescription,$scope.newLibraryHome.articleName2=response.Content[2].articleLinkLabel,null!==response.Content[2].imageUrl&&void 0!==response.Content[2].imageUrl&&($scope.newLibraryHome.articleImage2=response.Content[2].imageUrl+"?width=150"),$scope.newLibraryHome.articleId3=response.Content[3].articleId,$scope.newLibraryHome.articleDescription3=response.Content[3].shortDescription,$scope.newLibraryHome.articleName3=response.Content[3].articleLinkLabel,null!==response.Content[3].imageUrl&&void 0!==response.Content[3].imageUrl&&($scope.newLibraryHome.articleImage3=response.Content[3].imageUrl+"?width=150");else{$scope.company.name=null,$scope.getDetailsException=!0;for(var key in response.error)$scope.getDetailsExceptionMsg=response.error[key]}})},$scope.selectArticleViaModal=function(articleId,articleName,position,articleImage){null===articleImage||void 0===articleImage?articleImage=defaultImage:articleImage+="?width=150",0===position?($scope.newLibraryHome.articleId0=articleId,$scope.newLibraryHome.articleName0=unescape(articleName),$scope.newLibraryHome.articleImage0=articleImage):1===position?($scope.newLibraryHome.articleId1=articleId,$scope.newLibraryHome.articleName1=unescape(articleName),$scope.newLibraryHome.articleImage1=articleImage):2===position?($scope.newLibraryHome.articleId2=articleId,$scope.newLibraryHome.articleName2=unescape(articleName),$scope.newLibraryHome.articleImage2=articleImage):3===position&&($scope.newLibraryHome.articleId3=articleId,$scope.newLibraryHome.articleName3=unescape(articleName),$scope.newLibraryHome.articleImage3=articleImage),ngDialog.close("ngdialog1")},$scope.updateLibraryHome=function(fData){var _params=[],companyId="";if(companyId=null===$scope.company&&"business"===$scope.cid?"business":null===$scope.company&&"individual"===$scope.cid?"individual":$scope.company.id,$scope.createNewLibraryHome.validationErrors=!1,$scope.createNewLibraryHomeException=!1,_params=[{articleId:$scope.newLibraryHome.articleId0,position:0,shortDescription:fData.articleDescription0,companyId:companyId},{articleId:$scope.newLibraryHome.articleId1,position:1,shortDescription:fData.articleDescription1,companyId:companyId},{articleId:$scope.newLibraryHome.articleId2,position:2,shortDescription:fData.articleDescription2,companyId:companyId},{articleId:$scope.newLibraryHome.articleId3,position:3,shortDescription:fData.articleDescription3,companyId:companyId}],void 0!==$scope.newLibraryHome.articleId0&&void 0!==$scope.newLibraryHome.articleId1&&void 0!==$scope.newLibraryHome.articleId2&&void 0!==$scope.newLibraryHome.articleId3&&void 0!==$scope.newLibraryHome.articleDescription0&&void 0!==$scope.newLibraryHome.articleDescription1&&void 0!==$scope.newLibraryHome.articleDescription2&&void 0!==$scope.newLibraryHome.articleDescription3&&""!==$scope.newLibraryHome.articleDescription0&&""!==$scope.newLibraryHome.articleDescription1&&""!==$scope.newLibraryHome.articleDescription2&&""!==$scope.newLibraryHome.articleDescription3&&null!==companyId&&""!==companyId){for(var i=0;4>i;i++)ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/admin/add/contentArticles",data:$.param(_params[i])}).then(function(response){if("true"===response.Success)$scope.createNewLibraryHome=!1,$localStorage.set("gNotify","AddNewLibraryHome");else{$scope.createNewLibraryHomeException=!0;for(var key in response.error)$scope.createNewLibraryHomeExceptionMsg=response.error[key]}});$.growl({icon:"glyphicon glyphicon-ok",message:" Articles updated Successfully"}),setTimeout(function(){window.location="/sp/sysAdmin/curriculam/libraryHome"},1e3)}else $.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Please fill all the required Fields"}),$scope.createNewLibraryHome.validationErrors=!0},$scope.selectArticle=function(position){$scope.fetchedTopics=[],$scope.selectArticlesList=[],ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/getAllTopics",method:"POST",data:$.param({topic:"Themes"})}).then(function(response){response&&($scope.fetchedTopics=response.topics,$scope.position=position,$scope.getArticlesList=function(themeValue){$scope.selectArticlesList=[],ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/getResults",method:"POST",data:$.param({topicValue:themeValue,topicCategory:"Themes"})}).then(function(response){if("true"===response.Success)response.articles.length>0&&($scope.getAllError=!1,$scope.selectArticlesList=response.articles,$scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize));else{$scope.getAllError=!0;for(var key in response.error)$scope.getAllErrorMsg=response.error[key]}})},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.returnMemberList($scope.pageSize)},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize))},$scope.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},$scope.returnMemberList=function(pageSize){if($scope.searchTag.length&&!$scope.statusInclude.length&&($scope.selectArticlesList=angular.copy($scope.newArr)),$scope.searchTag.length&&$scope.statusInclude.length){$scope.combineArray=[];for(var i=0;i<$scope.newArr.length;i++)for(var j=0;j<$scope.checkBox.length;j++)$scope.newArr[i].email===$scope.checkBox[j].email&&$scope.combineArray.push($scope.newArr[i]);$scope.selectArticlesList=angular.copy($scope.combineArray)}!$scope.searchTag.length&&$scope.statusInclude.length&&($scope.selectArticlesList=angular.copy($scope.checkBox)),$scope.searchTag.length||$scope.statusInclude.length||($scope.selectArticlesList=angular.copy($scope.selectArticlesList)),$scope.pageSize=pageSize,pageSize>=$scope.selectArticlesList.length&&($scope.pageSize=$scope.selectArticlesList.length),$scope.load&&($scope.lastPredicate="name",$scope.lastReverse=!1,$scope.loadBtnCLicked=!1,$scope.load=!1),$scope.loadBtnCLicked&&($scope.loadBtnCLicked=!1),$scope.order($scope.lastPredicate,$scope.lastReverse),$scope.selectArticlesList=$scope.selectArticlesList},$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.order=function(predicate,reverse){$scope.lastPredicate=predicate,$scope.lastReverse=reverse,$scope.selectArticlesList=$filter("orderBy")($scope.selectArticlesList,predicate,reverse)},ngDialog.open({template:"/sp/resources/html/sysAdmin/curriculam/selectArticleModal.html",scope:$scope}))})},function(){$scope.getCompanyId(),$scope.getLibraryHomeDetails()}()}angular.module("spApp").controller("libraryHomeDetailsController",libraryHomeDetailsController),libraryHomeDetailsController.$inject=["$scope","$q","$element","$attrs","ajaxService","$location","$http","$state","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage"];
function loginFormController($scope,ajaxService,$state,sharedProperties,$localStorage){$scope.pwd={min:8,max:32,toggle:!1,err:!1,inputType:"password"},$scope.resetPassword={},$scope.formData={},$scope.resetPasswordMessage=!1,$scope.resetPasswordErrorMessage=!1,$scope.changePasswordErrorMessage=!1,$scope.resetPasswordMessageErr=!1,$scope.validateCredentials=function(fData){$scope.formData=fData,$scope.spLogin.submitted=!1,$scope.spLogin.$valid?document.getElementsByTagName("form")[0].submit():$scope.spLogin.submitted=!0},$scope.returnHome=function(){window.location.replace("/sp")},$scope.showPassword=function($event){$event.preventDefault(),$scope.pwd.toggle===!1?($scope.pwd.toggle=!0,$scope.pwd.inputType="text"):($scope.pwd.toggle=!1,$scope.pwd.inputType="password")},$scope.resetCredentials=function(){if($scope.resetPasswordMessage=!1,$scope.resetPasswordErrorMessage=!1,$scope.resetPasswordMessageErr=!1,$scope.resetPassword.$valid){var options={url:"/sp/sendResetEmail",data:$.param({email:$scope.user.email})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?(sharedProperties.setResetEmail(response.email),$state.go("resetConfirmation")):null!=response.error&&($scope.resetPasswordErrorMessage=!0)})}else $scope.resetPasswordMessageErr=!0},$scope.changeCredentials=function(){if($scope.changePasswordErrorMessage=!1,$scope.pwdSubmit=!1,$scope.resetPassword.$valid){var options={url:"/sp/newPassword",data:$.param({password:$scope.user.password})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?window.location.href="/sp/signin":null!=response.error&&($scope.changePasswordErrorMessage=!0)})}else $scope.pwdSubmit=!0},$scope.getPropertyValues=function(){$scope.disResetEmail=sharedProperties.getResetEmail()},$scope.cookieCheck=function(){var cookieEnabled=navigator.cookieEnabled?!0:!1;return"undefined"!=typeof navigator.cookieEnabled||cookieEnabled||(document.cookie="testcookie",cookieEnabled=-1!==document.cookie.indexOf("testcookie")?!0:!1),cookieEnabled?$scope.isLocalStorageNameSupported():$scope.showCookieFail()},$scope.isLocalStorageNameSupported=function(){$scope.clearStorage()},$scope.showCookieFail=function(){window.location.href="/sp/enable/cookie"},$scope.showLocalStorageFail=function(){window.location.href="/?status=privateBrowsing"},$scope.clearStorage=function(){$localStorage.flush()},function(){$scope.cookieCheck()}()}function thankyouController($scope,ajaxService){$scope.redirect=function(){window.location.href="/sp"}}angular.module("spApp").controller("loginFormController",loginFormController),loginFormController.$inject=["$scope","ajaxService","$state","sharedProperties","$localStorage"],angular.module("spApp").controller("thankyouController",thankyouController),thankyouController.$inject=["$scope","ajaxService"];
function memberAccountsController($scope,$element,$attrs,$http,ngDialog,$timeout,ajaxService,sharedProperties,$localStorage){function addCreditPop(page){$scope.acPageType=page,$scope.creditInfo={},$scope.creditInfo.cpt=$scope.account.account.paymentInstrument.paymentType,$scope.creditInfo.ccomment=$scope.account.account.paymentInstrument.comment,$scope.serverError=!1,$scope.serverErrorMsg=null,ngDialog.open({template:"/sp/resources/html/admin/account/addcreditspop.html",scope:$scope})}function toggleOverrideField(type){"Member"===type?(_this.memberOverrideCheckbox===!1?(_this.memberOverrideCheckbox=!0,_this.signup.memberPrice=_this.editSignup.memberPrice):(_this.memberOverrideCheckbox=!1,_this.signup.overrideMemberAmount=""),_this.updateMemberAccountSummary("Member")):(_this.adminOverrideCheckbox===!1?(_this.adminOverrideCheckbox=!0,_this.signup.adminPrice=_this.editSignup.adminPrice):(_this.adminOverrideCheckbox=!1,_this.signup.overrideAdminAmount=""),_this.updateMemberAccountSummary("Admin"))}function updateMemberAccountSummary(type){"Member"===type?_this.memberOverrideCheckbox?(_this.signup.memberTotalAmount=_this.signup.overrideMemberAmount,_this.updateTotalPerMonth()):(_this.signup.memberTotalAmount=parseInt(_this.signup.memberCount)*parseFloat(_this.signup.memberPrice),_this.updateTotalPerMonth()):_this.adminOverrideCheckbox?(_this.signup.adminTotalAmount=_this.signup.overrideAdminAmount,_this.updateTotalPerMonth()):(_this.signup.adminTotalAmount=parseInt(_this.signup.adminCount)*parseFloat(_this.signup.adminPrice),_this.updateTotalPerMonth())}function updateTotalPerMonth(){_this.totalChargesPerMonth=0,_this.totalChargesPerMonth+=null!==_this.signup.adminTotalAmount&&void 0!==_this.signup.adminTotalAmount&&_this.signup.adminTotalAmount>0?_this.signup.adminTotalAmount:0,_this.totalChargesPerMonth+=null!==_this.signup.memberTotalAmount&&void 0!==_this.signup.memberTotalAmount&&_this.signup.memberTotalAmount>0?_this.signup.memberTotalAmount:0,_this.proRatedPriceUpdater()}function getAccountInfo(isAddCredit){var option="user"===_this.accType?{url:"/sp/admin/account/businessAccountDetails"}:{url:"/sp/sysAdmin/alternateBilling/account/businessAccountDetails",data:$.param({accountId:sharedProperties.getParam("accountId")})};ajaxService.getAjaxResponse(option).then(function(response){if("true"===response.Success)isAddCredit?_this.account.account.creditBalance=response.account.creditBalance:($scope.account=response,_this.account=response,$scope.creditInfo.cpt=response.account.paymentInstrument.paymentType,$scope.creditInfo.ccomment=response.account.paymentInstrument.comment,_this.memberOverrideCheckbox=!0,_this.adminOverrideCheckbox=!0,_this.signup={},_this.signup={memberPrice:_this.account.account.spPlans.Primary.unitMemberPrice,adminPrice:_this.account.account.spPlans.Primary.unitAdminPrice},_this.cycleMultiplier="Custom"!==_this.account.account.accountInfo.planBillingCycleType?parseInt(billingMonths[_this.account.account.accountInfo.planBillingCycleType.toLowerCase().replace("-","")]):parseInt(_this.account.account.accountInfo.planBillingCycle),_this.editSignup=angular.copy(_this.signup));else{_this.serverError=!0;for(var key in response.error)_this.errorMessage=response.error[key]}})}function cancelRedirect(){window.location="user"===_this.accType?"/sp/admin/account/business":"/sp/sysAdmin/alternateBilling/viewDetailAccount?accountId="+_this.account.account.id}function validateSendResponse(signup){_this.formSubmitted=!1;var _data=$("#accountsBillingStep2 :not(.serialize-ignore)").serialize();if(signup.$valid)_this.formSubmitted=!1,ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addMemberAccounts",data:_data}).then(function(response){"true"===response.Success?(_this.sfailure=!1,$localStorage.set("addMembers","Member(s) added successfully !"),window.location="/sp/sysAdmin/alternateBilling/viewDetailAccount?accountId="+sharedProperties.getParam("accountId")):null!=response.error&&(_this.failure=response.error,_this.sfailure=!0)});else{_this.formSubmitted=!0;var elem=angular.element($element);$(elem).find("form .ng-invalid:first").length&&$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300)}}function initAddMemberAccoutns(mode,type){_this.mode=mode,_this.accType=type,_this.getAccountInfo()}function proRatedPriceUpdater(){_this.proRatedFinalPrice=0;var remainigDays=_this.account.account.remainingChargableDays;_this.proRatedFinalPrice=parseFloat(_this.totalChargesPerMonth/30*remainigDays).toFixed(2),_this.proRatedFinalPrice=Math.round(_this.proRatedFinalPrice)}var _this=this,billingMonths={monthly:1,quaterly:3,semiannually:6,anually:12};_this.signup={},_this.account={},_this.editSignup={},$scope.creditInfo={},_this.signup.adminTotalAmount=0,_this.signup.memberTotalAmount=0,_this.totalChargesPerMonth=0,_this.proRatedFinalPrice=0,_this.memberOverrideCheckbox=!1,_this.adminOverrideCheckbox=!1,_this.serverError=!1,_this.formSubmitted=!1,_this.sfailure=!1,_this.toggleOverrideField=toggleOverrideField,_this.updateMemberAccountSummary=updateMemberAccountSummary,_this.updateTotalPerMonth=updateTotalPerMonth,_this.getAccountInfo=getAccountInfo,_this.cancelRedirect=cancelRedirect,_this.initAddMemberAccoutns=initAddMemberAccoutns,_this.validateSendResponse=validateSendResponse,_this.proRatedPriceUpdater=proRatedPriceUpdater,_this.addCreditPop=addCreditPop,$scope.addCredit=function(form){$scope.submitted=!1,this.spSubscribe.$valid&&"0"!==this.amount?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addCredit",data:$.param({accountId:$scope.account.account.id,chargeAmount:$scope.creditInfo.amount,paymentType:$scope.creditInfo.cpt,comment:$scope.creditInfo.ccomment})}).then(function(response){if("true"===response.Success)_this.getAccountInfo(!0),_this.sfailure===!0&&(_this.signup.submitted=!1,_this.sfailure=!1,_this.failure=null),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Amount</strong>",message:" Credited"});else{for(var key in response.error)$scope.errorMessage=response.error[key];$scope.serverError=!0,$scope.serverErrorMsg=$scope.errorMessage}}):$scope.submitted=!0}}function addCreditControler($scope,$element,$attrs,$http,ngDialog,$timeout,ajaxService,sharedProperties,$localStorage){$scope.finalAmount=0,$scope.account={},$scope.currentMemberCount=0,$scope.zeroError=!1,$scope.submitDisabled=!1,$scope.submitted=!1,$scope.signup={},$scope.fnDone=!1,$scope.getAccountInfo=function(){ajaxService.getAjaxResponse({url:"BUSINESS"===$scope.mode?"/sp/sysAdmin/alternateBilling/account/businessAccountDetails":"/sp/sysAdmin/alternateBilling/account/individualAccountDetails",data:$.param({accountId:sharedProperties.getParam("accountId")})}).then(function(response){if("true"===response.Success)$scope.account=response,$scope.cBalance=response.account.creditBalance,$timeout(function(){$scope.fnDone=!0},100);else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getProductInfo=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/getCurrentProductInfo",data:$.param({accountId:$scope.account.account.id,productType:$scope.mode})}).then(function(response){"true"===response.Success&&($scope.product=response,$scope.promotionDiscount="undefined"!=typeof $scope.product.promotion?$scope.product.promotion.unitPrice*$scope.account.account.productInfo.availalbeMemberSubscriptions:0)})},$scope.cancelRedirect=function(mode){window.location="/sp/sysAdmin/alternateBilling/viewDetailAccount"+mode+"?accountId="+$scope.account.account.id},$scope.initAddMemberAccoutns=function(mode){$scope.mode=mode,$scope.fnDone=!1,$scope.getAccountInfo()},$scope.addCredit=function(form,page){$scope.submitted=!1,this.spSubscribe.$valid&&"0"!==this.amount?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addCredit",data:$.param({accountId:$scope.account.account.id,chargeAmount:$scope.amount,paymentType:$scope.signup.cpt,comment:$scope.signup.ccomment})}).then(function(response){if("true"===response.Success)$scope.fnDone=!1,$scope.getAccountInfo(),$scope.fnDone&&("member"===page?$scope.ctrl.account.account.creditBalance=$scope.cBalance:"step2"===page?$scope.$apply(function(){$scope.$parent.account.account.creditBalance=$scope.cBalance}):"view"===page&&$scope.$apply(function(){$scope.$parent.accountDetails.creditBalance=$scope.cBalance})),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Amount</strong>",message:" Credited"});else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}}):$scope.submitted=!0}}angular.module("spApp").controller("memberAccountsController",memberAccountsController),angular.module("spApp").controller("addCreditControler",addCreditControler),memberAccountsController.$inject=["$scope","$element","$attrs","$http","ngDialog","$timeout","ajaxService","sharedProperties","$localStorage"],addCreditControler.$inject=["$scope","$element","$attrs","$http","ngDialog","$timeout","ajaxService","sharedProperties","$localStorage"];
function notesAndFeedbackController($scope,ajaxService,$localStorage,ngDialog,sharedProperties,filterFilter,$filter,$rootScope){function stateControl(list){var result=list.actionData.filter(function(e){return e.permissions.Completion&&!e.completed});return result.length?!0:!1}function checktype(index,category,id){self.noBlue=!1,"Blueprint"===category?(self.getBluePrintDetails(index,id),self.getBluePrintSetting(id)):(self.toggleFeedbackOverlay(index),self.noBlue=!0)}function getBluePrintSetting(id){ajaxService.getAjaxResponse({url:self.serviceApis.bluePrintSetting,data:$.param({feedbackId:id})}).then(function(response){if("true"===response.Success)self.dataMap=response.blueprintSettings.dataMap;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getBluePrintDetails(index,id){return self.blueprintReady=!1,self.cachedBluePrintId===id?(self.blueprintReady=!0,self.toggleFeedbackOverlay(index),!0):void ajaxService.getAjaxResponse({url:self.serviceApis.blueprintDetails,data:$.param({feedbackId:id})}).then(function(response){if("true"===response.Success)self.blueprint=response.blueprint,self.blueprintReady=!0,self.toggleFeedbackOverlay(index),self.cachedBluePrintId=id;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function mouseEventHandler(eventType,index){self.editEnable||("enter"===eventType?(jQuery("#editIcon_"+index).fadeIn(),jQuery("#deleteIcon_"+index).fadeIn()):(jQuery("#editIcon_"+index).hide(),jQuery("#deleteIcon_"+index).hide()))}function editEnableToggle(index){self.updateFormSubmitted=!1,self.validationError=!1,self.editEnable===!1?(self.noteContentForUpdate=self.notesAndFeedbackInfo.notesFeedbackList[index].content,self.editEnable=!0,jQuery("#noteEditSection_"+index).fadeIn(),jQuery("#noteViewSection_"+index).hide()):(self.editEnable=!1,jQuery("#noteEditSection_"+index).hide(),jQuery("#noteViewSection_"+index).fadeIn(),self.notesAndFeedbackInfo.notesFeedbackList[index].content=self.noteContentForUpdate)}function toggleNotification(){self.winWidth>767?self.showNotification===!1?(self.showNotification=!0,sharedProperties.fireAnalyticsEvent("Notes & Feedback | View Feedback Requests","N/A")):self.showNotification=!1:toggleNotificationResponsive()}function toggleNotificationResponsive(){self.winHeight=$(window).height()+100+"px";ngDialog.open({template:"/sp/resources/html/goals/notesAndFeedback/notificationResponsive.html",className:"ngdialog-lnd-theme",scope:$scope})}function toggleFeedbackOverlay(index){self.winWidth>767?(self.showNotification=!1,self.showFeedbackOverlay===!1?(self.showFeedbackOverlay=!0,self.requestNotificationInfo=self.requestNotificationList[index]):(self.requestNotificationInfo.feedbackResponse="",self.showFeedbackOverlay=!1,self.requestFormSubmitted=!1)):(self.requestNotificationInfo=self.requestNotificationList[index],feedbackOverlayResponsive())}function feedbackOverlayResponsive(){self.winHeight=$(window).height()+100+"px";ngDialog.open({template:"/sp/resources/html/goals/notesAndFeedback/feedbackOverlayResponsive.html",className:"ngdialog-lnd-theme",scope:$scope})}function displayDetailedInfo(index){self.editEnable=!1,self.selectedIndex=index,self.notesAndFeedbackInfo=self.notesAndFeedbackList[index];var goalType=getGoalType(self.notesAndFeedbackInfo.goalCategory);"NOTE"===self.notesAndFeedbackInfo.type?sharedProperties.fireAnalyticsEvent("Notes & Feedback | View Notes on","Blueprint"===goalType?goalType:goalType+" - "+self.notesAndFeedbackInfo.name):sharedProperties.fireAnalyticsEvent("Notes & Feedback | View Feedback on","Blueprint"===goalType?goalType:goalType+" - "+self.notesAndFeedbackInfo.name),$("html,body").animate({scrollTop:$(".top-content").offset().top},500),self.winWidth<767&&displayDetailedResponsive()}function displayDetailedResponsive(){self.winHeight=$(window).height()+100+"px";ngDialog.open({template:"/sp/resources/html/goals/notesAndFeedback/notesFeedbackResponsive.html",className:"ngdialog-lnd-theme",scope:$scope})}function sendFeedbackRequest(options){self.requestFormSubmitted=!1,self.sendFeedbackForm.$valid?ajaxService.getAjaxResponse({url:self.serviceApis.sendFeedbackRequest,data:$.param({feedbackId:options.feedbackId,feedbackResponse:options.feedbackResponse})}).then(function(response){if("true"===response.Success){ngDialog.closeAll(),sharedProperties.spilceIndexWithBreak(self.requestNotificationList,"id",options.feedbackId),self.showFeedbackOverlay=!1,$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("notesAndFeedback.ajaxSuccessMessage.sentFeedback")});var goalType=getGoalType(self.requestNotificationInfo.practiceAreaDTO.category);sharedProperties.fireAnalyticsEvent("Notes & Feedback | Reply to a feedback Request","Blueprint"===goalType?goalType:goalType+" - "+self.requestNotificationInfo.practiceAreaDTO.name),0===self.requestNotificationList.length&&(self.requestNotificationList=[])}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}}):self.requestFormSubmitted=!0}function updateNoteModal(options){self.updateNote.call(this,options)}function updateNote(options){self.updateFormSubmitted=!1,self.validationError=!1,void 0!==options.desc&&""!==options.desc.trim()?ajaxService.getAjaxResponse({url:self.serviceApis.updateNote,data:$.param({noteId:options.noteId,desc:options.desc})}).then(function(response){if("true"===response.Success){self.editEnable=!1,$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("notesAndFeedback.ajaxSuccessMessage.notesUpdated")});var goalType=getGoalType(self.notesAndFeedbackInfo.goalCategory);sharedProperties.fireAnalyticsEvent("Notes & Feedback | Update Note","Blueprint"===goalType?goalType:goalType+" - "+self.notesAndFeedbackInfo.name),getAllNotesAndFeedbackForUserForUpdate(options.noteId),"mobile"===options.type&&self.updateNoteDialog.close()}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}}):(self.updateFormSubmitted=!0,self.validationError=!0)}function filterResults(val){"blueprint"===self.types.goalCategory&&(self.sortVal="date",self.predicate=""),""!==self.types.search?self.showClearSearchIcon=!0:self.showClearSearchIcon=!1;var tempList=angular.copy(self.masterList),resp=$filter("notesAndFeedbackFilter")(tempList,self.types,filterFilter,sharedProperties);resp=$filter("orderBy")(resp,self.predicate),self.notesAndFeedbackInfo={},self.notesAndFeedbackList=[],self.notesAndFeedbackList=resp,self.editEnable=!1,self.notesAndFeedbackInfo=resp[0],self.selectedIndex=0,tempList=[],resp=[]}function sortResults(){"name"===self.sortVal?self.predicate="name":self.predicate="";var tempList=angular.copy(self.masterList),resp=$filter("orderBy")(tempList,self.predicate);resp=$filter("notesAndFeedbackFilter")(resp,self.types,filterFilter,sharedProperties),self.notesAndFeedbackList=[],self.notesAndFeedbackList=resp,self.notesAndFeedbackInfo={},self.editEnable=!1,self.notesAndFeedbackInfo=resp[0],self.selectedIndex=0,tempList=[],resp=[]}function clearSearch(){""!==self.types.search&&(self.showClearSearchIcon=!1,self.types.search=""),self.filterResults("search")}function reset(){self.sortVal="date",self.types={note:!1,feedback:!1,pending:!1,declined:!1,search:"",goalCategory:"all"},self.showClearSearchIcon=!1,self.notesAndFeedbackList=[],self.notesAndFeedbackList=angular.copy(self.masterList),self.notesAndFeedbackInfo=self.notesAndFeedbackList[0],sortResults()}function openDeleteModal(deleteId,type){$scope.type=type,$scope.deleteId=deleteId,ngDialog.open({template:"/sp/resources/html/goals/notesAndFeedback/deleteModal.html",scope:$scope})}function openModalForUpdate(obj,index){self.updateFormSubmitted=!1,self.validationError=!1,self.noteContentForUpdate=obj.content,$scope.notesData=obj,$scope.indexedItem=index;var dialog=ngDialog.open({template:"/sp/resources/html/goals/notesAndFeedback/updateModal.html",scope:$scope});self.updateNoteDialog=dialog,dialog.closePromise.then(function(data){self.notesAndFeedbackInfo.notesFeedbackList[index].content=self.noteContentForUpdate})}var self=this;self.serviceApis={updateNote:"/sp/goals/note/update",deleteNote:"/sp/goals/note/delete",deleteFeedbackRequest:"/sp/goals/feedback/delete",getAllFeedbackRequestNotifications:"/sp/goals/feedback/received",sendFeedbackRequest:"/sp/goals/feedback/external/response",declineFeedbackStatus:"/sp/goals/feedback/updateStatus",getAllNotesAndFeedbackForUser:"/sp/goals/notesfeedback/all",deleteAll:"/sp/goals/notesFeedback/deleteAll",blueprintDetails:"/sp/goals/token/feedback/blueprint/details",bluePrintSetting:"/sp/blueprint/getSettings"},self.masterList=[],self.notesAndFeedbackList=[],self.requestNotificationList=[],self.requestNotificationInfo={},self.notesAndFeedbackInfo={},self.editEnable=!1,self.showNotification=!1,self.showFeedbackOverlay=!1,self.selectedIndex=0,self.notificationIndex=0,self.noteContentForUpdate="",self.showClearSearchIcon=!1,self.types={note:!1,feedback:!1,pending:!1,declined:!1,search:"",goalCategory:"all"},self.updateFormSubmitted=!1,self.requestFormSubmitted=!1,self.sortVal="date",self.predicate="",self.responseAvailable=!1,self.validationError=!1,self.blueprintReady=!1,self.noBlue=!1,self.cachedBluePrintId=-1,self.updateNote=updateNote,self.sendFeedbackRequest=sendFeedbackRequest,self.openDeleteModal=openDeleteModal,self.displayDetailedInfo=displayDetailedInfo,self.editEnableToggle=editEnableToggle,self.toggleNotification=toggleNotification,self.toggleFeedbackOverlay=toggleFeedbackOverlay,self.clearSearch=clearSearch,self.filterResults=filterResults,self.sortResults=sortResults,self.getParameter=getParameter,self.findById=findById,self.reset=reset,self.mouseEventHandler=mouseEventHandler,self.openModalForUpdate=openModalForUpdate,self.updateNoteModal=updateNoteModal,self.updateNoteDialog={},self.getBluePrintDetails=getBluePrintDetails,self.getBluePrintSetting=getBluePrintSetting,self.checktype=checktype,self.stateControl=stateControl,self.winWidth=$(window).width(),self.winHeight=$(window).height()+100+"px",self.showMobileFilter=self.winWidth<768?!1:!0;var getParameter=function(val){for(var query=window.location.search.substring(1),vars=query.split("&"),pair=[],i=0;i<vars.length;i++)return pair=vars[i].split("="),pair[0]===val?pair[1]:null},getGoalType=function(goalCategory){var goalType="";switch(goalCategory){case"GrowthAreas":goalType="ERT-i";break;case"ActionPlan":goalType="OrgPlans";break;case"Blueprint":goalType="Blueprint";break;case"Competency":goalType="Competency"}return goalType},findById=function(source,id){var itemFound=!1;if("dashboard"===source||"notesfeedback"===source)for(var zz=0;zz<self.notesAndFeedbackList.length;zz++)for(var k=0;k<self.notesAndFeedbackList[zz].notesFeedbackList.length&&(self.notesAndFeedbackList[zz].notesFeedbackList[k].id===id&&(itemFound=!0,self.notesAndFeedbackInfo=self.notesAndFeedbackList[zz],self.selectedIndex=zz),!itemFound);k++);else if("notifications"===source)for(var j=0;j<self.requestNotificationList.length&&(self.requestNotificationList[j].id===id&&(itemFound=!0,self.showFeedbackOverlay=!0,self.requestNotificationInfo=self.requestNotificationList[j]),!itemFound);j++);},getAllNotesAndFeedbackForUserForUpdate=function(id){ajaxService.getAjaxResponse({url:self.serviceApis.getAllNotesAndFeedbackForUser,method:"get"}).then(function(response){if("true"===response.Success)response.notesAndFeedbackList.length>0&&(self.masterList=response.notesAndFeedbackList,sortResults(),findById("notesfeedback",id));else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},getAllNotesAndFeedbackForUser=function(index){ajaxService.getAjaxResponse({url:self.serviceApis.getAllNotesAndFeedbackForUser,method:"get"}).then(function(response){if("true"===response.Success){if(self.responseAvailable=!0,self.masterList=[],self.notesAndFeedbackList=[],response.notesAndFeedbackList.length>0){self.masterList=response.notesAndFeedbackList,self.notesAndFeedbackList=angular.copy(self.masterList),sortResults();var param=getParameter("id");null!==param?findById("dashboard",param):(self.notesAndFeedbackInfo=self.notesAndFeedbackList[index],self.selectedIndex=index)}}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})};$scope.deleteInformation=function(deleteId,type){switch(type){case"NOTE":deleteNote.call(this,deleteId);break;case"FEEDBACK":deleteRequestFeedback.call(this,deleteId);break;case"DECLINE":declineFeedbackRequest.call(this,deleteId);break;case"ALL":deleteAll.call(this,deleteId)}};var deleteAll=function(id){var deleteNotes="NOTE"===self.notesAndFeedbackInfo.type?!0:!1,deleteFeedbacks="FEEDBACK"===self.notesAndFeedbackInfo.type?!0:!1;ajaxService.getAjaxResponse({url:self.serviceApis.deleteAll,data:$.param({goalId:id,deleteNote:deleteNotes,deleteFeedback:deleteFeedbacks})}).then(function(response){if("true"===response.Success){getAllNotesAndFeedbackForUser(0),ngDialog.closeAll(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("notesAndFeedback.ajaxSuccessMessage.recordDeleted")});var goalType=getGoalType(self.notesAndFeedbackInfo.goalCategory);sharedProperties.fireAnalyticsEvent("Notes & Feedback | Delete All","Blueprint"===goalType?goalType:goalType+" - "+self.notesAndFeedbackInfo.name)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},deleteNote=function(id){var _this=this;ajaxService.getAjaxResponse({url:self.serviceApis.deleteNote,data:$.param({noteId:id})}).then(function(response){if("true"===response.Success){sharedProperties.spilceIndexWithBreak(self.notesAndFeedbackInfo.notesFeedbackList,"id",id),0===self.notesAndFeedbackInfo.notesFeedbackList.length?(getAllNotesAndFeedbackForUser(0),ngDialog.closeAll()):_this.closeThisDialog(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("notesAndFeedback.ajaxSuccessMessage.recordDeleted")});var goalType=getGoalType(self.notesAndFeedbackInfo.goalCategory);sharedProperties.fireAnalyticsEvent("Notes & Feedback | Delete Note","Blueprint"===goalType?goalType:goalType+" - "+self.notesAndFeedbackInfo.name)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},declineFeedbackRequest=function(id){var _this=this;ajaxService.getAjaxResponse({url:self.serviceApis.declineFeedbackStatus,data:$.param({feedbackId:id,feedbackStatus:"DECLINED"})}).then(function(response){if("true"===response.Success)sharedProperties.spilceIndexWithBreak(self.requestNotificationList,"id",id),self.showNotification=!1,_this.closeThisDialog(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("notesAndFeedback.ajaxSuccessMessage.requestDeclined")}),sharedProperties.fireAnalyticsEvent("Notes & Feedback | Decline a feedback Request","N/A"),0===self.requestNotificationList.length&&(self.requestNotificationList=[]);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},deleteRequestFeedback=function(id){var _this=this;ajaxService.getAjaxResponse({url:self.serviceApis.deleteFeedbackRequest,data:$.param({feedbackId:id})}).then(function(response){if("true"===response.Success){sharedProperties.spilceIndexWithBreak(self.notesAndFeedbackInfo.notesFeedbackList,"id",id),0===self.notesAndFeedbackInfo.notesFeedbackList.length?(getAllNotesAndFeedbackForUser(0),ngDialog.closeAll()):_this.closeThisDialog(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("notesAndFeedback.ajaxSuccessMessage.recordDeleted")});var goalType=getGoalType(self.notesAndFeedbackInfo.goalCategory);sharedProperties.fireAnalyticsEvent("Notes & Feedback | Delete Feedback","Blueprint"===goalType?goalType:goalType+" - "+self.notesAndFeedbackInfo.name)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},getAllFeedbackRequestNotifications=function(){ajaxService.getAjaxResponse({url:self.serviceApis.getAllFeedbackRequestNotifications,method:"get"}).then(function(response){if(self.requestNotificationList=[],"true"===response.Success){self.requestNotificationList=response.feedbackRequestList;var param=getParameter("feedbackId");null!==param&&findById("notifications",param)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})};!function(){getAllNotesAndFeedbackForUser(0),getAllFeedbackRequestNotifications()}()}angular.module("spApp").controller("notesAndFeedbackController",notesAndFeedbackController),angular.module("spApp").filter("notesAndFeedbackFilter",function(){function filterData(item,types,filtered,sharedProperties){if(types.note===!1&&types.feedback===!1&&types.pending===!1)filtered.push(item);else if(types.note===!0&&"NOTE"===item.type)filtered.push(item);else if(types.feedback===!0&&"FEEDBACK"===item.type)filtered.push(item);else if(types.feedback===!1&&types.pending===!0&&"FEEDBACK"===item.type){filtered.push(item);for(var i=0;i<filtered.length;i++)if("FEEDBACK"===filtered[i].type){for(var tmpList=[],j=0;j<filtered[i].notesFeedbackList.length;j++)"NOT_INITIATED"===filtered[i].notesFeedbackList[j].feedbackStatus&&tmpList.push(filtered[i].notesFeedbackList[j]);filtered[i].notesFeedbackList=angular.copy(tmpList),0===filtered[i].notesFeedbackList.length&&sharedProperties.spilceIndexWithBreak(filtered,"id",filtered[i].id)}}}return function(items,types,filterFilter,sharedProperties){var filtered=[];return angular.forEach(items,function(item){"all"===types.goalCategory?filterData(item,types,filtered,sharedProperties):"ind"===types.goalCategory?"GrowthAreas"===item.goalCategory&&filterData(item,types,filtered,sharedProperties):"org"===types.goalCategory?"ActionPlan"===item.goalCategory&&filterData(item,types,filtered,sharedProperties):"blueprint"===types.goalCategory?"Blueprint"===item.goalCategory&&filterData(item,types,filtered,sharedProperties):"competency"===types.goalCategory&&"Competency"===item.goalCategory&&filterData(item,types,filtered,sharedProperties),""!==types.search&&(filtered=filterFilter(filtered,types.search))}),filtered}}),notesAndFeedbackController.$inject=["$scope","ajaxService","$localStorage","ngDialog","sharedProperties","filterFilter","$filter","$rootScope"];
function orgAdminListingController($scope,ajaxService,ngDialog,$localStorage,sharedProperties,$filter,$rootScope){function getCompanyList(){ajaxService.getAjaxResponse({url:vm.config.getCompanyList}).then(function(response){if("true"===response.Success)vm.masterCompanyList=response.actionPlan,vm.companyList=response.actionPlan,vm.companiesAjax=!0,vm.returnMemberList();else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function selectCompany(){vm.companies.length?openCompanyModal():getCompanies()}function getCompanies(){ajaxService.getAjaxResponse({url:vm.config.fetchCompanies,method:"get"}).then(function(response){if("true"===response.Success)vm.companies=response.companies,vm.companies.length?openCompanyModal():$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$rootScope.pullInterNationalization("sysadmin.organization.noCompaniesMessage")});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getCompanyActionPlans(){ajaxService.getAjaxResponse({url:vm.config.fetchCompanyActionPlans}).then(function(response){if("true"===response.Success)vm.companyActionPlanList=response.actionPlan.actionPlanList,vm.companyInfo=response.actionPlan.company;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function openCompanyModal(){var dialog=ngDialog.open({template:vm.config.companiesDialog,scope:$scope});dialog.closePromise.then(function(data){vm.pageSetting.companyText=""})}function returnMemberList(pageSize){return vm.masterCompanyList.length?void vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse):!0}function order(predicate,reverse){vm.pageSetting.lastPredicate=predicate,vm.pageSetting.lastReverse=reverse,vm.companyList=$filter("orderBy")(vm.companyList,predicate,reverse)}function searchTextFilter(search){vm.pageSetting.textSearching=search,vm.returnMemberList()}function active(event,setting){vm.pageSetting.lastPredicate=setting.predicate,vm.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.pageSetting.lastPredicate),vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)}function resetfilter(){vm.pageSetting=angular.copy(vm.originalPageSetting),vm.returnMemberList();var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")}function createOrgPlan(obj){$localStorage.set("companyId",obj),"AccountAdmin"===obj.mode?window.location.href="/sp/admin/account/actionPlan/createPage":window.location.href="/sp/sysAdmin/createOrgPlan"}function updateOrgPlan(obj){$localStorage.set("companyId",obj),"AccountAdmin"===obj.mode?""!==vm.selectedActionPlan&&(window.location.href="/sp/admin/account/actionPlan/updatePage"):window.location.href="/sp/sysAdmin/updateOrgPlan"}var vm=this;vm.masterCompanyList=[],vm.companyList=[],vm.companiesAjax=!1,vm.companies=[],vm.companyActionPlanList=[],vm.companyInfo={},vm.selectedActionPlan="",vm.editClick=!1,vm.config={getCompanyList:"/sp/sysAdmin/actionPlan/getAll",fetchCompanies:"/sp/sysAdmin/actionPlan/getCompanies",companiesDialog:"/sp/sysAdmin/selectCompany",fetchCompanyActionPlans:"/sp/admin/account/actionPlan/getCompanyActionPlans"},vm.pageSetting={searchText:"",disabledInfinite:!1,lastPredicate:"name",lastReverse:!1,companyText:""},vm.originalPageSetting=angular.copy(vm.pageSetting),vm.getCompanyList=getCompanyList,vm.searchTextFilter=searchTextFilter,vm.returnMemberList=returnMemberList,vm.active=active,vm.order=order,vm.selectCompany=selectCompany,vm.createOrgPlan=createOrgPlan,vm.updateOrgPlan=updateOrgPlan,vm.resetfilter=resetfilter,vm.getCompanyActionPlans=getCompanyActionPlans,function(){null!==$localStorage.get("planStatus")&&($.growl({icon:"glyphicon glyphicon-ok",message:$localStorage.get("planStatus")}),$localStorage.remove("planStatus"))}()}function orgAdminCreatePlanController($scope,ajaxService,$localStorage,ngDialog,spJsonFetchAdmin,$rootScope,$timeout,sharedProperties,$state){function deleteOrgPlanModal(options){if(vm.orgPlanDeleteOptions=options,void 0===vm.orgPlanDeleteOptions.practiceAreaId){vm.errorCat=!1,vm.actionPlanForm.submitted=!1;var $category=$(".category");$category.each(function(){$(this).removeClass("error-category")}),vm.actionPlan.practiceAreaList.splice(vm.currentPracticeListIndex,1),moveIndexToFirstItem(0)}else ngDialog.open({template:"/sp/resources/html/admin/organization/delete-plan-modal.html",scope:$scope})}function deleteActionPlanOrStep(){var deleteApi="AccountAdmin"===$localStorage.get("companyId").mode?vm.config.deleteActionPlanOrStepAccountAdmin:vm.config.deleteActionPlanOrStepSuperAdmin;ajaxService.getAjaxResponse({url:deleteApi,data:$.param({actionPlanId:vm.orgPlanDeleteOptions.actionPlanId,practiceAreaId:vm.orgPlanDeleteOptions.practiceAreaId})}).then(function(response){if("true"===response.Success)if(ngDialog.close(),""===vm.orgPlanDeleteOptions.practiceAreaId)$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("sysadmin.organization.deleteplan.success")}),$timeout(function(){"AccountAdmin"===$localStorage.get("companyId").mode?window.location.href="/sp/admin/account/actionPlan/home":window.location.href="/sp/sysAdmin/adminActionPlan"},500);else{$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("sysadmin.organization.deletestep.success")}),vm.errorCat=!1,vm.actionPlanForm.submitted=!1;var $category=$(".category");$category.each(function(){$(this).removeClass("error-category")}),vm.actionPlan.practiceAreaList.splice(vm.currentPracticeListIndex,1),moveIndexToFirstItem(0)}else if(null!==response.error){ngDialog.close();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function leftSectionHeight(){var practiceArea=$(".introduction-area").width(),left=$(".introduction-area").find(".image_intro img").outerWidth(),total=left/practiceArea*100;vm.adjustedWidth=96-total+"%",vm.imageSize=total+"%"}function introVideoSetup(){void 0===vm.actionPlan.practiceAreaList[vm.currentActionPlan].introVideo.type&&(vm.actionPlan.practiceAreaList[vm.currentActionPlan].introVideo.type="VIDEO")}function companyLogoStep(url){url?vm.imageEditBox=!vm.imageEditBox:vm.uploadCompanyLogo()}function uploadCompanyLogo(){vm.imageEditBox=!1,vm.imageType="company",ngDialog.open({template:"/sp/resources/html/admin/account/upload-company-org-pic.html",scope:$scope})}function deleteImageModal(imageType){vm.imageEditBox=!1,vm.imageType=imageType,ngDialog.open({template:"/sp/resources/html/admin/account/delete-image-org-modal.html",scope:$scope})}function practiceAreaSort(length){if(!vm.actionBool&&length>1){new Sortable(document.getElementById("sort-practice-area"),{animation:150,ghostClass:"ghost",handle:".practiceHandle",yAxisOnly:!0,onEnd:function(evt){vm.actionPlan.practiceAreaList.move(evt.oldIndex,evt.newIndex),vm.currentActionPlan=evt.newIndex}});vm.actionBool=!0}}function initialize(){if(!vm.initializeBool){new Sortable(document.getElementById("sort-me"),{animation:150,ghostClass:"ghost",handle:".dHandle",yAxisOnly:!0,onEnd:function(evt){vm.copYactionPlan.move(evt.oldIndex,evt.newIndex)}});vm.initializeBool=!0}}function childInit(id){idi[id]=new Sortable(document.getElementById("child_"+id),{animation:150,ghostClass:"ghost",handle:".dHandle",yAxisOnly:!0,onEnd:function(evt){vm.endindex=$(evt.item).index();var id=$(this.el).attr("id").split("_")[1];vm.copYactionPlan[id].actionList.move(vm.startIndex,vm.endindex)},onStart:function(evt){vm.startIndex=$(evt.item).index()}})}function startPoint(param){null===$localStorage.get("companyId")?redirectToListing():vm.company=$localStorage.get("companyId"),"update"===param?(vm.mode=param,getDetail("onLoad")):(vm.mode=param,vm.actionPlan=spJsonFetchAdmin.spOrgJson(),vm.copYactionPlan=vm.actionPlan.practiceAreaList[vm.currentActionPlan].devStrategyActionCategoryList,vm.introVideoSetup()),$state.go("admin"),"create"===param&&(vm.currentPracticeAreaId=void 0,vm.currentPracticeListIndex=0),$(document).on("imageSaved",function(e,data){$scope.$apply(function(){vm.actionPlan.imageUrl=data.imageData})})}function getDetail(type){ajaxService.getAjaxResponse({url:"AccountAdmin"===$localStorage.get("companyId").mode?vm.config.getDetailForAccountAdmin:vm.config.getDetail,data:$.param({actionPlanId:vm.company.actionPlan})}).then(function(response){if("true"===response.Success)vm.actionPlan=response.actionPlan,"onSave"===type?(vm.currentPracticeAreaId=vm.actionPlan.practiceAreaList[vm.currentActionPlan].id,vm.currentPracticeListIndex=vm.currentActionPlan):(vm.currentPracticeAreaId=vm.actionPlan.practiceAreaList[0].id,vm.currentPracticeListIndex=0),vm.copYactionPlan=vm.actionPlan.practiceAreaList[vm.currentActionPlan].devStrategyActionCategoryList,vm.actionPlan.practiceAreaList[vm.currentActionPlan].keyOutcomes.outcomesList.length?vm.singleBox=angular.copy(vm.actionPlan.practiceAreaList[vm.currentActionPlan].keyOutcomes.outcomesList):vm.singleBox=[0],scrollPosition(),null!==vm.actionPlan.groupList&&prepareGroupList(),vm.introVideoSetup();else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function prepareGroupList(){vm.actionPlan.groupIdList=[];for(var i=0;i<vm.actionPlan.groupList.length;i++)vm.actionPlan.groupIdList.push(vm.actionPlan.groupList[i].id);vm.pageSetting.groupNameHolder=vm.actionPlan.groupList,groupCall()}function prepareGroupPermissions(){if(!vm.actionPlan.forAllUsers){vm.actionPlan.groupPermissionsList=[];for(var i=0;i<vm.pageSetting.groupNameHolder.length;i++)vm.groupPermissions={},vm.groupPermissions.groupId=vm.pageSetting.groupNameHolder[i].id,vm.groupPermissions.excludeGroupLead=vm.pageSetting.groupNameHolder[i].excludeGroupLead,vm.actionPlan.groupPermissionsList.push(vm.groupPermissions)}}function fetchGroup(){!vm.groupList.length&&groupCall()}function converTime(list,hour,min){list.timeInMins=parseInt(void 0===hour?0:60*hour,10)+parseInt(void 0===min?0:min,10)}function converTimePreview(totalMin,hour,min){return{min:totalMin%60,hour:Math.floor(totalMin/60)}}function clonePlan(){vm.clonecompanies.length?openCompanyModal():getCompanies()}function getCompanies(){ajaxService.getAjaxResponse({url:vm.config.fetchCompanies,method:"get"}).then(function(response){if("true"===response.Success){vm.clonecompanies=[],openCompanyModal(),vm.companiesAjax=!0;var clonedCompany={};response.companies.filter(function(obj){obj.id===vm.company.id?clonedCompany=obj:vm.clonecompanies.push(obj)});vm.clonecompanies.sort(function(a,b){var nameA=a.name.toLowerCase(),nameB=b.name.toLowerCase();return nameB>nameA?-1:nameA>nameB?1:0}),vm.clonecompanies.unshift(clonedCompany)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function openCompanyModal(){vm.clonePlanName=vm.actionPlan.name;var dialog=ngDialog.open({template:vm.config.closePlan,scope:$scope});dialog.closePromise.then(function(data){vm.pageSetting.companyText=""})}function groupCall(){void 0===vm.pageSetting.groupNameHolder&&(vm.pageSetting.groupNameHolder=[]),ajaxService.getAjaxResponse({url:"AccountAdmin"===$localStorage.get("companyId").mode?vm.config.fetchGroupForAccountAdmin:vm.config.fetchGroup,data:$.param({companyId:vm.company.id})}).then(function(response){if("true"===response.Success){if(vm.companies=response.groupList,vm.companiesAjax=!0,vm.pageSetting.groupNameHolder.length)for(var i=vm.companies.length-1;i>=0;i--)-1!==vm.actionPlan.groupIdList.indexOf(vm.companies[i].id)&&vm.companies.splice(i,1)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function openCloseSiblingContent(event,mode){var $this=$(event.target);if($this.hasClass("filterCheckBox-label"))return!0;var toggleClass=void 0===mode?"show":"noshow",$html=$this.closest(".category"),$upTarget=$html.find(".header-style-content:eq(0)"),$upTargetHeight=$upTarget.outerHeight();$html.find(".border-faq-content:eq(0)").outerHeight();$upTargetHeight>1?$upTarget.css("height",0):$upTarget.css("height","auto"),$html.toggleClass(toggleClass)}function addInputBox(param){for(var i=0;param>i;i++)vm.singleBox.push(vm.singleBox.length)}function removeInputBox(index){vm.singleBox.splice(index,1),vm.actionPlan.practiceAreaList[vm.currentActionPlan].keyOutcomes.outcomesList.splice(index,1)}function addLink(actionData,parent){var bool=void 0===parent?!1:!parent.permissions.Completion;actionData.push({type:null,linkText:null,url:null,imageLink:null,altText:null,permissions:{Completion:bool}})}function singleAction(actionList){actionList.push({title:null,description:null,timeInMins:0,type:"Single",active:!0,actionData:[{type:null,linkText:null,url:null,imageLink:null,altText:null}],permissions:{Completion:!0}}),vm.pageSetting.actions=!0}function groupAction(actionList){actionList.push({title:null,description:null,timeInMins:0,type:"Group",active:!0,actionData:[{title:null,description:null,type:null,linkText:null,url:null,imageLink:null,altText:null,permissions:{Completion:!0}}],permissions:{}}),vm.pageSetting.actions=!0}function deleteActionList(list,index){list.splice(index,1)}function addCategory(param){vm.actionPlan.practiceAreaList[vm.currentActionPlan].devStrategyActionCategoryList.push({title:null,helpText:null,status:"INACTIVE",actionList:[]}),vm.pageSetting.addedCategory=!0}function scrollPosition(){$(".parent-cat").each(function(){$(this).removeClass("show").find(".header-style-content:eq(0)").css("height",0)}),$("html,body").animate({scrollTop:$(".lnd-right-sec").offset().top-80},300)}function changeActionPlan(index){return vm.currentActionPlan===index?!0:(vm.actionPlanForm.submitted=!1,void(vm.actionPlanForm.$valid?(vm.currentActionPlan=index,vm.currentPracticeAreaId=vm.actionPlan.practiceAreaList[index].id,vm.currentPracticeListIndex=index,vm.actionPlan.practiceAreaList[vm.currentActionPlan].keyOutcomes.outcomesList=vm.actionPlan.practiceAreaList[vm.currentActionPlan].keyOutcomes.outcomesList.filter(function(e){return""!==e}),void 0===vm.actionPlan.practiceAreaList[vm.currentActionPlan].introVideo.type&&(vm.actionPlan.practiceAreaList[vm.currentActionPlan].introVideo.type="VIDEO"),vm.actionPlan.practiceAreaList[vm.currentActionPlan].keyOutcomes.outcomesList.length?vm.singleBox=angular.copy(vm.actionPlan.practiceAreaList[vm.currentActionPlan].keyOutcomes.outcomesList):vm.singleBox=[0],vm.copYactionPlan=vm.actionPlan.practiceAreaList[vm.currentActionPlan].devStrategyActionCategoryList,scrollPosition()):errorHighlighter()))}function startCloning(companyDetail){null!==vm.clonePlanName&&(vm.actionPlan.name=vm.clonePlanName),vm.actionPlan.id=null,vm.actionPlan.groupList=null,vm.actionPlan.active=!1,vm.actionPlan.forAllUsers=!0,vm.company.id=companyDetail.id,vm.company.name=companyDetail.name,vm.pageSetting.groupNameHolder=[],vm.mode="create",vm.actionPlan.practiceAreaList.filter(function(e){e.id=null,e.devStrategyActionCategoryList.filter(function(e1){e1.uid=null,e1.actionList.filter(function(e2){e2.uid=null,e2.actionData.filter(function(e3){e3.uid=null})})})}),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("sysadmin.organization.cloneSuccess")})}function createNewSection(index){vm.actionPlanForm.submitted=!1,vm.currentPracticeAreaId=void 0,vm.actionPlanForm.$valid?(vm.actionPlan.practiceAreaList.push({name:null,description:null,status:"INACTIVE",introVideo:{status:"INACTIVE",type:"VIDEO"},keyOutcomes:{active:!1,outcomesList:[]},devStrategyActionCategoryList:[{title:"Tasks & Exercises",helpText:"Tasks & Exercises",status:"INACTIVE",actionList:[]},{title:"Videos & Resources",helpText:"Videos & Resources",status:"INACTIVE",actionList:[]},{title:"Formal Meetings",helpText:null,status:"INACTIVE",actionList:[]}]}),vm.currentActionPlan=index,vm.currentPracticeListIndex=index,vm.singleBox=[0],vm.viewMode={preview:!1,editCreate:!0},vm.copYactionPlan=vm.actionPlan.practiceAreaList[vm.currentActionPlan].devStrategyActionCategoryList,scrollPosition()):errorHighlighter()}function errorHighlighter(){var $category=$(".category"),count=0;$category.each(function(){$(this).find(".ng-invalid-required").length?($(this).addClass("error-category"),count++):$(this).removeClass("error-category")}),(count||!vm.actionPlanForm.$valid)&&(vm.actionPlanForm.submitted=!0,vm.viewMode={preview:!1,editCreate:!0}),"ACTIVE"===vm.actionPlan.practiceAreaList[vm.currentActionPlan].status&&(!!vm.emptyCheck&&(vm.errorCat=!0),vm.result.length||(vm.errorCat=!0,vm.viewMode={preview:!1,editCreate:!0}))}function redirectToListing(){var localObj=$localStorage.get("companyId");null!==localObj?"AccountAdmin"===localObj.mode?window.location.href="/sp/admin/account/actionPlan/home":window.location.href="/sp/sysAdmin/adminActionPlan":$timeout(function(){var userRole=$localStorage.get("loggegdInProfile").member.roles;userRole.indexOf("SuperAdministrator")>-1?window.location.href="/sp/sysAdmin/adminActionPlan":window.location.href="/sp/admin/account/actionPlan/home"},500)}function trueCheck(){return vm.result=[],vm.emptyCheck=0,"ACTIVE"!==vm.actionPlan.practiceAreaList[vm.currentActionPlan].status?!0:(vm.actionPlan.practiceAreaList[vm.currentActionPlan].devStrategyActionCategoryList.filter(function(e,i){"ACTIVE"===e.status&&(vm.result.push(e),e.actionList.length||vm.emptyCheck++)}),vm.result.length&&!vm.emptyCheck)}function submitObject(){if(vm.disabled)return!0;if(vm.actionPlanForm.submitted=!1,vm.errorCat=!1,vm.disabled=!0,void 0!==vm.actionPlan.groupList&&delete vm.actionPlan.groupList,void 0!==vm.actionPlan.groupIdList&&delete vm.actionPlan.groupIdList,trueCheck()&&vm.actionPlanForm.$valid){vm.actionPlan.practiceAreaList[vm.currentActionPlan].keyOutcomes.outcomesList=vm.actionPlan.practiceAreaList[vm.currentActionPlan].keyOutcomes.outcomesList.filter(function(e){return""!==e}),vm.prepareGroupPermissions();var createServiceAPI="AccountAdmin"===$localStorage.get("companyId").mode?vm.config.accountAdminCreatePlan:vm.config.create,updateServiceAPI="AccountAdmin"===$localStorage.get("companyId").mode?vm.config.accountAdminUpdatePlan:vm.config.editGroup,userMode=$localStorage.get("companyId").mode;vm.actionPlan.companyId=vm.company.id,ajaxService.getAjaxResponse({url:"update"===vm.mode?updateServiceAPI:createServiceAPI,data:vm.actionPlan,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success){var redirectUrl="AccountAdmin"===userMode?"/sp/admin/account/actionPlan/updatePage":"/sp/sysAdmin/updateOrgPlan",message="update"===vm.mode?$rootScope.pullInterNationalization("sysAdmin.organization.planUpdated"):$rootScope.pullInterNationalization("sysAdmin.organization.planCreated");$localStorage.set("planStatus",message),"update"!==vm.mode?($localStorage.set("companyId",{id:vm.company.id,name:vm.company.name,actionPlan:response.actionPlanId,mode:userMode}),window.location.href=redirectUrl):getDetail("onSave"),planStatus(),vm.disabled=!1,errorHighlighter()}else if(null!==response.error){errorHighlighter(),vm.actionPlan.practiceAreaList[vm.currentActionPlan].devStrategyActionCategoryList.filter(function(e,i){if("ACTIVE"===e.status){$(".ng-error-class:eq("+i+")");vm.result.push(e),e.actionList.length||vm.emptyCheck++}}),vm.disabled=!1;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}else vm.disabled=!1,errorHighlighter()}function addGroup(){var dialog=ngDialog.open({template:vm.config.groupDialog,scope:$scope});dialog.closePromise.then(function(data){vm.pageSetting.groupText=""})}function addedGroup(list){void 0===vm.actionPlan.groupIdList&&(vm.actionPlan.groupIdList=[]),vm.actionPlan.groupIdList.push(list.id),vm.pageSetting.groupNameHolder.push(list);for(var i=0;i<vm.companies.length;i++)if(list.id===vm.companies[i].id){vm.companies.splice(i,1);break}}function removeGroup(list,index){vm.actionPlan.groupIdList.splice(index,1),vm.pageSetting.groupNameHolder.splice(index,1),vm.companies.splice(index,0,list)}function requiredCompletion(list,actionList){if("Group"===actionList.type){if("ACTIVE"===list.status&&actionList.active){var result=actionList.actionData.filter(function(e){return e.permissions.Completion});return result.length?!1:!0}return!1}return!1}function countList(list,total){var result=0;return list.filter(function(e){void 0!==e.permissions.Completion&&e.permissions.Completion===!0&&result++,void 0!==total&&void 0!==e.actionData&&e.actionData.filter(function(e1){void 0!==e1.permissions.Completion&&e1.permissions.Completion===!0&&result++})}),result}function changeCompletion(list,actionList){"Group"===actionList.type&&"ACTIVE"===list.status&&actionList.active&&actionList.actionData.filter(function(e){e.permissions.Completion=!1})}function timeAdjust(convert,type){return convert?"h"===type?Math.floor(convert/60):convert%60:""}function previewVideo(mode,url){if("Video"===mode)sharedProperties.videoPopUp(url);else{var win=window.open(url,"_blank");win.focus()}}function previewIntroVideo(url){sharedProperties.videoPopUp(url)}function planStatus(){null!==$localStorage.get("planStatus")&&($.growl({icon:"glyphicon glyphicon-ok",message:$localStorage.get("planStatus")}),$localStorage.remove("planStatus"))}var vm=this,idi=[];vm.config={fetchGroup:"/sp/sysAdmin/group/getGroupList",fetchGroupForAccountAdmin:"/sp/admin/group/getGroupList",create:"/sp/sysAdmin/actionPlan/create",groupDialog:"/sp/admin/selectGroup",editGroup:"/sp/sysAdmin/actionPlan/update",getDetail:"/sp/sysAdmin/actionPlan/getDetails",getDetailForAccountAdmin:"/sp/admin/account/actionPlan/getDetails",videoPopUpDialog:"/sp/admin/videoPop",closePlan:"/sp/sysAdmin/clonePlan",fetchCompanies:"/sp/sysAdmin/actionPlan/getCompanies",accountAdminCreatePlan:"/sp/admin/account/actionPlan/create",accountAdminUpdatePlan:"/sp/admin/account/actionPlan/update",deleteActionPlanOrStepSuperAdmin:"/sp/sysAdmin/actionPlan/delete",deleteActionPlanOrStepAccountAdmin:"/sp/admin/account/actionPlan/delete"},vm.pageSetting={groupText:"",groupNameHolder:[]},vm.currentActionPlan=0,vm.companiesAjax=!1,vm.singleBox=[0],vm.linkType=[{name:"VIDEO IN DIALOG",value:"Video"},{name:"VIDEO IN NEW TAB",value:"VideoTab"},{name:"PPT",value:"PPT"},{name:"PDF",value:"PDF"},{name:"WEB",value:"Web"},{name:"Schedule a meeting",value:"Schedule"}],vm.linkType2=[{name:"VIDEO IN DIALOG",value:"Video"},{name:"VIDEO IN NEW TAB",value:"VideoTab"},{name:"PPT",value:"PPT"},{name:"PDF",value:"PDF"},{name:"WEB",value:"Web"}],vm.linkTypeSmall=[{name:"PPT",value:"PPT"},{name:"PDF",value:"PDF"},{name:"WEB",value:"Web"}],vm.groupList=[],vm.result=[],vm.emptyCheck=0,vm.clonecompanies=[],vm.pageSetting={disabledInfinite:!1,lastPredicate:"name",lastReverse:!1,companyText:"",addedCategory:!1,actions:!1},vm.clonePlanName=null,vm.actionPlanForm={submitted:!1},vm.originalPageSetting=angular.copy(vm.pageSetting),vm.initializeBool=!1,vm.actionBool=!1,vm.disabled=!1,vm.pool=[],vm.groupPermissions={},vm.viewMode={preview:!1,editCreate:!0},vm.orgPlanDeleteOptions={},vm.currentPracticeAreaId=void 0,vm.currentPracticeListIndex=0,vm.openCloseSiblingContent=openCloseSiblingContent,vm.addInputBox=addInputBox,vm.removeInputBox=removeInputBox,vm.addCategory=addCategory,vm.addLink=addLink,vm.singleAction=singleAction,vm.groupAction=groupAction,vm.deleteActionList=deleteActionList,vm.changeActionPlan=changeActionPlan,vm.createNewSection=createNewSection,vm.fetchGroup=fetchGroup,vm.redirectToListing=redirectToListing,vm.submitObject=submitObject,vm.addGroup=addGroup,vm.addedGroup=addedGroup,vm.removeGroup=removeGroup,vm.trueCheck=trueCheck,vm.converTime=converTime,vm.startPoint=startPoint,vm.requiredCompletion=requiredCompletion,vm.changeCompletion=changeCompletion,vm.timeAdjust=timeAdjust,vm.initialize=initialize,vm.childInit=childInit,vm.practiceAreaSort=practiceAreaSort,vm.previewVideo=previewVideo,vm.previewIntroVideo=previewIntroVideo,vm.clonePlan=clonePlan,vm.startCloning=startCloning,vm.prepareGroupPermissions=prepareGroupPermissions,vm.converTimePreview=converTimePreview,vm.introVideoSetup=introVideoSetup,vm.leftSectionHeight=leftSectionHeight,vm.initSize=$(".introduction-area").find(".image_intro img").outerWidth()/$(".introduction-area").width()*100,vm.adjustedWidth=96-vm.initSize+"%",vm.imageSize=vm.initSize+"%",vm.uploadCompanyLogo=uploadCompanyLogo,vm.deleteImageModal=deleteImageModal,vm.companyLogoStep=companyLogoStep,vm.countList=countList,vm.deleteOrgPlanModal=deleteOrgPlanModal,vm.deleteActionPlanOrStep=deleteActionPlanOrStep;var moveIndexToFirstItem=function(index){vm.currentActionPlan=index,vm.currentPracticeAreaId=vm.actionPlan.practiceAreaList[index].id,vm.currentPracticeListIndex=index,vm.actionPlan.practiceAreaList[vm.currentActionPlan].keyOutcomes.outcomesList=vm.actionPlan.practiceAreaList[vm.currentActionPlan].keyOutcomes.outcomesList.filter(function(e){return""!==e}),void 0===vm.actionPlan.practiceAreaList[vm.currentActionPlan].introVideo.type&&(vm.actionPlan.practiceAreaList[vm.currentActionPlan].introVideo.type="VIDEO"),vm.actionPlan.practiceAreaList[vm.currentActionPlan].keyOutcomes.outcomesList.length?vm.singleBox=angular.copy(vm.actionPlan.practiceAreaList[vm.currentActionPlan].keyOutcomes.outcomesList):vm.singleBox=[0]};vm.selectThumbImage=function(videoObj,type){sharedProperties.openMediaModal();var destroyRoot=$scope.$on("mediaData",function(e,data){if(destroyRoot(),null===data)return!0;switch(type){case"introImage":videoObj.imageUrl=data.url,videoObj.imageAltText=data.altText;break;case"imageLink":videoObj.linkurl=data.url,videoObj.linkText=data.name;break;case"imageUrl":videoObj.thumbnailURL=data.url,videoObj.title=data.name;break;case"groupLink":videoObj.mediaUrl=data.url;break;case"groupImage":videoObj.mediaImageLink=data.url,videoObj.mediaAltText=data.altText;break;case"linkAction":"Video"===videoObj.type||"VideoTab"===videoObj.type?(videoObj.imageLink=data.url,videoObj.altText=data.altText,videoObj.linkText=data.name):(videoObj.url=data.url,videoObj.linkText=data.name,videoObj.imageLink="",videoObj.altText="");break;default:videoObj.thumbnailURL=data.url}})},$("body").click(function(e){$(".image-edit-box").is(e.target)||0!==$(".image-edit-box").has(e.target).length||$(".upload-icon").is(e.target)||vm.imageEditBox&&$scope.$apply(function(){vm.imageEditBox=!1})})}function spJsonFetchAdmin(){function spOrgJson(){return{companyId:null,active:!1,forAllUsers:!0,name:null,groupIdList:[],imageUrl:null,groupPermissionsList:[],practiceAreaList:[{name:null,description:null,status:"INACTIVE",introVideo:{status:"INACTIVE",type:"VIDEO"},keyOutcomes:{active:!1,outcomesList:[]},devStrategyActionCategoryList:[{title:"Tasks & Exercises",helpText:"Tasks & Exercises",status:"INACTIVE",actionList:[]},{title:"Videos & Resources",helpText:"Videos & Resources",status:"INACTIVE",actionList:[]},{title:"Formal Meetings",helpText:null,status:"INACTIVE",actionList:[]}]}]}}return{spOrgJson:spOrgJson}}angular.module("spApp").controller("orgAdminListingController",orgAdminListingController),angular.module("spApp").controller("orgAdminCreatePlanController",orgAdminCreatePlanController),angular.module("spApp").service("spJsonFetchAdmin",spJsonFetchAdmin),orgAdminListingController.$inject=["$scope","ajaxService","ngDialog","$localStorage","sharedProperties","$filter","$rootScope"],orgAdminCreatePlanController.$inject=["$scope","ajaxService","$localStorage","ngDialog","spJsonFetchAdmin","$rootScope","$timeout","sharedProperties","$state"];
function organizationAreasController($scope,ajaxService,sharedProperties,$state,$filter,ngDialog,$q,$localStorage,$rootScope,$timeout,notesAndFeedbackMethod){function showMobileHomePage(){vm.showRightCol=!1,vm.showMobileDD=!1}function openNgOverlay(page,data){"undefined"!=typeof data&&(vm.devStrategy={id:data.devStrategyId,desc:data.desc}),"notification"===page&&(vm.openTabId=-1,vm.searchText="",vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails(Object.keys(vm.allNotesFeedbackData)[0]))),"note"===page&&(vm.noteTextArea="",vm.postANote={submitted:!1},vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId,indexName:"NOTE",mode:"addNote"},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails("NOTE"),vm.factories.sortList(vm))),"feedback"===page&&(!vm.emailMemberList.length&&vm.getMemberList(),vm.requestFeedbackArea="",vm.inputRequired=!1,vm.searchTag=[],vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId,indexName:"FEEDBACK",mode:"requestFeedback"},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails("FEEDBACK"),vm.factories.sortList(vm))),"manageStratagies"===page&&vm.manageDevelopmentStartegies(),vm.winHeight=$(window).height()+100+"px";ngDialog.open({template:vm.pageTempaltes[page],className:"ngdialog-lnd-theme",scope:$scope})}function changeGroup(){vm.viewDetails(vm.selectedGroup)}function openState(number,text){vm.winWidth>767?(vm.devStrategy.id="",vm.state(number)):(vm.devStrategy.id="",vm.openNgOverlay(text))}function toggleToolTipMobile(i){vm.winWidth<768&&vm.activeToolTipId!==i?vm.activeToolTipId=i:vm.activeToolTipId=-1}function converTime(totalMin,hour,min){return{min:totalMin%60,hour:Math.floor(totalMin/60)}}function getSelectedActionPlanList(type){ajaxService.getAjaxResponse({url:vm.config.selectedActionPlanList,method:"get"}).then(function(response){if("true"===response.Success)if(void 0===response.actionPlan)vm.actionPlanList=response.actionPlanList,vm.state(4);else{vm.actionPlan=response.actionPlan,!vm.actionPlanList.length&&vm.getActionPlans();for(var index=null,i=0;i<response.actionPlan.practiceAreaList.length;i++)if("ACTIVE"===response.actionPlan.practiceAreaList[i].status){index=i;break}if(null===index)return vm.actionPlanSectionDetail=null,vm.currentActive.name=null,vm.currentActive.index=null,vm.state(),!0;"onClick"===type&&sharedProperties.fireAnalyticsEvent("OrgPlans | Change Org Plan",vm.actionPlan.name),vm.getActionPlansSectionDetail({name:vm.actionPlan.practiceAreaList[index].name,index:index,goalId:vm.actionPlan.practiceAreaList[index].id,showRight:!0,type:"auto"})}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getActionPlans(){ajaxService.getAjaxResponse({url:vm.config.allActionPlans,method:"get"}).then(function(response){if("true"===response.Success)vm.actionPlanList=response.actionPlanList;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function selectActionPlans(actionPlanId){ajaxService.getAjaxResponse({url:vm.config.selectActionPlan+actionPlanId,method:"get"}).then(function(response){if("true"===response.Success)vm.displayPlanList=!1,vm.getSelectedActionPlanList("onClick");else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function getActionPlansSectionDetail(options){return"INACTIVE"===options.status?!0:(vm.currentActive=options,vm.ddSelectedText=vm.currentActive.name,vm.actionPlanSectionDetail=vm.actionPlan.practiceAreaList[vm.currentActive.index],vm.noteTextArea="",vm.feedRequired=!0,vm.state(),vm.showMobileDD&&(vm.showMobileDD=!1),vm.winWidth<768&&void 0===options.showRight&&(vm.showRightCol=!0),void("click"===options.type&&sharedProperties.fireAnalyticsEvent("OrgPlans | Click Org Plan Step","ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name)))}function openChangePlan(){vm.displayPlanList=!vm.displayPlanList}function changeStatus(option,list,mainList,actionList){ajaxService.getAjaxResponse({url:vm.config.completeAction+"?actionPlanId="+option.actionPlanId+"&uid="+option.uid+"&completed="+option.completed,method:"get"}).then(function(response){if("true"===response.Success)if(list.completed=option.completed,option.completed?mainList.completedActions++:mainList.completedActions--,option.completed&&sharedProperties.fireAnalyticsEvent("OrgPlans | Complete an action step","ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name),void 0===option.group||option.completed)if(void 0!==option.group&&option.completed){actionList.completedActions++;var result=actionList.actionData.filter(function(e){return e.permissions.Completion&&!e.completed});!result.length&&actionList.permissions.Completion&&changeStatus({parentCall:!0,actionPlanId:vm.actionPlan.id,completed:!0,uid:actionList.uid},actionList,list)}else void 0!==option.parentCall&&(option.completed?list.completedActions++:list.completedActions--);else actionList.completedActions--,actionList.completed&&actionList.permissions.Completion&&changeStatus({parentCall:!0,actionPlanId:vm.actionPlan.id,completed:!1,uid:actionList.uid},actionList,list);else if(null!==response.error){list.completed=!option.completed;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function stateControl(list){var result=list.actionData.filter(function(e){return e.permissions.Completion&&!e.completed});return result.length?!0:!1}function returnMemberList(pageSize){return vm.actionPlanList.length?void vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse):!0}function order(predicate,reverse){vm.pageSetting.lastPredicate=predicate,vm.pageSetting.lastReverse=reverse,vm.actionPlanList=$filter("orderBy")(vm.actionPlanList,predicate,reverse)}function active(event,setting){vm.pageSetting.lastPredicate=setting.predicate,vm.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.pageSetting.lastPredicate),vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)}function resetfilter(){vm.pageSetting=angular.copy(vm.originalPageSetting),vm.returnMemberList();var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")}function developmentRedirect(options){vm.devStrategy={id:options.devStrategyId,desc:options.desc},vm.state(options.state)}function getMemberList(){ajaxService.getAjaxResponse({url:"/sp/allUsers"}).then(function(response){if("true"===response.Success){if(vm.emailMemberList=response.allMembers,null!==$localStorage.get("loggegdInProfile"))for(var i=0;i<vm.emailMemberList.length;i++)if(vm.emailMemberList[i].email===$localStorage.get("loggegdInProfile").member.email){vm.emailMemberList.splice(i,1);break}}else{var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function loadTags(query){var deferred=$q.defer(),result=vm.emailMemberList.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise}function tagAdded(tag){void 0!==tag.email&&(vm.searchTag.push(tag.email),vm.inputRequired=!1)}function tagRemoved(tag){vm.searchTag.splice(vm.searchTag.indexOf(tag.email),1)}function meetingAdded(tag){void 0!==tag.email&&(vm.schedule.meetingTag.push(tag.email),vm.schedule.meetingRequired=!1)}function meetingRemoved(tag){vm.schedule.meetingTag.splice(vm.schedule.meetingTag.indexOf(tag.email),1)}function updateModel(content){vm.updateNoteObj.submitted=!1,vm.tempModel=content}function deleteActivate(options){ngDialog.closeAll(),"FEEDBACK"===options.type?vm.factories.deleteFeedback(options,vm):"NOTE"===options.type?vm.factories.deleteNote(options,vm):vm.factories.deleteAll(vm)}function deletePop(options){vm.saveDeleteOptions=options;var dialog=ngDialog.open({template:vm.config.deleteDialog,scope:$scope});dialog.closePromise.then(function(data){vm.saveDeleteOptions=null})}function viewDetails(group){vm.viewDetailsListIndex=group,vm.viewDetailsList=group in vm.allNotesFeedbackData?vm.allNotesFeedbackData[group]:null;var $enableSCroll=$(".overflow-enable");$enableSCroll.length&&$enableSCroll.scrollTop(0)}function viewDetailsIndexChange(i){i===vm.openTabId?vm.openTabId=-1:vm.openTabId=i}function previewVideo(mode,url,title,uid){if("Video"===mode)"introVideo"===title?sharedProperties.fireAnalyticsEvent("OrgPlans | View Intro Video","ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name):sharedProperties.fireAnalyticsEvent("OrgPlans | View Action Plan Video","ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name),sharedProperties.videoPopUp(url);else if("Schedule"===mode){!vm.emailMemberList.length&&vm.getMemberList(),vm.schMeeting.submitted=!1,vm.schMeeting.actionTitle=title,vm.scheduleUID=uid;var schedule=ngDialog.open({template:vm.config.scheduleDialog,scope:$scope});schedule.closePromise.then(function(data){vm.schedule=angular.copy(vm.originalSch),vm.schMeeting.actionTitle=null})}else{sharedProperties.fireAnalyticsEvent("OrgPlans | View Media Resource",mode+" file viewed in ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name);var win=window.open(url,"_blank");win.focus()}}function scheduleMeeting(){vm.schMeeting.submitted=!1,vm.schedule.meetingTag.length||(vm.schedule.meetingRequired=!0),vm.schMeetingForm.$valid&&vm.schedule.meetingTag.length&&timeCheck()?ajaxService.getAjaxResponse({url:vm.config.schedule+"?subject="+vm.schedule.subject+"&agenda="+vm.schedule.agenda+"&location="+vm.schedule.location+"&actionPlanId="+vm.actionPlan.id+"&to="+vm.schedule.meetingTag.toString()+"&startDate="+new Date(vm.schedule.fromDate).toISOString()+"&endDate="+new Date(vm.schedule.endDate).toISOString()+"&memberName="+$rootScope.noSelf+"&uid="+vm.scheduleUID,method:"get"}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.organization.schduled")}),sharedProperties.fireAnalyticsEvent("OrgPlans | Schedule a meeting","ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name);else if(null!==response.error){ngDialog.close();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}}):vm.schMeeting.submitted=!0}function timeCheck(){var startTime=new Date(vm.schMeetingForm.start.$dateValue),endTime=new Date(vm.schMeetingForm.end.$dateValue);return startTime.getTime()-endTime.getTime()&&endTime-startTime>0?(vm.schedule.invalidTime=!1,!0):(vm.schedule.invalidTime=!0,!1)}function state(count){switch(count){case 1:vm.noteTextArea="",vm.postANote={submitted:!1},vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId,indexName:"NOTE",mode:"addNote"},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails("NOTE"),vm.factories.sortList(vm),$state.go("addNote")),sharedProperties.fireAnalyticsEvent("OrgPlans | Click Post Note","ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name);break;case 2:!vm.emailMemberList.length&&vm.getMemberList(),vm.requestFeedbackArea="",vm.inputRequired=!1,vm.searchTag=[],vm.requestFeedback.submitted=!1,vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId,indexName:"FEEDBACK",mode:"requestFeedback"},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails("FEEDBACK"),vm.factories.sortList(vm),$state.go("requestFeedback")),sharedProperties.fireAnalyticsEvent("OrgPlans | Click Request Feedback","ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name);break;case 3:vm.searchText="",vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails(Object.keys(vm.allNotesFeedbackData)[0])),$state.go("notesAndFeedback");break;case 4:$state.go("selectActionPlan");break;default:vm.devStrategy={id:"",desc:null},$state.go("organization")}}var vm=this;vm.pageType="organization",vm.actionPlan=null,vm.actionPlanList=[],vm.actionPlanSectionDetail=null,vm.currentActive={name:"",index:-1,goalId:null},vm.devStrategy={id:"",desc:null},vm.emailMemberList=[],vm.inputRequired=!1,vm.requestFeedback={submitted:!1},vm.feedRequired=!0,vm.postANote={submitted:!1},vm.updateNoteObj={submitted:!1},vm.btnEnable=!0,vm.updateNoteFlag=!1,vm.feedRequired=!0,vm.allNotesFeedbackData=[],vm.masterAllNotesFeedbackData=[],vm.displayPlanList=!1,vm.viewDetailsList=null,vm.viewDetailsListIndex=-1,vm.updateModel=updateModel,vm.searchTag=[],vm.idtopass="",vm.config={allActionPlans:"/sp/actionPlan/getActionPlans",selectedActionPlanList:"/sp/actionPlan/getActionPlan?userEmail="+$rootScope.noSelf,selectActionPlan:"/sp/actionPlan/selectPlan?actionPlanId=",deleteDialog:"/sp/resources/html/goals/deleteNoteDialog.html",completeAction:"/sp/actionPlan/completeAction",scheduleDialog:"/sp/schedulePop",schedule:"/sp/actionPlan/sendCalInvite"},vm.pageSetting={searchText:"",disabledInfinite:!1,lastPredicate:"name",lastReverse:!1},vm.schMeeting={};var d=new Date;vm.schMeeting.submitted=!1,vm.schedule={subject:"",location:"",agenda:"",startDate:"",endDate:"",meetingTag:[],meetingRequired:!1,invalidTime:!1},vm.schedule.fromDate=d.setMinutes(d.getMinutes()+60),vm.schedule.endDate=d.setMinutes(d.getMinutes()+60),vm.originalSch=angular.copy(vm.schedule),vm.scheduleUID="",vm.getActionPlans=getActionPlans,vm.selectActionPlans=selectActionPlans,vm.getSelectedActionPlanList=getSelectedActionPlanList,vm.getActionPlansSectionDetail=getActionPlansSectionDetail,vm.active=active,vm.order=order,vm.resetfilter=resetfilter,vm.returnMemberList=returnMemberList,vm.openChangePlan=openChangePlan,vm.changeStatus=changeStatus,vm.stateControl=stateControl,vm.state=state,vm.getMemberList=getMemberList,vm.tagRemoved=tagRemoved,vm.loadTags=loadTags,vm.tagAdded=tagAdded,vm.meetingRemoved=meetingRemoved,vm.meetingAdded=meetingAdded,vm.developmentRedirect=developmentRedirect,vm.deleteActivate=deleteActivate,vm.deletePop=deletePop,vm.viewDetails=viewDetails,vm.viewDetailsIndexChange=viewDetailsIndexChange,vm.showMobileHomePage=showMobileHomePage,vm.converTime=converTime,vm.previewVideo=previewVideo,vm.scheduleMeeting=scheduleMeeting,vm.openState=openState,vm.showMobileDD=!1,vm.ddSelectedText,vm.winWidth=$(window).width(),vm.winHeight=$(window).height()+100+"px",vm.showRightCol=!1,vm.changeManageStrategy=!0,vm.openNgOverlay=openNgOverlay,vm.changeGroup=changeGroup,vm.openTabId,vm.activeToolTipId=-1,vm.toggleToolTipMobile=toggleToolTipMobile,vm.pageTempaltes={note:"/sp/resources/html/goals/addNoteResponsive.html",feedback:"/sp/resources/html/goals/requestFeedbackResponsive.html",notification:"/sp/resources/html/goals/notesFeedbackOverlayResponsive.html",articlecomplete:"/sp/resources/html/goals/completedArticleResponsive.html",manageStratagies:"/sp/resources/html/goals/manageStratagiesResponsive.html"},vm.factories=notesAndFeedbackMethod,$("body").click(function(e){$(".lnd-left-style-box").is(e.target)||0!==$(".lnd-left-style-box").has(e.target).length||$(".drag_handle").is(e.target)||vm.displayPlanList&&$scope.$apply(function(){vm.displayPlanList=!1})})}angular.module("spApp").controller("organizationAreasController",organizationAreasController),organizationAreasController.$inject=["$scope","ajaxService","sharedProperties","$state","$filter","ngDialog","$q","$localStorage","$rootScope","$timeout","notesAndFeedbackMethod"];
function paymentHistoryController($scope,$element,$attrs,$http,$rootScope,ajaxService){$scope.priceFormatter=function(p){if("undefined"!=typeof p&&""!==p&&null!==p){var formattedPrice="$"+p.toFixed(2);return formattedPrice}},ajaxService.getAjaxResponse({url:"/sp/admin/account/paymentHistory"}).then(function(response){if("true"===response.Success)$scope.paymentDetails=response.paymentHistory;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}}),$scope.cancelRedirect=function(){var url=window.location.href,isIndividual=url.substring(url.indexOf("#")+1).replace(/\//g,"").split("?")[1];"i"===isIndividual?window.location="/sp/admin/account/individual":window.location="/sp/admin/account/business"}}function paymentHistoryAlternateController($scope,$element,$attrs,$http,$rootScope,ajaxService,sharedProperties){$scope.priceFormatter=function(p){if("undefined"!=typeof p&&""!==p&&null!==p){var formattedPrice="$"+p.toFixed(2);return formattedPrice}},ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/paymentHistory",data:$.param({accountId:sharedProperties.getParam("accountId")})}).then(function(response){if("true"===response.Success)$scope.paymentDetails=response.paymentHistory,$scope.accountId=sharedProperties.getParam("accountId");else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}}),$scope.cancelRedirect=function(i){var isIndividual=sharedProperties.getParam("mode");"i"===isIndividual?window.location="/sp/sysAdmin/alternateBilling/viewDetailAccountIndividual?accountId="+sharedProperties.getParam("accountId"):window.location="/sp/sysAdmin/alternateBilling/viewDetailAccount?accountId="+sharedProperties.getParam("accountId")}}angular.module("spApp").controller("paymentHistoryController",paymentHistoryController),angular.module("spApp").controller("paymentHistoryAlternateController",paymentHistoryAlternateController),paymentHistoryController.$inject=["$scope","$element","$attrs","$http","$rootScope","ajaxService"],paymentHistoryAlternateController.$inject=["$scope","$element","$attrs","$http","$rootScope","ajaxService","sharedProperties"];
function practiceAdminController($scope,ajaxService,$localStorage,sharedProperties,$filter,$rootScope,ngDialog,$element){function getPracticeGoal(){ajaxService.getAjaxResponse({url:vm.config.practiceArea}).then(function(response){if("true"===response.Success)null===sharedProperties.getParam("goalId")?(vm.masterpracticeAreaAvailable=response.pratcieAreas,vm.returnMemberList(vm.pageSetting.pageSize)):vm.viewDetail(response.pratcieAreas);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function viewDetailStart(){null!==$localStorage.get("viewDetailAdmin")?(vm.viewPracticeAreaDetail=$localStorage.get("viewDetailAdmin"),vm.originalViewDetail=angular.copy(vm.viewPracticeAreaDetail)):vm.getPracticeGoal()}function viewDetail(reponse){for(var goalId=sharedProperties.getParam("goalId"),i=0;i<reponse.length;i++)if(reponse[i].id===goalId){vm.viewPracticeAreaDetail=reponse[i];break}vm.originalViewDetail=angular.copy(vm.viewPracticeAreaDetail)}function addStrategy(param){for(var copyArray=vm.viewPracticeAreaDetail.developmentStrategyList,i=0;param>i;i++)copyArray.push({id:vm.viewPracticeAreaDetail.developmentStrategyList.length-parseInt(1,10).toString(),dsDescription:null,videoUrl:null,imageUrl:null,active:!0});vm.viewPracticeAreaDetail.developmentStrategyList=angular.copy(copyArray),vm.viewDetailForm.submitted=!1}function returnMemberList(pageSize){return vm.masterpracticeAreaAvailable.length?(vm.pageSetting.pageSize=pageSize,pageSize>=vm.masterpracticeAreaAvailable.length&&(vm.pageSetting.disabledInfinite=!0,vm.pageSetting.pageSize=vm.masterpracticeAreaAvailable.length),vm.practiceAreaAvailable=sharedProperties.searchModuleName(vm.pageSetting.textSearching,vm.masterpracticeAreaAvailable,2,"name"),void vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)):!0}function order(predicate,reverse){vm.pageSetting.lastPredicate=predicate,vm.pageSetting.lastReverse=reverse,vm.practiceAreaAvailable=$filter("orderBy")(vm.practiceAreaAvailable,predicate,reverse)}function resetfilter(){vm.pageSetting=angular.copy(vm.originalPageSetting),vm.returnMemberList(vm.pageSetting.pageSize);var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")}function searchTextFilter(search){vm.pageSetting.textSearching=search,vm.returnMemberList(vm.pageSetting.pageSize)}function clearSearch(){vm.pageSetting.textSearching.length&&(vm.pageSetting.textSearching="",vm.pageSetting.searchText="",vm.returnMemberList(vm.pageSetting.pageSize))}function active(event,setting){vm.pageSetting.lastPredicate=setting.predicate,vm.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.pageSetting.lastPredicate),vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)}function deleteConfirm(id){vm.goalId=id;var dialog=ngDialog.open({template:"/sp/resources/html/sysAdmin/goals/deleteConfirmation.html",scope:$scope});dialog.closePromise.then(function(data){vm.goalId=""})}function accountStatus(goalIds,status){ajaxService.getAjaxResponse({url:vm.config.actdeactivate,data:$.param({practiceAreaId:goalIds,status:status})}).then(function(response){if("true"===response.Success){for(var i=0;i<vm.practiceAreaAvailable.length;i++)if(vm.practiceAreaAvailable[i].id===goalIds){"INACTIVE"===status?vm.practiceAreaAvailable[i].status="INACTIVE":vm.practiceAreaAvailable[i].status="ACTIVE";break}$.growl({icon:"glyphicon glyphicon-ok",message:"INACTIVE"===status?$rootScope.pullInterNationalization("practiceAreaAdmin.deactive"):$rootScope.pullInterNationalization("practiceAreaAdmin.active")}),ngDialog.close("ngdialog1"),vm.goalId=""}else if(null!==response.error){var errorMessage="";ngDialog.close("ngdialog1"),vm.goalId="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function updateViewDetail(){if(vm.viewDetailForm.$valid)ajaxService.getAjaxResponse({url:vm.config.updatePracticeArea,data:$("form").serialize()+"&practiceAreaId="+vm.viewPracticeAreaDetail.id}).then(function(response){if("true"===response.Success)vm.detailsEditing.status=!1,$localStorage.set("practiceAdminArea",$rootScope.pullInterNationalization("practiceAreaAdmin.paUpdated")),vm.returnToListing();else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}});else{vm.viewDetailForm.submitted=!0;var elem=angular.element($element);$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300)}}function returnToOldState(){vm.viewPracticeAreaDetail=angular.copy(vm.originalViewDetail),vm.detailsEditing.status=!1,$("html,body").animate({scrollTop:$(".container").offset().top-20},300)}function createViewDetail(){if(vm.viewDetailForm.$valid)ajaxService.getAjaxResponse({url:vm.config.createPracticeArea,data:$("form").serialize()}).then(function(response){if("true"===response.Success)$localStorage.set("practiceAdminArea",$rootScope.pullInterNationalization("practiceAreaAdmin.paUpdated")),vm.returnToListing();else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}});else{vm.viewDetailForm.submitted=!0;var elem=angular.element($element);$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300)}}function returnToListing(){window.location.href="/sp/practiceAdminArea"}function localStore(list){$localStorage.set("viewDetailAdmin",list),window.location.href="/sp/practiceAreaViewDetail?goalId="+list.id}function editEnable(){vm.detailsEditing.status=!0,$("html,body").animate({scrollTop:$("form").offset().top-20},300)}function selectImage(action){sharedProperties.openMediaModal();var destroyRoot=$scope.$on("mediaData",function(e,data){return destroyRoot(),null===data?!0:void(action.imageUrl=data.url)})}var vm=this;vm.config={practiceArea:"/sp/sysAdmin/practiceArea/getAll",actdeactivate:"/sp/sysAdmin/practiceArea/activateDeactivate",updatePracticeArea:"/sp/sysAdmin/practiceArea/update",createPracticeArea:"/sp/sysAdmin/practiceArea/create"},vm.practiceAreaAvailable=[],vm.masterpracticeAreaAvailable=[],vm.viewPracticeAreaDetail={developmentStrategyList:[]},vm.resetfilter=resetfilter,vm.pageSetting={searchText:"",textSearching:"",pageSize:20,disabledInfinite:!1,lastPredicate:"name",lastReverse:!1},vm.originalPageSetting=angular.copy(vm.pageSetting),vm.goalId=null,vm.getPracticeGoal=getPracticeGoal,vm.searchTextFilter=searchTextFilter,vm.returnMemberList=returnMemberList,vm.clearSearch=clearSearch,vm.active=active,vm.deleteConfirm=deleteConfirm,vm.accountStatus=accountStatus,vm.order=order,vm.originalViewDetail=null,vm.detailsEditing={status:!1},vm.viewDetailForm={submitted:!1},vm.pat=/^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/,vm.viewDetail=viewDetail,vm.addStrategy=addStrategy,vm.updateViewDetail=updateViewDetail,vm.returnToOldState=returnToOldState,vm.createViewDetail=createViewDetail,vm.returnToListing=returnToListing,vm.localStore=localStore,vm.viewDetailStart=viewDetailStart,vm.editEnable=editEnable,vm.selectImage=selectImage,function(){null!==$localStorage.get("practiceAdminArea")&&$.growl({icon:"glyphicon glyphicon-ok",message:$localStorage.get("practiceAdminArea")}),$localStorage.remove("practiceAdminArea")}()}angular.module("spApp").controller("practiceAdminController",practiceAdminController),practiceAdminController.$inject=["$scope","ajaxService","$localStorage","sharedProperties","$filter","$rootScope","ngDialog","$element"];
function practiceAreasController($scope,ajaxService,$localStorage,$state,$q,sharedProperties,$filter,$rootScope,ngDialog,$timeout,notesAndFeedbackMethod){function infinteScroll(arg){vm.returnArticleListings(arg)}function goToKnowledgeCenter(){sharedProperties.fireAnalyticsEvent("ERT-i | Click Knowledge Center Link","N/A"),window.location.href="/sp/trainingLibrary"}function returnArticleListings(pageSize){if(!vm.allArticlesListingsMaster.length)return!0;var result=vm.masterCopy?vm.allArticlesListingsMaster:vm.allArticlesListings;vm.allArticlesListings=result,vm.pageSetting.pageSize=pageSize,pageSize>=vm.allArticlesListingsMaster.length&&(vm.pageSetting.disabledInfinite=!0,vm.pageSetting.pageSize=vm.allArticlesListingsMaster.length),vm.masterCopy=!0}function articleBookmark(id,flag){var _flag=!flag,options={url:"/sp/tracking/bookMarkArticle",data:$.param({articleId:id,trackingType:"ARTICLES",isBookMarked:_flag})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){_flag===!0?($.growl({icon:"glyphicon glyphicon-ok",message:" Article bookmarked"}),sharedProperties.fireAnalyticsEvent("ERT-i | Article Bookmarked",id)):($.growl({icon:"glyphicon glyphicon-ok",message:" Bookmark removed"}),sharedProperties.fireAnalyticsEvent("ERT-i | Article Bookmark removed",id));var tempList=angular.copy(vm.allArticlesListings);$.each(tempList,function(i,j){return tempList[i].articleLinkUrl===id?(tempList[i].articleBookmarked=!tempList[i].articleBookmarked,!1):void 0}),vm.allArticlesListings=angular.copy(tempList)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function articleShare(articleId,articleDetails){vm.inputRequired=!1,$scope.shareEnable=!0,$scope.shareArticleId=articleId,vm.searchTag=$scope.searchTag=[],!vm.emailMemberList.length&&vm.getMemberList(articleId),$scope.articlePageDetails=articleDetails,null===$scope.shortDescription||"undefined"==typeof $scope.shortDescription?ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/getShortDescription",data:$.param({articleId:articleId})}).then(function(response){"true"===response.Success&&(vm.winHeight=$(window).height()+100+"px",$scope.shortDescription=response.shortDescription,ngDialog.open({template:"/sp/resources/html/goals/shareArticle.html",scope:$scope,className:vm.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"}))}):(vm.winHeight=$(window).height()+100+"px",ngDialog.open({template:"/sp/resources/html/goals/shareArticle.html",scope:$scope,className:vm.winWidth>767?"ngdialog-theme-default":"new-mobile-theme"}))}function articleLike(id,flag){var _flag=!flag,options={url:"/sp/trainingLibrary/recommendArticle",data:$.param({articleId:id,doReccomend:_flag})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){_flag===!0?($.growl({icon:"glyphicon glyphicon-ok",message:"Article recommended"}),sharedProperties.fireAnalyticsEvent("ERT-i | Article Recommended",id)):($.growl({icon:"glyphicon glyphicon-ok",message:"Article recommendation removed"}),sharedProperties.fireAnalyticsEvent("ERT-i | Article Recommend removed",id));var tempList=angular.copy(vm.allArticlesListings);$.each(tempList,function(i,j){return tempList[i].articleLinkUrl===id?(tempList[i].articleRecommendedByUser=!tempList[i].articleRecommendedByUser,tempList[i].recommendationCount=response.recommendationCount,!1):void 0}),vm.allArticlesListings=angular.copy(tempList)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function applyArticleFilterMobile(v){switch(vm.articlesFilterStatus=!1,vm.articleMediaFilters="ALL",v){case"all":vm.applyArticleFilter("","",0,"auto",!1);break;case"mandatoryArticle":vm.applyArticleFilter("mandatoryArticle",!0,3,"click",!1);break;case"articleRecommendedByUser":vm.applyArticleFilter("articleRecommendedByUser",!0,4,"click",!1);break;case"articleBookmarked":vm.applyArticleFilter("articleBookmarked",!0,5,"click",!1);break;case"userArticleStatus":vm.applyArticleFilter("userArticleStatus","COMPLETED",6,"click",!1)}}function applyArticleFilterMedia(v){switch(vm.articlesFilterStatus=!1,vm.articlesFilter="",v){case"ALL":vm.applyArticleFilter("","",0,"auto",!0);break;case"TEXT":vm.applyArticleFilter("articleType","TEXT",7,"click",!0);break;case"VIDEO":vm.applyArticleFilter("articleType","VIDEO",8,"click",!0);break;case"PODCAST":vm.applyArticleFilter("articleType","PODCAST",9,"click",!0);break;case"SLIDESHARE":vm.applyArticleFilter("articleType","SLIDESHARE",10,"click",!0)}}function applyArticleFilter(k,v,i,action,mediaType){if(vm.showMoreLink&&"click"===action)ajaxService.getAjaxResponse({url:vm.config.loadAllArticles,data:$.param({goalId:vm.currentActive.goalId,memberEmail:$rootScope.noSelf})}).then(function(response){if("true"===response.Success){vm.showMoreLink=!1,vm.allArticlesListings=[],vm.allArticlesListingsMaster=[],vm.allArticlesListingsMaster=response.userArticles,vm.allArticlesListings=angular.copy($scope.allArticlesListingsMaster),vm.infinteScroll(response.userArticles.length),vm.articlesFilterStatus=!1;var _params=[];vm.articlesFilterSelected=i,0!==i?(_params[k]=v,vm.articlesFilter=$filter("filter")(_params),vm.articlesFilterStatus=!0,mediaType===!1&&(vm.articleMediaFilters="ALL")):(vm.articlesFilter="",vm.articlesFilterStatus=!1,vm.articleMediaFilters="ALL")}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}});else{vm.articlesFilterStatus=!1;var _params=[];vm.articlesFilterSelected=i,0!==i?(_params[k]=v,vm.articlesFilter=$filter("filter")(_params),vm.articlesFilterStatus=!0,mediaType===!1&&(vm.articleMediaFilters="ALL")):(vm.articlesFilter="",vm.articlesFilterStatus=!1,vm.articleMediaFilters="ALL")}"userArticleStatus"===k?sharedProperties.fireAnalyticsEvent("ERT-i | Click Article Filters","ArticleCompleted"):"articleType"===k?sharedProperties.fireAnalyticsEvent("ERT-i | Click Article Filters",k+"- "+v):""!==k&&sharedProperties.fireAnalyticsEvent("ERT-i | Click Article Filters",k)}function showMobileHomePage(){vm.showRightCol=!1,vm.showMobileDD=!1}function openNgOverlay(page,data){"undefined"!=typeof data&&(vm.devStrategy={id:data.devStrategyId,desc:data.desc}),"notification"===page&&(vm.openTabId=-1,vm.searchText="",vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails(Object.keys(vm.allNotesFeedbackData)[0]))),"note"===page&&(vm.noteTextArea="",vm.postANote={submitted:!1},vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId,indexName:"NOTE",mode:"addNote"},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails("NOTE"),vm.factories.sortList(vm))),"feedback"===page&&(!vm.emailMemberList.length&&vm.getMemberList(),vm.requestFeedbackArea="",vm.inputRequired=!1,vm.searchTag=[],vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId,indexName:"FEEDBACK",mode:"requestFeedback"},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails("FEEDBACK"),vm.factories.sortList(vm))),"manageStratagies"===page&&vm.manageDevelopmentStartegies(),vm.winHeight=$(window).height()+100+"px";ngDialog.open({template:vm.pageTempaltes[page],className:"ngdialog-lnd-theme",scope:$scope})}function changeGroup(){vm.viewDetails(vm.selectedGroup)}function openState(number,text){vm.winWidth>767?(vm.devStrategy.id="",vm.state(number)):(vm.devStrategy.id="",vm.openNgOverlay(text))}function getPracticeGoal(){ajaxService.getAjaxResponse({url:""===$rootScope.noSelf?vm.config.goals:vm.config.memberGoals,method:"get"}).then(function(response){if("true"===response.Success){vm.goalAvailable=response.userGoal,vm.autoLearning=response.autoLearning,vm.goalsDetail=response.goalDetail,vm.allArticlesListings=[],vm.viewDetailsList=null,vm.changeManageStrategy=!0,vm.feedRequired=!0,vm.goalsCompleted=[],vm.allArticlesListingsMaster=vm.goalsDetail.userGoalsDto.userArticlesProgress.length?vm.goalsDetail.userGoalsDto.userArticlesProgress:[],vm.allArticlesListings=angular.copy(vm.allArticlesListingsMaster);for(var j=0;j<vm.goalAvailable.length;j++)if(vm.goalsDetail.userGoalsDto.activeGoalId===vm.goalAvailable[j].id){vm.ddSelectedText=vm.goalAvailable[j].name,vm.currentActive.goalId=vm.goalAvailable[j].id,vm.currentActive.name=vm.goalAvailable[j].name;break}vm.state(),vm.isAutoTurnOff&&$timeout(function(){vm.updateAutoLearning(!0)},200)}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function loadAllArticles(){ajaxService.getAjaxResponse({url:vm.config.loadAllArticles,data:$.param({goalId:vm.currentActive.goalId,memberEmail:$rootScope.noSelf})}).then(function(response){if("true"===response.Success)vm.showMoreLink=!1,vm.allArticlesListings=[],vm.allArticlesListingsMaster=[],vm.applyArticleFilter("","",0,"auto"),vm.allArticlesListingsMaster=response.userArticles,vm.allArticlesListings=angular.copy($scope.allArticlesListingsMaster),vm.infinteScroll(response.userArticles.length),sharedProperties.fireAnalyticsEvent("ERT-i | Click article load more link","N/A");else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function manageDevelopmentStartegies(){ajaxService.getAjaxResponse({url:vm.config.manageDevelopmentStartegies,data:$.param({goalId:vm.currentActive.goalId})}).then(function(response){if("true"===response.Success)vm.manageDevelopmentStartegiesArray=response.mds,vm.changeManageStrategy=!1,vm.originalManageDevelopmentStartegiesArray=angular.copy(vm.manageDevelopmentStartegiesArray);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function updateAutoLearning(autoTurnOffCheck){return vm.btnEnable?(vm.btnEnable=!1,void ajaxService.getAjaxResponse({url:vm.config.updateAutoLearning,data:$.param({autoLearning:autoTurnOffCheck?!1:!vm.autoLearning})}).then(function(response){if("true"===response.Success){vm.autoLearning=autoTurnOffCheck?!1:!vm.autoLearning;var messages=vm.autoLearning?$rootScope.pullInterNationalization("practiceArea.autoLearningSettingOn"):$rootScope.pullInterNationalization("practiceArea.autoLearningSettingOff");$.growl({icon:"glyphicon glyphicon-ok",message:messages}),vm.btnEnable=!0,sharedProperties.fireAnalyticsEvent("ERT-i | Auto Learning",vm.autoLearning?"ON":"OFF")}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})):!0}function updateMDS(options){var list=[],lengthTrue=vm.trues.length;if(3>lengthTrue)return!0;for(var i=0;lengthTrue>i;i++)list.push(vm.trues[i].id);ajaxService.getAjaxResponse({url:vm.config.updateMDS,data:$.param({goalId:vm.currentActive.goalId,activeDsIds:list.toString()})}).then(function(response){if("true"===response.Success)vm.goalsDetail.userGoalsDto.activeDevelopmentStrategyList=angular.copy(vm.trues),vm.originalManageDevelopmentStartegiesArray=angular.copy(vm.manageDevelopmentStartegiesArray),vm.state(),ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("practiceArea.mdsUpdated")}),sharedProperties.fireAnalyticsEvent("ERT-i | Save Dev Strategy",vm.currentActive.name);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function submitDisabled(){return vm.trues=$filter("filter")(vm.manageDevelopmentStartegiesArray,{selectedByUser:!0}),vm.trues.length>2?!0:!1}function getPracticeGoalDetail(options){return vm.winWidth>768&&vm.currentActive.goalId===options.goalId?(vm.state(),!0):void ajaxService.getAjaxResponse({url:vm.config.goalDetail,data:$.param({goalId:options.goalId})}).then(function(response){if("true"===response.Success)vm.showMoreLink=!0,vm.currentActive=options,vm.goalsDetail=response.goalDetail,vm.allArticlesListings=[],vm.viewDetailsList=null,vm.changeManageStrategy=!0,vm.feedRequired=!0,vm.goalsCompleted=[],vm.articleBookmarks=[],vm.articleLikes=[],vm.articleLikesCount=[],vm.applyArticleFilter("","",0,"auto"),vm.allArticlesListingsMaster=vm.goalsDetail.userGoalsDto.userArticlesProgress.length?vm.goalsDetail.userGoalsDto.userArticlesProgress:[],vm.allArticlesListings=angular.copy(vm.allArticlesListingsMaster),vm.ddSelectedText=vm.currentActive.name,vm.state(),vm.winWidth<768&&(vm.showRightCol=!0),sharedProperties.fireAnalyticsEvent("ERT-i | Click Practice Area",vm.currentActive.name);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function deleteActivate(options){ngDialog.closeAll(),"FEEDBACK"===options.type?vm.factories.deleteFeedback(options,vm):"NOTE"===options.type?vm.factories.deleteNote(options,vm):vm.factories.deleteAll(vm)}function deletePop(options){vm.saveDeleteOptions=options;var dialog=ngDialog.open({template:vm.config.deleteDialog,scope:$scope});dialog.closePromise.then(function(data){vm.saveDeleteOptions=null})}function state(count){switch(count){case 1:vm.noteTextArea="",vm.postANote={submitted:!1},vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId,indexName:"NOTE",mode:"addNote"},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails("NOTE"),vm.factories.sortList(vm),$state.go("addNote")),sharedProperties.fireAnalyticsEvent("ERT-i | Click Post Note",vm.currentActive.name);break;case 2:!vm.emailMemberList.length&&vm.getMemberList(),vm.requestFeedbackArea="",vm.inputRequired=!1,vm.searchTag=[],vm.requestFeedback.submitted=!1,vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId,indexName:"FEEDBACK",mode:"requestFeedback"},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails("FEEDBACK"),vm.factories.sortList(vm),$state.go("requestFeedback")),sharedProperties.fireAnalyticsEvent("ERT-i | Click Request Feedback",vm.currentActive.name);break;case 3:vm.searchText="",vm.feedRequired?vm.factories.getNotesFeedbackForGoal({goalId:vm.currentActive.goalId},vm):(vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.viewDetails(Object.keys(vm.allNotesFeedbackData)[0])),$state.go("notesAndFeedback");break;case 4:$state.go("completedArticle"),$("html,body").animate({scrollTop:$(".lnd-right-sec").offset().top-40},300);break;case 5:vm.changeManageStrategy&&(vm.manageDevelopmentStartegiesArray=[],vm.manageDevelopmentStartegies()),vm.manageDevelopmentStartegiesArray=angular.copy(vm.originalManageDevelopmentStartegiesArray),$state.go("manageArticle"),$("html,body").animate({scrollTop:$(".lnd-right-sec").offset().top-40},300),sharedProperties.fireAnalyticsEvent("ERT-i | Click Manage Dev Strategy",vm.currentActive.name);break;default:vm.devStrategy={id:"",desc:null},$state.go("practice")}}function getMemberList(){ajaxService.getAjaxResponse({url:"/sp/allUsers"}).then(function(response){if("true"===response.Success){if(vm.emailMemberList=response.allMembers,null!==$localStorage.get("loggegdInProfile"))for(var i=0;i<vm.emailMemberList.length;i++)if(vm.emailMemberList[i].email===$localStorage.get("loggegdInProfile").member.email){vm.emailMemberList.splice(i,1);break}}else{var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function loadTags(query){var deferred=$q.defer(),result=vm.emailMemberList.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise}function tagAdded(tag){void 0!==tag.email&&(vm.searchTag.push(tag.email),vm.inputRequired=!1)}function tagRemoved(tag){vm.searchTag.splice(vm.searchTag.indexOf(tag.email),1)}function developmentRedirect(options){vm.devStrategy={id:options.devStrategyId,desc:options.desc},vm.state(options.state)}function viewDetails(group){vm.viewDetailsListIndex=group,vm.viewDetailsList=group in vm.allNotesFeedbackData?vm.allNotesFeedbackData[group]:null;var $enableSCroll=$(".overflow-enable");$enableSCroll.length&&$enableSCroll.scrollTop(0)}function viewDetailsIndexChange(i){i===vm.openTabId?vm.openTabId=-1:vm.openTabId=i}function updateModel(content,model){vm.updateNoteObj.submitted=!1,vm.tempModel=content}function learningCenter(){window.location.href="/sp/trainingLibrary"}function videoPopUp(url){sharedProperties.fireAnalyticsEvent("ERT-i | View Dev Strategy Video",vm.currentActive.name),sharedProperties.videoPopUp(url)}function toggleToolTipMobile(i){vm.winWidth<768&&vm.activeToolTipId!==i?vm.activeToolTipId=i:vm.activeToolTipId=-1}var vm=this,randomValue=(new Date).getTime(),pageUrl=window.location.href;vm.isAutoTurnOff=function(){var splitPageUrl=pageUrl.split("/"),isAutoOff="autoTurnOff"===splitPageUrl[splitPageUrl.length-1]?!0:!1;return isAutoOff}(),vm.config={goals:"/sp/goals/getUserGoals?rand="+randomValue,memberGoals:"/sp/for/goals/getUserGoals?memberEmail="+$rootScope.noSelf,goalDetail:"/sp/goals/getGoalDetail?memberEmail="+$rootScope.noSelf,manageDevelopmentStartegies:"/sp/goals/getMds",updateMDS:"/sp/goals/updateMds",updateAutoLearning:"/sp/updateAutoLearning",deleteDialog:"/sp/resources/html/goals/deleteNoteDialog.html",videoPopUpDialog:"/sp/support/videoPopUp",deleteAll:"/sp/goals/notesFeedback/deleteAll",loadAllArticles:"/sp/goals/getGoalArticles"},vm.goalAvailable=[],vm.pageType="individual",vm.goalsDetail=[],vm.emailMemberList=[],vm.searchTag=$scope.searchTag=[],vm.allNotesFeedbackData=[],vm.masterAllNotesFeedbackData={},vm.manageDevelopmentStartegiesArray=[],vm.originalManageDevelopmentStartegiesArray=[],vm.openState=openState,vm.devStrategy={id:"",desc:null},vm.currentActive={name:"",goalId:-1},vm.postANote={submitted:!1},vm.inputRequired=$scope.inputRequired=!1,vm.requestFeedback={submitted:!1},vm.updateNoteObj={submitted:!1},vm.btnEnable=!0,vm.feedRequired=!0,vm.viewDetailsList=null,vm.saveDeleteOptions=null,vm.trues=[],vm.getPracticeGoal=getPracticeGoal,vm.getPracticeGoalDetail=getPracticeGoalDetail,vm.getMemberList=getMemberList,vm.tagRemoved=$scope.tagRemoved=tagRemoved,vm.loadTags=$scope.loadTags=loadTags,vm.tagAdded=$scope.tagAdded=tagAdded,vm.developmentRedirect=developmentRedirect,vm.viewDetails=viewDetails,vm.viewDetailsIndexChange=viewDetailsIndexChange,vm.state=state,vm.deleteActivate=deleteActivate,vm.updateModel=updateModel,vm.manageDevelopmentStartegies=manageDevelopmentStartegies,vm.updateMDS=updateMDS,vm.submitDisabled=submitDisabled,vm.updateAutoLearning=updateAutoLearning,vm.learningCenter=learningCenter,vm.deletePop=deletePop,vm.videoPopUp=videoPopUp,vm.showMobileDD=!1,vm.ddSelectedText,vm.winWidth=$(window).width(),vm.winHeight=$(window).height()+100+"px",vm.showRightCol=!1,vm.changeManageStrategy=!0,vm.showMoreLink=!0,vm.loadAllArticles=loadAllArticles,vm.openNgOverlay=openNgOverlay,vm.changeGroup=changeGroup,vm.openTabId,vm.activeToolTipId=-1,vm.toggleToolTipMobile=toggleToolTipMobile,vm.showMobileHomePage=showMobileHomePage,vm.pageTempaltes={note:"/sp/resources/html/goals/addNoteResponsive.html",feedback:"/sp/resources/html/goals/requestFeedbackResponsive.html",notification:"/sp/resources/html/goals/notesFeedbackOverlayResponsive.html",articlecomplete:"/sp/resources/html/goals/completedArticleResponsive.html",manageStratagies:"/sp/resources/html/goals/manageStratagiesResponsive.html"},vm.allArticlesListings=[],vm.allArticlesListingsMaster=[],vm.pageSetting={pageSize:10,intialPageSize:10,disabledInfinite:!1},vm.infinteScroll=infinteScroll,vm.returnArticleListings=returnArticleListings,vm.masterCopy=!0,vm.articleBookmarks=[],vm.articleLikes=[],vm.articleLikesCount=[],vm.articleBookmark=articleBookmark,vm.articleShare=articleShare,vm.articleLike=articleLike,vm.articlesFilterSelected=0,vm.articlesFilter="",vm.applyArticleFilterMobile=applyArticleFilterMobile,vm.applyArticleFilter=applyArticleFilter,vm.applyArticleFilterMedia=applyArticleFilterMedia,vm.articleMediaFilters="ALL",vm.goToKnowledgeCenter=goToKnowledgeCenter,$scope.articleShared=function(obj){return obj.email.length?void ajaxService.getAjaxResponse({url:"/sp/trainingLibrary/shareArticle",data:$.param({articleId:obj.articleId,comment:obj.comment,toList:obj.email.toString()})}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$scope.shareEnable=!1,$.growl({icon:"glyphicon glyphicon-ok",message:" Article shared successfully"}),sharedProperties.fireAnalyticsEvent("ERT-i | Article Shared",obj.articleId);else{ngDialog.close("ngdialog1"),$scope.shareEnable=!1;for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}}):(vm.inputRequired=!0,!0)},vm.factories=notesAndFeedbackMethod,function(){null!==$localStorage.get("mdsUpdated")&&($.growl({icon:"glyphicon glyphicon-ok",message:$localStorage.get("mdsUpdated")}),$localStorage.remove("mdsUpdated")),vm.getPracticeGoal()}(),jQuery(function($){$("body").on("click",".event-practice-article a",function(event){event.preventDefault();var redirectUrl=$(this).attr("href");sharedProperties.fireAnalyticsEvent("ERT-i | Viewed Article",redirectUrl),window.location.href=redirectUrl})})}function managePracticeArea($scope,ajaxService,$filter,sharedProperties,ngDialog,$rootScope,$localStorage){function clickInfoBox(){sharedProperties.fireAnalyticsEvent("ERT-i | Manage - click info icon","N/A")}function getPracticeGoal(){ajaxService.getAjaxResponse({url:vm.config.practiceAreasGoals,method:"get"}).then(function(response){if("true"===response.Success)vm.prismLensExists=response.prismLensExist,vm.masterlistGoals=response.userAllGoal,vm.selectedGoals=response.userSelectedGoal,vm.copYselectedGoals=response.userSelectedGoal,vm.sortList(),vm.selectedGoals.length>=12&&(vm.disableAddButton=!0);else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function sortList(){vm.listGoals=vm.masterlistGoals.filter(function(e){return(""===vm.pageOptions.optionList&&e||null!==e.sourceList&&-1!==Object.keys(e.sourceList).indexOf(vm.pageOptions.optionList)&&e)&&(vm.pageOptions.searchText.length?-1!==angular.lowercase(e.goal.name).indexOf(angular.lowercase(vm.pageOptions.searchText))&&e:e)}),vm.pageOptions.searchText.length&&sharedProperties.fireAnalyticsEvent("ERT-i | Manage - search",vm.pageOptions.searchText)}function cancelIt(){window.onbeforeunload=null,sharedProperties.fireAnalyticsEvent("ERT-i | Manage - Cancel","N/A"),window.location.href="/sp/goals#/practice"}function changeGoalStatus(goals){vm.removeGoal(goals,"leftRail"),sharedProperties.fireAnalyticsEvent("ERT-i | Manage - Remove Practice Area from left rail",goals.goal.name);for(var i=0;i<vm.masterlistGoals.length;i++)if(vm.masterlistGoals[i].goal.id===goals.goal.id){vm.masterlistGoals[i].selected=!vm.masterlistGoals[i].selected;break}}function updatePracticeAreasGoals(){window.onbeforeunload=null,vm.unloadFunctionCall=!1,vm.selectedGoals=angular.copy(vm.copYselectedGoals),vm.goalList=[],$(vm.sortable.el).find("li").each(function(value,index){vm.goalList.push($(this).attr("data-id"))}),ajaxService.getAjaxResponse({url:vm.config.updatePracticeAreasGoals,data:$.param({goalId:vm.goalList.toString()})}).then(function(response){if("true"===response.Success)$localStorage.set("mdsUpdated",$rootScope.pullInterNationalization("practiceArea.mdsUpdated")),sharedProperties.fireAnalyticsEvent("ERT-i | Manage Practice areas - Updated","N/A"),window.location.href="/sp/goals#/practice";else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong></strong>",message:errorMessage})}})}function addGoal(goals){vm.copYselectedGoals.push(goals),vm.selectedGoals=angular.copy(vm.copYselectedGoals),$.growl({icon:"glyphicon glyphicon-ok",message:12===vm.selectedGoals.length?$rootScope.pullInterNationalization("practiceArea.maxAdded"):$rootScope.pullInterNationalization("practiceArea.addedGoal")}),12===vm.selectedGoals.length?vm.disableAddButton=!0:vm.disableAddButton=!1,sharedProperties.fireAnalyticsEvent("ERT-i | Manage - Add Practice Area",goals.goal.name),confirmWhetherToExit()}function removeGoal(goals,type){for(var i=0;i<vm.copYselectedGoals.length;i++)if(vm.copYselectedGoals[i].goal.id===goals.goal.id){vm.copYselectedGoals.splice(i,1);break}vm.selectedGoals=angular.copy(vm.copYselectedGoals),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("practiceArea.removeGoal")}),12===vm.selectedGoals.length?vm.disableAddButton=!0:vm.disableAddButton=!1,"rightRail"===type&&sharedProperties.fireAnalyticsEvent("ERT-i | Manage - Remove Practice Area",goals.goal.name),confirmWhetherToExit()}function paListResponsive(){vm.winHeight=$(window).height()+100+"px";ngDialog.open({template:"/sp/resources/html/goals/managerPaResponsive.html",className:"ngdialog-lnd-theme",scope:$scope})}function initialize(){vm.initializeBool||(vm.el=document.getElementById("sort-me"),vm.winWidth>767?vm.sortable=new Sortable(vm.el,{group:"name",animation:150,ghostClass:"ghost",onEnd:function(evt){vm.copYselectedGoals.move(evt.oldIndex,evt.newIndex),sharedProperties.fireAnalyticsEvent("ERT-i | Manage Practice Areas - Sort","N/A"),confirmWhetherToExit()}}):vm.sortable=new Sortable(vm.el,{group:"name",animation:150,ghostClass:"ghost",handle:".dHandle",yAxisOnly:!0,onEnd:function(evt){vm.copYselectedGoals.move(evt.oldIndex,evt.newIndex),sharedProperties.fireAnalyticsEvent("ERT-i | Manage Practice Areas - Sort","N/A"),confirmWhetherToExit()}}),vm.initializeBool=!0)}function changeFilter(value){switch(value){case"all":vm.pageOptions={weightOrder:"allGoalWeight",optionList:"",searchText:""};break;case"prism":vm.pageOptions={weightOrder:"prismWeight",optionList:"Prism",searchText:""};break;case"prismLens":vm.pageOptions={weightOrder:"prismLensWeight",optionList:"PrismLens",searchText:""}}vm.sortList()}function viewDevelopmentStartegy(list,name){vm.viewStrategy=list,vm.viewStrategyName=name,vm.winHeight=$(window).height()+100+"px";ngDialog.open({template:vm.winWidth>767?"/sp/viewDevelopmentStrategy":"/sp/resources/html/goals/viewDevelopmentStartegyResponsive.html",scope:$scope,className:vm.winWidth>767?"ngdialog-theme-default":"ngdialog-lnd-theme"})}var vm=this;vm.config={practiceAreasGoals:"/sp/goals/getAllGoals",updatePracticeAreasGoals:"/sp/goals/updateUserGoalsSelection"},vm.selectedGoals=[],vm.listGoals=[],vm.masterlistGoals=[],vm.goalList=[],vm.selPracticeArea="all",vm.pageOptions={weightOrder:"allGoalWeight",optionList:"",searchText:""},vm.showIt=!1,vm.viewStrategyName="",vm.prismLensExists=!0,vm.initializeBool=!1,vm.unloadFunctionCall=!1,vm.disableAddButton=!1,vm.winWidth=$(window).width(),vm.winHeight=$(window).height()+100+"px",vm.getPracticeGoal=getPracticeGoal,vm.updatePracticeAreasGoals=updatePracticeAreasGoals,vm.addGoal=addGoal,vm.removeGoal=removeGoal,vm.initialize=initialize,vm.changeFilter=changeFilter,vm.cancelIt=cancelIt,vm.viewDevelopmentStartegy=viewDevelopmentStartegy,vm.sortList=sortList,vm.changeGoalStatus=changeGoalStatus,vm.paListResponsive=paListResponsive,vm.clickInfoBox=clickInfoBox;var confirmWhetherToExit=function(){vm.unloadFunctionCall||(vm.unloadFunctionCall=!0,window.onbeforeunload=function(e){return $rootScope.pullInterNationalization("practiceArea.unsavedChanges.message")})};!function(){vm.getPracticeGoal(),$(".mpa-left-sec").stick_in_parent({offset_top:-140})}()}angular.module("spApp").controller("practiceAreasController",practiceAreasController),angular.module("spApp").controller("managePracticeArea",managePracticeArea),practiceAreasController.$inject=["$scope","ajaxService","$localStorage","$state","$q","sharedProperties","$filter","$rootScope","ngDialog","$timeout","notesAndFeedbackMethod"],managePracticeArea.$inject=["$scope","ajaxService","$filter","sharedProperties","ngDialog","$rootScope","$localStorage"];
function processPaymentController($scope,$element,$attrs,$http,ngDialog,ajaxService,$localStorage){$scope.updateCC={},$scope.dialogStatus={},$scope.accountType=$localStorage.get("account_type"),$scope.getAccountInfo=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/businessAccountDetails"}).then(function(response){if("true"===response.Success)$scope.accountInfo=response.account;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getIndividualAccountInfo=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/individualAccountDetails"}).then(function(response){if("true"===response.Success)$scope.accountInfo=response.account;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.processPayment=function(fData){$scope.updateCC.submitted=!1,$scope.updateCC.$valid?ajaxService.getAjaxResponse({url:"/sp/admin/account/processPayment",data:$.param(fData)}).then(function(response){if("true"===response.Success)$scope.dialogStatus.title="Process payment",$scope.dialogStatus.content="Payment processed successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/success-dialog.html",scope:$scope});else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}}):$scope.updateCC.submitted=!0},"company"===$scope.accountType?$scope.getAccountInfo():$scope.getIndividualAccountInfo(),$scope.cancelRedirect=function(){window.location="/sp/admin/account/business"}}angular.module("spApp").controller("processPaymentController",processPaymentController),processPaymentController.$inject=["$scope","$element","$attrs","$http","ngDialog","ajaxService","$localStorage"];
function profileMainController($scope,$timeout,ajaxService,$rootScope,sharedProperties,$localStorage,ngDialog){function togglePrimaryGraph(id){sharedProperties.fireAnalyticsEvent("Prism Portrait | Change Primary Personality Tabs",0===_this.activeProfileSummary?"Viewed Primary Personality Tab":"Viewed Personality Under Pressure Tab");var g0=$("#personalityChart").find(".prismG0"),g1=$("#personalityChart").find(".prismG1"),g2=$("#personalityChart").find(".prismG2"),c0=$("#personalityChart").find(".crossLines0"),c1=$("#personalityChart").find(".crossLines1");_this.label="",_this.prismLabelContent=!1,jQuery(".outer-labels").find("p").removeClass("active"),1===id?(g0.attr({"fill-opacity":0,"stroke-width":0}),g1.attr({"fill-opacity":.6,"stroke-width":3,"stroke-opacity":.6,"stroke-dasharray":0}),c1.attr({"stroke-width":1}),c0.attr({"stroke-width":0}),g2.attr({"fill-opacity":.3,"stroke-opacity":.3,"stroke-dasharray":"3,6"})):(g0.attr({"fill-opacity":.3,"stroke-width":3,"stroke-opacity":.3,"stroke-dasharray":"3,6"}),g1.attr({"fill-opacity":0,"stroke-width":0,"stroke-opacity":0}),g2.attr({"fill-opacity":.6,"stroke-opacity":.6,"stroke-dasharray":0}),c1.attr({"stroke-width":0}),c0.attr({"stroke-width":1}))}function updateTab(tab,text,profile){_this.selectedTab=tab,_this.selectedTabText=text,_this.activeProfileSummary=profile,_this.activeProfileContent=profile,_this.mobileMenuShow=!1,_this.label="",_this.prismLabelContent=!1,jQuery(".outer-labels").find("p").removeClass("active"),$scope.selectedProfileTab=text,sharedProperties.fireAnalyticsEvent("Prism Portrait | Click Personality Module Tab",text)}function getCurrentUserEmail(){var getProfileDetails,getEmail=!1;return $rootScope.profileReady===!0&&(getProfileDetails=$localStorage.get("loggegdInProfile"),getEmail=getProfileDetails.member.email),getEmail}function getTokenDetails(){var _location=window.location.href,_getToken=_location.split("/"),_token=_getToken[_getToken.length-1];return _this.publicToken=_token,_token}function setOptions(o){var memberEmail=sharedProperties.getParam("email"),candidateEmail=sharedProperties.getParam("cemail"),defaultEmail=getCurrentUserEmail(),_options={};if(_this.publicToken=!1,"publicProfile"===o||"spCertificate"===o){var token=getTokenDetails(),updatedUrl="publicProfile"===o?_this.prismServices.publicProfile:_this.prismServices.spCertificate;"undefined"!=typeof token&&null!==token&&(_this.winWidth<768?(_this.selectedTab=0,_this.mobileHelpLink=!0):_this.selectedTab=8,_options={url:updatedUrl+token},profileStoreCheck(_options,token))}else"undefined"!=typeof memberEmail&&null!==memberEmail?(_options={url:_this.prismServices.member,data:$.param({email:memberEmail})},profileStoreCheck(_options,memberEmail)):"undefined"!=typeof candidateEmail&&null!==candidateEmail?(_options={url:_this.prismServices.candidate,data:$.param({userId:$localStorage.get("candidateID",candidateEmail)})},profileStoreCheck(_options,$localStorage.get("candidateID",candidateEmail))):(_options={url:_this.prismServices.member,data:$.param({email:defaultEmail})},profileStoreCheck(_options,defaultEmail))}function profileStoreCheck(options,id){var storedProfile=$localStorage.get(id);_this.isAnalysisLoaded=!1,_this.prismData=null,_this.prismContent=null,"undefined"!=typeof storedProfile&&null!==storedProfile?(_this.prismData=storedProfile.Analysis,_this.prismContent=storedProfile,_this.showSpProfile="undefined"!=typeof storedProfile.Analysis?!0:!1,_this.personalityVideo1=_this.videos[_this.prismContent["profile.analysis.mapped.Primary.personalityType"].replace(/ /g,"").replace(/&/g,"").toLowerCase()],_this.personalityVideo2=_this.videos[_this.prismContent["profile.analysis.mapped.UnderPressure.personalityType"].replace(/ /g,"").replace(/&/g,"").toLowerCase()],"undefined"!=typeof storedProfile.user&&null!==storedProfile.user&&(_this.userDetails=storedProfile.user),$timeout(function(){_this.isAnalysisLoaded=!0},100),_this.winWidth<768&&_this.updateTab(0,"Personality Profile",0),$scope.selectedProfileTab="Personality Profile"):getPrismAnalysis(options)}function getPrismAnalysis(options){ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success)_this.analysisError=!1,_this.publicToken!==!1?_this.showSpProfile="undefined"!=typeof response.Analysis?!0:!1:$localStorage.set(options.data.split("=")[1].replace(/%40/g,"@"),response),"undefined"!=typeof response.user&&null!==response.user&&(_this.userDetails=response.user),_this.prismData=response.Analysis,_this.prismContent=response,_this.personalityVideo1=_this.videos[_this.prismContent["profile.analysis.mapped.Primary.personalityType"].replace(/ /g,"").replace(/&/g,"").toLowerCase()],_this.personalityVideo2=_this.videos[_this.prismContent["profile.analysis.mapped.UnderPressure.personalityType"].replace(/ /g,"").replace(/&/g,"").toLowerCase()],$timeout(function(){_this.isAnalysisLoaded=!0},100),_this.winWidth<768&&_this.updateTab(0,"Personality Profile",0,!1,!0,!0),$scope.selectedProfileTab="Personality Profile";else if(null!==response.error)if(_this.isAnalysisLoaded=!1,_this.publicToken!==!1)window.location.href="/?status=404";else{_this.analysisError=!0;for(var key in response.error)_this.analysisErrorContent=response.error[key]}})}function videoPopUp(url,type){void 0!==type&&"personalityVideo"===type?sharedProperties.fireAnalyticsEvent(0===_this.activeProfileSummary?"Prism Portrait | Click Primary Personality Video":"Prism Portrait | Click Personality under Pressure Video","N/A"):sharedProperties.fireAnalyticsEvent("Prism Portrait | Click Personality Module Info Video",$scope.selectedProfileTab),sharedProperties.videoPopUp(url)}function showInfoBoxMobile(t,v){$scope.winScreenHeight=jQuery(window).height()+"px",$scope.infoBoxTab=t,sharedProperties.fireAnalyticsEvent("Prism Portrait | Click Personality Module Info icon",$scope.selectedProfileTab);var videoType,videoLink=v;if(/youtube/g.test(videoLink))videoType="youtube";else if(/vimeo/g.test(videoLink)){videoType="vimeo";var link=videoLink.split("?")[0].split("/");videoLink="https://vimeo.com/"+link[parseInt(link.length-1)]}else videoType="html5";$scope.setupVideo=function(){setTimeout(function(){videojs(document.getElementById("vid1"),{autoplay:!1,techOrder:[videoType],src:videoLink},function(){$scope.videoReady=!0})},500)},$scope.videoPlayBtn=function(){jQuery("#vid1")[0].player.play()},ngDialog.open({template:"/sp/resources/html/profile/mobile-info-box.html",scope:$scope,className:"ngdialog-theme-default no-padding-top"})}var _this=this;_this.isAnalysisLoaded=!1,_this.analysisError=!1,_this.publicToken=!1,_this.selectedTab=0,_this.mobileMenuHide=!0,_this.activeProfileSummary=0,_this.activeProfileContent=0,_this.showHelpLink=!1,_this.mobileHelpLink=!1,_this.showSpProfile=!1,_this.prismLabelContent=!1,_this.label="",_this.setOptions=setOptions,_this.showInfoBoxMobile=showInfoBoxMobile,_this.videoPopUp=videoPopUp,_this.updateTab=updateTab,_this.prismData={},_this.prismContent={},_this.personalityVideo1,_this.personalityVideo2,_this.prismServices={publicProfile:"/sp/profilePublic/",spCertificate:"/sp/spCertificate/",member:"/sp/signedIn/getAnalysisFull",candidate:"/sp/hiring/getAnalysisFull"},_this.videos={scientist:"https://www.youtube.com/watch?v=WJrEKUP0Rys&feature=youtu.be",ambassador:"https://www.youtube.com/watch?v=osIJWk6-m_4&feature=youtu.be",pioneer:"https://www.youtube.com/watch?v=MFQHpCjMx5g&feature=youtu.be",peacemaker:"https://www.youtube.com/watch?v=JOs4j017Sxw&feature=youtu.be",influencer:"https://www.youtube.com/watch?v=kn3E93nATro&feature=youtu.be",strategist:"https://www.youtube.com/watch?v=6jB8YzrIdAc&feature=youtu.be",instructor:"https://www.youtube.com/watch?v=bdMLEK8MxGk&feature=youtu.be",catalyst:"https://www.youtube.com/watch?v=mmT8iYVmd_Y&feature=youtu.be",navigator:"https://www.youtube.com/watch?v=-EVhn_BVhFQ&feature=youtu.be",pragmatist:"https://www.youtube.com/watch?v=a6_FbC2RSKw&feature=youtu.be",connector:"https://www.youtube.com/watch?v=lOSV-AN6al8&feature=youtu.be",architect:"https://www.youtube.com/watch?v=pYrRKr6YCts&feature=youtu.be",ally:"https://www.youtube.com/watch?v=owh4bv73_vk&feature=youtu.be",researcher:"https://www.youtube.com/watch?v=wJtx_x_hlUs&feature=youtu.be",toughtender:"https://www.youtube.com/watch?v=EBKYMYVoSjA&feature=youtu.be",visionary:"https://www.youtube.com/watch?v=l6EV0Q_sKhg&feature=youtu.be"},_this.winWidth=jQuery(window).width(),_this.mobileMenuShow=!1,_this.togglePrimaryGraph=togglePrimaryGraph,_this.refreshFlag=!1,$scope.videoReady=!1,$scope.currDate=new Date,$rootScope.switchPrismView=function(type){"standard"===type?sharedProperties.fireAnalyticsEvent("Prism Portrait | Click Standard View","N/A"):"charts"===type&&sharedProperties.fireAnalyticsEvent("Prism Portrait | Click Charts View","N/A")},$rootScope.openPdfView=function(url,_this,profileName){sharedProperties.fireAnalyticsEvent("Prism Portrait | Print to PDF","N/A"),$scope.clickedItem=_this,$scope.sp_profileName=profileName,ngDialog.open({template:url,scope:$scope,className:"ngdialog-theme-default ngdialog-clearBg"})};var isIE=jQuery("html").hasClass("ie")?!0:!1,ieTimer=isIE?2500:1e3;$scope.$on("ngDialog.opened",function(e,$dialog){$scope.nameofUser=$localStorage.get("loggegdInProfile"),$scope.sp_name="undefined"==typeof $scope.sp_profileName||null==$scope.sp_profileName?$scope.nameofUser.member.name:$scope.sp_profileName,$timeout(function(){sharedProperties.printPdfProfile({holder:".printVersion",cssName:"sp-profile-pdf.css",url:"/sp/pdf/generatePdf",extraParam:"Prism-Portrait-"+$scope.sp_name.replace(" ","-"),obj:$scope.clickedItem})},ieTimer)}),$rootScope.$on("pdfGenerated",function(e,opt){return"object"!=typeof opt.obj?!1:(opt.obj.generatingPdf=!1,$scope.urlRedirect=opt.url,$scope.sp_profileName=null,void $(".ngdialog").removeClass("ngdialog-clearBg"))})}function showInfoBox($timeout,$rootScope,ngDialog,sharedProperties){return{restrict:"A",link:function($scope,$element,$attrs){var _this=jQuery($element[0]),id=_this.attr("data-boxid"),infoBox=jQuery('div[data-box="'+id+'"]'),extraHeight="undefined"!=typeof infoBox.attr("data-extraheight")?!0:!1,autoWidth="undefined"!=typeof infoBox.attr("data-width")?!0:!1,infoBoxP=infoBox.parent();_this.off("click").on("click",function(e){e.preventDefault();var personalityType="";switch(id){case"listptp":case"chartptp":personalityType="Personality Profile";break;case"listpbp":case"chartpbp":personalityType="Processing Blueprint";break;case"listmot":case"chartmot":personalityType="Motivation";break;case"listcm":case"chartcm":personalityType="Conflict Management";break;case"listfm":case"chartfm":personalityType="Fundamental Needs";break;case"listdms":case"chartdms":personalityType="Decision Making";break;case"listls":case"chartls":personalityType="Learning Style"}sharedProperties.fireAnalyticsEvent("Prism Portrait | Click Personality Module Info icon",personalityType);var iHeight=jQuery(infoBoxP).outerHeight(),iWidth=jQuery(infoBoxP).outerWidth(),colHeight=jQuery("body").find(".chart-box-cols:first-child").outerHeight(),boxHeights=parseInt(jQuery("body").find(".chart-box-cols.right .motivation-wrapper").outerHeight()+jQuery("body").find(".chart-box-cols.right .decision-making-wrapper").outerHeight());infoBox.css({height:jQuery(window).width()>767&&extraHeight?iHeight+parseInt(colHeight-boxHeights):iHeight,width:autoWidth?"auto":iWidth}).addClass("active-info-box").removeClass("hide")}),jQuery(".ibClose").off("click").on("click",function(e){e.preventDefault();var id=jQuery(this).attr("data-boxid");jQuery('div[data-box="'+id+'"]').addClass("hide").removeClass("active-info-box")}),jQuery(window).resize(function(){if(jQuery(window).width()>767){if(jQuery("body").find(".mobile-infoBox-modal").length){var id1=jQuery("body").find(".mobile-infoBox-modal").parent().parent().attr("id");jQuery("#"+id1).length&&ngDialog.closeAll()}if(jQuery(".active-info-box").length>0){var iHeight=jQuery(infoBoxP).outerHeight(),iWidth=jQuery(infoBoxP).outerWidth(),colHeight=jQuery("body").find(".chart-box-cols:first-child").outerHeight(),boxHeights=parseInt(jQuery("body").find(".chart-box-cols.right .motivation-wrapper").outerHeight()+jQuery("body").find(".chart-box-cols.right .decision-making-wrapper").outerHeight());jQuery(".active-info-box").css({height:jQuery(window).width()>767&&extraHeight?iHeight+parseInt(colHeight-boxHeights):iHeight,width:autoWidth?"auto":iWidth})}}else if(jQuery(".active-info-box").length>0&&jQuery(".active-info-box").addClass("hide").removeClass("active-info-box"),jQuery("body").find(".videoPopDialog").length){var id=jQuery("body").find(".videoPopDialog").parent().parent().attr("id");jQuery("#"+id).length&&ngDialog.closeAll()}})}}}function resizeInfoBoxes($timeout,$rootScope){return{restrict:"A",link:function($scope,$element,$attrs){jQuery(window).width()>767?setTimeout(function(){$rootScope.setBoxSizes(".charbox-wrapper",".chart-box-cols")},50):jQuery("body").find(".chart-box-cols").removeAttr("style"),jQuery(window).resize(function(){jQuery(window).width()>767?setTimeout(function(){$rootScope.setBoxSizes(".charbox-wrapper",".chart-box-cols")},50):jQuery("body").find(".chart-box-cols").removeAttr("style")})}}}function mobileDropdown(){return{restrict:"A",link:function($scope,$element,$attrs){$element.bind("click",function(){$scope.$parent.ctrl.mobileMenuShow===!1?$scope.$apply(function(){$scope.$parent.ctrl.mobileMenuShow=!0}):$scope.$apply(function(){$scope.$parent.ctrl.mobileMenuShow=!1})})}}}function prismLabelDesc($rootScope){return{restrict:"A",link:function($scope,$element,$attrs){var label="",isTouch="ontouchstart"in window||navigator.msMaxTouchPoints>0,isRMtool=!1,isMem=!1;isTouch?$element.on("click",function(){isRMtool="undefined"!=typeof $element.attr("data-rm")?!0:!1,$element.hasClass("active")?($element.removeClass("active"),jQuery(".outer-labels").find("p").removeClass("active"),$scope.$apply(function(){isRMtool?($scope.$parent.$parent.prismLabelContent1=!1,$scope.$parent.$parent.prismLabelContent=!1,$scope.$parent.$parent.label=""):($scope.$parent.ctrl.prismLabelContent=!1,$scope.$parent.ctrl.label="")})):(jQuery(".outer-labels").find("p").removeClass("active"),$element.addClass("active"),label=$rootScope.pullInterNationalization($element.attr("data-label")).toLowerCase(),$scope.$apply(function(){isRMtool?($scope.$parent.$parent.prismLabelContent1=!1,$scope.$parent.$parent.prismLabelContent=!1,isMem="undefined"!=typeof $element.attr("data-mem")?!0:!1,isMem?$scope.$parent.$parent.prismLabelContent1=!0:$scope.$parent.$parent.prismLabelContent=!0,$scope.$parent.$parent.label=label):($scope.$parent.ctrl.prismLabelContent=!0,$scope.$parent.ctrl.label=label)}))}):($element.on("mouseenter",function(){isRMtool="undefined"!=typeof $element.attr("data-rm")?!0:!1,jQuery(".outer-labels").find("p").removeClass("active"),$element.addClass("active"),label=$rootScope.pullInterNationalization($element.attr("data-label")).toLowerCase(),$scope.$apply(function(){isRMtool?(isMem="undefined"!=typeof $element.attr("data-mem")?!0:!1,isMem?$scope.$parent.$parent.prismLabelContent1=!0:$scope.$parent.$parent.prismLabelContent=!0,$scope.$parent.$parent.label=label):($scope.$parent.ctrl.prismLabelContent=!0,$scope.$parent.ctrl.label=label)})}),$element.on("mouseleave",function(){isRMtool="undefined"!=typeof $element.attr("data-rm")?!0:!1,$element.removeClass("active"),jQuery(".outer-labels").find("p").removeClass("active"),$scope.$apply(function(){isRMtool?(isMem="undefined"!=typeof $element.attr("data-mem")?!0:!1,isMem?$scope.$parent.$parent.prismLabelContent1=!1:$scope.$parent.$parent.prismLabelContent=!1,$scope.$parent.$parent.label=""):($scope.$parent.ctrl.prismLabelContent=!1,$scope.$parent.ctrl.label="")})}))}}}angular.module("spApp").controller("profileMainController",profileMainController),profileMainController.$inject=["$scope","$timeout","ajaxService","$rootScope","sharedProperties","$localStorage","ngDialog"],angular.module("spApp").directive("showInfoBox",showInfoBox),showInfoBox.$inject=["$timeout","$rootScope","ngDialog","sharedProperties"],angular.module("spApp").directive("resizeInfoBoxes",resizeInfoBoxes),resizeInfoBoxes.$inject=["$timeout","$rootScope"],angular.module("spApp").directive("mobileDropdown",mobileDropdown),angular.module("spApp").directive("prismLabelDesc",prismLabelDesc),prismLabelDesc.$inject=["$rootScope"];
function profileListController($scope,ajaxService,$filter,$state,ngDialog,$timeout,sharedProperties,$rootScope,$localStorage){function getProfileData(){ajaxService.getAjaxResponse({url:vm.config.getProfileData,data:$.param({name:$localStorage.get("groupname")})}).then(function(response){if("true"===response.Success){var userRoles=null!==$localStorage.get("loggegdInProfile")?$localStorage.get("loggegdInProfile").member.roles:[];vm.hasCompetencyRole=-1!==userRoles.indexOf("CompetencyAdmin")?!0:!1,vm.listingView="ASSESSMENT",vm.profileList=response.groupInfo||[],vm.groupId=response.groupInfo.id,vm.responseRecieved=!0,vm.profileList.memberSummaryList.length&&vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse),vm.loadCompetencyDetails()}else if(null!=response.error){vm.responseRecieved=!0;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function loadCompetencyDetails(){vm.responseAvailableForCompetency=!1,ajaxService.getAjaxResponse({url:vm.config.getCompetencyListing,data:$.param({groupId:vm.groupId})}).then(function(response){if("true"===response.Success){vm.competencyList=response.competencyProfile,vm.competencyEvaluationInProgress=response.evaluationInProgress;for(var competencyUserMap={},competencyNameMap={},i=0;i<response.memberList.length;i++)competencyUserMap[response.memberList[i].userId]=response.memberList[i].competencyProfileId;for(var k=0;k<vm.competencyList.length;k++)competencyNameMap[vm.competencyList[k].id]=vm.competencyList[k].name;for(var j=0;j<vm.profileList.memberSummaryList.length;j++)vm.profileList.memberSummaryList[j].user.competencyProfileId=competencyUserMap[vm.profileList.memberSummaryList[j].user.id],vm.profileList.memberSummaryList[j].user.competencyProfileName=competencyNameMap[vm.profileList.memberSummaryList[j].user.competencyProfileId];null!==vm.profileList.groupLead&&(vm.profileList.groupLead.competencyProfileId=competencyUserMap[vm.profileList.groupLead.id],vm.profileList.groupLead.competencyProfileName=competencyNameMap[vm.profileList.groupLead.competencyProfileId]),vm.responseAvailableForCompetency=!0}else if(null!=response.error){vm.responseRecieved=!0;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function switchView(type){"status"===type?vm.listingView="ASSESSMENT":("reload"===type||"COMPETENCY"!==vm.listingView)&&(vm.loadCompetencyDetails(),vm.listingView="COMPETENCY")}function assignCompetency(){vm.assignClick=!0,""!==vm.selectedCompetency&&ajaxService.getAjaxResponse({url:vm.config.assignCompetency,data:$.param({competencyProfileId:vm.selectedCompetency,memberIdList:vm.selectedUsersList.join()})}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.evaluationAssigned")}),vm.switchView("reload");else if(null!==response.error){ngDialog.close();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage}),vm.switchView("reload")}})}function removeCompetency(){ajaxService.getAjaxResponse({url:vm.config.removeCompetency,data:$.param({memberIdList:vm.selectedUsersList.join()})}).then(function(response){if("true"===response.Success)ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("competency.ajaxSuccess.evaluationRemoved")}),vm.switchView("reload");else if(null!==response.error){ngDialog.close();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage}),vm.switchView("reload")}})}function assignRemoveCompetencyModalSingle(obj,action){vm.assignClick=!1,vm.selectedCompetency="",vm.competencyAssignRemoveOptions=[],vm.selectedUsersList=[],vm.competencyActionType=action,vm.competencyAssignRemoveOptions.push(obj),vm.selectedUsersList.push(obj.userId);var dialog=ngDialog.open({template:"/sp/resources/html/admin/competency/assign-remove-competency-groups.html",scope:$scope});dialog.closePromise.then(function(data){vm.competencyActionType="MORE"})}function assignRemoveCompetencyModalMultiple(){if("MORE"!==vm.competencyActionType&&"GROUP_REMOVE"!==vm.competencyActionType){vm.assignClick=!1,vm.selectedCompetency="",vm.competencyAssignRemoveOptions=[],vm.selectedUsersList=[];for(var i=0;i<vm.pageSetting.userEmail.email.length;i++)vm.competencyAssignRemoveOptions.push(vm.pageSetting.userEmail.email[i]),vm.selectedUsersList.push(vm.pageSetting.userEmail.email[i].userId);var dialog=ngDialog.open({template:"/sp/resources/html/admin/competency/assign-remove-competency-groups.html",scope:$scope});dialog.closePromise.then(function(data){vm.competencyActionType="MORE"})}else"GROUP_REMOVE"===vm.competencyActionType&&vm.certainDelete()}function order(predicate,reverse){vm.pageSetting.lastPredicate=predicate,vm.pageSetting.lastReverse=reverse,vm.profileList.memberSummaryList=$filter("orderBy")(vm.profileList.memberSummaryList,vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)}function callGetAllMembers(){vm.pageSetting.oneTime&&(getAllMembers(),vm.pageSetting.oneTime=!1)}function getAllMembers(){ajaxService.getAjaxResponse({url:vm.config.getAllMembers}).then(function(response){if("true"===response.Success){var allMail=response.memberList;angular.forEach(allMail,function(val,index){(""===allMail[index].firstName&&""===allMail[index].lastName||"undefined"!=typeof vm.profileList.groupLead&&null!==vm.profileList.groupLead&&allMail[index].email===vm.profileList.groupLead.email)&&delete allMail[index]}),allMail=$.grep(allMail,function(n){return n}),vm.fullEmailList=angular.copy(allMail),angular.forEach(vm.profileList.memberSummaryList,function(val,index){for(var i=0;i<allMail.length;i++)val.user.email===allMail[i].email&&allMail.splice(i,1)}),vm.allEmails=angular.copy(allMail)}})}function active(event,setting){vm.pageSetting.lastPredicate=setting.predicate,vm.pageSetting.lastReverse=setting.reverse,sharedProperties.toggleFilterClick(event,vm.pageSetting.lastPredicate),vm.order(vm.pageSetting.lastPredicate,vm.pageSetting.lastReverse)}function assignGroupLead(){vm.callGetAllMembers(),vm.errorNotification.selectGroupLead=!1,ngDialog.open({template:vm.config.groupLeadDialog,scope:$scope})}function assignNewGroup(groupname,groupLeadEmailId){return"undefined"==typeof groupLeadEmailId||""===groupLeadEmailId?(vm.errorNotification.selectGroupLead=!0,!0):void ajaxService.getAjaxResponse({url:vm.config.addMember,data:$.param({name:groupname,memberEmail:groupLeadEmailId,isGroupLead:!0})}).then(function(response){if("true"===response.Success){vm.listingView="ASSESSMENT",vm.profileList.groupLead=response.member;for(var i=0;i<vm.profileList.memberSummaryList.length;i++)if(vm.profileList.memberSummaryList[i].user.email===response.member.email){vm.profileList.memberSummaryList.splice(i,1);break}sharedProperties.spilceIndexWithBreak(vm.allEmails,"email",response.member.email),!vm.alltoggle&&(vm.negative=!1,vm.pageSetting.userEmail.email=[]),vm.negative&&vm.checkAll(),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.profile.updateMessage")})}else if(null!=response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function removeGroupLead(){ngDialog.open({template:vm.config.removeGroupLeadDialog,scope:$scope})}function removeGL(groupname,groupMemberEmail){var gEmail=groupMemberEmail;ajaxService.getAjaxResponse({url:vm.config.removeGroupLead,data:$.param({name:groupname,groupLeadEmail:gEmail})}).then(function(response){"true"===response.Success?(vm.pageSetting.oneTime=!0,vm.getProfileData(),vm.callGetAllMembers(),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.profile.removeGroupL")})):null!=response.error&&$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.profile.removeGroupLError")})})}function memberTakeAway(email,f){$localStorage.set("memEmail",email),f===!0&&$localStorage.set("spProfileTab",!0),window.location.href="/sp/admin/account/member/details?email="+email}function showFocus(event){var current=$(event.currentTarget).closest(".memprofile").find(".addMemberAnchor");$("html, body").animate({scrollTop:$(current).offset().top-50},"slow")}function actionToClear(){!vm.alltoggle&&(vm.negative=!1,vm.pageSetting.userEmail.email=[]),vm.negative&&vm.checkAll(),$rootScope.$broadcast("handleBroadcast")}function confirmDelete(event,member,groupLead){var email=member.email,eve=angular.element(event.currentTarget);groupLead=groupLead,ajaxService.getAjaxResponse({url:vm.config.removeMember,data:$.param({name:vm.profileList.name,memberEmail:email,isGroupLead:groupLead})}).then(function(response){if("true"===response.Success){if(groupLead)vm.allEmails.push(vm.profileList.groupLead),vm.profileList.groupLead=null;else for(var i=0;i<vm.profileList.memberSummaryList.length;i++)if(vm.profileList.memberSummaryList[i].user.email===email){vm.allEmails.push(vm.profileList.memberSummaryList[i].user),vm.profileList.memberSummaryList.splice(i,1);break}eve.scope().moreadvance=!eve.scope().moreadvance,$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.profile.deleteMessage")}),!vm.alltoggle&&(vm.negative=!1,vm.pageSetting.userEmail.email=[]),vm.negative&&vm.checkAll()}else if(null!=response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function certainDelete(){vm.callGetAllMembers();var dialog=ngDialog.open({template:vm.config.certainDeleteDialog,scope:$scope});dialog.closePromise.then(function(data){vm.competencyActionType="MORE"})}function deleteUsers(emails){var emailList=[];$.each(emails,function(i,j){emailList.push(emails[i].email)});var options={url:vm.config.removeMember,data:$.param({memberEmail:emailList.toString(),name:vm.profileList.name})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){if(emails.length){var copyArea=angular.copy(vm.profileList.memberSummaryList);angular.forEach(vm.profileList.memberSummaryList,function(val,index){for(var i=0;i<emails.length;i++)val.user.email===emails[i].email&&(vm.allEmails.push(vm.profileList.memberSummaryList[index].user),delete copyArea[index])}),vm.profileList.memberSummaryList=$.grep(copyArea,function(n){return n}),"undefined"!=typeof vm.profileList.groupLead&&null!==vm.profileList.groupLead&&-1!==emailList.indexOf(vm.profileList.groupLead.email)&&(vm.allEmails.push(vm.profileList.groupLead),vm.profileList.groupLead=null),ngDialog.close("ngdialog1"),vm.pageSetting.userEmail.email=[],!vm.alltoggle&&(vm.negative=!1,vm.pageSetting.userEmail.email=[]),vm.negative&&vm.checkAll(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.profile.deleteMessage")})}}else if(null!=response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function checkAll(){vm.checkedAll=!vm.checkedAll,vm.negative?(vm.pageSetting.userEmail.email=vm.profileList.memberSummaryList.map(function(item){return{userId:item.user.id,email:item.user.email,name:item.user.name,title:item.user.title}}),vm.profileList.groupLead&&vm.pageSetting.userEmail.email.push({userId:vm.profileList.groupLead.id,email:vm.profileList.groupLead.email,name:vm.profileList.groupLead.name,title:vm.profileList.groupLead.title})):vm.pageSetting.userEmail.email=[]}function countLead(){return vm.profileList.groupLead?1:0}function renamePopup(){vm.errornewGroup=!1,vm.errornewEmptyGroup=!1,ngDialog.open({template:vm.config.renameGroupDialog,scope:$scope}),vm.newGroupSelector=vm.profileList.name}function renameGroup(savetosave,oldname){return""===savetosave?(vm.errornewEmptyGroup=!0,!0):savetosave===oldname?(ngDialog.close("ngdialog1"),!0):void ajaxService.getAjaxResponse({url:vm.config.updateName,data:$.param({name:savetosave,oldName:oldname})}).then(function(response){"true"===response.Success?(vm.profileList.name=savetosave,$localStorage.set("groupname",savetosave),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.profile.updateGroupNameMessage")})):null!=response.error&&(vm.errornewGroup=!0)})}function deletePopup(){ngDialog.open({template:vm.config.deleteGroupDialog,scope:$scope})}function deleteFullGroup(groupname){ajaxService.getAjaxResponse({url:vm.config.deleteGroup,data:$.param({name:groupname})}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$localStorage.remove("groupname"),$state.go("group");else if(null!=response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function allEmailPop(){var mailtoAll=vm.profileList.memberSummaryList.map(function(item){return{userId:item.user.id,email:item.user.email,name:item.user.name,title:item.user.title}});vm.profileList.groupLead&&mailtoAll.push({userId:vm.profileList.groupLead.id,email:vm.profileList.groupLead.email,name:vm.profileList.groupLead.name,title:vm.profileList.groupLead.title}),mailtoAll.length&&$rootScope.notificationEmailPoP(mailtoAll)}function checkUncheck(){vm.alltoggle=!1,vm.checkedAll&&(vm.negative=!vm.negative,vm.checkedAll=!vm.checkedAll)}function resetCounter(name,value){vm.pageSetting=angular.copy(vm.originalpageSetting);var curr=$(".profileHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")}var vm=this;vm.profileList=[],vm.fullEmailList=[],vm.allEmails=[],vm.checkedAll=!1,vm.negative=!1,vm.alltoggle=!1,vm.responseRecieved=!1,vm.listingView="ASSESSMENT",vm.competencyList=[],vm.competencyEvaluationInProgress=!1,vm.competencyActionType="MORE",vm.selectedCompetency="",vm.assignClick=!1,vm.competencyAssignRemoveOptions=[],vm.selectedUsersList=[],vm.responseAvailableForCompetency=!1,vm.hasCompetencyRole=!1,vm.groupId="",vm.config={getProfileData:"/sp/admin/group/groupDetails",getAllMembers:"/sp/admin/member",addMember:"/sp/admin/group/addMember",groupLeadDialog:"/sp/admin/group/assignGroupLead",removeGroupLeadDialog:"/sp/admin/group/removeGroupLead",removeGroupLead:"/sp/admin/group/removeGroupLead",removeMember:"/sp/admin/group/removeMember",certainDeleteDialog:"/sp/admin/member/deleteConfirmationGrp",renameGroupDialog:"/sp/admin/group/renameGroup",updateName:"/sp/admin/group/updateName",deleteGroupDialog:"/sp/admin/group/deleteGroup",deleteGroup:"/sp/admin/group/delete",getCompetencyListing:"/sp/admin/competency/getUserCompetency",assignCompetency:"/sp/admin/competency/assignCompetency",removeCompetency:"/sp/admin/competency/removeCompetency"},vm.pageSetting={pageSize:10,intialPageSize:10,userEmail:{email:[]},lastPredicate:"user.name",lastReverse:!1,textSearching:"",disabledInfinite:!1,checkedAll:!1,oneTime:!0},vm.originalpageSetting=angular.copy(vm.pageSetting),vm.errorNotification={errornewGroup:!1,errornewEmptyGroup:!1,selectGroupLead:!1},vm.getProfileData=getProfileData,vm.order=order,vm.callGetAllMembers=callGetAllMembers,vm.active=active,vm.assignGroupLead=assignGroupLead,vm.assignNewGroup=assignNewGroup,vm.removeGroupLead=removeGroupLead,vm.removeGL=removeGL,vm.memberTakeAway=memberTakeAway,vm.showFocus=showFocus,vm.confirmDelete=confirmDelete,vm.certainDelete=certainDelete,vm.renamePopup=renamePopup,vm.deletePopup=deletePopup,vm.deleteUsers=deleteUsers,vm.actionToClear=actionToClear,vm.checkAll=checkAll,vm.countLead=countLead,vm.renameGroup=renameGroup,vm.deleteFullGroup=deleteFullGroup,vm.allEmailPop=allEmailPop,vm.checkUncheck=checkUncheck,vm.resetCounter=resetCounter,vm.switchView=switchView,vm.loadCompetencyDetails=loadCompetencyDetails,vm.assignCompetency=assignCompetency,vm.removeCompetency=removeCompetency,vm.assignRemoveCompetencyModalSingle=assignRemoveCompetencyModalSingle,vm.assignRemoveCompetencyModalMultiple=assignRemoveCompetencyModalMultiple,function(){null!==$localStorage.get("spProfileTab")&&$localStorage.remove("spProfileTab")}()}angular.module("spApp").controller("profileListController",profileListController),profileListController.$inject=["$scope","ajaxService","$filter","$state","ngDialog","$timeout","sharedProperties","$rootScope","$localStorage"];
function pulseDetailsController($scope,$element,$attrs,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage,FileUploader,$filter){$scope.accountsListException=!1,$scope.updatedAccountListing=[],$scope.selectedAccountsCount=0,$scope.updatedListingIndex=0,$scope.accountList={},$scope.selectedCompanyIdList=[],$scope.allAccountsIdList=[],$scope.getDetailsException=!1,$scope.createNewPulse={},$scope.newPulse={},$scope.pulseEditing={},$scope.pulseEditing.status=!1,$scope.pulseIdStatus=!1,$scope.selectedAccountsDisplayList=[],$scope.showAccountsDisplayList=!1,$scope.pulseEnableEdit=function(s){"enable"===s?$scope.pulseEditing.status=!0:($scope.pulseEditing.status=!1,$scope.getPulseDetailsWithId()),$scope.accountList.search=null},$scope.getAccountList=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/hk/getCompanyList",method:"GET"}).then(function(response){if("true"===response.Success)$scope.accountsListException=!1,$scope.accountListing=response.companies,jQuery.each($scope.accountListing,function(i,j){$scope.updatedAccountListing.push(jQuery.extend({},$scope.accountListing[i],{accountSelectedStatus:!1})),$scope.allAccountsIdList.push($scope.accountListing[i].id)}),$scope.getPulseDetailsWithId();else{$scope.accountsListException=!0;for(var key in response.error)$scope.accountsListExceptionMsg=response.error[key]}})},$scope.addtoSelectedAccounts=function(id){var _temp=angular.copy($scope.updatedAccountListing);jQuery.each(_temp,function(i){return _temp[i].id===id?(_temp[i].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push(_temp[i].id),_temp[i].updatedListingIndex=$scope.updatedListingIndex++,$scope.updatedAccountListing=angular.copy(_temp),!1):void 0})},$scope.removeFromSelectedAccounts=function(id){var _temp=angular.copy($scope.updatedAccountListing);jQuery.each(_temp,function(i){return _temp[i].id===id?(_temp[i].accountSelectedStatus=!1,$scope.selectedAccountsCount-=1,$scope.selectedCompanyIdList.splice($scope.selectedCompanyIdList.indexOf(id),1),$scope.updatedAccountListing=angular.copy(_temp),!1):void 0})},$scope.removeAllSelectedAccounts=function(){var _temp=angular.copy($scope.updatedAccountListing);jQuery.each(_temp,function(i){_temp[i].accountSelectedStatus=!1,_temp[i].updatedListingIndex=null}),$scope.updatedAccountListing=angular.copy(_temp),$scope.selectedAccountsCount=0,$scope.selectedCompanyIdList=[]},$scope.addFilteredAccounts=function(){var selectedList=$filter("filter")($scope.updatedAccountListing,$scope.accountList.search);jQuery.each(selectedList,function(i){jQuery.each($scope.updatedAccountListing,function(j){selectedList[i].id===$scope.updatedAccountListing[j].id&&($scope.updatedAccountListing[j].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[j].id),$scope.updatedAccountListing[j].updatedListingIndex=$scope.updatedListingIndex++)})}),$scope.accountList.search=null},$scope.getPulseId=function(){var url=window.location.href,splitUrl=url.split("?")[1];"undefined"!=typeof splitUrl?($scope.urlPulseId=splitUrl.split("=")[1],$timeout(function(){$scope.pulseIdStatus=!0},100)):($scope.urlPulseId=null,$timeout(function(){$scope.pulseIdStatus=!1},100))},$scope.getPulseDetailsWithId=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/pulse/getDetails",data:$.param({pulseQuestionSetId:$scope.urlPulseId})}).then(function(response){if("true"===response.Success){$scope.showAccountsDisplayList=!1,$scope.getDetailsException=!1,$scope.pulseDetails=response.pulseQuestion,$scope.pulseNameDisplay=$scope.pulseDetails.name,$scope.newPulse.name=$scope.pulseNameDisplay,$scope.newPulse.questionSetType=$scope.pulseDetails.questionSetType;var loopCount=0;if($scope.pulseDetails.forAll===!1){$scope.selectedAccountsCount=0,$scope.selectedCompanyIdList=[],$scope.selectedAccountsDisplayList=[],$scope.newPulse.assignAccounts="Selected";var _temp=angular.copy($scope.updatedAccountListing);jQuery.each($scope.pulseDetails.companyId,function(i){jQuery.each(_temp,function(j){$scope.pulseDetails.companyId[i]===_temp[j].id&&(_temp[j].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push(_temp[j].id),_temp[j].updatedListingIndex=$scope.updatedListingIndex++,$scope.selectedAccountsDisplayList.push(_temp[j]))}),loopCount++}),loopCount===$scope.pulseDetails.companyId.length&&($scope.updatedAccountListing=angular.copy(_temp),$scope.showAccountsDisplayList=!0)}else $scope.newPulse.assignAccounts="All"}else{$scope.pulseNameDisplay=null,$scope.getDetailsException=!0;for(var key in response.error)$scope.getDetailsExceptionMsg=response.error[key]}})},$scope.updateThisPulse=function(fData){var _params;"All"===fData.assignAccounts?($scope.accList=$scope.allAccountsIdList,_params={name:fData.name,pulseQuestionSetId:$scope.urlPulseId,type:fData.questionSetType,isForAll:!0}):($scope.accList=$scope.selectedCompanyIdList,_params={name:fData.name,pulseQuestionSetId:$scope.urlPulseId,type:fData.questionSetType,companyIds:$scope.accList.join(),isForAll:!1}),this.createNewPulse.$valid&&$scope.accList.length>0?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/pulse/update",data:$.param(_params)}).then(function(response){if("true"===response.Success)$scope.updatePulseException=!1,$scope.pulseEnableEdit(),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Details</strong>",message:" updated successfully"});else{$scope.updatePulseException=!1;for(var key in response.error)$scope.updatePulseExceptionMsg=response.error[key]}}):$scope.createNewPulse.validationErrors=!0},$scope.pulseJsonDownload=function(){setTimeout(function(){window.location="/sp/sysAdmin/pulse/downloadJson?pulseQuestionSetId="+$scope.urlPulseId},100)},$scope.defaultPulse=function(_this){$scope.noChart($scope.pulseDrop,$scope.defaultPulseName)},$scope.increment=function(){return $scope.defaultPulseName++,!0},$scope.decrement=function(){return $scope.defaultPulseName--,!0},$scope.questionSet=function(){"questions"in $scope.questionList&&($scope.mapQuestionObject=$scope.questionList.questions[$scope.activePulse])},$scope.noChart=function(arrayList,index){arrayList.length&&$scope.noChartPulse(arrayList[index])},$scope.noChartPulse=function(keyName){$scope.activePulse=keyName,$scope.mapQuestionObject=$scope.questionList.questions[keyName]},$scope.pulsePreview=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/pulse/previewJson?pulseQuestionSetId="+$scope.urlPulseId,method:"GET"}).then(function(response){response&&($scope.questionList=response.pulseQuestionSetPreview,$scope.questionSet(),$scope.pulseDrop=$scope.questionList.categoryKeys,$timeout(function(){$scope.defaultPulseName=0},0),$scope.noChart($scope.pulseDrop,0),ngDialog.open({template:"/sp/resources/html/sysAdmin/pulse/pulse-preview.html",scope:$scope}))})},function(){$scope.getPulseId(),$scope.getAccountList()}()}angular.module("spApp").controller("pulseDetailsController",pulseDetailsController),pulseDetailsController.$inject=["$scope","$element","$attrs","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage","FileUploader","$filter"];
function pulseListingController($scope,$q,$element,$attrs,ajaxService,$location,$http,$state,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage){$scope.pulseMasterList=[],$scope.getAllError=!1,$scope.searchTag=[],$scope.pageSize=10,$scope.statusInclude=[],$scope.textSearching="",$scope.intialPageSize=10,$scope.load=!0,$scope.formatMonth=function(d){if(null!==d&&"undefined"!=typeof d){var splitDate=d.split(" "),formatMonth=splitDate[0].substr(0,3).toUpperCase(),formattedDate=formatMonth+" "+splitDate[1]+" "+splitDate[2];return formattedDate}},$scope.getNewPulseList=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/pulse/getAll"}).then(function(response){if("true"===response.Success)$scope.getAllError=!1,$scope.pulseMasterList=response.pulseQuestion,$scope.returnMemberList($scope.pageSize);else{$scope.getAllError=!0;for(var key in response.error)$scope.getAllErrorMsg=response.error[key]}})},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.returnMemberList($scope.pageSize)},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize))},$scope.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},$scope.returnMemberList=function(pageSize){if(!$scope.pulseMasterList.length)return!0;if($scope.searchTag.length&&!$scope.statusInclude.length&&($scope.pulseList=angular.copy($scope.newArr)),$scope.searchTag.length&&$scope.statusInclude.length){$scope.combineArray=[];for(var i=0;i<$scope.newArr.length;i++)for(var j=0;j<$scope.checkBox.length;j++)$scope.newArr[i].email===$scope.checkBox[j].email&&$scope.combineArray.push($scope.newArr[i]);$scope.pulseList=angular.copy($scope.combineArray)}!$scope.searchTag.length&&$scope.statusInclude.length&&($scope.pulseList=angular.copy($scope.checkBox)),$scope.searchTag.length||$scope.statusInclude.length||($scope.pulseList=angular.copy($scope.pulseMasterList)),$scope.pageSize=pageSize,pageSize>=$scope.pulseMasterList.length&&($scope.disabledInfinite=!0,$scope.pageSize=$scope.pulseMasterList.length),$scope.load&&($scope.lastPredicate="name",$scope.lastReverse=!1,$scope.loadBtnCLicked=!1,$scope.load=!1),$scope.loadBtnCLicked&&($scope.loadBtnCLicked=!1),$scope.order($scope.lastPredicate,$scope.lastReverse),$scope.pulseList=$scope.pulseList},$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.order=function(predicate,reverse){$scope.lastPredicate=predicate,$scope.lastReverse=reverse,$scope.pulseList=$filter("orderBy")($scope.pulseList,predicate,reverse)},$scope.resetfilter=function(allmembers){$scope.pageSize=$scope.intialPageSize,$scope.newArr=[],$scope.searchTag=[],$scope.tags=[],$scope.filter={},$scope.statusInclude=[],$scope.adminc=!1,$scope.leadC=!1,$scope.textSearching="",$scope.searchText="","undefined"!=typeof this.selectedSearch&&(this.selectedSearch.userStatusFormatted="",this.selectedSearch.hiringRoles=""),$scope.pulseList=angular.copy($scope.pulseMasterList),"undefined"!=typeof allmembers&&($scope.pageSize=$scope.pulseMasterList.length),angular.element($(".tags").find("input")).scope().newTag.text="",$scope.load=!0,$scope.disabledInfinite=!1,$rootScope.$broadcast("$scrollStart"),$scope.returnMemberList($scope.pageSize);var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")},$scope.updateStatusError=!1,$scope.updatePulseStatus=function(status,pid){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/pulse/updateStatus",data:$.param({pulseQuestionSetId:pid,status:status})}).then(function(response){if("true"===response.Success)$scope.updateStatusError=!1,ngDialog.close("ngdialog1"),$scope.getNewPulseList(),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Status</strong>",message:" updated successfully"});else{$scope.updateStatusError=!0;for(var key in response.error)$scope.updateStatusErrorMsg=response.error[key];ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.updateStatusErrorMsg})}})},$scope.deleteConfirm=function(d){$scope.afid=d,ngDialog.open({template:"/sp/resources/html/sysAdmin/pulse/deleteConfirmation.html",scope:$scope})},function(){var growlNotification=$localStorage.get("gNotify");null!==growlNotification&&"undefined"!=typeof growlNotification&&("AddPulse"===growlNotification&&$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Pulse</strong>",message:" created successfully"}),setTimeout(function(){$localStorage.remove("gNotify")},1e3)),$scope.getNewPulseList()}()}angular.module("spApp").controller("pulseListingController",pulseListingController),pulseListingController.$inject=["$scope","$q","$element","$attrs","ajaxService","$location","$http","$state","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage"];
function pulseController($scope,ajaxService,ngDialog,sharedProperties,$rootScope,$localStorage,$timeout){function getPulseRequest(pulseResultId){ajaxService.getAjaxResponse({url:vm.config.getPulseRequest}).then(function(response){if("true"===response.Success)if(vm.getPulseRequestResponse=response.pulseResults,vm.pulseNameIdMap=response.question,vm.showDefault=vm.getPulseRequestResponse.length?!0:!1,vm.showDefault){for(var i=0;i<vm.getPulseRequestResponse.length;i++)for(var j=0;j<vm.pulseNameIdMap.length;j++)if(vm.pulseNameIdMap[j].id===vm.getPulseRequestResponse[i].pulseQuestionSetId){var index=vm.executingPulseDropDown.indexOf(vm.pulseNameIdMap[j].name);-1!==index?vm.pulseRequestResponse[vm.pulseNameIdMap[j].name].push(vm.getPulseRequestResponse[i]):(vm.executingPulseDropDown.push(vm.pulseNameIdMap[j].name),vm.categoryKeysSlot.push(vm.pulseNameIdMap[j].categoryKeys),vm.pulseRequestResponse[vm.pulseNameIdMap[j].name]=[],vm.pulseRequestResponse[vm.pulseNameIdMap[j].name].push(vm.getPulseRequestResponse[i])),!vm.startingPointFound&&vm.getPulseRequestResponse[i].inProgress&&(vm.startingPointFound=!0,vm.objectIndex=vm.pulseNameIdMap[j].name,vm.inProgressObject.push(vm.objectIndex),vm.inProgressObject.push(vm.getPulseRequestResponse[i].id))}if(!vm.objectIndex)for(var z=0;z<vm.pulseNameIdMap.length;z++)vm.pulseNameIdMap[z].id===vm.getPulseRequestResponse[0].pulseQuestionSetId&&(vm.objectIndex=vm.pulseNameIdMap[z].name);vm.questionSetStackquestionSetStack=vm.objectIndex,vm.defaultQuestionSetSelected(vm.objectIndex),createDateDropDown(),vm.getGroupData(),createSubsetRecord(vm.objectIndex,"false")}else vm.getQuestionsSet(createNewPulseQuestionSet);else if(null!=response.error){for(var key in response.error)vm.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:vm.errorMessage})}})}function createDateDropDown(){vm.dateList=[],vm.storeAllIndex=[];for(var i=0;i<vm.pulseRequestResponse[vm.objectIndex].length;i++)vm.dateList.push(vm.pulseRequestResponse[vm.objectIndex][i]),vm.storeAllIndex.push(vm.pulseRequestResponse[vm.objectIndex][i].id);$timeout(function(){vm.groupCollector=0,vm.selectedDate=vm.dateList[0].id},0)}function getGroupData(){return vm.groupName.length?!0:void ajaxService.getAjaxResponse({url:vm.config.getGroupData}).then(function(response){"true"===response.Success&&(vm.groupName=response.groupInfoList.length?vm.createGroupName(response.groupInfoList):["All Groups"])})}function createSubsetRecord(index,result){var groupName="";if(0!==vm.groupIndex&&(groupName=vm.groupName[vm.groupIndex]),"undefined"!=typeof result&&"false"===result){if(vm.subsetRecord=null===vm.pulseRequestResponse[index][vm.dateIndex].pulseScore?vm.fetchResult(vm.pulseRequestResponse[index][vm.dateIndex].id,groupName,index):vm.pulseRequestResponse[index][vm.dateIndex].pulseScore,null!=vm.subsetRecord){var currentSelectedObject=vm.executingPulseDropDown.indexOf(vm.objectIndex),categoryKeysSeleted=vm.categoryKeysSlot[currentSelectedObject];getMapResult(vm.subsetRecord,categoryKeysSeleted[0])}}else"undefined"!=typeof result&&"true"===result&&(vm.subsetRecord=vm.fetchResult(vm.pulseRequestResponse[index][vm.dateIndex].id,groupName,index))}function getQuestionsSet(fn){ajaxService.getAjaxResponse({url:vm.config.getQuestionsSet}).then(function(response){if("true"===response.Success)vm.questionSetStack=response.pulseQuestion,null!==fn&&"function"==typeof fn&&fn();else if(null!=response.error){for(var key in response.error)vm.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:vm.errorMessage})}})}function fetchResult(pulseResultId,groupName,index){ajaxService.getAjaxResponse({url:vm.config.fetchResult,data:$.param({pulseResultId:pulseResultId,groupName:"All Groups"===groupName?"":groupName})}).then(function(response){if("true"===response.Success){if(""!==groupName)for(var i=0;i<vm.pulseRequestResponse[index].length;i++)vm.dateIndex!==i&&(vm.pulseRequestResponse[index][i].pulseScore=null);vm.pulseRequestResponse[index][vm.dateIndex].pulseScore=response.pulseResults.pulseScore,vm.pulseRequestResponse[index][vm.dateIndex].numberOfRespondents=response.pulseResults.numberOfRespondents,vm.pulseRequestResponse[index][vm.dateIndex].numberOfMembers=response.pulseResults.numberOfMembers,vm.subsetRecord=vm.pulseRequestResponse[index][vm.dateIndex].pulseScore;var currentSelectedObject=vm.executingPulseDropDown.indexOf(vm.objectIndex),categoryKeysSeleted=vm.categoryKeysSlot[currentSelectedObject];getMapResult(vm.subsetRecord,categoryKeysSeleted[0])}else if(null!=response.error){for(var key in response.error)vm.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:vm.errorMessage})}})}function createNewPulseQuestionSet(){vm.questionSetStackquestionSetStack=vm.questionSetStack[0],vm.defaultQuestionSetSelected(vm.questionSetStackquestionSetStack)}function resetToInProgress(){vm.dateIndex=0,vm.groupIndex=0,vm.objectIndex=vm.inProgressObject[0],vm.questionSetStackquestionSetStack=vm.objectIndex,vm.defaultQuestionSetSelected(vm.objectIndex),createDateDropDown(),vm.getGroupData(),createSubsetRecord(vm.objectIndex,"false")}function preChangeMode(){vm.questionSetStack.length?changeMode():vm.getQuestionsSet(changeMode)}function changeMode(){vm.showDefault=!1,vm.defaultQuestionSetSelected(vm.questionSetStack[0]),vm.questionSetStackquestionSetStack=vm.questionSetStack[0],vm.defaultDropIndex=0,vm.inviteError=!1}function resultMode(){vm.showDefault=!0,vm.questionSetStackquestionSetStack=vm.objectIndex,vm.questionDropChanged()}function createGroupName(list){vm.groupName=["All Groups"];for(var i=0;i<list.length;i++)vm.groupName.push(list[i].name);return vm.groupName}function defaultQuestionSetSelected(questionSet,index){if(vm.getQuestions(questionSet),"undefined"!=typeof index)for(var i=0;i<vm.questionSetStack.length;i++)if(vm.questionSetStack[i].id===questionSet.id){vm.defaultDropIndex=i;break}}function getQuestions(parameter){vm.questionList=[];var param=vm.showDefault===!0?vm.pulseRequestResponse[vm.objectIndex][vm.dateIndex].pulseQuestionSetId:parameter.id;ajaxService.getAjaxResponse({url:vm.config.getQuestions,data:$.param({pulseQuestionSetId:param})}).then(function(response){if("true"===response.Success)vm.questionList=response.pulseQuestion,vm.questionSet(),vm.showDefault||(vm.pulseDrop=vm.questionList.categoryKeys,$timeout(function(){vm.defaultPulseName=0},0),noChart(vm.pulseDrop,0));else if(null!=response.error){for(var key in response.error)vm.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:vm.errorMessage})}})}function noChart(arrayList,index){arrayList.length&&(vm.activePulse=arrayList[index],vm.mapQuestionObject=vm.questionList.questions[arrayList[index]])}function increment(){return vm.defaultPulseName++,!0}function decrement(){return vm.defaultPulseName--,!0}function defaultPulse(_this){noChart(vm.pulseDrop,vm.defaultPulseName)}function questionSet(){"questions"in vm.questionList&&(vm.mapQuestionObject=vm.questionList.questions[vm.activePulse])}function getMapResult(arrayList,index){if(vm.kyz=Object.keys(arrayList),vm.kyz.length){var startIndex=Object.keys(vm.subsetRecord).indexOf(index);vm.mapResponse(vm.kyz[startIndex])}}function mapResponse(keyName,index){keyName in vm.subsetRecord&&(vm.activePulse=keyName,vm.mapResponseObject=vm.subsetRecord[keyName]);var obj=$(".overall-score-list").find("li:eq("+index+")");$(".overall-score-list").find("li").removeClass("active"),obj.length?$(".overall-score-list").find("li:eq("+index+")").addClass("active"):$(".overall-score-list").find("li:eq(0)").addClass("active"),vm.questionSet()}function dateChanged(_this){null!==this.selectedDate&&(vm.dateIndex=vm.storeAllIndex.indexOf(this.selectedDate),createSubsetRecord(vm.objectIndex,"false"))}function groupChanged(_this){vm.groupIndex=this.groupCollector,createSubsetRecord(vm.objectIndex,"true")}function questionSetChanged(){vm.objectIndex=vm.questionSetStackquestionSetStack,vm.questionDropChanged()}function questionDropChanged(){vm.dateIndex=0,vm.groupIndex=0,vm.defaultQuestionSetSelected(vm.objectIndex),createDateDropDown(),vm.getGroupData(),createSubsetRecord(vm.objectIndex,"false")}function startNewPulsePop(){ngDialog.open({template:vm.config.startNewPulsePopDialog,scope:$scope})}function startPulseFormSubmit(form){form.$valid?ajaxService.getAjaxResponse({url:vm.config.startPulseFormSubmit,data:$.param({pulseQuestionSetId:form.pulse_category_questionsSet.$viewValue.id,startDate:form.startDate.$viewValue,endDate:form.endDate.$viewValue})}).then(function(response){if("true"===response.Success)sharedProperties.fireAnalyticsEvent("Pulse | Start a new Pulse","N/A"),window.location.reload();else if(null!=response.error){for(var key in response.error)vm.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:vm.errorMessage})}}):vm.inviteError=!0}function cancelPulse(pulseRequestId,save){ajaxService.getAjaxResponse({url:vm.config.cancelPulse,data:$.param({pulseRequestId:pulseRequestId,saveResults:save})}).then(function(response){if("true"===response.Success)sharedProperties.fireAnalyticsEvent("Pulse | Cancel",save?"Save Results":"Discard Results"),window.location.reload();else if(null!=response.error){ngDialog.close("ngdialog1");for(var key in response.error)vm.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:vm.errorMessage})}})}function sendReminderPop(idToPass){vm.idToPass=idToPass,ngDialog.open({template:vm.config.pulseReminderDialog,scope:$scope})}function cancelPop(idToCancel){vm.idToCancel=idToCancel,ngDialog.open({template:vm.config.cancelSpDilaog,scope:$scope})}function pulseSendReminder(pulseRequestId){ajaxService.getAjaxResponse({url:vm.config.pulseSendReminder,data:$.param({pulseRequestId:pulseRequestId})}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:"Sent Successfully"}),sharedProperties.fireAnalyticsEvent("Pulse | Send Reminder","N/A");else if(null!=response.error){ngDialog.close("ngdialog1");for(var key in response.error)vm.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:vm.errorMessage})}})}function seletedPulseName(){for(var i=0;i<vm.questionSetStack.length;i++)if(vm.questionSetStack[i].id===vm.questionSetStackquestionSetStack)return vm.questionSetStack[i].name}var vm=this;vm.getPulseRequestResponse=[],vm.dateList=[],vm.kyz=[],vm.mapQuestionObject=[],vm.subsetRecord="",vm.activePulse="",vm.lastGroup="",vm.dateIndex=0,vm.groupIndex=0,vm.objectIndex=0,vm.groupName=[],vm.inviteError=!1,vm.hideStart=!1,vm.questionSetStack=[],vm.selectedDate="",vm.groupCollector="";var d=new Date;vm.fromDate=new Date,vm.endDate=d.setDate(d.getDate()+1),vm.maxDate=d.setDate(d.getDate()+14),vm.executingPulseDropDown=[],vm.startingPointFound=!1,vm.pulseRequestResponse={},vm.defaultDropIndex=0,vm.inProgressObject=[],vm.categoryKeysSlot=[],vm.config={getPulseRequest:"/sp/pulse/getRequests",getGroupData:"/sp/admin/group/all",getQuestionsSet:"/sp/pulse/getQuestionSets",fetchResult:"/sp/pulse/getScore",getQuestions:"/sp/pulse/getQuestions",startNewPulsePopDialog:"/sp/pulse/startNewPulse",startPulseFormSubmit:"/sp/pulse/start",cancelPulse:"/sp/pulse/cancelPulse",pulseReminderDialog:"/sp/pulse/pulseReminder",cancelSpDilaog:"/sp/pulse/cancelSP",pulseSendReminder:"/sp/pulse/sendReminder"},vm.getPulseRequest=getPulseRequest,vm.getGroupData=getGroupData,vm.getQuestionsSet=getQuestionsSet,vm.fetchResult=fetchResult,vm.resetToInProgress=resetToInProgress,vm.preChangeMode=preChangeMode,vm.resultMode=resultMode,vm.createGroupName=createGroupName,vm.defaultQuestionSetSelected=defaultQuestionSetSelected,vm.getQuestions=getQuestions,vm.increment=increment,vm.decrement=decrement,vm.defaultPulse=defaultPulse,vm.questionSet=questionSet,vm.mapResponse=mapResponse,vm.dateChanged=dateChanged,vm.groupChanged=groupChanged,vm.questionSetChanged=questionSetChanged,vm.questionDropChanged=questionDropChanged,vm.startNewPulsePop=startNewPulsePop,vm.startPulseFormSubmit=startPulseFormSubmit,vm.cancelPulse=cancelPulse,vm.sendReminderPop=sendReminderPop,vm.cancelPop=cancelPop,vm.pulseSendReminder=pulseSendReminder,vm.seletedPulseName=seletedPulseName}function pulseQuestionController($scope,ajaxService,sharedProperties,$localStorage){function startQuestion(){ajaxService.getAjaxResponse({url:vm.config.startQuestion,data:$.param({pulseRequestId:sharedProperties.getParam("pulseRequestId")})}).then(function(response){"true"===response.Success?(vm.getQuestion=response.pulseQuestion,vm.categoryQuestion=Object.keys(vm.getQuestion.questions),vm.createQuestionSet()):null!=response.error&&(window.location.href="/sp/linkExpired")})}function createQuestionSet(){vm.questionSet=vm.getAllQuestionSet(vm.getQuestion.questions),vm.createSetsToDisplay(vm.questionSet,vm.getQuestion.questions)}function getAllQuestionSet(arrayList){return Object.keys(arrayList)}function createSetsToDisplay(keyName,arrayList){vm.createSubset=[];for(var i=0;i<keyName.length;i++)if(keyName[i]in arrayList)if(arrayList[keyName[i]].length>vm.questionMaxSize)vm.spliceArray(arrayList[keyName[i]],vm.questionMaxSize,keyName[i]);else{var ans=vm.createAnswerSheet(arrayList[keyName[i]].length);vm.createSubset.push({name:keyName[i],result:arrayList[keyName[i]],answer:ans,sectionNumber:vm.categoryQuestion.indexOf(keyName[i])+1,lengthQuestion:""}),vm.keyNameToPrint.push(keyName[i])}vm.startRepeat=angular.copy(vm.createSubset)}function createAnswerSheet(size){for(var tempArray=[],i=0;size>i;i++)tempArray.push(null);return tempArray}function inputStyleCheck(searchIndex,answerValue,answerIndex){if(vm.startRepeat[searchIndex].answer[answerIndex]=answerValue,"undefined"!=typeof vm.errorScope&&vm.errorScope.length)for(var _this=$(".pulse-question-list"),i=0;i<vm.errorScope.length;i++)null!=vm.startRepeat[vm.currentIndex].answer[vm.errorScope[i]]&&_this.find("li.realState:eq("+vm.errorScope[i]+")").removeClass("showError")}function spliceArray(arrayList,spliceIndex,keyName){for(var i=0;i<arrayList.length;i+=spliceIndex){vm.temparray=arrayList.slice(i,i+spliceIndex);var ans=vm.createAnswerSheet(vm.temparray.length);vm.createSubset.push({name:keyName,lengthQuestion:"",result:vm.temparray,answer:ans,sectionNumber:vm.categoryQuestion.indexOf(keyName)+1,subSection:Math.floor(i/vm.questionMaxSize)+1,total:Math.ceil(arrayList.length/vm.questionMaxSize)}),vm.keyNameToPrint.push(keyName)}}function setIndex(currentIndex,argument,status){if(status){var loop=vm.startRepeat[currentIndex].answer;vm.errorScope=[];for(var i=0;i<loop.length;i++)null===loop[i]&&vm.errorScope.push(i);vm.errorScope.length?vm.showError(vm.errorScope,currentIndex):vm.currentIndex=argument}else vm.currentIndex=argument}function showError(errorArrayIndex,currentvalue){var _this=$(".pulse-question-list");_this.find("li.realState").removeClass("showError");for(var i=0;i<errorArrayIndex.length;i++)_this.find("li.realState:eq("+errorArrayIndex[i]+")").addClass("showError")}function isItChecked(currentIndex,index,row){var checkUncheck=vm.startRepeat[currentIndex].answer[row];return null!=checkUncheck&&checkUncheck===index?!0:!1}function submitRequest(currentIndex){var loop=vm.startRepeat[currentIndex].answer;vm.errorScope=[];for(var i=0;i<loop.length;i++)null===loop[i]&&vm.errorScope.push(i);vm.errorScope.length?vm.showError(vm.errorScope,currentIndex):vm.callSubmit()}function callSubmit(){vm.clubResult=[];for(var i=0;i<vm.startRepeat.length;i++)vm.isItAlreadyInArray(vm.clubResult,vm.startRepeat[i])&&vm.clubResult.push({categoryName:vm.startRepeat[i].name,questionSelectionIndex:vm.startRepeat[i].answer});ajaxService.getAjaxResponse({url:vm.config.callSubmit,data:vm.clubResult,headers:{"Content-Type":"application/json"}}).then(function(response){if("true"===response.Success)$localStorage.set("pulseDone","true"),sharedProperties.fireAnalyticsEvent("Pulse | Submitted Pulse data","N/A"),window.location.href="/sp";else if(null!=response.error){for(var key in response.error)vm.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:vm.errorMessage})}})}function isItAlreadyInArray(clubResult,returnResult){if(clubResult.length){for(var i=0;i<clubResult.length;i++)if(returnResult.name===clubResult[i].categoryName)return vm.clubResult[i].questionSelectionIndex=vm.clubResult[i].questionSelectionIndex.concat(returnResult.answer),!1;return!0}return!0}var vm=this;vm.getQuestion=[],vm.currentIndex=0,vm.questionMaxSize=5,vm.keyNameToPrint=[],vm.clubResult=[],vm.config={startQuestion:"/sp/pulse/getQuestions",callSubmit:"/sp/pulseUser/saveAssessment?pulseRequestId="+sharedProperties.getParam("pulseRequestId")},vm.startQuestion=startQuestion,vm.createQuestionSet=createQuestionSet,vm.getAllQuestionSet=getAllQuestionSet,vm.createSetsToDisplay=createSetsToDisplay,vm.createAnswerSheet=createAnswerSheet,vm.inputStyleCheck=inputStyleCheck,vm.spliceArray=spliceArray,vm.setIndex=setIndex,vm.showError=showError,vm.isItChecked=isItChecked,vm.submitRequest=submitRequest,vm.callSubmit=callSubmit,vm.isItAlreadyInArray=isItAlreadyInArray}angular.module("spApp").controller("pulseController",pulseController),angular.module("spApp").controller("pulseQuestionController",pulseQuestionController),pulseController.$inject=["$scope","ajaxService","ngDialog","sharedProperties","$rootScope","$localStorage","$timeout"],pulseQuestionController.$inject=["$scope","ajaxService","sharedProperties","$localStorage"];
function relationshipManagerController($scope,$element,$attrs,$http,$timeout,ajaxService,$rootScope,$localStorage,ngDialog,sharedProperties){$scope.selectedCandidate={},$scope.memberMasterList={},$scope.validMemberList=[],$scope.candidateMasterList={},$scope.validCandidateList=[],$scope.selectedMemberDetails={},$scope.candidateProfileDetails={},$scope.memberProfileDetails={},$scope.candidateAdvise={},$scope.memberAdvise={},$scope.candidateAvoidFormatted=[],$scope.resultTabs={},$scope.personalityFlags=[],$scope.cachedAdvisorData=[],$scope.showMemberListingWidget={},$scope.selectedMember={},$scope.selectedMember.left={},$scope.selectedMember.right={},$scope.showMemberListingWidget.right=!1,$scope.showMemberListingWidget.left=!1,$scope.memberSelected={},$scope.memberSelected.right=!1,$scope.memberSelected.left=!1,$scope.showContent=!1,$scope.resultTabs.leftSelected=0,$scope.resultTabs.rightSelected=0,$scope.serverException=!1,$scope.mobileControls={},$scope.mobileControls.display=!1,$scope.memberCountException=!1,$scope.sResizeFlag=0,$scope.lResizeFlag=0,$scope.viewMode={list:!0,chart:!1},$scope.cachedUSerEmails=null,$scope.matchPercent={},$scope.matchPercent.primary=!0,$scope.switchToUser1=!0,$scope.prismLabelContent=!1,$scope.prismLabelContent1=!1,$scope.label="",$scope.winWidth=jQuery(window).width(),jQuery(window).resize(function(){$scope.winWidth=jQuery(window).width()}),$scope.labelsReset=function(){jQuery(".outer-labels").find("p").removeClass("active"),$scope.prismLabelContent=!1,$scope.prismLabelContent1=!1,$scope.label=""},$scope.getAllMemberDetails=function(){ajaxService.getAjaxResponse({url:"/sp/relationship/getMembers"}).then(function(response){if("true"===response.Success)$scope.serverException=!1,$scope.memberMasterList=response.memberList,$scope.memberMasterList.length>1?($scope.memberCountException=!1,jQuery.each($scope.memberMasterList,function(i,j){var newList=jQuery.extend({},$scope.memberMasterList[i],{selectedMember:!1,selectedSide:{left:!1,right:!1}});$scope.validMemberList.push(newList)})):$scope.memberCountException=!0;else{$scope.compareToolReset(),$scope.serverException=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}($scope.serverException||$scope.memberCountException)&&($scope.memberCountException=!0)})},$scope.showDropdownWidget=function(side){"right"===side?($scope.showMemberListingWidget.right=!$scope.showMemberListingWidget.right,$scope.showMemberListingWidget.left=!1,$timeout(function(){jQuery(window).width()<768&&jQuery("html, body").animate({scrollTop:325})},300)):($scope.showMemberListingWidget.left=!$scope.showMemberListingWidget.left,$scope.showMemberListingWidget.right=!1,$timeout(function(){jQuery(window).width()<768&&jQuery("html, body").animate({scrollTop:325})},300))},$scope.compareToolReset=function(){$scope.viewMode={list:!0,chart:!1},$scope.switchToUser1=!0,$scope.cachedUSerEmails=null,$scope.matchPercent.primary=!0,$scope.resultTabs={},$scope.personalityFlags=[],$scope.cachedAdvisorData=[],$scope.resultTabs.leftSelected=0,$scope.resultTabs.rightSelected=0,$scope.showContent=!1,$scope.showMemberListingWidget.right=!1,$scope.memberSelected.right=!1,$scope.showMemberListingWidget.left=!1,$scope.memberSelected.left=!1,$scope.selectedMember.left.email=null,$scope.selectedMember.right.email=null,$scope.mobileControls.display=!1,jQuery.each($scope.validMemberList,function(j){$scope.validMemberList[j].selectedMember=!1,$scope.validMemberList[j].selectedSide.right=!1,$scope.validMemberList[j].selectedSide.left=!1}),$scope.sResizeFlag=0,$scope.lResizeFlag=0,$scope.winWidth<768?$rootScope.setBoxSizes("#dd-wrap",".dd","full"):jQuery("body").find("#dd-wrap").find(".dd").removeAttr("style"),sharedProperties.fireAnalyticsEvent("Prism RA | Reset","N/A")},$scope.updateCompareMember=function(i,side){$scope.labelsReset(),$scope.cachedUSerEmails=null,$scope.showMemberListingWidget[side]=!1,$scope.personalityFlags=[],$scope.cachedAdvisorData=[],$scope.resultTabs.leftSelected=0,$scope.resultTabs.rightSelected=0,jQuery.each($scope.validMemberList,function(j){$scope.validMemberList[j].selectedSide[side]===!0&&($scope.validMemberList[j].selectedMember=!1,$scope.validMemberList[j].selectedSide[side]=!1)}),jQuery.each($scope.validMemberList,function(j){return $scope.validMemberList[j].email===i?($scope.validMemberList[j].selectedMember=!0,$scope.validMemberList[j].selectedSide[side]=!0,$scope.memberSelected[side]=!0,$scope.selectedMemberDetails[side]=$scope.validMemberList[parseInt(j)],$scope.selectedMember[side].email=$scope.validMemberList[parseInt(j)].email,void($scope.viewMode.list===!0?$scope.compareMembers($scope.selectedMember.left.email,$scope.selectedMember.right.email,{user1PersonalityType:"Primary",user2PersonalityType:"Primary"}):$scope.getCompareCharts($scope.selectedMember.left.email,$scope.selectedMember.right.email))):void 0}),$scope.winWidth<768&&$timeout(function(){$rootScope.setBoxSizes("#dd-wrap",".dd","full")},300),sharedProperties.fireAnalyticsEvent("Prism RA | Member Selected on "+side,"N/A")},$scope.compareMembers=function(c,m,pTypes){if($scope.memberSelected.left&&$scope.memberSelected.right){var data=$.extend({},{user1:c,user2:m},pTypes),_o={url:"/sp/relationship/getReport",data:$.param(data).replace(/%40/g,"@")};ajaxService.getAjaxResponse(_o).then(function(response){if("true"===response.Success)$scope.serverException=!1,$scope.cacheResults(data,response),$scope.winWidth>767?($scope.showContent=!0,$scope.mobileControls.display=!1):($scope.showContent=!1,$scope.mobileControls.display=!0,$scope.switchToUser1=!0,setTimeout(function(){$rootScope.setBoxSizes(".mobile-tabs",".mtabs")},200)),setTimeout(function(){$rootScope.setBoxSizes(".results-wrapper",".results-content")},500);else{$scope.compareToolReset(),$scope.serverException=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})}},$scope.chartsException=!1,$scope.getCompareCharts=function(u1,u2){$scope.memberSelected.left&&$scope.memberSelected.right&&($scope.matchPercent.primary=!0,null===$scope.cachedUSerEmails&&($scope.cachedUSerEmails=u1+u2,ajaxService.getAjaxResponse({url:"/sp/relationship/getCompare",data:$.param({user1:u1,user2:u2})}).then(function(response){if("true"===response.Success)$scope.chartsException=!1,$scope.compareProfileData=response,$scope.cacheCompareResponse=response,$scope.candidateProfileDetails=response.Analysis1,$scope.memberProfileDetails=response.Analysis2,$scope.matchPercentageData=response.matchPercent,$scope.winWidth>767?($scope.showContent=!0,$scope.mobileControls.display=!1):($scope.showContent=!1,$scope.mobileControls.display=!0,$scope.switchToUser1=!0,setTimeout(function(){$rootScope.setBoxSizes(".mobile-tabs",".mtabs")},200)),$scope.personalityFormatted={candidate:{primary:$rootScope.pullInterNationalization("profileKeys."+$scope.candidateProfileDetails.personality.Primary.personalityType.trim()),pressure:$rootScope.pullInterNationalization("profileKeys."+$scope.candidateProfileDetails.personality.UnderPressure.personalityType.trim())},member:{primary:$rootScope.pullInterNationalization("profileKeys."+$scope.memberProfileDetails.personality.Primary.personalityType.trim()),pressure:$rootScope.pullInterNationalization("profileKeys."+$scope.memberProfileDetails.personality.UnderPressure.personalityType.trim())}},$timeout(function(){$scope.dataAvailablity=!0},300);else{$scope.chartsException=!0,$scope.compareToolReset();for(var key in response.error)$scope.chartsExceptionMsg=response.error[key]}})))},$scope.cacheResults=function(p,r){var pType=p.user1PersonalityType.charAt(0)+p.user2PersonalityType.charAt(0),existingFlag=$.inArray(pType,$scope.personalityFlags);-1===existingFlag&&($scope.personalityFlags.push(pType),$scope.cachedAdvisorData[pType]=r,$scope.candidateAdvise=$scope.cachedAdvisorData[pType].primary,$scope.memberAdvise=$scope.cachedAdvisorData[pType].secondary)},$scope.formatList=function(list){if("undefined"!=typeof list){var rawList=list.split("</p>"),listHTML="",counter=0;if(jQuery.each(rawList,function(i){"undefined"!=typeof rawList[i].split("<p>")[1]&&(listHTML+="<li>"+rawList[i].split("<p>")[1]+"</li>"),counter++}),counter===rawList.length)return listHTML}},$scope.changeContentTabs=function(s,i){"left"===s?($scope.resultTabs.leftSelected=parseInt(i),sharedProperties.fireAnalyticsEvent("Prism RA | Switch Profile type View on left",0===$scope.resultTabs.leftSelected?"Primary":"UnderPressure")):($scope.resultTabs.rightSelected=parseInt(i),sharedProperties.fireAnalyticsEvent("Prism RA | Switch Profile type View on right",0===$scope.resultTabs.rightSelected?"Primary":"UnderPressure"));var u1PType=0===$scope.resultTabs.leftSelected?"Primary":"UnderPressure",u2PType=0===$scope.resultTabs.rightSelected?"Primary":"UnderPressure",pFlag=u1PType.charAt(0)+u2PType.charAt(0),existingFlag=$.inArray(pFlag,$scope.personalityFlags);-1===existingFlag?$timeout(function(){$scope.compareMembers($scope.selectedMember.left.email,$scope.selectedMember.right.email,{user1PersonalityType:u1PType,user2PersonalityType:u2PType})},100):($scope.candidateAdvise=$scope.cachedAdvisorData[pFlag].primary,$scope.memberAdvise=$scope.cachedAdvisorData[pFlag].secondary)},$scope.changeViewMode=function(v){$scope.labelsReset(),$scope.showMemberListingWidget.right=!1,$scope.showMemberListingWidget.left=!1,"list"===v?($scope.viewMode.list=!0,$scope.viewMode.chart=!1,$scope.compareMembers($scope.selectedMember.left.email,$scope.selectedMember.right.email,{user1PersonalityType:"Primary",user2PersonalityType:"Primary"}),sharedProperties.fireAnalyticsEvent("Prism RA | Click Standard View","N/A")):($scope.viewMode.list=!1,$scope.viewMode.chart=!0,$scope.getCompareCharts($scope.selectedMember.left.email,$scope.selectedMember.right.email),sharedProperties.fireAnalyticsEvent("Prism RA | Click Charts View","N/A"))},$scope.initCandiateCompare=function(){$scope.getAllMemberDetails()},$scope.getMobileReport=function(v){$scope.winScreenHeight=jQuery(window).height()+"px",v===!0?ngDialog.open({template:"/sp/resources/html/tools/relationship-manager/mobile-report.html",scope:$scope,className:"ngdialog-theme-default no-padding-top"}):ngDialog.open({template:"/sp/resources/html/tools/relationship-manager/mobile-charts.html",scope:$scope,className:"ngdialog-theme-default no-padding-top"})},jQuery(window).resize(function(){$scope.winWidth<768?($scope.memberSelected.left&&$scope.memberSelected.right&&0===$scope.sResizeFlag&&$scope.mobileControls.display===!1&&($scope.showContent=!1,$timeout(function(){$scope.mobileControls.display=!0},500),$scope.sResizeFlag=1,$scope.lResizeFlag=0),$rootScope.setBoxSizes("#dd-wrap",".dd","full")):($scope.memberSelected.left&&$scope.memberSelected.right&&0===$scope.lResizeFlag&&($timeout(function(){$scope.viewMode.list=!0,$scope.viewMode.chart=!1,$scope.cachedUSerEmails=null,$scope.mobileControls.display=!1,$scope.showContent=!0},500),$scope.sResizeFlag=0,$scope.lResizeFlag=1),ngDialog.close("ngdialog1"),jQuery("body").find("#dd-wrap").find(".dd").removeAttr("style"))}),$scope.printPage=function(f){f===!0&&(sharedProperties.fireAnalyticsEvent("Prism RA | Print to PDF","N/A"),setTimeout(function(){window.print()},500))},$scope.initCandiateCompare()}angular.module("spApp").controller("relationshipManagerController",relationshipManagerController),relationshipManagerController.$inject=["$scope","$element","$attrs","$http","$timeout","ajaxService","$rootScope","$localStorage","ngDialog","sharedProperties"];
function renewBusinessController($scope,$element,$attrs,$http,ngDialog,$timeout,ajaxService,$rootScope){$scope.priceFormatter=function(p){if("undefined"!=typeof p&&""!==p&&null!==p){var formattedPrice="$"+p.toFixed(2);return formattedPrice}},$scope.product={},$scope.promoApplied=!1,$scope.finalAmount=0,$scope.promo={},$scope.updatedPromoDetails={},$scope.updateCC={},$scope.activeMembers=0,$scope.renewBusiness={},$scope.account={},$scope.promoFormSubmitted=!1,$scope.promoError={},$scope.promoError.error=!1,$scope.dialogStatus={},$scope.timeout=0,$scope.submitDisabled=!1,$scope.pricing={},$scope.bBox={},$scope.getMemberCount=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/getActiveMemberCount"}).then(function(response){if("true"===response.Success)$scope.activeMembers=response.activeMembers,$scope.account.numAccounts=response.activeMembers;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getAcccountInfo=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/businessAccountDetails"}).then(function(response){if("true"===response.Success)$scope.accountDetails=response,$scope.renewalDate=response.account.productInfo.renewalDate;else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getPlanInfo=function(){ajaxService.getAjaxResponse({url:"/sp/signup/getProducts",data:$.param({productType:"BUSINESS"})}).then(function(response){if("true"===response.Success)$scope.products=response.products,$.each($scope.products,function(i){"YEARLY"===$scope.products[i].validityType&&($scope.annualProduct=$scope.products[i],$scope.pricing.yearlyUnitPrice=$scope.products[i].unitPrice),"MONTHLY"===$scope.products[i].validityType&&($scope.monthlyProduct=$scope.products[i],$scope.pricing.monthlyUnitPrice=$scope.products[i].unitPrice)}),$scope.getProductInfo();else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getProductInfo=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/getCurrentBusinessProductInfo"}).then(function(response){if("true"===response.Success){$scope.productInfoError=!1,$scope.submitDisabled=!1,$scope.product=response.product;var multiplier="YEARLY"===$scope.product.validityType?12:1;$scope.bBox.yearly="YEARLY"===$scope.product.validityType?!0:!1,"undefined"!=typeof response.promotion&&"undefined"!=typeof response.promotion.unitPrice?($scope.product.updatedUnitPrice=parseFloat(response.promotion.unitPrice).toFixed(2),$scope.promoApplied=!0,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.activeMembers*multiplier).toFixed(2)):($scope.product.updatedUnitPrice=parseFloat("YEARLY"===$scope.product.validityType?$scope.pricing.yearlyUnitPrice:$scope.pricing.monthlyUnitPrice).toFixed(2),$scope.promoApplied=!1,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.activeMembers*multiplier).toFixed(2))}else $scope.productInfoError=!0,$scope.submitDisabled=!0,jQuery("html, body").animate({scrollTop:0})})},$scope.paymentCalculator=function(empNo,action,type,event){var currentEmpNo=parseInt(empNo),updatedEmpNo=0,multiplier="YEARLY"===type?12:1;"undefined"==typeof event?currentEmpNo>=20&&"add"===action?(updatedEmpNo=parseInt(currentEmpNo+1),$scope.account.numAccounts=updatedEmpNo,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*updatedEmpNo*multiplier).toFixed(2)):currentEmpNo>20&&"remove"===action?(updatedEmpNo=parseInt(currentEmpNo-1),$scope.account.numAccounts=updatedEmpNo,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*updatedEmpNo*multiplier).toFixed(2)):($scope.account.numAccounts=parseInt($scope.account.minEmployee),$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.account.numAccounts*multiplier).toFixed(2)):/^[0-9\b]+$/g.test(empNo)&&empNo>=20?($scope.account.numAccounts=empNo,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.account.numAccounts*multiplier).toFixed(2),$timeout.cancel($scope.timeout)):($timeout.cancel($scope.timeout),$scope.timeout=$timeout(function(){$scope.account.numAccounts=20,$scope.finalAmount=parseFloat(20*$scope.product.updatedUnitPrice*multiplier).toFixed(2)},1500))},$scope.activatePromo=function(promoCode){if($scope.promoFormSubmitted=!1,$scope.promoError.error=!1,"undefined"!=typeof promoCode){var _params={code:promoCode,productId:$scope.product.id};ajaxService.getAjaxResponse({url:"/sp/signup/promotion",data:$.param(_params)}).then(function(response){"true"===response.Success?($scope.updatedPromoDetails=response.promotion,$scope.pricing.promoUnitPrice=parseFloat(response.promotion.unitPrice).toFixed(2),$scope.product.updatedUnitPrice=parseFloat(response.promotion.unitPrice).toFixed(2),$scope.promoApplied=!0,$scope.bBox.yearly===!0?$scope.finalAmount=parseFloat($scope.pricing.promoUnitPrice*$scope.account.numAccounts*12).toFixed(2):$scope.finalAmount=parseFloat($scope.pricing.promoUnitPrice*$scope.account.numAccounts*1).toFixed(2)):($scope.promoError.error=!0,$scope.promoError.msg=response.error)})}else $scope.promoFormSubmitted=!0},$scope.renewIndividualSubscription=function(fData){var _paramsUpdated,_params={},vCount=0;for(var k in fData)("default"===fData[k]||"default1"===fData[k])&&vCount++;_params=$scope.promoApplied===!1?{productId:$scope.product.id}:{productId:$scope.product.id,promotionId:$scope.updatedPromoDetails.id},$scope.updateCC.$valid&&0===vCount?(_paramsUpdated=$.extend({},_params,fData),ajaxService.getAjaxResponse({url:"/sp/admin/account/renewAccount",data:$.param(_paramsUpdated)}).then(function(response){if("true"===response.Success)$scope.dialogStatus.title="Subscription Renewal",$scope.dialogStatus.content="Subscription renewed successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/success-dialog.html",scope:$scope});else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})):$scope.updateCC.submitted=!0},$scope.deactivatePromo=function(){$scope.pricing.promoUnitPrice=0,$scope.bBox.yearly===!0?$scope.finalAmount=parseFloat($scope.pricing.yearlyUnitPrice*$scope.account.numAccounts*12).toFixed(2):$scope.finalAmount=parseFloat($scope.pricing.monthlyUnitPrice*$scope.account.numAccounts*1).toFixed(2),$scope.promoApplied=!1,$scope.promo.code=null},$scope.cancelRedirect=function(){window.location="/sp/admin/account/business"},$scope.renewBusinessSubscription=function(fData){var _paramsUpdated,_params={};_params=$scope.promoApplied===!1?{numAccounts:$scope.account.numAccounts,productId:$scope.product.id}:{numAccounts:$scope.account.numAccounts,productId:$scope.product.id,promotionId:$scope.updatedPromoDetails.id},$scope.submitDisabled===!1&&($scope.renewBusiness.$valid?(_paramsUpdated=$.extend({},_params,fData),ajaxService.getAjaxResponse({url:"/sp/admin/account/renewAccount",data:$.param(_paramsUpdated)}).then(function(response){if("true"===response.Success)$scope.dialogStatus.title="Subscription Renewal",$scope.dialogStatus.content="Subscription renewed successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/success-dialog.html",scope:$scope});else{$scope.submitException=!0;for(var key in response.error)$scope.submitExceptionMsg=response.error[key];jQuery("html, body").animate({scrollTop:0})}})):$scope.renewBusiness.submitted=!0)},$scope.changePlan=function(type){"YEARLY"===type?($scope.product.updatedUnitPrice=$scope.promoApplied===!0?$scope.pricing.promoUnitPrice:$scope.pricing.yearlyUnitPrice,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.account.numAccounts*12).toFixed(2),$scope.bBox.yearly=!0):($scope.product.updatedUnitPrice=$scope.promoApplied===!0?$scope.pricing.promoUnitPrice:$scope.pricing.monthlyUnitPrice,$scope.finalAmount=parseFloat($scope.product.updatedUnitPrice*$scope.account.numAccounts*1).toFixed(2),$scope.bBox.yearly=!1)},$scope.initRenewBusiness=function(){$scope.getMemberCount(),$scope.getPlanInfo(),$scope.getAcccountInfo()},$scope.initRenewBusiness()}angular.module("spApp").controller("Additional Member Accounts",renewBusinessController),renewBusinessController.$inject=["$scope","$element","$attrs","$http","ngDialog","$timeout","ajaxService","$rootScope"];
function renewIndividualController($scope,$element,$attrs,$http,ngDialog,$timeout,ajaxService){$scope.product={},$scope.promoApplied=!1,$scope.finalAmount=0,$scope.promo={},$scope.updatedPromoDetails={},$scope.updateCC={},$scope.dialogStatus={},$scope.promoError={},$scope.serverError=!1,$scope.getIndividualAccountInfo=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/individualAccountDetails"}).then(function(response){"true"===response.Success&&($scope.accountInfo=response)})},$scope.getProductInfo=function(){ajaxService.getAjaxResponse({url:"/sp/admin/account/getCurrentIndividualProductInfo"}).then(function(response){"true"===response.Success&&($scope.product=response.product,"undefined"!=typeof response.promotion&&"undefined"!=typeof response.promotion.unitPrice?($scope.product.updatedUnitPrice=parseFloat(response.promotion.unitPrice).toFixed(2),$scope.promoApplied=!0,$scope.finalAmount=parseFloat(12*$scope.product.updatedUnitPrice).toFixed(2)):($scope.product.updatedUnitPrice=parseFloat(response.product.unitPrice).toFixed(2),$scope.promoApplied=!1,$scope.finalAmount=parseFloat(12*$scope.product.updatedUnitPrice).toFixed(2)))})},$scope.activatePromo=function(promoCode){if($scope.promoDetails.$valid){var _params={code:promoCode,productId:$scope.product.id};ajaxService.getAjaxResponse({url:"/sp/signup/promotion",data:$.param(_params)}).then(function(response){"true"===response.Success?($scope.updatedPromoDetails=response.promotion,$scope.product.updatedUnitPrice=parseFloat(response.promotion.unitPrice).toFixed(2),$scope.promoApplied=!0,$scope.finalAmount=parseFloat(12*$scope.product.updatedUnitPrice).toFixed(2)):($scope.promoError.error=!0,$scope.promoError.msg=response.error,$scope.promo.code=null,$timeout(function(){$scope.promoError.error=!1},1500))})}else $scope.promoFormSubmitted=!0,$scope.promo.code=null},$scope.renewIndividualSubscription=function(fData){var _paramsUpdated,_params={},vCount=0;for(var k in fData)("default"===fData[k]||"default1"===fData[k])&&vCount++;_params=$scope.promoApplied===!1?{numAccounts:1,productId:$scope.product.id}:{numAccounts:1,productId:$scope.product.id,promotionId:$scope.updatedPromoDetails.id},$scope.updateCC.$valid&&0===vCount?(_paramsUpdated=$.extend({},_params,fData),ajaxService.getAjaxResponse({url:"/sp/admin/account/renewAccount",data:$.param(_paramsUpdated)}).then(function(response){if("true"===response.Success)$scope.dialogStatus.title="Subscription Renewal",$scope.dialogStatus.content="Subscription renewed successfully.",ngDialog.open({template:"/sp/resources/html/admin/account/success-dialog.html",scope:$scope});else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})):$scope.updateCC.submitted=!0},$scope.deactivatePromo=function(){$scope.product.updatedUnitPrice=parseFloat($scope.product.unitPrice).toFixed(2),$scope.finalAmount=parseFloat(12*$scope.product.updatedUnitPrice).toFixed(2),$scope.promoApplied=!1,$scope.promo.code=null},$scope.cancelRedirect=function(){window.location="/sp/admin/account/individual"},$scope.initRenewIndividual=function(){$scope.getIndividualAccountInfo(),$scope.getProductInfo()},$scope.initRenewIndividual()}angular.module("spApp").controller("Additional Member Accounts",renewIndividualController),renewIndividualController.$inject=["$scope","$element","$attrs","$http","ngDialog","$timeout","ajaxService"];
function resumeController($scope,ajaxService,ngDialog,$filter,sharedProperties,$timeout,ProfileDataService,$rootScope,$localStorage){$scope.createFormError=!1,$scope.itemPositioned=[],$scope.linkedIn=[],$scope.profileContentDisplay=!0,$scope.contactInfo=!1,$scope.coverLetter=!1,$scope.displayCover=!1,$scope.profile={},$scope.manageResumeLength=0;var date=new Date;$scope.fullmonth=date.getMonth(),$scope.fullyear=date.getFullYear(),$scope.getAllResume=function(){ajaxService.getAjaxResponse({url:"/sp/resume/getAllResumes",method:"get"}).then(function(response){if("true"===response.Success)$scope.resultStat=response.resume,$scope.firstView=$scope.resultStat.length?"true":"false",$scope.order("formattedDate",!0);else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})},$scope.openDialogCreateResume=function(){ngDialog.open({template:"/sp/createResume",scope:$scope})},$scope.order=function(predicate,reverse){$scope.resultStat=$filter("orderBy")($scope.resultStat,predicate,reverse)},$scope.active=function(event){sharedProperties.toggleFilterClick(event,$scope.currentPredicate)},$scope.createResumeDetail=function(form){if($scope.createFormError=!1,form.$valid){$localStorage.remove("firstViewEnable"),$localStorage.set("createResumeContent",{resumeLength:$scope.resultStat.length,createResumeRoleName:form.createResumeRole.$viewValue,createResumeProviderName:form.createResumeName.$viewValue});$localStorage.get("profileDone");window.location.href="/sp/resume/resumeDetailsView"}else $scope.createFormError=!0},$scope.openMessage=function(result){$scope.displayName=result,ngDialog.open({template:"/sp/messageAll",scope:$scope})},$scope.openPreview=function(id){var popupWin=window.open("/sp/resume/getResume/"+id,"_blank","width=700,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no");"Microsoft Internet Explorer"===navigator.appName?window.print():popupWin.print(),popupWin.window.focus()},$scope.openPreviewNew=function(id){window.open("/sp/resume/getResume/"+id,"_blank")},$scope.displayResume=function(){$scope.openDialogCreateResume()},$scope.createLayout=function(){var $slidesElem=$("ul.ordering-tool-list"),slidesHeight=$slidesElem.find("li").outerHeight();$slidesElem.find("li").outerWidth();return"undefined"!=typeof $scope.pckry&&$slidesElem.packery("destroy"),this.initialize=function(execute){$scope.pckry=$slidesElem.packery({itemSelector:".handleMe",rowHeight:slidesHeight,transitionDuration:0});var itemElems=$scope.pckry.packery("getItemElements");$scope.initialItem=itemElems;for(var i=0,len=itemElems.length;len>i;i++){var draggie=new Draggabilly(itemElems[i],{axis:"y",containment:$slidesElem,grid:[0,35]});$scope.pckry.packery("bindDraggabillyEvents",draggie)}$scope.pckry.packery("on","dragItemPositioned",this.orderItems)},this.orderItems=function(){for(var $itemElems=$scope.pckry.packery("getItemElements"),i=0;i<$itemElems.length;i++){var indexToPut=$($itemElems[i]).attr("tabindex");$scope.itemPositioned[i]=indexToPut,$scope.profileContent[indexToPut].id=i,$($itemElems[i]).attr("data-module-index",i)}$scope.$apply()},this.resetOrder=function(){for(var $itemElems=$scope.pckry.packery("getItemElements"),number=0,i=0;i<$itemElems.length;i++){var _this=$($itemElems[i]);$scope.itemPositioned[i]=_this.attr("tabindex"),_this.attr("data-module-index",i),_this.css("top",number),number+=slidesHeight,$scope.profileContent[i].id=i}},this.destroy=function(destroy){$scope.pckry.packery("reloadItems"),this.resetOrder()},this},$scope.callReorder=function(){$scope.initAside.destroy(),$scope.destroyProfileContent()},$scope.destroyProfileContent=function(){for(var i=0;i<$scope.profileContent.length;i++)$scope.profileContent[i].status=!0},$scope.displatyContent=function(){$scope.initAside=new $scope.createLayout,$scope.initAside.initialize(!0)},$scope.previewPDF=function(section){var printContents=$("."+section).html(),frontPage=$(".htmlFront").html(),coverLetter="",graphs=$(".graphs").html(),messageContent=$(".coverLetterPDF").find(".messageContent").html();if(this.displayCover&&""!==messageContent){var sub=$rootScope.nl2br(messageContent);$(".htmlCover").find(".messageContent").html(sub),coverLetter=$(".htmlCover").html()}var data={content:encodeURIComponent('<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link type="text/css" rel="stylesheet" href="/sp/resources/css/css-min/bootstrap.min.css"><link type="text/css" rel="stylesheet" href="/sp/resources/css/css-min/spResume.css"><script src="//use.typekit.net/ofk8xcu.js"></script><script> try {Typekit.load();} catch (e) {}</script></head><body class="sp-resume sp-resume-print-preview"><div class="container"><article class="resume-content">'+frontPage+coverLetter+"<div>"+printContents+"</div>"+graphs+"</article></div></body></html>"),role:$scope.roleName,providerName:$scope.providerName};ajaxService.getAjaxResponse({url:"/sp/resume/previewResume",data:$.param(data)}).then(function(response){if("true"===response.Success)window.open(response.url,"_blank");else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})},$scope.createResumeCall=function(section){var printContents=$("."+section).html(),frontPage=$(".htmlFront").html(),coverLetter="",graphs=$(".graphs").html(),messageContent=$(".coverLetterPDF").find(".messageContent").html();if(this.displayCover&&""!==messageContent){var sub=$rootScope.nl2br(messageContent);$(".htmlCover").find(".messageContent").html(sub),coverLetter=$(".htmlCover").html()}var data={content:encodeURIComponent('<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link type="text/css" rel="stylesheet" href="/sp/resources/css/css-min/bootstrap.min.css"><link type="text/css" rel="stylesheet" href="/sp/resources/css/css-min/spResume.css"><script src="//use.typekit.net/ofk8xcu.js"></script><script> try {Typekit.load();} catch (e) {}</script></head><body class="sp-resume sp-resume-print-preview"><div class="container"><article class="resume-content">'+frontPage+coverLetter+"<div>"+printContents+"</div>"+graphs+"</article></div></body></html>"),role:$scope.roleName,providerName:$scope.providerName};ajaxService.getAjaxResponse({url:"/sp/resume/createResume",data:$.param(data)}).then(function(response){if("true"===response.Success)window.location.href="/sp/spResume",$.growl({icon:"glyphicon glyphicon-ok",message:"PDF Created"});else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})},$scope.goBack=function(){window.location.href="/sp/connect/linkedin"},$scope.getProfileDetails=function(param){var _obj="";"undefined"!=typeof param?_obj={url:"/sp/linkedin/getProfileFull?updateProfile="+!0,method:"get"}:($scope.getUserDetail(),_obj={url:"/sp/linkedin/getProfileFull",method:"get"}),ajaxService.getAjaxResponse(_obj).then(function(response){if("true"===response.Success)$scope.linkedIn=response.linkedProfile,$localStorage.set("profileDone",!0),$scope.mapToResponse(),"undefined"!=typeof response.otherProfileData&&($scope.linkedIn.otherProfileData=response.otherProfileData),$scope.createNewMappingObject($scope.linkedIn);else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})},$scope.mapToResponse=function(){$scope.searchContent=["summary","projects","positions","testScores","educations","certifications","courses","interests","skills","languages","volunteer","Organizations","Supported Organizations","honorsAwards","patents","publications"]},$scope.createNewMappingObject=function(response){$scope.profileContent=[],$scope.asideContent=[];for(var count=0,i=0;i<$scope.searchContent.length;i++)for(var key in response)if("otherProfileData"===key||"linkedProfile"===key)for(var subKey in response[key])$scope.searchContent[i]===subKey&&null!==response[key][subKey]&&($scope.asideContent.push($scope.searchContent[i]),$scope.profileContent.push({id:count,content:response[key][subKey],status:"true",type:angular.lowercase(subKey)}),count++);$timeout(function(){$scope.displatyContent()},500)},$scope.changeStatusType=function(event,tabIndex){var _this=angular.element(event.currentTarget),dataType=$(_this).closest("li").attr("data-type");$scope.profileContent[tabIndex].status=!$scope.profileContent[tabIndex].status,$(_this).closest("li").attr("data-type",dataType=!dataType)},$scope.getUserDetail=function(){ajaxService.getAjaxResponse({url:"/sp/admin/user"}).then(function(response){if("true"===response.Success){$scope.userProfileDetail=response.profileForm,$scope.userProfileAddress=response.address,$scope.userSummary=response.userSummary;var fullDetail=$localStorage.get("createResumeContent");null!==fullDetail&&($scope.roleName=fullDetail.createResumeRoleName,$scope.providerName=fullDetail.createResumeProviderName,$scope.manageResumeLength=fullDetail.resumeLength)}else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})},$scope.coverletterfn=function(){this.displayCover?(this.contactInfo=!1,this.profileContentDisplay=!1,this.coverLetter=!0):(this.contactInfo=!1,this.profileContentDisplay=!0,this.coverLetter=!1)},$scope.deleteResumePop=function(id){$scope.deleteResumeId=id,ngDialog.open({template:"/sp/resume/deleteConfirmation",scope:$scope})},$scope.deleteResume=function(){ajaxService.getAjaxResponse({url:"/sp/resume/delete/"+$scope.deleteResumeId,method:"get"}).then(function(response){if("true"===response.Success)sharedProperties.spliceIndex($scope.resultStat,"id",$scope.deleteResumeId),ngDialog.close("ngdialog1"),$scope.firstView=$scope.resultStat.length?"true":"false",$.growl({icon:"glyphicon glyphicon-ok",message:"Delete Successfully"});else if(null!=response.error){ngDialog.close("ngdialog1");for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})},$scope.messageItem=function(param){if($scope.errpat=!1,param.$valid){var data=$(".shareResume").serialize();ajaxService.getAjaxResponse({url:"/sp/resume/share",data:data}).then(function(response){if("true"===response.Success)ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:"Resume Shared"});else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})}else $scope.errpat=!0},$scope.callGraphs=function(){ajaxService.getAjaxResponse({url:"/sp/signedIn/getAnalysisFull"}).then(function(response){if("true"===response.Success)$scope.profile.analysis=response.Analysis,$scope.profileContentGraphs=response,ProfileDataService.save(response);else if(null!=response.error){for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.errorMessage})}})}}angular.module("spApp").controller("resumeController",resumeController),resumeController.$inject=["$scope","ajaxService","ngDialog","$filter","sharedProperties","$timeout","ProfileDataService","$rootScope","$localStorage"];
function signUpController($scope,$http,$element,$attrs,ajaxService,$location,$state,$localStorage,sharedProperties,$timeout,ngDialog,$q){window.scrollTo(0,0);var _month=30;$scope.pwd={min:8,max:32,toggle:!1,err:!1,inputType:"password"},$scope.signup={},$scope.editSignup={},$scope.proRatedTotals={members:0,admins:0,hiringAdmins:0,candidates:0,bundles:0},$scope.getExceeded=!1,$scope.overlayClose=!1,$scope.timeout=0,$scope.validCoupoun=!0,$scope.subErrorMessage=!1,$scope.sfailure=!1,$scope.shownoError=!1,$scope.failure=[],$scope.localstorage=[],$scope.ageError=!1,$scope.localStorageEMp=null===$localStorage.get("employeeCount")?20:$localStorage.get("employeeCount"),$scope.disableEmail=!1,$scope.memberOverrideCheckbox=!1,$scope.adminOverrideCheckbox=!1,$scope.candidateOverrideCheckbox=!1,$scope.bundleOverrideCheckbox=!1,$scope.hiringAdminOverrideCheckbox=!1,$scope.signup.showHiringFeature=!1,$scope.planDetails=[],$scope.featuresList=[],$scope.selectedFeatures=[],$scope.showCustomMonths=!1,$scope.hiringPackageType="Bundles",$scope.customMonths=0,$scope.totalChargesPerMonth=0,$scope.signup.platformLicencePrice=null,$scope.signup.hiringLicencePrice=null,$scope.signup.adminTotalAmount=0,$scope.signup.memberTotalAmount=0,$scope.signup.candidateTotalAmount=0,$scope.signup.bundleTotalAmount=0,$scope.signup.hiringAdminTotalAmount=0,$scope.signup.intellgentHiring=!1,$scope.selectedFeaturesList=[],$scope.signup.spMatchCheck=!1,$scope.featuresSectionHiring=!1,$scope.featuresSectionPrimary=!1,$scope.hiringBundle=10,$scope.isEditMode=!1,$scope.existingHiringPlan=!1,$scope.serializeIgnore=!0,$scope.creditInfo={},$scope.remainingDaysInCycle=0,$scope.signup.existingMember=!1,$scope.addCreditPop=function(page){$scope.acPageType=page,$scope.creditInfo={},$scope.creditInfo.cpt=$scope.account.account.paymentInstrument.paymentType,$scope.creditInfo.ccomment=$scope.account.account.paymentInstrument.comment,$scope.serverError=!1,$scope.serverErrorMsg=null,ngDialog.open({template:"/sp/resources/html/admin/account/addcreditspop.html",scope:$scope})},$scope.addCredit=function(form){$scope.submitted=!1,this.spSubscribe.$valid&&"0"!==this.amount?ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/addCredit",data:$.param({accountId:$scope.account.account.id,chargeAmount:$scope.creditInfo.amount,paymentType:$scope.creditInfo.cpt,comment:$scope.creditInfo.ccomment})}).then(function(response){if("true"===response.Success)$scope.getAccountInfo(!0),$scope.sfailure===!0&&($scope.signup.submitted=!1,$scope.sfailure=!1,$scope.failure=null),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Amount</strong>",message:" Credited"});else{for(var key in response.error)$scope.errorMessage=response.error[key];$scope.serverError=!0,$scope.serverErrorMsg=$scope.errorMessage}}):$scope.submitted=!0},$scope.showPassword=function($event){$event.preventDefault(),$scope.pwd.toggle===!1?($scope.pwd.toggle=!0,$scope.pwd.inputType="text"):($scope.pwd.toggle=!1,$scope.pwd.inputType="password")},$scope.pullLocalStorage=function(){ajaxService.getAjaxResponse({url:"/sp/incompleteProfile"}).then(function(response){"true"===response.Success&&($scope.localstorage=response,$scope.signup.firstName="firstName"in $scope.localstorage?$scope.localstorage.firstName:"",$scope.signup.lastName="lastName"in $scope.localstorage?$scope.localstorage.lastName:"",$scope.signup.title="title"in $scope.localstorage?$scope.localstorage.title:"",$scope.signup.email="email"in $scope.localstorage?$scope.localstorage.email:"",$scope.signup.address1="address1"in $scope.localstorage?$scope.localstorage.address1:"",$scope.signup.address2="address2"in $scope.localstorage?$scope.localstorage.address2:"",$scope.signup.city="city"in $scope.localstorage?$scope.localstorage.city:"",$scope.signup.state="state"in $scope.localstorage?$scope.localstorage.state:null,$scope.signup.zip="zip"in $scope.localstorage?$scope.localstorage.zip:"",$scope.signup.phone="phone"in $scope.localstorage?$scope.localstorage.phone:"")})},$scope.getDetails=function(type){var templates={Members:"/sp/resources/html/sysAdmin/alternateBilling/memberDetails.html",Admins:"/sp/resources/html/sysAdmin/alternateBilling/memberDetails.html"};$scope.getDetailsType=type,ngDialog.open({template:templates[type],scope:$scope})},$scope.updateEmpCount=function(e,v,checkboxSelected){var thisClass=$(e.target).attr("class"),empVal=parseInt(v);checkboxSelected=$($element).find("."+checkboxSelected).val(),$scope.alternateBillingMode===!0&&(checkboxSelected=$scope.products[$scope.activeIndex].unitPrice),empVal>$scope.signup.maximum&&"undefined"==typeof $scope.alternateBillingMode?($scope.getExceeded=!0,$scope.overlayClose=!0):$scope.getExceeded===!0&&$scope.overlayClose===!0&&(""===$scope.appliedPromotionId?($scope.getExceeded=!1,$scope.overlayClose=!1):$scope.getExceeded=!1),angular.isNumber(empVal)&&("up"===thisClass&&empVal>=$scope.signup.minimum?$scope.signup.emp=parseInt($scope.signup.emp,10)+parseInt(1,10):"down"===thisClass&&empVal>=parseInt($scope.signup.minimum,10)+parseInt(1,10)&&($scope.signup.emp=parseInt($scope.signup.emp,10)-parseInt(1,10)),$scope.totalCount($scope.signup.emp,checkboxSelected,$scope.products[$scope.activeIndex].validityType)),e&&e.preventDefault()},$scope.keyUpEvent=function(e,v,checkboxSelected){if(""===v)return!1;if(38===e.keyCode?(v=parseInt(v,10)+parseInt(1,10),$scope.signup.emp=parseInt(v)):40===e.keyCode&&(v=parseInt(v,10)-parseInt(1,10),$scope.signup.emp=parseInt(v)),v>=$scope.signup.maximum&&"undefined"==typeof $scope.alternateBillingMode)return $scope.getExceeded=!0,$scope.overlayClose=!0,!1;$scope.getExceeded===!0&&$scope.overlayClose===!0&&(""===$scope.appliedPromotionId?($scope.getExceeded=!1,$scope.overlayClose=!1):$scope.getExceeded=!1);var empVal=($(e.target).attr("class"),parseInt(v));checkboxSelected=$($element).find("."+checkboxSelected).val(),$scope.alternateBillingMode===!0&&(checkboxSelected=$scope.products[$scope.activeIndex].unitPrice),angular.isNumber(empVal)&&(clearTimeout($scope.timeout),$scope.timeout=setTimeout(function(){$scope.signup.emp=empVal<$scope.signup.minimum||isNaN(empVal)?$scope.signup.minimum:parseInt($scope.signup.emp,10),$scope.totalCount($scope.signup.emp,checkboxSelected,$scope.products[$scope.activeIndex].validityType),$scope.$apply()},$attrs.delay||1e3))},$scope.totalCount=function(empVal,unitPrice,validity){"undefined"!=typeof validity&&"yearly"===validity.toLowerCase()?$scope.signup.total=12*(parseFloat(empVal,10)*parseFloat(unitPrice,10)):$scope.signup.total=parseFloat(empVal,10)*parseFloat(unitPrice,10)},$scope.updateSelectedBox=function(event,item,min,max,unitPrice,index,validity){return $scope.overlayClose&&$scope.closeOverlaySuccessMsg(),$scope.signup.minimum=min,$scope.signup.maxEmployee=max,$scope.activateCheck=item,$scope.activeIndex=index,$scope.contractPlan=$scope.products[index].name,$scope.contractTerm=$scope.products[index].validityKey,$scope.lastcheckedItem===$scope.activateCheck?!1:($scope.lastcheckedItem=item,void $scope.totalCount($scope.signup.emp,unitPrice,$scope.products[$scope.activeIndex].validityType))},$scope.processincompleteSignUpIndividual=function(fData){$scope.spSignUpIndividual.submitted=!1,$scope.sfailure=!1;var elem=angular.element($element),obj={firstName:$scope.signup.firstName,lastName:$scope.signup.lastName,title:$scope.signup.title,email:$scope.signup.email,password:$scope.signup.password,phone:$scope.signup.phone,zip:$scope.signup.zip,address1:$scope.signup.address1,address2:$scope.signup.address2,country:$scope.signup.country,city:$scope.signup.city,state:$scope.signup.state,gender:$scope.signup.gender,month:$scope.signup.month,year:$scope.signup.year,day:$scope.signup.day},vCount=0;for(var k in obj)("default"===obj[k]||"default1"===obj[k])&&vCount++;if($scope.spSignUpIndividual.$valid&&$scope.ageLimitCheck($scope.signup.month,$scope.signup.year,$scope.signup.day)&&0===vCount){var ur="/sp/updateProfile",options={url:ur,data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?window.location.reload():null!=response.error&&($scope.failure=response.error,$scope.sfailure=!0)})}else $scope.spSignUpIndividual.submitted=!0,elem=angular.element($element),$scope.ageError||$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300)},$scope.addmemberSignUpIndividual=function(fData,alternate){var token=window.location.pathname.substring(window.location.pathname.lastIndexOf("/")+1);$scope.addMemberSignUp.submitted=!1,$scope.sfailure=!1;var elem=angular.element($element),obj={firstName:$scope.signup.firstName,lastName:$scope.signup.lastName,title:$scope.signup.title,email:$scope.signup.email,password:$scope.signup.password,phone:$scope.signup.phone,zip:$scope.signup.zip,address1:$scope.signup.address1,address2:$scope.signup.address2,country:$scope.signup.country,city:$scope.signup.city,state:$scope.signup.state,gender:$scope.signup.gender,month:$scope.signup.month,year:$scope.signup.year,day:$scope.signup.day,token:token};if($scope.addMemberSignUp.$valid&&$scope.ageLimitCheck($scope.signup.month,$scope.signup.year,$scope.signup.day)){var options={url:"undefined"==typeof alternate?"/sp/signup/member":"/sp/signup/individual/member",data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?window.location.href="/sp":null!=response.error&&($scope.failure=response.error,$scope.sfailure=!0)})}else elem=angular.element($element),$scope.ageError||$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300),$scope.addMemberSignUp.submitted=!0},$scope.processSignUpIndividual=function(fData){$scope.spSignUpIndividual.submitted=!1,$scope.sfailure=!1;var sourceRefer;sourceRefer="other"===$scope.signup.referSource.toLowerCase()?$scope.signup.referSourceOther:"default2"===$scope.signup.referSource?"":$scope.signup.referSource;var elem=angular.element($element),obj={firstName:$scope.signup.firstName,lastName:$scope.signup.lastName,title:$scope.signup.title,email:$scope.signup.email,password:$scope.signup.password,phone:$scope.signup.phone,zip:$scope.signup.zip,address1:$scope.signup.address1,address2:$scope.signup.address2,country:$scope.signup.country,city:$scope.signup.city,state:$scope.signup.state,gender:$scope.signup.gender,month:$scope.signup.month,year:$scope.signup.year,day:$scope.signup.day,referSource:sourceRefer},vCount=0;for(var k in obj)("default"===obj[k]||"default1"===obj[k])&&vCount++;if($scope.spSignUpIndividual.$valid&&$scope.ageLimitCheck($scope.signup.month,$scope.signup.year,$scope.signup.day)&&0===vCount){var ur="/sp/signup/"+angular.lowercase($location.path().replace("/signup_","")),options={url:ur,data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?$state.go(angular.lowercase($location.path().replace("/signup_",""))):null!=response.error&&($scope.failure=response.error,$scope.sfailure=!0)})}else $scope.spSignUpIndividual.submitted=!0,elem=angular.element($element),$scope.ageError||$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300)},$scope.processSignUp=function(fData){$scope.spSignUp.submitted=!1;var sourceRefer,elem=angular.element($element);sourceRefer="other"===$scope.signup.referSource.toLowerCase()?$scope.signup.referSourceOther:"default2"===$scope.signup.referSource?"":$scope.signup.referSource;var obj={firstName:$scope.signup.firstName,lastName:$scope.signup.lastName,title:$scope.signup.title,email:$scope.signup.email,password:$scope.signup.password,company:$scope.signup.company,industry:$scope.signup.industry,numEmp:$scope.signup.noEmp,phone:$scope.signup.phone,zip:$scope.signup.zip,address1:$scope.signup.address1,address2:$scope.signup.address2,country:$scope.signup.country,city:$scope.signup.city,state:$scope.signup.state,referSource:sourceRefer},vCount=0;for(var k in obj)("default"===obj[k]||"default1"===obj[k])&&vCount++;if($scope.spSignUp.$valid&&0===vCount){$localStorage.set("businessUserCred",obj);var ur="/sp/signup/"+angular.lowercase($location.path().replace("/signup_","")),options={url:ur,data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?$state.go(angular.lowercase($location.path().replace("/signup_",""))):null!=response.error&&($scope.failure=response.error,$scope.sfailure=!0)})}else $scope.spSignUp.submitted=!0,elem=angular.element($element),$scope.ageError||$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300)},$scope.processAlternateSignUp=function(fData){$scope.spSignUp.submitted=!1;var obj={firstName:$scope.signup.firstName,lastName:$scope.signup.lastName,title:$scope.signup.title,email:$scope.signup.email,company:$scope.signup.company,industry:$scope.signup.industry,numEmp:$scope.signup.noEmp,phone:$scope.signup.phone,zip:$scope.signup.zip,address1:$scope.signup.address1,address2:$scope.signup.address2,country:$scope.signup.country,city:$scope.signup.city,state:$scope.signup.state,existingMember:$scope.signup.existingMember},vCount=0;for(var k in obj)("default"===obj[k]||"default1"===obj[k])&&vCount++;if($scope.spSignUp.$valid&&0===vCount){$localStorage.set("alternativeBUserCred",obj);var options={url:"/sp/sysAdmin/alternateBilling/signup/business",data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?window.location.href="/sp/sysAdmin/alternateBilling/businessStep2Form":null!=response.error&&($scope.failure=response.error,$scope.sfailure=!0)})}else{$scope.spSignUp.submitted=!0;var elem=angular.element($element);$scope.ageError||$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300)}},$scope.processAlternateIndividualSignUp=function(fData){$scope.spSignUp.submitted=!1,$scope.sfailure=!1;var obj={firstName:$scope.signup.firstName,lastName:$scope.signup.lastName,title:$scope.signup.title,email:$scope.signup.email,password:$scope.signup.password,phone:$scope.signup.phone,zip:$scope.signup.zip,address1:$scope.signup.address1,address2:$scope.signup.address2,country:$scope.signup.country,city:$scope.signup.city,state:$scope.signup.state,gender:$scope.signup.gender,month:$scope.signup.month,year:$scope.signup.year,day:$scope.signup.day},vCount=0;for(var k in obj)("default"===obj[k]||"default1"===obj[k])&&vCount++;if($scope.spSignUp.$valid&&$scope.ageLimitCheck($scope.signup.month,$scope.signup.year,$scope.signup.day)&&0===vCount){var options={url:"/sp/sysAdmin/alternateBilling/signup/individual",data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?window.location.href="/sp/sysAdmin/alternateBilling/individualStep2Form":null!=response.error&&($scope.failure=response.error,$scope.sfailure=!0)})}else{$scope.spSignUp.submitted=!0;var elem=angular.element($element);$scope.ageError||$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300)}},$scope.contactUs=function(){var elem=angular.element($element);$(elem.find("form")).serialize()},$scope.processSubscribe=function(fData){var elem=angular.element($element);$(elem.find("form")).serialize();$scope.shownoError=!1;var obj={},options={};if("subscribe"===fData){$scope.spSubscribe.submitted=!1,$scope.subErrorMessage=!1,obj={nameOnCard:$scope.signup.ccname,cardNumber:$scope.signup.ccno,month:$scope.signup.month,year:$scope.signup.year,cvv:$scope.signup.ccv,country:$scope.signup.country,zip:$scope.signup.zip,total:$scope.signup.total,action:"submitsubscribe",numEmp:$scope.signup.emp,productId:$scope.activateCheck.replace("index_","")};var vCount=0;"undefined"!=typeof $scope.appliedPromotionId&&""!==$scope.appliedPromotionId&&(obj.promotionId=$scope.appliedPromotionId);for(var k in obj)("default"===obj[k]||"default1"===obj[k])&&vCount++;$scope.spSubscribe.$valid&&0===vCount?(options={url:"/sp/signup/"+angular.lowercase($location.path().replace("/",""))+"/account",data:$.param(obj)},ajaxService.getAjaxResponse(options).then(function(response){if("undefined"!=typeof response.error){var keyname="";for(var key in response.error)keyname=key;$scope.errorMessage=response.error[keyname],$scope.subErrorMessage=!0}else $localStorage.remove("employeeCount"),window.location.href="/sp"})):($scope.spSubscribe.submitted=!0,elem=angular.element($element),$scope.ageError||$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300))}else"cancel"===fData?($scope.shownoError=!0,window.location.replace("/pricing/")):"contactus"===fData&&($scope.contactUsForm.submitted=!0,$scope.contactUsForm.$valid?(obj={name:$scope.signup.vciname,company:$scope.signup.vcicompname,phone:$scope.signup.vcitel,action:"contact",numEmp:$scope.signup.emp},options={url:"/sp/signup/business/assisted/account",data:$.param(obj)},ajaxService.getAjaxResponse(options).then(function(response){$state.go("thankYou")})):(elem=angular.element($element),$scope.ageError||$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300),$scope.contactUsForm.submitted=!0))},$scope.priorityCode=function(val,productId){var promoCode=$scope.signup.coupon;if(!/^[a-zA-Z0-9]{3,8}$/.test(promoCode))return $scope.validCoupoun=!1,!1;$scope.validCoupoun=!0;var obj={code:promoCode.toUpperCase(),productId:productId.replace("index_","")},options={url:"/sp/signup/promotion",data:$.param(obj)};ajaxService.getAjaxResponse(options).then(function(response){if($scope.getResult="undefined"!=typeof response.Success?response.Success:!1,$scope.getResult){if("Active"!==response.promotion.status)return $scope.getResult=!1,!1;$scope.appliedPromotionId=response.promotion.id,$scope.getContent="undefined"!=typeof response.promotion.message?response.promotion.message:"No Discount Available",$scope.overlayClose=$scope.getResult,$scope.getDiscountedPrice=response.promotion.unitPrice,$scope.discountedActivated=$scope.activateCheck,$scope.withoutDiscountedPrice=$($element).find("."+$scope.discountedActivated).val(),$scope.alternateBillingMode===!0&&($scope.withoutDiscountedPrice=$scope.products[$scope.activeIndex].unitPrice),$scope.originproduct=$scope.products,$scope.discountedItemIndex=$scope.activeIndex,$scope.products[$scope.activeIndex].unitPrice=$scope.getDiscountedPrice,$scope.totalCount($scope.signup.emp,$scope.getDiscountedPrice,$scope.products[$scope.activeIndex].validityType)}else"undefined"!=typeof response.error&&($scope.getResult=!1,$scope.PromotionsValidationException=response.error.Promotion_Not_Found)})},$scope.closeOverlaySuccessMsg=function(event){$scope.overlayClose=!1,$scope.appliedPromotionId="",$scope.products[$scope.discountedItemIndex].unitPrice=$scope.withoutDiscountedPrice,$scope.totalCount($scope.signup.emp,$scope.products[$scope.activeIndex].unitPrice,$scope.products[$scope.activeIndex].validityType),event&&event.preventDefault()},$scope.checkStatus=function(param1,param2){return param1===param2?!0:!1},$scope.highlighter=function(index){return $scope.getResult&&$scope.overlayClose&&$scope.discountedActivated===$scope.activateCheck&&$scope.discountedItemIndex===index?!0:!1},$scope.getAnnualMonthlyEmpData=function(mode){var obj={productType:angular.uppercase($location.path().replace("/",""))},options={url:"/sp/signup/getProducts",data:$.param(obj)};$scope.userMode=mode,ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){if("undefined"!=typeof response.Product_Not_Found)return!1;$scope.products=response.products;var countStore=$localStorage.get("employeeCount"),empyType=$localStorage.get("emplyeeType"),_index=0;if($scope.minEmpCount=response.products[_index].minEmployee,null!=empyType){"m"===empyType?empyType="MONTHLY":"y"===empyType&&(empyType="YEARLY");for(var i=0;i<$scope.products.length;i++)$scope.products[i].validityType===empyType&&(_index=i)}$scope.signup.minimum=response.products[_index].minEmployee,$scope.signup.maximum="undefined"!=typeof response.products[_index].maxEmployee?response.products[_index].maxEmployee:1e3,$scope.signup.contract=[],$scope.signup.emp="undefined"!=typeof countStore&&countStore>$scope.signup.minimum?countStore:response.products[_index].minEmployee,$scope.activateCheck="index_"+response.products[_index].id,$scope.lastcheckedItem="index_"+response.products[_index].id,$scope.contractPlan=response.products[_index].name,$scope.contractTerm=response.products[_index].validityKey,$scope.activeIndex=_index,$scope.totalCount($scope.signup.emp,response.products[_index].unitPrice,response.products[_index].validityType),$scope.annualCheckbox=!0,$scope.master=angular.copy($scope.signup)}else{$scope.updateStatusError=!0;for(var key in response.error)$scope.updateStatusErrorMsg=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.updateStatusErrorMsg})}})},$scope.ageLimitCheck=function(month,year,date){if("undefined"==typeof month||"undefined"==typeof year)return!0;var today=new Date,birthDate=new Date(year+"/"+month+"/"+date),age=today.getFullYear()-birthDate.getFullYear(),m=today.getMonth()-birthDate.getMonth();return(0>m||0===m&&today.getDate()<birthDate.getDate())&&age--,age>=18?($scope.ageError=!1,!0):($scope.ageError=!0,!1)},$scope.pullContactUsDetails=function(){var storage=$localStorage.get("businessUserCred");null!==storage&&($scope.signup.vciname=storage.firstName+" "+storage.lastName,$scope.signup.vcicompname=storage.company,$scope.signup.vcitel=storage.phone);({firstName:$scope.signup.firstName,lastName:$scope.signup.lastName,title:$scope.signup.title,email:$scope.signup.email,password:$scope.signup.password,company:$scope.signup.company,industry:$scope.signup.industry,numEmp:$scope.signup.noEmp,phone:$scope.signup.phone,zip:$scope.signup.zip,address1:$scope.signup.address1,address2:$scope.signup.address2,country:$scope.signup.country,city:$scope.signup.city,state:$scope.signup.state})},$scope.historyGoBack=function(type){switch(type){case"business":window.location.href="/sp/sysAdmin/alternateBilling/business";break;case"individual":window.location.href="/sp/sysAdmin/alternateBilling/individual"}},$scope.getAllProducts=function(type){$scope.alternateBillingMode=!0,ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/signup/getProducts",data:$.param({productType:type})}).then(function(response){if("true"===response.Success)$scope.products=response.products,$scope.signup.emp=0,$scope.signup.minimum=0,$scope.signup.maximum=0,$scope.totalCount(0,0,"MONTHLY");else{for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",message:$scope.errorMessage})}})},$scope.paymentTypeChange=function(_this){if($scope.overlayClose&&$scope.closeOverlaySuccessMsg(),""===_this.signup.paymentType)return $scope.signup.emp=0,$scope.signup.minimum=0,$scope.signup.maximum=0,$scope.totalCount(0,0,"MONTHLY"),!0;var _index=_this.signup.paymentType;$scope.signup.minimum=$scope.products[_index].minEmployee,$scope.signup.maximum="undefined"!=typeof $scope.products[_index].maxEmployee?$scope.products[_index].maxEmployee:1e3,$scope.signup.contract=[],$scope.signup.emp=$scope.products[_index].minEmployee,$scope.activateCheck="index_"+$scope.products[_index].id,$scope.lastcheckedItem="index_"+$scope.products[_index].id,$scope.contractPlan=$scope.products[_index].name,$scope.contractTerm=$scope.products[_index].validityKey,$scope.activeIndex=_index,$scope.totalCount($scope.signup.emp,$scope.products[_index].unitPrice,$scope.products[_index].validityType),$scope.annualCheckbox=!0,$scope.master=angular.copy($scope.signup)},$scope.validateSendResponse=function(signup,editMode){$scope.signup.submitted=!1;var hiringAgreementCheck,_data=$("#accountsBillingStep2 :not(.serialize-ignore)").serialize(),accountIdInfo=editMode===!0?"&accountId="+$scope.accountId:"",totalAmountCheck=!$scope.isEditMode&&$scope.signup.camountOverride?$scope.signup.camountOverride>=$scope.totalForBillingCycle:!0;hiringAgreementCheck=$scope.signup.intellgentHiring||$scope.signup.existingHiringPlan?$scope.signup.hiringAgreement<=$scope.signup.agreement?!0:!1:!0;var response;if(signup.$valid&&totalAmountCheck&&hiringAgreementCheck){var options={url:editMode?"/sp/sysAdmin/alternateBilling/updateAccount":"/sp/sysAdmin/alternateBilling/signup/business/account",data:_data+accountIdInfo};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?editMode?($localStorage.set("updateAccount","Account updated successfully !"),window.location.href="/sp/sysAdmin/alternateBilling/viewDetailAccount?accountId="+sharedProperties.getParam("accountId")):($localStorage.set("createAccount","Account created successfully !"),window.location.href="undefined"==typeof individual?"/sp/sysAdmin/alternateBilling/business":"/sp/sysAdmin/alternateBilling/individual"):null!=response.error&&($scope.failure=response.error,$scope.sfailure=!0)})}else{$scope.signup.submitted=!0;var elem=angular.element($element);if(!$scope.ageError)if($(elem).find("form .ng-invalid:first").length)$("html,body").animate({scrollTop:$(elem).find("form .ng-invalid:first").offset().top-20},300);else{for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",message:$scope.errorMessage})}}},$scope.toggleOverrideField=function(type){"Member"===type?($scope.memberOverrideCheckbox===!1?($scope.memberOverrideCheckbox=!0,$scope.signup.memberPrice=$scope.isEditMode?$scope.account.account.spPlans.Primary.unitMemberPrice:0):($scope.memberOverrideCheckbox=!1,$scope.signup.overrideMemberAmount=0),$scope.updateMemberAccountSummary("Member")):($scope.adminOverrideCheckbox===!1?($scope.adminOverrideCheckbox=!0,$scope.signup.adminPrice=$scope.isEditMode?$scope.account.account.spPlans.Primary.unitAdminPrice:0):($scope.adminOverrideCheckbox=!1,$scope.signup.overrideAdminAmount=0),$scope.updateMemberAccountSummary("Admin"))},$scope.toggleHiringOverrideField=function(type){"Candidate"===type?($scope.candidateOverrideCheckbox===!1?($scope.candidateOverrideCheckbox=!0,$scope.signup.candidatePrice=$scope.isEditMode?$scope.account.account.spPlans.IntelligentHiring.unitMemberPrice:null):($scope.candidateOverrideCheckbox=!1,$scope.signup.overrideCandidateAmount=0),$scope.updateHiringAccountSummary("Candidate")):"Bundle"===type?($scope.bundleOverrideCheckbox===!1?($scope.bundleOverrideCheckbox=!0,$scope.signup.bundlePrice=$scope.isEditMode?$scope.account.account.spPlans.IntelligentHiring.availalbeMemberSubscriptions/$scope.hiringBundle:null):($scope.byndleOverrideCheckbox=!1,$scope.signup.overrideBundleAmount=0),$scope.updateHiringAccountSummary("Bundle")):($scope.hiringAdminOverrideCheckbox===!1?($scope.hiringAdminOverrideCheckbox=!0,$scope.signup.hiringAdminPrice=$scope.isEditMode?$scope.account.account.spPlans.IntelligentHiring.unitAdminPrice:null):($scope.hiringAdminOverrideCheckbox=!1,$scope.signup.overrideHiringAdminAmount=0),$scope.updateHiringAccountSummary("Admin"))},$scope.getPlanDetails=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/getPlansFeature",method:"POST"}).then(function(response){if("true"===response.Success){$scope.planDetails=response.plansFeatures;for(var i=0;i<$scope.planDetails.length;i++)"Primary"===$scope.planDetails[i].spPlanType&&($scope.featuresList=$scope.planDetails[i].spFeatures);$scope.updateSerializeFlags()}else{for(var key in response.error)$scope.errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",message:$scope.errorMessage})}})},$scope.toggleFeatureSelection=function(featureName){var index=$scope.selectedFeatures.indexOf(featureName);index>-1?$scope.selectedFeatures.splice(index,1):$scope.selectedFeatures.push(featureName)},$scope.updateMemberAccountSummary=function(type){var overRidePrice=0,previousCharge=0,chargableAmount=0;"Member"===type?$scope.memberOverrideCheckbox?$scope.signup.overrideMemberAmount>0?($scope.signup.memberTotalAmount=$scope.signup.overrideMemberAmount,$scope.updateTotalPerMonth(),$scope.isEditMode&&(overRidePrice=$scope.signup.overrideMemberAmount,previousCharge=$scope.account.account.spPlans.Primary.planMemberNextChargeAmount,chargableAmount=(overRidePrice-previousCharge)*($scope.remainingDays/_month),0>chargableAmount?($scope.proRatedTotals.members=0,$scope.updateTotalPerMonth()):($scope.proRatedTotals.members=chargableAmount,$scope.updateTotalPerMonth()),$scope.signup.memberCount<$scope.editSignup.memberCount&&($scope.signup.memberCount=$scope.editSignup.memberCount,$scope.proRatedTotals.members=0,$scope.updateTotalPerMonth()))):($scope.signup.memberTotalAmount=parseInt($scope.signup.memberCount)*parseFloat($scope.signup.memberPrice),$scope.updateTotalPerMonth()):($scope.signup.memberTotalAmount=parseInt($scope.signup.memberCount)*parseFloat($scope.signup.memberPrice),$scope.updateTotalPerMonth(),$scope.isEditMode&&($scope.signup.memberCount>$scope.editSignup.memberCount?($scope.proRatedTotals.members=0,$scope.proRatedTotals.members=$scope.editSignup.memberPrice/_month*($scope.signup.memberCount-$scope.editSignup.memberCount)*$scope.remainingDays,$scope.updateTotalPerMonth()):$scope.signup.memberCount<=$scope.editSignup.memberCount&&($scope.signup.memberCount=$scope.editSignup.memberCount,$scope.proRatedTotals.members=0,$scope.updateTotalPerMonth()))):$scope.adminOverrideCheckbox?$scope.signup.overrideAdminAmount>0?($scope.signup.adminTotalAmount=$scope.signup.overrideAdminAmount,$scope.updateTotalPerMonth(),$scope.isEditMode&&(overRidePrice=$scope.signup.overrideAdminAmount,previousCharge=$scope.account.account.spPlans.Primary.planAdminNextChargeAmount,chargableAmount=(overRidePrice-previousCharge)*($scope.remainingDays/_month),0>chargableAmount?($scope.proRatedTotals.admins=0,$scope.updateTotalPerMonth()):($scope.proRatedTotals.admins=chargableAmount,$scope.updateTotalPerMonth()),$scope.signup.adminCount<$scope.editSignup.adminCount&&($scope.signup.adminCount=$scope.editSignup.adminCount,$scope.proRatedTotals.admins=0,$scope.updateTotalPerMonth()))):($scope.signup.adminTotalAmount=parseInt($scope.signup.adminCount)*parseFloat($scope.signup.adminPrice),$scope.updateTotalPerMonth()):($scope.signup.adminTotalAmount=parseInt($scope.signup.adminCount)*parseFloat($scope.signup.adminPrice),$scope.updateTotalPerMonth(),$scope.isEditMode&&($scope.signup.adminCount>$scope.editSignup.adminCount?($scope.proRatedTotals.admins=0,$scope.proRatedTotals.admins=$scope.editSignup.adminPrice/_month*($scope.signup.adminCount-$scope.editSignup.adminCount)*$scope.remainingDays,$scope.updateTotalPerMonth()):$scope.signup.adminCount<=$scope.editSignup.adminCount&&($scope.signup.adminCount=$scope.editSignup.adminCount,$scope.proRatedTotals.admins=0,$scope.updateTotalPerMonth())))},$scope.updateHiringAccountSummary=function(type){var overRidePrice=0,previousCharge=0,chargableAmount=0;"Candidate"===type?$scope.candidateOverrideCheckbox&&$scope.signup.overrideCandidateAmount>0?($scope.signup.candidateTotalAmount=$scope.signup.overrideCandidateAmount,$scope.updateTotalPerMonth()):($scope.signup.candidateTotalAmount=parseInt($scope.signup.candidateCount)*parseFloat($scope.signup.candidatePrice),$scope.updateTotalPerMonth()):"Bundle"===type?$scope.bundleOverrideCheckbox&&$scope.signup.overrideBundleAmount>0?($scope.signup.bundleTotalAmount=$scope.signup.overrideBundleAmount,$scope.updateTotalPerMonth()):($scope.signup.bundleTotalAmount=parseInt($scope.signup.bundleCount)*parseFloat($scope.signup.bundlePrice),$scope.updateTotalPerMonth()):$scope.hiringAdminOverrideCheckbox?$scope.signup.overrideHiringAdminAmount>0?($scope.signup.hiringAdminTotalAmount=$scope.signup.overrideHiringAdminAmount,$scope.updateTotalPerMonth(),$scope.isEditMode&&$scope.existingHiringPlan?(overRidePrice=$scope.signup.overrideHiringAdminAmount,previousCharge=$scope.account.account.spPlans.IntelligentHiring.planAdminNextChargeAmount,
chargableAmount=(overRidePrice-previousCharge)*($scope.remainingDays/_month),0>chargableAmount?($scope.proRatedTotals.hiringAdmins=0,$scope.updateTotalPerMonth()):($scope.proRatedTotals.hiringAdmins=chargableAmount,$scope.updateTotalPerMonth()),$scope.signup.hiringAdminCount<$scope.editSignup.hiringAdminCount&&($scope.signup.hiringAdminCount=$scope.editSignup.hiringAdminCount,$scope.proRatedTotals.hiringAdmins=0,$scope.updateTotalPerMonth())):$scope.isEditMode&&$scope.existingHiringPlan===!1&&($scope.proRatedTotals.hiringAdmins=$scope.signup.overrideHiringAdminAmount/_month*$scope.remainingDays,$scope.updateTotalPerMonth())):($scope.signup.hiringAdminTotalAmount=$scope.signup.overrideHiringAdminAmount/_month*$scope.remainingDays*$scope.existingBillingDays,$scope.updateTotalPerMonth()):($scope.signup.hiringAdminTotalAmount=parseInt($scope.signup.hiringAdminCount)*parseFloat($scope.signup.hiringAdminPrice),$scope.updateTotalPerMonth(),$scope.isEditMode&&$scope.existingHiringPlan?$scope.signup.hiringAdminCount>$scope.editSignup.hiringAdminCount?($scope.proRatedTotals.hiringAdmins=0,$scope.proRatedTotals.hiringAdmins=$scope.editSignup.hiringAdminPrice/_month*($scope.signup.hiringAdminCount-$scope.editSignup.hiringAdminCount)*$scope.remainingDays,$scope.updateTotalPerMonth()):$scope.signup.hiringAdminCount<=$scope.editSignup.hiringAdminCount&&($scope.signup.hiringAdminCount=$scope.editSignup.hiringAdminCount,$scope.proRatedTotals.hiringAdmins=0,$scope.updateTotalPerMonth()):$scope.isEditMode&&$scope.existingHiringPlan===!1&&($scope.proRatedTotals.hiringAdmins=$scope.signup.hiringAdminCount*($scope.signup.hiringAdminPrice/_month)*$scope.remainingDays*$scope.existingBillingDays,$scope.updateTotalPerMonth())),$scope.isEditMode&&$scope.existingHiringPlan===!1&&$scope.signup.intellgentHiring===!0&&($scope.hiringAdminOverrideCheckbox?$scope.signup.overrideHiringAdminAmount>0?(overRidePrice=$scope.signup.overrideHiringAdminAmount,previousCharge=0,chargableAmount=(overRidePrice-previousCharge)*($scope.remainingDays/_month),0>chargableAmount?($scope.proRatedTotals.hiringAdmins=0,$scope.updateTotalPerMonth()):($scope.proRatedTotals.hiringAdmins=chargableAmount,$scope.updateTotalPerMonth())):($scope.signup.hiringAdminTotalAmount=parseInt($scope.signup.hiringAdminCount)*parseFloat($scope.signup.hiringAdminPrice),$scope.updateTotalPerMonth()):($scope.proRatedTotals.hiringAdmins=0,$scope.proRatedTotals.hiringAdmins=$scope.signup.hiringAdminPrice/_month*$scope.signup.hiringAdminCount*$scope.remainingDays,$scope.updateTotalPerMonth()))},$scope.calcAgreementAmount=function(){$scope.totalAgreementAmount=0;var hiringAdminTotal=0,hiringLicenceTotal=0,totalHiringAgreement=0;$scope.totalAgreementAmount+=null!==$scope.signup.platformLicencePrice&&void 0!==$scope.signup.platformLicencePrice&&$scope.signup.platformLicencePrice>0?$scope.signup.platformLicencePrice:0,$scope.totalAgreementAmount+=null!==$scope.signup.adminTotalAmount&&void 0!==$scope.signup.adminTotalAmount&&$scope.signup.adminTotalAmount>0?$scope.signup.adminTotalAmount:0,$scope.totalAgreementAmount+=null!==$scope.signup.memberTotalAmount&&void 0!==$scope.signup.memberTotalAmount&&$scope.signup.memberTotalAmount>0?$scope.signup.memberTotalAmount:0;var candidatesPack=null!==$scope.signup.candidateTotalAmount&&void 0!==$scope.signup.candidateTotalAmount&&$scope.signup.candidateTotalAmount>0?$scope.signup.candidateTotalAmount:0,bundlesPack=null!==$scope.signup.bundleTotalAmount&&void 0!==$scope.signup.bundleTotalAmount&&$scope.signup.bundleTotalAmount>0?$scope.signup.bundleTotalAmount:0;hiringLicenceTotal=null!==$scope.signup.hiringLicencePrice&&void 0!==$scope.signup.hiringLicencePrice&&$scope.signup.hiringLicencePrice>0?$scope.signup.hiringLicencePrice:0,hiringAdminTotal=null!==$scope.signup.hiringAdminTotalAmount&&void 0!==$scope.signup.hiringAdminTotalAmount&&$scope.signup.hiringAdminTotalAmount>0?$scope.signup.hiringAdminTotalAmount:0,totalHiringAgreement=parseFloat(12*(hiringLicenceTotal+hiringAdminTotal)*$scope.signup.hiringAgreement),$scope.totalAgreementAmount=parseFloat(12*$scope.totalAgreementAmount*$scope.signup.agreement+candidatesPack+bundlesPack+(totalHiringAgreement?totalHiringAgreement:0)),$scope.totalAgreementAmount=Math.round($scope.totalAgreementAmount)},$scope.updateTotalPerMonth=function(){$scope.totalChargesPerMonth=0,$scope.totalChargesPerMonth+=null!==$scope.signup.platformLicencePrice&&void 0!==$scope.signup.platformLicencePrice&&$scope.signup.platformLicencePrice>0?$scope.signup.platformLicencePrice:0,$scope.totalChargesPerMonth+=null!==$scope.signup.hiringLicencePrice&&void 0!==$scope.signup.hiringLicencePrice&&$scope.signup.hiringLicencePrice>0?$scope.signup.hiringLicencePrice:0,$scope.totalChargesPerMonth+=null!==$scope.signup.adminTotalAmount&&void 0!==$scope.signup.adminTotalAmount&&$scope.signup.adminTotalAmount>0?$scope.signup.adminTotalAmount:0,$scope.totalChargesPerMonth+=null!==$scope.signup.memberTotalAmount&&void 0!==$scope.signup.memberTotalAmount&&$scope.signup.memberTotalAmount>0?$scope.signup.memberTotalAmount:0,$scope.totalChargesPerMonth+=null!==$scope.signup.hiringAdminTotalAmount&&void 0!==$scope.signup.hiringAdminTotalAmount&&$scope.signup.hiringAdminTotalAmount>0?$scope.signup.hiringAdminTotalAmount:0,$scope.totalChargesPerMonth=Math.round($scope.totalChargesPerMonth),$scope.calcAgreementAmount(),"undefined"!=typeof $scope.signup.billingCycle&&null!==$scope.signup.billingCycle&&$scope.calcBillingCycleAmount($scope.signup.billingCycle,"Custom"===$scope.signup.billingCycle?!0:!1)},$scope.calcBillingCycleAmount=function(billingCycleTerm,isCustom){$scope.totalForBillingCycle=0;var term=null!==billingCycleTerm&&void 0!==billingCycleTerm?billingCycleTerm.toLowerCase().replace("-",""):0,billingMonths={monthly:1,quaterly:3,semiannually:6,anually:12},billingTerm=0,candidatesTotal=0,bundlesTotal=0;if(billingTerm=isCustom!==!0?parseInt(billingMonths[term]):parseInt($scope.signup.customMonths),$scope.totalForBillingCycle=parseFloat($scope.totalChargesPerMonth*billingTerm),$scope.isEditMode){if($scope.signup.camount=0,$scope.signup.camountOverride=0,$scope.signup.hiringLicencePrice>$scope.editSignup.hiringLicencePrice){var hiringLicencePrice=($scope.signup.hiringLicencePrice-$scope.editSignup.hiringLicencePrice)/_month*$scope.remainingDays;$scope.signup.camount+=hiringLicencePrice}if($scope.signup.platformLicencePrice>$scope.editSignup.platformLicencePrice){var platformLicencePrice=($scope.signup.platformLicencePrice-$scope.editSignup.platformLicencePrice)/_month*$scope.remainingDays;$scope.signup.camount+=platformLicencePrice}var existingCandidates="undefined"==typeof $scope.editSignup.candidateTotalAmount||null===$scope.editSignup.candidateTotalAmount?0:$scope.editSignup.candidateTotalAmount;"undefined"==typeof $scope.editSignup.bundleTotalAmount||null===$scope.editSignup.bundleTotalAmount?0:$scope.editSignup.bundleTotalAmount;$scope.signup.candidateTotalAmount>existingCandidates&&($scope.signup.camount+=null!==$scope.signup.candidateTotalAmount&&void 0!==$scope.signup.candidateTotalAmount&&$scope.signup.candidateTotalAmount>0?$scope.signup.candidateTotalAmount:0),$scope.signup.bundleTotalAmount>existingCandidates&&($scope.signup.camount+=null!==$scope.signup.bundleTotalAmount&&void 0!==$scope.signup.bundleTotalAmount&&$scope.signup.bundleTotalAmount>0?$scope.signup.bundleTotalAmount:0),$scope.signup.camount+=$scope.proRatedTotals.members,$scope.signup.camount+=$scope.proRatedTotals.admins,$scope.signup.camount+=$scope.proRatedTotals.hiringAdmins,$scope.signup.camountOverride=parseFloat($scope.signup.camount).toFixed(2),$scope.signup.camountOverride=Math.round($scope.signup.camountOverride)}else candidatesTotal=null!==$scope.signup.candidateTotalAmount&&void 0!==$scope.signup.candidateTotalAmount&&$scope.signup.candidateTotalAmount>0?$scope.signup.candidateTotalAmount:0,bundlesTotal=null!==$scope.signup.bundleTotalAmount&&void 0!==$scope.signup.bundleTotalAmount&&$scope.signup.bundleTotalAmount>0?$scope.signup.bundleTotalAmount:0,$scope.signup.camountOverride=$scope.signup.camount=Math.round($scope.totalForBillingCycle+bundlesTotal+candidatesTotal)},$scope.signup.showHiringFeature===!1&&($scope.candidateOverrideCheckbox=!1,$scope.signup.candidateTotalAmount=0,$scope.signup.candidateCount=null,$scope.signup.candidatePrice=null,$scope.signup.overrideCandidateAmount=null,$scope.bundleOverrideCheckbox=!1,$scope.signup.bundleTotalAmount=0,$scope.signup.bundleCount=null,$scope.signup.bundlePrice=null,$scope.signup.overrideBundleAmount=0,$scope.hiringAdminOverrideCheckbox=!1,$scope.signup.hiringAdminTotalAmount=0,$scope.signup.hiringAdminCount=null,$scope.signup.hiringAdminPrice=null,$scope.signup.overrideHiringAdminAmount=null,$scope.signup.hiringLicencePrice=null,$scope.updateTotalPerMonth()),$scope.foramttedDate=function(dateObj){return dateObj.month.toUpperCase().substring(0,3)+" "+dateObj.dayOfMonth+", "+dateObj.year},$scope.getTotalPrice=function(priceObj){var totalPrice=0;return totalPrice=null!==priceObj.unitPrice&&"undefined"!=typeof priceObj.unitPrice&&0!==priceObj.unitPrice?parseFloat(priceObj.unitPrice*priceObj.noOfAccounts).toFixed(2):parseFloat(priceObj.overridePrice).toFixed(2)},$scope.getAccountCount=function(type,plan){var count=0;return"Members"===type&&"Primary"===plan?jQuery.each($scope.paymentsPrimary,function(i,j){"PlanMember"===$scope.paymentsPrimary[i].accountUpdateType&&(count+=parseInt($scope.paymentsPrimary[i].noOfAccounts))}):"Admins"===type&&"Primary"===plan&&jQuery.each($scope.paymentsPrimary,function(i,j){"PlanAdmin"===$scope.paymentsPrimary[i].accountUpdateType&&(count+=parseInt($scope.paymentsPrimary[i].noOfAccounts))}),count},$scope.getgrandTotal=function(type,plan){var count=0;return"Members"===type&&"Primary"===plan?jQuery.each($scope.paymentsPrimary,function(i,j){"PlanMember"===$scope.paymentsPrimary[i].accountUpdateType&&(count+=$scope.paymentsPrimary[i].overridePrice>0?$scope.paymentsPrimary[i].overridePrice:$scope.paymentsPrimary[i].unitPrice*$scope.paymentsPrimary[i].noOfAccounts)}):"Admins"===type&&"Primary"===plan&&jQuery.each($scope.paymentsPrimary,function(i,j){"PlanAdmin"===$scope.paymentsPrimary[i].accountUpdateType&&(count+=$scope.paymentsPrimary[i].overridePrice>0?$scope.paymentsPrimary[i].overridePrice:$scope.paymentsPrimary[i].unitPrice*$scope.paymentsPrimary[i].noOfAccounts)}),count},$scope.updateSerializeFlags=function(ih){var flag="undefined"==typeof ih||null===ih?!1:ih;$scope.isEditMode===!1?($scope.serializeIgnore=flag?!1:!0,$scope.candidateOverrideCheckbox=!1,$scope.signup.candidateTotalAmount=0,$scope.signup.candidateCount=null,$scope.signup.candidatePrice=null,$scope.signup.overrideCandidateAmount=null,$scope.bundleOverrideCheckbox=!1,$scope.signup.bundleTotalAmount=0,$scope.signup.bundleCount=null,$scope.signup.bundlePrice=null,$scope.signup.overrideBundleAmount=null,$scope.updateHiringAccountSummary("Bundle"),$scope.updateTotalPerMonth()):$scope.existingHiringPlan===!1&&flag===!1?$scope.serializeIgnore=!0:$scope.serializeIgnore=!1,"Bundles"===$scope.hiringPackageType?$scope.updatePackageFlag("Bundles"):$scope.updatePackageFlag("Candidates")},$scope.updatePackageFlag=function(type){$scope.signup.hiringPackageFlag=null,$scope.signup.hiringPackageFlag=type,"Bundles"===$scope.signup.hiringPackageFlag?($scope.candidateOverrideCheckbox=!1,$scope.signup.candidateTotalAmount=0,$scope.signup.candidateCount=null,$scope.signup.candidatePrice=null,$scope.signup.overrideCandidateAmount=null,$scope.updateHiringAccountSummary("Bundle"),$scope.updateTotalPerMonth()):"Candidates"===$scope.signup.hiringPackageFlag&&($scope.bundleOverrideCheckbox=!1,$scope.signup.bundleTotalAmount=0,$scope.signup.bundleCount=null,$scope.signup.bundlePrice=null,$scope.signup.overrideBundleAmount=null,$scope.updateHiringAccountSummary("Candidate"),$scope.updateTotalPerMonth())},$scope.updateMonthsDays=function(days){var summary,totalMonths=Math.floor(days/30),totalDays=days%30;return summary=totalMonths>=1?totalMonths+" Months "+totalDays+" Days":"0 Months "+totalDays+" Days"},$scope.getAccountInfo=function(isAddCredit){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/account/businessAccountDetails",data:$.param({accountId:sharedProperties.getParam("accountId"),isEditAccountRequest:!0})}).then(function(response){if("true"===response.Success)if(isAddCredit)$scope.account.account.creditBalance=response.account.creditBalance;else{$scope.signup={},$scope.account=response,$scope.creditInfo.cpt=response.account.paymentInstrument.paymentType,$scope.creditInfo.ccomment=response.account.paymentInstrument.comment;var primaryPlan=$scope.account.account.spPlans.Primary,hiringPlan=$scope.account.account.spPlans.IntelligentHiring,isHiringPlanAvailable=null!==hiringPlan&&"undefined"!=typeof hiringPlan?!0:!1,billingMonths={monthly:1,quaterly:3,semiannually:6,anually:12};$scope.existingHiringPlan=isHiringPlanAvailable?!0:!1,$scope.existingBillingDays="Custom"!==$scope.account.account.accountInfo.planBillingCycleType?parseInt(billingMonths[$scope.account.account.accountInfo.planBillingCycleType.toLowerCase().replace("-","")]):parseInt($scope.account.account.accountInfo.planBillingCycle),$scope.remainingDays=$scope.account.account.remainingChargableDays,$scope.remainingDaysInCycle=$scope.updateMonthsDays($scope.account.account.remainingChargableDays),$scope.primaryPlansFeatures=primaryPlan.features,$scope.paymentsPrimary=$scope.account.account.spPlans.Primary.updateDetails,$scope.paymentsHiring=isHiringPlanAvailable?$scope.account.account.spPlans.IntelligentHiring.updateDetails:[],$scope.memberOverrideCheckbox="undefined"!=typeof primaryPlan.overrideMemberPrice&&null!==primaryPlan.overrideMemberPrice&&primaryPlan.overrideMemberPrice>0?!0:!1,$scope.adminOverrideCheckbox="undefined"!=typeof primaryPlan.overrideAdminPrice&&null!==primaryPlan.overrideAdminPrice&&primaryPlan.overrideAdminPrice>0?!0:!1,$scope.memberOverrideCheckboxEdit="undefined"!=typeof primaryPlan.overrideMemberPrice&&null!==primaryPlan.overrideMemberPrice&&primaryPlan.overrideMemberPrice>0?!0:!1,$scope.adminOverrideCheckboxEdit="undefined"!=typeof primaryPlan.overrideAdminPrice&&null!==primaryPlan.overrideAdminPrice&&primaryPlan.overrideAdminPrice>0?!0:!1,$scope.hiringAdminOverrideCheckbox=isHiringPlanAvailable&&"undefined"!=typeof hiringPlan.overrideAdminPrice&&null!==hiringPlan.overrideAdminPrice&&hiringPlan.overrideAdminPrice>0?!0:!1,$scope.hiringAdminOverrideCheckboxEdit=isHiringPlanAvailable&&"undefined"!=typeof hiringPlan.overrideAdminPrice&&null!==hiringPlan.overrideAdminPrice&&hiringPlan.overrideAdminPrice>0?!0:!1,$scope.hiringPackageType=isHiringPlanAvailable&&hiringPlan.isBundle===!0?"Bundles":"Candidates",$scope.bundleOverrideCheckbox=isHiringPlanAvailable&&hiringPlan.isBundle&&"undefined"!=typeof hiringPlan.overrideMemberPrice&&null!==hiringPlan.overrideMemberPrice&&hiringPlan.overrideMemberPrice>0?!0:!1,$scope.candidateOverrideCheckbox=isHiringPlanAvailable&&!hiringPlan.isBundle&&"undefined"!=typeof hiringPlan.overrideMemberPrice&&null!==hiringPlan.overrideMemberPrice&&hiringPlan.overrideMemberPrice>0?!0:!1,$scope.signup={planName:primaryPlan.planName,agreement:0===primaryPlan.aggrementTerm?null:primaryPlan.aggrementTerm.toString(),platformLicencePrice:primaryPlan.licensePrice,memberCount:primaryPlan.availalbeMemberSubscriptions,memberPrice:null!==primaryPlan.unitMemberPrice&&"undefined"!=typeof primaryPlan.unitMemberPrice?primaryPlan.unitMemberPrice:0,overrideMemberAmount:null!==primaryPlan.overrideMemberPrice&&"undefined"!=typeof primaryPlan.overrideMemberPrice?primaryPlan.overrideMemberPrice:0,adminCount:primaryPlan.availalbeAdminSubscriptions,adminPrice:null!==primaryPlan.unitAdminPrice&&"undefined"!=typeof primaryPlan.unitAdminPrice?primaryPlan.unitAdminPrice:0,overrideAdminAmount:null!==primaryPlan.overrideAdminPrice&&"undefined"!=typeof primaryPlan.overrideAdminPrice?primaryPlan.overrideAdminPrice:0,intellgentHiring:isHiringPlanAvailable,spMatchCheck:isHiringPlanAvailable&&"SPMatch"===hiringPlan.features[0]?!0:!1,hiringLicencePrice:isHiringPlanAvailable?hiringPlan.licensePrice:null,hiringAgreement:isHiringPlanAvailable?0===hiringPlan.aggrementTerm?null:hiringPlan.aggrementTerm.toString():null,hiringAdminCount:isHiringPlanAvailable&&hiringPlan.availalbeAdminSubscriptions?hiringPlan.availalbeAdminSubscriptions:null,hiringAdminPrice:isHiringPlanAvailable&&null!==hiringPlan.unitAdminPrice&&"undefined"!=typeof hiringPlan.unitAdminPrice?hiringPlan.unitAdminPrice:0,overrideHiringAdminAmount:isHiringPlanAvailable&&null!==hiringPlan.overrideAdminPrice&&"undefined"!=typeof hiringPlan.overrideAdminPrice?hiringPlan.overrideAdminPrice:0,bundleCount:isHiringPlanAvailable&&"Bundles"===$scope.hiringPackageType?hiringPlan.availalbeMemberSubscriptions/$scope.hiringBundle:0,bundlePrice:isHiringPlanAvailable&&"Bundles"===$scope.hiringPackageType&&null!==hiringPlan.unitMemberPrice&&"undefined"!=typeof hiringPlan.unitMemberPrice?hiringPlan.unitMemberPrice*$scope.hiringBundle:0,overrideBundleAmount:isHiringPlanAvailable&&"Bundles"===$scope.hiringPackageType&&null!==hiringPlan.overrideMemberPrice&&"undefined"!=typeof hiringPlan.overrideMemberPrice?hiringPlan.overrideMemberPrice:0,candidateCount:isHiringPlanAvailable&&"Bundles"!==$scope.hiringPackageType?hiringPlan.availalbeMemberSubscriptions:null,candidatePrice:isHiringPlanAvailable&&"Bundles"!==$scope.hiringPackageType&&null!==hiringPlan.unitMemberPrice&&"undefined"!=typeof hiringPlan.unitMemberPrice?hiringPlan.unitMemberPrice:0,overrideCandidateAmount:isHiringPlanAvailable&&"Bundles"!==$scope.hiringPackageType&&null!==hiringPlan.overrideMemberPrice&&"undefined"!=typeof hiringPlan.overrideMemberPrice?hiringPlan.overrideMemberPrice:0,cpt:$scope.account.account.paymentType,billingCycle:$scope.account.account.accountInfo.planBillingCycleType,camount:$scope.account.account.accountInfo.renewalTotal,customMonths:-1===jQuery.inArray($scope.account.account.planBillingCycleType)?$scope.account.account.accountInfo.planBillingCycle:null},$scope.editSignup=angular.copy($scope.signup),$scope.signup.intellgentHiring===!0&&($scope.featuresSectionHiring=!0),primaryPlan.features.length&&($scope.featuresSectionPrimary=!0,jQuery.each(primaryPlan.features,function(i){$scope.toggleFeatureSelection(primaryPlan.features[i])})),$timeout(function(){$scope.updateTotalPerMonth(),$scope.updateMemberAccountSummary("Member"),$scope.signup.adminCount>0&&$scope.updateMemberAccountSummary("Admin"),$scope.signup.intellgentHiring&&($scope.signup.hiringAdminCount>0&&$scope.updateHiringAccountSummary(),"Bundles"===$scope.hiringPackageType?($scope.updateHiringAccountSummary("Bundle"),$scope.updatePackageFlag("Bundles")):($scope.updateHiringAccountSummary("Candidate"),$scope.updatePackageFlag("Candidates"))),$scope.updateSerializeFlags()},100)}else{$scope.serverError=!0;for(var key in response.error)$scope.errorMessage=response.error[key]}})},$scope.getMembersModal=function(){$scope.isCompanySelect=!0,$scope.isMemberSelect=!1,$scope.inputRequired=!1,$scope.disableEmail=!1,ajaxService.getAjaxResponse({url:"/sp/sysAdmin/hk/getCompanyList",method:"GET"}).then(function(response){if("true"===response.Success)$scope.companyList=response.companies,ngDialog.open({template:"/sp/resources/html/sysAdmin/alternateBilling/memberModal.html",scope:$scope});else if(null!=response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$scope.getCompanyMembers=function(id,name,city,country){$scope.isCompanySelect=!1,$scope.storeCompany={name:name,city:city,country:country},ajaxService.getAjaxResponse({url:"/sp/sysAdmin/alternateBilling/allCompanyMembers",data:$.param({companyId:id})}).then(function(response){if("true"===response.Success)$scope.isMemberSelect=!0,$scope.emailMemberList=response.memberList;else if(null!=response.error){ngDialog.close("ngdialog1");var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$scope.searchTag=[],$scope.inputRequired=!1,$scope.loadTags=function(query){var deferred=$q.defer(),result=$scope.emailMemberList.filter(function(e){return-1!==e.name.toLowerCase().indexOf(query.toLowerCase())||-1!==e.email.toLowerCase().indexOf(query.toLowerCase())});return deferred.resolve(result),deferred.promise},$scope.tagAdded=function(tag){$scope.searchTag.push(tag.email);var isAccountAdmin=-1!==tag.roles.indexOf("AccountAdministrator")?!0:!1;isAccountAdmin?$scope.inputRequired=!0:($scope.inputRequired=!1,$scope.selectedUser=tag)},$scope.tagRemoved=function(tag){$scope.selectedUser=null,$scope.inputRequired=!1,$scope.searchTag.splice($scope.searchTag.indexOf(tag.email),1)},$scope.userMemberDetails=function(userObj){$scope.signup={firstName:userObj.firstName,lastName:userObj.lastName,title:userObj.title,email:userObj.email,confirmEmail:userObj.email,existingMember:!0,industry:"default",country:"default"},$scope.disableEmail=!0,ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:"Member details added."})},function(){$scope.updatePackageFlag("Bundles"),$scope.isEditMode=null!==sharedProperties.getParam("accountId")&&"undefined"!=typeof sharedProperties.getParam("accountId")?!0:!1,$scope.isEditMode&&($scope.getAccountInfo(),$scope.accountId=sharedProperties.getParam("accountId"))}()}angular.module("spApp").controller("signUpController",signUpController),signUpController.$inject=["$scope","$http","$element","$attrs","ajaxService","$location","$state","$localStorage","sharedProperties","$timeout","ngDialog","$q"];
function siteHeaderController($scope,$rootScope,userDataService,ajaxService,$localStorage){$scope.userProfile={},$scope.navLoaded=!1,$scope.showNav=!1,$scope.navigationTrue=!1,$scope.isSuperAdmin=!1,$scope.logout=function(){window.location.href="/sp/logout"},$scope.createNavigation=function(){this.getUserProfile=function(){ajaxService.getAjaxResponse({url:"/sp/signedIn/getProfile"}).then(function(response){if("true"===response.Success){$scope.userProfile=response.member;var userRoles=$scope.userProfile.roles;$scope.isSuperAdmin=-1!==userRoles.indexOf("SuperAdministrator")?!0:!1,$localStorage.set("loggegdInProfile",response),$scope.headerFn.welcomeConsole($localStorage.get("loggegdInProfile").member.name),userDataService.save(response);var userCookie={};userCookie.uid=response.member.id,userCookie.cid=response.member.companyId,setCookie("udata",JSON.stringify(userCookie),14)}})},this.getSiteNavigation=function(){ajaxService.getAjaxResponse({url:"/sp/navigation/get"}).then(function(response){"true"===response.Success&&($scope.headerFn.clubJsonResponse(response),$scope.mainNavLinks=response.navigation.navigationList,$scope.mainNavLinksCached=response.navigation.navigationList,$scope.navLoaded=!0)})},this.clubJsonResponse=function(response){$localStorage.set("globalNav",response)},this.cacheHtml=function(clone){var html=$(clone).html();$localStorage.set("navHtml",html),$scope.headerFn.classToggle(clone)},this.classToggle=function(classs){var $classTake=$(classs),url=window.location.pathname+window.location.hash,parentId="",childrenId="",colorPanel=!1;$classTake.find("section").after(" "),$classTake.closest(".container").removeClass("blueBar"),"/sp/admin/group#/profile"===url&&(url="/sp/admin/group#/group");for(var key in $scope.mainNavLinksCached)if(null!=$scope.mainNavLinksCached[key].children)for(var childKey in $scope.mainNavLinksCached[key].children)if("undefined"!=typeof $scope.mainNavLinksCached[key].children[childKey].activeKeys)for(var i=0;i<$scope.mainNavLinksCached[key].children[childKey].activeKeys.length;i++)if(url.indexOf($scope.mainNavLinksCached[key].children[childKey].activeKeys[i])>-1){childrenId=$scope.mainNavLinksCached[key].children[childKey].id,parentId=$scope.mainNavLinksCached[key].id,colorPanel="undefined"!=typeof $scope.mainNavLinksCached[key].children[childKey].color?$scope.mainNavLinksCached[key].children[childKey].color:!1;break}$classTake.find("section").after(" "),$classTake.closest(".container").removeClass("blueBar"),$classTake.find("h2").removeClass("active"),$classTake.find("ul li").removeClass("active").closest("ul").removeClass("active"),$classTake.find("h2[data-slide='"+parentId+"']").addClass("active"),$classTake.find("ul li[data-slide='"+childrenId+"']").addClass("active").closest("ul").addClass("active"),colorPanel&&$classTake.find("ul.active").closest(".container").addClass(colorPanel),$scope.navigationTrue=!0;var activeTxt=$(".reposition-nav").find("li.active a").html();$(".breadcrumb-title").html(activeTxt),$(".nav-dashboard h2 a").on("click",function(e){var $this=$(this),$html=$this.closest("section"),$hideWrap=$html.find(".hide-wrap"),$subLinkHeight=($html.find("ul"),"auto");$(".showPos").length&&(0===$hideWrap.height()?($hideWrap.height($subLinkHeight),$html.closest("div").find(".hide-wrap").not($hideWrap).height(0)):$hideWrap.height(0),e.preventDefault())}).stop()},this.localstorageCheck=function(key){return null===$localStorage.get(key)},this.bodyAil=function(body,$target,container){$(body).on("click",function(e){$(".nice-name-info").is(e.target)||0!==$(".nice-name-info").has(e.target).length||$target.removeClass("show")})},this.activate=function(classs,_target){var $target=$(_target);$(document).on("click",classs,function(event){$target.hasClass("show")?($target.removeClass("show"),event.stopPropagation()):($target.addClass("show"),event.stopPropagation())})},this.bindEvent=function(){$scope.headerFn.bodyAil("body",$(".nav-nice-name-tools"),$(".nice-name-info")),$scope.headerFn.activate(".nice-name-info",".nav-nice-name-tools")},this.welcomeConsole=function(name){-1!==navigator.userAgent.indexOf("Firefox")?console.log("\nWelcome %s to SUREPEOPLE\nLearn about our intelligent learning, development and hiring platform that drives performance and innovation for companies worldwide.\n",name):console.log("%cWelcome %s to SUREPEOPLE\n%c\nLearn about our intelligent learning, development and hiring platform that drives performance and innovation for companies worldwide.\n","color: #ff6633; font-size: 24px",name,"color: black; font-size: 18px")},this.init=function(){if(this.localstorageCheck("loggegdInProfile"))this.getUserProfile();else{var storedProfile=$localStorage.get("loggegdInProfile");$scope.userProfile=storedProfile.member,userDataService.save($localStorage.get("loggegdInProfile"));var userRoles=$scope.userProfile.roles;$scope.isSuperAdmin=-1!==userRoles.indexOf("SuperAdministrator")?!0:!1,this.welcomeConsole(storedProfile.member.name)}if(this.localstorageCheck("globalNav"))this.getSiteNavigation();else{var storedGlobalNav;this.localstorageCheck("navHtml")?(storedGlobalNav=$localStorage.get("globalNav"),$scope.mainNavLinks=storedGlobalNav.navigation.navigationList,$scope.mainNavLinksCached=storedGlobalNav.navigation.navigationList):($(".nav-main-app-toc").html($localStorage.get("navHtml")),storedGlobalNav=$localStorage.get("globalNav"),$scope.mainNavLinksCached=storedGlobalNav.navigation.navigationList,this.classToggle(".nav-main-app-toc")),$scope.navLoaded=!0}this.bindEvent()}},function(){$scope.headerFn=new $scope.createNavigation,$scope.headerFn.init()}();var setCookie=function(cookieName,cookieValue,days){var date,expires;days?(date=new Date,date.setTime(date.getTime()+24*days*60*60*1e3),expires="; expires="+date.toGMTString()):expires="",document.cookie=cookieName+"="+cookieValue+expires+";path=/; domain=.surepeople.com"}}function assessmentHeader($timeout){return{restrict:"A",link:function($scope,$element,$attrs){var addAssessmentBrdr=function(){var isAssessment=$(".assessment-template-wrapper"),isNonLogged=$(".non-logged-header"),theHeaderAssessment=$("#header"),signInPage=$(".sign-in-default");signInPage.length||"#/reset"===window.location.hash?theHeaderAssessment.addClass("signInBorder"):(isAssessment.length||isNonLogged.length)&&(window.localStorage.clear(),theHeaderAssessment.addClass("addOrangeBrdr"))};addAssessmentBrdr(),$scope.$watch(function(){return $attrs.ready},function(){$timeout(function(){addAssessmentBrdr()},100)})}}}angular.module("spApp").controller("siteHeaderController",siteHeaderController),siteHeaderController.$inject=["$scope","$rootScope","userDataService","ajaxService","$localStorage"],angular.module("spApp").directive("assessmentHeader",assessmentHeader),assessmentHeader.$inject=["$timeout"];
function spectrumController($scope,ajaxService,$localStorage,$timeout,$rootScope,ngDialog,$state,sharedProperties){function animate(){$("html,body").animate({scrollTop:$(".spectrum-filter-toggle").offset().top-80},300)}function calculateHeight(event){var obj=$("#"+event);obj.height()>vm.pageSetting.heightParam&&obj.addClass("scroller")}function checkPermission(){var permissions=$localStorage.get("loggegdInProfile").member.roles;vm.permissionLevel={prism:-1!==permissions.indexOf("Prism"),blueprint:-1!==permissions.indexOf("Blueprint"),analytics:-1!==permissions.indexOf("Prism"),org:-1!==permissions.indexOf("OrganizationPlan"),insights:-1!==permissions.indexOf("Prism"),competency:-1!==permissions.indexOf("Competency")},vm.permissionLevel.prism?vm.routeToState("profile"):vm.permissionLevel.analytics?vm.routeToState("analytics"):vm.permissionLevel.insights?vm.routeToState("insights"):vm.permissionLevel.org?vm.routeToState("org"):vm.permissionLevel.blueprint?vm.routeToState("blueprint"):vm.permissionLevel.competency&&vm.routeToState("competency"),$state.go("visual")}function filterOpen(state){vm.routeToState(state),$("html,body").animate({scrollTop:$(".spectrum-filter-toggle").offset().top-80},300),vm.filterEnable=!0}function routeToState(state){if(vm.viewBox[state])return!0;switch(vm.pageSetting=angular.copy(vm.originalPageSetting),vm.routeStateMode=state,vm.chartDataReady=!1,state){case"profile":Object.keys(vm.personalityBalance).length?vm.profileBalanceFilterLogic():vm.getProfileBalance(),vm.moduleNameForAnalytics="PERSONALITY BALANCE",vm.filterNameForAnalytics="Groups";break;case"blueprint":Object.keys(vm.blueprintAnalytics).length?vm.blueprintFilterLogic():vm.getBlueprint(),vm.moduleNameForAnalytics="BLUEPRINT ANALYTICS",vm.filterNameForAnalytics="Groups";break;case"analytics":Object.keys(vm.analytics).length?vm.ertAnalyticFilterLogic():vm.getErtAnalytics(),vm.moduleNameForAnalytics="ERT-i ANALYTICS",vm.filterNameForAnalytics="Personality";break;case"insights":Object.keys(vm.insights).length?vm.ertInsightsFilterLogic():vm.getErtInsights(),vm.moduleNameForAnalytics="ERT-i INSIGHTS",vm.filterNameForAnalytics="Traits & Attributes";break;case"org":Object.keys(vm.orgPlan).length?vm.orgPlanFilterLogic():vm.getOrganizationPlanActivities(),vm.moduleNameForAnalytics="ORGANIZATION PLAN ACTIVITY",vm.filterNameForAnalytics="Organizational Plans";break;case"competency":null!==vm.competencyPlan&&Object.keys(vm.competencyPlan).length?vm.competencyFilterLogic():vm.getCompetency(),vm.moduleNameForAnalytics="COMPETENCY INSIGHTS",vm.filterNameForAnalytics="Competency Profile"}sharedProperties.fireAnalyticsEvent("Spectrum | View Module",vm.moduleNameForAnalytics)}function available(a,b){var result=0;breakAvailable:for(var i=0;i<b.length;i++)for(var j=0;j<a.length;j++)if(b[i]===a[j]){result=1;break breakAvailable}return result}function inBetween(age,number){for(var result=0,i=0;i<number.length;i++){var splitNumber=number[i].split("-");age>=splitNumber[0]&&age<=splitNumber[1]&&result++}return result}function stateMode(){switch(vm.routeStateMode){case"profile":vm.profileBalanceFilterLogic();break;case"blueprint":vm.blueprintFilterLogic();break;case"insights":vm.ertInsightsFilterLogic();break;case"org":vm.orgPlanFilterLogic();break;case"analytics":vm.ertAnalyticFilterLogic();break;case"competency":vm.competencyFilterLogic()}}function returnClampName(name,length){return name=name.length>length?name.substring(0,length)+"...":name}function getProfileBalance(){ajaxService.getAjaxResponse({url:vm.config.getProfileBalance}).then(function(response){"true"===response.Success?(vm.personalityBalance=response.profileBalance,buildMasterDataSet()):null!=response.error&&(vm.profileChartNoData=!0)})}function getBlueprint(){ajaxService.getAjaxResponse({url:vm.config.getBlueprint}).then(function(response){"true"===response.Success?(vm.blueprintAnalytics=response.bluePrintAnalytics,vm.blueprintFilterLogic()):null!=response.error&&(vm.profileChartNoData=!0)})}function getErtInsights(){ajaxService.getAjaxResponse({url:vm.config.getErtInsights}).then(function(response){"true"===response.Success?(vm.insights=response.ertiInsights,vm.ertInsightsFilterLogic()):null!=response.error&&(vm.profileChartNoData=!0)})}function getOrganizationPlanActivities(){ajaxService.getAjaxResponse({url:vm.config.getOrganizationPlanActivities}).then(function(response){if("true"===response.Success){var arr=[];if(null!==response.organizationPlanActivities.spectrumFilter){for(var key in response.organizationPlanActivities.spectrumFilter.filters.organizationPlan)arr.push(response.organizationPlanActivities.spectrumFilter.filters.organizationPlan[key]);response.organizationPlanActivities.spectrumFilter.filters.organizationPlan=arr}vm.orgPlan=response.organizationPlanActivities,vm.orgPlanFilterLogic()}else null!=response.error&&(vm.profileChartNoData=!0)})}function getErtAnalytics(){ajaxService.getAjaxResponse({url:vm.config.getErtAnalytics}).then(function(response){"true"===response.Success?(vm.analytics=response.ertiAnalytics,vm.ertAnalyticFilterLogic()):null!=response.error&&(vm.profileChartNoData=!0)})}function getCompetency(id){ajaxService.getAjaxResponse({url:vm.config.getCompetency,data:$.param({competencyId:id})}).then(function(response){"true"===response.Success?void 0===id?(vm.competencyPlan=response.competencyAnalytics,null!==vm.competencyPlan&&vm.competencyPlan.competencyDurations.length?(vm.noData=!1,vm.pageSetting.competencyProfile=-1,vm.competencyFilterLogic()):(vm.noData=!0,vm.chartDataReady=!1,vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!0})):(vm.pageSetting.memberSearch="",vm.pageSetting.competencySelected=[],response.competencyAnalytics.competencyEvaluation.evaluationMap.hasOwnProperty(vm.pageSetting.competencyProfile)||(vm.pageSetting.competencyProfile=-1),vm.competencyPlan.competencyEvaluation=response.competencyAnalytics.competencyEvaluation,vm.competencyFilterLogic()):null!=response.error&&(vm.noData=!0,vm.chartDataReady=!1,vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!0})})}function competencyFilterLogic(){vm.userScreen=!1,vm.competencyPlanGraphData=[],vm.pageSetting.total=0,vm.competencyRequired={self:-1!==vm.competencyPlan.competencyEvaluation.requiredEvaluationList.indexOf("Self"),manager:-1!==vm.competencyPlan.competencyEvaluation.requiredEvaluationList.indexOf("Manager")},vm.pageSetting.sort=vm.competencyRequired.manager?"plus":"selfplus",-1===vm.pageSetting.competencyDuration&&(vm.pageSetting.competencyDuration=vm.competencyPlan.competencyDurations[0].competencyEvaludationId),-1===vm.pageSetting.competencyProfile&&(vm.pageSetting.competencyProfile=Object.keys(vm.competencyPlan.competencyEvaluation.evaluationMap)[0]);var data=angular.copy(vm.competencyPlan.competencyEvaluation.evaluationMap[vm.pageSetting.competencyProfile].userEvaluationMap);if(vm.pageSetting.total=Object.keys(data).length,vm.pageSetting.competencySelected.length)for(var key in data){if(null!==data[key].selfEvaluation){for(var i=data[key].selfEvaluation.competencyScore.length-1,number=0,divisble=0;i>=0;i--)-1!==vm.pageSetting.competencySelected.indexOf(data[key].selfEvaluation.competencyScore[i].name)?(number+=data[key].selfEvaluation.competencyScore[i].score,divisble++):data[key].selfEvaluation.competencyScore.splice(i,1);data[key].selfEvaluation.score=0===number?number:parseFloat(number/divisble).toFixed(2)}if(null!==data[key].managerEvaluation){for(var j=data[key].managerEvaluation.competencyScore.length-1,jnumber=0,jdivisble=0;j>=0;j--)-1!==vm.pageSetting.competencySelected.indexOf(data[key].managerEvaluation.competencyScore[j].name)?(jnumber+=data[key].managerEvaluation.competencyScore[j].score,jdivisble++):data[key].managerEvaluation.competencyScore.splice(j,1);data[key].managerEvaluation.score=0===jnumber?jnumber:parseFloat(jnumber/jdivisble).toFixed(2)}}sortObject(data),vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!0},vm.chartDataReady=!0}function sortObject(obj){var prop,arr=[];for(prop in obj)obj.hasOwnProperty(prop)&&arr.push(obj[prop]);vm.competencyPlanGraphData=arr,competencyOrder(vm.pageSetting.sort)}function competencyOrder(sort){vm.competencyPlanGraphData.sort(function(a,b){var an=null===a.selfEvaluation?-1:a.selfEvaluation.score,bn=null===b.selfEvaluation?-1:b.selfEvaluation.score,am=null===a.managerEvaluation?-1:a.managerEvaluation.score,bm=null===b.managerEvaluation?-1:b.managerEvaluation.score,af=a.member.name,bf=b.member.name;switch(sort){case"selfplus":return an===bn?af===bf?0:+(af>bf)||-1:+(bn>an)||-1;case"selfminus":return an===bn?af===bf?0:+(af>bf)||-1:+(an>bn)||-1;case"plus":return am===bm?af===bf?0:+(af>bf)||-1:+(bm>am)||-1;case"minus":return am===bm?af===bf?0:+(af>bf)||-1:+(am>bm)||-1}})}function competencyDate(data){vm.getCompetency(data)}function changeCompetency(){vm.pageSetting.memberSearch="",vm.pageSetting.competencySelected=[],vm.competencyFilterLogic()}function orgOrderBy(sort){for(var percent=0,i=0;i<vm.orgPlanGraphData.length;i++){percent+=vm.orgPlanGraphData[i].completedKpiPercent;var totalKpi=vm.orgPlanGraphData[i].totalKpi;vm.orgPlanGraphData[i].userActivities.sort(function(a,b){var atotalCompletedKpi=void 0===a.totalCompletedKpi?a.completedLKpi:a.totalCompletedKpi,btotalCompletedKpi=void 0===b.totalCompletedKpi?b.completedLKpi:b.totalCompletedKpi,an=Math.round(atotalCompletedKpi/totalKpi*100)||0,bn=Math.round(btotalCompletedKpi/totalKpi*100)||0,af=a.firstName,bf=b.firstName;switch(sort){case"plus":return an===bn?af===bf?0:+(af>bf)||-1:+(bn>an)||-1;case"minus":return an===bn?af===bf?0:+(af>bf)||-1:+(an>bn)||-1}}),vm.orgPlanGraphData[i].orgPlanGroupActivities.sort(function(a,b){var atotalCompletedKpi=void 0===a.totalCompletedKpi?a.completedLKpi:a.totalCompletedKpi,btotalCompletedKpi=void 0===b.totalCompletedKpi?b.completedLKpi:b.totalCompletedKpi,an=Math.round(atotalCompletedKpi/(totalKpi*a.totalMembers)*100)||0,bn=Math.round(btotalCompletedKpi/(totalKpi*b.totalMembers)*100)||0,af=a.firstName,bf=b.firstName;switch(sort){case"plus":return an===bn?af===bf?0:+(af>bf)||-1:+(bn>an)||-1;case"minus":return an===bn?af===bf?0:+(af>bf)||-1:+(an>bn)||-1}})}vm.pageSetting.totalOrgPerc=parseFloat(percent/vm.orgPlanGraphData.length).toFixed(2)}function getMatch(a,b){for(var matches=[],i=0;i<a.length;i++)for(var e=0;e<b.length;e++)a[i]===b[e]&&matches.push(a[i]);return matches.length}function stepChanged(list){var match=vm.screenInfo.orgPlanSteps[vm.pageSetting.allSteps];vm.pageSetting.totalCompletedKpi=0,vm.pageSetting.totalKpi=0,vm.pageSetting.completedKpiPercent=0;for(var i=0,number=0,all=0;i<list.userActivities.length;i++)null!==list.userActivities[i].completedUserSteps&&null!==vm.pageSetting.allSteps&&""!==vm.pageSetting.allSteps?number=getMatch(list.userActivities[i].completedUserSteps,match.uids):(number=list.userActivities[i].completedLKpi,list.userActivities[i].totalKpi=list.totalKpi),null!==vm.pageSetting.allSteps&&""!==vm.pageSetting.allSteps?(list.userActivities[i].totalKpi=match.uids.length,all+=match.uids.length):all+=list.totalKpi,list.userActivities[i].totalCompletedKpi=number,vm.pageSetting.totalCompletedKpi+=number;vm.pageSetting.totalKpi=all,null===vm.pageSetting.allSteps||""===vm.pageSetting.allSteps?vm.pageSetting.completedKpiPercent=vm.screenInfo.completedKpiPercent:vm.pageSetting.completedKpiPercent=vm.percentCalc(all,vm.pageSetting.totalCompletedKpi);for(var ii=0,numberi=0;ii<list.orgPlanGroupActivities.length;ii++)numberi=null!==list.orgPlanGroupActivities[ii].completedGroupSteps&&null!==vm.pageSetting.allSteps&&""!==vm.pageSetting.allSteps?getMatch(list.orgPlanGroupActivities[ii].completedGroupSteps,match.uids):list.orgPlanGroupActivities[ii].completdKpi,list.orgPlanGroupActivities[ii].totalCompletedKpi=numberi;vm.orgOrderBy(vm.pageSetting.sort)}function ertOrderBy(sort){vm.analyticsGraphData.sort(function(a,b){var an=a.percent,bn=b.percent,ap=a.power,bp=b.power,af=a.firstName,bf=b.firstName;switch(sort){case"plus":return an===bn?ap===bp?af===bf?0:+(af>bf)||-1:+(bp>ap)||-1:+(bn>an)||-1;case"minus":return an===bn?ap===bp?af===bf?0:+(af>bf)||-1:+(ap>bp)||-1:+(an>bn)||-1}})}function mapToTriat(){var checkvalue=2===arguments.length?0:50;vm.pageSetting.allTrait.hasOwnProperty(arguments[0])?(vm.pageSetting.allTrait[arguments[0]][arguments[1]]={currentValue:checkvalue,checked:!1},void 0!==arguments[2]&&(vm.pageSetting.allTrait[arguments[0]][arguments[2]]={currentValue:checkvalue,checked:!1})):(vm.pageSetting.allTrait[arguments[0]]={},vm.pageSetting.allTrait[arguments[0]][arguments[1]]={currentValue:checkvalue,checked:!1},void 0!==arguments[2]&&(vm.pageSetting.allTrait[arguments[0]][arguments[2]]={currentValue:checkvalue,checked:!1}))}function calucalteTiltGraph(){var bigData=(parseInt(vm.pageSetting.allTrait.Personality.Powerfull.currentValue,10)+parseInt(vm.pageSetting.allTrait.Personality.Versatile.currentValue,10))/2,detail=(parseInt(vm.pageSetting.allTrait.Personality.Precise.currentValue,10)+parseInt(vm.pageSetting.allTrait.Personality.Adaptable.currentValue,10))/2,mission=(parseInt(vm.pageSetting.allTrait.Personality.Powerfull.currentValue,10)+parseInt(vm.pageSetting.allTrait.Personality.Precise.currentValue,10))/2,relational=(parseInt(vm.pageSetting.allTrait.Personality.Versatile.currentValue,10)+parseInt(vm.pageSetting.allTrait.Personality.Adaptable.currentValue,10))/2;0===bigData&&0===detail&&0===mission&&0===relational?(vm.tilt.big=100,vm.tilt.detail=0,vm.tilt.mission=100,vm.tilt.relational=0):(bigData===detail?(vm.tilt.big=50,vm.tilt.detail=50):(vm.tilt.big=100-Math.round(bigData/(bigData+detail)*100),vm.tilt.detail=Math.round(detail/(bigData+detail)*100)),mission===relational?(vm.tilt.mission=50,vm.tilt.relational=50):(vm.tilt.mission=100-Math.round(mission/(mission+relational)*100),vm.tilt.relational=Math.round(relational/(mission+relational)*100)))}function conflictManagerChecked(category,name,name1,area){var primary=vm.pageSetting.allTrait[category][name].currentValue,secondary=vm.pageSetting.allTrait[category][name1].currentValue,checked=vm.pageSetting.allTrait[category][name].checked,existence=vm.pageSetting.traitSelectedOrder.indexOf(category),regExp=new RegExp(category,"g"),existenceCheck=vm.pageSetting.traitSelectedOrder.toString().match(regExp),existenceCount=null!==existenceCheck?existenceCheck.length>1:!1,lastIndex=existenceCount?vm.pageSetting.traitSelectedOrder.lastIndexOf(category):-1;checked?(0===primary||null===primary?(lastIndex>-1&&(area.splice(lastIndex,1),vm.pageSetting.traitSelectedOrder.splice(lastIndex,1)),existence>-1&&(area.splice(existence,1),vm.pageSetting.traitSelectedOrder.splice(existence,1))):null!==secondary&&primary===secondary&&(secondary=null,vm.pageSetting.allTrait[category][name1].currentValue=null),0!==primary&&null!==primary&&(primary.length&&existence>-1?area[existence]=primary:primary.length&&-1===existence&&(area.push(primary),vm.pageSetting.traitSelectedOrder.push(category))),null!==primary&&null!==secondary&&primary.length&&secondary.length?lastIndex>-1?area[lastIndex]=secondary:-1===lastIndex&&(area.push(secondary),vm.pageSetting.traitSelectedOrder.push(category)):null===primary||!primary.length||null!==secondary&&secondary.length||lastIndex>-1&&(area.splice(lastIndex,1),vm.pageSetting.traitSelectedOrder.splice(lastIndex,1))):existence>-1&&(lastIndex>-1&&(area.splice(lastIndex,1),vm.pageSetting.traitSelectedOrder.splice(lastIndex,1)),area.splice(existence,1),vm.pageSetting.traitSelectedOrder.splice(existence,1)),sharedProperties.fireAnalyticsEvent("Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+(null!==primary&&0!==primary?primary:"N/A")+(null!==secondary&&0!==secondary?", "+secondary:"")),stateMode()}function fundamentalNeedChecked(category,name,area){var i=vm.pageSetting.allTrait[category][name].currentValue,ii=vm.pageSetting.traitSelectedOrder.indexOf(category);("none"===i||null===i)&&ii>-1?(area.splice(ii,1),vm.pageSetting.traitSelectedOrder.splice(ii,1)):ii>-1?area[ii]=i:(area.push(i),vm.pageSetting.traitSelectedOrder.push(category)),sharedProperties.fireAnalyticsEvent("Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+i),stateMode()}function traitCheck(category,name,area){var i=$.inArray(name,area);i>-1?(area.splice(i,1),vm.pageSetting.traitSelectedOrder.splice(i,1),vm.pageSetting.allTrait[category][name].currentValue=0):(area.push(name),vm.pageSetting.traitSelectedOrder.push(category),vm.pageSetting.allTrait[category][name].currentValue=vm.pageSetting.personalityTypeDeviation),vm.calucalteTiltGraph(),sharedProperties.fireAnalyticsEvent("Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+name),stateMode()}function traitCheckTwo(category,name1,name2,area){var i=$.inArray(name1,area),j=$.inArray(name2,area);i>-1?(area.splice(j,1),area.splice(i,1),vm.pageSetting.traitSelectedOrder.splice(j,1),vm.pageSetting.traitSelectedOrder.splice(i,1)):(area.push(name1),area.push(name2),vm.pageSetting.traitSelectedOrder.push(category),vm.pageSetting.traitSelectedOrder.push(category)),sharedProperties.fireAnalyticsEvent("Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+name1+","+name2),stateMode()}function fundamentalNeedClear(category,name,area){var index=vm.pageSetting.traitSelectedOrder.indexOf(category);index>-1&&(area.splice(index,1),vm.pageSetting.traitSelectedOrder.splice(index,1)),vm.pageSetting.allTrait[category][name].currentValue="none",stateMode()}function conflictManagementclear(category,name,name1,area){var existence=vm.pageSetting.traitSelectedOrder.indexOf(category),regExp=new RegExp(category,"g"),existenceCheck=vm.pageSetting.traitSelectedOrder.toString().match(regExp),existenceCount=null!==existenceCheck?existenceCheck.length>1:!1,lastIndex=existenceCount?vm.pageSetting.traitSelectedOrder.lastIndexOf(category):-1;lastIndex>-1&&(area.splice(lastIndex,1),vm.pageSetting.traitSelectedOrder.splice(lastIndex,1)),existence>-1&&(area.splice(existence,1),vm.pageSetting.traitSelectedOrder.splice(existence,1)),vm.pageSetting.allTrait[category].Primary.checked=!1,stateMode()}function traitClear(checked,property,category){for(var j=vm.pageSetting[property].length-1;j>=0;j--){"Personality"===vm.pageSetting.traitSelectedOrder[j]&&(vm.pageSetting.allTrait[vm.pageSetting.traitSelectedOrder[j]][vm.pageSetting[property][j]].currentValue=0);for(var keys=Object.keys(vm.pageSetting.allTrait[category]),k=0;k<keys.length;k++)if(vm.pageSetting[property][j]===keys[k]){vm.pageSetting[property].splice(j,1);break}}"Personality"===category&&(vm.pageSetting.personalityMode="navigator",vm.calucalteTiltGraph());for(var i=vm.pageSetting.traitSelectedOrder.length-1;i>=0;i--)vm.pageSetting.traitSelectedOrder[i]===category&&vm.pageSetting.traitSelectedOrder.splice(i,1);if(void 0!==checked)for(var key in checked)checked[key].checked=!1;stateMode()}function traitFilter(e,parentE){for(var data=0,value=0,match=0,type=0,length=vm.pageSetting.personalityTraitSelected.length,difference=0,power=0,i=0,number=0;i<vm.pageSetting.personalityTraitSelected.length;i++)if(type=vm.pageSetting.traitSelectedOrder[i],match=e[vm.pageSetting.personalityTraitSelected[i]],"Processing"===type||"Motivation"===type||"LearningStyle"===type||"DecisionMaking"===type)value=parseInt(vm.pageSetting.allTrait[vm.pageSetting.traitSelectedOrder[i]][vm.pageSetting.personalityTraitSelected[i]].currentValue,10),match>=value-vm.pageSetting.deviation&&match<=value+vm.pageSetting.deviation&&(number=100-(match-value),power+=number,number>100&&(number=100),0>number&&(number=0),difference+=number,data++);else if("Personality"===type)match>=vm.pageSetting.personalityTypeDeviation&&(number=match,power+=number,difference+=number,data++);else if("FundamentalNeeds"===type){var fundamental=fundamentalFilter(e,vm.pageSetting.allTrait.FundamentalNeeds.fundamental.currentValue);fundamental&&(power+=100,difference+=100,data++)}else if("ConflictManagement"===type){var conflict=conflictFilter(e,vm.pageSetting.allTrait[vm.pageSetting.traitSelectedOrder[i]]);conflict&&(power+=100,difference+=100,data++)}return data===length&&(parentE.percent=Math.round(difference/vm.pageSetting.personalityTraitSelected.length),parentE.power=power),data===length}function conflictFilter(e,conflict){if(0===conflict.Primary.currentValue||null===conflict.Primary.currentValue)return!1;var primaryNumber=0,primary=conflict.Primary.currentValue,restTrait=angular.copy(vm.pageSetting.conflictTraitAvailable);restTrait.splice(vm.pageSetting.conflictTraitAvailable.indexOf(primary),1);for(var i=0;i<restTrait.length;i++)e[primary]>=e[restTrait[i]]&&primaryNumber++;if(0!==conflict.Secondary.currentValue&&null!==conflict.Secondary.currentValue&&primaryNumber===restTrait.length){var secondaryNumber=0,secondary=conflict.Secondary.currentValue,restCopy=angular.copy(restTrait);restCopy.splice(restTrait.indexOf(secondary),1);for(var j=0;j<restCopy.length;j++)e[secondary]>=e[restCopy[j]]&&secondaryNumber++;return secondaryNumber===restCopy.length}return primaryNumber===restTrait.length}function fundamentalFilter(e,fundamental){var club=["Control","Significance","Security"],result=0,order=[];switch(fundamental){case"Control":case"Significance":case"Security":order=angular.copy(club),order.splice(club.indexOf(fundamental),1);for(var i=0;i<order.length;i++)e[fundamental]>=parseInt(e[order[i]],10)&&result++;break;case"Balanced":order=angular.copy(club);for(var j=0;j<order.length;j++)33>=parseInt(e[order[j]],10)-vm.pageSetting.fundamentalNeedDeviation&&33<=parseInt(e[order[j]],10)+vm.pageSetting.fundamentalNeedDeviation&&result++}return order.length===result}function ertAnalyticFilterLogic(){vm.userScreen=!1,vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail),vm.pageSetting.personalityTypes=angular.copy(vm.pageSetting.personalityTraitSelected);var len=vm.pageSetting.traitSelectedOrder.toString().match(/Personality/g);vm.pageSetting.visiblePercentage=(null===len?0:len.length)===vm.pageSetting.traitSelectedOrder.length,vm.pageSetting.searchPersonality="navigator"===vm.pageSetting.personalityMode?"ertiData":"ertiUnderPressureData",vm.pageSetting.personalityTypesLang=vm.pageSetting.personalityTypes.map(function(e){return $rootScope.pullInterNationalization("spectrum.trait.type."+e)}),vm.analyticsGraphData=vm.analytics.userAnalytics.filter(function(e){return(vm.pageSetting.groupSelected.length&&available(null===e.groups?[]:e.groups,vm.pageSetting.groupSelected)||!vm.pageSetting.groupSelected.length&&e)&&(vm.pageSetting.ageSelected.length&&inBetween(null===e.age?[]:e.age,vm.pageSetting.ageSelected)||!vm.pageSetting.ageSelected.length&&e)&&(vm.pageSetting.genderSelected.length&&-1!==vm.pageSetting.genderSelected.indexOf(e.gender)||!vm.pageSetting.genderSelected.length&&e)&&(vm.pageSetting.tagSelected.length&&available(null===e.tags?[]:e.tags,vm.pageSetting.tagSelected)||!vm.pageSetting.tagSelected.length&&e)&&(vm.pageSetting.personalityTraitSelected.length&&traitFilter(e[vm.pageSetting.searchPersonality],e)||!vm.pageSetting.personalityTraitSelected.length&&e)}).map(function(e){return vm.profileBalanceDetail.total++,vm.profileBalanceDetail.total>1&&vm.profileBalanceDetail.divisionTotal++,"M"===e.gender?vm.profileBalanceDetail.gender.male++:vm.profileBalanceDetail.gender.female++,ageSwitch(e.age),e}),vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!0,competency:!1},vm.chartDataReady=!0,vm.ertOrderBy(vm.pageSetting.sort)}function orgPlanFilterLogic(){vm.userScreen=!1,vm.chartDataReady=!0,vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail),vm.orgPlanGraphData=vm.orgPlan.orgPlanActivities.filter(function(e){return vm.pageSetting.orgSelected.length?-1!==vm.pageSetting.orgSelected.indexOf(e.planName):e}),vm.profileBalanceDetail.total=vm.orgPlanGraphData.length,vm.orgOrderBy(vm.pageSetting.sort),vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!0,analytics:!1,competency:!1},vm.chartDataReady=!0}function calculateInsights(e){for(var count=!1,iterateObj=vm.pageSetting.traitSelected.length?vm.pageSetting.traitSelected:vm.insights.spectrumFilter.filters.trait,i=0;i<iterateObj.length;i++)!e[vm.pageSetting.searchPersonality][iterateObj[i]]||vm.pageSetting.traitSelected.length&&-1===vm.pageSetting.traitSelected.indexOf(iterateObj[i])||(-1!==vm.insightsMasterDataSet.indexOf(iterateObj[i])?vm.cloneInsightsGraphData[vm.insightsMasterDataSet.indexOf(iterateObj[i])].userDto.push({name:e.name,profile:e.smallProfileImage,initial:e.userInitials,percent:e[vm.pageSetting.searchPersonality][iterateObj[i]],title:e.title}):(vm.insightsMasterDataSet.push(iterateObj[i]),vm.cloneInsightsGraphData.push({traitName:iterateObj[i],traitDescription:null,userDto:[{name:e.name,profile:e.smallProfileImage,initial:e.userInitials,percent:e[vm.pageSetting.searchPersonality][iterateObj[i]],title:e.title}]})),count=!0);return count&&(vm.profileBalanceDetail.total++,vm.profileBalanceDetail.total>1&&vm.profileBalanceDetail.divisionTotal++,"M"===e.gender?vm.profileBalanceDetail.gender.male++:vm.profileBalanceDetail.gender.female++,ageSwitch(e.age)),!0}function ertInsightsFilterLogic(){vm.userScreen=!1,vm.cloneInsightsGraphData=[],vm.insightsMasterDataSet=[],vm.pageSetting.traitSelectedDisplay=[],vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail);vm.insights.userAnalytics.filter(function(e){return(vm.pageSetting.groupSelected.length&&available(null===e.groups?[]:e.groups,vm.pageSetting.groupSelected)||!vm.pageSetting.groupSelected.length&&e)&&(vm.pageSetting.ageSelected.length&&inBetween(null===e.age?[]:e.age,vm.pageSetting.ageSelected)||!vm.pageSetting.ageSelected.length&&e)&&(vm.pageSetting.genderSelected.length&&-1!==vm.pageSetting.genderSelected.indexOf(e.gender)||!vm.pageSetting.genderSelected.length&&e)&&(vm.pageSetting.tagSelected.length&&available(null===e.tags?[]:e.tags,vm.pageSetting.tagSelected)||!vm.pageSetting.tagSelected.length&&e)&&sharedProperties.singleElementSearch(vm.pageSetting.memberSearch,e,2)&&calculateInsights(e)});vm.insightsGraphData=angular.copy(vm.cloneInsightsGraphData),vm.orderBy(vm.pageSetting.sort),vm.pageSetting.traitSelectedDisplay=vm.pageSetting.traitSelected.map(function(e){return $rootScope.pullInterNationalization("spectrum.trait.type."+e)}),vm.profileChartNoData=!vm.insightsGraphData.length,vm.chartDataReady=!0,vm.viewBox={profile:!1,blueprint:!1,insights:!0,org:!1,analytics:!1,competency:!1}}function orderBy(sort){for(var i=0;i<vm.insightsGraphData.length;i++)vm.insightsGraphData[i].userDto.sort(function(a,b){var an=a.percent,bn=b.percent,af=a.firstName,bf=b.firstName;switch(sort){case"plus":return an===bn?af===bf?0:+(af>bf)||-1:+(bn>an)||-1;case"minus":return an===bn?af===bf?0:+(af>bf)||-1:+(an>bn)||-1}})}function calculatePerc(e){return vm.percent=vm.percent+(e.completedKpi/e.totalKpi*100||0),!0}function blueprintFilterLogic(){vm.percent=0,vm.blueprintAnalyticsGraphData=vm.blueprintAnalytics.userAnalytics.filter(function(e){return(vm.pageSetting.groupSelected.length&&available(null===e.groups?[]:e.groups,vm.pageSetting.groupSelected)||!vm.pageSetting.groupSelected.length&&e)&&(vm.pageSetting.tagSelected.length&&available(null===e.tags?[]:e.tags,vm.pageSetting.tagSelected)||!vm.pageSetting.tagSelected.length&&e)&&calculatePerc(e)}),vm.pageSetting.bluePerc=Math.round(vm.percent/vm.blueprintAnalyticsGraphData.length),vm.matchSort(vm.pageSetting.sort),vm.viewBox={profile:!1,blueprint:!0,insights:!1,org:!1,analytics:!1,competency:!1}}function matchSort(sort){vm.blueprintAnalyticsGraphData.sort(function(a,b){var an=Math.ceil(a.completedKpi/a.totalKpi*100)||0,bn=Math.ceil(b.completedKpi/b.totalKpi*100)||0,af=a.firstName,bf=b.firstName;switch(sort){case"plus":return an===bn?af===bf?0:+(af>bf)||-1:+(bn>an)||-1;case"minus":return an===bn?af===bf?0:+(af>bf)||-1:+(an>bn)||-1}}),vm.chartDataReady=!0}function percentCalc(total,number,floating){return void 0===floating?Math.round(number/total*100)||0:parseFloat(number/total*100).toFixed(floating)}function buildMasterDataSet(){for(var key in vm.personalityBalance.personalityData)vm.masterDataSet.push({dimensionType:vm.personalityBalance.personalityData[key].dimesionType,number:0,percent:0,personalityDescription:vm.personalityBalance.personalityData[key].description,personalityType:key,usersId:[],videoUrl:vm.personalityBalance.personalityData[key].videoUrl}),vm.keyList.push(key);vm.profileBalanceFilterLogic()}function ageSwitch(age){for(var i=0;i<ageCategory.length;i++){var splitNumber=ageCategory[i].split("-");if(age>=splitNumber[0]&&age<=splitNumber[1]){vm.profileBalanceDetail.age[category[i]]++;break}}}function calculateFilterValue(e){var index=void 0===e[vm.pageSetting.barPersonalityMode]||null===e[vm.pageSetting.barPersonalityMode]?-1:vm.keyList.indexOf(e[vm.pageSetting.barPersonalityMode]);return index>-1?(vm.personalityBalanceGraphData[index].number++,vm.personalityBalanceGraphData[index].usersId.push(e),vm.profileBalanceDetail.total++,vm.profileBalanceDetail.total>1&&vm.profileBalanceDetail.divisionTotal++,"M"===e.gender?vm.profileBalanceDetail.gender.male++:vm.profileBalanceDetail.gender.female++,ageSwitch(e.age),!0):!1}function profileBalanceFilterLogic(){vm.userScreen=!1,vm.personalityBalanceGraphData=angular.copy(vm.masterDataSet),vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail);var data=vm.personalityBalance.spectrumUserDTOs.filter(function(e){return(vm.pageSetting.groupSelected.length&&available(null===e.groups?[]:e.groups,vm.pageSetting.groupSelected)||!vm.pageSetting.groupSelected.length&&e)&&(vm.pageSetting.ageSelected.length&&inBetween(null===e.age?[]:e.age,vm.pageSetting.ageSelected)||!vm.pageSetting.ageSelected.length&&e)&&(vm.pageSetting.genderSelected.length&&-1!==vm.pageSetting.genderSelected.indexOf(e.gender)||!vm.pageSetting.genderSelected.length&&e)&&(vm.pageSetting.tagSelected.length&&available(null===e.tags?[]:e.tags,vm.pageSetting.tagSelected)||!vm.pageSetting.tagSelected.length&&e)&&calculateFilterValue(e)});vm.personalityBalanceGraphData.sort(function(a,b){var aP=$rootScope.pullInterNationalization("spectrum."+a.personalityType),bP=$rootScope.pullInterNationalization("spectrum."+b.personalityType);return a.number===b.number?aP===bP?0:+(aP>bP)||-1:+(b.number>a.number)||-1}),vm.profileChartNoData=!data.length,vm.viewBox={profile:!0,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!1},vm.chartDataReady=!0}function includeCheck(status,area){var i=$.inArray(status,area);i>-1?area.splice(i,1):area.push(status),sharedProperties.fireAnalyticsEvent("Spectrum | Click Filters","Module Name - "+vm.moduleNameForAnalytics+" | Filter Name - "+vm.filterNameForAnalytics+" | Selected Filter Value - "+status),stateMode()}function secondaryDrop(val){return Object.keys(vm.pageSetting.allTrait).length?val!==vm.pageSetting.allTrait.ConflictManagement.Primary.currentValue:!1}function clear(classS,property,search,checked){if(vm.pageSetting[property]=[],void 0!==search&&(vm.pageSetting[search]=""),void 0!==checked)for(var key in checked)checked[key].checked=!1;$(classS).each(function(v,i){$(this).prop("checked",!1)}),stateMode()}function closeRest(index,noScroll){var val=void 0===noScroll?0:1;$(".accordian-checkbox").each(function(i){i!==$(index.currentTarget.parentNode).index()-val&&$(this).prop("checked",!0)}),void 0===noScroll&&$("html,body").animate({scrollTop:$(".spectrum-filter-toggle").offset().top-80},300);for(var i=0;i<index.currentTarget.parentNode.children.length;i++)"H3"===index.currentTarget.parentNode.children[i].tagName&&(vm.filterNameForAnalytics=index.currentTarget.parentNode.children[i].textContent)}function profileUpdateFn(callback){$scope.$apply(function(){vm.userScreen=!0,vm.userDetail=callback.userDetail,
vm.profileName=callback.name,vm.profileBalanceSelect=callback.className,vm.profileNumber=callback.number,vm.dimensionType=callback.dimensionType,vm.personalityDescription=callback.personalityDescription,vm.videoUrl=callback.videoUrl})}function videoPopUp(url){sharedProperties.videoPopUp(url)}var vm=this;vm.config={getProfileBalance:"/sp/spectrum/getProfileBalance",getBlueprint:"/sp/spectrum/getBlueprintAnalytics",getErtInsights:"/sp/spectrum/getErtiInsights",getOrganizationPlanActivities:"/sp/spectrum/getOrganizationPlanActivities",getErtAnalytics:"/sp/spectrum/getErtiAnalytics",getCompetency:"/sp/spectrum/getCompetencyInsights",videoPopUpDialog:"/sp/support/videoPopUp"},vm.chartDataReady=!1,vm.userScreen=!1,vm.profileChartNoData=!0,vm.noData=!1;var ageCategory=["0-21","22-34","35-44","45-54","55-64","65-200"],category=["YOUNG","MILIENIAL","GEN_X","BOOMERS","OLD","SILENT"];vm.masterProfileBalanceDetail={gender:{male:0,female:0},age:{YOUNG:0,MILIENIAL:0,GEN_X:0,BOOMERS:0,OLD:0,SILENT:0},total:0,divisionTotal:1,matched:0},vm.profileBalanceDetail=angular.copy(vm.masterProfileBalanceDetail),vm.personalityBalance=[],vm.personalityBalanceGraphData={},vm.blueprintAnalytics=[],vm.blueprintAnalyticsGraphData=[],vm.insights=[],vm.insightsGraphData=[],vm.cloneInsightsGraphData=[],vm.insightsMasterDataSet=[],vm.orgPlan=[],vm.orgPlanGraphData=[],vm.analytics=[],vm.analyticsGraphData=[],vm.tilt={big:100,detail:0,mission:100,relational:0},vm.screenInfo=[],vm.competencyPlan=[],vm.competencyPlanGraphData=[],vm.pageSetting={groupSearch:"",groupSelected:[],individualSearch:"",individualSelected:[],ageSelected:[],genderSelected:[],tagSelected:[],tagSearch:"",memberSearch:"",sort:"plus",traitSearch:"",traitSelected:[],orgSelected:[],orgSearch:"",viewType:"i",allSteps:"",totalCompletedKpi:"",totalKpi:"",checked:!1,personalityTraitSelected:[],allTrait:{},conflictTraitPrimary:"",conflictTraitSecondary:"",traitSelectedOrder:[],deviation:10,personalityTypeDeviation:66,conflictTraitSelected:!1,fundamentalNeed:"none",fundamentalNeedDeviation:4,totalOrgPerc:0,bluePerc:0,personalityMode:"navigator",searchPersonality:"ertiData",primarypersonalityTraitSelected:[],heightParam:800,competencySelected:[],competencyProfile:-1,competencyDuration:-1,barPersonalityMode:"primaryPersonality"},vm.originalPageSetting=angular.copy(vm.pageSetting),vm.masterDataSet=[],vm.keyList=[],vm.viewBox={profile:!1,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!1},vm.permissionLevel={prism:!1,blueprint:!1,insights:!1,org:!1,analytics:!1,competency:!1},vm.filterEnable=!1,vm.routeStateMode=0,vm.checkPermission=checkPermission,vm.routeToState=routeToState,vm.filterOpen=filterOpen,vm.getProfileBalance=getProfileBalance,vm.profileBalanceFilterLogic=profileBalanceFilterLogic,vm.includeCheck=includeCheck,vm.profileUpdateFn=profileUpdateFn,vm.clear=clear,vm.closeRest=closeRest,vm.getBlueprint=getBlueprint,vm.blueprintFilterLogic=blueprintFilterLogic,vm.percentCalc=percentCalc,vm.matchSort=matchSort,vm.getErtInsights=getErtInsights,vm.ertInsightsFilterLogic=ertInsightsFilterLogic,vm.returnClampName=returnClampName,vm.orderBy=orderBy,vm.getOrganizationPlanActivities=getOrganizationPlanActivities,vm.orgPlanFilterLogic=orgPlanFilterLogic,vm.orgOrderBy=orgOrderBy,vm.stepChanged=stepChanged,vm.getErtAnalytics=getErtAnalytics,vm.ertAnalyticFilterLogic=ertAnalyticFilterLogic,vm.ertOrderBy=ertOrderBy,vm.traitCheck=traitCheck,vm.traitCheckTwo=traitCheckTwo,vm.mapToTriat=mapToTriat,vm.traitClear=traitClear,vm.calucalteTiltGraph=calucalteTiltGraph,vm.conflictManagerChecked=conflictManagerChecked,vm.fundamentalNeedChecked=fundamentalNeedChecked,vm.conflictManagementclear=conflictManagementclear,vm.fundamentalNeedClear=fundamentalNeedClear,vm.secondaryDrop=secondaryDrop,vm.getCompetency=getCompetency,vm.competencyFilterLogic=competencyFilterLogic,vm.competencyOrder=competencyOrder,vm.competencyDate=competencyDate,vm.changeCompetency=changeCompetency,vm.calculateHeight=calculateHeight,vm.animate=animate,vm.videoPopUp=videoPopUp,vm.moduleNameForAnalytics="",vm.filterNameForAnalytics=""}angular.module("spApp").controller("spectrumController",spectrumController),spectrumController.$inject=["$scope","ajaxService","$localStorage","$timeout","$rootScope","ngDialog","$state","sharedProperties"],angular.module("spApp").directive("rangeDrag",["$rootScope",function($rootScope){var directiveDefinitionObject={restrict:"E",replace:!1,templateUrl:"/sp/resources/html/spectrum/twoRangeDrag.html",scope:{data_1:"=rangeData1",data_2:"=rangeData2",dragRange:"=dragRange",editable:"=editable",updateFn:"&updateFn",checkboxFn:"&checkboxFn"},link:function(scope,element,attr){var inputCreator=function(){var ele=$(element).find(".dragdealer")[0],leftRange=$(element).find(".labels .minRange"),rightRange=$(element).find(".labels .maxRange");new Dragdealer(ele,{animationCallback:function(x,y){leftRange.text(Math.round(100-100*x)),rightRange.text(Math.round(100*x))},dragStartCallback:function(x,y){scope.editable||scope.$apply(function(){(scope.editable=!0)&&scope.checkboxFn()})},callback:function(x,y){sliderValue(x),scope.editable||scope.$apply(function(){(scope.editable=!0)&&scope.checkboxFn()})},x:scope.dragRange})},sliderValue=function(x){var xAxis=Math.round(100-100*x),yAxis=Math.round(100*x);scope.$apply(function(){xAxis!==scope.data_1.currentValue&&yAxis!==scope.data_2.currentValue&&(scope.data_1.currentValue=xAxis,scope.data_2.currentValue=yAxis,scope.updateFn())})};"undefined"!=typeof scope.editable&&inputCreator()}};return directiveDefinitionObject}]),angular.module("spApp").directive("twoRange",["$rootScope",function($rootScope){var directiveDefinitionObject={restrict:"E",replace:!1,templateUrl:"/sp/resources/html/spectrum/twoRange.html",scope:{data_1:"=rangeData1",data_2:"=rangeData2",editable:"=editable",updateFn:"&updateFn",checkboxFn:"&checkboxFn"},link:function(scope,element,attr){element.bind("change",function(){sliderValue()});var inputCreator=function(){scope.minValue=0,scope.maxValue=100,scope.which=-1,scope.editable=void 0===scope.editable?!1:scope.editable,scope.currentValue1=null===scope.data_1.currentValue?0:100-parseInt(scope.data_1.currentValue),scope.currentValue2=null===scope.data_2.currentValue?0:scope.data_2.currentValue},sliderValue=function(){scope.$apply(function(){0===scope.which?(scope.data_1.currentValue=100-parseInt(scope.currentValue1,10),scope.data_2.currentValue=scope.currentValue1,scope.currentValue2=parseInt(scope.currentValue1,10)):1===scope.which&&(scope.data_1.currentValue=100-parseInt(scope.currentValue2,10),scope.data_2.currentValue=scope.currentValue2,scope.currentValue1=parseInt(scope.currentValue2,10)),scope.updateFn(),scope.editable||(scope.editable=!0,scope.checkboxFn())})};scope.$watch("editable",function(newValue,oldValue){"undefined"!=typeof scope.data_1&&inputCreator()},!0)}};return directiveDefinitionObject}]),angular.module("spApp").directive("singleRange",["$rootScope",function($rootScope){var directiveDefinitionObject={restrict:"E",replace:!1,templateUrl:"/sp/resources/html/spectrum/singleRange.html",scope:{data:"=rangeData",editable:"=editable",updateFn:"&updateFn",checkboxFn:"&checkboxFn"},link:function(scope,element,attr){element.bind("change",function(){getSliderValue()});var getSliderValue=function(){scope.$apply(function(){scope.data.currentValue=scope.currentValue,scope.editable||(scope.editable=!0,scope.checkboxFn()),scope.updateFn()})},inputCreator=function(){scope.minValue=0,scope.maxValue=100,scope.editable=void 0===scope.editable?!1:scope.editable,scope.currentValue=void 0===scope.data.currentValue?0:scope.data.currentValue};scope.$watch("editable",function(newValue,oldValue){"undefined"!=typeof scope.data&&inputCreator()},!0)}};return directiveDefinitionObject}]),angular.module("spApp").directive("ellipsis",["$rootScope",function($rootScope){var directiveDefinitionObject={restrict:"E",replace:!1,templateUrl:"/sp/resources/html/spectrum/structure.html",scope:{data:"=elData",length:"=elLength",fontsize:"=elFontsize",total:"=elTotal",message:"=elMessage",lang:"=elLang"},link:function(scope,element,attrs){var resize=function(){ellipsisCreator(scope.data),scope.$apply()},ellipsisCreator=function(array){var arraySize=[],size=0,stopCounter=0,length=$(scope.length).width()/1.7;if(scope.toolTiptext=null,scope.visibleText=null,scope.remaining=0,scope.total!==scope.data.length){for(var i=0;i<array.length;i++){var e=document.createElement("span");if(document.body.appendChild(e),e.style.fontSize=scope.fontsize+"px",e.setAttribute("class","posAbs"),e.innerHTML=array[i],arraySize.push(e.offsetWidth+5),$(".posAbs").remove(),size+arraySize[i]>=length){stopCounter=i-1;break}size+=arraySize[i],stopCounter=i}scope.visibleText=array.slice(0,stopCounter+1).join(", "),stopCounter<array.length-1&&(scope.toolTiptext=array.slice(stopCounter+1,array.length).join(", "),scope.remaining=array.length-1-stopCounter)}else scope.visibleText=scope.message};scope.$watch("data",function(newValue,oldValue){"undefined"!=typeof scope.data&&ellipsisCreator(scope.data)},!0),$(window).on("resize",resize)}};return directiveDefinitionObject}]),angular.module("spApp").directive("barChart",["$rootScope","$window",function($rootScope,$window){function tickLength(dataMax){for(var max=0,i=0;i<dataMax.length;i++)max<dataMax[i].name.length&&(max=dataMax[i].name.length);return 10*max}function change(d){d3.select(".bar-"+d.className).classed("hovered",!0),d3.select(".x-"+d.className).classed("hovered",!0)}function restore(d){d3.select(".bar-"+d.className).classed("hovered",!1),d3.select(".x-"+d.className).classed("hovered",!1)}function classes(root){function recurse(name,node){null===name?node.forEach(function(child){recurse(child.personalityType,child)}):classesList.push({name:$rootScope.pullInterNationalization("spectrum."+name),className:name.toLowerCase(),number:node.number,userDetail:node.usersId,percent:node.percent,index:node.percent+name+node.number,dimensionType:node.dimensionType,personalityDescription:node.personalityDescription,videoUrl:node.videoUrl})}var classesList=[];return recurse(null,root),{children:classesList}}var directiveDefinitionObject={restrict:"E",replace:!1,scope:{data:"=chartData",clickOperation:"=clickEvent",updateFn:"&"},link:function(scope,element,attrs){var duration=800,delay=200,classToBind=$("."+attrs.classBind),legendSpace=170,barHeight=35,boxArea=5,margin={top:20,right:50,bottom:30,left:170},rangeBandHeight=barHeight*scope.data.length+margin.top,width=classToBind.width()-margin.left-margin.right,height=classToBind.height()-margin.top-margin.bottom,widthMar=(d3.format(",d"),width+margin.left+margin.right),heightMar=height+margin.top+margin.bottom,ease="cubic-in-out",svg=d3.select(element[0]).append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+widthMar+" "+heightMar).attr("preserveAspectRatio","xMinYMin").attr("class","barChart").append("g").attr("transform","translate("+margin.left+","+margin.top+")"),chart=$(".barChart"),barChartCreation=(chart.width()/chart.height(),chart.parent(),function(svgElem,data,scopePass){var x=d3.scale.linear().domain([0,d3.max(data,function(d){return 10*Math.ceil(d.number/10)})]).range([0,width-legendSpace]),y=d3.scale.ordinal().domain(d3.range(data.length)).rangeBands([0,rangeBandHeight]),maxLength=tickLength(data);svgElem.selectAll("g.axis").remove(),svgElem.selectAll(".bar").remove(),svgElem.append("line").attr("x1",-maxLength).attr("y1",0).attr("x2",-maxLength).attr("y2",rangeBandHeight).style("stroke-width",1).style("stroke","#ddd").style("fill","none");var yAxis=d3.svg.axis().scale(y).orient("right").tickSize(0).tickPadding(-(maxLength-boxArea)).tickFormat(function(d){return data[d].name});svgElem.append("g").attr("class","y axis").call(yAxis).append("text"),svgElem.select(".y").selectAll(".tick").data(data).attr("class",function(d,i){return"tick xAxisClick x-"+d.className}).on("mouseout",restore).on("mouseover",change).on("click",function(d,i){return scopePass.clickOperation?void scopePass.updateFn({callback:d}):!0}),svgElem.select(".y").selectAll(".tick").insert("rect","text").attr("width",maxLength).attr("height",barHeight).attr("y","-18.9").attr("x",-maxLength),svgElem.select(".y").selectAll(".tick line").attr("x2",-maxLength).attr("y1","16.8").attr("y2","16.8"),svgElem.select(".xAxisClick").insert("line","rect").attr("x2",-maxLength).attr("y1","-17.5").attr("y2","-17.5");var bars=svgElem.selectAll(".bar").data(data);bars.enter().append("g").attr("class",function(d){return"bar bar-"+d.className+" number_"+d.number}).on("mouseout",restore).on("mouseover",change).on("click",function(d){return scopePass.clickOperation?void scopePass.updateFn({callback:d}):!0}).attr("transform",function(d,i){return"translate(0,"+y(i)+")"}),bars.append("rect").transition().duration(duration).ease(ease).attr("height",barHeight).attr("width",0).transition().delay(delay).duration(duration).attr("width",function(d){var num=x(d.number);return num}),bars.append("text").transition().duration(duration).ease(ease).attr("x",10).attr("y",18).attr("dy",".35em").attr("text-anchor","end").transition().delay(delay).duration(duration).attr("x",function(d){return 10+x(d.number)+7*d.number.toString().length}).text(function(d){return d.number}),bars.exit().transition().style({opacity:0}).remove()});scope.$watch("data",function(newValue,oldValue){if("undefined"!=typeof scope.data&&scope.data.length){var dataToPass=classes(scope.data);barChartCreation(svg,dataToPass.children,scope)}},!0)}};return directiveDefinitionObject}]);
function supportController($scope,$localStorage,ngDialog,sharedProperties){$scope.videoReady=!1,jQuery(function($){if($(".support-body").length){var $toggleFaq=$(".section-faq-header"),$list=$(".nav-support-link-list"),$contentArea=$(".main-support-content"),$iniSectionFaq=$(".section-faq.defaultOpen"),$upTarget=($iniSectionFaq.find(".section-faq-content").outerHeight(),$iniSectionFaq.find(".x-section-faq-content")),$mobileNavSupport=$(".mobileNavigationSupport"),_href=window.location.href,status=sharedProperties.getParam("submit");$iniSectionFaq.addClass("show"),$(".js_hostName").val(_href+"?submit=support"),null!=status&&$.growl({icon:"glyphicon glyphicon-ok",message:"Message sent successfully"}),setTimeout(function(){$toggleFaq.css({WebkitTransition:"all 400ms ease-in-out",MozTransition:"all 400ms ease-in-out",MsTransition:"all 400ms ease-in-out",OTransition:"all 400ms ease-in-out",transition:"all 400ms ease-in-out"})},500),$upTarget.height("100%"),$toggleFaq.on("click",function(){var $this=$(this),$html=$this.closest(".section-faq"),$upTarget=$html.find(".x-section-faq-content"),$upTargetHeight=$upTarget.outerHeight(),$elHeight=$html.find(".section-faq-content").outerHeight();return $this.hasClass("noAction")?!1:($upTargetHeight>1?$upTarget.height(0):$upTarget.height($elHeight),void $html.toggleClass("show"))}),$(".js_helpFormSubmit").on("click",function(event){var messageVal=$(".js_message_type").val(),textLength=$(".js_textarea").val().length,$messageErr=$(".js_select_error"),$textErr=$(".js_narrow_message");"-1"===messageVal?$messageErr.addClass("support_show"):$messageErr.addClass("support_hide"),20>textLength?($(".js_textarea").addClass("extra-spacing"),$textErr.addClass("support_show")):($textErr.addClass("support_hide"),$(".js_textarea").removeClass("extra-spacing")),"-1"!==messageVal&&textLength>19?$(".js_help_form").submit():event.preventDefault()}),$list.find("li a").on("click",function(){var _this=$(this),listId=_this.attr("data-list"),text=_this.text();toggleHideShow(listId,_this),$(".mobileNavigationText").find(".selectedTabText").html(text)}),$mobileNavSupport.length&&$mobileNavSupport.find("li a").on("click",function(){var _this=$(this),listId=_this.attr("data-list"),text=_this.text();toggleHideShow(listId,_this),$list.find("li a").removeClass("active"),$list.find("li a[data-list='"+listId+"']").addClass("active"),$(".mobileNavigationText").find(".selectedTabText").html(text)});var toggleHideShow=function(listId,_this){$list.find("li a").removeClass("active"),_this.addClass("active"),$contentArea.find(".support-customer").removeClass("local-show"),$contentArea.find(".support-customer[data-tab='"+listId+"']").addClass("local-show")},userType=function(){var userRoles=$localStorage.get("loggegdInProfile").member.roles,hiringFlag=-1!==userRoles.indexOf("Hiring")?!0:!1,adminFlag=-1!==userRoles.indexOf("Administrator")?!0:!1,accountAdminFlag=-1!==userRoles.indexOf("AccountAdministrator")?!0:!1,individualUser=-1!==userRoles.indexOf("IndividualAccountAdministrator")?!0:!1;individualUser?($contentArea.find(".support-customer[data-tab='2'] .childAccount:eq(1)").addClass("local-show"),$contentArea.find(".support-customer[data-tab='2'] .childAccount:eq(0)").addClass("local-hide")):($contentArea.find(".support-customer[data-tab='2'] .childAccount:eq(0)").addClass("local-show"),$contentArea.find(".support-customer[data-tab='2'] .childAccount:eq(1)").addClass("local-hide")),adminFlag&&$contentArea.find(".support-customer[data-tab='2'] .childAccount:eq(0) .adminFlag").addClass("local-show"),accountAdminFlag&&$contentArea.find(".support-customer[data-tab='2'] .childAccount:eq(0) .accountAdminFlag").addClass("local-show"),hiringFlag&&$contentArea.find(".support-customer[data-tab='1'] .hiring-section").addClass("local-show")};!function(){userType(),$("textarea").focus(function(){this.placeholder===this.value&&(this.value="")}).blur(function(){""===this.value&&(this.value=this.placeholder)})}()}}),$scope.videoPopUp=function(url){sharedProperties.videoPopUp(url)}}angular.module("spApp").controller("supportController",supportController),supportController.$inject=["$scope","$localStorage","ngDialog","sharedProperties"];
function sysAdminPanel($scope,$element,$attrs,ajaxService,$state,ngDialog,$filter,sharedProperties,$rootScope){var self=this;self.responseAvailable=!1,self.responseAvailableForModal=!1,$scope.memberList=[],$scope.masterMemberList=[],$scope.pageSize=10,$scope.intialPageSize=10,$scope.lastPredicate="name",$scope.lastReverse=!1,$scope.userEmail={email:[]},$scope.textSearching="",$scope.checkedAll=!1,self.serviceApis={getAllCompanies:"/sp/sysAdmin/hk/getCompanies",openCompanyModal:"/sp/sysAdmin/hk/selectCompany"},self.companyList=[],self.email="",$scope.getLoggedInUserList=function(){var options={url:"/sp/sysAdmin/hk/getLoggedInUsers",method:"get"};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&($scope.masterMemberList=response.loggedInUsers.length?response.loggedInUsers:[],$scope.memberList=angular.copy($scope.masterMemberList),$scope.returnMemberList($scope.pageSize),$scope.change="email")})},$scope.getUserList=function(){var options={url:"/sp/sysAdmin/hk/getUserList",method:"get"};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&($scope.masterMemberList=response.users.length?response.users:[],$scope.memberList=angular.copy($scope.masterMemberList),$scope.returnMemberList($scope.pageSize),$scope.change="email")})},$scope.getCompanyList=function(){var options={url:"/sp/sysAdmin/hk/getCompanyList",method:"get"};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&($scope.masterMemberList=response.companies.length?response.companies:[],$scope.memberList=angular.copy($scope.masterMemberList),$scope.returnMemberList($scope.pageSize),$scope.change="email",self.companyList=angular.copy($scope.masterMemberList))})},$scope.order=function(predicate,reverse){$scope.lastPredicate=predicate,$scope.lastReverse=reverse,$scope.memberList=$filter("orderBy")($scope.memberList,predicate,reverse)},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.returnMemberList($scope.pageSize)},$scope.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize))},$scope.active=function(event){sharedProperties.toggleFilterClick(event,$scope.currentPredicate)},$scope.infinteScroll=function(arg){$scope.returnMemberList(arg)},$scope.returnMemberList=function(pageSize){return $scope.masterMemberList.length?($scope.memberList=sharedProperties.searchModuleName($scope.textSearching,$scope.masterMemberList,2,$scope.change),$scope.pageSize=pageSize,pageSize>=$scope.masterMemberList.length&&($scope.disabledInfinite=!0,$scope.pageSize=$scope.masterMemberList.length),$scope.order($scope.lastPredicate,$scope.lastReverse),void($scope.memberList=$scope.memberList)):!0},$scope.checkUncheck=function(){$scope.alltoggle=!1,$scope.checkedAll&&($scope.negative=!$scope.negative,$scope.checkedAll=!$scope.checkedAll)},$scope.checkAll=function(){$scope.checkedAll=!$scope.checkedAll,$scope.negative?$scope.userEmail.email=$scope.masterMemberList.map(function(item){return{email:item.email,name:item.name,title:item.title}}):$scope.userEmail.email=[]},$scope.selectAdminUserCompany=function(email){self.email=email,self.companyList.length?$scope.openSelectCompanyModal(email):$scope.getAllCompanies(email)},$scope.openSelectCompanyModal=function(email){var dialog=ngDialog.open({template:self.serviceApis.openCompanyModal,scope:$scope});dialog.closePromise.then(function(data){self.companySearchText=""})},$scope.getAllCompanies=function(email){ajaxService.getAjaxResponse({url:self.serviceApis.getAllCompanies,method:"POST"}).then(function(response){if("true"===response.Success)self.companyList=response.companies,$scope.openSelectCompanyModal(),self.responseAvailableForModal=!0,self.email=email;else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})},$scope.selectUser=function(id,email){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/hk/userMigration",method:"POST",data:$.param({newCompanyId:id,email:email})}).then(function(response){if("true"===response.Success)ngDialog.closeAll(),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> User </strong>",message:"migrated successfully"});else if(null!==response.error){ngDialog.closeAll();var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}}angular.module("spApp").controller("sysAdminPanel",sysAdminPanel),sysAdminPanel.$inject=["$scope","$element","$attrs","ajaxService","$state","ngDialog","$filter","sharedProperties","$rootScope"];
function themeDetailsController($scope,$element,$attrs,ngDialog,$timeout,sharedProperties,ajaxService,$rootScope,$localStorage,$filter){$scope.accountsListException=!1,$scope.updatedAccountListing=[],$scope.selectedAccountsCount=0,$scope.updatedListingIndex=0,$scope.accountList={},$scope.selectedCompanyIdList=[],$scope.allAccountsIdList=[],$scope.accountList.search=null,$scope.filteredAccountListing={},$scope.newTheme={},$scope.newTheme.validationErrors=!1,$scope.newThemeDetails={},$scope.updateThemeException=!1,$scope.themeDetailsEditing={},$scope.themeDetailsEditing.status=!1,$scope.themeId=sharedProperties.getParam("t"),$scope.getThemeDetailsException=!1,$scope.selectedAccountsDisplayList=[],$scope.getAccountList=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/hk/getCompanyList",method:"GET"}).then(function(response){if("true"===response.Success)$scope.accountsListException=!1,$scope.accountListing=response.companies,jQuery.each($scope.accountListing,function(i,j){$scope.updatedAccountListing.push(jQuery.extend({},$scope.accountListing[i],{accountSelectedStatus:!1})),$scope.allAccountsIdList.push($scope.accountListing[i].id)});else{$scope.accountsListException=!0;for(var key in response.error)$scope.accountsListExceptionMsg=response.error[key]}})},$scope.addtoSelectedAccounts=function(id){jQuery.each($scope.updatedAccountListing,function(i){return $scope.updatedAccountListing[i].id===id?($scope.updatedAccountListing[i].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[i].id),$scope.updatedAccountListing[i].updatedListingIndex=$scope.updatedListingIndex++,!1):void 0})},$scope.removeFromSelectedAccounts=function(id){jQuery.each($scope.updatedAccountListing,function(i){return $scope.updatedAccountListing[i].id===id?($scope.updatedAccountListing[i].accountSelectedStatus=!1,$scope.selectedAccountsCount-=1,$scope.selectedCompanyIdList.splice($scope.selectedCompanyIdList.indexOf(id),1),!1):void 0})},$scope.removeAllSelectedAccounts=function(){jQuery.each($scope.updatedAccountListing,function(i){$scope.updatedAccountListing[i].accountSelectedStatus=!1,$scope.updatedAccountListing[i].updatedListingIndex=null}),$scope.selectedAccountsCount=0,$scope.selectedCompanyIdList=[]},$scope.addFilteredAccounts=function(){var selectedList=$filter("filter")($scope.updatedAccountListing,$scope.accountList.search);jQuery.each(selectedList,function(i){jQuery.each($scope.updatedAccountListing,function(j){selectedList[i].id===$scope.updatedAccountListing[j].id&&($scope.updatedAccountListing[j].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[j].id),$scope.updatedAccountListing[j].updatedListingIndex=$scope.updatedListingIndex++)})}),$scope.accountList.search=null},$scope.themeDetailsEdit=function(s){"enable"===s?$scope.themeDetailsEditing.status=!0:($scope.themeDetailsEditing.status=!1,$scope.getThemeDetails()),$scope.accountList.search=null},$scope.updateThemeDetails=function(fData){var _params;$scope.newTheme.validationErrors=!1,$scope.createNewThemeException=!1,"All"===fData.assignAccounts?($scope.accList=$scope.allAccountsIdList,_params={name:fData.name,description:fData.description,status:fData.status,category:fData.category,isMandatory:fData.isMandatory,allAccounts:!0,goalId:$scope.themeId}):($scope.accList=$scope.selectedCompanyIdList,_params={name:fData.name,description:fData.description,status:fData.status,category:fData.category,isMandatory:fData.isMandatory,accounts:$scope.accList.join(),allAccounts:!1,goalId:$scope.themeId}),this.newTheme.$valid&&$scope.accList.length>0?($scope.newTheme.validationErrors=!1,ajaxService.getAjaxResponse({url:"/sp/sysAdmin/goals/updateGoal",data:$.param(_params)}).then(function(response){if("true"===response.Success)$scope.updateThemeException=!1,$scope.themeDetailsEdit(),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Details</strong>",message:" updated successfully."});else{$scope.updateThemeException=!0;for(var key in response.error)$scope.updateThemeExceptionMsg=response.error[key]}})):$scope.newTheme.validationErrors=!0},$scope.getThemeDetails=function(){null!==$scope.themeId&&"undefined"!=typeof $scope.themeId&&ajaxService.getAjaxResponse({url:"/sp/sysAdmin/goals/getGoalDetail",data:$.param({goalId:$scope.themeId})}).then(function(response){if("true"===response.Success)if($scope.getThemeDetailsException=!1,$scope.currentThemeDetails=response.goal,$scope.newThemeDetails.name=$scope.currentThemeDetails.name,$scope.newThemeDetails.description=$scope.currentThemeDetails.description,$scope.newThemeDetails.category=$scope.currentThemeDetails.category,$scope.newThemeDetails.isMandatory=$scope.currentThemeDetails.mandatory.toString(),$scope.newThemeDetails.status=$scope.currentThemeDetails.status,$scope.currentThemeDetails.allAccounts===!0)$scope.newThemeDetails.assignAccounts="All";else{$scope.selectedAccountsDisplayList=[],$scope.selectedCompanyIdList=[],$scope.selectedAccountsCount=0,$scope.newThemeDetails.assignAccounts="Selected";var _c=$scope.currentThemeDetails.companyDTO;jQuery.each(_c,function(i){jQuery.each($scope.updatedAccountListing,function(j){_c[i].id===$scope.updatedAccountListing[j].id&&($scope.updatedAccountListing[j].accountSelectedStatus=!0,$scope.selectedAccountsCount+=1,$scope.selectedCompanyIdList.push($scope.updatedAccountListing[j].id),$scope.updatedAccountListing[j].updatedListingIndex=$scope.updatedListingIndex++,$scope.selectedAccountsDisplayList.push($scope.updatedAccountListing[j]))})})}else $scope.getThemeDetailsException=!0})},function(){$scope.getAccountList(),$timeout(function(){$scope.getThemeDetails()},300)}()}angular.module("spApp").controller("themeDetailsController",themeDetailsController),themeDetailsController.$inject=["$scope","$element","$attrs","ngDialog","$timeout","sharedProperties","ajaxService","$rootScope","$localStorage","$filter"];
function themeListingController($scope,$q,$element,$attrs,ajaxService,$location,$http,$state,$filter,ngDialog,sharedProperties,$timeout,$rootScope,$localStorage){$scope.themesListMaster=[],$scope.getAllError=!1,$scope.searchTag=[],$scope.pageSize=10,$scope.statusInclude=[],$scope.textSearching="",$scope.intialPageSize=10,$scope.load=!0,$scope.formatMonth=function(d){if(null!==d&&"undefined"!=typeof d){var splitDate=d.split(" "),formatMonth=splitDate[0].substr(0,3).toUpperCase(),formattedDate=formatMonth+" "+splitDate[1]+" "+splitDate[2];return formattedDate}},$scope.getFullThemeList=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/goals/getAllGoals"}).then(function(response){if("true"===response.Success)$scope.getAllError=!1,$scope.themesListMaster=response.goals,$scope.returnMemberList($scope.pageSize);else{$scope.getAllError=!0;for(var key in response.error)$scope.getAllErrorMsg=response.error[key]}})},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.returnMemberList($scope.pageSize)},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize))},$scope.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},$scope.returnMemberList=function(pageSize){if(!$scope.themesListMaster.length)return!0;if($scope.searchTag.length&&!$scope.statusInclude.length&&($scope.themesList=angular.copy($scope.newArr)),$scope.searchTag.length&&$scope.statusInclude.length){$scope.combineArray=[];for(var i=0;i<$scope.newArr.length;i++)for(var j=0;j<$scope.checkBox.length;j++)$scope.newArr[i].email===$scope.checkBox[j].email&&$scope.combineArray.push($scope.newArr[i]);$scope.themesList=angular.copy($scope.combineArray)}!$scope.searchTag.length&&$scope.statusInclude.length&&($scope.themesList=angular.copy($scope.checkBox)),$scope.searchTag.length||$scope.statusInclude.length||($scope.themesList=angular.copy($scope.themesListMaster)),$scope.pageSize=pageSize,pageSize>=$scope.themesListMaster.length&&($scope.disabledInfinite=!0,$scope.pageSize=$scope.themesListMaster.length),$scope.load&&($scope.lastPredicate="name",$scope.lastReverse=!1,$scope.loadBtnCLicked=!1,$scope.load=!1),$scope.loadBtnCLicked&&($scope.loadBtnCLicked=!1),$scope.order($scope.lastPredicate,$scope.lastReverse),$scope.themesList=$scope.themesList},$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.order=function(predicate,reverse){$scope.lastPredicate=predicate,$scope.lastReverse=reverse,$scope.themesList=$filter("orderBy")($scope.themesList,predicate,reverse)},$scope.resetfilter=function(allmembers){$scope.pageSize=$scope.intialPageSize,$scope.newArr=[],$scope.searchTag=[],$scope.tags=[],$scope.filter={},$scope.statusInclude=[],$scope.adminc=!1,$scope.leadC=!1,$scope.textSearching="",$scope.searchText="","undefined"!=typeof this.selectedSearch&&(this.selectedSearch.userStatusFormatted="",this.selectedSearch.hiringRoles=""),$scope.themesList=angular.copy($scope.themesListMaster),"undefined"!=typeof allmembers&&($scope.pageSize=$scope.themesListMaster.length),angular.element($(".tags").find("input")).scope().newTag.text="",$scope.load=!0,$scope.disabledInfinite=!1,$rootScope.$broadcast("$scrollStart"),$scope.returnMemberList($scope.pageSize);var curr=$(".memberHolder");curr.find(".heading h4").removeClass("reverseon").removeClass("on"),curr.find(".heading h4:eq(0)").addClass("on")},$scope.updateStatusError=!1,$scope.updateAffiliateCodeStatus=function(status,pid){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/promotions/updateStatus",data:$.param({promotionId:pid,promotionStatus:status})}).then(function(response){if("true"===response.Success)$scope.updateStatusError=!1,ngDialog.close("ngdialog1"),$scope.getFullThemeList(),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Status</strong>",message:" updated successfully"});else{$scope.updateStatusError=!0;for(var key in response.error)$scope.updateStatusErrorMsg=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.updateStatusErrorMsg})}})},$scope.deactivateThemeException=!1,$scope.deActivateTheme=function(d,n){$scope.currentThemeName=n,$scope.processDeactivate=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/goals/deactivate",data:$.param({goalId:d})}).then(function(response){if("true"===response.Success)$scope.deactivateThemeException=!1,$scope.getFullThemeList(),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Status</strong>",message:" updated successfully"});else{$scope.deactivateThemeException=!0;for(var key in response.error)$scope.deactivateThemeExceptionMsg=response.error[key];ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.deactivateThemeExceptionMsg})}})},ngDialog.open({template:"/sp/resources/html/sysAdmin/learning-library/deactivateTheme.html",scope:$scope})},$scope.activateThemeException=!1,$scope.activateTheme=function(d){$scope.processActivate=function(){ajaxService.getAjaxResponse({url:"/sp/sysAdmin/goals/activate",data:$.param({goalId:d})}).then(function(response){if("true"===response.Success)$scope.activateThemeException=!1,$scope.getFullThemeList(),ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Status</strong>",message:" updated successfully"});else{$scope.activateThemeException=!0;for(var key in response.error)$scope.deactivateThemeExceptionMsg=response.error[key];ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:$scope.updateStatusErrorMsg})}})},ngDialog.open({template:"/sp/resources/html/sysAdmin/learning-library/activateTheme.html",scope:$scope})},function(){var growlNotification=$localStorage.get("gNotify");null!==growlNotification&&"undefined"!=typeof growlNotification&&("AddTheme"===growlNotification&&$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Theme</strong>",message:" created successfully"}),setTimeout(function(){$localStorage.remove("gNotify")},1e3)),$scope.getFullThemeList()}()}angular.module("spApp").controller("themeListingController",themeListingController),themeListingController.$inject=["$scope","$q","$element","$attrs","ajaxService","$location","$http","$state","$filter","ngDialog","sharedProperties","$timeout","$rootScope","$localStorage"];
function validateImportedListController($scope,$q,$element,$attrs,$http,ajaxService,$location,$state,$filter,ngDialog,sharedProperties,$timeout,$localStorage){$scope.memberList=[],$scope.masterMemberList=[],$scope.showfilter=!1,$scope.pageSize=200,$scope.intialPageSize=20,$scope.searchTag=[],$scope.hiringRoles=[],$scope.alldisplay=!1,$scope.filter={},$scope.tags=[],$scope.userEmail={email:[]},$scope.checkBox=[],$scope.submitDisabled=!1,$scope.allMembersEmailId=[],$scope.statusInclude=[],$scope.setEditMode=!1,$scope.userStatus=[],$scope.groupModule=[],$scope.masterGroupModule=[],$scope.textSearching="",$scope.mainGroupInfoList=[],$scope.checkedAll=!1,$scope.deleteUser=!1,$scope.deleteUserError=!1,$scope.updateGroup=!1,$scope.updateGroupError=!1,$scope.updateError="",$scope.EditGroupEmail="",$scope.archiveDialog={},$scope.archiveDialog.addHiring=!1,$scope.showArchive=!1,$scope.newDate={},$scope.totalRecords=0,$scope.totalConflicts=0,$scope.conflictException=!1,$scope.noEmailsError=!1,$scope.exceededAvailability=!1,$scope.cancelRedirect=function(){window.location="/sp/tools/hiring/"},$scope.newDate.currentDay=new Date,$scope.newDate={year:$scope.newDate.currentDay.getFullYear(),month:$scope.newDate.currentDay.getMonth()+1,day:$scope.newDate.currentDay.getDate()},$scope.formatDate=function(d){if(null!==d&&"undefined"!==d){var splitDate=d.split("-"),monthData={"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"},month=splitDate[1],formattedDate=monthData[month.toString()]+" "+parseInt(splitDate[2])+", "+parseInt(splitDate[0]);return formattedDate}},$scope.today=$scope.formatDate($scope.newDate.year+"-"+($scope.newDate.month<9?"0"+$scope.newDate.month:$scope.newDate.month)+"-"+$scope.newDate.day),$scope.formatName=function(n){if(null!==n||"undefined"!==n){var slpitName=n.split(", "),formatName=slpitName[1]+" "+slpitName[0];return formatName}},$scope.getMembersData=function(){var options={url:"/sp/hiring/multiInviteValidate",data:$.param({filesToProcess:$localStorage.get("files")}).replace(/%2C/g,",").replace(/%40/g,"@")};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&($scope.masterMemberList=response.hiring.length?response.hiring:[],$scope.returnMemberList($scope.pageSize),angular.forEach(response.hiring,function(val,index){$scope.allMembersEmailId.push(val.email)}),$scope.totalRecords=response.hiring.length,$.each($scope.masterMemberList,function(i){("ALREADY_EXISTS"===$scope.masterMemberList[i].userStatus||"ALREADY_EXISTS_ARCHIVED"===$scope.masterMemberList[i].userStatus)&&$scope.totalConflicts++}),$scope.totalRecords>$scope.availableSubscriptions&&($scope.candidateCountException=!0,$scope.removeCandidates=Math.abs($scope.totalRecords-$scope.availableSubscriptions)),$scope.totalConflicts>0||$scope.totalRecords>$scope.availableSubscriptions?$scope.submitDisabled=!0:$scope.submitDisabled=!1)})},$scope.getCandidateAvailability=function(){ajaxService.getAjaxResponse({url:"/sp/hiring/getAvailableSubscriptions"}).then(function(response){"true"===response.Success&&($scope.availableSubscriptions=response.availableHiringSubscripitons,setTimeout(function(){$scope.getMembersData()},200))})},$scope.enableAdvanceSection=function(event){$(event.currentTarget).closest(".complete-profile").find(".editable-section").show()},$scope.autoCompleteType=function(arr){for(var customarray=[],i=0;i<arr.length;i++)customarray.push({text:arr[i]});return customarray},$scope.order=function(predicate,reverse){$scope.memberList=$filter("orderBy")($scope.memberList,predicate,reverse)},$scope.loadTags=function(query){var deferred=$q.defer();return deferred.resolve($scope.getLoadSuggestion(query)),deferred.promise},$scope.getLoadSuggestion=function(query){for(var copyArray=[],i=0;i<$scope.tagListArray.length;i++)angular.lowercase($scope.tagListArray[i].text).indexOf(angular.lowercase(query))>-1&&copyArray.push($scope.tagListArray[i]);return copyArray.slice(0,5)},$scope.tagAdded=function(tag){$scope.searchTag.push(tag.text),$scope.refineSearch($scope.searchTag)},$scope.tagRemoved=function(tag){$scope.searchTag.splice($scope.searchTag.indexOf(tag.text),1),$scope.refineSearch($scope.searchTag)},$scope.refineSearch=function(list){$scope.newArr=[],angular.forEach($scope.masterMemberList,function(val,key){if(null!=val.tagList)for(var i=0;i<list.length;i++){var exists=val.tagList.indexOf(list[i]);exists>=0&&$scope.newArr.push(val)}}),$scope.checkboxFilter()},$scope.includeCheck=function(status){var i=$.inArray(status,$scope.statusInclude);i>-1?$scope.statusInclude.splice(i,1):$scope.statusInclude.push(status),$scope.checkboxFilter()},$scope.checkboxFilter=function(status){$scope.statusInclude.length>0&&($scope.checkBox=[],angular.forEach($scope.masterMemberList,function(val,index){for(var i=0;i<$scope.statusInclude.length;i++)for(var j=0;j<val.roles[i].length;j++)val.roles[j]===$scope.statusInclude[i]&&$scope.checkBox.push(val)})),$scope.returnMemberList($scope.pageSize)},$scope.searchTextFilter=function(search){$scope.textSearching=search,$scope.returnMemberList($scope.pageSize)},$scope.enableCancel=function(search){return"undefined"!=typeof search&&search.length>1?!0:!1},$scope.clearSearch=function(){$scope.textSearching.length&&($scope.textSearching="",$scope.searchText="",$scope.returnMemberList($scope.pageSize))},$scope.active=function(event){var currentElem=$(event.currentTarget);currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.returnMemberList=function(pageSize){if($scope.searchTag.length&&!$scope.statusInclude.length&&($scope.memberList=angular.copy($scope.newArr)),$scope.searchTag.length&&$scope.statusInclude.length){$scope.combineArray=[];for(var i=0;i<$scope.newArr.length;i++)for(var j=0;j<$scope.checkBox.length;j++)$scope.newArr[i].email===$scope.checkBox[j].email&&$scope.combineArray.push($scope.newArr[i]);$scope.memberList=angular.copy($scope.combineArray)}if(!$scope.searchTag.length&&$scope.statusInclude.length&&($scope.memberList=angular.copy($scope.checkBox)),$scope.searchTag.length||$scope.statusInclude.length||($scope.memberList=angular.copy($scope.masterMemberList)),$scope.textSearching.length>2){for(var copyArray=[],z=0;z<$scope.memberList.length;z++)angular.lowercase($scope.memberList[z].name).indexOf(angular.lowercase($scope.textSearching))>-1&&copyArray.push($scope.memberList[z]);$scope.memberList=angular.copy(copyArray)}pageSize>=$scope.memberList.length?$scope.alldisplay=!0:$scope.alldisplay=!1,$scope.pageSize=pageSize,$scope.memberList=$scope.memberList.slice(0,pageSize)},$scope.checkAll=function(){$scope.checkedAll=!$scope.checkedAll,$scope.negative?$scope.userEmail.email=$scope.masterMemberList.map(function(item){return{email:item.email,name:item.name}}):$scope.userEmail.email=[]},$scope.deleteContact=function(email){var index,counter=0;$.each($scope.masterMemberList,function(i){$scope.masterMemberList[i].email===email&&(index=i,("ALREADY_EXISTS"===$scope.masterMemberList[i].userStatus||"ALREADY_EXISTS_ARCHIVED"===$scope.masterMemberList[i].userStatus)&&$scope.totalConflicts--),counter++}),counter===$scope.masterMemberList.length&&($scope.masterMemberList.splice(index,1),$scope.memberList=angular.copy($scope.masterMemberList),$scope.totalRecords=$scope.memberList.length,0===$scope.totalConflicts&&$scope.totalRecords<=$scope.availableSubscriptions&&($scope.candidateCountException=!1,$scope.submitDisabled=!1))},$scope.resetfilter=function(allmembers){$scope.pageSize=$scope.intialPageSize,$scope.newArr=[],$scope.searchTag=[],$scope.tags=[],$scope.filter={},$scope.userEmail.email=[],$scope.statusInclude=[],$scope.adminc=!1,$scope.leadC=!1,$scope.textSearching="",$scope.searchText="","undefined"!=typeof $scope.selectedSearch&&($scope.selectedSearch.userStatus=""),$scope.memberList=angular.copy($scope.masterMemberList),"undefined"!=typeof allmembers&&($scope.pageSize=$scope.masterMemberList.length),$scope.returnMemberList($scope.pageSize),$scope.order("name",$scope.reverse);var currentElem=$(".memberHolder").find(".heading .m-name");currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},$scope.deleteButton=function(){},$scope.confirmDelete=function(event){var email=$(event.target).closest(".complete-profile").find(".email").html(),eve=angular.element(event.currentTarget),options={url:"/sp/hiring/deleteCandidate",data:$.param({candidateEmail:email})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?(angular.forEach($scope.masterMemberList,function(val,index){val.email===email&&$scope.masterMemberList.splice(index,1)}),angular.forEach($scope.memberList,function(val,index){val.email===email&&$scope.memberList.splice(index,1)}),angular.forEach($scope.checkBox,function(val,index){val.email===email&&$scope.checkBox.splice(index,1)}),$scope.searchTag.length&&angular.forEach($scope.newArr,function(val,index){val.email===email&&$scope.newArr.splice(index,1)}),$scope.returnMemberList($scope.pageSize),eve.scope().moreadvance=!eve.scope().moreadvance,$scope.deleteUser=!0,$timeout(function(){$scope.deleteUser=!1},5e3)):($scope.errorMessaage=response.error.InvalidRequestException,$scope.deleteUserError=!0,$timeout(function(){$scope.deleteUserError=!1},5e3))})},$scope.deleteUsers=function(emails){var emailList=[];jQuery.each(emails,function(i,j){emailList.push(emails[i].email)});var options={url:"/sp/hiring/deleteCandidate",data:$.param({candidateEmail:emailList.toString()})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&$scope.getMembersData()})},$scope.addClassActive=function(){$scope.dropUp=!$scope.dropUp},$scope.notificationEmail=function(emails){emails.length&&(sharedProperties.setEmail(emails),sharedProperties.setObject($scope.memberList),ngDialog.open({template:"return-visitor.html"}))},$scope.profileRoute=function(event){var groupname=$(event.currentTarget).data("routeparam");$localStorage.set("groupname",groupname),window.location.href="/sp/admin/group/#profile"},$scope.showFullList=function(){$scope.resetfilter("full")},$scope.editGroupSection=function(index){$scope.EditGroupEmail=this.memberList.email;var currentEmail=this.memberList.email;index="";for(var i=0;i<$scope.memberList.length;i++)currentEmail===$scope.memberList[i].email&&(index=i);$scope.setEditMode=!0,$scope.indexToChange=index,$scope.groupEditSection=angular.copy($scope.memberList[index]),$scope.groupSelectOption=[];for(var j=0;j<$scope.groupEditSection.groupAssociationList.length;j++)$scope.groupSelectOption.push($scope.groupEditSection.groupAssociationList[j].name);ngDialog.open({template:"/sp/admin/member/editGroup",scope:$scope})},$scope.enableLeadDialog=function(leadValue,index,groupName){for(var i=0;i<$scope.mainGroupInfoList.length;i++)if(groupName===$scope.mainGroupInfoList[i].name){if(null!==$scope.mainGroupInfoList[i].groupLead&&$scope.mainGroupInfoList[i].groupLead.email!==$scope.EditGroupEmail)return!1;$scope.groupEditSection.groupAssociationList[index].groupLead=!leadValue}},$scope.setStyle=function(lead){return $scope.viewMode(),lead===!0?!0:!1},$scope.isItEnabled=function(groupName,id){$scope.classActivate=[];for(var i=0;i<$scope.mainGroupInfoList.length;i++)groupName===$scope.mainGroupInfoList[i].name&&null!==$scope.mainGroupInfoList[i].groupLead&&$scope.mainGroupInfoList[i].groupLead.email!==$scope.EditGroupEmail&&($scope.classActivate.push("#mode_"+id),$scope.classActivate.push("#modeprop_"+id))},$scope.viewMode=function(){if($scope.classActivate.length)for(var i=0;i<$scope.classActivate.length;i++)$($scope.classActivate[i]).addClass("disabled")},$scope.addGroupToModule=function(groupName,lead){return $scope.selectedGroup=groupName,"default"===groupName?!1:(""===$scope.groupEditSection.groupAssociationList[0].name&&$scope.groupEditSection.groupAssociationList.splice(0,1),$scope.groupEditSection.groupAssociationList.push({name:groupName,groupLead:!1}),void $scope.groupSelectOption.push(groupName))},$scope.addGroupMember=function(names){return""===names?!1:!0},$scope.removeGroupDialog=function(event,groupName){for(var _this=event.target,current=($(_this).closest(".blockGroup").remove(),""),i=0;i<$scope.groupEditSection.groupAssociationList.length;i++)$scope.groupEditSection.groupAssociationList[i].name===groupName.name&&($scope.groupEditSection.groupAssociationList.splice(i,1),current=i);$scope.groupSelectOption.splice(current,1)},$scope.saveGroupToModule=function(groupName){for(var newArr="",i=0;i<$scope.groupEditSection.groupAssociationList.length;i++)newArr=newArr.length?newArr+","+$scope.groupEditSection.groupAssociationList[i].name+":"+$scope.groupEditSection.groupAssociationList[i].groupLead:$scope.groupEditSection.groupAssociationList[i].name+":"+$scope.groupEditSection.groupAssociationList[i].groupLead;var options={url:"/sp/admin/group/memberGroupUpdate",data:$.param({groupAssociationList:newArr,memberEmail:$scope.groupEditSection.email})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){$scope.groupEditSection.groupAssociationList.length?$scope.memberList[$scope.indexToChange]=$scope.groupEditSection:($scope.groupEditSection.groupAssociationList.push({name:"",groupLead:!1}),$scope.memberList[$scope.indexToChange]=$scope.groupEditSection);for(var i=0;i<$scope.masterMemberList.length;i++)$scope.masterMemberList[i].email===$scope.memberList[$scope.indexToChange].email&&($scope.masterMemberList[i]=$scope.groupEditSection);ngDialog.close("ngdialog1"),ngDialog.open({template:"/sp/admin/member/confirmation"})}else ngDialog.close("ngdialog1"),ngDialog.open({template:"/sp/admin/member/errorGroup"})})},$scope.memberTakeAway=function(email,id){$localStorage.set("candidateEmail",email).set("candidateID",id),window.location.href="/sp/tools/hiring/profile"},$scope.updatedEmaiList=function(emailList){var allEmailList=emailList,updatedEmails={membersToInvite:[],membersToAdd:[]},count=0;return $.each(allEmailList,function(i){$.each($scope.memberList,function(j){$scope.memberList[j].email===allEmailList[i]&&null===$scope.memberList[j].spUserId?updatedEmails.membersToInvite.push(allEmailList[i]):$scope.memberList[j].email===allEmailList[i]&&null!==$scope.memberList[j].spUserId&&null===$scope.memberList[j].existingCandidate&&updatedEmails.membersToAdd.push(allEmailList[i])}),count++}),count===allEmailList.length?(parseInt(updatedEmails.membersToInvite.length+updatedEmails.membersToAdd.length)>$scope.availableSubscriptions?($scope.submitDisabled=!0,$scope.candidateCountException=!0):($scope.submitDisabled=!1,$scope.candidateCountException=!1),updatedEmails):void 0},$scope.processImportList=function(f){$scope.noSelectionError=!1,$scope.importCandidateForm.submitted=!1,$scope.exceededAvailability=!1,$scope.noEmailsError=!1;var emailist,_params={};if($scope.importCandidateForm.$valid)if("all"===f.options)emailist=$scope.updatedEmaiList($scope.allMembersEmailId),_params={membersToInvite:emailist.membersToInvite.toString(),membersToAdd:emailist.membersToAdd.toString(),day:"undefined"!=typeof f.dueDate?f.dueDate.getDate():0,month:"undefined"!=typeof f.dueDate?f.dueDate.getMonth()+1:0,year:"undefined"!=typeof f.dueDate?f.dueDate.getFullYear():0},emailist.membersToInvite.length>0||emailist.membersToAdd.length>0?($scope.noEmailsError=!1,$scope.submitDisabled=!1,$scope.addInviteMultipleCandidates(_params)):($scope.noEmailsError=!0,$scope.importCandidateForm.submitted=!0);else{var emails=[],counter=0;$.each($scope.userEmail.email,function(i){emails.push($scope.userEmail.email[i].email),counter++}),counter===$scope.userEmail.email.length&&$scope.userEmail.email.length<=$scope.availableSubscriptions?(emailist=$scope.updatedEmaiList(emails),_params={membersToInvite:emailist.membersToInvite.toString(),membersToAdd:emailist.membersToAdd.toString(),day:"undefined"!=typeof f.dueDate?f.dueDate.getDate():0,month:"undefined"!=typeof f.dueDate?f.dueDate.getMonth()+1:0,year:"undefined"!=typeof f.dueDate?f.dueDate.getFullYear():0},emailist.membersToInvite.length>0||emailist.membersToAdd.length>0?($scope.noEmailsError=!1,$scope.addInviteMultipleCandidates(_params)):($scope.noEmailsError=!0,$scope.importCandidateForm.submitted=!0)):($scope.importCandidateForm.submitted=!0,$scope.exceededAvailability=!0)}else $scope.importCandidateForm.submitted=!0},$scope.addInviteMultipleCandidates=function(o){var options={url:"/sp/hiring/multiInvite",data:$.param(o)};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&0===response.error.length&&($localStorage.set("gNotify","import"),setTimeout(function(){window.location="/sp/tools/hiring/"},100))})},$scope.candidateCompare=function(email,id){$localStorage.set("candidateEmail",email).set("candidateID",id),window.location.href="/sp/tools/hiring/compare"},$scope.candidateAdvisor=function(email,id){$localStorage.set("candidateEmail",email).set("candidateID",id),window.location.href="/sp/tools/hiring/advisor"},$scope.calltoAction=function(select){return""===select?!1:void(window.location.href=select)},$scope.archiveDialog=function(e,n,r){$scope.archiveCandidate={name:n,email:e,roles:r},ngDialog.open({template:"/sp/resources/html/tools/hiring/archive-candidate.html",scope:$scope})},$scope.archiveAllCandidate=function(cEmail,isHired,single){var emailList=[];single!==!0?jQuery.each(cEmail,function(i,j){emailList.push(cEmail[i].email)}):emailList=cEmail;var options={url:"/sp/hiring/archiveCandidate",data:$.param({candidateEmail:emailList.toString(),isHired:isHired})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",title:"<strong> Candidate</strong>",message:" archived successfully"}),$scope.getMembersData(),$scope.negative=!$scope.negative)})},$scope.archiveAllDialog=function(emails){emails.length>0&&($scope.archiveCandidateAll={emails:emails},ngDialog.open({template:"/sp/resources/html/tools/hiring/archive-candidate-list.html",scope:$scope}))},$scope.sendViewProfileRequest=function(e,n){$scope.profileRequest={email:e,name:n,heading:"Request Access"},ngDialog.open({template:"/sp/resources/html/tools/hiring/send-profile-invite.html",scope:$scope}),$scope.sendRequest=function(e){var options={url:"/sp/notifications/sendNotification",data:$.param({memberEmail:e,type:""}).replace(/%40/g,"@")};ajaxService.getAjaxResponse(options).then(function(response){"true"!==response.Success&&$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:"Not able to send invite"})})}},$scope.getArchiveCandidateList=function(){var options={url:"/sp/hiring/getAllArchivedCandidates"};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success&&(response["hiring-archived"].length>0?$scope.showArchive=!0:$scope.showArchive=!1)})},$scope.sendReminder=function(e,n){$scope.profileRequest={email:e,name:n,heading:"Reminder"},ngDialog.open({template:"/sp/resources/html/tools/hiring/send-profile-invite.html",scope:$scope}),$scope.sendRequest=function(e){var options={url:"/sp/notifications/sendNotification",data:$.param({memberEmail:e,type:""}).replace(/%40/g,"@")};ajaxService.getAjaxResponse(options).then(function(response){"true"!==response.Success&&$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong> ",message:"Not able to send invite"})})}}}function notification($scope,sharedProperties){$scope.name=[];var memberList=sharedProperties.getObject(),emails=sharedProperties.getEmail();$scope.emailId=emails,angular.forEach(memberList,function(val,index){for(var i=0;i<emails.length;i++)emails[i]===val.email&&$scope.name.push(val.name)})}angular.module("spApp").controller("validateImportedListController",validateImportedListController),angular.module("spApp").controller("notification",notification),validateImportedListController.$inject=["$scope","$q","$element","$attrs","$http","ajaxService","$location","$state","$filter","ngDialog","sharedProperties","$timeout","$localStorage"],notification.$inject=["$scope","sharedProperties"];
function verifyEmailController($scope,$element,$attrs,ajaxService,$rootScope,sharedProperties,$localStorage){$scope.verifyEmailForm={},$scope.verifyEmailError=!1,$scope.verifyEmail=function(f){$scope.verifyEmailError=!1,$scope.verifyEmailForm.submitted=!1,$scope.verifyEmailForm.$valid?($scope.verifyEmailForm.submitted=!1,ajaxService.getAjaxResponse({url:"/sp/profileCopy/copyAssessment",data:$.param({copyFromEmail:f.email}).replace(/%40/g,"@")}).then(function(response){"true"===response.Success?($scope.verifyEmailError=!1,$localStorage.set("verifiedEmail",f.email),window.location.href="/sp/profileCopy/verifyEmailInvite"):$scope.verifyEmailError=!0})):$scope.verifyEmailForm.submitted=!0},$scope.getVerifyedEmail=function(){$scope.vEmail=$localStorage.get("verifiedEmail")},$scope.authorizeCopyProfile=function(){ajaxService.getAjaxResponse({url:"/sp/profileCopy/authorizeCopyProfile"}).then(function(response){"true"===response.Success?window.location.href="/sp/profileCopy/verifySuccess":window.location.href="/sp/profileCopy/verifyFailed"})}}angular.module("spApp").controller("verifyEmailController",verifyEmailController),verifyEmailController.$inject=["$scope","$element","$attrs","ajaxService","$rootScope","sharedProperties","$localStorage"];
function videoController($scope,$timeout,$rootScope,ngDialog,sharedProperties){function videoCall(){var videoSrc=sharedProperties.getVideoUrl();if(/youtube/g.test(videoSrc))vm.videoType="youtube";else if(/vimeo/g.test(videoSrc)){vm.videoType="vimeo";var link=videoSrc.split("?")[0].split("/");videoSrc="https://vimeo.com/"+link[parseInt(link.length-1)]}else vm.videoType="html5";"html5"!==vm.videoType&&setTimeout(function(){videojs(document.getElementById("vid1"),{autoplay:!0,techOrder:[vm.videoType],src:videoSrc},function(){this.on("ended",function(){var vid=this;vid.trigger("loadstart"),$timeout(function(){vid.posterImage.show()},500)}),this.on("timeupdate",function(){var ct=this.currentTime(),timeLeft=this.remainingTime();ct>0&&this.bigPlayButton.hide(),0===timeLeft&&this.bigPlayButton.show()})})},500)}var vm=this;vm.videoCall=videoCall,vm.videoType=""}angular.module("spApp").controller("videoController",videoController),videoController.$inject=["$scope","$timeout","$rootScope","ngDialog","sharedProperties"];
function fixContainer(){return{restrict:"A",link:function($scope,$element,$attrs){$scope.innerHeightSet=function(){jQuery($element[0]).css({"min-height":window.innerHeight-(jQuery("#header").outerHeight()+jQuery("#footer").outerHeight())}),$(".footer-wrapper").removeClass("visibilitynone")},jQuery(window).resize(function(){$scope.innerHeightSet()}),$scope.innerHeightSet()}}}angular.module("spApp").directive("fixContainer",fixContainer),$(".training-library").closest("#content").addClass("whiteBackground");
function barInfoGraph($rootScope,$timeout){return{restrict:"A",scope:{data:"=barData",barConfig:"@barConfig"},link:function(scope,element,attrs){function generateD3Chart(_data,_cfg){var _barData=_data,_barConfig=_cfg;graphId="#"+jQuery(element[0]).attr("id"),d3GraphWrap=d3.select(graphId),d3Graph=d3GraphWrap.append("svg").attr({width:"100%",height:"100%",viewBox:"0 0 "+jQuery(element[0]).width()+" "+jQuery(element[0]).height(),perserveAspectRatio:"none"});var _h=jQuery(element[0]).find("svg").height(),_w=jQuery(element[0]).find("svg").width(),_options={fill:_barData[_barConfig.name]>49?colors[_barConfig.type][0]:colors[_barConfig.type][1],width:"Vertical"===_barConfig.type?"100%":_barData[_barConfig.name]+"%",height:"Vertical"===_barConfig.type?_barData[_barConfig.name]+"%":"100%",x:"Vertical"===_barConfig.type?0:"Left"===_barConfig.dir?_w-_w*_barData[_barConfig.name]/100:0,y:"Vertical"===_barConfig.type&&"Top"===_barConfig.dir?_h-_h*_barData[_barConfig.name]/100:0};d3Graph.append("rect").attr(_options);for(var i=0;10>i;i++)i>0&&10>i&&d3Graph.append("rect").attr({fill:"#fff",x:"Vertical"===_barConfig.type?0:_w/10*i,y:"Vertical"===_barConfig.type?_h/10*i:0,width:"Vertical"===_barConfig.type?"100%":1,height:"Vertical"===_barConfig.type?1:"100%"})}if(Object.keys(scope.data).length){jQuery(element[0]).find("svg").remove();var graphId,d3GraphWrap,d3Graph,_config=JSON.parse(scope.barConfig.toString()),colors={Vertical:["#69519D","#BBB1E5"],Horizantal:["#26A6C3","#AAE3E8"]},initChart=null;initChart=$timeout(function(){generateD3Chart(scope.data,_config)},0)}scope.$watch("data",function(newValue,oldValue){jQuery(element[0]).find("svg").length&&(jQuery(element[0]).find("svg").remove(),initChart=$timeout(function(){generateD3Chart(scope.data,JSON.parse(scope.barConfig.toString()))},150))})}}}angular.module("spApp").directive("barInfoGraph",barInfoGraph),barInfoGraph.$inject=["$rootScope","$timeout"];
function candidateTags($http,ajaxService,$localStorage){return{restrict:"A",link:function($scope,$element,$attrs){function updateTagList(t,c){var textTags,context=c,_t=jQuery(t).find(".tagsinput"),tagCount=0;if(console.log(_t),textTags=[],jQuery.each(jQuery(_t).find("span.tag"),function(i,j){var formatTags=jQuery(this).find("span").html().replace(/&nbsp;/g," ").trim();textTags.push(formatTags),tagCount++}),tagCount===jQuery(_t).find("span.tag").length){var roleOptions={url:"/sp/hiring/updateRole",data:$.param({hiringRoles:textTags.toString(),candidateEmail:$localStorage.get("candidateEmail")}).replace(/%40/g,"@").replace(/%2C/g,",")},tagOptions={url:"/sp/hiring/updateTags",data:$.param({tagList:textTags.toString(),candidateEmail:$localStorage.get("candidateEmail")}).replace(/%40/g,"@").replace(/%2C/g,",")};ajaxService.getAjaxResponse("roles"===context?roleOptions:tagOptions).then(function(response){"true"===response.Success&&console.log("tags updates")})}}jQuery($element[0]).tagsInput({width:"100%",height:"100%",defaultText:jQuery($element[0]).attr("data-ph"),onAddTag:function(tag){var context="";jQuery($element[0]).hasClass("roles")&&(context="roles"),jQuery($element[0]).hasClass("tags")&&(context="tags"),updateTagList(jQuery($element[0]).parent(),context)},onRemoveTag:function(tag){var context="";jQuery($element[0]).hasClass("roles")&&(context="roles"),jQuery($element[0]).hasClass("tags")&&(context="tags"),updateTagList(jQuery($element[0]).parent(),context)}}),setTimeout(function(){jQuery($element[0]).importTags(jQuery($element[0]).attr("data-existing"))},800)}}}angular.module("spApp").directive("candidateTags",candidateTags),candidateTags.$inject=["$http","ajaxService","$localStorage"];
function capitalize(){return function(input,all){return input?input.replace(/([^\W_]+[^\s-]*) */g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()}):""}}angular.module("spApp").filter("capitalize",capitalize);
function clickOut($http){return{restrict:"A",link:function($scope,$element,$attrs){jQuery("body").on("click",function(e){jQuery(e.target).hasClass("clickOut")||($scope.dropUp=!1,$scope.$apply())})}}}angular.module("spApp").directive("clickOut",clickOut),clickOut.$inject=["$http"];
function cnoValidate(){return{restrict:"A",require:"ngModel",$scope:{invalidCCNo:"="},link:function($scope,$element,$attrs,$ctrl){function luhnChk(luhn){if("undefined"!=typeof luhn){for(var len=luhn.length,mul=0,prodArr=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],sum=0;len--;)sum+=prodArr[mul][parseInt(luhn.charAt(len),10)],mul^=1;return sum%10===0&&sum>0}}$scope.$watch(function(){if("undefined"!=typeof $ctrl.$viewValue&&$ctrl.$viewValue.length>0){var valid=luhnChk($ctrl.$viewValue);valid===!0?$ctrl.$setValidity("invalidCCNo",!0):$ctrl.$setValidity("invalidCCNo",!1)}else $ctrl.$setValidity("invalidCCNo",!0)})}}}angular.module("spApp").directive("cnoValidate",cnoValidate);
function companyPicUploader($http,ajaxService,$rootScope,$timeout,ngDialog,$localStorage){return{restrict:"A",link:function($scope,$element,$attrs){jQuery($element[0]).find(".select-image-btn").on("click",function(e){e.preventDefault();var fileInput=jQuery($element[0]).find("form.pic-uploader").find("input:file");if(fileInput.click(),$scope.enableBtns=!0,$scope.$apply(),jQuery("html").hasClass("ie10")&&$scope.prevImage===jQuery($element[0]).find(".image-editor").cropit("imageSrc")&&$scope.resetFlag===!0){jQuery($element[0]).find(".cropit-image-background").removeAttr("src"),jQuery($element[0]).find(".cropit-image-preview").removeClass("cropit-image-loaded");var img=jQuery($element[0]).find(".image-editor").cropit("imageSrc");jQuery($element[0]).find(".cropit-image-background").attr("src",img),jQuery($element[0]).find(".cropit-image-background-container").css({"background-image":'url("'+img+'")'}),jQuery($element[0]).find(".cropit-image-preview").css({"background-image":'url("'+img+'")'}).addClass("cropit-image-loaded"),$scope.prevImage="",$scope.resetFlag=!1}}),setTimeout(function(){jQuery($element[0]).find(".image-editor").cropit({imageBackground:!0,previewSize:{width:200,height:100},exportZoom:1,originalSize:!1})},500),jQuery($element[0]).find(".reset-image").on("click",function(e){if(e.preventDefault(),$scope.enableBtns===!0){$scope.enableBtns=!1,$scope.$apply();var fileInput=jQuery($element[0]).find("form.pic-uploader").find("input:file");fileInput.val(""),jQuery($element[0]).find(".avatar-company-upload div").each(function(){jQuery(this).css("background-image","none")}),$scope.resetFlag=!0,$scope.prevImage=jQuery($element[0]).find(".image-editor").cropit("imageSrc"),jQuery($element[0]).find(".cropit-image-background").attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7")}}),jQuery($element[0]).find(".saveInHolder").on("click",function(e){e.preventDefault(),$scope.enableBtns===!0&&null!==$scope.imageData&&($scope.enableBtns=!1,$(document).trigger("imageSaved",[{imageData:$scope.imageData}]),ngDialog.close("ngdialog1"))}),jQuery($element[0]).find(".process-pic").on("click",function(e){e.preventDefault();var hasBGImage="none"!==jQuery($element[0]).find(".cropit-image-preview").css("background-image");if(!hasBGImage)return $scope.enableBtns=!1,!1;if($scope.enableBtns===!0){$scope.enableBtns=!1,$scope.$apply(),$scope.imageData=jQuery($element[0]).find(".image-editor").cropit("export",{type:"image/jpeg",quality:.99,exportZoom:1,originalSize:!1});var options={url:"/sp/admin/company/uploadImage",data:$.param({image:$scope.imageData,companyId:$scope.themeCompanyId})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:" Image updated Successfully"}),$timeout(function(){$(document).trigger("imageSaved",[{imageData:$scope.imageData}]),ngDialog.close("ngdialog1")},500)):$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Image upload failed."})})}}),jQuery($element[0]).find(".select-company-logo").on("click",function(e){e.preventDefault();var fileInput=jQuery($element[0]).find("form.company-logo-uploader").find("input:file");fileInput.click(),$scope.enableBtns=!0,$scope.$apply()}),jQuery($element[0]).find("form.company-logo-uploader").find("input:file").change(function(){var preview=document.querySelector("img.company-image-preview"),logoImage=this.files[0],fr=new FileReader;fr.onload=function(){$scope.imageData=fr.result,preview.src=fr.result},fr.readAsDataURL(logoImage)}),jQuery($element[0]).find(".reset-company-logo, .reset-org-image").on("click",function(e){if(e.preventDefault(),$scope.enableBtns===!0){var preview=document.querySelector("img.company-image-preview");$scope.enableBtns=!1,$scope.$apply(),preview.src="/sp/resources/images/company-default.png",$scope.imageData=null}}),jQuery($element[0]).find(".process-company-logo").on("click",function(e){if(e.preventDefault(),$scope.enableBtns===!0&&null!==$scope.imageData){$scope.enableBtns=!1;var options={url:"/sp/admin/company/uploadImage",maximum:7e3,data:$.param({image:$scope.imageData,companyId:$scope.themeCompanyId})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?($.growl({icon:"glyphicon glyphicon-ok",message:" Image updated Successfully"}),$timeout(function(){$(document).trigger("imageSaved",[{imageData:$scope.imageData}]),ngDialog.close("ngdialog1")},100)):(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Image upload failed."}))})}})}}}angular.module("spApp").directive("companyPicUploader",companyPicUploader),companyPicUploader.$inject=["$http","ajaxService","$rootScope","$timeout","ngDialog","$localStorage"];
function dateSame(){return{require:"ngModel",link:function(scope,elem,attrs,ngModel){function validate(value){var isValid="",firstArg=scope.$eval(attrs.dateSame);return isValid=null!==firstArg&&void 0!==firstArg&&null!==value&&void 0!==value?firstArg.toString()!==value.toString():!0,ngModel.$setValidity("same",isValid),isValid?value:void 0}ngModel.$parsers.unshift(validate),scope.$watch(attrs.dateSame,function(){ngModel.$setViewValue(ngModel.$viewValue)})}}}function sameAs(){return{require:"ngModel",link:function(scope,elem,attrs,ngModel){function validate(value){var isValid=scope.$eval(attrs.sameAs)===value;return ngModel.$setValidity("same-as",isValid),isValid?value:void 0}ngModel.$parsers.unshift(validate),scope.$watch(attrs.sameAs,function(){ngModel.$setViewValue(ngModel.$viewValue)})}}}angular.module("spApp").directive("sameAs",sameAs),angular.module("spApp").directive("dateSame",dateSame),angular.module("spApp").directive("validationCheck",["$parse",function($parse){return{require:"ngModel",link:function(scope,elm,attrs,ngModel){var check=$parse(attrs.validationCheck);scope.$watch(check,function(newValue){ngModel.$setValidity(attrs.name,newValue)})}}}]);
function copyToClipboard($http,ajaxService,$rootScope,$timeout,ngDialog){return{restrict:"A",link:function($scope,$element,$attrs){var client=new ZeroClipboard(jQuery($element[0]));client.on("ready",function(readyEvent){client.on("aftercopy",function(event){$.growl({icon:"glyphicon glyphicon-ok",message:"Link copied"})})})}}}angular.module("spApp").directive("copyToClipboard",copyToClipboard),copyToClipboard.$inject=["$http","ajaxService","$rootScope","$timeout","ngDialog"];
function focusIf($timeout){function link($scope,$element,$attrs){function focusFn(condition){condition&&$timeout(function(){dom.focus()},$scope.$eval($attrs.focusDelay)||0)}var dom=$element[0];$attrs.focusIf?$scope.$watch($attrs.focusIf,focusFn):focusFn(!0)}return{restrict:"A",link:link}}angular.module("spApp").service("debounce",["$timeout",function($timeout){return function(func,wait,immediate){function debounce(){context=this,args=arguments;var later=function(){timeout=null,immediate||(result=func.apply(context,args))},callNow=immediate&&!timeout;return timeout&&$timeout.cancel(timeout),timeout=$timeout(later,wait),callNow&&(result=func.apply(context,args)),result}var timeout,args,context,result;return debounce.cancel=function(){$timeout.cancel(timeout),timeout=null},debounce}}]).directive("debounce",["debounce","$parse",function(debounce,$parse){return{require:"ngModel",priority:999,link:function($scope,$element,$attrs,ngModelController){var debouncedValue,pass,debounceDuration=$parse($attrs.debounce)($scope),immediate=!!$parse($attrs.immediate)($scope),prevRender=ngModelController.$render.bind(ngModelController),commitSoon=debounce(function(viewValue){pass=!0,ngModelController.$setViewValue(viewValue),pass=!1},parseInt(debounceDuration,10),immediate);ngModelController.$render=function(){prevRender(),commitSoon.cancel(),debouncedValue=this.$viewValue},ngModelController.$parsers.unshift(function(value){return pass?(debouncedValue=value,value):(commitSoon(ngModelController.$viewValue),debouncedValue)})}}}]),angular.module("spApp").directive("ngEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.ngEnter)}),event.preventDefault())})}}),angular.module("spApp").filter("addEllipsis",function(){return function(input,number){return input?input.length>number?input.substring(0,number)+"...":input:void 0}}),angular.module("spApp").filter("unique",function(){return function(arr,field){var i,o={},l=arr.length,r=[];for(i=0;l>i;i+=1)o[arr[i][field]]=arr[i];for(i in o)r.push(o[i]);return r}}),angular.module("spApp").directive("autoFocus",function(){return function(scope,element,attr){element[0].focus()}}),angular.module("spApp").directive("focusIf",focusIf),focusIf.$inject=["$timeout"],angular.module("spApp").filter("removeSpaces",function(){return function(text){var str=text.replace(/\s+/g,"");return str.toLowerCase()}}),angular.module("spApp").filter("secureHtml",["$sce",function($sce){return function(input){return $sce.trustAsHtml(input)}}]),angular.module("spApp").filter("percentage",function(){return function(input){return input+"%"}}),angular.module("spApp").filter("tel",function(){return function(tel){if(!tel)return"";var value=tel.toString().trim().replace(/^\+/,"");if(value.match(/[^0-9]/))return tel;var country,city,number;switch(value.length){case 10:country=1,city=value.slice(0,3),number=value.slice(3);break;case 11:country=value[0],city=value.slice(1,4),number=value.slice(4);break;case 12:country=value.slice(0,3),city=value.slice(3,5),number=value.slice(5);break;default:return tel}return 1===country&&(country=""),number=number.slice(0,3)+"-"+number.slice(3),(country+" ("+city+") "+number).trim()}}),angular.module("spApp").directive("compile",["$compile","$rootScope","$state","$localStorage",function($compile,$rootScope,$state,$localStorage){return function(scope,element,attrs){scope.profileRoute=function(){$localStorage.set("groupname",scope.group.name),$state.go("profile")},scope.$watch(function(scope){return scope.$eval(attrs.compile)},function(value){""===value.name?element.html("<a href='javascript:void(0)' addgroup>"+$rootScope.pullInterNationalization("admin.member.addtogroup")+"</a>"):value.name?value.groupLead?element.html("<a href='javascript:void(0)' data-routeparam ='"+value.name+"' ng-click='profileRoute()'>"+value.name+"<span class='groupLead'>"+$rootScope.pullInterNationalization("admin.member.leadsign")+"</span></a>"):element.html("<a href='javascript:void(0)' data-routeparam ='"+value.name+"' ng-click='profileRoute()'>"+value.name+"</a>"):element.html(value),$compile(element.contents())(scope)})}}]),angular.module("App",[]).filter("search",["$filter",function($filter){return function(items,text){if(!text||0===text.length)return items;var searchTerms=text.split(" ");return searchTerms.forEach(function(term){term&&term.length&&(items=$filter("filter")(items,term))}),items}}]),angular.module("spApp").directive("dynamicName",["$parse",function($parse){return{restrict:"A",priority:1e4,controller:["$scope","$element","$attrs",function($scope,$element,$attrs){var name=$attrs.dynamicName.replace("$index",$scope.$index);delete $attrs.dynamicName,$element.removeAttr("data-dynamic-name"),$element.removeAttr("dynamic-name"),$attrs.$set("name",name)}]}}]),angular.module("spApp").directive("changeName",["$parse",function($parse){return{restrict:"A",priority:1e4,controller:["$scope","$element","$attrs",function($scope,$element,$attrs){var name=$attrs.changeName.replace("$index",$scope.$index).replace("ctrl.currentActionPlan",$scope.ctrl.currentActionPlan).replace("actionList.type",void 0===$scope.actionList?"":$scope.actionList.type).replace("parentIndex",$scope.parentIndex).replace("superIndex",$scope.superIndex).replace("currentIndex",$scope.currentIndex);delete $attrs.changeName,$element.removeAttr("data-change-name"),$element.removeAttr("change-name"),$attrs.$set("name",name)}]}}]),angular.module("spApp").directive("createLayout",["$compile","$rootScope","$localStorage",function($compile,$rootScope,$localStorage){return{restrict:"C",scope:{},link:function(scope,element,attrs){scope.profileRoute=function(){$localStorage.set("memEmail",scope.$parent.groupList.groupLead.email),window.location.href="/sp/admin/account/member/details?email="+scope.$parent.groupList.groupLead.email},attrs.$observe("listcomp",function(listcomp){var value=JSON.parse(listcomp);if(value.name)if("undefined"!=typeof value.groupLead&&null===value.groupLead)element.html("<a href='javascript:void(0)' addlead class='agl'>"+$rootScope.pullInterNationalization("admin.group.assigngrouplead")+"</a>");else if("undefined"!=typeof value.groupLead.email&&null!==value.groupLead.email){var mailto="mailto:"+value.groupLead.email;element.html("<div class='name'><a href='javascript:void(0)' ng-click='profileRoute()' class='nameDetail'>"+value.groupLead.name+"</a></div><a href='"+mailto+"' class='email'>"+value.groupLead.email+"</div>")}else element.html("<a href='javascript:void(0)'>"+value.name+"</a>");else element.html(value);$compile(element.contents())(scope)})}}}]),angular.module("spApp").directive("inviteLink",["$compile","$rootScope",function($compile,$rootScope){return{restrict:"AC",scope:{callViewMember:"&",naming:"=namingType"},replace:!0,link:function(scope,element,attrs){attrs.$observe("listcomp",function(listcomp){var value=JSON.parse(listcomp);if("invite"===value.email)element.html("<a href='javascript:void(0)' id='event_button_360_request' class='clearfix' data-invite='true'><span class='symbol'>+</span><span class='naming'>"+scope.naming+"</span></a>");else if("inviteGrowth"===value.email)element.html("<a href='javascript:void(0)' id='event_new-member_add-data_invite' class='clearfix' data-invite='true'><span class='symbol'>+</span><span class='naming'>"+scope.naming+"</span></a>");else{var name="",img="",email="";"undefined"!=typeof value.user?(name=null===value.user.name?"":value.user.name,img=null!==value.user.smallProfileImage?"<img ng-src='"+value.user.smallProfileImage+"' class='img'></img>":"<div class='imgReplacement'>"+value.user.userInitials+"</div>",email=value.user.email):(name=null===value.name?"":value.name,img=null!==value.smallProfileImage?"<img ng-src='"+value.smallProfileImage+"' class='img'></img>":"<div class='imgReplacement'>"+value.userInitials+"</div>",email=value.email),element.html("<a href='javascript:void(0)' class='clearfix memberClass' data-invite='false'><span class='beak'></span><div class='left'>"+img+"</div><div class='right'><div class='name'>"+name+"</div><div class='email'>"+email+"</div></div></a>")}$compile(element.contents())(scope)})}}}]),angular.module("spApp").directive("processRequest",["$compile",function($compile){return{restrict:"AC",scope:{callViewMember:"&"},replace:!0,link:function(scope,element,attrs){attrs.$observe("assessment",function(assessment){var value=JSON.parse(assessment);if("object"==typeof value.requestProgressStatus&&value.requestProgressStatus){for(var htmlAppend="",firstFalse=-1!==value.requestProgressStatus.indexOf(null)?value.requestProgressStatus.indexOf(null):value.requestProgressStatus.length,i=0;i<value.requestProgressStatus.length;i++){var newClass="stField3";"true"===value.requestProgressStatus[i]?newClass="stField":"false"===value.requestProgressStatus[i]&&(newClass="stField2"),htmlAppend+="<div class='"+newClass+"' style='width:"+100/value.requestProgressStatus.length+"%'></div>"}element.html(htmlAppend+"<div class='end'>"+firstFalse+" of "+value.requestProgressStatus.length+"</div>")}else"Active"===value.requestStatus?element.html("<div class='notinitated'>Not Initated</div>"):element.html("<div class='notinitated'>"+value.requestStatus+"</div>");$compile(element.contents())(scope)})}}}]),angular.module("spApp").directive("addgroup",["$compile",function($compile){return{restrict:"A",scope:!1,link:function(scope,element,attrs){element.bind("click",function(){scope.ctrl.oneTime&&(scope.ctrl.getGroupsData(),scope.ctrl.oneTime=!1),$(element).parent().find(".model").length?($(element).closest(".complete-profile").find(".selectModal").addClass("hide"),$(element).closest(".complete-profile").find(".addModal").removeClass("hide")):(scope.ctrl.groupModuleSelected="",$(element).closest(".complete-profile").find(".addModal").addClass("hide"),$(element).closest(".complete-profile").find(".selectModal").removeClass("hide"))})}}}]),angular.module("spApp").directive("addlead",["$compile",function($compile){return{restrict:"A",scope:!1,link:function(scope,element,attrs){element.bind("click",function(){scope.$parent.ctrl.pageSetting.oneTime&&(scope.$parent.ctrl.getAllMembers(),scope.$parent.ctrl.pageSetting.oneTime=!1),$(element).parent().find(".groups").length?($(element).closest(".group-profile").find(".selectModal").addClass("hide"),$(element).closest(".group-profile").find(".addModal").removeClass("hide")):($(element).closest(".group-profile").find(".addModal").addClass("hide"),$(element).closest(".group-profile").find(".selectModal").removeClass("hide"),$(element).closest(".group-profile").find(".viewable").addClass("selectModalOpen"))})}}}]),angular.module("spApp").directive("addremove",["ajaxService","$rootScope",function(ajaxService,$rootScope){return{restrict:"A",scope:!1,link:function(scope,element,attrs){element.bind("click",function(){if($(element).data("add")){if("undefined"==typeof scope.ctrl.groupModuleSelected||""===scope.ctrl.groupModuleSelected)return!1;var id=$(element).closest(".complete-profile").attr("id"),name=scope.ctrl.groupModuleSelected,email=scope.ctrl.memberList[id].email,options=(scope.ctrl.listingView,{url:"/sp/admin/group/addMember",data:$.param({name:name,memberEmail:email})});ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){scope.ctrl.listingView="ASSESSMENT",$(element).closest(".complete-profile").find(".selectModal").addClass("hide"),$(element).closest(".complete-profile").find(".addModal").removeClass("hide");for(var i=0;i<scope.ctrl.memberList.length;i++)if(scope.ctrl.memberList[i].email===email){scope.ctrl.memberList[i]=response.member;break}for(var j=0;j<scope.ctrl.masterMemberList.length;j++)if(scope.ctrl.masterMemberList[j].email===email){scope.ctrl.masterMemberList[j]=response.member;break}scope.ctrl.updateGroup=!0,$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.memberadded")})}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}else $(element).data("remove")&&(scope.ctrl.groupModuleSelected="",$(element).closest(".complete-profile").find(".selectModal").addClass("hide"),$(element).closest(".complete-profile").find(".addModal").removeClass("hide"))})}}}]),angular.module("spApp").directive("armember",["sharedProperties","ajaxService","$rootScope",function(sharedProperties,ajaxService,$rootScope,$scope){return{restrict:"A",scope:!1,link:function(scope,element,attrs){element.bind("click",function(){if($(element).data("add")){if("undefined"==typeof scope.selectedLead)return!1;if("undefined"==typeof scope.selectedLead.originalObject.email)return!1;var email=($(element).closest(".group-profile").attr("id"),scope.selectedLead.originalObject.email),name=scope.groupList.name,options={url:"/sp/admin/group/addMember",data:$.param({name:name,memberEmail:email,isGroupLead:!0})};ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success){$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.updateMessage")}),$(element).closest(".group-profile").find(".selectModal").addClass("hide"),$(element).closest(".group-profile").find(".addModal").removeClass("hide");for(var i=0;i<scope.ctrl.groupList.length;i++)scope.ctrl.groupList[i].name===name&&(scope.ctrl.groupList[i].groupLead=response.member,scope.ctrl.groupList[i].numOfMembers=response.numMembers);scope.ctrl.actionToClear()}else if(null!=response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}else $(element).data("remove")&&($(element).closest(".group-profile").find(".selectModal").addClass("hide"),$(element).closest(".group-profile").find(".addModal").removeClass("hide"),$(element).closest(".group-profile").find(".viewable").removeClass("selectModalOpen"))})}}}]),angular.module("spApp").directive("prmember",["sharedProperties","ajaxService","$rootScope",function(sharedProperties,ajaxService,$rootScope,$scope){return{restrict:"A",scope:!1,link:function(scope,element,attrs){element.bind("click",function(){if($(element).data("add")){if("undefined"==typeof scope.selectedLead)return!1;if("undefined"==typeof scope.selectedLead.originalObject.email)return!1;var email=($(element).closest(".complete-profile").attr("id"),scope.selectedLead.originalObject.email),name=scope.ctrl.profileList.name,options=(scope.ctrl.listingView,{url:"/sp/admin/group/addMember",data:$.param({name:name,memberEmail:email,isGroupLead:!1})});ajaxService.getAjaxResponse(options).then(function(response){if("true"===response.Success)scope.ctrl.listingView="ASSESSMENT",$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("admin.group.profile.updateAddGroup")}),scope.ctrl.profileList.memberSummaryList.push({user:response.member}),null!=scope.ctrl.profileList.groupLead&&scope.ctrl.profileList.groupLead.email===response.member.email&&(scope.ctrl.profileList.groupLead=null),sharedProperties.spilceIndexWithBreak(scope.ctrl.allEmails,"email",email),scope.ctrl.actionToClear(),scope.ctrl.showAddMember=!scope.ctrl.showAddMember,scope.ctrl.enableAddMember=!scope.ctrl.enableAddMember;else if(null!=response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}})}}}]),angular.module("checklist-model",[]).directive("checklistModel",["$parse","$compile",function($parse,$compile){function contains(arr,item){if(angular.isArray(arr))for(var i=0;i<arr.length;i++)if(angular.equals(arr[i],item))return!0;return!1}function add(arr,item){arr=angular.isArray(arr)?arr:[];for(var i=0;i<arr.length;i++)if(angular.equals(arr[i],item))return arr;return arr.push(item),arr}function remove(arr,item){if(angular.isArray(arr))for(var i=0;i<arr.length;i++)if(angular.equals(arr[i],item)){arr.splice(i,1);break}return arr}function postLinkFn(scope,elem,attrs){$compile(elem)(scope);var getter=$parse(attrs.checklistModel),setter=getter.assign,value=$parse(attrs.checklistValue)(scope.$parent);scope.$watch("checked",function(newValue,oldValue){if(newValue!==oldValue){var current=getter(scope.$parent);newValue===!0?setter(scope.$parent,add(current,value)):setter(scope.$parent,remove(current,value))}}),scope.$parent.$watch(attrs.checklistModel,function(newArr,oldArr){scope.checked=contains(newArr,value)},!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(tElement,tAttrs){if("INPUT"!==tElement[0].tagName||!tElement.attr("type","checkbox"))throw'checklist-model should be applied to `input[type="checkbox"]`.';if(!tAttrs.checklistValue)throw"You should provide `checklist-value`.";return tElement.removeAttr("checklist-model"),tElement.attr("ng-model","checked"),postLinkFn}}}]),angular.module("spApp").directive("repeatDone",function(){return function(scope,element,attrs){scope.$last&&window.setTimeout(function(){scope.$eval(attrs.repeatDone)},100)}}),angular.module("spApp").directive("progressBar",function(){return{restrict:"EA",scope:{total:"=total",complete:"=complete",barClass:"@barClass"},transclude:!0,link:function(scope,elem,attrs){scope.completedClass="progress-bar-success",scope.$watch("complete",function(){var progress=scope.complete/scope.total;progress>=1?$(elem).find(".progress-bar").addClass(scope.completedClass):1>progress&&$(elem).find(".progress-bar").removeClass(scope.completedClass)})},template:"<div class='progress'><div class='progress-bar {{barClass}}' style='width:{{complete}}%'></div></div>"}}),angular.module("spApp").directive("ddTextCollapse",["$compile",function($compile){return{restrict:"A",scope:!0,link:function(scope,element,attrs){scope.collapsed=!1,scope.toggle=function(){scope.collapsed=!scope.collapsed},attrs.$observe("ddTextCollapseText",function(text){var maxLength=scope.$eval(attrs.ddTextCollapseMaxLength);if(text.length>maxLength){var firstPart=String(text).substring(0,maxLength),secondPart=String(text).substring(maxLength,text.length),firstSpan=$compile("<span>"+firstPart+"</span>")(scope),secondSpan=$compile('<span ng-if="collapsed">'+secondPart+"</span>")(scope),moreIndicatorSpan=$compile('<span ng-if="!collapsed">... </span>')(scope),lineBreak=$compile('<br ng-if="collapsed">')(scope),toggleButton=$compile('<span class="collapse-text-toggle" ng-click="toggle()">{{collapsed ? "LESS" : "MORE"}}</span>')(scope);element.empty(),element.append(firstSpan),element.append(secondSpan),element.append(moreIndicatorSpan),element.append(lineBreak),element.append(toggleButton)}else element.empty(),element.append(text)})}}}]),angular.module("spApp").filter("thousandSuffix",function(){return function(input,decimals){var exp,suffixes=["k","M","G","T","P","E"];return window.isNaN(input)?null:1e3>input?input:(exp=Math.floor(Math.log(input)/Math.log(1e3)),(input/Math.pow(1e3,exp)).toFixed(decimals)+suffixes[exp-1])}}),angular.module("spApp").directive("imageonload",function(){return{restrict:"A",link:function(scope,element,attrs){element.bind("load",function(){scope.$apply(attrs.imageonload)})}}}),angular.module("spApp").directive("convertToNumber",function(){return{require:"ngModel",link:function(scope,element,attrs,ngModel){ngModel.$parsers.push(function(val){return parseInt(val,10)}),ngModel.$formatters.push(function(val){return""+val})}}});
function decisionInfoGraph($rootScope,$timeout){return{restrict:"A",scope:{data:"=dmKeys"},link:function(scope,element,attrs){function generateD3Chart(_data){var _dmData=_data;graphId="#"+jQuery(element[0]).attr("id"),d3GraphWrap=d3.select(graphId),d3Graph=d3GraphWrap.insert("svg","div.on-graph-labels"),d3Graph=d3GraphWrap.select("svg").attr({width:isPdf?190:jQuery(element[0]).width(),height:isPdf?190:jQuery(element[0]).width(),viewBox:isPdf?"0 0 190 190":"0 0 "+jQuery(element[0]).width()+" "+jQuery(element[0]).width(),perserveAspectRatio:"none"}),isPdf&&jQuery(element[0]).find(".on-graph-labels").css({width:190,height:190});var gWidth=jQuery(element[0]).find("svg").width(),gHeight=jQuery(element[0]).find("svg").width(),xMid=gWidth/2,yMid=gHeight/2;d3Graph.append("rect").attr({fill:"#E8E8E8",x:0,y:0,width:"100%",height:"100%"});var dPointX=gWidth/2/100*_dmData.Rapid,dPointY=gHeight/2/100*_dmData.Inward,dmMax=0,colors=["#57AE52","#E7DF18","#D0362E"],defaultColor=colors[0];for(var key in scope.data)scope.data[key]>dmMax&&(dmMax=scope.data[key]);dmMax>80&&(defaultColor=colors[1]),dmMax>90&&(defaultColor=colors[2]),d3Graph.append("rect").attr({fill:defaultColor,x:dPointX,y:dPointY,width:gWidth/2,height:gHeight/2}),d3Graph.append("line").attr({x1:xMid,y1:0,x2:xMid,y2:gHeight,"stroke-width":1,stroke:"#fff"}),d3Graph.append("line").attr({x1:0,y1:yMid,x2:gWidth,y2:yMid,"stroke-width":1,stroke:"#fff"});for(var gridLines=20,ySpacing=gHeight/gridLines,xSpacing=gWidth/gridLines,i=0;gridLines>i;i++)i>0&&gridLines>i&&10!==i&&(d3Graph.append("rect").attr({fill:"#fff",x:i%5===0?xMid-8:xMid-5,y:ySpacing*i,width:i%5===0?16:10,height:1}),d3Graph.append("rect").attr({fill:"#fff",x:xSpacing*i,y:i%5===0?yMid-8:yMid-5,width:1,height:i%5===0?16:10}))}if(Object.keys(scope.data).length){jQuery(element[0]).find("svg").remove();var graphId,d3GraphWrap,d3Graph,initChart=null,isPdf="undefined"!=typeof jQuery(element[0]).attr("data-pdf")?!0:!1;initChart=$timeout(function(){generateD3Chart(scope.data)},0)}scope.$watch("data",function(newValue,oldValue){jQuery(element[0]).find("svg").length&&(jQuery(element[0]).find("svg").remove(),initChart=$timeout(function(){generateD3Chart(scope.data)},150))})}}}angular.module("spApp").directive("decisionInfoGraph",decisionInfoGraph),decisionInfoGraph.$inject=["$rootScope","$timeout"];
function genericTagInput($http,$rootScope,$timeout){return{restrict:"A",link:function($scope,$element,$attrs){function updateTags(tagContainer){var _t=jQuery(tagContainer).find(".tagsinput"),_tInput=jQuery(tagContainer).find("input.storeTagsHere").attr("ng-model").split("."),textTags=[];$scope[_tInput[0]][_tInput[1]]=null,$scope.$apply(),jQuery.each(jQuery(_t).find("span.tag"),function(i,j){var formatTags=jQuery(this).find("span").html().replace(/&nbsp;/g," ").trim();-1===jQuery.inArray(formatTags,_existingTags)&&textTags.push(formatTags)}),$scope[_tInput[0]][_tInput[1]]=textTags.join(),$scope.$apply()}var _existingTags=[];$rootScope.inviteReady===!0&&$timeout(function(){jQuery($element[0]).tagsInput({width:"100%",height:"100%",defaultText:"undefined"!=typeof $rootScope.pullInterNationalization(jQuery($element[0]).attr("data-ph"))||null!==$rootScope.pullInterNationalization(jQuery($element[0]).attr("data-ph"))?$rootScope.pullInterNationalization(jQuery($element[0]).attr("data-ph")):jQuery($element[0]).attr("data-ph"),getTabIndex:"undefined"!=typeof jQuery($element[0]).attr("data-tab")?jQuery($element[0]).attr("data-tab"):"",onAddTag:function(tag){var tags=tag.split(",");return tags.length>1?($(this).removeTag(tag),!1):void updateTags(jQuery($element[0]).parent())},onRemoveTag:function(){updateTags(jQuery($element[0]).parent())}}),setTimeout(function(){_existingTags=jQuery($element[0]).attr("data-existing").split(","),"undefined"!=typeof jQuery($element[0]).attr("data-existing")&&(jQuery($element[0]).importTags(jQuery($element[0]).attr("data-existing")),updateTags(jQuery($element[0]).parent()))},500)},1e3)}}}angular.module("spApp").directive("genericTagInput",genericTagInput),genericTagInput.$inject=["$http","$rootScope","$timeout"];
function personalityInfoGraph($rootScope,$timeout){return{restrict:"A",scope:{data:"=personalityScore"},link:function(scope,element,attrs){function convertScoreToCoords(data){var _getData=data,_p=_getData.Primary.segmentScore.toString(),_s=_getData.UnderPressure.segmentScore.toString(),_w=jQuery(element[0]).find("svg").width(),_h=jQuery(element[0]).find("svg").height(),_c={x:Math.floor(_w/2),y:Math.floor(_h/2)};return{c:_c,p:{powerful:{x:Math.floor(_c.x-_p.substr(0,1)*multplier*(_w/2)),y:Math.floor(_c.y-_p.substr(0,1)*multplier*(_h/2))},versatile:{x:Math.floor(_c.x+_p.substr(1,1)*multplier*(_w/2)),y:Math.floor(_c.y-_p.substr(1,1)*multplier*(_h/2))},adaptable:{x:Math.floor(_c.x+_p.substr(2,1)*multplier*(_w/2)),y:Math.floor(_c.y+_p.substr(2,1)*multplier*(_h/2))},precise:{x:Math.floor(_c.x-_p.substr(3,1)*multplier*(_w/2)),y:Math.floor(_c.y+_p.substr(3,1)*multplier*(_h/2))}},s:{powerful:{x:Math.floor(_c.x-_s.substr(0,1)*multplier*(_w/2)),y:Math.floor(_c.y-_s.substr(0,1)*multplier*(_h/2))},versatile:{x:Math.floor(_c.x+_s.substr(1,1)*multplier*(_w/2)),y:Math.floor(_c.y-_s.substr(1,1)*multplier*(_h/2))},adaptable:{x:Math.floor(_c.x+_s.substr(2,1)*multplier*(_w/2)),y:Math.floor(_c.y+_s.substr(2,1)*multplier*(_h/2))},precise:{x:Math.floor(_c.x-_s.substr(3,1)*multplier*(_w/2)),y:Math.floor(_c.y+_s.substr(3,1)*multplier*(_h/2))}}}}function generateD3Chart(data){graphId="#"+jQuery(element[0]).attr("id"),d3GraphWrap=d3.select(graphId),d3Graph=d3GraphWrap.append("svg").attr({width:"100%",height:"100%",viewBox:"0 0 "+jQuery(element[0]).width()+" "+jQuery(element[0]).width(),perserveAspectRatio:"none"});var _w=jQuery(element[0]).find("svg").width(),_h=jQuery(element[0]).find("svg").height(),_s=convertScoreToCoords(data);d3Graph.append("rect").attr({fill:"#D3D3D3",width:Math.floor(57*_w/100),height:Math.floor(57*_h/100),x:Math.floor((_w-57*_w/100)/2),y:Math.floor((_h-57*_h/100)/2)});for(var o in _s.s)0===_s.s[o].x&&(_s.s[o].x=3),0===_s.s[o].y&&(_s.s[o].y=3);d3Graph.append("path").attr({"class":"prismG0","stroke-width":3,stroke:"#339966","stroke-linecap":"round","stroke-linejoin":"round",fill:"#66CC99","fill-opacity":.3,"stroke-opacity":.3,"stroke-dasharray":"3,6",d:"M "+_s.s.powerful.x+" "+_s.s.powerful.y+" L "+_s.s.versatile.x+" "+_s.s.versatile.y+" L "+_s.s.adaptable.x+" "+_s.s.adaptable.y+" L "+_s.s.precise.x+" "+_s.s.precise.y+" L "+_s.s.powerful.x+" "+_s.s.powerful.y}),d3Graph.append("path").attr({"class":"crossLines0","stroke-width":1,stroke:"#fefdf8",d:"M 0 "+_h+" L "+_w+" 0 M 0 0 L "+_w+" "+_h}),d3Graph.append("path").attr({"class":"prismG2","fill-opacity":.6,"stroke-opacity":.6,fill:"#FFCC00","stroke-width":3,stroke:"#FF9900","stroke-linecap":"round","stroke-linejoin":"round",d:"M "+_s.p.powerful.x+" "+_s.p.powerful.y+" L "+_s.p.versatile.x+" "+_s.p.versatile.y+" L "+_s.p.adaptable.x+" "+_s.p.adaptable.y+" L "+_s.p.precise.x+" "+_s.p.precise.y+" L "+_s.p.powerful.x+" "+_s.p.powerful.y}),d3Graph.append("path").attr({"class":"crossLines1","stroke-width":0,stroke:"#fefdf8",d:"M 0 "+_h+" L "+_w+" 0 M 0 0 L "+_w+" "+_h}),d3Graph.append("path").attr({"class":"prismG1","stroke-width":3,stroke:"#339966","stroke-linecap":"round","stroke-linejoin":"round",fill:"#66CC99","fill-opacity":0,"stroke-opacity":0,d:"M "+_s.s.powerful.x+" "+_s.s.powerful.y+" L "+_s.s.versatile.x+" "+_s.s.versatile.y+" L "+_s.s.adaptable.x+" "+_s.s.adaptable.y+" L "+_s.s.precise.x+" "+_s.s.precise.y+" L "+_s.s.powerful.x+" "+_s.s.powerful.y})}if(Object.keys(scope.data).length){jQuery(element[0]).find("svg").remove();var graphId,d3GraphWrap,d3Graph,initChart=null,multplier=.1428571;initChart=$timeout(function(){generateD3Chart(scope.data)},0)}scope.$watch("data",function(newValue,oldValue){jQuery(element[0]).find("svg").length&&(jQuery(element[0]).find("svg").remove(),initChart=$timeout(function(){generateD3Chart(scope.data)},150))})}}}angular.module("spApp").directive("personalityInfoGraph",personalityInfoGraph),personalityInfoGraph.$inject=["$rootScope","$timeout"];
function piechartInfoGraph($rootScope,$timeout){return{restrict:"A",scope:{data:"=pieKeys"},link:function(scope,element,attrs){function byLabelsAsc(a,b){return a[0]<b[0]?-1:a[0]>b[0]?1:0}function customLabelOrder(c,p){var customOrder=[];return customOrder.push(c[2]),customOrder.push(c[4]),customOrder.push(c[0]),customOrder.push(c[1]),customOrder.push(c[3]),customOrder}function generatePieLabels(pdfCheck){var html="",isPDF=pdfCheck;return jQuery.each(pieLabelsCollection,function(i){html+="conflictManagement"===pieName&&2===i?'<span class="split-labels"></span><span class="pie-legend-'+i+'"><span class="lColor"></span><span class="lText">'+pieLabelsCollection[i][0]+(isPDF?" ("+pieLabelsCollection[i][1]+"%)":"")+"</span></span>":"fundamentalNeeds"===pieName&&1===i?'<span class="split-labels"></span><span class="pie-legend-'+i+'"><span class="lColor"></span><span class="lText">'+pieLabelsCollection[i][0]+(isPDF?" ("+pieLabelsCollection[i][1]+"%)":"")+"</span></span>":'<span class="pie-legend-'+i+'"><span class="lColor"></span><span class="lText">'+pieLabelsCollection[i][0]+(isPDF?" ("+pieLabelsCollection[i][1]+"%)":"")+"</span></span>"}),'<p class="pieChartLegends '+pieName+'">'+html+"</p>"}function generatePieWithD3(pdfCheck){var d3GraphWrap,d3Chart,labelsHTML,_outerRadius,_arc,_pie,_pieSlices,defaultOptions,responsiveOptions,pdfOptions,_options,_pieColors=d3.scale.ordinal().range(pieColorSets[pieName]);defaultOptions={viewBox:"0 0 "+jQuery(element[0]).width()+" "+(jQuery(element[0]).height()+25),t1:2.2,t2:1.2,r:105,w:"100%",h:isIE?parseInt(jQuery(element[0]).height()+25):"100%"},responsiveOptions={viewBox:"0 0 285 285",t1:1.2,t2:1.2,r:110,w:285,h:285},pdfOptions={viewBox:"0 0 165 165",t1:1,t2:1,r:70,w:165,h:165},jQuery(window).width()<1024?(_options=responsiveOptions,_outerRadius=responsiveOptions.r):(_options=defaultOptions,_outerRadius=defaultOptions.r),pdfCheck&&(_options=pdfOptions,_outerRadius=pdfOptions.r),d3GraphWrap=d3.select(pieId),d3Chart=d3GraphWrap.append("svg:svg").attr({width:_options.w,height:_options.h,viewBox:_options.viewBox,perserveAspectRatio:"none"}).data([pieLabelsCollection]).append("svg:g").attr("transform","translate("+_options.t1*_outerRadius+","+(_options.t2*_outerRadius+25)+")"),_arc=d3.svg.arc().outerRadius(_outerRadius),_pie=d3.layout.pie().value(function(d){return d[1]}).sort(function(d){return null}),_pieSlices=d3Chart.selectAll("g.sp-pie-slice").data(_pie).enter().append("svg:g").attr("class","sp-pie-slice"),_pieSlices.append("svg:path").attr({fill:function(d,i){return _pieColors(i)},d:_arc,"class":function(d,i){return"d3-arc-"+pieLabelsCollection[i][0]}}),_pieSlices.append("svg:text").attr({"class":function(d,i){return 0===pieLabelsCollection[i][1]?"hide":"outside-labels d3-label-"+pieLabelsCollection[i][0]},transform:function(d){return d.outerRadius=_outerRadius+0,d.innerRadius=_outerRadius+45,"translate("+_arc.centroid(d)+")"},"text-anchor":function(d){return(d.endAngle+d.startAngle)/2>Math.PI?"end":"start"}}).text(function(d,i){return pieLabelsCollection[i][0]}).append("tspan").text(function(d,i){return pieLabelsCollection[i][1]+"%"}).attr({x:function(d){var w=-this.parentNode.getBBox().width+23;return(d.endAngle+d.startAngle)/2>Math.PI?w?w:0:"0"},y:15,"text-anchor":"start"}),_pieSlices.filter(function(d){return d.endAngle-d.startAngle>.2}).append("svg:text").attr({transform:function(d){return d.outerRadius=_outerRadius,d.innerRadius=_outerRadius/2,"translate("+_arc.centroid(d)+")"},"text-anchor":"middle","class":"inside-labels"}).text(function(d){return d.data[1]+"%"}),labelsHTML=generatePieLabels(pdfCheck),jQuery(pieId).append(labelsHTML)}var pieKeys,pieLabels=[],pieLabelsCollection=[];if(Object.keys(scope.data).length){var pieName=jQuery(element[0]).attr("data-piename"),isPdf="undefined"!=typeof jQuery(element[0]).attr("data-pdf")?!0:!1,pieId="#"+jQuery(element[0]).attr("id"),pieColorSets={conflictManagement:["#eb5a2c","#eb7b21","#f59f13","#ffe299","#ffffd1"],fundamentalNeeds:["#ac3caf","#ce75d3","#eeaaf2"],learningStyle:["#b21b6e","#dd66b3"]},initChart=null,isIE=jQuery("html").hasClass("ie")?!0:!1;pieKeys=scope.data,pieLabelsCollection=[],pieLabels=[];for(var keys in pieKeys)pieLabels.push($rootScope.pullInterNationalization("profileKeys."+keys),pieKeys[keys]),pieLabelsCollection.push(pieLabels),pieLabels=[];pieLabelsCollection="conflictManagement"===pieName?customLabelOrder(pieLabelsCollection.sort(byLabelsAsc),"conflictManagement"):pieLabelsCollection.sort(byLabelsAsc),isPdf?scope.$watch(function(){return attrs.dataPdf},function(){$timeout(function(){generatePieWithD3(isPdf)},100)}):initChart=$timeout(function(){generatePieWithD3()},0)}scope.$watch("data",function(newValue,oldValue){jQuery(element[0]).find("svg").length&&(jQuery(element[0]).find("svg").remove(),jQuery(element[0]).find("p.pieChartLegends").remove(),initChart=$timeout(function(){pieKeys=scope.data,pieLabelsCollection=[],pieLabels=[];for(var keys in pieKeys)pieLabels.push($rootScope.pullInterNationalization("profileKeys."+keys),pieKeys[keys]),pieLabelsCollection.push(pieLabels),pieLabels=[];pieLabelsCollection="conflictManagement"===pieName?customLabelOrder(pieLabelsCollection.sort(byLabelsAsc),"conflictManagement"):pieLabelsCollection.sort(byLabelsAsc),isPdf?generatePieWithD3(isPdf):generatePieWithD3()},150))})}}}angular.module("spApp").directive("piechartInfoGraph",piechartInfoGraph),piechartInfoGraph.$inject=["$rootScope","$timeout"];
function profilePicUploader($http,ajaxService,$rootScope,$timeout,ngDialog,$localStorage){return{restrict:"A",link:function($scope,$element,$attrs){jQuery($element[0]).find(".select-image-btn").on("click",function(e){e.preventDefault();var fileInput=jQuery($element[0]).find("form.pic-uploader").find("input:file");if(fileInput.click(),$scope.enableBtns=!0,$scope.$apply(),jQuery("html").hasClass("ie10")&&$scope.prevImage===jQuery($element[0]).find(".image-editor").cropit("imageSrc")&&$scope.resetFlag===!0){jQuery($element[0]).find(".cropit-image-background").removeAttr("src"),jQuery($element[0]).find(".cropit-image-preview").removeClass("cropit-image-loaded");var img=jQuery($element[0]).find(".image-editor").cropit("imageSrc");jQuery($element[0]).find(".cropit-image-background").attr("src",img),jQuery($element[0]).find(".cropit-image-background-container").css({"background-image":'url("'+img+'")'}),jQuery($element[0]).find(".cropit-image-preview").css({"background-image":'url("'+img+'")'}).addClass("cropit-image-loaded"),$scope.prevImage="",$scope.resetFlag=!1}}),setTimeout(function(){jQuery($element[0]).find(".image-editor").cropit({imageBackground:!0,previewSize:{width:170,height:170},exportZoom:.51,originalSize:!1})},500),jQuery($element[0]).find(".reset-image").on("click",function(e){if(e.preventDefault(),$scope.enableBtns===!0){$scope.enableBtns=!1,$scope.$apply();var fileInput=jQuery($element[0]).find("form.pic-uploader").find("input:file");fileInput.val(""),jQuery($element[0]).find(".avatar-upload div").each(function(){jQuery(this).css("background-image","none")}),$scope.resetFlag=!0,$scope.prevImage=jQuery($element[0]).find(".image-editor").cropit("imageSrc"),jQuery($element[0]).find(".cropit-image-background").attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7")}}),jQuery($element[0]).find(".process-pic").on("click",function(e){e.preventDefault();var hasBGImage="none"!==jQuery($element[0]).find(".cropit-image-preview").css("background-image");if(!hasBGImage)return $scope.enableBtns=!1,!1;if($scope.enableBtns===!0){$scope.enableBtns=!1,$scope.$apply(),$scope.imageData=jQuery($element[0]).find(".image-editor").cropit("export",{type:"image/jpeg",quality:.99,exportZoom:.5});var options={url:"company"===$scope.imageType?"/sp/admin/company/uploadImage":"/sp/uploadImage",data:$.param({image:$scope.imageData})};ajaxService.getAjaxResponse(options).then(function(response){"true"===response.Success?(ngDialog.close("ngdialog1"),$.growl({icon:"glyphicon glyphicon-ok",message:" Image updated Successfully"}),$timeout(function(){$localStorage.remove("loggegdInProfile"),window.location.reload()},1e3)):$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:"Image upload failed."})})}})}}}angular.module("spApp").directive("profilePicUploader",profilePicUploader),profilePicUploader.$inject=["$http","ajaxService","$rootScope","$timeout","ngDialog","$localStorage"];
function profileTags($http,ajaxService){return{restrict:"A",link:function($scope,$element,$attrs){function addtoTagList(t){var _params={userEmail:$scope.updatedEmail,tagName:t,op:"SET"};ajaxService.getAjaxResponse({url:"/sp/admin/user/tag",data:$.param(_params)}).then(function(response){})}function removeFromTagList(t){var _params={userEmail:$scope.updatedEmail,tagName:t,op:"REMOVE"};ajaxService.getAjaxResponse({url:"/sp/admin/user/tag",data:$.param(_params)}).then(function(response){})}jQuery($element[0]).tagsInput({width:"100%",height:"100%",defaultText:jQuery($element[0]).attr("data-ph"),onAddTag:function(tag){addtoTagList(tag)},onRemoveTag:function(tag){removeFromTagList(tag)}}),setTimeout(function(){jQuery($element[0]).importTags(jQuery($element[0]).attr("data-existing"))},800)}}}angular.module("spApp").directive("profileTags",profileTags),profileTags.$inject=["$http","ajaxService"];
function toggleSection(){return{restrict:"A",link:function($scope,$element,$attrs){jQuery($element[0]).on("click",function(e){e.preventDefault();var activeTab,secInfo=jQuery(this).attr("data-rel"),secCont=jQuery("body").find("div[data-section="+secInfo+"]");$.each(jQuery("body").find(".btn-wrap a.toggle-btn"),function(){jQuery(this).hasClass("on")&&(activeTab=jQuery(this).attr("data-rel"))}),$.each(jQuery("body").find("div[data-section]"),function(){jQuery(this).removeClass("toggleShow").addClass("toggleHide")}),$.each(jQuery("body").find(".btn-wrap a.toggle-btn"),function(){jQuery(this).removeClass("on")}),secInfo!==activeTab?(secCont.removeClass("toggleHide").addClass("toggleShow"),jQuery(this).addClass("on"),jQuery("html,body").animate({scrollTop:jQuery(secCont).offset().top-40},300)):(secCont.removeClass("toggleShow").addClass("toggleHide"),jQuery(this).removeClass("on"))})}}}angular.module("spApp").directive("toggleSection",toggleSection);
function rangeSlider(){return{restrict:"A",priority:10,link:function($scope,$element,$attrs){var $r=jQuery('input[type="range"]');$r.rangeslider({polyfill:!1,onSlideEnd:function(position,value){$scope.$apply(function(){$scope.competencyRangeSlider=value})}})}}}angular.module("spApp").directive("rangeSlider",rangeSlider);
function tagTypeInput($http,$rootScope,ajaxService){return{restrict:"A",link:function($scope,$element,$attrs){function validateUpdateEmails(tagContainer){var _t=jQuery(tagContainer).find(".tagsinput"),_tInput=jQuery(tagContainer).find("input.storeTagsHere").attr("ng-model").split("."),emailPattern=/^[a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,4}$/i;jQuery(tagContainer).hasClass("emailTags")?(emailInputs=[],$scope.emailPatternError=!1,$scope.addMemberEmailCount=0,$scope.emailCountError=!1,$scope.addMemberStatus.existingEmailError=!1,$scope.addMemberStatus.requiredError=!1,$scope.addMemberStatus.inValidEmailError=!1,$scope.$apply(),jQuery.each(jQuery(_t).find("span.tag"),function(i,j){var formattedEmail=jQuery(this).find("span").html().replace(/&nbsp;/g," ").trim();jQuery(this).find("span").attr("data-email",formattedEmail),emailPattern.test(formattedEmail)?(ajaxService.getAjaxResponse({url:"/sp/signup/validateEmails",data:$.param({memberList:formattedEmail}).replace(/%2C/g,",").replace(/%40/g,"@")}).then(function(response){"true"===response.Success&&response.failureList.length>0&&($scope.addMemberStatus.existingEmailError=!0,jQuery(j).addClass("error-email"))}),emailInputs.push(formattedEmail)):($scope.emailPatternError=!0,jQuery(j).addClass("error-email"),$scope.addMemberStatus.inValidEmailError=!0)}),$scope.addMemberEmailCount=emailInputs.length,$scope[_tInput[0]][_tInput[1]]=emailInputs.join(),$scope.$apply()):(textTags=[],$scope[_tInput[0]][_tInput[1]]=null,$scope.$apply(),jQuery.each(jQuery(_t).find("span.tag"),function(i,j){var formatTags=jQuery(this).find("span").html().replace(/&nbsp;/g," ").trim();textTags.push(formatTags)}),$scope[_tInput[0]][_tInput[1]]=textTags.join(),$scope.$apply())}var emailInputs=[],textTags=[];$rootScope.inviteReady===!0&&jQuery($element[0]).tagsInput({width:"100%",height:"100%",getTabIndex:"undefined"!=typeof jQuery($element[0]).attr("data-tab")?jQuery($element[0]).attr("data-tab"):"",defaultText:$rootScope.pullInterNationalization(jQuery($element[0]).attr("data-ph")),onAddTag:function(tag){var tags=tag.split(",");return tags.length>1?($(this).removeTag(tag),!1):void validateUpdateEmails(jQuery($element[0]).parent())},onRemoveTag:function(){validateUpdateEmails(jQuery($element[0]).parent())}})}}}angular.module("spApp").directive("tagTypeInput",tagTypeInput),tagTypeInput.$inject=["$http","$rootScope","ajaxService"];
function wolLinks($http,ajaxService,$rootScope,$timeout,ngDialog){return{restrict:"A",link:function($scope,$element,$attrs){$scope.redirectToPage=function(l){window.open(l),$timeout(function(){ngDialog.close("ngdialog1")},200)},jQuery($element[0]).on("click","a",function(e){e.preventDefault(),$scope.link=jQuery(this).attr("href"),ngDialog.open({template:"/sp/resources/html/curriculum/wol.html",scope:$scope})})}}}angular.module("spApp").directive("wolLinks",wolLinks),wolLinks.$inject=["$http","ajaxService","$rootScope","$timeout","ngDialog"];
function routerBlueConfig($stateProvider){$stateProvider.state("create",{url:"/create",templateUrl:"/sp/resources/html/blueprint/create.html",controllerAs:"vm"}).state("createAdmin",{url:"/create",templateUrl:"/sp/resources/html/blueprint/createAdmin.html",controllerAs:"vm"}).state("approvalRequest",{url:"/approvalRequest",templateUrl:"/sp/resources/html/blueprint/approvalRequest.html",controllerAs:"vm"}).state("publish",{url:"/publish",templateUrl:"/sp/resources/html/blueprint/publish.html",controllerAs:"vm"})}angular.module("spApp").config(routerBlueConfig),routerBlueConfig.$inject=["$stateProvider"];
function routerConfig($stateProvider){$stateProvider.state("practice",{url:"/practice",templateUrl:"/sp/resources/html/goals/practice.html",controllerAs:"vm"}).state("addNote",{url:"/addnote",templateUrl:"/sp/resources/html/goals/addNote.html",controllerAs:"vm"}).state("requestFeedback",{url:"/requestFeedback",templateUrl:"/sp/resources/html/goals/requestFeedback.html",controllerAs:"vm"}).state("completedArticle",{url:"/completedArticle",templateUrl:"/sp/resources/html/goals/completedArticle.html",controllerAs:"vm"}).state("notesAndFeedback",{url:"/notesAndFeedback",templateUrl:"/sp/resources/html/goals/notesFeedbackOverlay.html",controllerAs:"vm"}).state("manageArticle",{url:"/manageArticle",templateUrl:"/sp/resources/html/goals/manageStratagies.html",controllerAs:"vm"}).state("selectActionPlan",{url:"/selectActionPlan",templateUrl:"/sp/resources/html/goals/orgLanding.html",controllerAs:"vm"}).state("organization",{url:"/organization",templateUrl:"/sp/resources/html/goals/organization.html",controllerAs:"vm"}).state("admin",{views:{create:{templateUrl:"/sp/resources/html/sysAdmin/organization/admin-create.html",controllerAs:"vm"},edit:{templateUrl:"/sp/resources/html/sysAdmin/organization/admin-edit.html",controllerAs:"vm"},preview:{templateUrl:"/sp/resources/html/sysAdmin/organization/admin-preview.html",controllerAs:"vm"}}}).state("visual",{views:{"personality-balance":{templateUrl:"/sp/resources/html/spectrum/personality-balance.html",controllerAs:"vm"},"personality-balance-filter":{templateUrl:"/sp/resources/html/spectrum/personality-balance-filter.html",controllerAs:"vm"},"blueprint-analytics-filter":{templateUrl:"/sp/resources/html/spectrum/blueprint-analytics-filter.html",controllerAs:"vm"},"blueprint-analytics":{templateUrl:"/sp/resources/html/spectrum/blueprint-analytics.html",controllerAs:"vm"},"ert-insights-filter":{templateUrl:"/sp/resources/html/spectrum/ert-insights-filter.html",controllerAs:"vm"},"ert-insights":{templateUrl:"/sp/resources/html/spectrum/ert-insights.html",controllerAs:"vm"},"org-plan":{templateUrl:"/sp/resources/html/spectrum/org-plan.html",controllerAs:"vm"},"org-plan-filter":{templateUrl:"/sp/resources/html/spectrum/org-plan-filter.html",controllerAs:"vm"},"ert-analytics-filter":{templateUrl:"/sp/resources/html/spectrum/ert-analytics-filter.html",controllerAs:"vm"},"ert-analytics":{templateUrl:"/sp/resources/html/spectrum/ert-analytics.html",controllerAs:"vm"},"competency-filter":{templateUrl:"/sp/resources/html/spectrum/competency-filter.html",controllerAs:"vm"},competency:{templateUrl:"/sp/resources/html/spectrum/competency.html",controllerAs:"vm"}}}).state("competencyView",{views:{create:{templateUrl:"/sp/resources/html/sysAdmin/competency/create.html",controllerAs:"vm"},edit:{templateUrl:"/sp/resources/html/sysAdmin/competency/update.html",controllerAs:"vm"},preview:{templateUrl:"/sp/resources/html/sysAdmin/competency/preview.html",controllerAs:"vm"}}}).state("addNoteCompetency",{url:"/addnote",templateUrl:"/sp/resources/html/competency/addNote.html",controllerAs:"vm"}).state("profiles",{url:"/profiles",templateUrl:"/sp/resources/html/competency/competency-details.html",controllerAs:"vm"})}angular.module("spApp").config(routerConfig),routerConfig.$inject=["$stateProvider"];
function ajaxService($http,$q,$rootScope,$filter,$localStorage,$timeout){function startRequest(delay,maximum){requestCount||(startTimeout=setTimeout(function(){$rootScope.$broadcast("httpLoaderStart"),endTimeout=setTimeout(function(){requestCount&&(requestCount=0,$rootScope.$broadcast("httpLoaderEnd"))},maximum)},delay)),requestCount++}function endRequest(){requestCount&&(requestCount--,requestCount||(clearTimeout(startTimeout),clearTimeout(endTimeout),$rootScope.$broadcast("httpLoaderEnd")))}function getAjaxResponse(options){if("undefined"==typeof options)return void console.log("Please Provide Options to Perform Ajax Request");var delay="undefined"!=typeof options.delay?options.delay:500,maximum="undefined"!=typeof options.maximum?options.maximum:5e3;startRequest(delay,maximum);var request=$http({method:"undefined"!=typeof options.method?options.method:"post",url:"undefined"!=typeof options.url?options.url:"#",data:"undefined"!=typeof options.data?options.data:"",param:"undefined"!=typeof options.param?options.param:"",headers:"undefined"!=typeof options.headers?options.headers:{"Content-Type":"application/x-www-form-urlencoded"}});return request.then(handleSuccess,handleError)}function handleError(response){return endRequest(),angular.isObject(response.success)&&response.success?$q.reject(response.data.error):$q.reject("An unknown error occurred.")}function handleSuccess(response){if(endRequest(),null!==response.data&&void 0!==response.data){if(null!==response.data.success&&void 0!==response.data.success)return void 0!==response.data.success.Actions&&updateLocalStorage(response.data.success.Actions),response.data.success;if(null!==response.data.error&&void 0!==response.data.error){if(void 0===response.data.error.DashboardRedirectException)return void 0!==response.data.error.Actions&&updateLocalStorage(response.data.error.Actions),response.data;$timeout(function(){window.location.href="/sp/"},1500)}}return response.data}function updateLocalStorage(Action){void 0!==Action.UpdateNavigation&&($localStorage.set("globalNav",Action.UpdateNavigation),$localStorage.remove("navHtml")),void 0!==Action.UpdatePermission&&$localStorage.set("loggegdInProfile",Action.UpdatePermission),void 0!==Action.UpdateParams&&Action.UpdateParams.doLogout&&(window.location.href="/sp/logout")}var requestCount=0,startTimeout=0,endTimeout=0;return{getAjaxResponse:getAjaxResponse,startRequest:startRequest,endRequest:endRequest}}function sharedProperties($rootScope,ngDialog,ajaxService,$localStorage,$timeout){var email=[],objectValue={},resetEmail="",getArray=[],videoUrl=null;return{getEmail:function(){return email},setEmail:function(value){email=value},setObject:function(obj){objectValue=angular.copy(obj)},getObject:function(){return objectValue},setResetEmail:function(val){resetEmail=val},getResetEmail:function(){return resetEmail},getArrayResult:function(parent,keytosearch,full){getArray=[];for(var key=keytosearch,i=0;i<parent.length;i++)key in parent[i]&&null!==parent[i][key]&&(full?getArray.push(parent[i]):getArray.push(parent[i][key]));return getArray},getStringValue:function(parent,key,search,toreturn){angular.forEach(parent,function(val,index){return key in val&&val[key]===search?toreturn?val.toreturn:val:void 0})},spliceIndex:function(parent,searchkey,parentkey){return angular.forEach(parent,function(value,index){value[searchkey]===parentkey&&parent.splice(index,1)}),parent},spilceIndexWithBreak:function(parent,searchkey,parentkey){for(var i=0;i<parent.length;i++)if(parent[i][searchkey]===parentkey){parent.splice(i,1);break}return parent},toggleFilterClick:function(event,currentPredicate){var currentElem=$(event.currentTarget);currentPredicate=currentElem.data("predicate"),currentElem.find("h4").hasClass("on")?currentElem.find("h4").hasClass("reverseon")?currentElem.find("h4").removeClass("reverseon"):currentElem.find("h4").addClass("reverseon"):(currentElem.parent().find(".tog h4").removeClass("on"),currentElem.find("h4").addClass("on"))},searchModule:function(textVar,parent,num,key){if(textVar.length>=num){for(var copyArray=[],i=0;i<parent.length;i++)"undefined"==typeof key?""===angular.lowercase(parent[i].name)||null===angular.lowercase(parent[i].name)?angular.lowercase(parent[i].email).indexOf(angular.lowercase(textVar))>-1&&copyArray.push(parent[i]):(angular.lowercase(parent[i].email).indexOf(angular.lowercase(textVar))>-1||angular.lowercase(parent[i].name).indexOf(angular.lowercase(textVar))>-1)&&copyArray.push(parent[i]):""===angular.lowercase(parent[i][key].name)||null===angular.lowercase(parent[i][key].name)?angular.lowercase(parent[i][key].email).indexOf(angular.lowercase(textVar))>-1&&copyArray.push(parent[i]):(angular.lowercase(parent[i][key].email).indexOf(angular.lowercase(textVar))>-1||angular.lowercase(parent[i][key].name).indexOf(angular.lowercase(textVar))>-1)&&copyArray.push(parent[i]);return copyArray}return parent},singleElementSearch:function(textVar,parent,num){if(!(textVar.length>=num))return parent;if("undefined"==typeof key)if(""===angular.lowercase(parent.name)||null===angular.lowercase(parent.name)){if(angular.lowercase(parent.email).indexOf(angular.lowercase(textVar))>-1)return parent}else if(angular.lowercase(parent.email).indexOf(angular.lowercase(textVar))>-1||angular.lowercase(parent.name).indexOf(angular.lowercase(textVar))>-1)return parent},searchModuleName:function(textVar,parent,num,change,key){var type="undefined"==typeof change?"email":change;if(textVar.length>=num){for(var copyArray=[],i=0;i<parent.length;i++)"undefined"==typeof key?""===angular.lowercase(parent[i].name)||null===angular.lowercase(parent[i].name)?angular.lowercase(parent[i][type]).indexOf(angular.lowercase(textVar))>-1&&copyArray.push(parent[i]):(angular.lowercase(parent[i][type]).indexOf(angular.lowercase(textVar))>-1||angular.lowercase(parent[i].name).indexOf(angular.lowercase(textVar))>-1)&&copyArray.push(parent[i]):""===angular.lowercase(parent[i][key].name)||null===angular.lowercase(parent[i][key].name)?angular.lowercase(parent[i][key][type]).indexOf(angular.lowercase(textVar))>-1&&copyArray.push(parent[i]):(angular.lowercase(parent[i][key][type]).indexOf(angular.lowercase(textVar))>-1||angular.lowercase(parent[i][key].name).indexOf(angular.lowercase(textVar))>-1)&&copyArray.push(parent[i]);return copyArray}return parent},getParam:function(param){var url=location.href,regexS="[\\?&]"+param+"=([^&#]*)",regex=new RegExp(regexS),results=regex.exec(url);return null==results?null:results[1]},setSwitch:function(param){$rootScope.switchType=param},notification:function(args,userTypeName,disabledName,extra){if($rootScope.notificationList=args,$rootScope.extra=null,"undefined"==typeof userTypeName?$rootScope.userTypeName="GenericMessage":$rootScope.userTypeName=userTypeName,"undefined"==typeof disabledName)$rootScope.disabledName=null,$rootScope.selectedNotification="default";else{if($rootScope.disabledName=disabledName,$rootScope.selectedNotification=disabledName,"ProfileIncomplete"!==disabledName){var comment=$.parseHTML($rootScope.pullInterNationalization("admin.group."+disabledName+".notification.text").replace("$companyName",$localStorage.get("loggegdInProfile").company.name))[0];$rootScope.commentNotification=$(comment).text()}var subBlock=$.parseHTML($rootScope.pullInterNationalization("admin.group."+disabledName+".notification.nosubject"))[0];subBlock==="admin.group."+disabledName+".notification.nosubject"?$rootScope.subBlockNotification="":$rootScope.subBlockNotification=$(subBlock).text()}$rootScope.notify=["Profile","Goals","Prism"],angular.isObject(extra)&&($rootScope.extra=extra),ngDialog.open({template:"/sp/notification/email"})},printPdfProfile:function(options){var $getCont=$(options.holder),cssToApply="undefined"==typeof options.cssName?"global.min.css":options.cssName,parObj=options.obj;if(!$getCont.length)return!0;var printContents=$getCont.html(),data={content:encodeURIComponent('<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><script src="//use.typekit.net/ofk8xcu.js"></script><script> try {Typekit.load();} catch (e) {}</script><link type="text/css" rel="stylesheet" href="/sp/resources/css/css-min/bootstrap.min.css"><link type="text/css" rel="stylesheet" href="/sp/resources/css/css-min/'+cssToApply+'"></head><body>'+printContents+"</body></html>")};data.pdfName=options.extraParam,ajaxService.getAjaxResponse({url:options.url,data:$.param(data)}).then(function(response){if("true"===response.Success)$rootScope.$broadcast("pdfGenerated",{obj:parObj,url:response.url});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage}),$rootScope.$broadcast("pdfGenerated",parObj),ngDialog.close("ngdialog1")}})},openMediaModal:function(){$rootScope.mediaView="select";var sourceSelect=ngDialog.open({template:"/sp/resources/html/sysAdmin/media/select-modal.html"});sourceSelect.closePromise.then(function(data){$rootScope.$broadcast("mediaData",$localStorage.get("mediaData")),$localStorage.remove("mediaData")})},videoPopUp:function(url,openId){if(/youtu\.be/.test(url)){var youtubeId=url.split("/");videoUrl="https://www.youtube.com/watch?v="+youtubeId[youtubeId.length-1]}else videoUrl=url;ngDialog.open({template:"/sp/resources/html/common/videoPopUp.html"});$rootScope.$on("ngDialog.opened",function(e,$dialog){$("#mp4_src").attr("src",videoUrl)})},getVideoUrl:function(){return videoUrl},fireAnalyticsEvent:function(name,value){var googleDataLayer="dataLayer";"undefined"!=typeof window[googleDataLayer]&&window[googleDataLayer].push({event:"spAppAnalytics",attributes:{spAction:name,spActionValue:value}})}}}function $localStorage($window){var localStorageOn=!1,$privateMode={};if("localStorage"in window)try{$window.localStorage.setItem("_tmptest","tmpval"),localStorageOn=!0,$window.localStorage.removeItem("_tmptest")}catch(error){localStorageOn=!1}return{isAvailable:function(){return localStorageOn},executeMethod:function(fnSuccess,fnFail){return localStorageOn?fnSuccess&&fnSuccess():fnFail&&fnFail()},remove:function(){if(localStorageOn)for(var j=0;j<arguments.length;j++)$window.localStorage.removeItem(arguments[j]);else for(var i=0;i<arguments.length;i++)arguments[i]in $privateMode&&($privateMode.arguments[i]=null)},flush:function(){localStorageOn?$window.localStorage.clear():$privateMode={}},get:function(key){return localStorageOn?$privateMode=JSON.parse($window.localStorage[key]||null):$privateMode[key]||null},set:function(key,value,callback){if(localStorageOn){if(void 0===value)return $localStorage.remove(key);$window.localStorage[key]=JSON.stringify(value)}else $privateMode[key]=value;return"function"==typeof callback&&callback&&callback(),this}}}function notesAndFeedbackMethod(ajaxService,$rootScope,ngDialog,$state,sharedProperties){function addNote(options,vm){vm.postANote.submitted=!1,vm.postANoteForm.$valid?ajaxService.getAjaxResponse({url:serviceUrl.addNote,data:$.param({goalId:options.goalId,devStrategyId:options.devStrategyId,content:options.contents})}).then(function(response){if("true"===response.Success)vm.feedRequired=!0,vm.state(),vm.noteTextArea="",vm.feedRequired=!0,ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("practiceArea.notePostedSuccesfully")}),"individual"===vm.pageType?sharedProperties.fireAnalyticsEvent("ERT-i | Note Posted",vm.currentActive.name):"organization"===vm.pageType?sharedProperties.fireAnalyticsEvent("Org Plans | Note Posted","ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name):"blueprint"===vm.pageType&&sharedProperties.fireAnalyticsEvent("Blueprint | Note Posted","N/A");else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}}):vm.postANote.submitted=!0}function getNotesFeedbackForGoal(options,vm){ajaxService.getAjaxResponse({url:serviceUrl.getNotesFeedbackForGoal+options.goalId+"&memberEmail="+$rootScope.noSelf,method:"get"}).then(function(response){if("true"===response.Success){var temp={};vm.viewDetailsList=null,vm.feedRequired=!1,vm.masterAllNotesFeedbackData={};for(var i=0;i<response.notesAndFeedbackList.length;i++)response.notesAndFeedbackList[i].type in temp?temp[response.notesAndFeedbackList[i].type].push(response.notesAndFeedbackList[i]):(temp[response.notesAndFeedbackList[i].type]=[],temp[response.notesAndFeedbackList[i].type].push(response.notesAndFeedbackList[i]));Object.keys(temp).sort().reverse().forEach(function(key){vm.masterAllNotesFeedbackData[key]=temp[key]}),vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.allNotesFeedbackLength=Object.keys(vm.masterAllNotesFeedbackData),vm.selectedGroup=Object.keys(vm.allNotesFeedbackData)[0],vm.allNotesFeedbackLength.length&&vm.viewDetails(void 0===options.indexName?vm.selectedGroup:options.indexName),void 0!==options.mode&&(sortList(vm),vm.winWidth>767&&$state.go(options.mode))}else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function sortList(vm){""!==vm.devStrategy.id&&null!==vm.viewDetailsList&&Object.keys(vm.allNotesFeedbackData).length?vm.filteredViewDetailsList=vm.viewDetailsList.filter(function(e){return null!==e.devStrategy&&e.devStrategy.id===vm.devStrategy.id}):vm.filteredViewDetailsList=angular.copy(vm.viewDetailsList)}function requestFeedback(options,vm){return vm.requestFeedback.submitted=!1,vm.inputRequired=!1,!vm.requestFeedbackForm.$valid&&(vm.requestFeedback.submitted=!0),!options.email.length&&(vm.inputRequired=!0),vm.requestFeedback.submitted||vm.inputRequired?!0:void ajaxService.getAjaxResponse({url:serviceUrl.requestFeedback,data:$.param({goalId:options.goalId,devStrategyId:options.devStrategyId,content:options.contents,feedbackUserEmail:options.email.toString()})}).then(function(response){if("true"===response.Success)vm.state(),vm.feedRequired=!0,ngDialog.close(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("practiceArea.feedbackrequested")}),"individual"===vm.pageType?sharedProperties.fireAnalyticsEvent("ERT-i | Save Request Feedback",vm.currentActive.name):"organization"===vm.pageType?sharedProperties.fireAnalyticsEvent("Org Plans | Save Request Feedback","ActionPlan - "+vm.actionPlan.name+",Step Name - "+vm.currentActive.name):"blueprint"===vm.pageType&&sharedProperties.fireAnalyticsEvent("Blueprint | Save Request Feedback","N/A");else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function updateNote(options,vm){vm.updateNoteForm.$valid?ajaxService.getAjaxResponse({url:serviceUrl.updateNote,data:$.param({noteId:options.noteId,desc:options.desc})}).then(function(response){if("true"===response.Success)vm.feedRequired=!0,$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("practiceArea.noteUpdatedSuccesfully")});else if(null!==response.error){vm.viewDetailsList.content=vm.tempModel;var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}}):vm.updateNoteObj.submitted=!0}function deleteNote(options,vm){ajaxService.getAjaxResponse({url:serviceUrl.deleteNote,data:$.param({noteId:options.noteId})}).then(function(response){if("true"===response.Success)sharedProperties.spilceIndexWithBreak(vm.masterAllNotesFeedbackData[vm.viewDetailsListIndex],"id",options.noteId),!vm.masterAllNotesFeedbackData[vm.viewDetailsListIndex].length&&delete vm.masterAllNotesFeedbackData[vm.viewDetailsListIndex],vm.viewDetailsListIndex=Object.keys(vm.masterAllNotesFeedbackData).length?Object.keys(vm.masterAllNotesFeedbackData)[0]:null,vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.allNotesFeedbackLength=Object.keys(vm.masterAllNotesFeedbackData),vm.allNotesFeedbackLength.length?vm.viewDetails(vm.viewDetailsListIndex):vm.viewDetailsList=null,$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("practiceArea.deleteNoteSuccessfull")});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function deleteAll(vm){ajaxService.getAjaxResponse({url:serviceUrl.deleteAll,data:$.param({goalId:vm.currentActive.goalId,deleteNote:"NOTE"===vm.viewDetailsListIndex,deleteFeedback:"FEEDBACK"===vm.viewDetailsListIndex})}).then(function(response){if("true"===response.Success)delete vm.masterAllNotesFeedbackData[vm.viewDetailsListIndex],vm.viewDetailsListIndex=Object.keys(vm.masterAllNotesFeedbackData).length?Object.keys(vm.masterAllNotesFeedbackData)[0]:null,vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.allNotesFeedbackLength=Object.keys(vm.masterAllNotesFeedbackData),vm.allNotesFeedbackLength.length?vm.viewDetails(vm.viewDetailsListIndex):vm.viewDetailsList=null,ngDialog.closeAll(),$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("notesAndFeedback.ajaxSuccessMessage.recordDeleted")});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}function deleteFeedback(options,vm){ajaxService.getAjaxResponse({url:serviceUrl.deleteFeedback,data:$.param({feedbackId:options.noteId})}).then(function(response){if("true"===response.Success)sharedProperties.spilceIndexWithBreak(vm.masterAllNotesFeedbackData[vm.viewDetailsListIndex],"id",options.noteId),!vm.masterAllNotesFeedbackData[vm.viewDetailsListIndex].length&&delete vm.masterAllNotesFeedbackData[vm.viewDetailsListIndex],vm.viewDetailsListIndex=Object.keys(vm.masterAllNotesFeedbackData).length?Object.keys(vm.masterAllNotesFeedbackData)[0]:null,vm.allNotesFeedbackData=angular.copy(vm.masterAllNotesFeedbackData),vm.allNotesFeedbackLength=Object.keys(vm.masterAllNotesFeedbackData),vm.allNotesFeedbackLength.length?vm.viewDetails(vm.viewDetailsListIndex):vm.viewDetailsList=null,$.growl({icon:"glyphicon glyphicon-ok",message:$rootScope.pullInterNationalization("practiceArea.deleteFeedbackSuccessfull")});else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}var serviceUrl={requestFeedback:"/sp/goals/feedback/request",addNote:"/sp/goals/note/add",getNotesFeedbackForGoal:"/sp/goals/notesfeedback?goalId=",updateNote:"/sp/goals/note/update",deleteNote:"/sp/goals/note/delete",deleteFeedback:"/sp/goals/feedback/delete",deleteAll:"/sp/goals/notesFeedback/deleteAll"};return{addNote:addNote,getNotesFeedbackForGoal:getNotesFeedbackForGoal,sortList:sortList,requestFeedback:requestFeedback,updateNote:updateNote,deleteNote:deleteNote,deleteAll:deleteAll,deleteFeedback:deleteFeedback}}angular.module("spApp").config(["$compileProvider",function($compileProvider){$compileProvider.debugInfoEnabled(!1)}]),angular.module("spApp").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$location","$injector",function($location,$injector){return{request:function(config){return config.headers["X-Requested-With"]="XMLHttpRequest",config},requestError:function(rejection){return rejection},response:function(response){return response},responseError:function(rejection){return 408===rejection.status||null===rejection.data&&0===rejection.status?(window.location.reload(),!1):rejection}}}])}]),angular.module("spApp").service("ajaxService",ajaxService),ajaxService.$inject=["$http","$q","$rootScope","$filter","$localStorage","$timeout"],angular.module("spApp").service("sharedProperties",sharedProperties),sharedProperties.$inject=["$rootScope","ngDialog","ajaxService","$localStorage","$timeout"],angular.module("spApp").service("$localStorage",$localStorage),$localStorage.$inject=["$window"];var factories=angular.module("notesAndFeedbackFactory",[]);factories.factory("notesAndFeedbackMethod",notesAndFeedbackMethod),notesAndFeedbackMethod.$inject=["ajaxService","$rootScope","ngDialog","$state","sharedProperties"];
function ProfileDataService(){function savaData(data){serviceData=data}function savaMemberData(data){memberData=data}function savaCandidateData(data){candidateData=data}function retriveData(){return serviceData}function retriveCandidateData(){return candidateData}function retriveMemberData(){return memberData}function clearData(){return serviceData=null}var serviceData,memberData,candidateData;return{save:savaData,saveMember:savaMemberData,saveCandidate:savaCandidateData,retrive:retriveData,retriveMember:retriveMemberData,retriveCandidate:retriveCandidateData,reset:clearData}}angular.module("spApp").factory("ProfileDataService",ProfileDataService);
function userDataService($rootScope){function savaData(data){serviceData=data,$rootScope.profileReady=!0}function retriveData(){return serviceData}var serviceData;return{save:savaData,retrive:retriveData}}angular.module("spApp").factory("userDataService",userDataService),userDataService.$inject=["$rootScope"];
function userIntroSettingsService(ngDialog,ajaxService,$localStorage){function getUserIntroSettings(key,maxCount){var showModal=!1;if(null!==userProfile){var introSettings=userProfile.member.introSettingsMap;(null===introSettings||void 0===introSettings[key]||null===introSettings[key]||null!==introSettings[key]&&void 0!==introSettings[key]&&introSettings[key].count<=maxCount)&&(showModal=!0)}return showModal}function updateUserIntroSettings(flagName,flagValue){ajaxService.getAjaxResponse({url:"/sp/updateIntroSettings",data:$.param({flagName:flagName,flagValue:flagValue})}).then(function(response){if("true"===response.Success)userProfile.member.introSettingsMap=response.introSettingsMap,$localStorage.set("loggegdInProfile",userProfile),ngDialog.close();else if(null!==response.error){var errorMessage="";for(var key in response.error)errorMessage=response.error[key];$.growl({icon:"glyphicon glyphicon-ban-circle",title:"<strong> Alert </strong>",message:errorMessage})}})}var userProfile=$localStorage.get("loggegdInProfile");return{getUserIntroSettings:getUserIntroSettings,updateUserIntroSettings:updateUserIntroSettings}}angular.module("spApp").service("userIntroSettingsService",userIntroSettingsService),userIntroSettingsService.$inject=["ngDialog","ajaxService","$localStorage"];