rspkr.HL=function(){var a="",b={firstRun:0,previousWord:{},previousSent:{},lastWord:null,selectionRange:null,selectionHTML:null,selectedWordsRange:[]},c={oldWordHL:[],oldWordHLClass:[],oldSentHL:[],oldSentHLClass:[],sync:function(d,a){var h=!1,b=document.getElementById("sync"+a);0==(d&2)&&(h=0!=(d&1)?!0:!1);if(b&&b.className.replace("word","")!=b.className){if(!h&&0<this.oldWordHL.length){for(h=0;h<this.oldWordHLClass.length;h++)this.oldWordHL[h].className=this.oldWordHLClass[h];this.oldWordHL=[];
this.oldWordHLClass=[]}this.oldWordHLClass.push(b.className);this.oldWordHL.push(b);rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.wordHL(b,d);b.className=b.className.replace("sync_word","sync_word_highlighted")}else if(b&&b.className.replace("sent","")!=b.className){if(!h&&0<this.oldSentHL.length){for(h=0;h<this.oldSentHL.length;h++)this.oldSentHL[h].className=this.oldSentHLClass[h];this.oldSentHL=[];this.oldSentHLClass=[]}this.oldSentHLClass.push(b.className);this.oldSentHL.push(b);
rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.sentHL(b,d);b.className=b.className.replace("sync_sent","sync_sent_highlighted")}b&&rspkr.HL.Scroll.execScroll(b)},preProcess:{setRestoreContent:function(){rspkr.log("[Servermarkup.preProcess.setRestoreContent] Called!");var d=rspkr.Common.data.getParam("readid"),d=document.getElementById(d).innerHTML;rspkr.Common.data.setRestoreContent(d)}},postProcess:{fullCleanUp:function(){rspkr.log("[Servermarkup.postProcess.fullCleanUp] Called!");
rspkr.HL.Restore.all()},lightCleanUp:function(){rspkr.log("[Servermarkup.postProcess.lightCleanUp] Called!");var d=rspkr.HL.serverMarkup.oldWordHL,a=rspkr.HL.serverMarkup.oldWordHLClass,b=rspkr.HL.serverMarkup.oldSentHL,c=rspkr.HL.serverMarkup.oldSentHLClass;if(0<d.length){for(var f=0;f<d.length;f++)d[f].className=a[f];rspkr.HL.serverMarkup.oldWordHL=[];rspkr.HL.serverMarkup.oldWordHLClass=[]}if(0<b.length){for(f=0;f<b.length;f++)b[f].className=c[f];rspkr.HL.serverMarkup.oldSentHL=[];rspkr.HL.serverMarkup.oldSentHLClass=
[]}f=rspkr.Common.data.browser.syncContainer.replace(/(:|\.|\[|\]|,)/g,"\\$1");d=$rs.get(f+".sync_sent,"+f+".sync_word,"+f+".sync_sent_highlighted,"+f+".sync_word_highlighted,"+f+".sync_user,"+f+".synctemp,"+f+'[class*="ffsent"]');d=$rs.isArray(d)?d:[d];for(f=d.length-1;-1<f;f--)d[f].className=d[f].className.replace("sync_sent_highlighted","sync_sent"),d[f].className=d[f].className.replace("sync_word_highlighted","sync_word"),-1!==d[f].className.toLowerCase().indexOf("sync_user")&&(d[f].className=
d[f].className.replace("sync_sent",""),d[f].className=d[f].className.replace("sync_word",""),d[f].removeAttribute("id"))}}},e=function(){rspkr.log("[rspkr.HL.addEvents]");var d=rspkr.Common.addEvent;d("onUIClosePlayer",rspkr.HL.sync.lightCleanUp);d("onUIClosePlayer",rspkr.HL.cleanUpHandler);d("onUIClosePlayer",function(){rspkr.hl.State.setState(rspkr.hl.State.READY)});d("onUIStop",function(){rspkr.hl.State.setState(rspkr.hl.State.STOPPED)});d("onUIBeforePlay",function(){rspkr.hl.Restore.checkContent()});
rspkr.PlayerAPI&&rspkr.PlayerAPI.adapter&&"html5"===rspkr.PlayerAPI.adapter&&(rspkr.evt("onAPIInitAdapter",rspkr.HL.html5.handlers.init),rspkr.evt("onAPIPlay",rspkr.HL.html5.handlers.play),rspkr.evt("onAPIPause",rspkr.HL.html5.handlers.pause),rspkr.evt("onAPIStop",rspkr.HL.html5.handlers.stop),rspkr.evt("onAPIRewind",rspkr.HL.html5.handlers.updateTime),rspkr.evt("onAPISetProgress",rspkr.HL.html5.handlers.updateTime),rspkr.evt("onAPIReleaseAdapter",rspkr.HL.html5.handlers.release));rspkr.evt("onAPIStop",
rspkr.HL.sync.lightCleanUp)},g={enums:{key:"readspeaker_inline_styles",sent:"sync_sent",sent_hl:"sync_sent_highlighted",word:"sync_word",word_hl:"sync_word_highlighted"},word_index:null,sent_index:null,hlChanged:!1,setHL:function(){var d=rspkr.pub.Config,a=rspkr.Common.Settings.get("hlword")||d.item("settings.hlword"),b=rspkr.Common.Settings.get("hlsent")||d.item("settings.hlsent"),d=rspkr.Common.Settings.get("hltext")||d.item("settings.hltext");this.updateHL("hlword",a,null);this.updateHL("hlsent",
b,null);this.updateHL("hltext",d,null)},updateHL:function(d,l,h){h=h||null;"hlspeed"===d&&l!==h&&(this.hlChanged=!0);l===h||"hl"!==d&&"hltoggle"!==d||(this.hlChanged=!0,rspkr.HL.sync.lightCleanUp());l!==h&&("hl"===d&&"none"!==l||"hltoggle"===d&&"hlon"===l)&&(this.setTextStyle("word",rspkr.Common.Settings.get("hlword")),this.setTextStyle("sent",rspkr.Common.Settings.get("hlsent")),this.setTextStyle("hltext",rspkr.Common.Settings.get("hltext")),this.hlChanged=!0,rspkr.HL.Type.CURRENT===rspkr.HL.Type.CLIENT_MARKUP&&
rspkr.PlayerAPI.releaseAdapter());/hltext|hlword|hlsent|hlscroll/i.test(d)&&l!=h&&("hlscroll"==d?rspkr.HL.Scroll.initScroll():(this.setTextStyle(d,l),"explorer"==a&&(b.selectionRange&&"wordsent"===rspkr.st.get("hl")&&"hlsent"==d&&(b.selectionRange.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),b.selectionRange.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext"))),b.lastWord&&("sent"==rspkr.st.get("hl")?b.lastWord.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")):
b.lastWord.execCommand("backcolor",0,rspkr.Common.Settings.get("hlword")),b.lastWord.execCommand("forecolor",0,rspkr.Common.Settings.get("settings.hltext"))))))},setTextStyle:function(d,a,b){var c=/word/.test(d)?"word":"sent",f="background-color";b=b||g.enums.key;/underline/.test(a)?(f="text-decoration",a+=" !important; background-color: none !important"):/none/.test(a)?(f="background",a+=" !important; text-decoration: none !important; background-color: none !important"):"hltext"===d?(d=a,a=this.getStyleString(rspkr.Common.Settings.get("hlsent"),
d),d=this.getStyleString(rspkr.Common.Settings.get("hlword"),d),rspkr.Common.css.replaceRule(b,"."+g.enums.word_hl,f+": "+d)):a+=" !important; text-decoration: none !important; color: "+rspkr.Common.Settings.get("hltext")+" !important";rspkr.Common.css.replaceRule(b,"."+g.enums[c+"_hl"],f+": "+a)},getStyleString:function(d,a){var b=/underline|none/i.test(d)?"none":d,c=/underline/i.test(d)?"underline":"none";return b+" !important; text-decoration: "+c+" !important; color: "+a+" !important"}};return{meta:{revision:"3715"},
init:function(){var d=rspkr.Common.addEvent;d("onAfterModsLoaded",function(){d("onAPIInitAdapter",rspkr.HL.Restore.setRestoreContent);rspkr.HL.addEvents();rspkr.HL.Scroll.initScroll();a=document.selection&&(9>rspkr.Common.data.browser.version||9>document.documentMode)?"explorer":"gecko";rspkr.log("[rspkr.hl] Using engine "+a);var l=rspkr.HL.engine[a].clientExtension,h;for(h in l)b[h]=l[h];window.addEventListener&&window.addEventListener("message",rspkr.HL.html5.receiveMessage,!1,!0)});d("onModsLoaded",
{func:g.setHL,context:g});d("onSettingsChanged",{func:g.updateHL,context:g});rspkr.HL.chunking={html5support:!!document.createElement("audio").canPlayType,close:function(){var d=$rs.get(".rsresume");$rs.isArray(d)||(d=[d]);for(var a=0,b;b=d[a];a++)b.parentElement.removeChild(b)},silence:function(){rspkr.HL.chunking.entracte&&rspkr.HL.chunking.entracte.src&&(rspkr.HL.chunking.entracte.pause(),rspkr.HL.chunking.entracte.currentTime&&(rspkr.HL.chunking.entracte.currentTime=0))},kill:function(){rspkr.HL.chunking.timer&&
clearTimeout(rspkr.HL.chunking.timer);rspkr.HL.chunking.continueHref=null;rspkr.HL.chunking.stall=null;rspkr.HL.chunking.chunkEnded=null;rspkr.HL.chunking.currentChunkNumber=1;rspkr.HL.chunking.entracte&&rspkr.HL.chunking.entracte.removeAttribute("src")},destroy:function(){rspkr.HL.chunking.silence();rspkr.HL.chunking.close();rspkr.HL.chunking.kill()}};rspkr.HL.chunking.currentChunkNumber=1;d("onChunkResume",function(){rspkr.HL.chunking.silence();var d=rspkr.ui.getActivePlayer().getContainer();if($rs.hasClass(d,
"rsautopaused")||!$rs.hasClass(d,"rspaused"))if(rspkr.HL.chunking.stall)setTimeout(function(){rspkr.c.dispatchEvent("onChunkResume",window)},250);else{$rs.removeClass(d,"rsautopaused");clearTimeout(rspkr.HL.chunking.timer);var d=rspkr.HL.chunking.continueHref.replace("%{AUDIOFORMAT}",rspkr.Common.data.browser.html5AudioFormat),a=rspkr.HL.chunking.continueHref.replace("%{AUDIOFORMAT}","html5iframe");rspkr.HL.chunking.continueHref=void 0;rspkr.HL.html5.audioUrl=d.replace(/&amp;/g,"&");rspkr.HL.html5.frameUrl=
a.replace(/&amp;/g,"&");rspkr.HL.html5.initSyncFrame();rspkr.HL.html5.initAudio();rspkr.ui.getActivePlayer().play();rspkr.HL.chunking.currentChunkNumber++}});rspkr.log("[rspkr.HL] Initialized!")},addEvents:function(){e()},cleanUpHandler:function(d){rspkr.log("[rspkr.HL.cleanUpHandler] String is: "+d);"userclick"===d||"nosel"===d?rspkr.HL.sync.fullCleanUp():rspkr.HL.sync.lightCleanUp()},clientMarkup:b,serverMarkup:c,markedUpHTML:[],html5:{States:{BEGIN:0,STOPPED:1,USER_START_NOT_READY:2,USER_START_PLAYING:3,
NOT_PLAYING:4,CURRENT:0,setState:function(d){this.CURRENT=d;rspkr.log("[rspkr.hl.html5.States.setState] Changing state from "+this.CURRENT+" to "+d,1)}},Events:{canPlay:!1,durationChange:!1,syncReady:!1,eventTimer:null,onCanPlay:function(){rspkr.log("onCanPlay fired!",1);this.canPlay=!0;this.checkCompletion();this.eventTimer=setTimeout(function(){rspkr.log("[rspkr.hl.html5.Events] Timer triggered. Starting playback.",1);rspkr.hl.html5.Events.resetAll();rspkr.hl.html5.refresh()},2500);return!1},checkCompletion:function(){this.canPlay&&
this.durationChange&&this.syncReady&&(clearTimeout(this.eventTimer),this.eventTimer=null,rspkr.hl.html5.Events.resetAll(),rspkr.hl.html5.refresh())},onDurationChange:function(){rspkr.log("onDurationChange fired!",1);this.durationChange=!0;this.checkCompletion();this.eventTimer=setTimeout(function(){rspkr.log("[rspkr.hl.html5.Events] Timer triggered. Starting playback.",1);rspkr.hl.html5.Events.resetAll();rspkr.hl.html5.refresh()},2500)},onSyncReady:function(){rspkr.log("onSyncReady fired!",1);this.syncReady=
!0;this.checkCompletion();this.eventTimer=setTimeout(function(){rspkr.log("[rspkr.hl.html5.Events] Timer triggered. Starting playback.",1);rspkr.hl.html5.Events.resetAll();rspkr.hl.html5.refresh()},2500)},resetAll:function(){this.syncReady=this.durationChange=this.canPlay=!1}},lastcurrenttime:-1,currentsyncindex:0,lastevent:null,lastlastevent:null,lastlastlastevent:null,synclist:[],synclistindex:0,audioUrl:null,backupUrl:null,frameUrl:null,timer:null,postMessageData:[],runningRefresh:!1,handlers:{init:function(){rspkr.log("[rspkr.HL.html5.handlers.init]");
rspkr.HL.html5.cronologyCheck={proxyCallsDone:!1,errorOccured:!1,quarantine:[]};rspkr.HL.html5.rshlendCall=!1;var d=Math.random(),a={};a.audioformat=rspkr.Common.data.browser.html5AudioFormat;a.requestgrouptype="html5iframe";a.requestgroup=d;window.rshlcontinue&&"function"==typeof window.rshlcontinue&&-1!=Object.keys(rspkr.Common.e).indexOf("onChunkResume")&&(a.chunk=1);rspkr.HL.html5.backupUrl=rspkr.Common.data.getAudioLink(a);(!0===rspkr.cfg.item("general.usePost")||0<rspkr.Common.data.selectedText.length||
0<rspkr.Common.data.selectedHTML.length)&&"iOS"!==rspkr.Common.data.browser.OS&&"Android"!==rspkr.Common.data.browser.OS?rspkr.HL.html5.timer=setTimeout(function(){rspkr.HL.html5.initSyncFrame(a);rspkr.HL.html5.initAudio();clearTimeout(rspkr.HL.html5.timer)},2E3):(rspkr.log("Normal audio init!"),rspkr.HL.html5.initSyncFrame(a),rspkr.HL.html5.initAudio())},play:function(){rspkr.log("[rspkr.HL.html5.handlers.play]");rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&rspkr.hl.html5.States.CURRENT==
rspkr.hl.html5.States.STOPPED?(rspkr.hl.html5.States.setState(rspkr.hl.html5.States.BEGIN),rspkr.PlayerAPI.playerRef.pause(),rspkr.HL.html5.handlers.runPostMessages()):rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP&&rspkr.hl.html5.States.CURRENT==rspkr.hl.html5.States.STOPPED?rspkr.hl.State.setState(rspkr.hl.State.RELOAD)?this.init():(rspkr.hl.html5.States.setState(rspkr.hl.html5.States.BEGIN),rspkr.PlayerAPI.playerRef.pause(),rspkr.HL.html5.handlers.runPostMessages()):(rspkr.hl.html5.States.CURRENT=
rspkr.hl.html5.States.USER_START_PLAYING,rspkr.hl.html5.refresh())},pause:function(){rspkr.hl.html5.States.setState(rspkr.hl.html5.States.NOT_PLAYING);rspkr.hl.html5.lastcurrenttime=0},release:function(){rspkr.log("[rspkr.HL.html5.handlers.release]");rspkr.HL.html5.synclist=[];rspkr.HL.html5.synclistindex=0;rspkr.HL.html5.currentsyncindex=0;rspkr.HL.html5.lastcurrenttime=-1;rspkr.HL.html5.audioUrl=null;rspkr.HL.html5.backupUrl=null;rspkr.HL.html5.frameUrl=null;rspkr.HL.html5.postMessageData=[];rspkr.HL.html5.Events.resetAll();
rspkr.PlayerAPI.playerRef&&rspkr.PlayerAPI.playerRef.removeEventListener("ended",rshlexit,!1);rspkr.PlayerAPI.playerRef=null;var d=document.getElementById("ReadSpeaker_sync_iframe");d&&(d.src="about:blank")},stop:function(){rspkr.hl.html5.States.setState(rspkr.hl.html5.States.STOPPED);rspkr.HL.html5.lastcurrenttime=-1;rspkr.HL.html5.currentsyncindex=0},updateTime:function(){rspkr.log("[rspkr.HL.html5.handlers.updateTime]");rspkr.hl.html5.States.setState(rspkr.hl.html5.States.NOT_PLAYING);rspkr.HL.html5.lastcurrenttime=
rspkr.PlayerAPI.playerRef.currentTime;rspkr.HL.html5.currentsyncindex=0;rspkr.HL.html5.handlers.setCurrentSyncIndex();rspkr.hl.html5.States.setState(rspkr.hl.html5.States.USER_START_PLAYING)},runPostMessages:function(){rspkr.log("[rspkr.HL.html5.handlers.runPostMessages]");var d=rspkr.HL.html5.postMessageData,a;for(a in d)null!==d[a-1]&&"rshlsetContent"==d[a]?rspkr.HL.sync.setContent(rspkr.Common.base64.decode(d[a-1])):null!==d[a-1]&&"rshlsetId"==d[a]?rspkr.HL.sync.setId(d[a-1]):"rshlinit"==d[a]&&
(rspkr.HL.sync.init(),rspkr.PlayerAPI.playerRef.play(),rspkr.HL.html5.refresh())},setCurrentSyncIndex:function(){if(0<rspkr.HL.html5.synclist.length&&rspkr.HL.html5.synclist[rspkr.HL.html5.currentsyncindex])for(;rspkr.HL.html5.synclist[rspkr.HL.html5.currentsyncindex]&&20>=1*rspkr.HL.html5.synclist[rspkr.HL.html5.currentsyncindex][0]-1E3*rspkr.PlayerAPI.playerRef.currentTime;)rspkr.HL.html5.currentsyncindex++},totalTime:function(){var d=rspkr.PlayerAPI.playerRef;if(d)if("Opera"!==rspkr.Common.data.browser.name&&
d.buffered&&d.buffered.end)try{return 0<d.buffered.length?d.buffered.end(d.buffered.length-1):d.buffered.end(0)}catch(a){return d.duration&&"infinity"!==d.duration.toString().toLowerCase()&&"NaN"!==d.duration?d.duration:d.currentTime+15}else return d.duration&&"infinity"!==d.duration.toString.toLowerCase()&&"NaN"!==d.duration?d.duration:d.currentTime+15}},initAudio:function(){rspkr.HL.html5.audioUrl||(rspkr.HL.html5.audioUrl=rspkr.HL.html5.backupUrl);rspkr.log("[rspkr.html5.initAudio] Audio URL: "+
rspkr.HL.html5.audioUrl,1);/ios|android/i.test(rspkr.c.data.browser.OS)&&"object"===typeof window.rspkr.audio&&null!==window.rspkr.audio?(rspkr.audio.src=rspkr.HL.html5.audioUrl,rspkr.PlayerAPI.playerRef=rspkr.audio,rspkr.log("[rs.hl.initAudio] Reusing existing audio element.",4)):rspkr.PlayerAPI.playerRef=new Audio(rspkr.HL.html5.audioUrl);var d=rspkr.PlayerAPI.playerRef;d.loop=!1;d.preload="auto";d.volume=parseFloat((rspkr.st.get("hlvol")||100)/100);rspkr.devt("onVolumeAdjusted",window);/ios|android/i.test(rspkr.c.data.browser.OS)&&
(rspkr.PlayerAPI.playerRef.play(),rspkr.PlayerAPI.playerRef.pause());d.addEventListener("canplay",function(){rspkr.hl.html5.Events.onCanPlay()},!1);d.addEventListener("durationchange",function(){rspkr.log("[rspkr.hl.html5.initAudio] Durationchange occurred",1);1==rspkr.HL.html5.handlers.totalTime()&&1==rspkr.PlayerAPI.playerRef.paused?rspkr.HL.html5.initAudio():(0===rspkr.HL.html5.handlers.totalTime()&&rspkr.pl.playerRef.play(),rspkr.hl.html5.Events.onDurationChange())},!1);rspkr.PlayerAPI.playerRef.addEventListener("ended",
function(){rs.HL.chunking.continueHref?window.rshlcontinue():window.rshlexit("false")},!1);rspkr.pl.checkNetworkStatus();rspkr.hl.html5.States.setState(rspkr.hl.html5.States.BEGIN)},initSyncFrame:function(d){if("none"!=rspkr.Common.data.sync){var a=null;document.getElementById("ReadSpeaker_sync_iframe")?a=document.getElementById("ReadSpeaker_sync_iframe"):(a=document.createElement("iframe"),a.setAttribute("id","ReadSpeaker_sync_iframe"),a.setAttribute("title","ReadSpeaker_sync_iframe"),a.setAttribute("aria-hidden",
"true"),a.height=0,a.width=0,a.style.display="none",document.body.appendChild(a));!rspkr.HL.html5.frameUrl&&(!0===rspkr.cfg.item("general.usePost")||0<rspkr.Common.data.selectedText.length||0<rspkr.Common.data.selectedHTML.length)?rspkr.HL.html5.frameUrl=rspkr.HL.html5.backupUrl+"sync":rspkr.HL.html5.frameUrl||(d.audioformat="html5iframe",rspkr.HL.html5.frameUrl=rspkr.Common.data.getAudioLink(d));rspkr.log("[rspkr.HL.html5.initSyncFrame] Audio URL: "+rspkr.HL.html5.frameUrl);rspkr.HL.html5.frameUrl&&
(a.src=rspkr.HL.html5.frameUrl,a.type="text/javascript")}else rspkr.hl.html5.States.setState(rspkr.hl.html5.States.USER_START_PLAYING),rspkr.PlayerAPI.playerRef.play()},removeSyncFrame:function(){var d=document.getElementById("ReadSpeaker_sync_iframe");d&&d.parentNode.removeChild(d)},receiveMessage:function(d){var a=!0;rspkr.cfg.item("general.servercall")&&(a=document.createElement("a"),$rs.setAttr(a,"href",rspkr.cfg.item("general.servercall")),a=!d.origin.match(a.hostname));if(d.origin.match(/readspeaker.?.com/gi)||
d.origin.match(/79.136.80./gi)||d.origin.match(/173.205.5./gi)||d.origin.match(/2001:668:1F:2A/gi)||d.origin.match(/2001:9b0:2:703/gi)||d.origin.match(rspkr.cfg.item("general.domain"))||!a){if(!0===rspkr.cfg.item("general.usePost")){var b=rspkr.HL.html5.cronologyCheck;if("rshlend"===d.data&&b.quarantine&&0<b.quarantine.length)b.errorOccured=!1,b.cleanUpTimer=setInterval(function(){if(0<b.quarantine.length){var d=b.quarantine.shift();window.postMessage(d,"*")}else clearInterval(b.cleanUpTimer)},0);
else if("rshlendpost"===d.data)b.proxyCallsDone=!0;else if((!b.proxyCallsDone||b.errorOccured)&&"http"!==d.data.substring(0,4)&&"rshlaudio"!==d.data&&"rshlhtml5sync"!==d.data&&"rshlfinished"!==d.data){b.errorOccured=!0;b.quarantine.push(d.data);return}}rspkr.HL.html5.postMessageData.push(d.data);/android|ios/i.test(rspkr.Common.data.browser.OS)||"rshlfinished"!=d.data||(rspkr.HL.html5.timer&&clearTimeout(rspkr.HL.html5.timer),rspkr.HL.html5.initSyncFrame(),rspkr.HL.html5.initAudio());if("rshlend"===
d.data)rspkr.HL.html5.rshlendCall=!0,rspkr.c.post.removeIframe(),rspkr.HL.html5.removeSyncFrame();else{if(-1!=d.data.indexOf("."+rspkr.Common.data.browser.html5AudioFormat)){d=rs.cfg.item("general.customProxy")?rs.cfg.item("general.customProxy")+encodeURIComponent(d.data):d.data;rspkr.HL.html5.audioUrl=d;return}if(-1!=d.data.indexOf(".html5iframe")){d=rs.cfg.item("general.customProxy")?rs.cfg.item("general.customProxy")+encodeURIComponent(d.data):d.data;rspkr.HL.html5.frameUrl=d;return}if("rshlaudio"==
d.data||"rshlhtml5sync"==d.data)return;null!=rspkr.HL.html5.lastevent&&"rshlsetContent"==d.data?(rspkr.HL.html5.synclist=[],rspkr.HL.html5.synclistindex=0,rspkr.HL.sync.setContent(rspkr.Common.base64.decode(rspkr.HL.html5.lastevent.data))):null!=rspkr.HL.html5.lastevent&&"rshlsetId"==d.data?rspkr.HL.sync.setId(rspkr.HL.html5.lastevent.data):null!=rspkr.HL.html5.lastevent&&"rshlReplace"==d.data?(rspkr.HL.html5.lastevent.data.match(/class=[^&|,]+/gi)&&(a=rspkr.HL.html5.lastevent.data.match(/class=[^&|,]+/gi)[0].replace("class=",
""),rspkr.HL.sync.setClass(a)),rspkr.HL.html5.lastevent.data.match(/id=[^&|,]+/gi)&&(a=rspkr.HL.html5.lastevent.data.match(/id=[^&|,]+/gi)[0].replace("id=",""),rspkr.HL.sync.setId(a))):"rshlinit"==d.data?(rspkr.HL.sync.init(),rspkr.hl.html5.Events.onSyncReady()):null!=rspkr.HL.html5.lastlastlastevent&&null!=rspkr.HL.html5.lastlastevent&&null!=rspkr.HL.html5.lastevent&&"rshlsync"==d.data?(rspkr.HL.html5.synclist[rspkr.HL.html5.synclistindex]=[rspkr.HL.html5.lastlastlastevent.data,rspkr.HL.html5.lastlastevent.data,
rspkr.HL.html5.lastevent.data],rspkr.HL.html5.synclistindex++):null!=rspkr.HL.html5.lastevent&&"rshlcontinue"==d.data?(rs.HL.chunking.continueHref=rspkr.HL.html5.lastevent.data,rs.HL.chunking.continueTime=rspkr.HL.html5.lastlastevent&&!isNaN(rspkr.HL.html5.lastlastevent.data)?rspkr.HL.html5.lastlastevent.data:-1,/ios|android/i.test(rspkr.c.data.browser.OS)&&(rspkr.HL.chunking.continueTime=-1)):"rshlresume"==d.data&&(rspkr.HL.html5.synclist.length=0,rspkr.HL.html5.synclistindex=0,rspkr.HL.html5.currentsynclistindex=
0,rspkr.HL.html5.currentsyncindex=0)}rspkr.HL.html5.lastlastlastevent=rspkr.HL.html5.lastlastevent;rspkr.HL.html5.lastlastevent=rspkr.HL.html5.lastevent;rspkr.HL.html5.lastevent=d}},refresh:function(){var d=rspkr.PlayerAPI.playerRef,a=rspkr.HL.html5;d&&a.States.CURRENT!=a.States.STOPPED?(a.States.CURRENT==a.States.NOT_PLAYING&&setTimeout(function(){a.refresh()},500),0<d.currentTime&&parseInt(a.lastcurrenttime)>parseInt(Math.ceil(d.currentTime))?(rspkr.log("[rspkr.hl.html5.refresh] An error has occurred. Player is stopped.",
2),rspkr.ui.getActivePlayer().stop(),a.runningRefresh=!1):(a.lastcurrenttime=d.currentTime,a.runningRefresh=!0,a.States.CURRENT==a.States.BEGIN?(rspkr.hl.html5.States.setState(a.States.USER_START_NOT_READY),setTimeout(function(){a.refresh()},200)):a.States.CURRENT==a.States.USER_START_NOT_READY?0<a.handlers.totalTime()&&(rspkr.HL.html5.rshlendCall||a.synclist[a.currentsyncindex]&&a.synclist[a.currentsyncindex][0]<1E3*a.handlers.totalTime())?(rspkr.hl.html5.States.setState(a.States.USER_START_PLAYING),
d.play(),setTimeout(function(){a.refresh()},50)):0===a.handlers.totalTime()?(d.play(),setTimeout(function(){a.refresh()},250)):a.synclist[a.currentsyncindex]?20>=1*a.synclist[a.currentsyncindex][0]-1E3*d.currentTime?setTimeout(function(){a.refresh()},0):(d=1*a.synclist[a.currentsyncindex][0]-1E3*d.currentTime-20,75<d?setTimeout(function(){a.refresh()},75):0>d?setTimeout(function(){a.refresh()},0):setTimeout(function(){a.refresh()},d)):setTimeout(function(){a.refresh()},75):a.States.CURRENT==a.States.USER_START_PLAYING&&
(a.synclist[a.currentsyncindex]&&1*a.synclist[a.currentsyncindex][0]-20<1E3*d.currentTime&&(rspkr.HL.sync.execute(a.synclist[a.currentsyncindex][1],a.synclist[a.currentsyncindex][2]),a.currentsyncindex++),a.synclist[a.currentsyncindex]?20>=1*a.synclist[a.currentsyncindex][0]-1E3*d.currentTime?setTimeout(function(){a.refresh()},0):(d=1*a.synclist[a.currentsyncindex][0]-1E3*d.currentTime-20,75<d?setTimeout(function(){a.refresh()},75):0>d?setTimeout(function(){a.refresh()},0):setTimeout(function(){a.refresh()},
d)):setTimeout(function(){a.refresh()},75)))):(rspkr.log("[rspkr.hl.html5.refresh] Audio is undefined or player is stopped",2),a.runningRefresh=!1)}},Preserve:{cls:".rs_preserve",testElem:null,elementShelter:[],formShelter:[],formData:function(a,b,h,c,f){this.name=a;this.type=b;this.value=h;this.checked=c;this.selectedIndex=f;this.selectedOptions=[]},moveToShelter:function(a){rspkr.HL.Preserve.cls=rspkr.cfg.item("general.preserveElements")?rspkr.cfg.item("general.preserveElements"):rspkr.HL.Preserve.cls;
rspkr.log("[rspkr.HL.Preserve.moveToShelter]");var b=[],h=[],c=null,f=[];if(a.childNodes){for(var e=$rs.findIn(a,rspkr.HL.Preserve.cls),e=$rs.isArray(e)?e:[e],c=0;c<e.length;c++)for(var g=c+1;g<e.length;g++)$rs.isArray($rs.findIn(e[c],e[g]))?$rs.isArray($rs.findIn(e[g],e[c]))||(e.splice(c,1),c--,g=e.length):(e.splice(g,1),g--);for(c=0;c<e.length;c++)f.push(e[c])}e=0;for(g=f.length;e<g;e++)c=$rs.get(f[e]).cloneNode(!1),f[e].parentNode.insertBefore(c,f[e]),b.push($rs.detach(f[e]));rspkr.log("[rspkr.hl.Preserve] Moved "+
e+" nodes to the shelter.");a=$rs.findIn(a,"input, select");for(e=0;e<a.length;e++){f=new rspkr.HL.Preserve.formData(a[e].name,a[e].type,a[e].value,a[e].checked,a[e].selectedIndex);if("select-multiple"==a[e].type){for(var c=a[e].options,g=[],s=0;s<c.length;s++)g.push(c[s].selected);f.selectedOptions=g}h.push(f)}rspkr.HL.Preserve.elementShelter.push(b);rspkr.HL.Preserve.formShelter.push(h)},restoreFromShelter:function(a){var b=[],h,e;rspkr.log("[rspkr.HL.Preserve.restoreFromShelter]");if(rspkr.HL.Preserve.elementShelter.length&&
(e=rspkr.HL.Preserve.elementShelter.shift(),e.length)){if(a.childNodes){var f=$rs.findIn(a,rspkr.HL.Preserve.cls),f=$rs.isArray(f)?f:[f];for(h=0;h<f.length;h++)for(var c=h+1;c<f.length;c++)$rs.isArray($rs.findIn(f[h],f[c]))?$rs.isArray($rs.findIn(f[c],f[h]))||(f.splice(h,1),h--,c=f.length):(f.splice(c,1),c--);for(h=0;h<f.length;h++)b.push(f[h])}f=0;for(c=b.length;f<c;f++)h=e.shift(),b[f].parentNode.insertBefore(h,b[f]),b[f].parentNode.removeChild(b[f])}if(rspkr.HL.Preserve.formShelter.length&&(a=
$rs.findIn(a,"input, select"),b=rspkr.HL.Preserve.formShelter.shift(),a.length&&b.length&&a.length===b.length))for(f=0;f<a.length;f++)if(a[f].name===b[f].name)switch(a[f].type){case "text":a[f].value=b[f].value;break;case "password":a[f].value=b[f].value;break;case "radio":!0===b[f].checked&&(a[f].checked=!0);break;case "checkbox":a[f].checked=b[f].checked;break;case "select-one":a[f].selectedIndex=b[f].selectedIndex;break;case "select-multiple":for(e=a[f].options,h=0;h<e.length;h++)e[h].selected=
b[f].selectedOptions[h]}},clearShelter:function(){rspkr.log("[rspkr.HL.Preserve.clearShelter]");rspkr.HL.Preserve.elementShelter=[];rspkr.HL.Preserve.formShelter=[]}},Restore:{Storage:{readClass:[],readId:[],restoreContent:[]},all:function(){rspkr.log("[rspkr.HL.Restore.all]");var a=rspkr.HL.Restore.Storage,b=[],h=null,e=/sync_(word|sent)/gi;if(!rspkr.cfg.item("general.premarkup")){rspkr.c.dispatchEvent("onBeforeContentChange",window);if(a.readId.length||a.restoreContent.length||a.readClass.length){var h=
$rs.flatten?$rs.flatten(a.readClass):a.readClass,c=$rs.flatten?$rs.flatten(a.readId):a.readId,h=h.length?("."+h.join(",.")).split(","):[],h=c.length?h.concat(("#"+c.join(",#")).split(",")):h;if(rspkr.cfg.item("general.readidOrder")&&rspkr.cfg.item("general.usePost"))for(c=0;c<h.length;c++){var g=$rs.get(h[c]);$rs.isArray(g)&&0<g.length?b.concat(g):$rs.isArray(g)||b.push(g)}else b=$rs.get(h.join(","));$rs.isArray(b)||(b=[b]);for(c=0;h=b[c];c++)!0===e.test(h.innerHTML)&&(rspkr.HL.Preserve.moveToShelter(h),
h.innerHTML=a.restoreContent[c],rspkr.HL.Preserve.restoreFromShelter(h))}else rspkr.log("No stored content exists!",2);rspkr.c.dispatchEvent("onAfterContentChange",window)}a.readId.length=0;a.readClass.length=0},checkContent:function(){rspkr.log("[rspkr.hl.Restore.checkContent]",1);!1===this.hasMarkup()&&rspkr.hl.State.CURRENT==rspkr.hl.State.STOPPED&&rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP&&(this.clearRestoreContent(),this.setRestoreContent(),rspkr.pl.releaseAdapter(),rspkr.hl.State.setState(rspkr.hl.State.RELOAD))},
hasMarkup:function(){var a=rspkr.HL.Restore.Storage,b=[],c=null,e=/sync_(word|sent)/gi,c=$rs.flatten?$rs.flatten(a.readClass):a.readClass,f=$rs.flatten?$rs.flatten(a.readId):a.readId,c=c.length?("."+c.join(",.")).split(","):[],c=f.length?c.concat(("#"+f.join(",#")).split(",")):c;if(rspkr.cfg.item("general.readidOrder")&&rspkr.cfg.item("general.usePost"))for(f=0;f<c.length;f++){var g=$rs.get(c[f]);$rs.isArray(g)&&0<g.length?b.concat(g):$rs.isArray(g)||b.push(g)}else b=$rs.get(c.join(","));$rs.isArray(b)||
(b=[b]);if(b.length&&a.restoreContent.length)for(f=0;c=b[f];f++)if(e.test(c.innerHTML))return!0;return!1},clearRestoreContent:function(){rspkr.log("[rspkr.HL.Restore.clearRestoreContent] Called!")},setRestoreContent:function(){rspkr.log("[rspkr.HL.Restore.setRestoreContent] Called!");if("Explorer"===rs.c.data.browser.name&&9>=rs.c.data.browser.version)for(var a=document.body.getElementsByTagName("style"),b=0,c;c=a[b];b++){c.parentNode.removeChild(c);document.getElementsByTagName("head")[0].appendChild(c);
var e=c.innerHTML;if(-1!=e.indexOf("@import")){for(var f=e.split("\n"),g,e=0,m;m=f[e];e++)if("@import"===m.substring(0,7)){e=m.replace(/;/g,"").replace("@import ","").replace("url(","").replace(")","").replace(/\"/g,"").replace(/\'/g,"").split(" ");for(f=0;f<e.length;f++){var s=e[f].replace(/ /g,"");if(s){g=s;break}}break}c=c.sheet?c.sheet:c.styleSheet;c.insertRule?c.insertRule(m,0):c.addImport&&c.addImport(g)}}a=rspkr.HL.Restore.Storage;b=[];g=/sync_(word|sent|user)/gi;m=a.restoreContent;0===a.readClass.length&&
0===a.readId.length&&rspkr.HL.Restore.getReadData();if(0==a.readClass.length&&0==a.readId.length)rspkr.log("ERR: Could not set restore content or find the read area data",3);else{c=$rs.flatten?$rs.flatten(a.readClass):a.readClass;e=$rs.flatten?$rs.flatten(a.readId):a.readId;c=c.length?("."+c.join(",.")).split(","):[];c=e.length?c.concat(("#"+e.join(",#")).split(",")):c;if(rspkr.cfg.item("general.readidOrder")&&rspkr.cfg.item("general.usePost"))for(e=0;e<c.length;e++)f=$rs.get(c[e]),$rs.isArray(f)&&
0<f.length?b.concat(f):$rs.isArray(f)||b.push(f);else b=$rs.get(c.join(","));$rs.isArray(b)||(b=[b]);a.restoreContent=[];for(e=0;c=b[e];e++)!1===g.test(c.innerHTML)?a.restoreContent.push(c.innerHTML):0<m.length&&m[e]?a.restoreContent.push(m[e]):a.restoreContent.push(c.innerHTML)}},getReadData:function(){rspkr.log("[rspkr.HL.Restore.getReadData]");var a=rspkr.HL.Restore.Storage,b;b=rspkr.ui.getActivePlayer()?$rs.findIn(rspkr.ui.getActivePlayer().getContainer(),".rsbtn_play"):$rs.findIn($rs.get("."+
rs.ui.rsbtnClass),".rsbtn_play");$rs.isArray(b)||(b=[b]);for(var c=0,e=b.length;c<e;c++){var f=b[c].getAttribute("href").match(/readspeaker.?.com\/cgi-bin\/.*rsent/gi);rspkr.cfg.item("general.servercall")&&(f=f?f:-1<b[c].getAttribute("href").indexOf(rspkr.cfg.item("general.servercall")));b[c].getAttribute("href")&&-1!==(b[c].getAttribute("href").indexOf(rspkr.cfg.item("general.domain")+"/cgi-bin/"+rspkr.cfg.item("general.rsent"))||f)&&"rsSaveBtn"!==b[c].id&&"rs_selimg"!==b[c].id&&(-1!==b[c].getAttribute("href").search(/readclass=/)&&
(f=b[c].getAttribute("href").match(/readclass=[^&]+/gi)[0].replace("readclass=",""),f=f.split(","),rspkr.HL.Restore.Storage.readClass.push(f)),-1!==b[c].getAttribute("href").search(/readid=/)&&(f=b[c].getAttribute("href").match(/readid=[^&]+/gi)[0].replace("readid=",""),f=f.split(","),rspkr.HL.Restore.Storage.readId.push(f)))}0===a.readClass.length&&0===a.readId.length&&(rspkr.c.data.params.hasOwnProperty("readid")?a.readId.push([rspkr.c.data.params.readid]):rspkr.c.data.params.hasOwnProperty("readclass")&&
a.readClass.push([rspkr.c.data.params.readclass]))}},Scroll:{currentSpan:null,timer:null,useScroll:!1,userScrollTimer:null,stopped:!0,getScrollY:function(){var a=0;"number"==typeof document.pageYOffset?a=document.pageYOffset:document.documentElement&&document.documentElement.scrollTop&&0<document.documentElement.scrollTop?a=document.documentElement.scrollTop:document.body&&document.body.scrollTop&&(a=document.body.scrollTop);return a},getWindowHeight:function(){var a=0;"number"==typeof window.innerHeight?
a=window.innerHeight:document.documentElement&&document.documentElement.clientHeight&&0<document.documentElement.clientHeight?a=document.documentElement.clientHeight:document.body&&document.body.clientHeight&&(a=document.body.clientHeight);return a+30},userScroll:function(){rspkr.HL.Scroll.timer&&(clearTimeout(rspkr.HL.Scroll.timer),rspkr.HL.Scroll.timer=null);rspkr.HL.Scroll.userScrollTimer&&clearTimeout(rspkr.HL.Scroll.userScrollTimer);rspkr.HL.Scroll.userScrollTimer=setTimeout(function(){rspkr.HL.Scroll.userScrollTimer=
null},5E3)},stopTimer:function(){rspkr.log("[rspkr.Hl.Scroll.stopTimer] Called!");rspkr.HL.Scroll.timer&&(clearTimeout(rspkr.HL.Scroll.timer),rspkr.HL.Scroll.timer=null);rspkr.HL.Scroll.stopped=!0},initScroll:function(){"scrollon"==rspkr.Common.Settings.get("hlscroll")?(rspkr.log("[rspkr.HL.Sroll.initScroll] Scroll initiated!"),rspkr.HL.Scroll.useScroll=!0,rspkr.evt("onUIClosePlayer",rspkr.HL.Scroll.stopTimer),rspkr.evt("onUIStop",rspkr.HL.Scroll.stopTimer),rspkr.evt("onUIPause",rspkr.HL.Scroll.stopTimer),
rspkr.evt("onUISliderMove",rspkr.HL.Scroll.userScroll),rspkr.evt("onFocusIn",rspkr.HL.Scroll.userScroll),rspkr.evt("onFocusOut",rspkr.HL.Scroll.userScroll),document.addEventListener?document.addEventListener("scroll",function(){setTimeout(function(){rspkr.HL.Scroll.userScroll()},0)},!1):document.attachEvent?document.attachEvent("onscroll",rspkr.HL.Scroll.userScroll):document.onscroll=rspkr.HL.Scroll.userScroll):this.useScroll=!1},execScroll:function(a){this.useScroll&&(this.currentSpan=a,!0===this.stopped&&
(this.stopped=!1),this.timer||(rspkr.log("[rspkr.hl.Scroll] execScroll"),this.timer=setTimeout(function(){rspkr.HL.Scroll.timer=null;rspkr.HL.Scroll.triggerScroll(rspkr.HL.Scroll.currentSpan)},500)))},triggerScroll:function(a){rspkr.log("[rspkr.HL.Scroll.triggerScroll] timer: "+rspkr.hl.Scroll.userScrollTimer+", stopped: "+rspkr.HL.Scroll.stopped);rspkr.HL.Scroll.userScrollTimer||!1!==rspkr.HL.Scroll.stopped||rspkr.u.scroll.scrollToElm(a)}},State:{CURRENT:1,READY:1,STOPPED:2,PLAYING:3,RELOAD:4,setState:function(a){this.CURRENT=
a;rspkr.log("[rspkr.hl.html5.States.setState] Changing state from "+this.CURRENT+" to "+a,1)}},sync:{init:function(){rspkr.c.dispatchEvent("onBeforeSyncInit",window);g.hlChanged=!1;if(0<rspkr.Common.data.selectedText.length||0<rspkr.Common.data.selectedHTML.length)rspkr.log("[rspkr.HL._sync.init] client markup"),rspkr.HL.Type.CURRENT=rspkr.HL.Type.CLIENT_MARKUP,b.firstRun=1,"explorer"==a?document.selection.empty():b.preProcess.identifyElementsReplacementNode(document.body);else if(rspkr.log("[rspkr.HL._sync.init] server markup"),
rspkr.HL.Type.CURRENT=rspkr.HL.Type.SERVER_MARKUP,"none"!=rspkr.Common.data.sync){var d=[],c=[],e=[];rspkr.c.data.params.hasOwnProperty("readid")&&rspkr.c.data.params.readid.length&&(e=e.concat(("#"+rspkr.c.data.params.readid.split(",").join(",#")).split(",")));rspkr.c.data.params.hasOwnProperty("readclass")&&rspkr.c.data.params.readclass.length&&(e=e.concat(("."+rspkr.c.data.params.readclass.split(",").join(",.")).split(",")));if(rspkr.cfg.item("general.readidOrder")&&rspkr.cfg.item("general.usePost"))for(var k=
0;k<e.length;k++){var f=$rs.get(e[k]);$rs.isArray(f)&&0<f.length?d.concat(f):$rs.isArray(f)||d.push(f)}else d=$rs.get(e.join(","));$rs.isArray(d)||(d=[d]);if("flash"==rspkr.PlayerAPI.adapter)for(e=rspkr.HL.markedUpHTML.join("").split("\x3c!--RSPEAK_STOP--\x3e"),k=0;e[k];k++);else e=rspkr.HL.markedUpHTML;for(k=0;f=d[k];k++)f=f.nodeName&&"TABLE"==f.nodeName?document.createElement("TABLE"):document.createElement("DIV"),f.innerHTML=e[k],c.push(f);rspkr.log("[rspkr.HL.sync.init] readElements length: "+
d.length);if(!rspkr.cfg.item("general.premarkup")){rspkr.c.dispatchEvent("onBeforeContentChange",window);for(k=0;k<d.length;k++)rspkr.HL.Preserve.moveToShelter(d[k]),d[k].innerHTML=c[k].innerHTML,rspkr.HL.Preserve.restoreFromShelter(d[k]);rspkr.c.dispatchEvent("onAfterContentChange",window);rspkr.HL.Preserve.clearShelter()}}rspkr.HL.markedUpHTML.length=0;rspkr.c.post.removeIframe();rspkr.c.dispatchEvent("onAfterSyncInit",window)},lightCleanUp:function(){rspkr.HL.customHL&&rspkr.HL.customHL.active()&&
rspkr.HL.customHL.cleanUp();rspkr.log("[rspkr.HL._sync.lightCleanUp] Called! "+rspkr.HL.Type.CURRENT);rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&!0===g.hlChanged?b.postProcess.settingsCleanUp():rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&!1===g.hlChanged||0<rspkr.Common.data.selectedText.length?b.postProcess.lightCleanUp():rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP&&c.postProcess.lightCleanUp()},fullCleanUp:function(){rspkr.log("[rspkr.HL._sync.fullCleanUp] Called!");rspkr.HL.customHL&&
rspkr.HL.customHL.active()&&rspkr.HL.customHL.cleanUp();rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&b.postProcess.fullCleanUp();c.postProcess.fullCleanUp()},setId:function(a){rspkr.log("[rspkr.HL._sync.setId] Called!")},setClass:function(a){rspkr.log("[rspkr.HL._sync.setClass] Called!")},setContent:function(a){rspkr.log("[rspkr.HL._sync.setContent] Called!");rspkr.HL.markedUpHTML.push(a)},execute:function(a,b){var c=rspkr.Common.Settings;if("none"!==c.get("hl")&&"hloff"!==c.get("hltoggle")){if(rspkr.HL.Type.CURRENT==
rspkr.HL.Type.SERVER_MARKUP){var e=$rs.hasClass($rs.get("#sync"+b),"sync_sent")?"sent":"word";if("sent"===c.get("hl")&&"word"===e||"word"===c.get("hl")&&"sent"===e)return}rspkr.c.dispatchEvent("onBeforeSync",window,[a,b]);rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP?(c=rspkr.cfg.item("general.selectionEngine"),!c||"new"!==c&&"newcontent"!==c?rspkr.HL.clientMarkup.sync(a,b):rspkr.HL.clientMarkup.syncNew(a,b)):rspkr.HL.serverMarkup.sync(a,b);rspkr.c.dispatchEvent("onAfterSync",window,[a,b])}}},
settings:g,Type:{CURRENT:0,DEFAULT:0,SERVER_MARKUP:1,CLIENT_MARKUP:2}}}();rspkr.HL.engine||(rspkr.HL.engine={});
rspkr.HL.engine.explorer=function(){return{clientExtension:{firstRun:0,previousWord:{},previousSent:{},selectionRange:null,selectionHTML:null,selectedWordsRange:[],wordsRangeClasses:[],originalParentContent:"",originalParent:null,preProcess:{bookMarkIndex:1,endNode:null,endOffset:null,excludednodes:"table tr select option textarea ul ol dl thead tbody tfoot colgroup script map optgroup style noscript".split(" "),firstRun:0,inc:0,numberOfSelections:0,startNode:null,startOffset:null,init:function(){this.numberOfSelections++;
var a;a="new"===rspkr.cfg.item("general.selectionEngine")||"newcontent"===rspkr.cfg.item("general.selectionEngine")?this.buildMarkupNew(rspkr.Common.data.selectedRange):this.buildMarkup(rspkr.Common.data.selectedRange);a.replace(/  +/g," ");rspkr.Common.data.selectedHTML=a;rspkr.hl.clientMarkup.originalParent=rspkr.c.data.selectedRange.parentElement();rspkr.hl.clientMarkup.originalParentContent=rspkr.c.data.selectedRange.parentElement().innerHTML},buildMarkup:function(a){for(var b=rspkr.c.data.getParam("lang"),
c=!1,e=null,g=rspkr.cfg.item("general.sentOnlyLang"),d=0;d<g.length;d++)if(b&&b.toLowerCase()===g[d]){c=!0;break}var b=a.duplicate(),d=0,g="",l=1,h=0,k=0,f="",p="",m=null;a.moveStart("word",-1);a.moveStart("word",1);b.isEqual(a)||a.moveStart("word",-1);b=a.duplicate();a.moveEnd("word",1);a.moveEnd("word",-1);b.isEqual(a)||a.moveEnd("word",1);rspkr.HL.clientMarkup.selectionRange=a.duplicate();var s=a.parentElement(),r=a.duplicate();r.collapse(!1);b=a.duplicate();b.collapse();for(c&&(e=a.text.split(new RegExp(decodeURIComponent("%e3%80%81")+
"|"+decodeURIComponent("%e3%80%82")+"|"+decodeURIComponent("%DB%94")+"|"+decodeURIComponent("%D8%8C"))));a.inRange(b)&&0!=a.compareEndPoints("EndToEnd",b);){k++;d++;if(1E4<d)break;if(c)if(b=a.duplicate(),e[k-1])b.findText(e[k-1]);else break;else b.collapse(!1),b.expand("word",1);p=f="";r.collapse(!1);var n=b.duplicate();n.collapse(!1);if(0==r.compareEndPoints("StartToStart",n)&&0==r.compareEndPoints("EndToEnd",n)&&n.htmlText==r.htmlText&&/\W/.test(n.text)){h++;if(2>h)b.move("character",1);else if(4>
h)b.move("character",2);else if(6>h)b.move("word",1);else if(8>h)b.move("word",2);else if(10>h)b.move("sentence",1);else if(12>h)b.move("sentence",2);else break;b.collapse(!1)}else{h=0;if(-1===k)return b;rspkr.HL.clientMarkup.selectedWordsRange[k]=b.duplicate();r=b.text;n=b.htmlText;b.collapse(!1);var w;1===l?(m=b.duplicate(),w=this.iterateParentTree(m.parentElement(),document.body,s,0)):w=this.iterateParentTree(b.parentElement(),m.parentElement(),s,0);for(var v=this.iterateParentTree(m.parentElement(),
b.parentElement(),s,0),q=b.parentElement(),t=0;t<w&&20>t;t++)q.className.match("sync_")||(f=q.outerHTML.match("<[^>]*>")[0]+f),q=q.parentElement;q=m.parentElement();for(t=0;t<v&&20>t;t++)q.className.match("sync_")||(p+="</"+q.tagName+">"),q=q.parentElement;if(0!=w||0!=v)m=b.duplicate();1===l?(g+=f,l=0):g+=p+f;""!=n.replace("sync_sent_highlighted","")&&(g+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user" id="sync'+k+'">'+r+"</"+rspkr.Common.data.browser.syncContainer+">");r=b.duplicate()}}g+=
"\x3c!-- f --\x3e";v=this.iterateParentTree(m.parentElement(),document.body,s,0);q=m.parentElement();for(t=0;t<v;t++)q.className.match("sync_")||(g+="</"+q.tagName+">"),q=q.parentElement;b.collapse();return g},buildMarkupNew:function(a){for(var b=rspkr.c.data.getParam("lang"),c=!1,e=rspkr.cfg.item("general.sentOnlyLang"),g=0;g<e.length;g++)if(b&&b.toLowerCase()===e[g]){c=!0;break}var b=a.duplicate(),e="",d=1,l=0,h=0,k="",f="",p="",m=null,g=0;rspkr.HL.clientMarkup.selectionRange=a.duplicate();var s=
a.parentElement(),r=a.duplicate(),k=a.duplicate();r.collapse(!1);b.collapse();var n=[],f=k.duplicate(),p=k.duplicate();k.moveStart("sentence",-1);k.moveStart("sentence",1);f.isEqual(k)||k.moveStart("sentence",-1);f=k.duplicate();k.moveEnd("sentence",1);k.moveEnd("sentence",-1);f.isEqual(k)||k.moveEnd("sentence",1);f=k.duplicate();p.collapse(!0);for(k.collapse(!0);f.inRange(k)&&0!=f.compareEndPoints("EndToEnd",k);){p.expand("sentence",1);if(!0===p.isEqual(k)||0===p.compareEndPoints("EndToEnd",k))break;
k.expand("sentence",1);n.push(p.duplicate())}for(;!1===a.inRange(n[0])&&0!=a.compareEndPoints("StartToStart",n[0]);)n[0].moveStart("word",1);for(;!1===a.inRange(n[n.length-1])&&0!=a.compareEndPoints("EndToEnd",n[n.length-1]);)n[n.length-1].moveEnd("word",-1);for(var w=0;w<n.length;w++){for(p="";n[w].inRange(b)&&0!=n[w].compareEndPoints("EndToEnd",b);){h++;g++;if(1E4<g)break;c?(b=a.duplicate(),b.findText(null[h-1])):(b.collapse(!1),b.expand("word",1));f=k="";r.collapse(!1);var v=b.duplicate();v.collapse(!1);
if(0==r.compareEndPoints("StartToStart",v)&&0==r.compareEndPoints("EndToEnd",v)&&v.htmlText==r.htmlText){l++;if(2>l)b.move("character",1);else if(4>l)b.move("character",2);else if(6>l)b.move("word",1);else if(8>l)b.move("word",2);else if(10>l)b.move("sentence",1);else if(12>l)b.move("sentence",2);else break;b.collapse(!1)}else{l=0;if(-1===h)return b;rspkr.HL.clientMarkup.selectedWordsRange[h]=b.duplicate();rspkr.HL.clientMarkup.wordsRangeClasses[h]="word";r=b.text;v=b.htmlText;b.collapse(!1);var q;
1===d?(m=b.duplicate(),q=this.iterateParentTree(m.parentElement(),document.body,s,0)):q=this.iterateParentTree(b.parentElement(),m.parentElement(),s,0);for(var t=this.iterateParentTree(m.parentElement(),b.parentElement(),s,0),u=b.parentElement(),x=0;x<q&&20>x;x++)u.className.match("sync_")||(k=u.outerHTML.match("<[^>]*>")[0]+k),u=u.parentElement;u=m.parentElement();for(x=0;x<t&&20>x;x++)u.className.match("sync_")||(f+="</"+u.tagName+">"),u=u.parentElement;if(0!=q||0!=t)m=b.duplicate();1===d?(p+=k,
d=0):p+=f+k;""!=v.replace("sync_sent_highlighted","")&&(p+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user sync_word" id="sync'+h+'">'+r+"</"+rspkr.Common.data.browser.syncContainer+">");r=b.duplicate()}}h++;rspkr.HL.clientMarkup.selectedWordsRange[h]=n[w];rspkr.HL.clientMarkup.wordsRangeClasses[h]="sent";e+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user sync_sent" id="sync'+h+'">';e+=p;e+="</"+rspkr.Common.data.browser.syncContainer+">\n"}t=this.iterateParentTree(m.parentElement(),
document.body,s,0);u=m.parentElement();for(x=0;x<t;x++)u.className.match("sync_")||(e+="</"+u.tagName+">"),u=u.parentElement;b.collapse();return e},iterateParentTree:function(a,b,c,e){for(var g=b;null!==g;){if(a==c||a==g)return e;g=g.parentElement}e++;return this.iterateParentTree(a.parentElement,b,c,e)}},postProcess:{lightCleanUp:function(){rspkr.log("[clientMarkup.postProcess.lightCleanUp] called!");for(var a=rspkr.Common.data.browser.syncContainer.replace(/(:|\.|\[|\]|,)/g,"\\$1"),b=$rs.get(a+
".sync_sent,"+a+".sync_word,"+a+".sync_sent_highlighted,"+a+".sync_word_highlighted,"+a+".sync_user,"+a+".synctemp,"+a+'[class*="ffsent"]'),b=$rs.isArray(b)?b:[b],a=b.length-1;-1<a;a--)b[a].className=b[a].className.replace("sync_sent_highlighted","sync_sent"),b[a].className=b[a].className.replace("sync_word_highlighted","sync_word"),-1===b[a].className.toLowerCase().indexOf("sync_user")&&(b[a].removeAttribute("id"),b[a].removeAttribute("color"));var b=rspkr.HL.clientMarkup.previousWord.range,c=rspkr.HL.clientMarkup.previousWord.forecolor,
e=rspkr.HL.clientMarkup.previousWord.backcolor,g=rspkr.HL.clientMarkup.previousSent.range,d=rspkr.HL.clientMarkup.previousSent.forecolor,l=rspkr.HL.clientMarkup.previousSent.backcolor;if(0<b.length)for(var a=0,h=b.length;a<h;a++)null!==e[a]&&(b[a].execCommand("backcolor",0,e[a]),null!==c[a]&&b[a]&&b[a].execCommand("forecolor",0,c[a]));if(0<g.length)for(a=0,h=g.length;a<h;a++)null!==l[a]&&(g[a].execCommand("backcolor",0,l[a]),null!==d[a]&&g[a]&&g[a].execCommand("forecolor",0,d[a]));rspkr.hl.clientMarkup.lastWord=
null},settingsCleanUp:function(){this.lightCleanUp()},fullCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.fullCleanUp] called!");if(null===rspkr.hl.clientMarkup.originalParent)this.lightCleanUp();else{var a=rspkr.hl.clientMarkup.originalParent;rspkr.hl.Preserve.moveToShelter(a);a.innerHTML=rspkr.hl.clientMarkup.originalParentContent;rspkr.hl.Preserve.restoreFromShelter(a)}rspkr.hl.clientMarkup.selectedWordsRange=[];rspkr.hl.clientMarkup.selectionRange=null;rspkr.hl.clientMarkup.originalParentContent=
"";rspkr.hl.clientMarkup.originalParent=null;rspkr.hl.clientMarkup.lastWord=null}},sync:function(a,b){var c=!1,e;0===(a&2)&&(c=0!=(a&1)?!0:!1);1===this.firstRun&&(this.previousWord.range=[],this.previousWord.backcolor=[],this.previousWord.forecolor=[],this.previousSent.range=[],this.previousSent.backcolor=[],this.previousSent.forecolor=[]);e=this.selectedWordsRange[b];if(1===this.firstRun){this.firstRun=0;if(0<this.previousSent.range.length){for(var g=0,d=this.previousSent.range.length;g<d;g++)this.previousSent.range[g].execCommand("backcolor",
0,this.previousSent.backcolor[g]),null!==this.previousSent.forecolor[g]&&this.previousSent.range[g].execCommand("forecolor",0,this.previousSent.forecolor[g]);this.previousSent.range=[];this.previousSent.backcolor=[];this.previousSent.forecolor=[]}rspkr.HL.clientMarkup.selectionRange&&"wordsent"===rspkr.st.get("hl")&&(this.previousSent.range.push(rspkr.HL.clientMarkup.selectionRange),this.previousSent.backcolor.push(rspkr.HL.clientMarkup.selectionRange.queryCommandValue("backcolor")),this.previousSent.forecolor.push(rspkr.HL.clientMarkup.selectionRange.queryCommandValue("forecolor")),
this.selectionRange.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),this.selectionRange.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext")))}if(!c&&0<this.previousWord.range.length){for(g=0;g<this.previousWord.range.length;g++)"word"==rspkr.st.get("hl")||"sent"==rspkr.st.get("hl")?this.previousWord.range[g].execCommand("backcolor",0,this.previousWord.backcolor[g]):this.previousWord.range[g].execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),this.previousWord.range[g].execCommand("forecolor",
0,this.previousWord.forecolor[g]);this.previousWord.range=[];this.previousWord.backcolor=[];this.previousWord.forecolor=[]}this.previousWord.backcolor.push(e.queryCommandValue("backcolor"));this.previousWord.forecolor.push(e.queryCommandValue("forecolor"));this.previousWord.range.push(e);"sent"==rspkr.st.get("hl")?(rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.sentHL(e,a),e.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent"))):(rspkr.HL.customHL&&rspkr.HL.customHL.active()&&
rspkr.HL.customHL.wordHL(e,a),e.execCommand("backcolor",0,rspkr.Common.Settings.get("hlword")));this.lastWord=e;rspkr.HL.customHL&&rspkr.HL.customHL.active();e.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext"))},syncNew:function(a,b){var c=!1;0===(a&2)&&(c=0!=(a&1)?!0:!1);1===this.firstRun&&(this.previousWord.range=[],this.previousWord.backcolor=[],this.previousWord.forecolor=[],this.previousSent.range=[],this.previousSent.backcolor=[],this.previousSent.forecolor=[],this.firstRun=0);var e=
this.selectedWordsRange[b];if(e&&"word"===this.wordsRangeClasses[b]&&("word"==rspkr.st.get("hl")||"wordsent"==rspkr.st.get("hl"))){if(0<this.previousWord.range.length&&!c){for(c=0;c<this.previousWord.range.length;c++)"word"==rspkr.st.get("hl")||"sent"==rspkr.st.get("hl")?this.previousWord.range[c].execCommand("backcolor",0,this.previousWord.backcolor[c]):this.previousWord.range[c].execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),this.previousWord.range[c].execCommand("forecolor",0,this.previousWord.forecolor[c]);
this.previousWord.range=[];this.previousWord.backcolor=[];this.previousWord.forecolor=[]}this.previousWord.backcolor.push(e.queryCommandValue("backcolor"));this.previousWord.forecolor.push(e.queryCommandValue("forecolor"));this.previousWord.range.push(e);e.execCommand("backcolor",0,rspkr.Common.Settings.get("hlword"));this.lastWord=e;e.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext"))}else if(e&&"sent"===this.wordsRangeClasses[b]&&("sent"==rspkr.st.get("hl")||"wordsent"==rspkr.st.get("hl"))){if(0<
this.previousWord.range.length){for(c=0;c<this.previousWord.range.length;c++)this.previousWord.range[c].execCommand("backcolor",0,this.previousWord.backcolor[c]),this.previousWord.range[c].execCommand("forecolor",0,this.previousWord.forecolor[c]);this.previousWord.range=[];this.previousWord.backcolor=[];this.previousWord.forecolor=[]}if(0<this.previousSent.range.length){for(c=0;c<this.previousSent.range.length;c++)this.previousSent.range[c].execCommand("backcolor",0,this.previousSent.backcolor[c]),
this.previousSent.range[c].execCommand("forecolor",0,this.previousSent.forecolor[c]);this.previousSent.range=[];this.previousSent.backcolor=[];this.previousSent.forecolor=[]}this.previousSent.backcolor.push(e.queryCommandValue("backcolor"));this.previousSent.forecolor.push(e.queryCommandValue("forecolor"));this.previousSent.range.push(e);e.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent"));e.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext"))}}}}}();
rspkr.HL.engine.gecko=function(){return{clientExtension:{preProcess:{bookMarkIndex:1,endNode:null,endOffset:null,excludednodes:"table tr select option textarea ul ol dl thead tbody tfoot colgroup script map optgroup style noscript".split(" "),firstRun:0,inc:0,numberOfSelections:0,startNode:null,startOffset:null,init:function(){this.numberOfSelections++;var a="",a=rspkr.Common.data.selectedRange;this.startNode=a.startContainer;this.endNode=a.endContainer;this.startOffset=this.modifyOffsetStartOfWord(this.startNode,
a.startOffset);this.endOffset=this.modifyOffsetEndOfWord(this.endNode,a.endOffset);a=this.buildMarkup(a.commonAncestorContainer);a.replace(/  +/g," ");window.getSelection().removeAllRanges();rspkr.Common.data.selectedHTML=a},buildMarkup:function(a){this.firstRun=1;var b="",c=this.inc;if(3==a.nodeType)b+=this.textMarkup(a);else{var e,g="";if(a.hasChildNodes())for(e=0;e<a.childNodes.length;e++){var d=a.childNodes.item(e);d==this.startNode&&(this.inc=1);a==this.startNode&&e==this.startOffset&&(this.inc=
1);8!=d.nodeType&&(g+=this.buildMarkup(d));if(a==this.endNode&&e==this.endOffset){this.inc=0;break}if(d==this.endNode){this.inc=0;break}}(c||this.inc)&&(!a.className||a.className.replace("sync")===a.className&&$rs.getAttr(a,"id")&&$rs.getAttr(a,"id").replace("sync")===$rs.getAttr(a,"id"))?(c=document.createElement("div"),c.appendChild(a.cloneNode(!0)),tempdivtag=c.innerHTML.match("<[^>]*>"),null!==tempdivtag&&0<tempdivtag.length?(b+=tempdivtag[0],b=b+g+("</"+a.nodeName+">")):b+=g):b+=g;if(a.hasChildNodes())for(e=
0;e<a.childNodes.length;e++){if(a===this.endNode&&e===this.endOffset){this.inc=0;break}if(d===this.endNode){this.inc=0;break}}}return b},textMarkup:function(a){var b=!0,c="",e,g="",d="",l=a.nodeValue;a===this.startNode&&-1!==this.startOffset&&a===this.endNode&&-1!==this.endOffset?(g=a.nodeValue.substring(0,this.startOffset),l=a.nodeValue.substring(this.startOffset,this.endOffset),d=a.nodeValue.substring(this.endOffset),this.inc=1):a===this.startNode&&-1!==this.startOffset?(g=a.nodeValue.substring(0,
this.startOffset),l=a.nodeValue.substring(this.startOffset),this.inc=1):a===this.endNode&&-1!==this.endOffset&&(l=a.nodeValue.substring(0,this.endOffset),d=a.nodeValue.substring(this.endOffset),this.inc=1);if(!this.inc)return"";for(e=0;e<this.excludednodes.length;e++)if(a.parentNode&&a.parentNode.nodeName.toLowerCase()===this.excludednodes[e]){b=!1;c=this.htmlencode(l);break}b&&(c=rspkr.cfg.item("general.selectionEngine"),c=!c||"new"!==c&&"newcontent"!==c?this.markupSentences(this.htmlencode(l),null):
this.markupSentencesNew(this.htmlencode(l),null));a===this.endNode&&-1!==this.endOffset&&(this.inc=0);if(rs.cfg.item("general.enableSkipAlways")){e=a;for(var h=!1;e.parentNode;){if(/rs_skip_always/i.test(e.className)){h=!0;break}e=e.parentNode}h&&(c='<span class="rs_skip_always">'+c+"</span>")}b&&null!==a.parentNode&&""!==l&&(b=this.createreplacementnode(g+c+d,getComputedStyle(a.parentNode,null)),a.parentNode.insertBefore(b,a),a.parentNode.removeChild(a));return c},markupSentencesNew:function(a){a=
this.splitString(a,[", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),decodeURIComponent("%e3%80%82"),decodeURIComponent("%DB%94"),decodeURIComponent("%D8%8C")]);if(!a)return"";for(var b="",c="",e=!1,g=0;g<a.length;g++)b+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user sync_sent cj'+this.numberOfSelections+'" ',b+='id="sync'+this.bookMarkIndex++ +'">',this.endsWithSpace(a[g])?(e=!0,c=a[g].slice(0,-1)):c=a[g],b+=this.markupWords(c),b+="</"+rspkr.Common.data.browser.syncContainer+">",
!0===e&&(b+=" "),e=!1;return b},markupSentences:function(a){a=this.splitString(a,[", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),decodeURIComponent("%e3%80%82"),decodeURIComponent("%DB%94"),decodeURIComponent("%D8%8C")]);if(!a)return"";for(var b="",c="",e=!1,g=0;g<a.length;g++)b+="<"+rspkr.Common.data.browser.syncContainer+' class="ffsent'+this.numberOfSelections+" cj"+this.numberOfSelections+'" ',b+='id="sync'+this.bookMarkIndex++ +'">',this.endsWithSpace(a[g])?(e=!0,c=a[g].slice(0,-1)):c=a[g],
b+=this.markupWords(c),!0===e&&(b+=" "),b+="</"+rspkr.Common.data.browser.syncContainer+">",e=!1;return b},markupWords:function(a){a=this.splitString(a," ");if(!a)return"";for(var b="",c="",e=!1,g=0;g<a.length;g++)b+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user sync_word ck'+this.numberOfSelections+'"',b+=' id="sync'+this.bookMarkIndex++ +'">',this.endsWithSpace(a[g])?(e=!0,c=a[g].slice(0,-1)):c=a[g],b+=c,b+="</"+rspkr.Common.data.browser.syncContainer+">",!0===e&&(b+=" "),e=!1;
return b},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},htmlencode:function(a){var b=document.createElement("div");a=document.createTextNode(a);b.appendChild(a);return b.innerHTML},identifyElementsReplacementNode:function(a){a.tagName&&a.tagName.toLowerCase()==rspkr.Common.data.browser.syncContainer&&a.id&&(rspkr.HL.clientMarkup.selectedWordsRange[a.id]=a);if(a.hasChildNodes())for(var b=0;b<a.childNodes.length;b++)this.identifyElementsReplacementNode(a.childNodes[b])},createreplacementnode:function(a,
b){var c=document.createElement(rspkr.Common.data.browser.syncContainer);c.innerHTML=a;c.setAttribute("class","synctemp cl"+this.numberOfSelections);return c},modifyOffsetStartOfWord:function(a,b){for(var c=[" ",", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),decodeURIComponent("%e3%80%82"),decodeURIComponent("%DB%94"),decodeURIComponent("%D8%8C")];a.nodeValue&&0!=b;){for(var e=0;e<c.length;e++)if(breakstr=c[e],0==a.nodeValue.substring(b).indexOf(breakstr))return b;b--}return b},modifyOffsetEndOfWord:function(a,
b){for(var c=[" ",", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),decodeURIComponent("%e3%80%82"),decodeURIComponent("%DB%94"),decodeURIComponent("%D8%8C")];a.nodeValue&&b!=a.nodeValue.length;){for(var e=0;e<c.length;e++)if(breakstr=c[e],0==a.nodeValue.substring(b-1).indexOf(breakstr))return b;b++}return b},returnClassArraySubstring:function(a){a=$rs.get("."+a);return a=$rs.isArray(a)?a:[a]},splitString:function(a,b){for(var c=[""],e=0,g=0;g<a.length;g++){for(var d=0;d<b.length;d++){for(var l=
b[d],h=!0,k=0;k<l.length;k++)if(0>a.length-(g+k)||l[l.length-k-1]!=a[g-k-1]){h=!1;break}h&&(e++,c[e]="")}c[e]+=a[g]}return c},endsWithSpace:function(a){return-1!==a.indexOf(" ",a.length-1)}},postProcess:{cleanUpSpans:function(){rspkr.log("[ClientMarkup.postProcess.cleanUpSpans] called!");var a=rspkr.Common.data.browser.syncContainer.replace(/(:|\.|\[|\]|,)/g,"\\$1"),a=$rs.get(a+".sync_sent,"+a+".sync_word,"+a+".sync_sent_highlighted,"+a+".sync_word_highlighted,"+a+".sync_user,"+a+".synctemp,"+a+'[class*="ffsent"]'),
b,a=$rs.isArray(a)?a:[a];for(i=a.length-1;-1<i;i--)b=document.createDocumentFragment(),b.textContent=a[i].textContent,a[i].parentNode.replaceChild(b,a[i])},lightCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.lightCleanUp] called!!");var a=rspkr.Common.data.browser.syncContainer.replace(/(:|\.|\[|\]|,)/g,"\\$1"),a=$rs.get(a+".sync_sent,"+a+".sync_word,"+a+".sync_sent_highlighted,"+a+".sync_word_highlighted,"+a+".sync_user,"+a+".synctemp,"+a+'[class*="ffsent"]'),a=$rs.isArray(a)?a:[a];for(i=
a.length-1;-1<i;i--)rspkr.HL.chunking.continueHref||(a[i].className=a[i].className.replace("sync_sent_highlighted","sync_sent")),a[i].className=a[i].className.replace("sync_word_highlighted","sync_word"),rspkr.HL.chunking.continueHref||-1!==a[i].className.toLowerCase().indexOf("sync_user")||a[i].removeAttribute("id")},settingsCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.settingsCleanUp] called!");var a=rspkr.HL.clientMarkup.previousWord.element,b=rspkr.HL.clientMarkup.previousWord.className,
c=rspkr.HL.clientMarkup.previousSent.element,e=rspkr.HL.clientMarkup.previousSent.className;if(0<a.length){for(var g in a)a[g].className=b[g];rspkr.HL.clientMarkup.previousWord.element=[];rspkr.HL.clientMarkup.previousWord.className=[]}if(0<c.length){for(g in c)c[g].className=e[g];rspkr.HL.clientMarkup.previousSent.element=[];rspkr.HL.clientMarkup.previousSent.className=[]}},fullCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.fullCleanUp] called!");var a=rspkr.HL.clientMarkup.previousWord.element,
b=rspkr.HL.clientMarkup.previousWord.className,c=rspkr.HL.clientMarkup.previousSent.element,e=rspkr.HL.clientMarkup.previousSent.className;if(0<a.length){for(var g in a)a[g].className=b[g];rspkr.HL.clientMarkup.previousWord.element=[];rspkr.HL.clientMarkup.previousWord.className=[]}if(0<c.length){for(g in c)c[g].className=e[g];rspkr.HL.clientMarkup.previousSent.element=[];rspkr.HL.clientMarkup.previousSent.className=[]}this.cleanUpSpans();rspkr.Common.data.selectedHTML=""}},sync:function(a,b){var c=
!1,e;0==(a&2)&&(c=0!=(a&1)?!0:!1);1==this.firstRun&&(this.previousWord.element=[],this.previousWord.className=[],this.previousSent.element=[],this.previousSent.className=[]);e=this.selectedWordsRange["sync"+b];if(e.className.replace("word","")!=e.className){rspkr.log("inside");if(0<this.previousWord.element.length&&0<this.previousWord.className.length&&!c){for(c=0;c<this.previousWord.element.length;c++)this.previousWord.element[c].className=this.previousWord.className[c];this.previousWord.element=
[];this.previousWord.className=[]}this.previousWord.element.push(e);this.previousWord.className.push(e.className);"sent"===rspkr.st.get("hl")?e.className=e.className.replace("sync_sent","sync_user sync_sent_highlighted"):(rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.wordHL(e,a),e.className=e.className.replace("sync_word","sync_user sync_word_highlighted"))}e&&rspkr.HL.Scroll.execScroll(e);if(1==this.firstRun){this.firstRun=0;if(0<this.previousSent.element.length){for(c=0;c<this.previousSent.element.length;c++)this.previousSent.element[c].className=
this.previousSent.className[c];this.previousSent.element=[];this.previousSent.className=[]}if("wordsent"==rspkr.st.get("hl"))for(e=this.preProcess.returnClassArraySubstring("ffsent"+this.preProcess.numberOfSelections+" "),c=0;c<e.length;c++)this.previousSent.element[c]=e[c],this.previousSent.className[c]=e[c].className,e[c].className="ffsent"+this.preProcess.numberOfSelections+" sync_sent_highlighted"}},syncNew:function(a,b){var c;1==this.firstRun&&(this.previousWord.element=[],this.previousWord.className=
[],this.previousSent.element=[],this.previousSent.className=[],this.firstRun=0);c=document.getElementById("sync"+b);if(c.className.replace("word","")!=c.className&&("word"===rspkr.st.get("hl")||"wordsent"===rspkr.st.get("hl"))){if(0<this.previousWord.element.length&&0<this.previousWord.className.length){for(var e=0;e<this.previousWord.element.length;e++)this.previousWord.element[e].className=this.previousWord.className[e];this.previousWord.element=[];this.previousWord.className=[]}this.previousWord.element.push(c);
this.previousWord.className.push(c.className);c.className="sync_user sync_word_highlighted"}else if(c.className.replace("sent","")!=c.className&&("sent"===rspkr.st.get("hl")||"wordsent"===rspkr.st.get("hl"))){if(0<this.previousSent.element.length&&0<this.previousSent.className.length){for(e=0;e<this.previousSent.element.length;e++)this.previousSent.element[e].className=this.previousSent.className[e];this.previousSent.element=[];this.previousSent.className=[]}this.previousSent.element.push(c);this.previousSent.className.push(c.className);
c.className=c.className.replace("sync_sent","sync_user sync_sent_highlighted")}c&&rspkr.HL.Scroll.execScroll(c)}}}}();
